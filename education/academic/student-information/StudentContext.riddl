// Student Information - Student Context
context StudentContext is {
  include "types.riddl"
  include "Student.riddl"
  // Repository for student persistence
  repository StudentRepository is {
    schema StudentData is relational
      of students as type StudentContext.Student
        index on field StudentContext.Student.studentId
        index on field StudentContext.Student.info.lastName

    handler StudentPersistence is {
      on command Student.RegisterStudent is {
        prompt "Store new student record"
      }
      on command Student.UpdateStudentInfo is {
        prompt "Update student info"
      }
      on command Student.EnrollInProgram is {
        prompt "Store program enrollment"
      }
      on command Student.RecordCourse is {
        prompt "Store course record"
      }
      on command Student.UpdateGrade is {
        prompt "Update grade record"
      }
      on command Student.PlaceHold is {
        prompt "Store hold record"
      }
      on command Student.ReleaseHold is {
        prompt "Update hold status"
      }
      on command Student.Graduate is {
        prompt "Update graduation status"
      }
    } with {
      briefly "Persists student commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Student data persistence"
    described as {
      | The StudentRepository provides persistent storage for
      | student records, courses, and academic history.
    }
  }
  // Projector for enrollment analytics
  projector EnrollmentAnalytics is {
    record EnrollmentStats is  {
      programId: ProgramId with {
        briefly "Program"
        described as {
          |Academic program.
        }
      }
      totalEnrolled: Natural with {
        briefly "Enrolled"
        described as {
          |Total enrolled.
        }
      }
      averageGpa: Decimal(4,2) with {
        briefly "Avg GPA"
        described as {
          |Average GPA.
        }
      }
      graduationRate: Decimal(5,2) with {
        briefly "Grad rate"
        described as {
          |Graduation rate.
        }
      }
      retentionRate: Decimal(5,2) with {
        briefly "Retention"
        described as {
          |Retention rate.
        }
      }
    } with {
      briefly "Enrollment statistics"
      described as {
        |Program enrollment metrics.
      }
    }
    handler AnalyticsHandler is {
      on event StudentContext.Student.StudentRegistered is {
        prompt "Update enrollment counts"
      }
      on event StudentContext.Student.ProgramEnrolled is {
        prompt "Update program metrics"
      }
      on event StudentContext.Student.GradeUpdated is {
        prompt "Update GPA metrics"
      }
      on event StudentContext.Student.StudentGraduated is {
        prompt "Update graduation metrics"
      }
      on event StudentContext.Student.StatusChanged is {
        prompt "Update retention metrics"
      }
    } with {
      briefly "Maintains enrollment analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Enrollment analytics projections"
    described as {
      |Maintains enrollment analytics data.
    }
  }
} with {
  briefly "Bounded context for student information"
  described as {
    | The StudentContext is the bounded context for student
    | records, academic history, and administrative functions.
  }
}
