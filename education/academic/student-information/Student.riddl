// Student Information - Student Entity
entity Student is {
  // Commands
  command RegisterStudent is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |New student identifier.
      }
    }
    info: StudentInfo with {
      briefly "Info"
      described as {
        |Student information.
      }
    }
    programId: ProgramId with {
      briefly "Program"
      described as {
        |Initial program.
      }
    }
  } with {
    briefly "Register student"
    described as {
      |Creates a new student record.
    }
  }
  command UpdateStudentInfo is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student to update.
      }
    }
    info: StudentInfo with {
      briefly "Info"
      described as {
        |Updated information.
      }
    }
  } with {
    briefly "Update student info"
    described as {
      |Updates student personal information.
    }
  }
  command EnrollInProgram is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student ID.
      }
    }
    enrollment: ProgramEnrollment with {
      briefly "Enrollment"
      described as {
        |Program enrollment.
      }
    }
  } with {
    briefly "Enroll in program"
    described as {
      |Enrolls student in academic program.
    }
  }
  command ChangeEnrollmentStatus is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student ID.
      }
    }
    newStatus: StudentStatus with {
      briefly "Status"
      described as {
        |New student status.
      }
    }
    statusChangeReason: String(1,500)? with {
      briefly "Reason"
      described as {
        |Status change reason.
      }
    }
  } with {
    briefly "Change status"
    described as {
      |Changes student enrollment status.
    }
  }
  command RecordCourse is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student ID.
      }
    }
    course: CourseRecord with {
      briefly "Course"
      described as {
        |Course to record.
      }
    }
  } with {
    briefly "Record course"
    described as {
      |Records course on student record.
    }
  }
  command UpdateGrade is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student ID.
      }
    }
    courseCode: String(1,20) with {
      briefly "Course"
      described as {
        |Course code.
      }
    }
    termId: UUID with {
      briefly "Term"
      described as {
        |Academic term.
      }
    }
    grade: String(1,5) with {
      briefly "Grade"
      described as {
        |Final grade.
      }
    }
    gradePoints: Decimal(4,2) with {
      briefly "Points"
      described as {
        |Grade points.
      }
    }
  } with {
    briefly "Update grade"
    described as {
      |Updates course grade.
    }
  }
  command PlaceHold is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student ID.
      }
    }
    hold: AcademicHold with {
      briefly "Hold"
      described as {
        |Hold to place.
      }
    }
  } with {
    briefly "Place hold"
    described as {
      |Places academic hold on record.
    }
  }
  command ReleaseHold is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student ID.
      }
    }
    holdId: UUID with {
      briefly "Hold ID"
      described as {
        |Hold to release.
      }
    }
  } with {
    briefly "Release hold"
    described as {
      |Releases academic hold.
    }
  }
  command AssignAdvisor is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student ID.
      }
    }
    assignment: AdvisorAssignment with {
      briefly "Assignment"
      described as {
        |Advisor assignment.
      }
    }
  } with {
    briefly "Assign advisor"
    described as {
      |Assigns academic advisor.
    }
  }
  command UpdateAcademicStanding is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student ID.
      }
    }
    standing: AcademicStanding with {
      briefly "Standing"
      described as {
        |New standing.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Standing change reason.
      }
    }
  } with {
    briefly "Update standing"
    described as {
      |Updates academic standing.
    }
  }
  command Graduate is  {
    studentId: StudentId with {
      briefly "Student ID"
      described as {
        |Student ID.
      }
    }
    programId: ProgramId with {
      briefly "Program"
      described as {
        |Completed program.
      }
    }
    graduationDate: Date with {
      briefly "Date"
      described as {
        |Graduation date.
      }
    }
  } with {
    briefly "Graduate"
    described as {
      |Graduates student from program.
    }
  }
  // Events
  event StudentRegistered is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    info: StudentInfo with {
      briefly "Info"
      described as {
        |Student info.
      }
    }
    programId: ProgramId with {
      briefly "Program"
      described as {
        |Initial program.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Student was registered"
    described as {
      |Emitted when student is registered.
    }
  }
  event StudentInfoUpdated is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    info: StudentInfo with {
      briefly "Info"
      described as {
        |Updated info.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Student info was updated"
    described as {
      |Emitted when info is updated.
    }
  }
  event ProgramEnrolled is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    enrollment: ProgramEnrollment with {
      briefly "Enrollment"
      described as {
        |Program enrollment.
      }
    }
    enrolledAt: TimeStamp with {
      briefly "Enrolled"
      described as {
        |Enrollment time.
      }
    }
  } with {
    briefly "Program was enrolled"
    described as {
      |Emitted when student enrolls in program.
    }
  }
  event StatusChanged is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    oldStatus: StudentStatus with {
      briefly "Old status"
      described as {
        |Previous status.
      }
    }
    newStatus: StudentStatus with {
      briefly "New status"
      described as {
        |New status.
      }
    }
    changedAt: TimeStamp with {
      briefly "Changed"
      described as {
        |Change time.
      }
    }
  } with {
    briefly "Status was changed"
    described as {
      |Emitted when status changes.
    }
  }
  event CourseRecorded is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    course: CourseRecord with {
      briefly "Course"
      described as {
        |Recorded course.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Course was recorded"
    described as {
      |Emitted when course is added.
    }
  }
  event GradeUpdated is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    courseCode: String(1,20) with {
      briefly "Course"
      described as {
        |Course code.
      }
    }
    grade: String(1,5) with {
      briefly "Grade"
      described as {
        |Final grade.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Grade was updated"
    described as {
      |Emitted when grade is recorded.
    }
  }
  event HoldPlaced is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    hold: AcademicHold with {
      briefly "Hold"
      described as {
        |Placed hold.
      }
    }
    placedAt: TimeStamp with {
      briefly "Placed"
      described as {
        |Place time.
      }
    }
  } with {
    briefly "Hold was placed"
    described as {
      |Emitted when hold is placed.
    }
  }
  event HoldReleased is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    holdId: UUID with {
      briefly "Hold"
      described as {
        |Released hold.
      }
    }
    releasedAt: TimeStamp with {
      briefly "Released"
      described as {
        |Release time.
      }
    }
  } with {
    briefly "Hold was released"
    described as {
      |Emitted when hold is released.
    }
  }
  event AdvisorAssigned is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    assignment: AdvisorAssignment with {
      briefly "Assignment"
      described as {
        |Advisor assignment.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Advisor was assigned"
    described as {
      |Emitted when advisor is assigned.
    }
  }
  event AcademicStandingUpdated is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    standing: AcademicStanding with {
      briefly "Standing"
      described as {
        |New standing.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Standing was updated"
    described as {
      |Emitted when standing changes.
    }
  }
  event StudentGraduated is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    programId: ProgramId with {
      briefly "Program"
      described as {
        |Completed program.
      }
    }
    graduationDate: Date with {
      briefly "Date"
      described as {
        |Graduation date.
      }
    }
    graduatedAt: TimeStamp with {
      briefly "Graduated"
      described as {
        |Graduation time.
      }
    }
  } with {
    briefly "Student graduated"
    described as {
      |Emitted when student graduates.
    }
  }
  // State Records
  record ActiveStudentData is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    info: StudentInfo with {
      briefly "Info"
      described as {
        |Student info.
      }
    }
    status: StudentStatus with {
      briefly "Status"
      described as {
        |Current status.
      }
    }
    programs: ProgramEnrollment+ with {
      briefly "Programs"
      described as {
        |Enrolled programs.
      }
    }
    courses: CourseRecord+ with {
      briefly "Courses"
      described as {
        |Course records.
      }
    }
    holds: AcademicHold+ with {
      briefly "Holds"
      described as {
        |Active holds.
      }
    }
    advisors: AdvisorAssignment+ with {
      briefly "Advisors"
      described as {
        |Assigned advisors.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Active student data"
    described as {
      |State data for active student.
    }
  }
  record GraduatedStudentData is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    info: StudentInfo with {
      briefly "Info"
      described as {
        |Student info.
      }
    }
    programs: ProgramEnrollment+ with {
      briefly "Programs"
      described as {
        |Completed programs.
      }
    }
    courses: CourseRecord+ with {
      briefly "Courses"
      described as {
        |Course records.
      }
    }
    graduatedAt: TimeStamp with {
      briefly "Graduated"
      described as {
        |Graduation time.
      }
    }
  } with {
    briefly "Graduated student data"
    described as {
      |State data for graduated student.
    }
  }
  record WithdrawnStudentData is  {
    studentId: StudentId with {
      briefly "Student"
      described as {
        |Student ID.
      }
    }
    info: StudentInfo with {
      briefly "Info"
      described as {
        |Student info.
      }
    }
    withdrawalReason: String(1,500)? with {
      briefly "Reason"
      described as {
        |Withdrawal reason.
      }
    }
    withdrawnAt: TimeStamp with {
      briefly "Withdrawn"
      described as {
        |Withdrawal time.
      }
    }
  } with {
    briefly "Withdrawn student data"
    described as {
      |State data for withdrawn student.
    }
  }
  // States
  state ActiveState of type Student.ActiveStudentData
  state GraduatedState of type Student.GraduatedStudentData
  state WithdrawnState of type Student.WithdrawnStudentData
  // Handler
  handler StudentHandler is {
    on command RegisterStudent is {
      morph entity StudentContext.Student to state StudentContext.Student.ActiveState with command RegisterStudent
      tell event StudentRegistered to entity StudentContext.Student
    }
    on command UpdateStudentInfo is {
      tell event StudentInfoUpdated to entity StudentContext.Student
    }
    on command EnrollInProgram is {
      tell event ProgramEnrolled to entity StudentContext.Student
    }
    on command ChangeEnrollmentStatus is {
      tell event StatusChanged to entity StudentContext.Student
    }
    on command RecordCourse is {
      tell event CourseRecorded to entity StudentContext.Student
    }
    on command UpdateGrade is {
      tell event GradeUpdated to entity StudentContext.Student
    }
    on command PlaceHold is {
      tell event HoldPlaced to entity StudentContext.Student
    }
    on command ReleaseHold is {
      tell event HoldReleased to entity StudentContext.Student
    }
    on command AssignAdvisor is {
      tell event AdvisorAssigned to entity StudentContext.Student
    }
    on command UpdateAcademicStanding is {
      tell event AcademicStandingUpdated to entity StudentContext.Student
    }
    on command Graduate is {
      morph entity StudentContext.Student to state StudentContext.Student.GraduatedState with command Graduate
      tell event StudentGraduated to entity StudentContext.Student
    }
  } with {
    briefly "Processes student commands"
    described as {
      | Handles student lifecycle including registration,
      | enrollment, academic records, and graduation.
    }
  }
} with {
  briefly "Student aggregate"
  described as {
    | The Student entity manages student records
    | including programs, courses, and academic history.
  }
}
