// Student Information - Student Entity

entity Student is {

  // Commands
  command RegisterStudent is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "New student identifier."
    }
    info is StudentInfo with {
      briefly "Info"
      described by "Student information."
    }
    programId is ProgramId with {
      briefly "Program"
      described by "Initial program."
    }
  } with {
    briefly "Register student"
    described by "Creates a new student record."
  }

  command UpdateStudentInfo is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student to update."
    }
    info is StudentInfo with {
      briefly "Info"
      described by "Updated information."
    }
  } with {
    briefly "Update student info"
    described by "Updates student personal information."
  }

  command EnrollInProgram is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student ID."
    }
    enrollment is ProgramEnrollment with {
      briefly "Enrollment"
      described by "Program enrollment."
    }
  } with {
    briefly "Enroll in program"
    described by "Enrolls student in academic program."
  }

  command ChangeEnrollmentStatus is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student ID."
    }
    newStatus is StudentStatus with {
      briefly "Status"
      described by "New student status."
    }
    statusChangeReason is optional String(1, 500) with {
      briefly "Reason"
      described by "Status change reason."
    }
  } with {
    briefly "Change status"
    described by "Changes student enrollment status."
  }

  command RecordCourse is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student ID."
    }
    course is CourseRecord with {
      briefly "Course"
      described by "Course to record."
    }
  } with {
    briefly "Record course"
    described by "Records course on student record."
  }

  command UpdateGrade is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student ID."
    }
    courseCode is String(1, 20) with {
      briefly "Course"
      described by "Course code."
    }
    termId is UUID with {
      briefly "Term"
      described by "Academic term."
    }
    grade is String(1, 5) with {
      briefly "Grade"
      described by "Final grade."
    }
    gradePoints is Decimal(4, 2) with {
      briefly "Points"
      described by "Grade points."
    }
  } with {
    briefly "Update grade"
    described by "Updates course grade."
  }

  command PlaceHold is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student ID."
    }
    hold is AcademicHold with {
      briefly "Hold"
      described by "Hold to place."
    }
  } with {
    briefly "Place hold"
    described by "Places academic hold on record."
  }

  command ReleaseHold is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student ID."
    }
    holdId is UUID with {
      briefly "Hold ID"
      described by "Hold to release."
    }
  } with {
    briefly "Release hold"
    described by "Releases academic hold."
  }

  command AssignAdvisor is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student ID."
    }
    assignment is AdvisorAssignment with {
      briefly "Assignment"
      described by "Advisor assignment."
    }
  } with {
    briefly "Assign advisor"
    described by "Assigns academic advisor."
  }

  command UpdateAcademicStanding is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student ID."
    }
    standing is AcademicStanding with {
      briefly "Standing"
      described by "New standing."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Standing change reason."
    }
  } with {
    briefly "Update standing"
    described by "Updates academic standing."
  }

  command Graduate is {
    studentId is StudentId with {
      briefly "Student ID"
      described by "Student ID."
    }
    programId is ProgramId with {
      briefly "Program"
      described by "Completed program."
    }
    graduationDate is Date with {
      briefly "Date"
      described by "Graduation date."
    }
  } with {
    briefly "Graduate"
    described by "Graduates student from program."
  }

  // Events
  event StudentRegistered is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    info is StudentInfo with { briefly "Info" described by "Student info." }
    programId is ProgramId with { briefly "Program" described by "Initial program." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Student was registered"
    described by "Emitted when student is registered."
  }

  event StudentInfoUpdated is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    info is StudentInfo with { briefly "Info" described by "Updated info." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Student info was updated"
    described by "Emitted when info is updated."
  }

  event ProgramEnrolled is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    enrollment is ProgramEnrollment with { briefly "Enrollment" described by "Program enrollment." }
    enrolledAt is TimeStamp with { briefly "Enrolled" described by "Enrollment time." }
  } with {
    briefly "Program was enrolled"
    described by "Emitted when student enrolls in program."
  }

  event StatusChanged is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    oldStatus is StudentStatus with { briefly "Old status" described by "Previous status." }
    newStatus is StudentStatus with { briefly "New status" described by "New status." }
    changedAt is TimeStamp with { briefly "Changed" described by "Change time." }
  } with {
    briefly "Status was changed"
    described by "Emitted when status changes."
  }

  event CourseRecorded is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    course is CourseRecord with { briefly "Course" described by "Recorded course." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Course was recorded"
    described by "Emitted when course is added."
  }

  event GradeUpdated is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    courseCode is String(1, 20) with { briefly "Course" described by "Course code." }
    grade is String(1, 5) with { briefly "Grade" described by "Final grade." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Grade was updated"
    described by "Emitted when grade is recorded."
  }

  event HoldPlaced is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    hold is AcademicHold with { briefly "Hold" described by "Placed hold." }
    placedAt is TimeStamp with { briefly "Placed" described by "Place time." }
  } with {
    briefly "Hold was placed"
    described by "Emitted when hold is placed."
  }

  event HoldReleased is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    holdId is UUID with { briefly "Hold" described by "Released hold." }
    releasedAt is TimeStamp with { briefly "Released" described by "Release time." }
  } with {
    briefly "Hold was released"
    described by "Emitted when hold is released."
  }

  event AdvisorAssigned is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    assignment is AdvisorAssignment with { briefly "Assignment" described by "Advisor assignment." }
    assignedAt is TimeStamp with { briefly "Assigned" described by "Assignment time." }
  } with {
    briefly "Advisor was assigned"
    described by "Emitted when advisor is assigned."
  }

  event AcademicStandingUpdated is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    standing is AcademicStanding with { briefly "Standing" described by "New standing." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Standing was updated"
    described by "Emitted when standing changes."
  }

  event StudentGraduated is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    programId is ProgramId with { briefly "Program" described by "Completed program." }
    graduationDate is Date with { briefly "Date" described by "Graduation date." }
    graduatedAt is TimeStamp with { briefly "Graduated" described by "Graduation time." }
  } with {
    briefly "Student graduated"
    described by "Emitted when student graduates."
  }

  // State Records
  record ActiveStudentData is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    info is StudentInfo with { briefly "Info" described by "Student info." }
    status is StudentStatus with { briefly "Status" described by "Current status." }
    programs is many ProgramEnrollment with { briefly "Programs" described by "Enrolled programs." }
    courses is many CourseRecord with { briefly "Courses" described by "Course records." }
    holds is many AcademicHold with { briefly "Holds" described by "Active holds." }
    advisors is many AdvisorAssignment with { briefly "Advisors" described by "Assigned advisors." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Active student data"
    described by "State data for active student."
  }

  record GraduatedStudentData is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    info is StudentInfo with { briefly "Info" described by "Student info." }
    programs is many ProgramEnrollment with { briefly "Programs" described by "Completed programs." }
    courses is many CourseRecord with { briefly "Courses" described by "Course records." }
    graduatedAt is TimeStamp with { briefly "Graduated" described by "Graduation time." }
  } with {
    briefly "Graduated student data"
    described by "State data for graduated student."
  }

  record WithdrawnStudentData is {
    studentId is StudentId with { briefly "Student" described by "Student ID." }
    info is StudentInfo with { briefly "Info" described by "Student info." }
    withdrawalReason is optional String(1, 500) with { briefly "Reason" described by "Withdrawal reason." }
    withdrawnAt is TimeStamp with { briefly "Withdrawn" described by "Withdrawal time." }
  } with {
    briefly "Withdrawn student data"
    described by "State data for withdrawn student."
  }

  // States
  state ActiveState of Student.ActiveStudentData with {
    briefly "Student is active"
    described by "Student is enrolled and active."
  }

  state GraduatedState of Student.GraduatedStudentData with {
    briefly "Student graduated"
    described by "Student has graduated."
  }

  state WithdrawnState of Student.WithdrawnStudentData with {
    briefly "Student withdrawn"
    described by "Student has withdrawn."
  }

  // Handler
  handler StudentHandler is {
    on command RegisterStudent {
      morph entity StudentContext.Student to state StudentContext.Student.ActiveState with command RegisterStudent
      tell event StudentRegistered to entity StudentContext.Student
    }

    on command UpdateStudentInfo {
      tell event StudentInfoUpdated to entity StudentContext.Student
    }

    on command EnrollInProgram {
      tell event ProgramEnrolled to entity StudentContext.Student
    }

    on command ChangeEnrollmentStatus {
      tell event StatusChanged to entity StudentContext.Student
    }

    on command RecordCourse {
      tell event CourseRecorded to entity StudentContext.Student
    }

    on command UpdateGrade {
      tell event GradeUpdated to entity StudentContext.Student
    }

    on command PlaceHold {
      tell event HoldPlaced to entity StudentContext.Student
    }

    on command ReleaseHold {
      tell event HoldReleased to entity StudentContext.Student
    }

    on command AssignAdvisor {
      tell event AdvisorAssigned to entity StudentContext.Student
    }

    on command UpdateAcademicStanding {
      tell event AcademicStandingUpdated to entity StudentContext.Student
    }

    on command Graduate {
      morph entity StudentContext.Student to state StudentContext.Student.GraduatedState with command Graduate
      tell event StudentGraduated to entity StudentContext.Student
    }
  } with {
    briefly "Processes student commands"
    described by {
      | Handles student lifecycle including registration,
      | enrollment, academic records, and graduation.
    }
  }

} with {
  briefly "Student aggregate"
  described by {
    | The Student entity manages student records
    | including programs, courses, and academic history.
  }
}
