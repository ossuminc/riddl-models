// Course Management - Course Context
context CourseContext is {
  include "types.riddl"
  include "Course.riddl"
  // Repository for course persistence
  repository CourseRepository is {
    schema CourseData is relational
      of courses as type Course
        index on field Course.courseId
        index on field Course.info.courseCode

    handler CoursePersistence is {
      on command Course.CreateCourse is {
        prompt "Store new course record"
      }
      on command Course.ScheduleSection is {
        prompt "Store section record"
      }
      on command Course.EnrollStudent is {
        prompt "Store enrollment record"
      }
      on command Course.RecordGrade is {
        prompt "Update enrollment with grade"
      }
      on command Course.CompleteSection is {
        prompt "Update section status"
      }
    } with {
      briefly "Persists course commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Course data persistence"
    described as {
      | The CourseRepository provides persistent storage for
      | courses, sections, and enrollments.
    }
  }
  // Projector for enrollment analytics
  projector EnrollmentAnalytics is {
    record EnrollmentSummary is  {
      termId: TermId with {
        briefly "Term"
        described as {
          |Academic term.
        }
      }
      totalEnrollments: Natural with {
        briefly "Total"
        described as {
          |Total enrollments.
        }
      }
      averageClassSize: Decimal(5,2) with {
        briefly "Avg size"
        described as {
          |Average class size.
        }
      }
      fillRate: Decimal(5,2) with {
        briefly "Fill rate"
        described as {
          |Capacity utilization.
        }
      }
    } with {
      briefly "Enrollment summary"
      described as {
        |Term enrollment metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Course.StudentEnrolled is {
        prompt "Update enrollment counts"
      }
      on event Course.StudentDropped is {
        prompt "Update enrollment counts"
      }
      on event Course.SectionCancelled is {
        prompt "Adjust capacity metrics"
      }
    } with {
      briefly "Maintains enrollment analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Enrollment analytics projections"
    described as {
      |Maintains enrollment analytics data.
    }
  }
} with {
  briefly "Bounded context for course management"
  described as {
    | The CourseContext is the bounded context for academic
    | course catalog, scheduling, and enrollment.
  }
}
