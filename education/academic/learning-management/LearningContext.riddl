// Learning Management - Learning Context

context LearningContext is {

  include "types.riddl"
  include "Course.riddl"

  // Repository for course persistence
  repository CourseRepository is {
    schema CourseData is relational
      of courses as Course
      index on field Course.courseId
      index on field Course.info.title

    handler CoursePersistence is {
      on command Course.CreateCourse {
        prompt "Store new course record"
      }
      on command Course.AddModule {
        prompt "Store module record"
      }
      on command Course.AddContent {
        prompt "Store content record"
      }
      on command Course.EnrollLearner {
        prompt "Store enrollment record"
      }
      on command Course.RecordProgress {
        prompt "Update progress record"
      }
      on command Course.GradeAssessment {
        prompt "Store grade record"
      }
      on command Course.CompleteCourse {
        prompt "Update enrollment completion"
      }
    } with {
      briefly "Persists course commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Course data persistence"
    described by {
      | The CourseRepository provides persistent storage for
      | courses, modules, content, and learner progress.
    }
  }

  // Projector for learning analytics
  projector LearningAnalytics is {
    updates repository CourseRepository

    record ProgressSummary is {
      courseId is CourseId with { briefly "Course" described by "Course ID." }
      totalEnrollments is Natural with { briefly "Enrollments" described by "Total enrollments." }
      completionRate is Decimal(5, 2) with { briefly "Completion" described by "Completion rate." }
      averageScore is Decimal(5, 2) with { briefly "Avg score" described by "Average assessment score." }
      averageTimeToComplete is Duration with { briefly "Avg time" described by "Average completion time." }
    } with {
      briefly "Progress summary"
      described by "Course progress metrics."
    }

    handler AnalyticsHandler is {
      on event Course.LearnerEnrolled {
        prompt "Update enrollment counts"
      }
      on event Course.ProgressRecorded {
        prompt "Update progress metrics"
      }
      on event Course.AssessmentGraded {
        prompt "Update score analytics"
      }
      on event Course.CourseCompleted {
        prompt "Update completion metrics"
      }
    } with {
      briefly "Maintains learning analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Learning analytics projections"
    described by "Maintains learning analytics data."
  }

} with {
  briefly "Bounded context for learning management"
  described by {
    | The LearningContext is the bounded context for online
    | course delivery, content management, and learner engagement.
  }
}
