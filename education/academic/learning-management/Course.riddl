// Learning Management - Course Entity
entity Course is {
  // Commands
  command CreateCourse is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |New course identifier.
      }
    }
    info: CourseInfo with {
      briefly "Info"
      described as {
        |Course information.
      }
    }
    instructorId: InstructorId with {
      briefly "Instructor"
      described as {
        |Course instructor.
      }
    }
  } with {
    briefly "Create course"
    described as {
      |Creates a new course in draft state.
    }
  }
  command UpdateCourse is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course to update.
      }
    }
    info: CourseInfo with {
      briefly "Info"
      described as {
        |Updated information.
      }
    }
  } with {
    briefly "Update course"
    described as {
      |Updates course information.
    }
  }
  command AddModule is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course ID.
      }
    }
    module: CourseModule with {
      briefly "Module"
      described as {
        |Module to add.
      }
    }
  } with {
    briefly "Add module"
    described as {
      |Adds a module to the course.
    }
  }
  command UpdateModule is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course ID.
      }
    }
    module: CourseModule with {
      briefly "Module"
      described as {
        |Updated module.
      }
    }
  } with {
    briefly "Update module"
    described as {
      |Updates an existing module.
    }
  }
  command RemoveModule is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course ID.
      }
    }
    moduleId: ModuleId with {
      briefly "Module ID"
      described as {
        |Module to remove.
      }
    }
  } with {
    briefly "Remove module"
    described as {
      |Removes a module from course.
    }
  }
  command AddContent is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course ID.
      }
    }
    moduleId: ModuleId with {
      briefly "Module ID"
      described as {
        |Target module.
      }
    }
    content: ContentItem with {
      briefly "Content"
      described as {
        |Content to add.
      }
    }
  } with {
    briefly "Add content"
    described as {
      |Adds content to a module.
    }
  }
  command PublishCourse is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course to publish.
      }
    }
  } with {
    briefly "Publish course"
    described as {
      |Makes course available to learners.
    }
  }
  command ArchiveCourse is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course to archive.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Archive reason.
      }
    }
  } with {
    briefly "Archive course"
    described as {
      |Archives course from active catalog.
    }
  }
  command EnrollLearner is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course ID.
      }
    }
    learnerId: LearnerId with {
      briefly "Learner ID"
      described as {
        |Learner to enroll.
      }
    }
  } with {
    briefly "Enroll learner"
    described as {
      |Enrolls a learner in the course.
    }
  }
  command RecordProgress is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course ID.
      }
    }
    learnerId: LearnerId with {
      briefly "Learner ID"
      described as {
        |Learner ID.
      }
    }
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content completed.
      }
    }
    contentProgress: ContentProgress with {
      briefly "Progress"
      described as {
        |Progress details.
      }
    }
  } with {
    briefly "Record progress"
    described as {
      |Records learner progress on content.
    }
  }
  command SubmitAssessment is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course ID.
      }
    }
    attempt: AssessmentAttempt with {
      briefly "Attempt"
      described as {
        |Assessment attempt.
      }
    }
  } with {
    briefly "Submit assessment"
    described as {
      |Submits assessment for grading.
    }
  }
  command GradeAssessment is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course ID.
      }
    }
    attemptId: UUID with {
      briefly "Attempt ID"
      described as {
        |Attempt to grade.
      }
    }
    score: Decimal(5,2) with {
      briefly "Score"
      described as {
        |Achieved score.
      }
    }
    feedback: String(1,2000)? with {
      briefly "Feedback"
      described as {
        |Instructor feedback.
      }
    }
  } with {
    briefly "Grade assessment"
    described as {
      |Grades an assessment attempt.
    }
  }
  command CompleteCourse is  {
    courseId: CourseId with {
      briefly "Course ID"
      described as {
        |Course ID.
      }
    }
    learnerId: LearnerId with {
      briefly "Learner ID"
      described as {
        |Learner completing.
      }
    }
  } with {
    briefly "Complete course"
    described as {
      |Marks learner as course complete.
    }
  }
  // Events
  event CourseCreated is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    info: CourseInfo with {
      briefly "Info"
      described as {
        |Course info.
      }
    }
    instructorId: InstructorId with {
      briefly "Instructor"
      described as {
        |Instructor.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Course was created"
    described as {
      |Emitted when course is created.
    }
  }
  event CourseUpdated is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    info: CourseInfo with {
      briefly "Info"
      described as {
        |Updated info.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Course was updated"
    described as {
      |Emitted when course is updated.
    }
  }
  event ModuleAdded is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    module: CourseModule with {
      briefly "Module"
      described as {
        |Added module.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Module was added"
    described as {
      |Emitted when module is added.
    }
  }
  event ModuleUpdated is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    module: CourseModule with {
      briefly "Module"
      described as {
        |Updated module.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Module was updated"
    described as {
      |Emitted when module is updated.
    }
  }
  event ModuleRemoved is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    moduleId: ModuleId with {
      briefly "Module"
      described as {
        |Removed module.
      }
    }
    removedAt: TimeStamp with {
      briefly "Removed"
      described as {
        |Remove time.
      }
    }
  } with {
    briefly "Module was removed"
    described as {
      |Emitted when module is removed.
    }
  }
  event ContentAdded is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    moduleId: ModuleId with {
      briefly "Module"
      described as {
        |Module ID.
      }
    }
    content: ContentItem with {
      briefly "Content"
      described as {
        |Added content.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Content was added"
    described as {
      |Emitted when content is added.
    }
  }
  event CoursePublished is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    publishedAt: TimeStamp with {
      briefly "Published"
      described as {
        |Publish time.
      }
    }
  } with {
    briefly "Course was published"
    described as {
      |Emitted when course is published.
    }
  }
  event CourseArchived is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Archive reason.
      }
    }
    archivedAt: TimeStamp with {
      briefly "Archived"
      described as {
        |Archive time.
      }
    }
  } with {
    briefly "Course was archived"
    described as {
      |Emitted when course is archived.
    }
  }
  event LearnerEnrolled is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    learnerId: LearnerId with {
      briefly "Learner"
      described as {
        |Learner ID.
      }
    }
    enrollmentId: EnrollmentId with {
      briefly "Enrollment"
      described as {
        |Enrollment ID.
      }
    }
    enrolledAt: TimeStamp with {
      briefly "Enrolled"
      described as {
        |Enrollment time.
      }
    }
  } with {
    briefly "Learner was enrolled"
    described as {
      |Emitted when learner enrolls.
    }
  }
  event ProgressRecorded is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    learnerId: LearnerId with {
      briefly "Learner"
      described as {
        |Learner ID.
      }
    }
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    contentProgress: ContentProgress with {
      briefly "Progress"
      described as {
        |Progress data.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Progress was recorded"
    described as {
      |Emitted when progress is tracked.
    }
  }
  event AssessmentSubmitted is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    attempt: AssessmentAttempt with {
      briefly "Attempt"
      described as {
        |Submitted attempt.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Assessment was submitted"
    described as {
      |Emitted when assessment is submitted.
    }
  }
  event AssessmentGraded is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    attemptId: UUID with {
      briefly "Attempt"
      described as {
        |Attempt ID.
      }
    }
    score: Decimal(5,2) with {
      briefly "Score"
      described as {
        |Score achieved.
      }
    }
    passed: Boolean with {
      briefly "Passed"
      described as {
        |Whether passed.
      }
    }
    gradedAt: TimeStamp with {
      briefly "Graded"
      described as {
        |Grade time.
      }
    }
  } with {
    briefly "Assessment was graded"
    described as {
      |Emitted when assessment is graded.
    }
  }
  event CourseCompleted is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    learnerId: LearnerId with {
      briefly "Learner"
      described as {
        |Learner ID.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Course was completed"
    described as {
      |Emitted when learner completes course.
    }
  }
  // State Records
  record DraftCourseData is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    info: CourseInfo with {
      briefly "Info"
      described as {
        |Course info.
      }
    }
    instructorId: InstructorId with {
      briefly "Instructor"
      described as {
        |Instructor.
      }
    }
    modules: CourseModule+ with {
      briefly "Modules"
      described as {
        |Course modules.
      }
    }
    assessments: Assessment+ with {
      briefly "Assessments"
      described as {
        |Assessments.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Draft course data"
    described as {
      |State data for draft course.
    }
  }
  record PublishedCourseData is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    info: CourseInfo with {
      briefly "Info"
      described as {
        |Course info.
      }
    }
    instructorId: InstructorId with {
      briefly "Instructor"
      described as {
        |Instructor.
      }
    }
    modules: CourseModule+ with {
      briefly "Modules"
      described as {
        |Course modules.
      }
    }
    assessments: Assessment+ with {
      briefly "Assessments"
      described as {
        |Assessments.
      }
    }
    enrollments: Enrollment+ with {
      briefly "Enrollments"
      described as {
        |Enrollments.
      }
    }
    publishedAt: TimeStamp with {
      briefly "Published"
      described as {
        |Publish time.
      }
    }
  } with {
    briefly "Published course data"
    described as {
      |State data for published course.
    }
  }
  record ArchivedCourseData is  {
    courseId: CourseId with {
      briefly "Course"
      described as {
        |Course ID.
      }
    }
    info: CourseInfo with {
      briefly "Info"
      described as {
        |Course info.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Archive reason.
      }
    }
    archivedAt: TimeStamp with {
      briefly "Archived"
      described as {
        |Archive time.
      }
    }
  } with {
    briefly "Archived course data"
    described as {
      |State data for archived course.
    }
  }
  // States
  state DraftState of type Course.DraftCourseData
  state PublishedState of type Course.PublishedCourseData
  state ArchivedState of type Course.ArchivedCourseData
  // Handler
  handler CourseHandler is {
    on command CreateCourse is {
      morph entity LearningContext.Course to state LearningContext.Course.DraftState with command CreateCourse
      tell event CourseCreated to entity LearningContext.Course
    }
    on command UpdateCourse is {
      tell event CourseUpdated to entity LearningContext.Course
    }
    on command AddModule is {
      tell event ModuleAdded to entity LearningContext.Course
    }
    on command UpdateModule is {
      tell event ModuleUpdated to entity LearningContext.Course
    }
    on command RemoveModule is {
      tell event ModuleRemoved to entity LearningContext.Course
    }
    on command AddContent is {
      tell event ContentAdded to entity LearningContext.Course
    }
    on command PublishCourse is {
      morph entity LearningContext.Course to state LearningContext.Course.PublishedState with command PublishCourse
      tell event CoursePublished to entity LearningContext.Course
    }
    on command ArchiveCourse is {
      morph entity LearningContext.Course to state LearningContext.Course.ArchivedState with command ArchiveCourse
      tell event CourseArchived to entity LearningContext.Course
    }
    on command EnrollLearner is {
      tell event LearnerEnrolled to entity LearningContext.Course
    }
    on command RecordProgress is {
      tell event ProgressRecorded to entity LearningContext.Course
    }
    on command SubmitAssessment is {
      tell event AssessmentSubmitted to entity LearningContext.Course
    }
    on command GradeAssessment is {
      tell event AssessmentGraded to entity LearningContext.Course
    }
    on command CompleteCourse is {
      tell event CourseCompleted to entity LearningContext.Course
    }
  } with {
    briefly "Processes course commands"
    described as {
      | Handles course lifecycle including authoring,
      | publishing, enrollment, and progress tracking.
    }
  }
} with {
  briefly "Course aggregate"
  described as {
    | The Course entity manages online courses
    | including modules, content, and learner progress.
  }
}
