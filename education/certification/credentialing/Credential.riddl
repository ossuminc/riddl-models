// Credentialing - Credential Entity

entity Credential is {

  // Commands
  command CreateApplication is {
    applicationId is ApplicationId with {
      briefly "Application ID"
      described by "New application identifier."
    }
    candidateId is CandidateId with {
      briefly "Candidate"
      described by "Applying candidate."
    }
    programId is ProgramId with {
      briefly "Program"
      described by "Target program."
    }
    candidateInfo is CandidateInfo with {
      briefly "Info"
      described by "Candidate information."
    }
  } with {
    briefly "Create application"
    described by "Creates certification application."
  }

  command SubmitDocument is {
    applicationId is ApplicationId with {
      briefly "Application ID"
      described by "Application ID."
    }
    document is ApplicationDocument with {
      briefly "Document"
      described by "Document to submit."
    }
  } with {
    briefly "Submit document"
    described by "Submits supporting document."
  }

  command ReviewApplication is {
    applicationId is ApplicationId with {
      briefly "Application ID"
      described by "Application to review."
    }
    decision is ApplicationStatus with {
      briefly "Decision"
      described by "Review decision."
    }
    notes is optional String(1, 1000) with {
      briefly "Notes"
      described by "Review notes."
    }
  } with {
    briefly "Review application"
    described by "Reviews certification application."
  }

  command ScheduleExamination is {
    candidateId is CandidateId with {
      briefly "Candidate"
      described by "Candidate ID."
    }
    attempt is ExaminationAttempt with {
      briefly "Attempt"
      described by "Examination attempt."
    }
  } with {
    briefly "Schedule examination"
    described by "Schedules candidate examination."
  }

  command RecordExamResult is {
    attemptId is UUID with {
      briefly "Attempt ID"
      described by "Attempt to update."
    }
    score is Decimal(5, 2) with {
      briefly "Score"
      described by "Exam score."
    }
    passed is Boolean with {
      briefly "Passed"
      described by "Whether passed."
    }
  } with {
    briefly "Record exam result"
    described by "Records examination result."
  }

  command IssueCredential is {
    credentialId is CredentialId with {
      briefly "Credential ID"
      described by "New credential identifier."
    }
    candidateId is CandidateId with {
      briefly "Candidate"
      described by "Credential holder."
    }
    info is CredentialInfo with {
      briefly "Info"
      described by "Credential information."
    }
  } with {
    briefly "Issue credential"
    described by "Issues credential to candidate."
  }

  command SuspendCredential is {
    credentialId is CredentialId with {
      briefly "Credential ID"
      described by "Credential to suspend."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Suspension reason."
    }
  } with {
    briefly "Suspend credential"
    described by "Suspends active credential."
  }

  command RevokeCredential is {
    credentialId is CredentialId with {
      briefly "Credential ID"
      described by "Credential to revoke."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Revocation reason."
    }
  } with {
    briefly "Revoke credential"
    described by "Permanently revokes credential."
  }

  command RecordContinuingEducation is {
    credentialId is CredentialId with {
      briefly "Credential ID"
      described by "Credential ID."
    }
    activity is ContinuingEducation with {
      briefly "Activity"
      described by "CE activity."
    }
  } with {
    briefly "Record CE"
    described by "Records continuing education."
  }

  command RenewCredential is {
    credentialId is CredentialId with {
      briefly "Credential ID"
      described by "Credential to renew."
    }
    newExpirationDate is Date with {
      briefly "New expiration"
      described by "New expiration date."
    }
  } with {
    briefly "Renew credential"
    described by "Renews credential for new period."
  }

  command VerifyCredential is {
    request is VerificationRequest with {
      briefly "Request"
      described by "Verification request."
    }
  } with {
    briefly "Verify credential"
    described by "Processes verification request."
  }

  // Events
  event ApplicationCreated is {
    applicationId is ApplicationId with { briefly "Application" described by "Application ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    programId is ProgramId with { briefly "Program" described by "Program ID." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Application was created"
    described by "Emitted when application is submitted."
  }

  event DocumentSubmitted is {
    applicationId is ApplicationId with { briefly "Application" described by "Application ID." }
    document is ApplicationDocument with { briefly "Document" described by "Submitted document." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submission time." }
  } with {
    briefly "Document was submitted"
    described by "Emitted when document is uploaded."
  }

  event ApplicationReviewed is {
    applicationId is ApplicationId with { briefly "Application" described by "Application ID." }
    decision is ApplicationStatus with { briefly "Decision" described by "Review decision." }
    reviewedAt is TimeStamp with { briefly "Reviewed" described by "Review time." }
  } with {
    briefly "Application was reviewed"
    described by "Emitted when application is reviewed."
  }

  event ExaminationScheduled is {
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    attempt is ExaminationAttempt with { briefly "Attempt" described by "Scheduled attempt." }
    scheduledAt is TimeStamp with { briefly "Scheduled" described by "Schedule time." }
  } with {
    briefly "Examination was scheduled"
    described by "Emitted when exam is scheduled."
  }

  event ExamResultRecorded is {
    attemptId is UUID with { briefly "Attempt" described by "Attempt ID." }
    score is Decimal(5, 2) with { briefly "Score" described by "Exam score." }
    passed is Boolean with { briefly "Passed" described by "Whether passed." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Exam result was recorded"
    described by "Emitted when exam is graded."
  }

  event CredentialIssued is {
    credentialId is CredentialId with { briefly "Credential" described by "Credential ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    info is CredentialInfo with { briefly "Info" described by "Credential info." }
    issuedAt is TimeStamp with { briefly "Issued" described by "Issue time." }
  } with {
    briefly "Credential was issued"
    described by "Emitted when credential is granted."
  }

  event CredentialSuspended is {
    credentialId is CredentialId with { briefly "Credential" described by "Credential ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Suspension reason." }
    suspendedAt is TimeStamp with { briefly "Suspended" described by "Suspension time." }
  } with {
    briefly "Credential was suspended"
    described by "Emitted when credential is suspended."
  }

  event CredentialRevoked is {
    credentialId is CredentialId with { briefly "Credential" described by "Credential ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Revocation reason." }
    revokedAt is TimeStamp with { briefly "Revoked" described by "Revocation time." }
  } with {
    briefly "Credential was revoked"
    described by "Emitted when credential is revoked."
  }

  event ContinuingEducationRecorded is {
    credentialId is CredentialId with { briefly "Credential" described by "Credential ID." }
    activity is ContinuingEducation with { briefly "Activity" described by "CE activity." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "CE was recorded"
    described by "Emitted when CE is logged."
  }

  event CredentialRenewed is {
    credentialId is CredentialId with { briefly "Credential" described by "Credential ID." }
    newExpirationDate is Date with { briefly "New expiration" described by "New expiration." }
    renewedAt is TimeStamp with { briefly "Renewed" described by "Renewal time." }
  } with {
    briefly "Credential was renewed"
    described by "Emitted when credential is renewed."
  }

  event CredentialVerified is {
    request is VerificationRequest with { briefly "Request" described by "Verification request." }
    status is CredentialStatus with { briefly "Status" described by "Credential status." }
    verifiedAt is TimeStamp with { briefly "Verified" described by "Verification time." }
  } with {
    briefly "Credential was verified"
    described by "Emitted when verification completes."
  }

  // State Records
  record ApplicationStateData is {
    applicationId is ApplicationId with { briefly "Application" described by "Application ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    candidateInfo is CandidateInfo with { briefly "Info" described by "Candidate info." }
    programId is ProgramId with { briefly "Program" described by "Program ID." }
    status is ApplicationStatus with { briefly "Status" described by "Application status." }
    documents is many ApplicationDocument with { briefly "Documents" described by "Documents." }
    examAttempts is many ExaminationAttempt with { briefly "Exams" described by "Exam attempts." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Application state data"
    described by "State data for pending application."
  }

  record ActiveCredentialData is {
    credentialId is CredentialId with { briefly "Credential" described by "Credential ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Holder ID." }
    candidateInfo is CandidateInfo with { briefly "Info" described by "Holder info." }
    info is CredentialInfo with { briefly "Credential" described by "Credential info." }
    status is CredentialStatus with { briefly "Status" described by "Credential status." }
    continuingEducation is many ContinuingEducation with { briefly "CE" described by "CE activities." }
    issuedAt is TimeStamp with { briefly "Issued" described by "Issue time." }
  } with {
    briefly "Active credential data"
    described by "State data for active credential."
  }

  record RevokedCredentialData is {
    credentialId is CredentialId with { briefly "Credential" described by "Credential ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Holder ID." }
    info is CredentialInfo with { briefly "Credential" described by "Credential info." }
    reason is String(1, 500) with { briefly "Reason" described by "Revocation reason." }
    revokedAt is TimeStamp with { briefly "Revoked" described by "Revocation time." }
  } with {
    briefly "Revoked credential data"
    described by "State data for revoked credential."
  }

  // States
  state ApplicationState of Credential.ApplicationStateData with {
    briefly "Application pending"
    described by "Candidate has applied for certification."
  }

  state ActiveState of Credential.ActiveCredentialData with {
    briefly "Credential is active"
    described by "Credential has been issued and is valid."
  }

  state RevokedState of Credential.RevokedCredentialData with {
    briefly "Credential is revoked"
    described by "Credential has been revoked."
  }

  // Handler
  handler CredentialHandler is {
    on command CreateApplication {
      morph entity CredentialContext.Credential to state CredentialContext.Credential.ApplicationState with command CreateApplication
      tell event ApplicationCreated to entity CredentialContext.Credential
    }

    on command SubmitDocument {
      tell event DocumentSubmitted to entity CredentialContext.Credential
    }

    on command ReviewApplication {
      tell event ApplicationReviewed to entity CredentialContext.Credential
    }

    on command ScheduleExamination {
      tell event ExaminationScheduled to entity CredentialContext.Credential
    }

    on command RecordExamResult {
      tell event ExamResultRecorded to entity CredentialContext.Credential
    }

    on command IssueCredential {
      morph entity CredentialContext.Credential to state CredentialContext.Credential.ActiveState with command IssueCredential
      tell event CredentialIssued to entity CredentialContext.Credential
    }

    on command SuspendCredential {
      tell event CredentialSuspended to entity CredentialContext.Credential
    }

    on command RevokeCredential {
      morph entity CredentialContext.Credential to state CredentialContext.Credential.RevokedState with command RevokeCredential
      tell event CredentialRevoked to entity CredentialContext.Credential
    }

    on command RecordContinuingEducation {
      tell event ContinuingEducationRecorded to entity CredentialContext.Credential
    }

    on command RenewCredential {
      tell event CredentialRenewed to entity CredentialContext.Credential
    }

    on command VerifyCredential {
      tell event CredentialVerified to entity CredentialContext.Credential
    }
  } with {
    briefly "Processes credential commands"
    described by {
      | Handles credential lifecycle including application,
      | examination, issuance, renewal, and verification.
    }
  }

} with {
  briefly "Credential aggregate"
  described by {
    | The Credential entity manages professional credentials
    | including certification, licensing, and verification.
  }
}
