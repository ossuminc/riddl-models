// Credentialing - Credential Entity
entity Credential is {
  // Commands
  command CreateApplication is  {
    applicationId: ApplicationId with {
      briefly "Application ID"
      described as {
        |New application identifier.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Applying candidate.
      }
    }
    programId: ProgramId with {
      briefly "Program"
      described as {
        |Target program.
      }
    }
    candidateInfo: CandidateInfo with {
      briefly "Info"
      described as {
        |Candidate information.
      }
    }
  } with {
    briefly "Create application"
    described as {
      |Creates certification application.
    }
  }
  command SubmitDocument is  {
    applicationId: ApplicationId with {
      briefly "Application ID"
      described as {
        |Application ID.
      }
    }
    document: ApplicationDocument with {
      briefly "Document"
      described as {
        |Document to submit.
      }
    }
  } with {
    briefly "Submit document"
    described as {
      |Submits supporting document.
    }
  }
  command ReviewApplication is  {
    applicationId: ApplicationId with {
      briefly "Application ID"
      described as {
        |Application to review.
      }
    }
    decision: ApplicationStatus with {
      briefly "Decision"
      described as {
        |Review decision.
      }
    }
    notes: String(1,1000)? with {
      briefly "Notes"
      described as {
        |Review notes.
      }
    }
  } with {
    briefly "Review application"
    described as {
      |Reviews certification application.
    }
  }
  command ScheduleExamination is  {
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    attempt: ExaminationAttempt with {
      briefly "Attempt"
      described as {
        |Examination attempt.
      }
    }
  } with {
    briefly "Schedule examination"
    described as {
      |Schedules candidate examination.
    }
  }
  command RecordExamResult is  {
    attemptId: UUID with {
      briefly "Attempt ID"
      described as {
        |Attempt to update.
      }
    }
    score: Decimal(5,2) with {
      briefly "Score"
      described as {
        |Exam score.
      }
    }
    passed: Boolean with {
      briefly "Passed"
      described as {
        |Whether passed.
      }
    }
  } with {
    briefly "Record exam result"
    described as {
      |Records examination result.
    }
  }
  command IssueCredential is  {
    credentialId: CredentialId with {
      briefly "Credential ID"
      described as {
        |New credential identifier.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Credential holder.
      }
    }
    info: CredentialInfo with {
      briefly "Info"
      described as {
        |Credential information.
      }
    }
  } with {
    briefly "Issue credential"
    described as {
      |Issues credential to candidate.
    }
  }
  command SuspendCredential is  {
    credentialId: CredentialId with {
      briefly "Credential ID"
      described as {
        |Credential to suspend.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
  } with {
    briefly "Suspend credential"
    described as {
      |Suspends active credential.
    }
  }
  command RevokeCredential is  {
    credentialId: CredentialId with {
      briefly "Credential ID"
      described as {
        |Credential to revoke.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Revocation reason.
      }
    }
  } with {
    briefly "Revoke credential"
    described as {
      |Permanently revokes credential.
    }
  }
  command RecordContinuingEducation is  {
    credentialId: CredentialId with {
      briefly "Credential ID"
      described as {
        |Credential ID.
      }
    }
    activity: ContinuingEducation with {
      briefly "Activity"
      described as {
        |CE activity.
      }
    }
  } with {
    briefly "Record CE"
    described as {
      |Records continuing education.
    }
  }
  command RenewCredential is  {
    credentialId: CredentialId with {
      briefly "Credential ID"
      described as {
        |Credential to renew.
      }
    }
    newExpirationDate: Date with {
      briefly "New expiration"
      described as {
        |New expiration date.
      }
    }
  } with {
    briefly "Renew credential"
    described as {
      |Renews credential for new period.
    }
  }
  command VerifyCredential is  {
    request: VerificationRequest with {
      briefly "Request"
      described as {
        |Verification request.
      }
    }
  } with {
    briefly "Verify credential"
    described as {
      |Processes verification request.
    }
  }
  // Events
  event ApplicationCreated is  {
    applicationId: ApplicationId with {
      briefly "Application"
      described as {
        |Application ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    programId: ProgramId with {
      briefly "Program"
      described as {
        |Program ID.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Application was created"
    described as {
      |Emitted when application is submitted.
    }
  }
  event DocumentSubmitted is  {
    applicationId: ApplicationId with {
      briefly "Application"
      described as {
        |Application ID.
      }
    }
    document: ApplicationDocument with {
      briefly "Document"
      described as {
        |Submitted document.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Document was submitted"
    described as {
      |Emitted when document is uploaded.
    }
  }
  event ApplicationReviewed is  {
    applicationId: ApplicationId with {
      briefly "Application"
      described as {
        |Application ID.
      }
    }
    decision: ApplicationStatus with {
      briefly "Decision"
      described as {
        |Review decision.
      }
    }
    reviewedAt: TimeStamp with {
      briefly "Reviewed"
      described as {
        |Review time.
      }
    }
  } with {
    briefly "Application was reviewed"
    described as {
      |Emitted when application is reviewed.
    }
  }
  event ExaminationScheduled is  {
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    attempt: ExaminationAttempt with {
      briefly "Attempt"
      described as {
        |Scheduled attempt.
      }
    }
    scheduledAt: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Schedule time.
      }
    }
  } with {
    briefly "Examination was scheduled"
    described as {
      |Emitted when exam is scheduled.
    }
  }
  event ExamResultRecorded is  {
    attemptId: UUID with {
      briefly "Attempt"
      described as {
        |Attempt ID.
      }
    }
    score: Decimal(5,2) with {
      briefly "Score"
      described as {
        |Exam score.
      }
    }
    passed: Boolean with {
      briefly "Passed"
      described as {
        |Whether passed.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Exam result was recorded"
    described as {
      |Emitted when exam is graded.
    }
  }
  event CredentialIssued is  {
    credentialId: CredentialId with {
      briefly "Credential"
      described as {
        |Credential ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    info: CredentialInfo with {
      briefly "Info"
      described as {
        |Credential info.
      }
    }
    issuedAt: TimeStamp with {
      briefly "Issued"
      described as {
        |Issue time.
      }
    }
  } with {
    briefly "Credential was issued"
    described as {
      |Emitted when credential is granted.
    }
  }
  event CredentialSuspended is  {
    credentialId: CredentialId with {
      briefly "Credential"
      described as {
        |Credential ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
    suspendedAt: TimeStamp with {
      briefly "Suspended"
      described as {
        |Suspension time.
      }
    }
  } with {
    briefly "Credential was suspended"
    described as {
      |Emitted when credential is suspended.
    }
  }
  event CredentialRevoked is  {
    credentialId: CredentialId with {
      briefly "Credential"
      described as {
        |Credential ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Revocation reason.
      }
    }
    revokedAt: TimeStamp with {
      briefly "Revoked"
      described as {
        |Revocation time.
      }
    }
  } with {
    briefly "Credential was revoked"
    described as {
      |Emitted when credential is revoked.
    }
  }
  event ContinuingEducationRecorded is  {
    credentialId: CredentialId with {
      briefly "Credential"
      described as {
        |Credential ID.
      }
    }
    activity: ContinuingEducation with {
      briefly "Activity"
      described as {
        |CE activity.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "CE was recorded"
    described as {
      |Emitted when CE is logged.
    }
  }
  event CredentialRenewed is  {
    credentialId: CredentialId with {
      briefly "Credential"
      described as {
        |Credential ID.
      }
    }
    newExpirationDate: Date with {
      briefly "New expiration"
      described as {
        |New expiration.
      }
    }
    renewedAt: TimeStamp with {
      briefly "Renewed"
      described as {
        |Renewal time.
      }
    }
  } with {
    briefly "Credential was renewed"
    described as {
      |Emitted when credential is renewed.
    }
  }
  event CredentialVerified is  {
    request: VerificationRequest with {
      briefly "Request"
      described as {
        |Verification request.
      }
    }
    credentialStatus: CredentialStatus with {
      briefly "Status"
      described as {
        |Credential status.
      }
    }
    verifiedAt: TimeStamp with {
      briefly "Verified"
      described as {
        |Verification time.
      }
    }
  } with {
    briefly "Credential was verified"
    described as {
      |Emitted when verification completes.
    }
  }
  // State Records
  record ApplicationStateData is  {
    applicationId: ApplicationId with {
      briefly "Application"
      described as {
        |Application ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    candidateInfo: CandidateInfo with {
      briefly "Info"
      described as {
        |Candidate info.
      }
    }
    programId: ProgramId with {
      briefly "Program"
      described as {
        |Program ID.
      }
    }
    status: ApplicationStatus with {
      briefly "Status"
      described as {
        |Application status.
      }
    }
    documents: ApplicationDocument+ with {
      briefly "Documents"
      described as {
        |Documents.
      }
    }
    examAttempts: ExaminationAttempt+ with {
      briefly "Exams"
      described as {
        |Exam attempts.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Application state data"
    described as {
      |State data for pending application.
    }
  }
  record ActiveCredentialData is  {
    credentialId: CredentialId with {
      briefly "Credential"
      described as {
        |Credential ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Holder ID.
      }
    }
    candidateInfo: CandidateInfo with {
      briefly "Info"
      described as {
        |Holder info.
      }
    }
    info: CredentialInfo with {
      briefly "Credential"
      described as {
        |Credential info.
      }
    }
    credentialStatus: CredentialStatus with {
      briefly "Status"
      described as {
        |Credential status.
      }
    }
    continuingEducation: ContinuingEducation+ with {
      briefly "CE"
      described as {
        |CE activities.
      }
    }
    issuedAt: TimeStamp with {
      briefly "Issued"
      described as {
        |Issue time.
      }
    }
  } with {
    briefly "Active credential data"
    described as {
      |State data for active credential.
    }
  }
  record RevokedCredentialData is  {
    credentialId: CredentialId with {
      briefly "Credential"
      described as {
        |Credential ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Holder ID.
      }
    }
    info: CredentialInfo with {
      briefly "Credential"
      described as {
        |Credential info.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Revocation reason.
      }
    }
    revokedAt: TimeStamp with {
      briefly "Revoked"
      described as {
        |Revocation time.
      }
    }
  } with {
    briefly "Revoked credential data"
    described as {
      |State data for revoked credential.
    }
  }
  // States
  state ApplicationState of type Credential.ApplicationStateData
  state ActiveState of type Credential.ActiveCredentialData
  state RevokedState of type Credential.RevokedCredentialData
  // Handler
  handler CredentialHandler is {
    on command CreateApplication is {
      morph entity CredentialContext.Credential to state CredentialContext.Credential.ApplicationState with command CreateApplication
      tell event ApplicationCreated to entity CredentialContext.Credential
    }
    on command SubmitDocument is {
      tell event DocumentSubmitted to entity CredentialContext.Credential
    }
    on command ReviewApplication is {
      tell event ApplicationReviewed to entity CredentialContext.Credential
    }
    on command ScheduleExamination is {
      tell event ExaminationScheduled to entity CredentialContext.Credential
    }
    on command RecordExamResult is {
      tell event ExamResultRecorded to entity CredentialContext.Credential
    }
    on command IssueCredential is {
      morph entity CredentialContext.Credential to state CredentialContext.Credential.ActiveState with command IssueCredential
      tell event CredentialIssued to entity CredentialContext.Credential
    }
    on command SuspendCredential is {
      tell event CredentialSuspended to entity CredentialContext.Credential
    }
    on command RevokeCredential is {
      morph entity CredentialContext.Credential to state CredentialContext.Credential.RevokedState with command RevokeCredential
      tell event CredentialRevoked to entity CredentialContext.Credential
    }
    on command RecordContinuingEducation is {
      tell event ContinuingEducationRecorded to entity CredentialContext.Credential
    }
    on command RenewCredential is {
      tell event CredentialRenewed to entity CredentialContext.Credential
    }
    on command VerifyCredential is {
      tell event CredentialVerified to entity CredentialContext.Credential
    }
  } with {
    briefly "Processes credential commands"
    described as {
      | Handles credential lifecycle including application,
      | examination, issuance, renewal, and verification.
    }
  }
} with {
  briefly "Credential aggregate"
  described as {
    | The Credential entity manages professional credentials
    | including certification, licensing, and verification.
  }
}
