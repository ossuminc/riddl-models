// Credentialing - Credential Context

context CredentialContext is {

  include "types.riddl"
  include "Credential.riddl"

  // Repository for credential persistence
  repository CredentialRepository is {
    schema CredentialData is relational
      of credentials as Credential
      index on field Credential.credentialId
      index on field Credential.candidateId

    handler CredentialPersistence is {
      on command Credential.CreateApplication {
        prompt "Store application record"
      }
      on command Credential.SubmitDocument {
        prompt "Store document record"
      }
      on command Credential.ReviewApplication {
        prompt "Update application status"
      }
      on command Credential.ScheduleExamination {
        prompt "Store exam attempt"
      }
      on command Credential.RecordExamResult {
        prompt "Update exam result"
      }
      on command Credential.IssueCredential {
        prompt "Store credential record"
      }
      on command Credential.SuspendCredential {
        prompt "Update credential status"
      }
      on command Credential.RevokeCredential {
        prompt "Update credential status"
      }
      on command Credential.RecordContinuingEducation {
        prompt "Store CE record"
      }
      on command Credential.RenewCredential {
        prompt "Update credential expiration"
      }
    } with {
      briefly "Persists credential commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Credential data persistence"
    described by {
      | The CredentialRepository provides persistent storage for
      | credentials, applications, and verification history.
    }
  }

  // Projector for credential analytics
  projector CredentialAnalytics is {
    updates repository CredentialRepository

    record CredentialStats is {
      programId is ProgramId with { briefly "Program" described by "Program ID." }
      totalIssued is Natural with { briefly "Issued" described by "Total issued." }
      totalActive is Natural with { briefly "Active" described by "Currently active." }
      passRate is Decimal(5, 2) with { briefly "Pass rate" described by "Exam pass rate." }
      renewalRate is Decimal(5, 2) with { briefly "Renewal rate" described by "Renewal rate." }
    } with {
      briefly "Credential statistics"
      described by "Program credential metrics."
    }

    handler AnalyticsHandler is {
      on event Credential.CredentialIssued {
        prompt "Update issuance counts"
      }
      on event Credential.ExamResultRecorded {
        prompt "Update pass rate metrics"
      }
      on event Credential.CredentialRenewed {
        prompt "Update renewal metrics"
      }
      on event Credential.CredentialRevoked {
        prompt "Update active counts"
      }
    } with {
      briefly "Maintains credential analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Credential analytics projections"
    described by "Maintains credential analytics data."
  }

} with {
  briefly "Bounded context for credentialing"
  described by {
    | The CredentialContext is the bounded context for professional
    | certification, licensing, and credential verification.
  }
}
