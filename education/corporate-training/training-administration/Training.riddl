// Training Administration - Training Entity

entity Training is {

  // Commands
  command CreateTrainingProgram is {
    trainingId is TrainingId with {
      briefly "Training ID"
      described by "New training identifier."
    }
    program is TrainingProgram with {
      briefly "Program"
      described by "Training program details."
    }
  } with {
    briefly "Create program"
    described by "Creates a new training program."
  }

  command UpdateTrainingProgram is {
    trainingId is TrainingId with {
      briefly "Training ID"
      described by "Training to update."
    }
    program is TrainingProgram with {
      briefly "Program"
      described by "Updated details."
    }
  } with {
    briefly "Update program"
    described by "Updates training program."
  }

  command ActivateTrainingProgram is {
    trainingId is TrainingId with {
      briefly "Training ID"
      described by "Training to activate."
    }
  } with {
    briefly "Activate program"
    described by "Makes training available for scheduling."
  }

  command RetireTrainingProgram is {
    trainingId is TrainingId with {
      briefly "Training ID"
      described by "Training to retire."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Retirement reason."
    }
  } with {
    briefly "Retire program"
    described by "Retires training program."
  }

  command ScheduleSession is {
    session is TrainingSession with {
      briefly "Session"
      described by "Session details."
    }
  } with {
    briefly "Schedule session"
    described by "Schedules new training session."
  }

  command CancelSession is {
    sessionId is SessionId with {
      briefly "Session ID"
      described by "Session to cancel."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Cancellation reason."
    }
  } with {
    briefly "Cancel session"
    described by "Cancels scheduled session."
  }

  command RegisterTrainee is {
    sessionId is SessionId with {
      briefly "Session ID"
      described by "Session ID."
    }
    traineeId is TraineeId with {
      briefly "Trainee ID"
      described by "Trainee to register."
    }
  } with {
    briefly "Register trainee"
    described by "Registers trainee for session."
  }

  command CancelRegistration is {
    registrationId is RegistrationId with {
      briefly "Registration ID"
      described by "Registration to cancel."
    }
    cancellationReason is optional String(1, 500) with {
      briefly "Reason"
      described by "Cancellation reason."
    }
  } with {
    briefly "Cancel registration"
    described by "Cancels trainee registration."
  }

  command RecordAttendance is {
    sessionId is SessionId with {
      briefly "Session ID"
      described by "Session ID."
    }
    traineeId is TraineeId with {
      briefly "Trainee ID"
      described by "Trainee ID."
    }
    attended is Boolean with {
      briefly "Attended"
      described by "Whether attended."
    }
  } with {
    briefly "Record attendance"
    described by "Records trainee attendance."
  }

  command CompleteSession is {
    sessionId is SessionId with {
      briefly "Session ID"
      described by "Session to complete."
    }
    notes is optional String(1, 2000) with {
      briefly "Notes"
      described by "Session notes."
    }
  } with {
    briefly "Complete session"
    described by "Marks session as completed."
  }

  command RecordCompletion is {
    traineeId is TraineeId with {
      briefly "Trainee ID"
      described by "Trainee ID."
    }
    trainingId is TrainingId with {
      briefly "Training ID"
      described by "Training ID."
    }
    score is optional Decimal(5, 2) with {
      briefly "Score"
      described by "Assessment score."
    }
    passed is Boolean with {
      briefly "Passed"
      described by "Whether passed."
    }
  } with {
    briefly "Record completion"
    described by "Records training completion."
  }

  command GenerateComplianceReport is {
    department is String(1, 100) with {
      briefly "Department"
      described by "Department to report."
    }
    trainingId is TrainingId with {
      briefly "Training"
      described by "Training program."
    }
    asOfDate is Date with {
      briefly "As of"
      described by "Report date."
    }
  } with {
    briefly "Generate report"
    described by "Generates compliance report."
  }

  // Events
  event TrainingProgramCreated is {
    trainingId is TrainingId with { briefly "Training" described by "Training ID." }
    program is TrainingProgram with { briefly "Program" described by "Program details." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Program was created"
    described by "Emitted when training is created."
  }

  event TrainingProgramUpdated is {
    trainingId is TrainingId with { briefly "Training" described by "Training ID." }
    program is TrainingProgram with { briefly "Program" described by "Updated details." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Program was updated"
    described by "Emitted when training is updated."
  }

  event TrainingProgramActivated is {
    trainingId is TrainingId with { briefly "Training" described by "Training ID." }
    activatedAt is TimeStamp with { briefly "Activated" described by "Activation time." }
  } with {
    briefly "Program was activated"
    described by "Emitted when training is activated."
  }

  event TrainingProgramRetired is {
    trainingId is TrainingId with { briefly "Training" described by "Training ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Retirement reason." }
    retiredAt is TimeStamp with { briefly "Retired" described by "Retirement time." }
  } with {
    briefly "Program was retired"
    described by "Emitted when training is retired."
  }

  event SessionScheduled is {
    session is TrainingSession with { briefly "Session" described by "Scheduled session." }
    scheduledAt is TimeStamp with { briefly "Scheduled" described by "Schedule time." }
  } with {
    briefly "Session was scheduled"
    described by "Emitted when session is scheduled."
  }

  event SessionCancelled is {
    sessionId is SessionId with { briefly "Session" described by "Session ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Cancel reason." }
    cancelledAt is TimeStamp with { briefly "Cancelled" described by "Cancel time." }
  } with {
    briefly "Session was cancelled"
    described by "Emitted when session is cancelled."
  }

  event TraineeRegistered is {
    sessionId is SessionId with { briefly "Session" described by "Session ID." }
    traineeId is TraineeId with { briefly "Trainee" described by "Trainee ID." }
    registrationId is RegistrationId with { briefly "Registration" described by "Registration ID." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Trainee was registered"
    described by "Emitted when trainee registers."
  }

  event RegistrationCancelled is {
    registrationId is RegistrationId with { briefly "Registration" described by "Registration ID." }
    cancelledAt is TimeStamp with { briefly "Cancelled" described by "Cancel time." }
  } with {
    briefly "Registration was cancelled"
    described by "Emitted when registration is cancelled."
  }

  event AttendanceRecorded is {
    sessionId is SessionId with { briefly "Session" described by "Session ID." }
    traineeId is TraineeId with { briefly "Trainee" described by "Trainee ID." }
    attended is Boolean with { briefly "Attended" described by "Attendance status." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Attendance was recorded"
    described by "Emitted when attendance is marked."
  }

  event SessionCompleted is {
    sessionId is SessionId with { briefly "Session" described by "Session ID." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Session was completed"
    described by "Emitted when session ends."
  }

  event TrainingCompleted is {
    traineeId is TraineeId with { briefly "Trainee" described by "Trainee ID." }
    trainingId is TrainingId with { briefly "Training" described by "Training ID." }
    passed is Boolean with { briefly "Passed" described by "Pass status." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Training was completed"
    described by "Emitted when trainee completes training."
  }

  event ComplianceReportGenerated is {
    report is ComplianceReport with { briefly "Report" described by "Generated report." }
    generatedAt is TimeStamp with { briefly "Generated" described by "Generation time." }
  } with {
    briefly "Report was generated"
    described by "Emitted when compliance report is created."
  }

  // State Records
  record DraftProgramData is {
    trainingId is TrainingId with { briefly "Training" described by "Training ID." }
    program is TrainingProgram with { briefly "Program" described by "Program details." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Draft program data"
    described by "State data for draft program."
  }

  record ActiveProgramData is {
    trainingId is TrainingId with { briefly "Training" described by "Training ID." }
    program is TrainingProgram with { briefly "Program" described by "Program details." }
    sessions is many TrainingSession with { briefly "Sessions" described by "Scheduled sessions." }
    registrations is many SessionRegistration with { briefly "Registrations" described by "Registrations." }
    records is many TrainingRecord with { briefly "Records" described by "Completion records." }
    activatedAt is TimeStamp with { briefly "Activated" described by "Activation time." }
  } with {
    briefly "Active program data"
    described by "State data for active program."
  }

  record RetiredProgramData is {
    trainingId is TrainingId with { briefly "Training" described by "Training ID." }
    program is TrainingProgram with { briefly "Program" described by "Program details." }
    reason is String(1, 500) with { briefly "Reason" described by "Retirement reason." }
    retiredAt is TimeStamp with { briefly "Retired" described by "Retirement time." }
  } with {
    briefly "Retired program data"
    described by "State data for retired program."
  }

  // States
  state DraftState of Training.DraftProgramData with {
    briefly "Program is draft"
    described by "Training program in development."
  }

  state ActiveState of Training.ActiveProgramData with {
    briefly "Program is active"
    described by "Training program is available."
  }

  state RetiredState of Training.RetiredProgramData with {
    briefly "Program is retired"
    described by "Training program is no longer available."
  }

  // Handler
  handler TrainingHandler is {
    on command CreateTrainingProgram {
      morph entity TrainingContext.Training to state TrainingContext.Training.DraftState with command CreateTrainingProgram
      tell event TrainingProgramCreated to entity TrainingContext.Training
    }

    on command UpdateTrainingProgram {
      tell event TrainingProgramUpdated to entity TrainingContext.Training
    }

    on command ActivateTrainingProgram {
      morph entity TrainingContext.Training to state TrainingContext.Training.ActiveState with command ActivateTrainingProgram
      tell event TrainingProgramActivated to entity TrainingContext.Training
    }

    on command RetireTrainingProgram {
      morph entity TrainingContext.Training to state TrainingContext.Training.RetiredState with command RetireTrainingProgram
      tell event TrainingProgramRetired to entity TrainingContext.Training
    }

    on command ScheduleSession {
      tell event SessionScheduled to entity TrainingContext.Training
    }

    on command CancelSession {
      tell event SessionCancelled to entity TrainingContext.Training
    }

    on command RegisterTrainee {
      tell event TraineeRegistered to entity TrainingContext.Training
    }

    on command CancelRegistration {
      tell event RegistrationCancelled to entity TrainingContext.Training
    }

    on command RecordAttendance {
      tell event AttendanceRecorded to entity TrainingContext.Training
    }

    on command CompleteSession {
      tell event SessionCompleted to entity TrainingContext.Training
    }

    on command RecordCompletion {
      tell event TrainingCompleted to entity TrainingContext.Training
    }

    on command GenerateComplianceReport {
      tell event ComplianceReportGenerated to entity TrainingContext.Training
    }
  } with {
    briefly "Processes training commands"
    described by {
      | Handles training lifecycle including program management,
      | session scheduling, registration, and compliance.
    }
  }

} with {
  briefly "Training aggregate"
  described by {
    | The Training entity manages corporate training programs
    | including sessions, registrations, and compliance tracking.
  }
}
