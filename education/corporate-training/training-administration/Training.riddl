// Training Administration - Training Entity
entity Training is {
  // Commands
  command CreateTrainingProgram is  {
    trainingId: TrainingId with {
      briefly "Training ID"
      described as {
        |New training identifier.
      }
    }
    program: TrainingProgram with {
      briefly "Program"
      described as {
        |Training program details.
      }
    }
  } with {
    briefly "Create program"
    described as {
      |Creates a new training program.
    }
  }
  command UpdateTrainingProgram is  {
    trainingId: TrainingId with {
      briefly "Training ID"
      described as {
        |Training to update.
      }
    }
    program: TrainingProgram with {
      briefly "Program"
      described as {
        |Updated details.
      }
    }
  } with {
    briefly "Update program"
    described as {
      |Updates training program.
    }
  }
  command ActivateTrainingProgram is  {
    trainingId: TrainingId with {
      briefly "Training ID"
      described as {
        |Training to activate.
      }
    }
  } with {
    briefly "Activate program"
    described as {
      |Makes training available for scheduling.
    }
  }
  command RetireTrainingProgram is  {
    trainingId: TrainingId with {
      briefly "Training ID"
      described as {
        |Training to retire.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Retirement reason.
      }
    }
  } with {
    briefly "Retire program"
    described as {
      |Retires training program.
    }
  }
  command ScheduleSession is  {
    session: TrainingSession with {
      briefly "Session"
      described as {
        |Session details.
      }
    }
  } with {
    briefly "Schedule session"
    described as {
      |Schedules new training session.
    }
  }
  command CancelSession is  {
    sessionId: SessionId with {
      briefly "Session ID"
      described as {
        |Session to cancel.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
  } with {
    briefly "Cancel session"
    described as {
      |Cancels scheduled session.
    }
  }
  command RegisterTrainee is  {
    sessionId: SessionId with {
      briefly "Session ID"
      described as {
        |Session ID.
      }
    }
    traineeId: TraineeId with {
      briefly "Trainee ID"
      described as {
        |Trainee to register.
      }
    }
  } with {
    briefly "Register trainee"
    described as {
      |Registers trainee for session.
    }
  }
  command CancelRegistration is  {
    registrationId: RegistrationId with {
      briefly "Registration ID"
      described as {
        |Registration to cancel.
      }
    }
    cancellationReason: String(1,500)? with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
  } with {
    briefly "Cancel registration"
    described as {
      |Cancels trainee registration.
    }
  }
  command RecordAttendance is  {
    sessionId: SessionId with {
      briefly "Session ID"
      described as {
        |Session ID.
      }
    }
    traineeId: TraineeId with {
      briefly "Trainee ID"
      described as {
        |Trainee ID.
      }
    }
    attended: Boolean with {
      briefly "Attended"
      described as {
        |Whether attended.
      }
    }
  } with {
    briefly "Record attendance"
    described as {
      |Records trainee attendance.
    }
  }
  command CompleteSession is  {
    sessionId: SessionId with {
      briefly "Session ID"
      described as {
        |Session to complete.
      }
    }
    notes: String(1,2000)? with {
      briefly "Notes"
      described as {
        |Session notes.
      }
    }
  } with {
    briefly "Complete session"
    described as {
      |Marks session as completed.
    }
  }
  command RecordCompletion is  {
    traineeId: TraineeId with {
      briefly "Trainee ID"
      described as {
        |Trainee ID.
      }
    }
    trainingId: TrainingId with {
      briefly "Training ID"
      described as {
        |Training ID.
      }
    }
    score: Decimal(5,2)? with {
      briefly "Score"
      described as {
        |Assessment score.
      }
    }
    passed: Boolean with {
      briefly "Passed"
      described as {
        |Whether passed.
      }
    }
  } with {
    briefly "Record completion"
    described as {
      |Records training completion.
    }
  }
  command GenerateComplianceReport is  {
    department: String(1,100) with {
      briefly "Department"
      described as {
        |Department to report.
      }
    }
    trainingId: TrainingId with {
      briefly "Training"
      described as {
        |Training program.
      }
    }
    asOfDate: Date with {
      briefly "As of"
      described as {
        |Report date.
      }
    }
  } with {
    briefly "Generate report"
    described as {
      |Generates compliance report.
    }
  }
  // Events
  event TrainingProgramCreated is  {
    trainingId: TrainingId with {
      briefly "Training"
      described as {
        |Training ID.
      }
    }
    program: TrainingProgram with {
      briefly "Program"
      described as {
        |Program details.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Program was created"
    described as {
      |Emitted when training is created.
    }
  }
  event TrainingProgramUpdated is  {
    trainingId: TrainingId with {
      briefly "Training"
      described as {
        |Training ID.
      }
    }
    program: TrainingProgram with {
      briefly "Program"
      described as {
        |Updated details.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Program was updated"
    described as {
      |Emitted when training is updated.
    }
  }
  event TrainingProgramActivated is  {
    trainingId: TrainingId with {
      briefly "Training"
      described as {
        |Training ID.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Program was activated"
    described as {
      |Emitted when training is activated.
    }
  }
  event TrainingProgramRetired is  {
    trainingId: TrainingId with {
      briefly "Training"
      described as {
        |Training ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Retirement reason.
      }
    }
    retiredAt: TimeStamp with {
      briefly "Retired"
      described as {
        |Retirement time.
      }
    }
  } with {
    briefly "Program was retired"
    described as {
      |Emitted when training is retired.
    }
  }
  event SessionScheduled is  {
    session: TrainingSession with {
      briefly "Session"
      described as {
        |Scheduled session.
      }
    }
    scheduledAt: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Schedule time.
      }
    }
  } with {
    briefly "Session was scheduled"
    described as {
      |Emitted when session is scheduled.
    }
  }
  event SessionCancelled is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Cancel reason.
      }
    }
    cancelledAt: TimeStamp with {
      briefly "Cancelled"
      described as {
        |Cancel time.
      }
    }
  } with {
    briefly "Session was cancelled"
    described as {
      |Emitted when session is cancelled.
    }
  }
  event TraineeRegistered is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    traineeId: TraineeId with {
      briefly "Trainee"
      described as {
        |Trainee ID.
      }
    }
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Trainee was registered"
    described as {
      |Emitted when trainee registers.
    }
  }
  event RegistrationCancelled is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    cancelledAt: TimeStamp with {
      briefly "Cancelled"
      described as {
        |Cancel time.
      }
    }
  } with {
    briefly "Registration was cancelled"
    described as {
      |Emitted when registration is cancelled.
    }
  }
  event AttendanceRecorded is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    traineeId: TraineeId with {
      briefly "Trainee"
      described as {
        |Trainee ID.
      }
    }
    attended: Boolean with {
      briefly "Attended"
      described as {
        |Attendance status.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Attendance was recorded"
    described as {
      |Emitted when attendance is marked.
    }
  }
  event SessionCompleted is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Session was completed"
    described as {
      |Emitted when session ends.
    }
  }
  event TrainingCompleted is  {
    traineeId: TraineeId with {
      briefly "Trainee"
      described as {
        |Trainee ID.
      }
    }
    trainingId: TrainingId with {
      briefly "Training"
      described as {
        |Training ID.
      }
    }
    passed: Boolean with {
      briefly "Passed"
      described as {
        |Pass status.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Training was completed"
    described as {
      |Emitted when trainee completes training.
    }
  }
  event ComplianceReportGenerated is  {
    report: ComplianceReport with {
      briefly "Report"
      described as {
        |Generated report.
      }
    }
    generatedAt: TimeStamp with {
      briefly "Generated"
      described as {
        |Generation time.
      }
    }
  } with {
    briefly "Report was generated"
    described as {
      |Emitted when compliance report is created.
    }
  }
  // State Records
  record DraftProgramData is  {
    trainingId: TrainingId with {
      briefly "Training"
      described as {
        |Training ID.
      }
    }
    program: TrainingProgram with {
      briefly "Program"
      described as {
        |Program details.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Draft program data"
    described as {
      |State data for draft program.
    }
  }
  record ActiveProgramData is  {
    trainingId: TrainingId with {
      briefly "Training"
      described as {
        |Training ID.
      }
    }
    program: TrainingProgram with {
      briefly "Program"
      described as {
        |Program details.
      }
    }
    sessions: TrainingSession+ with {
      briefly "Sessions"
      described as {
        |Scheduled sessions.
      }
    }
    registrations: SessionRegistration+ with {
      briefly "Registrations"
      described as {
        |Registrations.
      }
    }
    records: TrainingRecord+ with {
      briefly "Records"
      described as {
        |Completion records.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Active program data"
    described as {
      |State data for active program.
    }
  }
  record RetiredProgramData is  {
    trainingId: TrainingId with {
      briefly "Training"
      described as {
        |Training ID.
      }
    }
    program: TrainingProgram with {
      briefly "Program"
      described as {
        |Program details.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Retirement reason.
      }
    }
    retiredAt: TimeStamp with {
      briefly "Retired"
      described as {
        |Retirement time.
      }
    }
  } with {
    briefly "Retired program data"
    described as {
      |State data for retired program.
    }
  }
  // States
  state DraftState of type Training.DraftProgramData
  state ActiveState of type Training.ActiveProgramData
  state RetiredState of type Training.RetiredProgramData
  // Handler
  handler TrainingHandler is {
    on command CreateTrainingProgram is {
      morph entity TrainingContext.Training to state TrainingContext.Training.DraftState with command CreateTrainingProgram
      tell event TrainingProgramCreated to entity TrainingContext.Training
    }
    on command UpdateTrainingProgram is {
      tell event TrainingProgramUpdated to entity TrainingContext.Training
    }
    on command ActivateTrainingProgram is {
      morph entity TrainingContext.Training to state TrainingContext.Training.ActiveState with command ActivateTrainingProgram
      tell event TrainingProgramActivated to entity TrainingContext.Training
    }
    on command RetireTrainingProgram is {
      morph entity TrainingContext.Training to state TrainingContext.Training.RetiredState with command RetireTrainingProgram
      tell event TrainingProgramRetired to entity TrainingContext.Training
    }
    on command ScheduleSession is {
      tell event SessionScheduled to entity TrainingContext.Training
    }
    on command CancelSession is {
      tell event SessionCancelled to entity TrainingContext.Training
    }
    on command RegisterTrainee is {
      tell event TraineeRegistered to entity TrainingContext.Training
    }
    on command CancelRegistration is {
      tell event RegistrationCancelled to entity TrainingContext.Training
    }
    on command RecordAttendance is {
      tell event AttendanceRecorded to entity TrainingContext.Training
    }
    on command CompleteSession is {
      tell event SessionCompleted to entity TrainingContext.Training
    }
    on command RecordCompletion is {
      tell event TrainingCompleted to entity TrainingContext.Training
    }
    on command GenerateComplianceReport is {
      tell event ComplianceReportGenerated to entity TrainingContext.Training
    }
  } with {
    briefly "Processes training commands"
    described as {
      | Handles training lifecycle including program management,
      | session scheduling, registration, and compliance.
    }
  }
} with {
  briefly "Training aggregate"
  described as {
    | The Training entity manages corporate training programs
    | including sessions, registrations, and compliance tracking.
  }
}
