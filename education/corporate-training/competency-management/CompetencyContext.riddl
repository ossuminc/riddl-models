// Competency Management - Competency Context
context CompetencyContext is {
  include "types.riddl"
  include "Competency.riddl"
  // Repository for competency persistence
  repository CompetencyRepository is {
    schema CompetencyData is relational
      of competencies as type Competency
        index on field Competency.competencyId
        index on field Competency.definition.category

    handler CompetencyPersistence is {
      on command Competency.CreateCompetency is {
        prompt "Store competency definition"
      }
      on command Competency.UpdateCompetency is {
        prompt "Update competency definition"
      }
      on command Competency.CreateFramework is {
        prompt "Store framework"
      }
      on command Competency.AssignCompetency is {
        prompt "Store employee assignment"
      }
      on command Competency.RecordAssessment is {
        prompt "Store assessment record"
      }
      on command Competency.CreateDevelopmentPlan is {
        prompt "Store development plan"
      }
      on command Competency.CompleteDevelopmentActivity is {
        prompt "Update activity status"
      }
      on command Competency.UpdateCompetencyLevel is {
        prompt "Update employee level"
      }
      on command Competency.IdentifySkillGaps is {
        prompt "Store gap analysis"
      }
    } with {
      briefly "Persists competency commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Competency data persistence"
    described as {
      | The CompetencyRepository provides persistent storage for
      | competencies, assessments, and development plans.
    }
  }
  // Projector for competency analytics
  projector CompetencyAnalytics is {
    record CompetencyStats is  {
      competencyId: CompetencyId with {
        briefly "Competency"
        described as {
          |Competency ID.
        }
      }
      employeeCount: Natural with {
        briefly "Employees"
        described as {
          |Employees with competency.
        }
      }
      averageLevel: Decimal(3,2) with {
        briefly "Avg level"
        described as {
          |Average proficiency.
        }
      }
      gapCount: Natural with {
        briefly "Gaps"
        described as {
          |Employees with gaps.
        }
      }
    } with {
      briefly "Competency statistics"
      described as {
        |Competency metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Competency.CompetencyAssigned is {
        prompt "Update employee counts"
      }
      on event Competency.AssessmentRecorded is {
        prompt "Update assessment metrics"
      }
      on event Competency.CompetencyLevelUpdated is {
        prompt "Update level metrics"
      }
      on event Competency.SkillGapsIdentified is {
        prompt "Update gap metrics"
      }
    } with {
      briefly "Maintains competency analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Competency analytics projections"
    described as {
      |Maintains competency analytics data.
    }
  }
} with {
  briefly "Bounded context for competency management"
  described as {
    | The CompetencyContext is the bounded context for employee
    | skills, competency frameworks, and development tracking.
  }
}
