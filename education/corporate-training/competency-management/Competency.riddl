// Competency Management - Competency Entity

entity Competency is {

  // Commands
  command CreateCompetency is {
    competencyId is CompetencyId with {
      briefly "Competency ID"
      described by "New competency identifier."
    }
    definition is CompetencyDefinition with {
      briefly "Definition"
      described by "Competency definition."
    }
  } with {
    briefly "Create competency"
    described by "Creates a new competency definition."
  }

  command UpdateCompetency is {
    competencyId is CompetencyId with {
      briefly "Competency ID"
      described by "Competency to update."
    }
    definition is CompetencyDefinition with {
      briefly "Definition"
      described by "Updated definition."
    }
  } with {
    briefly "Update competency"
    described by "Updates competency definition."
  }

  command CreateFramework is {
    framework is CompetencyFramework with {
      briefly "Framework"
      described by "Framework to create."
    }
  } with {
    briefly "Create framework"
    described by "Creates competency framework."
  }

  command AssignCompetency is {
    employeeId is EmployeeId with {
      briefly "Employee"
      described by "Employee ID."
    }
    competencyId is CompetencyId with {
      briefly "Competency"
      described by "Competency ID."
    }
    targetLevel is CompetencyLevel with {
      briefly "Target"
      described by "Target level."
    }
  } with {
    briefly "Assign competency"
    described by "Assigns competency requirement to employee."
  }

  command RecordAssessment is {
    assessment is CompetencyAssessment with {
      briefly "Assessment"
      described by "Assessment details."
    }
  } with {
    briefly "Record assessment"
    described by "Records competency assessment."
  }

  command UpdateAssessmentStatus is {
    assessmentId is AssessmentId with {
      briefly "Assessment ID"
      described by "Assessment to update."
    }
    status is AssessmentStatus with {
      briefly "Status"
      described by "New status."
    }
  } with {
    briefly "Update assessment"
    described by "Updates assessment status."
  }

  command CreateDevelopmentPlan is {
    plan is DevelopmentPlan with {
      briefly "Plan"
      described by "Development plan."
    }
  } with {
    briefly "Create plan"
    described by "Creates development plan."
  }

  command AddDevelopmentActivity is {
    planId is DevelopmentPlanId with {
      briefly "Plan ID"
      described by "Plan ID."
    }
    activity is DevelopmentActivity with {
      briefly "Activity"
      described by "Activity to add."
    }
  } with {
    briefly "Add activity"
    described by "Adds development activity."
  }

  command CompleteDevelopmentActivity is {
    planId is DevelopmentPlanId with {
      briefly "Plan ID"
      described by "Plan ID."
    }
    activityId is UUID with {
      briefly "Activity ID"
      described by "Activity to complete."
    }
    outcome is optional String(1, 1000) with {
      briefly "Outcome"
      described by "Activity outcome."
    }
  } with {
    briefly "Complete activity"
    described by "Marks activity as completed."
  }

  command UpdateCompetencyLevel is {
    employeeId is EmployeeId with {
      briefly "Employee"
      described by "Employee ID."
    }
    competencyId is CompetencyId with {
      briefly "Competency"
      described by "Competency ID."
    }
    newLevel is CompetencyLevel with {
      briefly "Level"
      described by "New proficiency level."
    }
    evidence is String(1, 1000) with {
      briefly "Evidence"
      described by "Supporting evidence."
    }
  } with {
    briefly "Update level"
    described by "Updates employee competency level."
  }

  command IdentifySkillGaps is {
    employeeId is EmployeeId with {
      briefly "Employee"
      described by "Employee ID."
    }
    frameworkId is FrameworkId with {
      briefly "Framework"
      described by "Reference framework."
    }
  } with {
    briefly "Identify gaps"
    described by "Identifies competency gaps."
  }

  // Events
  event CompetencyCreated is {
    competencyId is CompetencyId with { briefly "Competency" described by "Competency ID." }
    definition is CompetencyDefinition with { briefly "Definition" described by "Competency definition." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Competency was created"
    described by "Emitted when competency is defined."
  }

  event CompetencyUpdated is {
    competencyId is CompetencyId with { briefly "Competency" described by "Competency ID." }
    definition is CompetencyDefinition with { briefly "Definition" described by "Updated definition." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Competency was updated"
    described by "Emitted when competency is updated."
  }

  event FrameworkCreated is {
    framework is CompetencyFramework with { briefly "Framework" described by "Created framework." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Framework was created"
    described by "Emitted when framework is created."
  }

  event CompetencyAssigned is {
    employeeId is EmployeeId with { briefly "Employee" described by "Employee ID." }
    competencyId is CompetencyId with { briefly "Competency" described by "Competency ID." }
    targetLevel is CompetencyLevel with { briefly "Target" described by "Target level." }
    assignedAt is TimeStamp with { briefly "Assigned" described by "Assignment time." }
  } with {
    briefly "Competency was assigned"
    described by "Emitted when competency is assigned."
  }

  event AssessmentRecorded is {
    assessment is CompetencyAssessment with { briefly "Assessment" described by "Assessment details." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Assessment was recorded"
    described by "Emitted when assessment is completed."
  }

  event AssessmentStatusUpdated is {
    assessmentId is AssessmentId with { briefly "Assessment" described by "Assessment ID." }
    status is AssessmentStatus with { briefly "Status" described by "New status." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Assessment status was updated"
    described by "Emitted when assessment status changes."
  }

  event DevelopmentPlanCreated is {
    plan is DevelopmentPlan with { briefly "Plan" described by "Created plan." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Plan was created"
    described by "Emitted when plan is created."
  }

  event DevelopmentActivityAdded is {
    planId is DevelopmentPlanId with { briefly "Plan" described by "Plan ID." }
    activity is DevelopmentActivity with { briefly "Activity" described by "Added activity." }
    addedAt is TimeStamp with { briefly "Added" described by "Add time." }
  } with {
    briefly "Activity was added"
    described by "Emitted when activity is added."
  }

  event DevelopmentActivityCompleted is {
    planId is DevelopmentPlanId with { briefly "Plan" described by "Plan ID." }
    activityId is UUID with { briefly "Activity" described by "Activity ID." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Activity was completed"
    described by "Emitted when activity is completed."
  }

  event CompetencyLevelUpdated is {
    employeeId is EmployeeId with { briefly "Employee" described by "Employee ID." }
    competencyId is CompetencyId with { briefly "Competency" described by "Competency ID." }
    newLevel is CompetencyLevel with { briefly "Level" described by "New level." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Level was updated"
    described by "Emitted when level changes."
  }

  event SkillGapsIdentified is {
    employeeId is EmployeeId with { briefly "Employee" described by "Employee ID." }
    gaps is many SkillGap with { briefly "Gaps" described by "Identified gaps." }
    identifiedAt is TimeStamp with { briefly "Identified" described by "Identification time." }
  } with {
    briefly "Gaps were identified"
    described by "Emitted when gaps are analyzed."
  }

  // State Records
  record CompetencyLibraryData is {
    competencyDefinitions is many CompetencyDefinition with { briefly "Competencies" described by "All competencies." }
    frameworks is many CompetencyFramework with { briefly "Frameworks" described by "All frameworks." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Competency library data"
    described by "State data for competency library."
  }

  record EmployeeCompetencyData is {
    employeeId is EmployeeId with { briefly "Employee" described by "Employee ID." }
    employeeCompetencies is many EmployeeCompetency with { briefly "Competencies" described by "Employee competencies." }
    assessments is many CompetencyAssessment with { briefly "Assessments" described by "Assessment history." }
    developmentPlans is many DevelopmentPlan with { briefly "Plans" described by "Development plans." }
    gaps is many SkillGap with { briefly "Gaps" described by "Current gaps." }
  } with {
    briefly "Employee competency data"
    described by "State data for employee competencies."
  }

  // States
  state LibraryState of Competency.CompetencyLibraryData with {
    briefly "Competency library"
    described by "Organizational competency library."
  }

  state EmployeeState of Competency.EmployeeCompetencyData with {
    briefly "Employee competencies"
    described by "Individual employee competency profile."
  }

  // Handler
  handler CompetencyHandler is {
    on command CreateCompetency {
      morph entity CompetencyContext.Competency to state CompetencyContext.Competency.LibraryState with command CreateCompetency
      tell event CompetencyCreated to entity CompetencyContext.Competency
    }

    on command UpdateCompetency {
      tell event CompetencyUpdated to entity CompetencyContext.Competency
    }

    on command CreateFramework {
      tell event FrameworkCreated to entity CompetencyContext.Competency
    }

    on command AssignCompetency {
      tell event CompetencyAssigned to entity CompetencyContext.Competency
    }

    on command RecordAssessment {
      tell event AssessmentRecorded to entity CompetencyContext.Competency
    }

    on command UpdateAssessmentStatus {
      tell event AssessmentStatusUpdated to entity CompetencyContext.Competency
    }

    on command CreateDevelopmentPlan {
      tell event DevelopmentPlanCreated to entity CompetencyContext.Competency
    }

    on command AddDevelopmentActivity {
      tell event DevelopmentActivityAdded to entity CompetencyContext.Competency
    }

    on command CompleteDevelopmentActivity {
      tell event DevelopmentActivityCompleted to entity CompetencyContext.Competency
    }

    on command UpdateCompetencyLevel {
      tell event CompetencyLevelUpdated to entity CompetencyContext.Competency
    }

    on command IdentifySkillGaps {
      tell event SkillGapsIdentified to entity CompetencyContext.Competency
    }
  } with {
    briefly "Processes competency commands"
    described by {
      | Handles competency lifecycle including definition,
      | assessment, development planning, and gap analysis.
    }
  }

} with {
  briefly "Competency aggregate"
  described by {
    | The Competency entity manages competency definitions,
    | employee skills, assessments, and development plans.
  }
}
