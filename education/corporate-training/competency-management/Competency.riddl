// Competency Management - Competency Entity
entity Competency is {
  // Commands
  command CreateCompetency is  {
    competencyId: CompetencyId with {
      briefly "Competency ID"
      described as {
        |New competency identifier.
      }
    }
    definition: CompetencyDefinition with {
      briefly "Definition"
      described as {
        |Competency definition.
      }
    }
  } with {
    briefly "Create competency"
    described as {
      |Creates a new competency definition.
    }
  }
  command UpdateCompetency is  {
    competencyId: CompetencyId with {
      briefly "Competency ID"
      described as {
        |Competency to update.
      }
    }
    definition: CompetencyDefinition with {
      briefly "Definition"
      described as {
        |Updated definition.
      }
    }
  } with {
    briefly "Update competency"
    described as {
      |Updates competency definition.
    }
  }
  command CreateFramework is  {
    framework: CompetencyFramework with {
      briefly "Framework"
      described as {
        |Framework to create.
      }
    }
  } with {
    briefly "Create framework"
    described as {
      |Creates competency framework.
    }
  }
  command AssignCompetency is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    competencyId: CompetencyId with {
      briefly "Competency"
      described as {
        |Competency ID.
      }
    }
    targetLevel: CompetencyLevel with {
      briefly "Target"
      described as {
        |Target level.
      }
    }
  } with {
    briefly "Assign competency"
    described as {
      |Assigns competency requirement to employee.
    }
  }
  command RecordAssessment is  {
    assessment: CompetencyAssessment with {
      briefly "Assessment"
      described as {
        |Assessment details.
      }
    }
  } with {
    briefly "Record assessment"
    described as {
      |Records competency assessment.
    }
  }
  command UpdateAssessmentStatus is  {
    assessmentId: AssessmentId with {
      briefly "Assessment ID"
      described as {
        |Assessment to update.
      }
    }
    status: AssessmentStatus with {
      briefly "Status"
      described as {
        |New status.
      }
    }
  } with {
    briefly "Update assessment"
    described as {
      |Updates assessment status.
    }
  }
  command CreateDevelopmentPlan is  {
    plan: DevelopmentPlan with {
      briefly "Plan"
      described as {
        |Development plan.
      }
    }
  } with {
    briefly "Create plan"
    described as {
      |Creates development plan.
    }
  }
  command AddDevelopmentActivity is  {
    planId: DevelopmentPlanId with {
      briefly "Plan ID"
      described as {
        |Plan ID.
      }
    }
    activity: DevelopmentActivity with {
      briefly "Activity"
      described as {
        |Activity to add.
      }
    }
  } with {
    briefly "Add activity"
    described as {
      |Adds development activity.
    }
  }
  command CompleteDevelopmentActivity is  {
    planId: DevelopmentPlanId with {
      briefly "Plan ID"
      described as {
        |Plan ID.
      }
    }
    activityId: UUID with {
      briefly "Activity ID"
      described as {
        |Activity to complete.
      }
    }
    outcome: String(1,1000)? with {
      briefly "Outcome"
      described as {
        |Activity outcome.
      }
    }
  } with {
    briefly "Complete activity"
    described as {
      |Marks activity as completed.
    }
  }
  command UpdateCompetencyLevel is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    competencyId: CompetencyId with {
      briefly "Competency"
      described as {
        |Competency ID.
      }
    }
    newLevel: CompetencyLevel with {
      briefly "Level"
      described as {
        |New proficiency level.
      }
    }
    evidence: String(1,1000) with {
      briefly "Evidence"
      described as {
        |Supporting evidence.
      }
    }
  } with {
    briefly "Update level"
    described as {
      |Updates employee competency level.
    }
  }
  command IdentifySkillGaps is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    frameworkId: FrameworkId with {
      briefly "Framework"
      described as {
        |Reference framework.
      }
    }
  } with {
    briefly "Identify gaps"
    described as {
      |Identifies competency gaps.
    }
  }
  // Events
  event CompetencyCreated is  {
    competencyId: CompetencyId with {
      briefly "Competency"
      described as {
        |Competency ID.
      }
    }
    definition: CompetencyDefinition with {
      briefly "Definition"
      described as {
        |Competency definition.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Competency was created"
    described as {
      |Emitted when competency is defined.
    }
  }
  event CompetencyUpdated is  {
    competencyId: CompetencyId with {
      briefly "Competency"
      described as {
        |Competency ID.
      }
    }
    definition: CompetencyDefinition with {
      briefly "Definition"
      described as {
        |Updated definition.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Competency was updated"
    described as {
      |Emitted when competency is updated.
    }
  }
  event FrameworkCreated is  {
    framework: CompetencyFramework with {
      briefly "Framework"
      described as {
        |Created framework.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Framework was created"
    described as {
      |Emitted when framework is created.
    }
  }
  event CompetencyAssigned is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    competencyId: CompetencyId with {
      briefly "Competency"
      described as {
        |Competency ID.
      }
    }
    targetLevel: CompetencyLevel with {
      briefly "Target"
      described as {
        |Target level.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Competency was assigned"
    described as {
      |Emitted when competency is assigned.
    }
  }
  event AssessmentRecorded is  {
    assessment: CompetencyAssessment with {
      briefly "Assessment"
      described as {
        |Assessment details.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Assessment was recorded"
    described as {
      |Emitted when assessment is completed.
    }
  }
  event AssessmentStatusUpdated is  {
    assessmentId: AssessmentId with {
      briefly "Assessment"
      described as {
        |Assessment ID.
      }
    }
    status: AssessmentStatus with {
      briefly "Status"
      described as {
        |New status.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Assessment status was updated"
    described as {
      |Emitted when assessment status changes.
    }
  }
  event DevelopmentPlanCreated is  {
    plan: DevelopmentPlan with {
      briefly "Plan"
      described as {
        |Created plan.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Plan was created"
    described as {
      |Emitted when plan is created.
    }
  }
  event DevelopmentActivityAdded is  {
    planId: DevelopmentPlanId with {
      briefly "Plan"
      described as {
        |Plan ID.
      }
    }
    activity: DevelopmentActivity with {
      briefly "Activity"
      described as {
        |Added activity.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Activity was added"
    described as {
      |Emitted when activity is added.
    }
  }
  event DevelopmentActivityCompleted is  {
    planId: DevelopmentPlanId with {
      briefly "Plan"
      described as {
        |Plan ID.
      }
    }
    activityId: UUID with {
      briefly "Activity"
      described as {
        |Activity ID.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Activity was completed"
    described as {
      |Emitted when activity is completed.
    }
  }
  event CompetencyLevelUpdated is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    competencyId: CompetencyId with {
      briefly "Competency"
      described as {
        |Competency ID.
      }
    }
    newLevel: CompetencyLevel with {
      briefly "Level"
      described as {
        |New level.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Level was updated"
    described as {
      |Emitted when level changes.
    }
  }
  event SkillGapsIdentified is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    gaps: SkillGap+ with {
      briefly "Gaps"
      described as {
        |Identified gaps.
      }
    }
    identifiedAt: TimeStamp with {
      briefly "Identified"
      described as {
        |Identification time.
      }
    }
  } with {
    briefly "Gaps were identified"
    described as {
      |Emitted when gaps are analyzed.
    }
  }
  // State Records
  record CompetencyLibraryData is  {
    competencyDefinitions: CompetencyDefinition+ with {
      briefly "Competencies"
      described as {
        |All competencies.
      }
    }
    frameworks: CompetencyFramework+ with {
      briefly "Frameworks"
      described as {
        |All frameworks.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Competency library data"
    described as {
      |State data for competency library.
    }
  }
  record EmployeeCompetencyData is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    employeeCompetencies: EmployeeCompetency+ with {
      briefly "Competencies"
      described as {
        |Employee competencies.
      }
    }
    assessments: CompetencyAssessment+ with {
      briefly "Assessments"
      described as {
        |Assessment history.
      }
    }
    developmentPlans: DevelopmentPlan+ with {
      briefly "Plans"
      described as {
        |Development plans.
      }
    }
    gaps: SkillGap+ with {
      briefly "Gaps"
      described as {
        |Current gaps.
      }
    }
  } with {
    briefly "Employee competency data"
    described as {
      |State data for employee competencies.
    }
  }
  // States
  state LibraryState of type Competency.CompetencyLibraryData
  state EmployeeState of type Competency.EmployeeCompetencyData
  // Handler
  handler CompetencyHandler is {
    on command CreateCompetency is {
      morph entity CompetencyContext.Competency to state CompetencyContext.Competency.LibraryState with command CreateCompetency
      tell event CompetencyCreated to entity CompetencyContext.Competency
    }
    on command UpdateCompetency is {
      tell event CompetencyUpdated to entity CompetencyContext.Competency
    }
    on command CreateFramework is {
      tell event FrameworkCreated to entity CompetencyContext.Competency
    }
    on command AssignCompetency is {
      tell event CompetencyAssigned to entity CompetencyContext.Competency
    }
    on command RecordAssessment is {
      tell event AssessmentRecorded to entity CompetencyContext.Competency
    }
    on command UpdateAssessmentStatus is {
      tell event AssessmentStatusUpdated to entity CompetencyContext.Competency
    }
    on command CreateDevelopmentPlan is {
      tell event DevelopmentPlanCreated to entity CompetencyContext.Competency
    }
    on command AddDevelopmentActivity is {
      tell event DevelopmentActivityAdded to entity CompetencyContext.Competency
    }
    on command CompleteDevelopmentActivity is {
      tell event DevelopmentActivityCompleted to entity CompetencyContext.Competency
    }
    on command UpdateCompetencyLevel is {
      tell event CompetencyLevelUpdated to entity CompetencyContext.Competency
    }
    on command IdentifySkillGaps is {
      tell event SkillGapsIdentified to entity CompetencyContext.Competency
    }
  } with {
    briefly "Processes competency commands"
    described as {
      | Handles competency lifecycle including definition,
      | assessment, development planning, and gap analysis.
    }
  }
} with {
  briefly "Competency aggregate"
  described as {
    | The Competency entity manages competency definitions,
    | employee skills, assessments, and development plans.
  }
}
