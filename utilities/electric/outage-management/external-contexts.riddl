// Outage Management - External Contexts
context SCADASystem is {
  event OutageDetected is  {
    feederId: FeederId with {
      briefly "Feeder"
      described as {
        |Feeder ID.
      }
    }
    location: String(1,300) with {
      briefly "Location"
      described as {
        |Outage location.
      }
    }
    detectedAt: TimeStamp with {
      briefly "Detected"
      described as {
        |Detection time.
      }
    }
    severity: String(1,50) with {
      briefly "Severity"
      described as {
        |Outage severity.
      }
    }
  } with {
    briefly "Outage detected"
    described as {
      |Emitted when SCADA detects a power outage.
    }
  }
  query GetFeederStatus is  {
    feederId: FeederId with {
      briefly "Feeder"
      described as {
        |Feeder ID.
      }
    }
  } with {
    briefly "Get feeder status"
    described as {
      |Gets current feeder circuit status.
    }
  }
  result FeederStatus is  {
    feederId: FeederId with {
      briefly "Feeder"
      described as {
        |Feeder ID.
      }
    }
    feederStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Feeder status.
      }
    }
    voltage: Decimal(8,2) with {
      briefly "Voltage"
      described as {
        |Current voltage reading.
      }
    }
    lastReading: TimeStamp with {
      briefly "Reading"
      described as {
        |Last reading time.
      }
    }
  } with {
    briefly "Feeder status"
    described as {
      |Current feeder circuit status.
    }
  }
  command IsolateFeeder is  {
    feederId: FeederId with {
      briefly "Feeder"
      described as {
        |Feeder ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Isolation reason.
      }
    }
  } with {
    briefly "Isolate feeder"
    described as {
      |Isolates a feeder circuit for safety.
    }
  }
  event FeederIsolated is  {
    feederId: FeederId with {
      briefly "Feeder"
      described as {
        |Feeder ID.
      }
    }
    isolatedAt: TimeStamp with {
      briefly "Isolated"
      described as {
        |Isolation time.
      }
    }
  } with {
    briefly "Feeder isolated"
    described as {
      |Emitted when a feeder is isolated.
    }
  }
} with {
  option external()
  briefly "External SCADA system"
  described as {
    |Supervisory control and data acquisition system for grid monitoring.
  }
}
context CrewDispatchSystem is {
  query GetAvailableCrews is  {
    location: String(1,300) with {
      briefly "Location"
      described as {
        |Outage location.
      }
    }
    priority: OutagePriority with {
      briefly "Priority"
      described as {
        |Outage priority.
      }
    }
  } with {
    briefly "Get available crews"
    described as {
      |Finds available crews near a location.
    }
  }
  result AvailableCrews is  {
    crews: CrewAssignment+ with {
      briefly "Crews"
      described as {
        |Available crews.
      }
    }
    estimatedArrival: Decimal(8,2) with {
      briefly "ETA"
      described as {
        |Estimated arrival in minutes.
      }
    }
  } with {
    briefly "Available crews"
    described as {
      |Crews available for dispatch.
    }
  }
  command AssignCrew is  {
    outageId: OutageEventId with {
      briefly "Outage"
      described as {
        |Outage ID.
      }
    }
    crewId: CrewId with {
      briefly "Crew"
      described as {
        |Crew ID.
      }
    }
    location: String(1,300) with {
      briefly "Location"
      described as {
        |Dispatch location.
      }
    }
  } with {
    briefly "Assign crew"
    described as {
      |Assigns a crew to an outage event.
    }
  }
  event CrewAssigned is  {
    outageId: OutageEventId with {
      briefly "Outage"
      described as {
        |Outage ID.
      }
    }
    crewId: CrewId with {
      briefly "Crew"
      described as {
        |Crew ID.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Crew assigned"
    described as {
      |Emitted when a crew is assigned to an outage.
    }
  }
  command ReleaseCrew is  {
    crewId: CrewId with {
      briefly "Crew"
      described as {
        |Crew ID.
      }
    }
    outageId: OutageEventId with {
      briefly "Outage"
      described as {
        |Outage ID.
      }
    }
  } with {
    briefly "Release crew"
    described as {
      |Releases a crew from an outage assignment.
    }
  }
  event CrewReleased is  {
    crewId: CrewId with {
      briefly "Crew"
      described as {
        |Crew ID.
      }
    }
    releasedAt: TimeStamp with {
      briefly "Released"
      described as {
        |Release time.
      }
    }
  } with {
    briefly "Crew released"
    described as {
      |Emitted when a crew is released from assignment.
    }
  }
} with {
  option external()
  briefly "External crew dispatch system"
  described as {
    |Field crew management and dispatch system.
  }
}
