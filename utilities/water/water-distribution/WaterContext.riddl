// Water Distribution - Water Context

context WaterContext is {

  include "types.riddl"
  include "DistributionZone.riddl"

  repository WaterRepository is {
    schema WaterData is relational
      of distributionZones as DistributionZone
      index on field DistributionZone.zoneId
      index on field DistributionZone.status
      index on field DistributionZone.qualityStatus

    handler WaterPersistence is {
      on command DistributionZone.CreateZone {
        prompt "Store new distribution zone"
      }
      on command DistributionZone.RecordPressure {
        prompt "Store pressure reading"
      }
      on command DistributionZone.SubmitQualitySample {
        prompt "Store quality sample"
      }
      on command DistributionZone.ReportLeak {
        prompt "Store leak report"
      }
      on command DistributionZone.IssueBoilWaterAdvisory {
        prompt "Update zone status to advisory"
      }
      on command DistributionZone.LiftBoilWaterAdvisory {
        prompt "Update zone status to normal"
      }
    } with {
      briefly "Persists water commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Water data persistence"
    described by "Persistent storage for water operations."
  }

  projector WaterQualityAnalytics is {
    updates repository WaterRepository

    record ComplianceMetrics is {
      samplesTaken is Natural with { briefly "Samples" described by "Total samples." }
      compliantSamples is Natural with { briefly "Compliant" described by "Compliant samples." }
      complianceRate is Decimal(5, 2) with { briefly "Rate" described by "Compliance rate." }
      violationCount is Natural with { briefly "Violations" described by "Violation count." }
    } with {
      briefly "Compliance metrics"
      described by "Water quality compliance."
    }

    record SystemPerformance is {
      averagePressurePSI is Decimal(6, 2) with { briefly "Avg pressure" described by "Average pressure." }
      leaksReported is Natural with { briefly "Leaks" described by "Leaks reported." }
      waterLossPercent is Decimal(5, 2) with { briefly "Loss" described by "Water loss percentage." }
    } with {
      briefly "System performance"
      described by "System performance metrics."
    }

    handler AnalyticsHandler is {
      on event DistributionZone.QualitySampleSubmitted {
        prompt "Update compliance metrics"
      }
      on event DistributionZone.PressureRecorded {
        prompt "Update pressure analytics"
      }
      on event DistributionZone.LeakReported {
        prompt "Update leak metrics"
      }
    } with {
      briefly "Maintains water analytics"
      described by "Projects events into analytics."
    }
  } with {
    briefly "Water quality analytics"
    described by "Water system analytics."
  }

} with {
  briefly "Bounded context for water distribution"
  described by "Water distribution management context."
}
