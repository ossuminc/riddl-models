// Water Distribution - DistributionZone Entity
entity DistributionZone is {
  command CreateZone is  {
    zoneId: DistributionZoneId with {
      briefly "Zone ID"
      described as {
        |New zone identifier.
      }
    }
    name: String(1,100) with {
      briefly "Name"
      described as {
        |Zone name.
      }
    }
    serviceArea: String(1,200) with {
      briefly "Service area"
      described as {
        |Geographic service area.
      }
    }
    customerCount: Natural with {
      briefly "Customers"
      described as {
        |Customer count.
      }
    }
  } with {
    briefly "Create zone"
    described as {
      |Creates a distribution zone.
    }
  }
  command RecordPressure is  {
    zoneId: DistributionZoneId with {
      briefly "Zone ID"
      described as {
        |Zone identifier.
      }
    }
    reading: PressureReading with {
      briefly "Reading"
      described as {
        |Pressure reading.
      }
    }
  } with {
    briefly "Record pressure"
    described as {
      |Records pressure reading.
    }
  }
  command SubmitQualitySample is  {
    zoneId: DistributionZoneId with {
      briefly "Zone ID"
      described as {
        |Zone identifier.
      }
    }
    sample: WaterQualitySample with {
      briefly "Sample"
      described as {
        |Quality sample.
      }
    }
  } with {
    briefly "Submit quality sample"
    described as {
      |Submits water quality sample.
    }
  }
  command ReportLeak is  {
    zoneId: DistributionZoneId with {
      briefly "Zone ID"
      described as {
        |Zone identifier.
      }
    }
    leak: LeakReport with {
      briefly "Leak"
      described as {
        |Leak report.
      }
    }
  } with {
    briefly "Report leak"
    described as {
      |Reports water main leak.
    }
  }
  command ScheduleMaintenance is  {
    zoneId: DistributionZoneId with {
      briefly "Zone ID"
      described as {
        |Zone identifier.
      }
    }
    work: MaintenanceWork with {
      briefly "Work"
      described as {
        |Maintenance work.
      }
    }
  } with {
    briefly "Schedule maintenance"
    described as {
      |Schedules maintenance work.
    }
  }
  command IssueBoilWaterAdvisory is  {
    zoneId: DistributionZoneId with {
      briefly "Zone ID"
      described as {
        |Zone identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Advisory reason.
      }
    }
    affectedArea: String(1,200) with {
      briefly "Area"
      described as {
        |Affected area.
      }
    }
  } with {
    briefly "Issue boil water advisory"
    described as {
      |Issues boil water advisory.
    }
  }
  command LiftBoilWaterAdvisory is  {
    zoneId: DistributionZoneId with {
      briefly "Zone ID"
      described as {
        |Zone identifier.
      }
    }
    liftedAt: TimeStamp with {
      briefly "Lifted"
      described as {
        |Lift time.
      }
    }
  } with {
    briefly "Lift boil water advisory"
    described as {
      |Lifts boil water advisory.
    }
  }
  command UpdateReservoirLevel is  {
    zoneId: DistributionZoneId with {
      briefly "Zone ID"
      described as {
        |Zone identifier.
      }
    }
    level: ReservoirLevel with {
      briefly "Level"
      described as {
        |Reservoir level.
      }
    }
  } with {
    briefly "Update reservoir level"
    described as {
      |Updates reservoir level.
    }
  }
  // Events
  event ZoneCreated is  {
    zoneId: DistributionZoneId with {
      briefly "Zone"
      described as {
        |Zone ID.
      }
    }
    name: String(1,100) with {
      briefly "Name"
      described as {
        |Zone name.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Zone created"
    described as {
      |Emitted when zone is created.
    }
  }
  event PressureRecorded is  {
    zoneId: DistributionZoneId with {
      briefly "Zone"
      described as {
        |Zone ID.
      }
    }
    reading: PressureReading with {
      briefly "Reading"
      described as {
        |Pressure data.
      }
    }
  } with {
    briefly "Pressure recorded"
    described as {
      |Emitted when pressure is recorded.
    }
  }
  event QualitySampleSubmitted is  {
    zoneId: DistributionZoneId with {
      briefly "Zone"
      described as {
        |Zone ID.
      }
    }
    sample: WaterQualitySample with {
      briefly "Sample"
      described as {
        |Sample data.
      }
    }
    qualityStatus: WaterQualityStatus with {
      briefly "Status"
      described as {
        |Quality status.
      }
    }
  } with {
    briefly "Quality sample submitted"
    described as {
      |Emitted when sample is submitted.
    }
  }
  event LeakReported is  {
    zoneId: DistributionZoneId with {
      briefly "Zone"
      described as {
        |Zone ID.
      }
    }
    leak: LeakReport with {
      briefly "Leak"
      described as {
        |Leak data.
      }
    }
  } with {
    briefly "Leak reported"
    described as {
      |Emitted when leak is reported.
    }
  }
  event MaintenanceScheduled is  {
    zoneId: DistributionZoneId with {
      briefly "Zone"
      described as {
        |Zone ID.
      }
    }
    work: MaintenanceWork with {
      briefly "Work"
      described as {
        |Maintenance work.
      }
    }
  } with {
    briefly "Maintenance scheduled"
    described as {
      |Emitted when maintenance is scheduled.
    }
  }
  event BoilWaterAdvisoryIssued is  {
    zoneId: DistributionZoneId with {
      briefly "Zone"
      described as {
        |Zone ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Advisory reason.
      }
    }
    issuedAt: TimeStamp with {
      briefly "Issued"
      described as {
        |Issue time.
      }
    }
  } with {
    briefly "Boil water advisory issued"
    described as {
      |Emitted when advisory is issued.
    }
  }
  event BoilWaterAdvisoryLifted is  {
    zoneId: DistributionZoneId with {
      briefly "Zone"
      described as {
        |Zone ID.
      }
    }
    liftedAt: TimeStamp with {
      briefly "Lifted"
      described as {
        |Lift time.
      }
    }
  } with {
    briefly "Boil water advisory lifted"
    described as {
      |Emitted when advisory is lifted.
    }
  }
  event ReservoirLevelUpdated is  {
    zoneId: DistributionZoneId with {
      briefly "Zone"
      described as {
        |Zone ID.
      }
    }
    level: ReservoirLevel with {
      briefly "Level"
      described as {
        |Level data.
      }
    }
  } with {
    briefly "Reservoir level updated"
    described as {
      |Emitted when level is updated.
    }
  }
  // States
  record ActiveStateData is  {
    zoneId: DistributionZoneId with {
      briefly "Zone"
      described as {
        |Zone ID.
      }
    }
    name: String(1,100) with {
      briefly "Name"
      described as {
        |Zone name.
      }
    }
    serviceArea: String(1,200) with {
      briefly "Area"
      described as {
        |Service area.
      }
    }
    customerCount: Natural with {
      briefly "Customers"
      described as {
        |Customer count.
      }
    }
    status: ZoneStatus with {
      briefly "Status"
      described as {
        |Zone status.
      }
    }
    currentPressure: PressureReading? with {
      briefly "Pressure"
      described as {
        |Current pressure.
      }
    }
    latestQualitySample: WaterQualitySample? with {
      briefly "Quality"
      described as {
        |Latest sample.
      }
    }
    activeLeaks: LeakReport* with {
      briefly "Leaks"
      described as {
        |Active leaks.
      }
    }
    scheduledMaintenance: MaintenanceWork* with {
      briefly "Maintenance"
      described as {
        |Scheduled work.
      }
    }
    qualityStatus: WaterQualityStatus with {
      briefly "Quality status"
      described as {
        |Quality compliance.
      }
    }
  } with {
    briefly "Active zone state"
    described as {
      |State for active distribution zone.
    }
  }
  state ActiveState of type DistributionZone.ActiveStateData
  handler DistributionZoneHandler is {
    on command CreateZone is {
      morph entity WaterContext.DistributionZone to state WaterContext.DistributionZone.ActiveState with command CreateZone
      tell event ZoneCreated to entity WaterContext.DistributionZone
    }
    on command RecordPressure is {
      tell event PressureRecorded to entity WaterContext.DistributionZone
    }
    on command SubmitQualitySample is {
      tell event QualitySampleSubmitted to entity WaterContext.DistributionZone
    }
    on command ReportLeak is {
      tell event LeakReported to entity WaterContext.DistributionZone
    }
    on command ScheduleMaintenance is {
      tell event MaintenanceScheduled to entity WaterContext.DistributionZone
    }
    on command IssueBoilWaterAdvisory is {
      tell event BoilWaterAdvisoryIssued to entity WaterContext.DistributionZone
    }
    on command LiftBoilWaterAdvisory is {
      tell event BoilWaterAdvisoryLifted to entity WaterContext.DistributionZone
    }
    on command UpdateReservoirLevel is {
      tell event ReservoirLevelUpdated to entity WaterContext.DistributionZone
    }
  } with {
    briefly "Processes distribution zone commands"
    described as {
      |Handles distribution zone operations.
    }
  }
} with {
  briefly "DistributionZone aggregate"
  described as {
    |Manages water distribution zones.
  }
}
