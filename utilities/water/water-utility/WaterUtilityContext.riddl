// Water Utility - Water Utility Context
context WaterUtilityContext is {
  include "types.riddl"
  include "WaterSystem.riddl"
  repository WaterUtilityRepository is {
    schema WaterUtilityData is relational
      of waterSystems as type WaterSystem
        index on field WaterSystem.systemId
        index on field WaterSystem.status
        index on field WaterSystem.systemName

    handler WaterUtilityPersistence is {
      on command WaterSystem.RegisterSystem is {
        prompt "Store new water system"
      }
      on command WaterSystem.UpdateTreatmentStatus is {
        prompt "Update treatment plant status"
      }
      on command WaterSystem.RecordQualityTest is {
        prompt "Store quality test result"
      }
      on command WaterSystem.ReportLeak is {
        prompt "Store leak report"
      }
      on command WaterSystem.ResolveLeak is {
        prompt "Update leak report as resolved"
      }
      on command WaterSystem.SubmitComplianceReport is {
        prompt "Store compliance report"
      }
    } with {
      briefly "Persists water utility events"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Water utility data persistence"
    described as {
      |Persistent storage for water utility data.
    }
  }
  projector WaterUtilityMetrics is {
    record SystemMetrics is  {
      totalSystems: Natural with {
        briefly "Systems"
        described as {
          |Total registered systems.
        }
      }
      qualityTestsRun: Natural with {
        briefly "Tests"
        described as {
          |Quality tests performed.
        }
      }
      qualityTestsFailed: Natural with {
        briefly "Failed"
        described as {
          |Quality tests failed.
        }
      }
      activeLeakCount: Natural with {
        briefly "Leaks"
        described as {
          |Active leak count.
        }
      }
      leaksResolved: Natural with {
        briefly "Resolved"
        described as {
          |Leaks resolved.
        }
      }
      alertsRaised: Natural with {
        briefly "Alerts"
        described as {
          |Alerts raised.
        }
      }
      complianceReportsSubmitted: Natural with {
        briefly "Reports"
        described as {
          |Compliance reports submitted.
        }
      }
    } with {
      briefly "System metrics"
      described as {
        |Water utility operational metrics.
      }
    }
    handler MetricsHandler is {
      on event WaterSystem.SystemRegistered is {
        prompt "Increment total systems"
      }
      on event WaterSystem.QualityTestRecorded is {
        prompt "Increment quality tests and check failures"
      }
      on event WaterSystem.LeakReported is {
        prompt "Increment active leaks"
      }
      on event WaterSystem.LeakResolved is {
        prompt "Decrement active leaks increment resolved"
      }
      on event WaterSystem.AlertRaised is {
        prompt "Increment alerts raised"
      }
      on event WaterSystem.ComplianceReportSubmitted is {
        prompt "Increment compliance reports submitted"
      }
    } with {
      briefly "Maintains water utility metrics"
      described as {
        |Projects events into operational metrics.
      }
    }
  } with {
    briefly "Water utility metrics"
    described as {
      |Water utility operational analytics.
    }
  }
} with {
  briefly "Bounded context for water utility management"
  described as {
    |Water utility treatment, distribution, and compliance context.
  }
}
