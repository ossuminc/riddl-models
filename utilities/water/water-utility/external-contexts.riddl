// Water Utility - External Contexts
context SCADASystem is {
  query GetSensorReadings is  {
    plantId: TreatmentPlantId with {
      briefly "Plant"
      described as {
        |Plant ID.
      }
    }
    sensorIds: SensorId+ with {
      briefly "Sensors"
      described as {
        |Sensor identifiers.
      }
    }
  } with {
    briefly "Get sensor readings"
    described as {
      |Retrieves current sensor readings from SCADA.
    }
  }
  result SensorReadings is  {
    plantId: TreatmentPlantId with {
      briefly "Plant"
      described as {
        |Plant ID.
      }
    }
    readings: PressureReading+ with {
      briefly "Readings"
      described as {
        |Sensor readings.
      }
    }
    collectedAt: TimeStamp with {
      briefly "Collected"
      described as {
        |Collection time.
      }
    }
  } with {
    briefly "Sensor readings"
    described as {
      |SCADA sensor reading results.
    }
  }
  command SendControlSignal is  {
    plantId: TreatmentPlantId with {
      briefly "Plant"
      described as {
        |Plant ID.
      }
    }
    targetDevice: String(3,200) with {
      briefly "Device"
      described as {
        |Target device.
      }
    }
    signalType: String(3,100) with {
      briefly "Signal"
      described as {
        |Control signal type.
      }
    }
    parameters: String(3,1000) with {
      briefly "Parameters"
      described as {
        |Signal parameters.
      }
    }
  } with {
    briefly "Send control signal"
    described as {
      |Sends a control signal to plant equipment.
    }
  }
  event ControlSignalSent is  {
    plantId: TreatmentPlantId with {
      briefly "Plant"
      described as {
        |Plant ID.
      }
    }
    targetDevice: String(3,200) with {
      briefly "Device"
      described as {
        |Target device.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Signal sent time.
      }
    }
    acknowledged: Boolean with {
      briefly "Acknowledged"
      described as {
        |Signal acknowledged.
      }
    }
  } with {
    briefly "Control signal sent"
    described as {
      |Emitted when a control signal is sent.
    }
  }
} with {
  option external()
  briefly "External SCADA system"
  described as {
    |Supervisory control and data acquisition system.
  }
}
context RegulatoryReporting is {
  command SubmitReport is  {
    reportId: UUID with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    reportType: String(3,100) with {
      briefly "Type"
      described as {
        |Report type.
      }
    }
    reportData: String(3,10000) with {
      briefly "Data"
      described as {
        |Report data.
      }
    }
    regulatoryBody: String(3,200) with {
      briefly "Regulator"
      described as {
        |Regulatory body.
      }
    }
  } with {
    briefly "Submit report"
    described as {
      |Submits a regulatory report.
    }
  }
  event ReportSubmitted is  {
    reportId: UUID with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    regulatoryBody: String(3,200) with {
      briefly "Regulator"
      described as {
        |Regulatory body.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
    accepted: Boolean with {
      briefly "Accepted"
      described as {
        |Report accepted.
      }
    }
  } with {
    briefly "Report submitted"
    described as {
      |Emitted when a regulatory report is submitted.
    }
  }
  query GetComplianceRequirements is  {
    regulatoryBody: String(3,200) with {
      briefly "Regulator"
      described as {
        |Regulatory body.
      }
    }
    reportingPeriod: String(3,50) with {
      briefly "Period"
      described as {
        |Reporting period.
      }
    }
  } with {
    briefly "Get compliance requirements"
    described as {
      |Retrieves compliance requirements.
    }
  }
  result ComplianceRequirements is  {
    regulatoryBody: String(3,200) with {
      briefly "Regulator"
      described as {
        |Regulatory body.
      }
    }
    requirements: String(3,500)+ with {
      briefly "Requirements"
      described as {
        |Compliance requirements.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due date for report.
      }
    }
  } with {
    briefly "Compliance requirements"
    described as {
      |Regulatory compliance requirements.
    }
  }
} with {
  option external()
  briefly "External regulatory reporting system"
  described as {
    |Regulatory reporting and compliance system.
  }
}
