// Gas Distribution - External Contexts
context PipelineSCADA is {
  query GetRealtimePressure is  {
    stationId: RegulatorStationId with {
      briefly "Station"
      described as {
        |Station ID.
      }
    }
  } with {
    briefly "Get realtime pressure"
    described as {
      |Gets realtime pressure from SCADA.
    }
  }
  result RealtimePressure is  {
    stationId: RegulatorStationId with {
      briefly "Station"
      described as {
        |Station ID.
      }
    }
    inletPressure: Decimal(6,2) with {
      briefly "Inlet"
      described as {
        |Inlet pressure PSIG.
      }
    }
    outletPressure: Decimal(6,2) with {
      briefly "Outlet"
      described as {
        |Outlet pressure PSIG.
      }
    }
    flowRate: Decimal(10,2) with {
      briefly "Flow"
      described as {
        |Flow MCF/hour.
      }
    }
    timestamp: TimeStamp with {
      briefly "Time"
      described as {
        |Reading time.
      }
    }
  } with {
    briefly "Realtime pressure"
    described as {
      |Current pressure readings.
    }
  }
  command AdjustRegulator is  {
    stationId: RegulatorStationId with {
      briefly "Station"
      described as {
        |Station ID.
      }
    }
    targetPressure: Decimal(6,2) with {
      briefly "Target"
      described as {
        |Target pressure.
      }
    }
  } with {
    briefly "Adjust regulator"
    described as {
      |Adjusts pressure regulator.
    }
  }
  event RegulatorAdjusted is  {
    stationId: RegulatorStationId with {
      briefly "Station"
      described as {
        |Station ID.
      }
    }
    newPressure: Decimal(6,2) with {
      briefly "Pressure"
      described as {
        |New pressure.
      }
    }
    adjustedAt: TimeStamp with {
      briefly "Adjusted"
      described as {
        |Adjustment time.
      }
    }
  } with {
    briefly "Regulator adjusted"
    described as {
      |Emitted when regulator adjusted.
    }
  }
} with {
  option external()
  briefly "External pipeline SCADA"
  described as {
    |Pipeline monitoring and control system.
  }
}
context EmergencyDispatch is {
  command DispatchEmergencyCrew is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    location: String(1,200) with {
      briefly "Location"
      described as {
        |Emergency location.
      }
    }
    emergencyType: String(1,100) with {
      briefly "Type"
      described as {
        |Emergency type.
      }
    }
    priority: Natural with {
      briefly "Priority"
      described as {
        |Priority level.
      }
    }
  } with {
    briefly "Dispatch emergency crew"
    described as {
      |Dispatches emergency response.
    }
  }
  event CrewDispatched is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    crewId: UUID with {
      briefly "Crew"
      described as {
        |Crew ID.
      }
    }
    eta: Natural with {
      briefly "ETA"
      described as {
        |ETA minutes.
      }
    }
    dispatchedAt: TimeStamp with {
      briefly "Dispatched"
      described as {
        |Dispatch time.
      }
    }
  } with {
    briefly "Crew dispatched"
    described as {
      |Emitted when crew dispatched.
    }
  }
  event CrewArrived is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    crewId: UUID with {
      briefly "Crew"
      described as {
        |Crew ID.
      }
    }
    arrivedAt: TimeStamp with {
      briefly "Arrived"
      described as {
        |Arrival time.
      }
    }
  } with {
    briefly "Crew arrived"
    described as {
      |Emitted when crew arrives.
    }
  }
} with {
  option external()
  briefly "External emergency dispatch"
  described as {
    |Emergency response coordination.
  }
}
context RegulatoryCompliance is {
  command SubmitLeakReport is  {
    reportId: UUID with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    report: LeakReport with {
      briefly "Leak"
      described as {
        |Leak details.
      }
    }
  } with {
    briefly "Submit leak report"
    described as {
      |Submits leak to regulator.
    }
  }
  command SubmitInspectionReport is  {
    inspection: InspectionRecord with {
      briefly "Inspection"
      described as {
        |Inspection record.
      }
    }
  } with {
    briefly "Submit inspection report"
    described as {
      |Submits inspection to regulator.
    }
  }
  event ReportAcknowledged is  {
    reportId: UUID with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    referenceNumber: String(1,100) with {
      briefly "Reference"
      described as {
        |Regulatory reference.
      }
    }
    acknowledgedAt: TimeStamp with {
      briefly "Acknowledged"
      described as {
        |Ack time.
      }
    }
  } with {
    briefly "Report acknowledged"
    described as {
      |Emitted when report acknowledged.
    }
  }
} with {
  option external()
  briefly "External regulatory compliance"
  described as {
    |State/federal regulatory systems.
  }
}
context CustomerNotification is {
  command SendServiceAlert is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    alertType: String(1,50) with {
      briefly "Type"
      described as {
        |Alert type.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Alert message.
      }
    }
    affectedArea: String(1,200) with {
      briefly "Area"
      described as {
        |Affected area.
      }
    }
  } with {
    briefly "Send service alert"
    described as {
      |Sends alert to customers.
    }
  }
  event AlertSent is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    recipientCount: Natural with {
      briefly "Recipients"
      described as {
        |Customers notified.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Alert sent"
    described as {
      |Emitted when alert sent.
    }
  }
} with {
  option external()
  briefly "External customer notification"
  described as {
    |Customer communication system.
  }
}
