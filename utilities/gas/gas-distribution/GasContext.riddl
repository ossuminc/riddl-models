// Gas Distribution - Gas Context
context GasContext is {
  include "types.riddl"
  include "District.riddl"
  repository GasRepository is {
    schema GasData is relational
      of districts as type District
        index on field District.districtId
        index on field District.status
        index on field District.districtName

    handler GasPersistence is {
      on command District.CreateDistrict is {
        prompt "Store new district record"
      }
      on command District.RecordPressureReading is {
        prompt "Store pressure reading"
      }
      on command District.ReportLeak is {
        prompt "Store leak report"
      }
      on command District.ScheduleMaintenance is {
        prompt "Store maintenance schedule"
      }
      on command District.RecordInspection is {
        prompt "Store inspection record"
      }
      on command District.UpdateStatus is {
        prompt "Update district status"
      }
    } with {
      briefly "Persists gas commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Gas data persistence"
    described as {
      |Persistent storage for gas operations.
    }
  }
  projector SafetyMetrics is {
    record DistrictSafety is  {
      districtId: DistrictId with {
        briefly "District"
        described as {
          |District ID.
        }
      }
      openLeaks: Natural with {
        briefly "Open leaks"
        described as {
          |Open leak count.
        }
      }
      leaksRepaired: Natural with {
        briefly "Repaired"
        described as {
          |Leaks repaired.
        }
      }
      inspectionsPassed: Natural with {
        briefly "Passed"
        described as {
          |Inspections passed.
        }
      }
      inspectionsFailed: Natural with {
        briefly "Failed"
        described as {
          |Inspections failed.
        }
      }
      daysWithoutIncident: Natural with {
        briefly "Days safe"
        described as {
          |Days without incident.
        }
      }
    } with {
      briefly "District safety"
      described as {
        |Safety metrics by district.
      }
    }
    handler SafetyHandler is {
      on event District.LeakReported is {
        prompt "Increment open leaks count"
      }
      on event District.InspectionRecorded is {
        prompt "Update inspection statistics"
      }
      on event District.StatusUpdated is {
        prompt "Update safety incident tracking"
      }
    } with {
      briefly "Maintains safety metrics"
      described as {
        |Projects events into safety metrics.
      }
    }
  } with {
    briefly "Safety metrics"
    described as {
      |Gas safety monitoring.
    }
  }
} with {
  briefly "Bounded context for gas distribution"
  described as {
    |Natural gas distribution context.
  }
}
