// Gas Distribution - Gas Context

context GasContext is {

  include "types.riddl"
  include "District.riddl"

  repository GasRepository is {
    schema GasData is relational
      of districts as District
      index on field District.districtId
      index on field District.status
      index on field District.districtName

    handler GasPersistence is {
      on event District.DistrictCreated {
        prompt "Store new district record"
      }
      on event District.PressureReadingRecorded {
        prompt "Store pressure reading"
      }
      on event District.LeakReported {
        prompt "Store leak report"
      }
      on event District.MaintenanceScheduled {
        prompt "Store maintenance schedule"
      }
      on event District.InspectionRecorded {
        prompt "Store inspection record"
      }
      on event District.StatusUpdated {
        prompt "Update district status"
      }
    } with {
      briefly "Persists gas events"
      described by "Handles event-driven persistence."
    }
  } with {
    briefly "Gas data persistence"
    described by "Persistent storage for gas operations."
  }

  projector SafetyMetrics is {
    updates repository GasRepository

    record DistrictSafety is {
      districtId is DistrictId with { briefly "District" described by "District ID." }
      openLeaks is Natural with { briefly "Open leaks" described by "Open leak count." }
      leaksRepaired is Natural with { briefly "Repaired" described by "Leaks repaired." }
      inspectionsPassed is Natural with { briefly "Passed" described by "Inspections passed." }
      inspectionsFailed is Natural with { briefly "Failed" described by "Inspections failed." }
      daysWithoutIncident is Natural with { briefly "Days safe" described by "Days without incident." }
    } with {
      briefly "District safety"
      described by "Safety metrics by district."
    }

    handler SafetyHandler is {
      on event District.LeakReported {
        prompt "Increment open leaks count"
      }
      on event District.InspectionRecorded {
        prompt "Update inspection statistics"
      }
      on event District.StatusUpdated {
        prompt "Update safety incident tracking"
      }
    } with {
      briefly "Maintains safety metrics"
      described by "Projects events into safety metrics."
    }
  } with {
    briefly "Safety metrics"
    described by "Gas safety monitoring."
  }

} with {
  briefly "Bounded context for gas distribution"
  described by "Natural gas distribution context."
}
