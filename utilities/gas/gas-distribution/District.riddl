// Gas Distribution - District Entity
entity District is {
  command CreateDistrict is  {
    districtId: DistrictId with {
      briefly "District ID"
      described as {
        |New district identifier.
      }
    }
    districtName: String(1,100) with {
      briefly "Name"
      described as {
        |District name.
      }
    }
    serviceArea: String(1,500) with {
      briefly "Service area"
      described as {
        |Service area description.
      }
    }
    customerCount: Natural with {
      briefly "Customers"
      described as {
        |Customer count.
      }
    }
  } with {
    briefly "Create district"
    described as {
      |Creates a new gas district.
    }
  }
  command RecordPressureReading is  {
    districtId: DistrictId with {
      briefly "District ID"
      described as {
        |District identifier.
      }
    }
    reading: PressureReading with {
      briefly "Reading"
      described as {
        |Pressure reading.
      }
    }
  } with {
    briefly "Record pressure reading"
    described as {
      |Records pressure measurement.
    }
  }
  command ReportLeak is  {
    districtId: DistrictId with {
      briefly "District ID"
      described as {
        |District identifier.
      }
    }
    report: LeakReport with {
      briefly "Report"
      described as {
        |Leak report.
      }
    }
  } with {
    briefly "Report leak"
    described as {
      |Reports a gas leak.
    }
  }
  command ReportOdorComplaint is  {
    districtId: DistrictId with {
      briefly "District ID"
      described as {
        |District identifier.
      }
    }
    complaint: OdorComplaint with {
      briefly "Complaint"
      described as {
        |Odor complaint.
      }
    }
  } with {
    briefly "Report odor complaint"
    described as {
      |Records customer odor report.
    }
  }
  command ScheduleMaintenance is  {
    districtId: DistrictId with {
      briefly "District ID"
      described as {
        |District identifier.
      }
    }
    work: MaintenanceWork with {
      briefly "Work"
      described as {
        |Maintenance work.
      }
    }
  } with {
    briefly "Schedule maintenance"
    described as {
      |Schedules maintenance work.
    }
  }
  command RecordInspection is  {
    districtId: DistrictId with {
      briefly "District ID"
      described as {
        |District identifier.
      }
    }
    inspection: InspectionRecord with {
      briefly "Inspection"
      described as {
        |Inspection record.
      }
    }
  } with {
    briefly "Record inspection"
    described as {
      |Records safety inspection.
    }
  }
  command IsolateSection is  {
    districtId: DistrictId with {
      briefly "District ID"
      described as {
        |District identifier.
      }
    }
    sectionId: String(1,100) with {
      briefly "Section"
      described as {
        |Section to isolate.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Isolation reason.
      }
    }
    isolatedAt: TimeStamp with {
      briefly "Isolated"
      described as {
        |Isolation time.
      }
    }
  } with {
    briefly "Isolate section"
    described as {
      |Isolates a pipeline section.
    }
  }
  command RestoreSection is  {
    districtId: DistrictId with {
      briefly "District ID"
      described as {
        |District identifier.
      }
    }
    sectionId: String(1,100) with {
      briefly "Section"
      described as {
        |Section to restore.
      }
    }
    restoredAt: TimeStamp with {
      briefly "Restored"
      described as {
        |Restoration time.
      }
    }
  } with {
    briefly "Restore section"
    described as {
      |Restores isolated section.
    }
  }
  command UpdateStatus is  {
    districtId: DistrictId with {
      briefly "District ID"
      described as {
        |District identifier.
      }
    }
    newStatus: DistrictStatus with {
      briefly "Status"
      described as {
        |New status.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Status change reason.
      }
    }
  } with {
    briefly "Update status"
    described as {
      |Updates district status.
    }
  }
  // Events
  event DistrictCreated is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    districtName: String(1,100) with {
      briefly "Name"
      described as {
        |District name.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "District created"
    described as {
      |Emitted when district is created.
    }
  }
  event PressureReadingRecorded is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    reading: PressureReading with {
      briefly "Reading"
      described as {
        |Pressure reading.
      }
    }
  } with {
    briefly "Pressure reading recorded"
    described as {
      |Emitted when pressure is recorded.
    }
  }
  event LeakReported is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    report: LeakReport with {
      briefly "Report"
      described as {
        |Leak report.
      }
    }
    reportedAt: TimeStamp with {
      briefly "Reported"
      described as {
        |Report time.
      }
    }
  } with {
    briefly "Leak reported"
    described as {
      |Emitted when leak is reported.
    }
  }
  event OdorComplaintReceived is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    complaint: OdorComplaint with {
      briefly "Complaint"
      described as {
        |Odor complaint.
      }
    }
  } with {
    briefly "Odor complaint received"
    described as {
      |Emitted when odor complaint received.
    }
  }
  event MaintenanceScheduled is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    work: MaintenanceWork with {
      briefly "Work"
      described as {
        |Maintenance work.
      }
    }
    scheduledAt: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Schedule time.
      }
    }
  } with {
    briefly "Maintenance scheduled"
    described as {
      |Emitted when maintenance scheduled.
    }
  }
  event InspectionRecorded is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    inspection: InspectionRecord with {
      briefly "Inspection"
      described as {
        |Inspection.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Inspection recorded"
    described as {
      |Emitted when inspection recorded.
    }
  }
  event SectionIsolated is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    sectionId: String(1,100) with {
      briefly "Section"
      described as {
        |Section ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Isolation reason.
      }
    }
    isolatedAt: TimeStamp with {
      briefly "Isolated"
      described as {
        |Isolation time.
      }
    }
  } with {
    briefly "Section isolated"
    described as {
      |Emitted when section isolated.
    }
  }
  event SectionRestored is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    sectionId: String(1,100) with {
      briefly "Section"
      described as {
        |Section ID.
      }
    }
    restoredAt: TimeStamp with {
      briefly "Restored"
      described as {
        |Restoration time.
      }
    }
  } with {
    briefly "Section restored"
    described as {
      |Emitted when section restored.
    }
  }
  event StatusUpdated is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    newStatus: DistrictStatus with {
      briefly "Status"
      described as {
        |New status.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Status updated"
    described as {
      |Emitted when status changes.
    }
  }
  // States
  record ActiveStateData is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    districtName: String(1,100) with {
      briefly "Name"
      described as {
        |District name.
      }
    }
    serviceArea: String(1,500) with {
      briefly "Area"
      described as {
        |Service area.
      }
    }
    customerCount: Natural with {
      briefly "Customers"
      described as {
        |Customer count.
      }
    }
    status: DistrictStatus with {
      briefly "Status"
      described as {
        |Current status.
      }
    }
    currentPressure: PressureReading? with {
      briefly "Pressure"
      described as {
        |Current pressure.
      }
    }
    activeLeaks: LeakReport* with {
      briefly "Leaks"
      described as {
        |Active leaks.
      }
    }
    scheduledWork: MaintenanceWork* with {
      briefly "Work"
      described as {
        |Scheduled work.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Active district state"
    described as {
      |State for active district.
    }
  }
  record EmergencyStateData is  {
    districtId: DistrictId with {
      briefly "District"
      described as {
        |District ID.
      }
    }
    districtName: String(1,100) with {
      briefly "Name"
      described as {
        |District name.
      }
    }
    emergencyReason: String(1,500) with {
      briefly "Reason"
      described as {
        |Emergency reason.
      }
    }
    isolatedSections: String(1,100)+ with {
      briefly "Isolated"
      described as {
        |Isolated sections.
      }
    }
    emergencyDeclaredAt: TimeStamp with {
      briefly "Declared"
      described as {
        |Declaration time.
      }
    }
  } with {
    briefly "Emergency district state"
    described as {
      |State for emergency conditions.
    }
  }
  state ActiveState of type District.ActiveStateData
  state EmergencyState of type District.EmergencyStateData
  handler DistrictHandler is {
    on command CreateDistrict is {
      morph entity GasContext.District to state GasContext.District.ActiveState with command CreateDistrict
      tell event DistrictCreated to entity GasContext.District
    }
    on command RecordPressureReading is {
      tell event PressureReadingRecorded to entity GasContext.District
    }
    on command ReportLeak is {
      tell event LeakReported to entity GasContext.District
    }
    on command ReportOdorComplaint is {
      tell event OdorComplaintReceived to entity GasContext.District
    }
    on command ScheduleMaintenance is {
      tell event MaintenanceScheduled to entity GasContext.District
    }
    on command RecordInspection is {
      tell event InspectionRecorded to entity GasContext.District
    }
    on command IsolateSection is {
      tell event SectionIsolated to entity GasContext.District
    }
    on command RestoreSection is {
      tell event SectionRestored to entity GasContext.District
    }
    on command UpdateStatus is {
      tell event StatusUpdated to entity GasContext.District
    }
  } with {
    briefly "Processes district commands"
    described as {
      |Handles district lifecycle.
    }
  }
} with {
  briefly "District aggregate"
  described as {
    |Manages gas distribution districts.
  }
}
