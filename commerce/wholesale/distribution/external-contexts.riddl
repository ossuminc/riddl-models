// Distribution - External Contexts

// Inventory Service - Warehouse inventory
context InventoryService is {

  command AllocateStock is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    productId is ProductId with { briefly "Product" described by "Product ID." }
    quantity is Quantity with { briefly "Quantity" described by "Quantity needed." }
    preferredWarehouse is optional WarehouseId with { briefly "Warehouse" described by "Preferred source." }
  } with {
    briefly "Allocate stock for order"
    described by "Requests inventory allocation."
  }

  command ReleaseStock is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    productId is ProductId with { briefly "Product" described by "Product ID." }
    quantity is Quantity with { briefly "Quantity" described by "Quantity to release." }
  } with {
    briefly "Release allocated stock"
    described by "Releases previously allocated inventory."
  }

  event StockAllocated is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    allocation is AllocationResult with { briefly "Allocation" described by "Allocation result." }
    allocatedAt is TimeStamp with { briefly "Allocated" described by "Allocation time." }
  } with {
    briefly "Stock was allocated"
    described by "Emitted when inventory is reserved."
  }

  event StockUnavailable is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    productId is ProductId with { briefly "Product" described by "Unavailable product." }
    requestedQuantity is Quantity with { briefly "Requested" described by "Requested quantity." }
    availableQuantity is Quantity with { briefly "Available" described by "Available quantity." }
  } with {
    briefly "Stock was unavailable"
    described by "Emitted when stock is insufficient."
  }

} with {
  option is external
  briefly "External inventory service"
  described by "External system for warehouse inventory."
}

// Shipping Service - Freight management
context ShippingService is {

  command SchedulePickup is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    warehouseId is WarehouseId with { briefly "Warehouse" described by "Pickup location." }
    weight is Decimal(10, 2) with { briefly "Weight" described by "Shipment weight." }
    destination is ShippingAddress with { briefly "Destination" described by "Delivery address." }
  } with {
    briefly "Schedule carrier pickup"
    described by "Schedules freight pickup."
  }

  event PickupScheduled is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    shipmentId is UUID with { briefly "Shipment" described by "Shipment ID." }
    scheduledDate is Date with { briefly "Scheduled" described by "Pickup date." }
  } with {
    briefly "Pickup was scheduled"
    described by "Emitted when pickup is arranged."
  }

  event ShipmentDelivered is {
    shipmentId is UUID with { briefly "Shipment" described by "Shipment ID." }
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    deliveredAt is TimeStamp with { briefly "Delivered" described by "Delivery time." }
    signature is optional String(1, 100) with { briefly "Signature" described by "Receiver signature." }
  } with {
    briefly "Shipment was delivered"
    described by "Emitted when delivery is confirmed."
  }

} with {
  option is external
  briefly "External shipping service"
  described by "External system for freight management."
}

// Billing Service - Invoice generation
context BillingService is {

  command CreateInvoice is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    lines is many OrderLine with { briefly "Lines" described by "Invoice lines." }
    totalAmount is Money with { briefly "Total" described by "Invoice total." }
    dueDate is Date with { briefly "Due" described by "Payment due date." }
  } with {
    briefly "Create invoice for order"
    described by "Generates invoice for shipped order."
  }

  event InvoiceCreated is {
    invoiceId is UUID with { briefly "Invoice" described by "Invoice ID." }
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    totalAmount is Money with { briefly "Total" described by "Invoice total." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Invoice was created"
    described by "Emitted when invoice is generated."
  }

  event PaymentReceived is {
    invoiceId is UUID with { briefly "Invoice" described by "Invoice ID." }
    amount is Money with { briefly "Amount" described by "Payment amount." }
    receivedAt is TimeStamp with { briefly "Received" described by "Payment time." }
  } with {
    briefly "Payment was received"
    described by "Emitted when invoice is paid."
  }

} with {
  option is external
  briefly "External billing service"
  described by "External system for invoice management."
}

// CRM Service - Customer data
context CRMService is {

  event CustomerPricingUpdated is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    newTier is PricingTier with { briefly "Tier" described by "New pricing tier." }
    effectiveDate is Date with { briefly "Effective" described by "When effective." }
  } with {
    briefly "Customer pricing was updated"
    described by "Emitted when pricing tier changes."
  }

  event CustomerCreditUpdated is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    creditLimit is Money with { briefly "Limit" described by "Credit limit." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Customer credit was updated"
    described by "Emitted when credit limit changes."
  }

} with {
  option is external
  briefly "External CRM service"
  described by "External system for customer management."
}
