// Distribution - Distribution Context
context DistributionContext is {
  include "types.riddl"
  include "DistributionOrder.riddl"
  // Adaptors for external system integration
  adaptor InventoryAdapter to context InventoryService is { 
    handler InventoryAllocation is {
      on command InventoryService.AllocateStock is {
        prompt "Request inventory allocation"
      }
      on command InventoryService.ReleaseStock is {
        prompt "Release allocated inventory"
      }
    } with {
      briefly "Handles inventory allocation"
      described as {
        |Requests inventory for orders.
      }
    }
  } with {
    briefly "Inventory integration"
    described as {
      |Manages inventory allocation requests.
    }
  }
  adaptor ShippingAdapter to context ShippingService is { 
    handler ShippingEvents is {
      on command ShippingService.SchedulePickup is {
        prompt "Schedule shipment pickup"
      }
    } with {
      briefly "Handles shipping coordination"
      described as {
        |Schedules shipments for confirmed orders.
      }
    }
  } with {
    briefly "Shipping integration"
    described as {
      |Coordinates with shipping carriers.
    }
  }
  adaptor BillingAdapter to context BillingService is { 
    handler BillingEvents is {
      on command BillingService.CreateInvoice is {
        prompt "Generate invoice for shipped order"
      }
    } with {
      briefly "Handles billing"
      described as {
        |Triggers invoicing on shipment.
      }
    }
  } with {
    briefly "Billing integration"
    described as {
      |Publishes billing events.
    }
  }
  // Repository for order persistence
  repository OrderRepository is {
    schema OrderData is relational
      of orders as type DistributionOrder
        index on field DistributionOrder.customerId
        index on field DistributionOrder.orderId

    handler OrderPersistence is {
      on command DistributionOrder.CreateOrder is {
        prompt "Persist new order"
      }
      on command DistributionOrder.AllocateInventory is {
        prompt "Update allocation status"
      }
      on command DistributionOrder.ConfirmOrder is {
        prompt "Update order status"
      }
      on command DistributionOrder.ShipOrder is {
        prompt "Record shipment"
      }
      on command DistributionOrder.DeliverOrder is {
        prompt "Record delivery"
      }
      on command DistributionOrder.CancelOrder is {
        prompt "Mark order cancelled"
      }
    } with {
      briefly "Persists order commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Order data persistence"
    described as {
      | The OrderRepository provides persistent storage for
      | distribution orders.
    }
  }
  // Projector for distribution analytics
  projector DistributionAnalytics is {
    record CustomerOrderMetrics is  {
      customerId: CustomerId with {
        briefly "Customer"
        described as {
          |Customer ID.
        }
      }
      totalOrders: Natural with {
        briefly "Orders"
        described as {
          |Total orders.
        }
      }
      totalRevenue: Money with {
        briefly "Revenue"
        described as {
          |Total revenue.
        }
      }
      avgOrderValue: Money with {
        briefly "AOV"
        described as {
          |Average order value.
        }
      }
    } with {
      briefly "Customer order metrics"
      described as {
        |Aggregated customer order data.
      }
    }
    handler AnalyticsHandler is {
      on event DistributionOrder.OrderDelivered is {
        prompt "Update customer metrics"
      }
    } with {
      briefly "Maintains analytics views"
      described as {
        |Projects events into analytics.
      }
    }
  } with {
    briefly "Distribution analytics projections"
    described as {
      |Maintains order analytics data.
    }
  }
} with {
  briefly "Bounded context for distribution"
  described as {
    | The DistributionContext is the bounded context for wholesale
    | distribution. It manages orders, allocation, and fulfillment.
  }
}
