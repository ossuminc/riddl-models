// Trade Credit - External Contexts
// Credit Bureau Service - Credit reporting
context CreditBureauService is {
  command RequestCreditReport is  {
    customerId: CustomerId with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    businessName: String(1,200) with {
      briefly "Name"
      described as {
        |Business name.
      }
    }
    taxId: String(1,50) with {
      briefly "Tax ID"
      described as {
        |Business tax ID.
      }
    }
  } with {
    briefly "Request credit report"
    described as {
      |Requests credit report from bureau.
    }
  }
  event CreditReportReceived is  {
    customerId: CustomerId with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    creditScore: Natural with {
      briefly "Score"
      described as {
        |Credit score.
      }
    }
    paymentHistory: String(1,50) with {
      briefly "History"
      described as {
        |Payment history.
      }
    }
    publicRecords: Natural with {
      briefly "Records"
      described as {
        |Public record count.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Report time.
      }
    }
  } with {
    briefly "Credit report was received"
    described as {
      |Emitted when credit report is returned.
    }
  }
} with {
  option external()
  briefly "External credit bureau"
  described as {
    |External credit reporting service.
  }
}
// Order Service - Order events
context OrderService is {
  event OrderShipped is  {
    orderId: UUID with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    customerId: CustomerId with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    orderTotal: Money with {
      briefly "Total"
      described as {
        |Order total.
      }
    }
    shippedAt: TimeStamp with {
      briefly "Shipped"
      described as {
        |Ship time.
      }
    }
  } with {
    briefly "Order was shipped"
    described as {
      |Emitted when order ships.
    }
  }
} with {
  option external()
  briefly "External order service"
  described as {
    |External order management system.
  }
}
// Payment Service - Payment processing
context PaymentService is {
  event PaymentReceived is  {
    paymentId: UUID with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    customerId: CustomerId with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    receivedAmount: Money with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    paymentMethod: String(1,50) with {
      briefly "Method"
      described as {
        |Payment method.
      }
    }
    reference: String(1,100)? with {
      briefly "Reference"
      described as {
        |Check/reference number.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Receipt time.
      }
    }
  } with {
    briefly "Payment was received"
    described as {
      |Emitted when payment is received.
    }
  }
} with {
  option external()
  briefly "External payment service"
  described as {
    |External payment processing.
  }
}
// Notification Service - Customer communications
context NotificationService is {
  command SendCreditNotice is  {
    customerId: CustomerId with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    noticeType: String(1,50) with {
      briefly "Type"
      described as {
        |Notice type.
      }
    }
    message: String(1,2000) with {
      briefly "Message"
      described as {
        |Notice content.
      }
    }
  } with {
    briefly "Send credit notice"
    described as {
      |Sends credit-related notification.
    }
  }
  command SendCollectionLetter is  {
    customerId: CustomerId with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    letterType: String(1,50) with {
      briefly "Type"
      described as {
        |Letter type.
      }
    }
    amountDue: Money with {
      briefly "Amount"
      described as {
        |Amount owed.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Payment due date.
      }
    }
  } with {
    briefly "Send collection letter"
    described as {
      |Sends collection notification.
    }
  }
  event NoticeSent is  {
    customerId: CustomerId with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    noticeType: String(1,50) with {
      briefly "Type"
      described as {
        |Notice type.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notice was sent"
    described as {
      |Emitted when notice is delivered.
    }
  }
} with {
  option external()
  briefly "External notification service"
  described as {
    |External communications service.
  }
}
// Legal Service - Collections escalation
context LegalService is {
  command EscalateToCollections is  {
    customerId: CustomerId with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    creditAccountId: CreditAccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    amountOwed: Money with {
      briefly "Amount"
      described as {
        |Amount owed.
      }
    }
    agingDays: Natural with {
      briefly "Aging"
      described as {
        |Days past due.
      }
    }
  } with {
    briefly "Escalate to collections"
    described as {
      |Sends account to external collections.
    }
  }
  event CollectionsEscalated is  {
    creditAccountId: CreditAccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    caseNumber: String(1,50) with {
      briefly "Case"
      described as {
        |Collections case number.
      }
    }
    escalatedAt: TimeStamp with {
      briefly "Escalated"
      described as {
        |Escalation time.
      }
    }
  } with {
    briefly "Account was escalated"
    described as {
      |Emitted when sent to collections.
    }
  }
} with {
  option external()
  briefly "External legal service"
  described as {
    |External legal and collections service.
  }
}
