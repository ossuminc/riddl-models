// Trade Credit - External Contexts

// Credit Bureau Service - Credit reporting
context CreditBureauService is {

  command RequestCreditReport is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    businessName is String(1, 200) with { briefly "Name" described by "Business name." }
    taxId is String(1, 50) with { briefly "Tax ID" described by "Business tax ID." }
  } with {
    briefly "Request credit report"
    described by "Requests credit report from bureau."
  }

  event CreditReportReceived is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    creditScore is Natural with { briefly "Score" described by "Credit score." }
    paymentHistory is String(1, 50) with { briefly "History" described by "Payment history." }
    publicRecords is Natural with { briefly "Records" described by "Public record count." }
    receivedAt is TimeStamp with { briefly "Received" described by "Report time." }
  } with {
    briefly "Credit report was received"
    described by "Emitted when credit report is returned."
  }

} with {
  option is external
  briefly "External credit bureau"
  described by "External credit reporting service."
}

// Order Service - Order events
context OrderService is {

  event OrderShipped is {
    orderId is UUID with { briefly "Order" described by "Order ID." }
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    orderTotal is Money with { briefly "Total" described by "Order total." }
    shippedAt is TimeStamp with { briefly "Shipped" described by "Ship time." }
  } with {
    briefly "Order was shipped"
    described by "Emitted when order ships."
  }

} with {
  option is external
  briefly "External order service"
  described by "External order management system."
}

// Payment Service - Payment processing
context PaymentService is {

  event PaymentReceived is {
    paymentId is UUID with { briefly "Payment" described by "Payment ID." }
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    receivedAmount is Money with { briefly "Amount" described by "Payment amount." }
    paymentMethod is String(1, 50) with { briefly "Method" described by "Payment method." }
    reference is optional String(1, 100) with { briefly "Reference" described by "Check/reference number." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Payment was received"
    described by "Emitted when payment is received."
  }

} with {
  option is external
  briefly "External payment service"
  described by "External payment processing."
}

// Notification Service - Customer communications
context NotificationService is {

  command SendCreditNotice is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    noticeType is String(1, 50) with { briefly "Type" described by "Notice type." }
    message is String(1, 2000) with { briefly "Message" described by "Notice content." }
  } with {
    briefly "Send credit notice"
    described by "Sends credit-related notification."
  }

  command SendCollectionLetter is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    letterType is String(1, 50) with { briefly "Type" described by "Letter type." }
    amountDue is Money with { briefly "Amount" described by "Amount owed." }
    dueDate is Date with { briefly "Due" described by "Payment due date." }
  } with {
    briefly "Send collection letter"
    described by "Sends collection notification."
  }

  event NoticeSent is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    noticeType is String(1, 50) with { briefly "Type" described by "Notice type." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notice was sent"
    described by "Emitted when notice is delivered."
  }

} with {
  option is external
  briefly "External notification service"
  described by "External communications service."
}

// Legal Service - Collections escalation
context LegalService is {

  command EscalateToCollections is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    creditAccountId is CreditAccountId with { briefly "Account" described by "Account ID." }
    amountOwed is Money with { briefly "Amount" described by "Amount owed." }
    agingDays is Natural with { briefly "Aging" described by "Days past due." }
  } with {
    briefly "Escalate to collections"
    described by "Sends account to external collections."
  }

  event CollectionsEscalated is {
    creditAccountId is CreditAccountId with { briefly "Account" described by "Account ID." }
    caseNumber is String(1, 50) with { briefly "Case" described by "Collections case number." }
    escalatedAt is TimeStamp with { briefly "Escalated" described by "Escalation time." }
  } with {
    briefly "Account was escalated"
    described by "Emitted when sent to collections."
  }

} with {
  option is external
  briefly "External legal service"
  described by "External legal and collections service."
}
