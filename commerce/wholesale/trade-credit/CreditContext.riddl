// Trade Credit - Credit Context
context CreditContext is {
  include "types.riddl"
  include "CreditAccount.riddl"
  // Adaptors for external system integration
  adaptor CreditBureauAdapter to context CreditBureauService is { 
    handler CreditChecks is {
      on command CreditBureauService.RequestCreditReport is {
        prompt "Request credit bureau report"
      }
    } with {
      briefly "Handles credit checks"
      described as {
        |Requests credit reports for applications.
      }
    }
  } with {
    briefly "Credit bureau integration"
    described as {
      |Integrates with credit bureaus.
    }
  }
  adaptor OrderAdapter from context OrderService is { 
    handler OrderEvents is {
      on event OrderService.OrderShipped is {
        prompt "Post invoice to credit account"
      }
    } with {
      briefly "Handles order events"
      described as {
        |Creates invoices from shipped orders.
      }
    }
  } with {
    briefly "Order integration"
    described as {
      |Receives order events for invoicing.
    }
  }
  adaptor PaymentAdapter from context PaymentService is { 
    handler PaymentEvents is {
      on event PaymentService.PaymentReceived is {
        prompt "Apply payment to credit account"
      }
    } with {
      briefly "Handles payment events"
      described as {
        |Processes payments on account.
      }
    }
  } with {
    briefly "Payment integration"
    described as {
      |Receives payment notifications.
    }
  }
  // Repository for credit persistence
  repository CreditRepository is {
    schema CreditData is relational
      of accounts as type CreditAccount
        index on field CreditAccount.customerId
        index on field CreditAccount.creditAccountId

    handler CreditPersistence is {
      on command CreditAccount.ApplyForCredit is {
        prompt "Create pending credit application"
      }
      on command CreditAccount.ApproveCredit is {
        prompt "Update account status to active"
      }
      on command CreditAccount.DenyCredit is {
        prompt "Update account status to denied"
      }
      on command CreditAccount.PostInvoice is {
        prompt "Record invoice and update balance"
      }
      on command CreditAccount.ApplyPayment is {
        prompt "Record payment and update balance"
      }
      on command CreditAccount.SuspendAccount is {
        prompt "Update account status to suspended"
      }
    } with {
      briefly "Persists credit commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Credit data persistence"
    described as {
      | The CreditRepository provides persistent storage for
      | credit accounts and invoices.
    }
  }
  // Projector for credit analytics
  projector CreditAnalytics is {
    record AgingReport is  {
      customerId: CustomerId with {
        briefly "Customer"
        described as {
          |Customer ID.
        }
      }
      current: Money with {
        briefly "Current"
        described as {
          |Current balance.
        }
      }
      thirtyDays: Money with {
        briefly "30 days"
        described as {
          |31-60 days.
        }
      }
      sixtyDays: Money with {
        briefly "60 days"
        described as {
          |61-90 days.
        }
      }
      ninetyPlus: Money with {
        briefly "90+ days"
        described as {
          |Over 90 days.
        }
      }
    } with {
      briefly "Aging report"
      described as {
        |Accounts receivable aging.
      }
    }
    handler AnalyticsHandler is {
      on event CreditAccount.InvoicePosted is {
        prompt "Update aging report"
      }
      on event CreditAccount.PaymentApplied is {
        prompt "Update aging report"
      }
    } with {
      briefly "Maintains analytics views"
      described as {
        |Projects events into analytics.
      }
    }
  } with {
    briefly "Credit analytics projections"
    described as {
      |Maintains credit analytics data.
    }
  }
} with {
  briefly "Bounded context for trade credit"
  described as {
    | The CreditContext is the bounded context for wholesale
    | credit management. It handles accounts, invoicing, and collections.
  }
}
