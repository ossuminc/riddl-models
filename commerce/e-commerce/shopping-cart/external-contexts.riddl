// Shopping Cart - External Contexts
// Pricing Service - Product and promotional pricing
context PricingService is {
  event PriceChanged is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Repriced product.
      }
    }
    oldPrice: Money with {
      briefly "Old price"
      described as {
        |Previous price.
      }
    }
    newPrice: Money with {
      briefly "New price"
      described as {
        |Updated price.
      }
    }
    changedAt: TimeStamp with {
      briefly "Changed at"
      described as {
        |When changed.
      }
    }
  } with {
    briefly "Product price changed"
    described as {
      |Emitted when a product price is updated.
    }
  }
  event PromotionActivated is  {
    promotionId: UUID with {
      briefly "Promotion ID"
      described as {
        |Promotion identifier.
      }
    }
    code: PromoCode with {
      briefly "Code"
      described as {
        |Promo code.
      }
    }
    discountPercent: Decimal(5,2) with {
      briefly "Discount"
      described as {
        |Discount percentage.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated"
      described as {
        |When activated.
      }
    }
  } with {
    briefly "Promotion was activated"
    described as {
      |Emitted when a promotional discount becomes active.
    }
  }
  event PromotionDeactivated is  {
    promotionId: UUID with {
      briefly "Promotion ID"
      described as {
        |Promotion identifier.
      }
    }
    deactivatedAt: TimeStamp with {
      briefly "Deactivated"
      described as {
        |When deactivated.
      }
    }
  } with {
    briefly "Promotion was deactivated"
    described as {
      |Emitted when a promotional discount ends.
    }
  }
} with {
  option external()
  briefly "External pricing service"
  described as {
    |External system managing product pricing and promotions.
  }
}
// Inventory Service - Stock availability
context InventoryService is {
  event StockDepleted is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Out of stock product.
      }
    }
    sku: SKU with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    depletedAt: TimeStamp with {
      briefly "Depleted"
      described as {
        |When depleted.
      }
    }
  } with {
    briefly "Stock was depleted"
    described as {
      |Emitted when a product goes out of stock.
    }
  }
  event StockReplenished is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Replenished product.
      }
    }
    sku: SKU with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    availableQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Available quantity.
      }
    }
    replenishedAt: TimeStamp with {
      briefly "Replenished"
      described as {
        |When replenished.
      }
    }
  } with {
    briefly "Stock was replenished"
    described as {
      |Emitted when a product is back in stock.
    }
  }
  event StockReserved is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Reserved product.
      }
    }
    quantity: Quantity with {
      briefly "Quantity"
      described as {
        |Reserved quantity.
      }
    }
    cartId: CartId with {
      briefly "Cart ID"
      described as {
        |Reserving cart.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |When reserved.
      }
    }
    expiresAt: TimeStamp with {
      briefly "Expires"
      described as {
        |Reservation expiry.
      }
    }
  } with {
    briefly "Stock was reserved"
    described as {
      |Emitted when stock is reserved for a cart.
    }
  }
} with {
  option external()
  briefly "External inventory service"
  described as {
    |External system managing product inventory and reservations.
  }
}
// Order Service - Order creation
context OrderService is {
  command CreateOrder is  {
    cartId: CartId with {
      briefly "Cart ID"
      described as {
        |Source cart.
      }
    }
    customerId: CustomerId? with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    items: CartItem+ with {
      briefly "Items"
      described as {
        |Order items.
      }
    }
    orderShippingAddress: ShippingAddress with {
      briefly "Shipping"
      described as {
        |Delivery address.
      }
    }
    total: Money with {
      briefly "Total"
      described as {
        |Order total.
      }
    }
  } with {
    briefly "Create order from cart"
    described as {
      |Creates a new order from a checked out cart.
    }
  }
  event OrderCreated is  {
    orderId: UUID with {
      briefly "Order ID"
      described as {
        |New order identifier.
      }
    }
    cartId: CartId with {
      briefly "Cart ID"
      described as {
        |Source cart.
      }
    }
    total: Money with {
      briefly "Total"
      described as {
        |Order total.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Order was created"
    described as {
      |Emitted when an order is created from a cart.
    }
  }
} with {
  option external()
  briefly "External order service"
  described as {
    |External system managing order creation and fulfillment.
  }
}
// Customer Service - Customer identification
context CustomerService is {
  event CustomerAuthenticated is  {
    authenticatedCustomerId: CustomerId with {
      briefly "Customer ID"
      described as {
        |Authenticated customer.
      }
    }
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Browser session.
      }
    }
    authenticatedAt: TimeStamp with {
      briefly "Authenticated"
      described as {
        |When authenticated.
      }
    }
  } with {
    briefly "Customer was authenticated"
    described as {
      |Emitted when a customer logs in.
    }
  }
  event CustomerLoggedOut is  {
    loggedOutCustomerId: CustomerId with {
      briefly "Customer ID"
      described as {
        |Logged out customer.
      }
    }
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Browser session.
      }
    }
    loggedOutAt: TimeStamp with {
      briefly "Logged out"
      described as {
        |When logged out.
      }
    }
  } with {
    briefly "Customer logged out"
    described as {
      |Emitted when a customer ends their session.
    }
  }
} with {
  option external()
  briefly "External customer service"
  described as {
    |External system managing customer authentication.
  }
}
