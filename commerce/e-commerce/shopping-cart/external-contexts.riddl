// Shopping Cart - External Contexts

// Pricing Service - Product and promotional pricing
context PricingService is {

  event PriceChanged is {
    productId is ProductId with { briefly "Product ID" described by "Repriced product." }
    oldPrice is Money with { briefly "Old price" described by "Previous price." }
    newPrice is Money with { briefly "New price" described by "Updated price." }
    changedAt is TimeStamp with { briefly "Changed at" described by "When changed." }
  } with {
    briefly "Product price changed"
    described by "Emitted when a product price is updated."
  }

  event PromotionActivated is {
    promotionId is UUID with { briefly "Promotion ID" described by "Promotion identifier." }
    code is PromoCode with { briefly "Code" described by "Promo code." }
    discountPercent is Decimal(5, 2) with { briefly "Discount" described by "Discount percentage." }
    activatedAt is TimeStamp with { briefly "Activated" described by "When activated." }
  } with {
    briefly "Promotion was activated"
    described by "Emitted when a promotional discount becomes active."
  }

  event PromotionDeactivated is {
    promotionId is UUID with { briefly "Promotion ID" described by "Promotion identifier." }
    deactivatedAt is TimeStamp with { briefly "Deactivated" described by "When deactivated." }
  } with {
    briefly "Promotion was deactivated"
    described by "Emitted when a promotional discount ends."
  }

} with {
  option is external
  briefly "External pricing service"
  described by "External system managing product pricing and promotions."
}

// Inventory Service - Stock availability
context InventoryService is {

  event StockDepleted is {
    productId is ProductId with { briefly "Product ID" described by "Out of stock product." }
    sku is SKU with { briefly "SKU" described by "Product SKU." }
    depletedAt is TimeStamp with { briefly "Depleted" described by "When depleted." }
  } with {
    briefly "Stock was depleted"
    described by "Emitted when a product goes out of stock."
  }

  event StockReplenished is {
    productId is ProductId with { briefly "Product ID" described by "Replenished product." }
    sku is SKU with { briefly "SKU" described by "Product SKU." }
    quantity is Natural with { briefly "Quantity" described by "Available quantity." }
    replenishedAt is TimeStamp with { briefly "Replenished" described by "When replenished." }
  } with {
    briefly "Stock was replenished"
    described by "Emitted when a product is back in stock."
  }

  event StockReserved is {
    productId is ProductId with { briefly "Product ID" described by "Reserved product." }
    quantity is Quantity with { briefly "Quantity" described by "Reserved quantity." }
    cartId is CartId with { briefly "Cart ID" described by "Reserving cart." }
    reservedAt is TimeStamp with { briefly "Reserved" described by "When reserved." }
    expiresAt is TimeStamp with { briefly "Expires" described by "Reservation expiry." }
  } with {
    briefly "Stock was reserved"
    described by "Emitted when stock is reserved for a cart."
  }

} with {
  option is external
  briefly "External inventory service"
  described by "External system managing product inventory and reservations."
}

// Order Service - Order creation
context OrderService is {

  command CreateOrder is {
    cartId is CartId with { briefly "Cart ID" described by "Source cart." }
    customerId is optional CustomerId with { briefly "Customer" described by "Customer ID." }
    items is many CartItem with { briefly "Items" described by "Order items." }
    shippingAddress is ShippingAddress with { briefly "Shipping" described by "Delivery address." }
    total is Money with { briefly "Total" described by "Order total." }
  } with {
    briefly "Create order from cart"
    described by "Creates a new order from a checked out cart."
  }

  event OrderCreated is {
    orderId is UUID with { briefly "Order ID" described by "New order identifier." }
    cartId is CartId with { briefly "Cart ID" described by "Source cart." }
    total is Money with { briefly "Total" described by "Order total." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Order was created"
    described by "Emitted when an order is created from a cart."
  }

} with {
  option is external
  briefly "External order service"
  described by "External system managing order creation and fulfillment."
}

// Customer Service - Customer identification
context CustomerService is {

  event CustomerAuthenticated is {
    customerId is CustomerId with { briefly "Customer ID" described by "Authenticated customer." }
    sessionId is SessionId with { briefly "Session" described by "Browser session." }
    authenticatedAt is TimeStamp with { briefly "Authenticated" described by "When authenticated." }
  } with {
    briefly "Customer was authenticated"
    described by "Emitted when a customer logs in."
  }

  event CustomerLoggedOut is {
    customerId is CustomerId with { briefly "Customer ID" described by "Logged out customer." }
    sessionId is SessionId with { briefly "Session" described by "Browser session." }
    loggedOutAt is TimeStamp with { briefly "Logged out" described by "When logged out." }
  } with {
    briefly "Customer logged out"
    described by "Emitted when a customer ends their session."
  }

} with {
  option is external
  briefly "External customer service"
  described by "External system managing customer authentication."
}
