// Product Catalog - Category Entity
entity Category is {
  // Commands
  command CreateCategory is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Unique identifier for the new category.
      }
    }
    categoryName: String(1,100) with {
      briefly "Name"
      described as {
        |Display name for the category.
      }
    }
    categoryDescription: String(1,500) with {
      briefly "Description"
      described as {
        |Category description for navigation.
      }
    }
    parentId: CategoryId? with {
      briefly "Parent category"
      described as {
        |Parent category for hierarchical navigation.
      }
    }
    displayOrder: Natural with {
      briefly "Display order"
      described as {
        |Sort order for display in navigation.
      }
    }
  } with {
    briefly "Create a new category"
    described as {
      |Adds a new category to the catalog hierarchy.
    }
  }
  command UpdateCategory is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Category to update.
      }
    }
    updatedCategoryName: String(1,100)? with {
      briefly "Name"
      described as {
        |New name if changing.
      }
    }
    updatedCategoryDescription: String(1,500)? with {
      briefly "Description"
      described as {
        |New description if changing.
      }
    }
    newDisplayOrder: Natural? with {
      briefly "Display order"
      described as {
        |New sort order if changing.
      }
    }
  } with {
    briefly "Update category details"
    described as {
      |Modifies category information.
    }
  }
  command MoveCategory is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Category to move.
      }
    }
    newParentId: CategoryId? with {
      briefly "New parent"
      described as {
        |New parent category, or none for top-level.
      }
    }
  } with {
    briefly "Move category in hierarchy"
    described as {
      |Changes the parent of a category.
    }
  }
  command ActivateCategory is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Category to activate.
      }
    }
  } with {
    briefly "Activate category"
    described as {
      |Makes the category visible in navigation.
    }
  }
  command DeactivateCategory is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Category to deactivate.
      }
    }
  } with {
    briefly "Deactivate category"
    described as {
      |Hides the category from navigation.
    }
  }
  // Events
  event CategoryCreated is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |New category.
      }
    }
    categoryName: String(1,100) with {
      briefly "Name"
      described as {
        |Category name.
      }
    }
    parentId: CategoryId? with {
      briefly "Parent"
      described as {
        |Parent category.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created at"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Category was created"
    described as {
      |Emitted when a new category is added.
    }
  }
  event CategoryUpdated is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Updated category.
      }
    }
    updatedCategoryName: String(1,100)? with {
      briefly "Name"
      described as {
        |New name.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated at"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Category was updated"
    described as {
      |Emitted when category details change.
    }
  }
  event CategoryMoved is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Moved category.
      }
    }
    oldParentId: CategoryId? with {
      briefly "Old parent"
      described as {
        |Previous parent.
      }
    }
    newParentId: CategoryId? with {
      briefly "New parent"
      described as {
        |New parent.
      }
    }
    movedAt: TimeStamp with {
      briefly "Moved at"
      described as {
        |Move time.
      }
    }
  } with {
    briefly "Category was moved"
    described as {
      |Emitted when a category changes parent.
    }
  }
  event CategoryActivated is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Activated category.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated at"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Category was activated"
    described as {
      |Emitted when a category becomes visible.
    }
  }
  event CategoryDeactivated is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Deactivated category.
      }
    }
    deactivatedAt: TimeStamp with {
      briefly "Deactivated at"
      described as {
        |Deactivation time.
      }
    }
  } with {
    briefly "Category was deactivated"
    described as {
      |Emitted when a category is hidden.
    }
  }
  // State Records
  record ActiveCategoryData is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Category identifier.
      }
    }
    categoryName: String(1,100) with {
      briefly "Name"
      described as {
        |Category name.
      }
    }
    categoryDescription: String(1,500) with {
      briefly "Description"
      described as {
        |Category description.
      }
    }
    parentId: CategoryId? with {
      briefly "Parent"
      described as {
        |Parent category.
      }
    }
    displayOrder: Natural with {
      briefly "Order"
      described as {
        |Display order.
      }
    }
    productCount: Natural with {
      briefly "Products"
      described as {
        |Number of products.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Active category data"
    described as {
      |State data for a visible category.
    }
  }
  record InactiveCategoryData is  {
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Category identifier.
      }
    }
    categoryName: String(1,100) with {
      briefly "Name"
      described as {
        |Category name.
      }
    }
    deactivatedAt: TimeStamp with {
      briefly "Deactivated"
      described as {
        |Deactivation time.
      }
    }
  } with {
    briefly "Inactive category data"
    described as {
      |State data for a hidden category.
    }
  }
  // States
  state ActiveState of type Category.ActiveCategoryData
  state InactiveState of type Category.InactiveCategoryData
  // Handler
  handler CategoryHandler is {
    on command CreateCategory is {
      morph entity Category to state Category.ActiveState with command CreateCategory
      tell event CategoryCreated to entity Category
    }
    on command UpdateCategory is {
      tell event CategoryUpdated to entity Category
    }
    on command MoveCategory is {
      tell event CategoryMoved to entity Category
    }
    on command ActivateCategory is {
      morph entity Category to state Category.ActiveState with command ActivateCategory
      tell event CategoryActivated to entity Category
    }
    on command DeactivateCategory is {
      morph entity Category to state Category.InactiveState with command DeactivateCategory
      tell event CategoryDeactivated to entity Category
    }
  } with {
    briefly "Processes category commands"
    described as {
      |Handles category lifecycle and hierarchy management.
    }
  }
} with {
  briefly "Category for product organization"
  described as {
    | The Category entity manages hierarchical product categorization
    | for navigation and discovery. Categories can be nested and
    | activated or deactivated for display control.
  }
}
