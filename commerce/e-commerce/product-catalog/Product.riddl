// Product Catalog - Product Entity
entity Product is {
  // Commands
  command CreateProduct is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Unique identifier for the new product.
      }
    }
    sku: SKU with {
      briefly "SKU"
      described as {
        |Stock keeping unit for the product.
      }
    }
    name: ProductName with {
      briefly "Name"
      described as {
        |Display name for the product.
      }
    }
    description: ProductDescription with {
      briefly "Description"
      described as {
        |Detailed product description.
      }
    }
    basePrice: Money with {
      briefly "Base price"
      described as {
        |Default price before tier adjustments.
      }
    }
    attributes: AttributeValue+ with {
      briefly "Attributes"
      described as {
        |Product attributes like color, material, size.
      }
    }
    images: ImageUrl+ with {
      briefly "Images"
      described as {
        |Product image URLs.
      }
    }
  } with {
    briefly "Create a new product"
    described as {
      |Adds a new product to the catalog in draft status.
    }
  }
  command UpdateProduct is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product to update.
      }
    }
    updatedName: ProductName? with {
      briefly "Name"
      described as {
        |New product name if changing.
      }
    }
    updatedDescription: ProductDescription? with {
      briefly "Description"
      described as {
        |New description if changing.
      }
    }
    updatedAttributes: AttributeValue* with {
      briefly "Attributes"
      described as {
        |Updated attributes if changing.
      }
    }
    updatedImages: ImageUrl* with {
      briefly "Images"
      described as {
        |Updated images if changing.
      }
    }
  } with {
    briefly "Update product details"
    described as {
      |Modifies product information for an existing product.
    }
  }
  command SetPrice is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product to price.
      }
    }
    basePrice: Money with {
      briefly "Base price"
      described as {
        |New base price for the product.
      }
    }
    tiers: PriceTier* with {
      briefly "Price tiers"
      described as {
        |Volume or segment-based pricing tiers.
      }
    }
  } with {
    briefly "Set product pricing"
    described as {
      |Updates the base price and optional pricing tiers.
    }
  }
  command AddVariant is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product to add variant to.
      }
    }
    variant: ProductVariant with {
      briefly "Variant"
      described as {
        |The variant to add.
      }
    }
  } with {
    briefly "Add a product variant"
    described as {
      |Adds a variant with specific attributes like size or color.
    }
  }
  command AssignCategory is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product to categorize.
      }
    }
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Category to assign.
      }
    }
    isPrimary: Boolean with {
      briefly "Primary category"
      described as {
        |Whether this is the primary category for navigation.
      }
    }
  } with {
    briefly "Assign product to category"
    described as {
      |Associates the product with a category for navigation.
    }
  }
  command PublishProduct is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product to publish.
      }
    }
  } with {
    briefly "Publish product to catalog"
    described as {
      |Makes the product visible to customers in the catalog.
    }
  }
  command RetireProduct is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product to retire.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Explanation for retiring the product.
      }
    }
  } with {
    briefly "Retire a product"
    described as {
      |Marks the product as discontinued and removes from active catalog.
    }
  }
  // Events
  event ProductCreated is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |New product identifier.
      }
    }
    sku: SKU with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    name: ProductName with {
      briefly "Name"
      described as {
        |Product name.
      }
    }
    description: ProductDescription with {
      briefly "Description"
      described as {
        |Product description.
      }
    }
    basePrice: Money with {
      briefly "Base price"
      described as {
        |Initial price.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created at"
      described as {
        |When the product was created.
      }
    }
  } with {
    briefly "Product was created"
    described as {
      |Emitted when a new product is added to the catalog.
    }
  }
  event ProductUpdated is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Updated product.
      }
    }
    updatedName: ProductName? with {
      briefly "Name"
      described as {
        |New name if changed.
      }
    }
    updatedDescription: ProductDescription? with {
      briefly "Description"
      described as {
        |New description if changed.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated at"
      described as {
        |When the update occurred.
      }
    }
  } with {
    briefly "Product details were updated"
    described as {
      |Emitted when product information is modified.
    }
  }
  event PriceChanged is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Repriced product.
      }
    }
    oldPrice: Money with {
      briefly "Old price"
      described as {
        |Previous base price.
      }
    }
    newPrice: Money with {
      briefly "New price"
      described as {
        |New base price.
      }
    }
    changedAt: TimeStamp with {
      briefly "Changed at"
      described as {
        |When price changed.
      }
    }
  } with {
    briefly "Product price was changed"
    described as {
      |Emitted when the product base price is updated.
    }
  }
  event VariantAdded is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Parent product.
      }
    }
    variant: ProductVariant with {
      briefly "Variant"
      described as {
        |The added variant.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added at"
      described as {
        |When variant was added.
      }
    }
  } with {
    briefly "Variant was added to product"
    described as {
      |Emitted when a new variant is added to a product.
    }
  }
  event CategoryAssigned is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Categorized product.
      }
    }
    categoryId: CategoryId with {
      briefly "Category ID"
      described as {
        |Assigned category.
      }
    }
    isPrimary: Boolean with {
      briefly "Primary"
      described as {
        |If primary category.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned at"
      described as {
        |When assigned.
      }
    }
  } with {
    briefly "Product was assigned to category"
    described as {
      |Emitted when a product is categorized.
    }
  }
  event ProductPublished is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Published product.
      }
    }
    publishedAt: TimeStamp with {
      briefly "Published at"
      described as {
        |When published.
      }
    }
  } with {
    briefly "Product was published"
    described as {
      |Emitted when a product becomes visible in the catalog.
    }
  }
  event ProductRetired is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Retired product.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Retirement reason.
      }
    }
    retiredAt: TimeStamp with {
      briefly "Retired at"
      described as {
        |When retired.
      }
    }
  } with {
    briefly "Product was retired"
    described as {
      |Emitted when a product is discontinued.
    }
  }
  // State Records
  record DraftProductData is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product identifier.
      }
    }
    sku: SKU with {
      briefly "SKU"
      described as {
        |Stock keeping unit.
      }
    }
    name: ProductName with {
      briefly "Name"
      described as {
        |Product name.
      }
    }
    description: ProductDescription with {
      briefly "Description"
      described as {
        |Product description.
      }
    }
    basePrice: Money with {
      briefly "Base price"
      described as {
        |Default price.
      }
    }
    attributes: AttributeValue+ with {
      briefly "Attributes"
      described as {
        |Product attributes.
      }
    }
    images: ImageUrl+ with {
      briefly "Images"
      described as {
        |Product images.
      }
    }
    variants: ProductVariant+ with {
      briefly "Variants"
      described as {
        |Product variants.
      }
    }
    categories: CategoryId+ with {
      briefly "Categories"
      described as {
        |Assigned categories.
      }
    }
    primaryCategory: CategoryId? with {
      briefly "Primary category"
      described as {
        |Main category.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Draft product data"
    described as {
      |State data for a product being prepared for publication.
    }
  }
  record ActiveProductData is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product identifier.
      }
    }
    sku: SKU with {
      briefly "SKU"
      described as {
        |Stock keeping unit.
      }
    }
    name: ProductName with {
      briefly "Name"
      described as {
        |Product name.
      }
    }
    description: ProductDescription with {
      briefly "Description"
      described as {
        |Product description.
      }
    }
    basePrice: Money with {
      briefly "Base price"
      described as {
        |Default price.
      }
    }
    priceTiers: PriceTier+ with {
      briefly "Price tiers"
      described as {
        |Volume pricing.
      }
    }
    attributes: AttributeValue+ with {
      briefly "Attributes"
      described as {
        |Product attributes.
      }
    }
    images: ImageUrl+ with {
      briefly "Images"
      described as {
        |Product images.
      }
    }
    variants: ProductVariant+ with {
      briefly "Variants"
      described as {
        |Product variants.
      }
    }
    categories: CategoryId+ with {
      briefly "Categories"
      described as {
        |Assigned categories.
      }
    }
    primaryCategory: CategoryId? with {
      briefly "Primary category"
      described as {
        |Main category.
      }
    }
    publishedAt: TimeStamp with {
      briefly "Published"
      described as {
        |Publication time.
      }
    }
  } with {
    briefly "Active product data"
    described as {
      |State data for a published product visible in the catalog.
    }
  }
  record RetiredProductData is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product identifier.
      }
    }
    sku: SKU with {
      briefly "SKU"
      described as {
        |Stock keeping unit.
      }
    }
    name: ProductName with {
      briefly "Name"
      described as {
        |Product name.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Retirement reason.
      }
    }
    retiredAt: TimeStamp with {
      briefly "Retired"
      described as {
        |Retirement time.
      }
    }
  } with {
    briefly "Retired product data"
    described as {
      |State data for a discontinued product.
    }
  }
  // States
  state Draft of type Product.DraftProductData
  state Active of type Product.ActiveProductData
  state Retired of type Product.RetiredProductData
  // Handler
  handler ProductHandler is {
    on command CreateProduct is {
      morph entity Product to state Product.Draft with command CreateProduct
      tell event ProductCreated to entity Product
    }
    on command UpdateProduct is {
      tell event ProductUpdated to entity Product
    }
    on command SetPrice is {
      tell event PriceChanged to entity Product
    }
    on command AddVariant is {
      tell event VariantAdded to entity Product
    }
    on command AssignCategory is {
      tell event CategoryAssigned to entity Product
    }
    on command PublishProduct is {
      morph entity Product to state Product.Active with command PublishProduct
      tell event ProductPublished to entity Product
    }
    on command RetireProduct is {
      morph entity Product to state Product.Retired with command RetireProduct
      tell event ProductRetired to entity Product
    }
  } with {
    briefly "Processes product lifecycle commands"
    described as {
      | Handles all commands related to product management including
      | creation, updates, pricing, categorization, and lifecycle changes.
    }
  }
} with {
  briefly "Product aggregate for catalog items"
  described as {
    | The Product entity manages individual products in the catalog including
    | their attributes, variants, pricing, and categorization. Products
    | progress through draft, active, and retired states.
  }
}
