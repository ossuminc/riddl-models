// Product Catalog - PriceList Entity
entity PriceList is {
  // Commands
  command CreatePriceList is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |Unique identifier for the new price list.
      }
    }
    listName: String(1,100) with {
      briefly "Name"
      described as {
        |Display name for the price list.
      }
    }
    listDescription: String(1,500) with {
      briefly "Description"
      described as {
        |Description of when this price list applies.
      }
    }
    currency: Currency(USD) with {
      briefly "Currency"
      described as {
        |Currency for all prices in this list.
      }
    }
    priority: Natural with {
      briefly "Priority"
      described as {
        |Priority for price selection when multiple lists apply.
      }
    }
  } with {
    briefly "Create a new price list"
    described as {
      |Adds a new price list for segment or promotional pricing.
    }
  }
  command SetProductPrice is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |Price list to update.
      }
    }
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product to price.
      }
    }
    price: Money with {
      briefly "Price"
      described as {
        |Price for this product in this list.
      }
    }
    effectiveFrom: Date? with {
      briefly "Effective from"
      described as {
        |When price becomes effective.
      }
    }
    effectiveTo: Date? with {
      briefly "Effective to"
      described as {
        |When price expires.
      }
    }
  } with {
    briefly "Set product price in list"
    described as {
      |Sets the price for a specific product in this price list.
    }
  }
  command ActivatePriceList is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |Price list to activate.
      }
    }
  } with {
    briefly "Activate price list"
    described as {
      |Makes the price list active for price selection.
    }
  }
  command DeactivatePriceList is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |Price list to deactivate.
      }
    }
  } with {
    briefly "Deactivate price list"
    described as {
      |Removes the price list from active price selection.
    }
  }
  // Events
  event PriceListCreated is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |New price list.
      }
    }
    listName: String(1,100) with {
      briefly "Name"
      described as {
        |Price list name.
      }
    }
    currency: Currency(USD) with {
      briefly "Currency"
      described as {
        |List currency.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created at"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Price list was created"
    described as {
      |Emitted when a new price list is added.
    }
  }
  event ProductPriceSet is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |Price list.
      }
    }
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Priced product.
      }
    }
    price: Money with {
      briefly "Price"
      described as {
        |Set price.
      }
    }
    setAt: TimeStamp with {
      briefly "Set at"
      described as {
        |When price was set.
      }
    }
  } with {
    briefly "Product price was set"
    described as {
      |Emitted when a product price is set in the list.
    }
  }
  event PriceListActivated is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |Activated list.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated at"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Price list was activated"
    described as {
      |Emitted when a price list becomes active.
    }
  }
  event PriceListDeactivated is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |Deactivated list.
      }
    }
    deactivatedAt: TimeStamp with {
      briefly "Deactivated at"
      described as {
        |Deactivation time.
      }
    }
  } with {
    briefly "Price list was deactivated"
    described as {
      |Emitted when a price list is deactivated.
    }
  }
  // State Records
  record ProductPriceEntry is  {
    productId: ProductId with {
      briefly "Product ID"
      described as {
        |Product identifier.
      }
    }
    price: Money with {
      briefly "Price"
      described as {
        |Product price.
      }
    }
    effectiveFrom: Date? with {
      briefly "From"
      described as {
        |Start date.
      }
    }
    effectiveTo: Date? with {
      briefly "To"
      described as {
        |End date.
      }
    }
  } with {
    briefly "Price entry for a product"
    described as {
      |A single product price within a price list.
    }
  }
  record ActivePriceListData is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |List identifier.
      }
    }
    listName: String(1,100) with {
      briefly "Name"
      described as {
        |List name.
      }
    }
    listDescription: String(1,500) with {
      briefly "Description"
      described as {
        |List description.
      }
    }
    currency: Currency(USD) with {
      briefly "Currency"
      described as {
        |List currency.
      }
    }
    priority: Natural with {
      briefly "Priority"
      described as {
        |Selection priority.
      }
    }
    prices: ProductPriceEntry+ with {
      briefly "Prices"
      described as {
        |Product prices.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Active price list data"
    described as {
      |State data for an active price list.
    }
  }
  record InactivePriceListData is  {
    priceListId: PriceListId with {
      briefly "Price list ID"
      described as {
        |List identifier.
      }
    }
    listName: String(1,100) with {
      briefly "Name"
      described as {
        |List name.
      }
    }
    deactivatedAt: TimeStamp with {
      briefly "Deactivated"
      described as {
        |Deactivation time.
      }
    }
  } with {
    briefly "Inactive price list data"
    described as {
      |State data for a deactivated price list.
    }
  }
  // States
  state ActivePriceListState of type PriceList.ActivePriceListData
  state InactivePriceListState of type PriceList.InactivePriceListData
  // Handler
  handler PriceListHandler is {
    on command CreatePriceList is {
      morph entity PriceList to state PriceList.ActivePriceListState with command CreatePriceList
      tell event PriceListCreated to entity PriceList
    }
    on command SetProductPrice is {
      tell event ProductPriceSet to entity PriceList
    }
    on command ActivatePriceList is {
      morph entity PriceList to state PriceList.ActivePriceListState with command ActivatePriceList
      tell event PriceListActivated to entity PriceList
    }
    on command DeactivatePriceList is {
      morph entity PriceList to state PriceList.InactivePriceListState with command DeactivatePriceList
      tell event PriceListDeactivated to entity PriceList
    }
  } with {
    briefly "Processes price list commands"
    described as {
      |Handles price list management and product pricing.
    }
  }
} with {
  briefly "Price list for segment pricing"
  described as {
    | The PriceList entity manages pricing tiers for different customer
    | segments, promotions, or time-based pricing. Multiple price lists
    | can be active with priority-based selection.
  }
}
