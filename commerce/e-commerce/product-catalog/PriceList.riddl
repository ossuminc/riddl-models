// Product Catalog - PriceList Entity

entity PriceList is {

  // Commands
  command CreatePriceList is {
    priceListId is PriceListId with {
      briefly "Price list ID"
      described by "Unique identifier for the new price list."
    }
    name is String(1, 100) with {
      briefly "Name"
      described by "Display name for the price list."
    }
    description is String(1, 500) with {
      briefly "Description"
      described by "Description of when this price list applies."
    }
    currency is Currency(USD) with {
      briefly "Currency"
      described by "Currency for all prices in this list."
    }
    priority is Natural with {
      briefly "Priority"
      described by "Priority for price selection when multiple lists apply."
    }
  } with {
    briefly "Create a new price list"
    described by "Adds a new price list for segment or promotional pricing."
  }

  command SetProductPrice is {
    priceListId is PriceListId with {
      briefly "Price list ID"
      described by "Price list to update."
    }
    productId is ProductId with {
      briefly "Product ID"
      described by "Product to price."
    }
    price is Money with {
      briefly "Price"
      described by "Price for this product in this list."
    }
    effectiveFrom is optional Date with {
      briefly "Effective from"
      described by "When price becomes effective."
    }
    effectiveTo is optional Date with {
      briefly "Effective to"
      described by "When price expires."
    }
  } with {
    briefly "Set product price in list"
    described by "Sets the price for a specific product in this price list."
  }

  command ActivatePriceList is {
    priceListId is PriceListId with {
      briefly "Price list ID"
      described by "Price list to activate."
    }
  } with {
    briefly "Activate price list"
    described by "Makes the price list active for price selection."
  }

  command DeactivatePriceList is {
    priceListId is PriceListId with {
      briefly "Price list ID"
      described by "Price list to deactivate."
    }
  } with {
    briefly "Deactivate price list"
    described by "Removes the price list from active price selection."
  }

  // Events
  event PriceListCreated is {
    priceListId is PriceListId with { briefly "Price list ID" described by "New price list." }
    name is String(1, 100) with { briefly "Name" described by "Price list name." }
    currency is Currency(USD) with { briefly "Currency" described by "List currency." }
    createdAt is TimeStamp with { briefly "Created at" described by "Creation time." }
  } with {
    briefly "Price list was created"
    described by "Emitted when a new price list is added."
  }

  event ProductPriceSet is {
    priceListId is PriceListId with { briefly "Price list ID" described by "Price list." }
    productId is ProductId with { briefly "Product ID" described by "Priced product." }
    price is Money with { briefly "Price" described by "Set price." }
    setAt is TimeStamp with { briefly "Set at" described by "When price was set." }
  } with {
    briefly "Product price was set"
    described by "Emitted when a product price is set in the list."
  }

  event PriceListActivated is {
    priceListId is PriceListId with { briefly "Price list ID" described by "Activated list." }
    activatedAt is TimeStamp with { briefly "Activated at" described by "Activation time." }
  } with {
    briefly "Price list was activated"
    described by "Emitted when a price list becomes active."
  }

  event PriceListDeactivated is {
    priceListId is PriceListId with { briefly "Price list ID" described by "Deactivated list." }
    deactivatedAt is TimeStamp with { briefly "Deactivated at" described by "Deactivation time." }
  } with {
    briefly "Price list was deactivated"
    described by "Emitted when a price list is deactivated."
  }

  // State Records
  record ProductPriceEntry is {
    productId is ProductId with { briefly "Product ID" described by "Product identifier." }
    price is Money with { briefly "Price" described by "Product price." }
    effectiveFrom is optional Date with { briefly "From" described by "Start date." }
    effectiveTo is optional Date with { briefly "To" described by "End date." }
  } with {
    briefly "Price entry for a product"
    described by "A single product price within a price list."
  }

  record ActivePriceListData is {
    priceListId is PriceListId with { briefly "Price list ID" described by "List identifier." }
    name is String(1, 100) with { briefly "Name" described by "List name." }
    description is String(1, 500) with { briefly "Description" described by "List description." }
    currency is Currency(USD) with { briefly "Currency" described by "List currency." }
    priority is Natural with { briefly "Priority" described by "Selection priority." }
    prices is many ProductPriceEntry with { briefly "Prices" described by "Product prices." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
    activatedAt is TimeStamp with { briefly "Activated" described by "Activation time." }
  } with {
    briefly "Active price list data"
    described by "State data for an active price list."
  }

  record InactivePriceListData is {
    priceListId is PriceListId with { briefly "Price list ID" described by "List identifier." }
    name is String(1, 100) with { briefly "Name" described by "List name." }
    deactivatedAt is TimeStamp with { briefly "Deactivated" described by "Deactivation time." }
  } with {
    briefly "Inactive price list data"
    described by "State data for a deactivated price list."
  }

  // States
  state ActivePriceListState of PriceList.ActivePriceListData with {
    briefly "Price list is active"
    described by "Price list is used for price selection."
  }

  state InactivePriceListState of PriceList.InactivePriceListData with {
    briefly "Price list is inactive"
    described by "Price list is not used for price selection."
  }

  // Handler
  handler PriceListHandler is {
    on command CreatePriceList {
      morph entity PriceList to state PriceList.ActivePriceListState with command CreatePriceList
      tell event PriceListCreated to entity PriceList
    }

    on command SetProductPrice {
      tell event ProductPriceSet to entity PriceList
    }

    on command ActivatePriceList {
      morph entity PriceList to state PriceList.ActivePriceListState with command ActivatePriceList
      tell event PriceListActivated to entity PriceList
    }

    on command DeactivatePriceList {
      morph entity PriceList to state PriceList.InactivePriceListState with command DeactivatePriceList
      tell event PriceListDeactivated to entity PriceList
    }
  } with {
    briefly "Processes price list commands"
    described by "Handles price list management and product pricing."
  }

} with {
  briefly "Price list for segment pricing"
  described by {
    | The PriceList entity manages pricing tiers for different customer
    | segments, promotions, or time-based pricing. Multiple price lists
    | can be active with priority-based selection.
  }
}
