// Product Catalog - Catalog Context
context CatalogContext is {
  include "types.riddl"
  include "Product.riddl"
  include "Category.riddl"
  include "PriceList.riddl"
  // Adaptors for external system integration
  adaptor InventoryAdapter from context InventoryService is { 
    handler InventoryEvents is {
      on event InventoryService.StockLevelChanged is {
        prompt "Update product availability display"
      }
      on event InventoryService.StockDepleted is {
        prompt "Mark product as out of stock"
      }
    } with {
      briefly "Handles inventory events"
      described as {
        |Processes inventory updates for availability display.
      }
    }
  } with {
    briefly "Inventory integration"
    described as {
      |Receives stock level updates from the inventory system.
    }
  }
  adaptor SearchAdapter to context SearchEngine is { 
    handler SearchIndexing is {
      on command SearchEngine.IndexProduct is {
        prompt "Index or update product in search engine"
      }
      on command SearchEngine.RemoveProduct is {
        prompt "Remove product from search index"
      }
    } with {
      briefly "Handles search indexing"
      described as {
        |Translates product commands for search engine indexing.
      }
    }
  } with {
    briefly "Search engine integration"
    described as {
      |Publishes product changes to the search engine for discovery.
    }
  }
  adaptor ContentAdapter from context ContentManagement is { 
    handler ContentEvents is {
      on event ContentManagement.ImageUploaded is {
        prompt "Associate image with product"
      }
      on event ContentManagement.ImageDeleted is {
        prompt "Remove image reference from product"
      }
    } with {
      briefly "Handles content events"
      described as {
        |Processes image and content updates.
      }
    }
  } with {
    briefly "Content management integration"
    described as {
      |Receives image and content updates from the CMS.
    }
  }
  // Repository for catalog persistence
  repository CatalogRepository is {
    schema CatalogData is relational
      of categories as type Category
      of priceLists as type PriceList
      of products as type Product
        link productCategories as field Product.primaryCategory to field Category.categoryId
        index on field Product.sku
        index on field Product.name
        index on field Category.categoryName

    handler CatalogPersistence is {
      on command Product.CreateProduct is {
        prompt "Persist new product to database"
      }
      on command Product.UpdateProduct is {
        prompt "Update product in database"
      }
      on command Product.SetPrice is {
        prompt "Update product price in database"
      }
      on command Product.PublishProduct is {
        prompt "Update product status to published"
      }
      on command Product.RetireProduct is {
        prompt "Update product status to retired"
      }
      on command Category.CreateCategory is {
        prompt "Persist new category"
      }
      on command Category.UpdateCategory is {
        prompt "Update category in database"
      }
      on command PriceList.CreatePriceList is {
        prompt "Persist new price list"
      }
      on command PriceList.SetProductPrice is {
        prompt "Update product price in list"
      }
    } with {
      briefly "Persists catalog commands"
      described as {
        |Handles command-driven persistence for catalog data.
      }
    }
  } with {
    briefly "Catalog data persistence"
    described as {
      | The CatalogRepository provides persistent storage for products,
      | categories, and price lists with indexes for efficient queries.
    }
  }
  // Projector for catalog views
  projector CatalogViews is {
    record ProductSummary is  {
      productId: ProductId with {
        briefly "ID"
        described as {
          |Product identifier.
        }
      }
      sku: SKU with {
        briefly "SKU"
        described as {
          |Stock keeping unit.
        }
      }
      name: ProductName with {
        briefly "Name"
        described as {
          |Product name.
        }
      }
      basePrice: Money with {
        briefly "Price"
        described as {
          |Base price.
        }
      }
      category: String(1,100) with {
        briefly "Category"
        described as {
          |Primary category name.
        }
      }
      status: ProductStatus with {
        briefly "Status"
        described as {
          |Product status.
        }
      }
      imageUrl: ImageUrl? with {
        briefly "Image"
        described as {
          |Primary image URL.
        }
      }
    } with {
      briefly "Product summary for listings"
      described as {
        |Lightweight product view for catalog listings.
      }
    }
    handler ViewHandler is {
      on event Product.ProductCreated is {
        prompt "Create product summary view"
      }
      on event Product.ProductPublished is {
        prompt "Update product summary as active"
      }
      on event Product.CategoryAssigned is {
        prompt "Update product category in summary"
      }
    } with {
      briefly "Maintains catalog views"
      described as {
        |Projects events into optimized read views.
      }
    }
  } with {
    briefly "Catalog view projections"
    described as {
      |Maintains read-optimized views of catalog data.
    }
  }
} with {
  briefly "Bounded context for product catalog"
  described as {
    | The CatalogContext is the bounded context for product catalog
    | management. It contains entities for products, categories, and
    | price lists, with integrations to inventory, search, and content
    | management systems.
  }
}
