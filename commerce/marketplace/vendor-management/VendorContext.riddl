// Vendor Management - Vendor Context

context VendorContext is {

  include "types.riddl"
  include "Vendor.riddl"

  // Adaptors for external system integration
  adaptor PaymentAdapter to context PaymentService is {
    handler PayoutProcessing is {
      on command PaymentService.CreatePayoutAccount {
        prompt "Create vendor payout account"
      }
      on command PaymentService.ProcessPayout {
        prompt "Process vendor payout"
      }
    } with {
      briefly "Handles payout setup"
      described by "Configures vendor payment accounts."
    }
  } with {
    briefly "Payment integration"
    described by "Manages vendor payout configuration."
  }

  adaptor OrderAdapter from context OrderService is {
    handler OrderEvents is {
      on event OrderService.OrderFulfilled {
        prompt "Calculate vendor commission and queue payout"
      }
      on event OrderService.OrderReturned {
        prompt "Adjust vendor balance for return"
      }
    } with {
      briefly "Handles order events"
      described by "Processes orders for commission calculation."
    }
  } with {
    briefly "Order service integration"
    described by "Receives order events for vendor earnings."
  }

  adaptor NotificationAdapter to context NotificationService is {
    handler VendorNotifications is {
      on command NotificationService.SendEmail {
        prompt "Send vendor lifecycle notification email"
      }
    } with {
      briefly "Handles vendor notifications"
      described by "Sends notifications for vendor lifecycle events."
    }
  } with {
    briefly "Notification integration"
    described by "Publishes vendor events for notifications."
  }

  // Repository for vendor persistence
  repository VendorRepository is {
    schema VendorData is relational
      of vendors as Vendor
      index on field Vendor.businessName
      index on field Vendor.storeName
      index on field Vendor.email

    handler VendorPersistence is {
      on command Vendor.SubmitApplication {
        prompt "Persist new vendor application"
      }
      on command Vendor.ApproveVendor {
        prompt "Update vendor status to active"
      }
      on command Vendor.RejectVendor {
        prompt "Update vendor status to rejected"
      }
      on command Vendor.UpdateVendorInfo {
        prompt "Update vendor profile"
      }
      on command Vendor.SetBankAccount {
        prompt "Update payout account"
      }
      on command Vendor.SuspendVendor {
        prompt "Update vendor status to suspended"
      }
      on command Vendor.ReinstateVendor {
        prompt "Update vendor status to active"
      }
      on command Vendor.TerminateVendor {
        prompt "Update vendor status to terminated"
      }
      on command Vendor.UpdatePerformance {
        prompt "Update vendor performance metrics"
      }
    } with {
      briefly "Persists vendor commands"
      described by "Handles command-driven persistence for vendor data."
    }
  } with {
    briefly "Vendor data persistence"
    described by {
      | The VendorRepository provides persistent storage for vendors
      | with indexes for searching by name and email.
    }
  }

  // Projector for vendor analytics
  projector VendorAnalytics is {
    updates repository VendorRepository

    record VendorPerformanceSummary is {
      vendorId is VendorId with { briefly "Vendor" described by "Vendor identifier." }
      storeName is StoreName with { briefly "Store" described by "Store name." }
      tier is VendorTier with { briefly "Tier" described by "Vendor tier." }
      totalOrders is Natural with { briefly "Orders" described by "Total orders fulfilled." }
      totalRevenue is Money with { briefly "Revenue" described by "Total revenue generated." }
      avgRating is Decimal(3, 2) with { briefly "Rating" described by "Average rating." }
    } with {
      briefly "Vendor performance summary"
      described by "Aggregated vendor performance data."
    }

    handler AnalyticsHandler is {
      on event Vendor.PerformanceUpdated {
        prompt "Update vendor performance summary"
      }
      on event Vendor.VendorApproved {
        prompt "Initialize vendor analytics record"
      }
    } with {
      briefly "Maintains analytics views"
      described by "Projects events into analytics data."
    }
  } with {
    briefly "Vendor analytics projections"
    described by "Maintains performance analytics for vendors."
  }

} with {
  briefly "Bounded context for vendor management"
  described by {
    | The VendorContext is the bounded context for marketplace vendor
    | management. It contains the Vendor entity with integrations to
    | payment, order, and notification systems.
  }
}
