// Vendor Management - Vendor Entity

entity Vendor is {

  // Commands
  command SubmitApplication is {
    vendorId is VendorId with {
      briefly "Vendor ID"
      described by "Unique identifier for the new vendor."
    }
    businessName is BusinessName with {
      briefly "Business name"
      described by "Legal business name."
    }
    storeName is StoreName with {
      briefly "Store name"
      described by "Display name for storefront."
    }
    taxId is TaxId with {
      briefly "Tax ID"
      described by "Business tax identification."
    }
    email is Email with {
      briefly "Email"
      described by "Primary contact email."
    }
    phone is PhoneNumber with {
      briefly "Phone"
      described by "Contact phone number."
    }
    businessAddress is Address with {
      briefly "Business address"
      described by "Business location address."
    }
    category is VendorCategory with {
      briefly "Category"
      described by "Primary product category."
    }
  } with {
    briefly "Submit vendor application"
    described by "Submits a new vendor application for review."
  }

  command ApproveVendor is {
    vendorId is VendorId with {
      briefly "Vendor ID"
      described by "Vendor to approve."
    }
    tier is VendorTier with {
      briefly "Tier"
      described by "Assigned vendor tier."
    }
    commissionRates is many CommissionRate with {
      briefly "Commission rates"
      described by "Commission rates by category."
    }
    approvedBy is String(1, 100) with {
      briefly "Approved by"
      described by "Administrator who approved."
    }
  } with {
    briefly "Approve vendor application"
    described by "Approves a pending vendor application."
  }

  command RejectVendor is {
    vendorId is VendorId with {
      briefly "Vendor ID"
      described by "Vendor to reject."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Rejection reason."
    }
    rejectedBy is String(1, 100) with {
      briefly "Rejected by"
      described by "Administrator who rejected."
    }
  } with {
    briefly "Reject vendor application"
    described by "Rejects a pending vendor application."
  }

  command UpdateVendorInfo is {
    vendorId is VendorId with {
      briefly "Vendor ID"
      described by "Vendor to update."
    }
    storeName is optional StoreName with {
      briefly "Store name"
      described by "New store name if changing."
    }
    email is optional Email with {
      briefly "Email"
      described by "New email if changing."
    }
    phone is optional PhoneNumber with {
      briefly "Phone"
      described by "New phone if changing."
    }
    businessAddress is optional Address with {
      briefly "Address"
      described by "New address if changing."
    }
  } with {
    briefly "Update vendor information"
    described by "Updates vendor profile information."
  }

  command SetBankAccount is {
    vendorId is VendorId with {
      briefly "Vendor ID"
      described by "Vendor to update."
    }
    bankAccount is BankAccount with {
      briefly "Bank account"
      described by "New banking details."
    }
  } with {
    briefly "Set payout bank account"
    described by "Sets or updates the vendor's payout account."
  }

  command SuspendVendor is {
    vendorId is VendorId with {
      briefly "Vendor ID"
      described by "Vendor to suspend."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Suspension reason."
    }
    suspendedBy is String(1, 100) with {
      briefly "Suspended by"
      described by "Administrator who suspended."
    }
  } with {
    briefly "Suspend vendor"
    described by "Temporarily suspends a vendor's selling privileges."
  }

  command ReinstateVendor is {
    vendorId is VendorId with {
      briefly "Vendor ID"
      described by "Vendor to reinstate."
    }
    reinstatedBy is String(1, 100) with {
      briefly "Reinstated by"
      described by "Administrator who reinstated."
    }
  } with {
    briefly "Reinstate vendor"
    described by "Restores a suspended vendor's privileges."
  }

  command TerminateVendor is {
    vendorId is VendorId with {
      briefly "Vendor ID"
      described by "Vendor to terminate."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Termination reason."
    }
    terminatedBy is String(1, 100) with {
      briefly "Terminated by"
      described by "Administrator who terminated."
    }
  } with {
    briefly "Terminate vendor relationship"
    described by "Permanently ends the vendor relationship."
  }

  command UpdatePerformance is {
    vendorId is VendorId with {
      briefly "Vendor ID"
      described by "Vendor to update."
    }
    metrics is PerformanceMetrics with {
      briefly "Metrics"
      described by "Updated performance metrics."
    }
  } with {
    briefly "Update performance metrics"
    described by "Updates vendor performance tracking data."
  }

  // Events
  event ApplicationSubmitted is {
    vendorId is VendorId with { briefly "Vendor ID" described by "New vendor identifier." }
    businessName is BusinessName with { briefly "Business" described by "Business name." }
    storeName is StoreName with { briefly "Store" described by "Store name." }
    category is VendorCategory with { briefly "Category" described by "Product category." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submission time." }
  } with {
    briefly "Application was submitted"
    described by "Emitted when a new vendor application is received."
  }

  event VendorApproved is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Approved vendor." }
    tier is VendorTier with { briefly "Tier" described by "Assigned tier." }
    approvedBy is String(1, 100) with { briefly "Approved by" described by "Administrator." }
    approvedAt is TimeStamp with { briefly "Approved" described by "Approval time." }
  } with {
    briefly "Vendor was approved"
    described by "Emitted when a vendor application is approved."
  }

  event VendorRejected is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Rejected vendor." }
    reason is String(1, 500) with { briefly "Reason" described by "Rejection reason." }
    rejectedBy is String(1, 100) with { briefly "Rejected by" described by "Administrator." }
    rejectedAt is TimeStamp with { briefly "Rejected" described by "Rejection time." }
  } with {
    briefly "Vendor was rejected"
    described by "Emitted when a vendor application is rejected."
  }

  event VendorInfoUpdated is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Updated vendor." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Vendor info was updated"
    described by "Emitted when vendor profile is modified."
  }

  event BankAccountSet is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Vendor." }
    bankName is String(1, 100) with { briefly "Bank" described by "Bank name." }
    setAt is TimeStamp with { briefly "Set at" described by "When set." }
  } with {
    briefly "Bank account was set"
    described by "Emitted when payout account is configured."
  }

  event VendorSuspended is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Suspended vendor." }
    reason is String(1, 500) with { briefly "Reason" described by "Suspension reason." }
    suspendedBy is String(1, 100) with { briefly "Suspended by" described by "Administrator." }
    suspendedAt is TimeStamp with { briefly "Suspended" described by "Suspension time." }
  } with {
    briefly "Vendor was suspended"
    described by "Emitted when vendor selling is suspended."
  }

  event VendorReinstated is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Reinstated vendor." }
    reinstatedBy is String(1, 100) with { briefly "Reinstated by" described by "Administrator." }
    reinstatedAt is TimeStamp with { briefly "Reinstated" described by "Reinstatement time." }
  } with {
    briefly "Vendor was reinstated"
    described by "Emitted when suspended vendor is restored."
  }

  event VendorTerminated is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Terminated vendor." }
    reason is String(1, 500) with { briefly "Reason" described by "Termination reason." }
    terminatedBy is String(1, 100) with { briefly "Terminated by" described by "Administrator." }
    terminatedAt is TimeStamp with { briefly "Terminated" described by "Termination time." }
  } with {
    briefly "Vendor was terminated"
    described by "Emitted when vendor relationship ends."
  }

  event PerformanceUpdated is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Vendor." }
    metrics is PerformanceMetrics with { briefly "Metrics" described by "Updated metrics." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Performance was updated"
    described by "Emitted when vendor metrics are refreshed."
  }

  // State Records
  record PendingVendorData is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Vendor identifier." }
    businessName is BusinessName with { briefly "Business" described by "Business name." }
    storeName is StoreName with { briefly "Store" described by "Store name." }
    taxId is TaxId with { briefly "Tax ID" described by "Tax identification." }
    email is Email with { briefly "Email" described by "Contact email." }
    phone is PhoneNumber with { briefly "Phone" described by "Contact phone." }
    businessAddress is Address with { briefly "Address" described by "Business address." }
    category is VendorCategory with { briefly "Category" described by "Product category." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submission time." }
  } with {
    briefly "Pending vendor data"
    described by "State data for a vendor application under review."
  }

  record ActiveVendorData is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Vendor identifier." }
    businessName is BusinessName with { briefly "Business" described by "Business name." }
    storeName is StoreName with { briefly "Store" described by "Store name." }
    taxId is TaxId with { briefly "Tax ID" described by "Tax identification." }
    email is Email with { briefly "Email" described by "Contact email." }
    phone is PhoneNumber with { briefly "Phone" described by "Contact phone." }
    businessAddress is Address with { briefly "Address" described by "Business address." }
    category is VendorCategory with { briefly "Category" described by "Product category." }
    tier is VendorTier with { briefly "Tier" described by "Vendor tier." }
    commissionRates is many CommissionRate with { briefly "Rates" described by "Commission rates." }
    bankAccount is optional BankAccount with { briefly "Bank" described by "Payout account." }
    performance is PerformanceMetrics with { briefly "Performance" described by "Metrics." }
    approvedAt is TimeStamp with { briefly "Approved" described by "Approval time." }
  } with {
    briefly "Active vendor data"
    described by "State data for an approved and active vendor."
  }

  record SuspendedVendorData is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Vendor identifier." }
    businessName is BusinessName with { briefly "Business" described by "Business name." }
    storeName is StoreName with { briefly "Store" described by "Store name." }
    reason is String(1, 500) with { briefly "Reason" described by "Suspension reason." }
    suspendedAt is TimeStamp with { briefly "Suspended" described by "Suspension time." }
  } with {
    briefly "Suspended vendor data"
    described by "State data for a suspended vendor."
  }

  record TerminatedVendorData is {
    vendorId is VendorId with { briefly "Vendor ID" described by "Vendor identifier." }
    businessName is BusinessName with { briefly "Business" described by "Business name." }
    reason is String(1, 500) with { briefly "Reason" described by "Termination reason." }
    terminatedAt is TimeStamp with { briefly "Terminated" described by "Termination time." }
  } with {
    briefly "Terminated vendor data"
    described by "State data for a terminated vendor."
  }

  // States
  state PendingState of Vendor.PendingVendorData with {
    briefly "Vendor is pending"
    described by "Vendor application is under review."
  }

  state ActiveState of Vendor.ActiveVendorData with {
    briefly "Vendor is active"
    described by "Vendor is approved and can sell on marketplace."
  }

  state SuspendedState of Vendor.SuspendedVendorData with {
    briefly "Vendor is suspended"
    described by "Vendor selling privileges are temporarily revoked."
  }

  state TerminatedState of Vendor.TerminatedVendorData with {
    briefly "Vendor is terminated"
    described by "Vendor relationship has been permanently ended."
  }

  // Handler
  handler VendorHandler is {
    on command SubmitApplication {
      morph entity VendorContext.Vendor to state VendorContext.Vendor.PendingState with command SubmitApplication
      tell event ApplicationSubmitted to entity VendorContext.Vendor
    }

    on command ApproveVendor {
      morph entity VendorContext.Vendor to state VendorContext.Vendor.ActiveState with command ApproveVendor
      tell event VendorApproved to entity VendorContext.Vendor
    }

    on command RejectVendor {
      morph entity VendorContext.Vendor to state VendorContext.Vendor.TerminatedState with command RejectVendor
      tell event VendorRejected to entity VendorContext.Vendor
    }

    on command UpdateVendorInfo {
      tell event VendorInfoUpdated to entity VendorContext.Vendor
    }

    on command SetBankAccount {
      tell event BankAccountSet to entity VendorContext.Vendor
    }

    on command SuspendVendor {
      morph entity VendorContext.Vendor to state VendorContext.Vendor.SuspendedState with command SuspendVendor
      tell event VendorSuspended to entity VendorContext.Vendor
    }

    on command ReinstateVendor {
      morph entity VendorContext.Vendor to state VendorContext.Vendor.ActiveState with command ReinstateVendor
      tell event VendorReinstated to entity VendorContext.Vendor
    }

    on command TerminateVendor {
      morph entity VendorContext.Vendor to state VendorContext.Vendor.TerminatedState with command TerminateVendor
      tell event VendorTerminated to entity VendorContext.Vendor
    }

    on command UpdatePerformance {
      tell event PerformanceUpdated to entity VendorContext.Vendor
    }
  } with {
    briefly "Processes vendor commands"
    described by {
      | Handles all vendor lifecycle operations including application,
      | approval, suspension, and termination.
    }
  }

} with {
  briefly "Marketplace vendor aggregate"
  described by {
    | The Vendor entity manages marketplace sellers including their
    | application process, profile information, performance tracking,
    | and payout configuration.
  }
}
