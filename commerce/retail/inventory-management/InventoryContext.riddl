// Inventory Management - Inventory Context
context InventoryContext is {
  include "types.riddl"
  include "StockItem.riddl"
  // Adaptors for external system integration
  adaptor OrderAdapter from context OrderService is { 
    handler OrderEvents is {
      on event OrderService.OrderPlaced is {
        prompt "Reserve stock for order items"
      }
      on event OrderService.OrderCancelled is {
        prompt "Release reserved stock"
      }
      on event OrderService.OrderFulfilled is {
        prompt "Deduct fulfilled stock"
      }
    } with {
      briefly "Handles order events"
      described as {
        |Processes orders for stock allocation.
      }
    }
  } with {
    briefly "Order integration"
    described as {
      |Receives order events for inventory allocation.
    }
  }
  adaptor PurchasingAdapter to context PurchasingService is { 
    handler ReplenishmentEvents is {
      on command PurchasingService.CreatePurchaseOrder is {
        prompt "Create purchase requisition"
      }
    } with {
      briefly "Handles replenishment"
      described as {
        |Sends restock requests to purchasing.
      }
    }
  } with {
    briefly "Purchasing integration"
    described as {
      |Publishes replenishment needs to purchasing.
    }
  }
  adaptor ReceivingAdapter from context ReceivingService is { 
    handler ReceivingEvents is {
      on event ReceivingService.GoodsReceived is {
        prompt "Update stock quantities from receipt"
      }
      on event ReceivingService.ReceiptDiscrepancy is {
        prompt "Flag discrepancy for review"
      }
    } with {
      briefly "Handles receiving events"
      described as {
        |Processes goods receipt notifications.
      }
    }
  } with {
    briefly "Receiving integration"
    described as {
      |Receives goods receipt notifications.
    }
  }
  // Repository for inventory persistence
  repository InventoryRepository is {
    schema InventoryData is relational
      of stockItems as type StockItem
        index on field StockItem.productId
        index on field StockItem.sku
        index on field StockItem.location

    handler InventoryPersistence is {
      on command StockItem.CreateStockItem is {
        prompt "Persist new stock item"
      }
      on command StockItem.ReceiveStock is {
        prompt "Update stock quantities"
      }
      on command StockItem.ReserveStock is {
        prompt "Update reservations"
      }
      on command StockItem.DeductStock is {
        prompt "Update on-hand quantities"
      }
      on command StockItem.AdjustStock is {
        prompt "Record adjustment and update quantities"
      }
      on command StockItem.TransferStock is {
        prompt "Update location quantities"
      }
    } with {
      briefly "Persists inventory commands"
      described as {
        |Handles command-driven persistence for inventory.
      }
    }
  } with {
    briefly "Inventory data persistence"
    described as {
      | The InventoryRepository provides persistent storage for stock
      | items with indexes for product and location lookup.
    }
  }
  // Projector for inventory views
  projector InventoryViews is {
    record LocationInventorySummary is  {
      locationId: LocationId with {
        briefly "Location"
        described as {
          |Location ID.
        }
      }
      locationName: String(1,100) with {
        briefly "Name"
        described as {
          |Location name.
        }
      }
      totalItems: Natural with {
        briefly "Items"
        described as {
          |Total unique items.
        }
      }
      totalUnits: Quantity with {
        briefly "Units"
        described as {
          |Total units on hand.
        }
      }
      totalValue: Money with {
        briefly "Value"
        described as {
          |Total inventory value.
        }
      }
    } with {
      briefly "Location inventory summary"
      described as {
        |Aggregated inventory for a location.
      }
    }
    handler ViewHandler is {
      on event StockItem.StockReceived is {
        prompt "Update location summary"
      }
      on event StockItem.StockDeducted is {
        prompt "Update location summary"
      }
      on event StockItem.StockTransferred is {
        prompt "Update both location summaries"
      }
    } with {
      briefly "Maintains inventory views"
      described as {
        |Projects events into summary views.
      }
    }
  } with {
    briefly "Inventory view projections"
    described as {
      |Maintains summarized views of inventory.
    }
  }
} with {
  briefly "Bounded context for inventory management"
  described as {
    | The InventoryContext is the bounded context for stock tracking.
    | It manages inventory levels, reservations, and replenishment
    | across locations.
  }
}
