// Point of Sale - External Contexts
// Inventory Service - Stock updates
context InventoryService is {
  command DeductStock is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product to deduct.
      }
    }
    quantity: Quantity with {
      briefly "Quantity"
      described as {
        |Quantity sold.
      }
    }
    transactionId: TransactionId with {
      briefly "Transaction"
      described as {
        |Sale reference.
      }
    }
  } with {
    briefly "Deduct stock for sale"
    described as {
      |Reduces inventory for sold items.
    }
  }
  event StockDeducted is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Deducted product.
      }
    }
    quantity: Quantity with {
      briefly "Quantity"
      described as {
        |Quantity removed.
      }
    }
    deductedAt: TimeStamp with {
      briefly "Deducted"
      described as {
        |When deducted.
      }
    }
  } with {
    briefly "Stock was deducted"
    described as {
      |Emitted when inventory is reduced.
    }
  }
} with {
  option external()
  briefly "External inventory service"
  described as {
    |External system for inventory management.
  }
}
// Payment Gateway - Card processing
context PaymentGateway is {
  command AuthorizePayment is  {
    transactionId: TransactionId with {
      briefly "Transaction"
      described as {
        |Transaction ID.
      }
    }
    authorizationAmount: Money with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    cardToken: String(1,100) with {
      briefly "Token"
      described as {
        |Tokenized card.
      }
    }
  } with {
    briefly "Authorize card payment"
    described as {
      |Authorizes a card payment.
    }
  }
  command CapturePayment is  {
    authorizationId: UUID with {
      briefly "Auth ID"
      described as {
        |Authorization ID.
      }
    }
    captureAmount: Money with {
      briefly "Amount"
      described as {
        |Capture amount.
      }
    }
  } with {
    briefly "Capture authorized payment"
    described as {
      |Captures a previously authorized payment.
    }
  }
  command RefundPayment is  {
    paymentId: UUID with {
      briefly "Payment ID"
      described as {
        |Payment to refund.
      }
    }
    refundAmount: Money with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    refundReason: String(1,200) with {
      briefly "Reason"
      described as {
        |Refund reason.
      }
    }
  } with {
    briefly "Refund payment"
    described as {
      |Refunds a captured payment.
    }
  }
  event PaymentAuthorized is  {
    authorizationId: UUID with {
      briefly "Auth ID"
      described as {
        |Authorization ID.
      }
    }
    transactionId: TransactionId with {
      briefly "Transaction"
      described as {
        |Transaction ID.
      }
    }
    authorizedAmount: Money with {
      briefly "Amount"
      described as {
        |Authorized amount.
      }
    }
    authorizedAt: TimeStamp with {
      briefly "Authorized"
      described as {
        |Authorization time.
      }
    }
  } with {
    briefly "Payment was authorized"
    described as {
      |Emitted when card is approved.
    }
  }
  event PaymentDeclined is  {
    transactionId: TransactionId with {
      briefly "Transaction"
      described as {
        |Transaction ID.
      }
    }
    reason: String(1,200) with {
      briefly "Reason"
      described as {
        |Decline reason.
      }
    }
    declinedAt: TimeStamp with {
      briefly "Declined"
      described as {
        |Decline time.
      }
    }
  } with {
    briefly "Payment was declined"
    described as {
      |Emitted when card is rejected.
    }
  }
} with {
  option external()
  briefly "External payment gateway"
  described as {
    |External system for card payment processing.
  }
}
// Receipt Service - Receipt generation
context ReceiptService is {
  command GenerateReceipt is  {
    transactionId: TransactionId with {
      briefly "Transaction"
      described as {
        |Transaction ID.
      }
    }
    lineItems: LineItem+ with {
      briefly "Items"
      described as {
        |Sold items.
      }
    }
    totals: TransactionTotals with {
      briefly "Totals"
      described as {
        |Transaction totals.
      }
    }
    terminalId: TerminalId with {
      briefly "Terminal"
      described as {
        |Terminal ID.
      }
    }
  } with {
    briefly "Generate receipt"
    described as {
      |Creates a receipt for printing.
    }
  }
  command EmailReceipt is  {
    transactionId: TransactionId with {
      briefly "Transaction"
      described as {
        |Transaction ID.
      }
    }
    emailAddress: String(1,200) with {
      briefly "Email"
      described as {
        |Recipient email.
      }
    }
  } with {
    briefly "Email receipt"
    described as {
      |Sends receipt to customer email.
    }
  }
  event ReceiptGenerated is  {
    transactionId: TransactionId with {
      briefly "Transaction"
      described as {
        |Transaction ID.
      }
    }
    receiptNumber: String(1,50) with {
      briefly "Receipt #"
      described as {
        |Receipt number.
      }
    }
    generatedAt: TimeStamp with {
      briefly "Generated"
      described as {
        |Generation time.
      }
    }
  } with {
    briefly "Receipt was generated"
    described as {
      |Emitted when receipt is created.
    }
  }
} with {
  option external()
  briefly "External receipt service"
  described as {
    |External system for receipt generation.
  }
}
// Pricing Service - Price lookup
context PricingService is {
  event PriceRetrieved is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    sku: SKU with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    price: Money with {
      briefly "Price"
      described as {
        |Current price.
      }
    }
    retrievedAt: TimeStamp with {
      briefly "Retrieved"
      described as {
        |Lookup time.
      }
    }
  } with {
    briefly "Price was retrieved"
    described as {
      |Emitted when product price is looked up.
    }
  }
  event PromotionApplied is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    originalPrice: Money with {
      briefly "Original"
      described as {
        |Original price.
      }
    }
    discountedPrice: Money with {
      briefly "Discounted"
      described as {
        |Sale price.
      }
    }
    promotionId: UUID with {
      briefly "Promotion"
      described as {
        |Promotion ID.
      }
    }
  } with {
    briefly "Promotion was applied"
    described as {
      |Emitted when promotional pricing is used.
    }
  }
} with {
  option external()
  briefly "External pricing service"
  described as {
    |External system for product pricing.
  }
}
