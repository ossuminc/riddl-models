// Point of Sale - POS Context

context POSContext is {

  include "types.riddl"
  include "Transaction.riddl"

  // Adaptors for external system integration
  adaptor InventoryAdapter to context InventoryService is {
    handler InventoryUpdates is {
      on command InventoryService.DeductStock {
        prompt "Deduct sold items from inventory"
      }
    } with {
      briefly "Handles inventory updates"
      described by "Updates inventory for completed sales."
    }
  } with {
    briefly "Inventory integration"
    described by "Publishes sales for inventory deduction."
  }

  adaptor PaymentAdapter to context PaymentGateway is {
    handler PaymentProcessing is {
      on command PaymentGateway.AuthorizePayment {
        prompt "Authorize card payment"
      }
      on command PaymentGateway.CapturePayment {
        prompt "Capture authorized payment"
      }
    } with {
      briefly "Handles payment processing"
      described by "Processes card payments through gateway."
    }
  } with {
    briefly "Payment gateway integration"
    described by "Submits payments to payment processor."
  }

  adaptor ReceiptAdapter to context ReceiptService is {
    handler ReceiptGeneration is {
      on command ReceiptService.GenerateReceipt {
        prompt "Generate and print receipt"
      }
    } with {
      briefly "Handles receipt generation"
      described by "Generates receipts for completed sales."
    }
  } with {
    briefly "Receipt integration"
    described by "Generates receipts for transactions."
  }

  // Repository for transaction persistence
  repository TransactionRepository is {
    schema TransactionData is relational
      of transactions as Transaction
      index on field Transaction.terminalId
      index on field Transaction.cashierId
      index on field Transaction.transactionId

    handler TransactionPersistence is {
      on command Transaction.StartTransaction {
        prompt "Create new transaction record"
      }
      on command Transaction.AddLineItem {
        prompt "Add line item to transaction"
      }
      on command Transaction.ProcessPayment {
        prompt "Record payment"
      }
      on command Transaction.CompleteTransaction {
        prompt "Finalize transaction record"
      }
      on command Transaction.VoidTransaction {
        prompt "Mark transaction as voided"
      }
    } with {
      briefly "Persists transaction commands"
      described by "Handles command-driven persistence for transactions."
    }
  } with {
    briefly "Transaction data persistence"
    described by {
      | The TransactionRepository provides persistent storage for
      | POS transactions with indexes for terminal and cashier lookup.
    }
  }

  // Projector for sales analytics
  projector SalesAnalytics is {
    updates repository TransactionRepository

    record DailySalesSummary is {
      date is Date with { briefly "Date" described by "Sales date." }
      terminalId is TerminalId with { briefly "Terminal" described by "Terminal ID." }
      transactionCount is Natural with { briefly "Count" described by "Number of transactions." }
      grossSales is Money with { briefly "Gross" described by "Gross sales." }
      totalDiscounts is Money with { briefly "Discounts" described by "Total discounts." }
      netSales is Money with { briefly "Net" described by "Net sales." }
      taxCollected is Money with { briefly "Tax" described by "Tax collected." }
    } with {
      briefly "Daily sales summary"
      described by "Aggregated daily sales by terminal."
    }

    handler AnalyticsHandler is {
      on event Transaction.TransactionCompleted {
        prompt "Update daily sales summary"
      }
    } with {
      briefly "Maintains sales analytics"
      described by "Projects transactions into analytics."
    }
  } with {
    briefly "Sales analytics projections"
    described by "Maintains summarized sales data."
  }

} with {
  briefly "Bounded context for point of sale"
  described by {
    | The POSContext is the bounded context for retail transaction
    | processing. It manages transactions, payments, and receipts.
  }
}
