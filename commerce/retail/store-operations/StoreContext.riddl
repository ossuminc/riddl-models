// Store Operations - Store Context
context StoreContext is {
  include "types.riddl"
  include "Store.riddl"
  // Adaptors for external system integration
  adaptor HRAdapter from context HRService is { 
    handler ScheduleEvents is {
      on event HRService.ShiftScheduled is {
        prompt "Add shift to store schedule"
      }
      on event HRService.ShiftCancelled is {
        prompt "Remove shift from schedule"
      }
    } with {
      briefly "Handles HR events"
      described as {
        |Receives scheduling updates from HR.
      }
    }
  } with {
    briefly "HR integration"
    described as {
      |Receives employee scheduling from HR.
    }
  }
  adaptor SecurityAdapter to context SecurityService is { 
    handler SecurityNotifications is {
      on command SecurityService.NotifyStoreStatus is {
        prompt "Notify security of store status change"
      }
      on command SecurityService.ReportIncident is {
        prompt "Report incident to security"
      }
    } with {
      briefly "Handles security notifications"
      described as {
        |Sends alerts to security system.
      }
    }
  } with {
    briefly "Security integration"
    described as {
      |Publishes events to security service.
    }
  }
  // Repository for store persistence
  repository StoreRepository is {
    schema StoreData is relational
      of stores as type Store
        index on field Store.storeId
        index on field Store.name

    handler StorePersistence is {
      on command Store.OpenStore is {
        prompt "Update store status to open"
      }
      on command Store.CloseStore is {
        prompt "Update store status to closed"
      }
      on command Store.StartShift is {
        prompt "Record shift start"
      }
      on command Store.EndShift is {
        prompt "Record shift end"
      }
      on command Store.OpenRegister is {
        prompt "Record register opening"
      }
      on command Store.CloseRegister is {
        prompt "Record register closing with cash count"
      }
      on command Store.RecordIncident is {
        prompt "Persist incident report"
      }
    } with {
      briefly "Persists store commands"
      described as {
        |Handles command-driven persistence for stores.
      }
    }
  } with {
    briefly "Store data persistence"
    described as {
      | The StoreRepository provides persistent storage for store
      | operations data.
    }
  }
  // Projector for operations analytics
  projector OperationsAnalytics is {
    record DailyOperationsSummary is  {
      storeId: StoreId with {
        briefly "Store"
        described as {
          |Store ID.
        }
      }
      date: Date with {
        briefly "Date"
        described as {
          |Operations date.
        }
      }
      hoursOpen: Decimal(4,2) with {
        briefly "Hours"
        described as {
          |Hours open.
        }
      }
      staffHours: Decimal(6,2) with {
        briefly "Staff hours"
        described as {
          |Total staff hours.
        }
      }
      incidentCount: Natural with {
        briefly "Incidents"
        described as {
          |Number of incidents.
        }
      }
      cashVariance: Money with {
        briefly "Variance"
        described as {
          |Total cash variance.
        }
      }
    } with {
      briefly "Daily operations summary"
      described as {
        |Aggregated daily operations metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Store.StoreClosed is {
        prompt "Finalize daily operations summary"
      }
      on event Store.RegisterClosed is {
        prompt "Update cash variance metrics"
      }
    } with {
      briefly "Maintains operations analytics"
      described as {
        |Projects events into metrics.
      }
    }
  } with {
    briefly "Operations analytics projections"
    described as {
      |Maintains summarized operations data.
    }
  }
} with {
  briefly "Bounded context for store operations"
  described as {
    | The StoreContext is the bounded context for retail store
    | operations. It manages daily procedures, scheduling, and
    | incident tracking.
  }
}
