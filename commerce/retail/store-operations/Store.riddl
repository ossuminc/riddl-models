// Store Operations - Store Entity
entity Store is {
  // Commands
  command OpenStore is  {
    storeId: StoreId with {
      briefly "Store ID"
      described as {
        |Store to open.
      }
    }
    managerId: EmployeeId with {
      briefly "Manager"
      described as {
        |Opening manager.
      }
    }
    actualOpeningTime: TimeStamp with {
      briefly "Opening time"
      described as {
        |Actual opening time.
      }
    }
  } with {
    briefly "Open store for business"
    described as {
      |Records store opening and enables operations.
    }
  }
  command CloseStore is  {
    storeId: StoreId with {
      briefly "Store ID"
      described as {
        |Store to close.
      }
    }
    managerId: EmployeeId with {
      briefly "Manager"
      described as {
        |Closing manager.
      }
    }
    actualClosingTime: TimeStamp with {
      briefly "Closing time"
      described as {
        |Actual closing time.
      }
    }
  } with {
    briefly "Close store"
    described as {
      |Records store closing for the day.
    }
  }
  command StartShift is  {
    storeId: StoreId with {
      briefly "Store ID"
      described as {
        |Store location.
      }
    }
    shift: ShiftInfo with {
      briefly "Shift"
      described as {
        |Shift details.
      }
    }
  } with {
    briefly "Start employee shift"
    described as {
      |Records an employee starting their shift.
    }
  }
  command EndShift is  {
    storeId: StoreId with {
      briefly "Store ID"
      described as {
        |Store location.
      }
    }
    shiftId: ShiftId with {
      briefly "Shift ID"
      described as {
        |Shift to end.
      }
    }
    actualEndTime: TimeStamp with {
      briefly "End time"
      described as {
        |Actual end time.
      }
    }
  } with {
    briefly "End employee shift"
    described as {
      |Records an employee ending their shift.
    }
  }
  command OpenRegister is  {
    storeId: StoreId with {
      briefly "Store ID"
      described as {
        |Store location.
      }
    }
    registerId: RegisterId with {
      briefly "Register"
      described as {
        |Register to open.
      }
    }
    cashierId: EmployeeId with {
      briefly "Cashier"
      described as {
        |Operating cashier.
      }
    }
    openingBalance: Money with {
      briefly "Opening balance"
      described as {
        |Starting cash amount.
      }
    }
  } with {
    briefly "Open cash register"
    described as {
      |Opens a register with starting cash.
    }
  }
  command CloseRegister is  {
    storeId: StoreId with {
      briefly "Store ID"
      described as {
        |Store location.
      }
    }
    registerId: RegisterId with {
      briefly "Register"
      described as {
        |Register to close.
      }
    }
    countedBalance: Money with {
      briefly "Counted"
      described as {
        |Counted cash amount.
      }
    }
  } with {
    briefly "Close cash register"
    described as {
      |Closes register with cash count.
    }
  }
  command RecordIncident is  {
    storeId: StoreId with {
      briefly "Store ID"
      described as {
        |Store location.
      }
    }
    incident: IncidentReport with {
      briefly "Incident"
      described as {
        |Incident details.
      }
    }
  } with {
    briefly "Record operational incident"
    described as {
      |Logs an incident for the store.
    }
  }
  command AssignTask is  {
    storeId: StoreId with {
      briefly "Store ID"
      described as {
        |Store location.
      }
    }
    task: OperationalTask with {
      briefly "Task"
      described as {
        |Task to assign.
      }
    }
  } with {
    briefly "Assign operational task"
    described as {
      |Creates and assigns a task to staff.
    }
  }
  command CompleteTask is  {
    storeId: StoreId with {
      briefly "Store ID"
      described as {
        |Store location.
      }
    }
    taskId: UUID with {
      briefly "Task ID"
      described as {
        |Task to complete.
      }
    }
    completedBy: EmployeeId with {
      briefly "Completed by"
      described as {
        |Employee who completed.
      }
    }
  } with {
    briefly "Complete operational task"
    described as {
      |Marks a task as completed.
    }
  }
  // Events
  event StoreOpened is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    managerId: EmployeeId with {
      briefly "Manager"
      described as {
        |Opening manager.
      }
    }
    openedAt: TimeStamp with {
      briefly "Opened"
      described as {
        |Opening time.
      }
    }
  } with {
    briefly "Store was opened"
    described as {
      |Emitted when store opens for business.
    }
  }
  event StoreClosed is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    managerId: EmployeeId with {
      briefly "Manager"
      described as {
        |Closing manager.
      }
    }
    closedAt: TimeStamp with {
      briefly "Closed"
      described as {
        |Closing time.
      }
    }
  } with {
    briefly "Store was closed"
    described as {
      |Emitted when store closes.
    }
  }
  event ShiftStarted is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    shift: ShiftInfo with {
      briefly "Shift"
      described as {
        |Started shift.
      }
    }
    startedAt: TimeStamp with {
      briefly "Started"
      described as {
        |Start time.
      }
    }
  } with {
    briefly "Shift was started"
    described as {
      |Emitted when employee starts shift.
    }
  }
  event ShiftEnded is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    shiftId: ShiftId with {
      briefly "Shift"
      described as {
        |Ended shift.
      }
    }
    endedAt: TimeStamp with {
      briefly "Ended"
      described as {
        |End time.
      }
    }
  } with {
    briefly "Shift was ended"
    described as {
      |Emitted when employee ends shift.
    }
  }
  event RegisterOpened is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    registerId: RegisterId with {
      briefly "Register"
      described as {
        |Opened register.
      }
    }
    cashierId: EmployeeId with {
      briefly "Cashier"
      described as {
        |Operator.
      }
    }
    openingBalance: Money with {
      briefly "Balance"
      described as {
        |Starting cash.
      }
    }
    openedAt: TimeStamp with {
      briefly "Opened"
      described as {
        |Open time.
      }
    }
  } with {
    briefly "Register was opened"
    described as {
      |Emitted when register is opened.
    }
  }
  event RegisterClosed is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    registerId: RegisterId with {
      briefly "Register"
      described as {
        |Closed register.
      }
    }
    drawer: CashDrawer with {
      briefly "Drawer"
      described as {
        |Final drawer state.
      }
    }
    closedAt: TimeStamp with {
      briefly "Closed"
      described as {
        |Close time.
      }
    }
  } with {
    briefly "Register was closed"
    described as {
      |Emitted when register is closed.
    }
  }
  event IncidentRecorded is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    incident: IncidentReport with {
      briefly "Incident"
      described as {
        |Recorded incident.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Incident was recorded"
    described as {
      |Emitted when incident is logged.
    }
  }
  event TaskAssigned is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    task: OperationalTask with {
      briefly "Task"
      described as {
        |Assigned task.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Task was assigned"
    described as {
      |Emitted when task is created.
    }
  }
  event TaskCompleted is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    taskId: UUID with {
      briefly "Task"
      described as {
        |Completed task.
      }
    }
    completedBy: EmployeeId with {
      briefly "Completed by"
      described as {
        |Employee.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Task was completed"
    described as {
      |Emitted when task is finished.
    }
  }
  // State Records
  record OpenStoreData is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Store name.
      }
    }
    status: StoreStatus with {
      briefly "Status"
      described as {
        |Current status.
      }
    }
    activeShifts: ShiftInfo+ with {
      briefly "Shifts"
      described as {
        |Active shifts.
      }
    }
    openRegisters: RegisterId+ with {
      briefly "Registers"
      described as {
        |Open registers.
      }
    }
    pendingTasks: OperationalTask+ with {
      briefly "Tasks"
      described as {
        |Pending tasks.
      }
    }
    todaysIncidents: IncidentReport+ with {
      briefly "Incidents"
      described as {
        |Today's incidents.
      }
    }
    openedAt: TimeStamp with {
      briefly "Opened"
      described as {
        |Open time.
      }
    }
    openedBy: EmployeeId with {
      briefly "Opened by"
      described as {
        |Opening manager.
      }
    }
  } with {
    briefly "Open store data"
    described as {
      |State data for an open store.
    }
  }
  record ClosedStoreData is  {
    storeId: StoreId with {
      briefly "Store"
      described as {
        |Store ID.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Store name.
      }
    }
    lastClosedAt: TimeStamp with {
      briefly "Closed"
      described as {
        |Last close time.
      }
    }
    lastClosedBy: EmployeeId with {
      briefly "Closed by"
      described as {
        |Closing manager.
      }
    }
  } with {
    briefly "Closed store data"
    described as {
      |State data for a closed store.
    }
  }
  // States
  state OpenState of type Store.OpenStoreData
  state ClosedState of type Store.ClosedStoreData
  // Handler
  handler StoreHandler is {
    on command OpenStore is {
      morph entity StoreContext.Store to state StoreContext.Store.OpenState with command OpenStore
      tell event StoreOpened to entity StoreContext.Store
    }
    on command CloseStore is {
      morph entity StoreContext.Store to state StoreContext.Store.ClosedState with command CloseStore
      tell event StoreClosed to entity StoreContext.Store
    }
    on command StartShift is {
      tell event ShiftStarted to entity StoreContext.Store
    }
    on command EndShift is {
      tell event ShiftEnded to entity StoreContext.Store
    }
    on command OpenRegister is {
      tell event RegisterOpened to entity StoreContext.Store
    }
    on command CloseRegister is {
      tell event RegisterClosed to entity StoreContext.Store
    }
    on command RecordIncident is {
      tell event IncidentRecorded to entity StoreContext.Store
    }
    on command AssignTask is {
      tell event TaskAssigned to entity StoreContext.Store
    }
    on command CompleteTask is {
      tell event TaskCompleted to entity StoreContext.Store
    }
  } with {
    briefly "Processes store commands"
    described as {
      | Handles store operations including opening, closing,
      | shift management, and incident reporting.
    }
  }
} with {
  briefly "Retail store aggregate"
  described as {
    | The Store entity manages daily operations of a retail location
    | including scheduling, cash management, and incident tracking.
  }
}
