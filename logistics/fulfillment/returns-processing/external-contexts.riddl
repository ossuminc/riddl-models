// Returns Processing - External Contexts

context ShippingCarrier is {

  command CreateReturnLabel is {
    returnId is ReturnId with { briefly "Return" described by "Return ID." }
    originAddress is String(1, 300) with { briefly "Origin" described by "Customer address." }
    destinationAddress is String(1, 300) with { briefly "Destination" described by "Warehouse." }
    serviceLevel is String(1, 50) with { briefly "Service" described by "Service level." }
  } with {
    briefly "Create return label"
    described by "Creates prepaid return label."
  }

  result ReturnLabelResult is {
    labelUrl is URL with { briefly "URL" described by "Label URL." }
    trackingNumber is String(1, 100) with { briefly "Tracking" described by "Tracking number." }
    expirationDate is Date with { briefly "Expires" described by "Expiration date." }
  } with {
    briefly "Return label result"
    described by "Generated return label."
  }

  query GetTrackingStatus is {
    trackingNumber is String(1, 100) with { briefly "Tracking" described by "Tracking number." }
  } with {
    briefly "Get tracking status"
    described by "Gets shipment tracking status."
  }

  result TrackingStatus is {
    trackingNumber is String(1, 100) with { briefly "Tracking" described by "Tracking number." }
    shipmentStatus is String(1, 50) with { briefly "Status" described by "Shipment status." }
    lastLocation is String(1, 200) with { briefly "Location" described by "Last location." }
    estimatedDelivery is optional Date with { briefly "Est delivery" described by "Est delivery." }
  } with {
    briefly "Tracking status"
    described by "Shipment tracking status."
  }

} with {
  option is external
  briefly "External shipping carrier"
  described by "Carrier shipping API."
}

context PaymentGateway is {

  command ProcessRefund is {
    returnId is ReturnId with { briefly "Return" described by "Return ID." }
    originalTransactionId is String(1, 100) with { briefly "Original" described by "Original txn." }
    refundAmount is Decimal(10, 2) with { briefly "Amount" described by "Refund amount." }
  } with {
    briefly "Process refund"
    described by "Processes refund to customer."
  }

  event RefundCompleted is {
    returnId is ReturnId with { briefly "Return" described by "Return ID." }
    refundTransactionId is String(1, 100) with { briefly "Transaction" described by "Refund txn." }
    refundAmount is Decimal(10, 2) with { briefly "Amount" described by "Amount refunded." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Refund completed"
    described by "Emitted when refund completes."
  }

  command IssueStoreCredit is {
    returnId is ReturnId with { briefly "Return" described by "Return ID." }
    customerId is UUID with { briefly "Customer" described by "Customer ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Credit amount." }
  } with {
    briefly "Issue store credit"
    described by "Issues store credit."
  }

} with {
  option is external
  briefly "External payment gateway"
  described by "Payment processing system."
}

context InventoryManagement is {

  command RestockInventory is {
    sku is String(1, 50) with { briefly "SKU" described by "Product SKU." }
    quantity is Natural with { briefly "Quantity" described by "Quantity." }
    location is String(1, 50) with { briefly "Location" described by "Bin location." }
    condition is ItemCondition with { briefly "Condition" described by "Item condition." }
  } with {
    briefly "Return to stock"
    described by "Returns item to inventory."
  }

  event InventoryRestocked is {
    sku is String(1, 50) with { briefly "SKU" described by "Product SKU." }
    quantity is Natural with { briefly "Quantity" described by "Quantity." }
    location is String(1, 50) with { briefly "Location" described by "Bin location." }
    restockedAt is TimeStamp with { briefly "Restocked" described by "Restock time." }
  } with {
    briefly "Inventory restocked"
    described by "Emitted when restocked."
  }

  command MarkAsDefective is {
    sku is String(1, 50) with { briefly "SKU" described by "Product SKU." }
    quantity is Natural with { briefly "Quantity" described by "Quantity." }
    defectType is String(1, 100) with { briefly "Defect" described by "Defect type." }
  } with {
    briefly "Mark as defective"
    described by "Marks item as defective."
  }

} with {
  option is external
  briefly "External inventory management"
  described by "Warehouse inventory system."
}

context CustomerNotification is {

  command SendReturnConfirmation is {
    returnId is ReturnId with { briefly "Return" described by "Return ID." }
    customerId is UUID with { briefly "Customer" described by "Customer ID." }
    rmaNumber is RMANumber with { briefly "RMA" described by "RMA number." }
  } with {
    briefly "Send return confirmation"
    described by "Sends RMA confirmation."
  }

  command SendRefundNotification is {
    returnId is ReturnId with { briefly "Return" described by "Return ID." }
    customerId is UUID with { briefly "Customer" described by "Customer ID." }
    refundAmount is Decimal(10, 2) with { briefly "Amount" described by "Refund amount." }
    refundMethod is RefundMethod with { briefly "Method" described by "Refund method." }
  } with {
    briefly "Send refund notification"
    described by "Notifies customer of refund."
  }

} with {
  option is external
  briefly "External customer notification"
  described by "Customer communication system."
}
