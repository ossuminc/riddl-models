// Returns Processing - External Contexts
context ShippingCarrier is {
  command CreateReturnLabel is  {
    returnId: ReturnId with {
      briefly "Return"
      described as {
        |Return ID.
      }
    }
    originAddress: String(1,300) with {
      briefly "Origin"
      described as {
        |Customer address.
      }
    }
    destinationAddress: String(1,300) with {
      briefly "Destination"
      described as {
        |Warehouse.
      }
    }
    serviceLevel: String(1,50) with {
      briefly "Service"
      described as {
        |Service level.
      }
    }
  } with {
    briefly "Create return label"
    described as {
      |Creates prepaid return label.
    }
  }
  result ReturnLabelResult is  {
    labelUrl: URL with {
      briefly "URL"
      described as {
        |Label URL.
      }
    }
    trackingNumber: String(1,100) with {
      briefly "Tracking"
      described as {
        |Tracking number.
      }
    }
    expirationDate: Date with {
      briefly "Expires"
      described as {
        |Expiration date.
      }
    }
  } with {
    briefly "Return label result"
    described as {
      |Generated return label.
    }
  }
  query GetTrackingStatus is  {
    trackingNumber: String(1,100) with {
      briefly "Tracking"
      described as {
        |Tracking number.
      }
    }
  } with {
    briefly "Get tracking status"
    described as {
      |Gets shipment tracking status.
    }
  }
  result TrackingStatus is  {
    trackingNumber: String(1,100) with {
      briefly "Tracking"
      described as {
        |Tracking number.
      }
    }
    shipmentStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Shipment status.
      }
    }
    lastLocation: String(1,200) with {
      briefly "Location"
      described as {
        |Last location.
      }
    }
    estimatedDelivery: Date? with {
      briefly "Est delivery"
      described as {
        |Est delivery.
      }
    }
  } with {
    briefly "Tracking status"
    described as {
      |Shipment tracking status.
    }
  }
} with {
  option external()
  briefly "External shipping carrier"
  described as {
    |Carrier shipping API.
  }
}
context PaymentGateway is {
  command ProcessRefund is  {
    returnId: ReturnId with {
      briefly "Return"
      described as {
        |Return ID.
      }
    }
    originalTransactionId: String(1,100) with {
      briefly "Original"
      described as {
        |Original txn.
      }
    }
    refundAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
  } with {
    briefly "Process refund"
    described as {
      |Processes refund to customer.
    }
  }
  event RefundCompleted is  {
    returnId: ReturnId with {
      briefly "Return"
      described as {
        |Return ID.
      }
    }
    refundTransactionId: String(1,100) with {
      briefly "Transaction"
      described as {
        |Refund txn.
      }
    }
    refundAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Amount refunded.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Refund completed"
    described as {
      |Emitted when refund completes.
    }
  }
  command IssueStoreCredit is  {
    returnId: ReturnId with {
      briefly "Return"
      described as {
        |Return ID.
      }
    }
    customerId: UUID with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Credit amount.
      }
    }
  } with {
    briefly "Issue store credit"
    described as {
      |Issues store credit.
    }
  }
} with {
  option external()
  briefly "External payment gateway"
  described as {
    |Payment processing system.
  }
}
context InventoryManagement is {
  command RestockInventory is  {
    sku: String(1,50) with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Quantity.
      }
    }
    location: String(1,50) with {
      briefly "Location"
      described as {
        |Bin location.
      }
    }
    condition: ItemCondition with {
      briefly "Condition"
      described as {
        |Item condition.
      }
    }
  } with {
    briefly "Return to stock"
    described as {
      |Returns item to inventory.
    }
  }
  event InventoryRestocked is  {
    sku: String(1,50) with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Quantity.
      }
    }
    location: String(1,50) with {
      briefly "Location"
      described as {
        |Bin location.
      }
    }
    restockedAt: TimeStamp with {
      briefly "Restocked"
      described as {
        |Restock time.
      }
    }
  } with {
    briefly "Inventory restocked"
    described as {
      |Emitted when restocked.
    }
  }
  command MarkAsDefective is  {
    sku: String(1,50) with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Quantity.
      }
    }
    defectType: String(1,100) with {
      briefly "Defect"
      described as {
        |Defect type.
      }
    }
  } with {
    briefly "Mark as defective"
    described as {
      |Marks item as defective.
    }
  }
} with {
  option external()
  briefly "External inventory management"
  described as {
    |Warehouse inventory system.
  }
}
context CustomerNotification is {
  command SendReturnConfirmation is  {
    returnId: ReturnId with {
      briefly "Return"
      described as {
        |Return ID.
      }
    }
    customerId: UUID with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    rmaNumber: RMANumber with {
      briefly "RMA"
      described as {
        |RMA number.
      }
    }
  } with {
    briefly "Send return confirmation"
    described as {
      |Sends RMA confirmation.
    }
  }
  command SendRefundNotification is  {
    returnId: ReturnId with {
      briefly "Return"
      described as {
        |Return ID.
      }
    }
    customerId: UUID with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    refundAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    refundMethod: RefundMethod with {
      briefly "Method"
      described as {
        |Refund method.
      }
    }
  } with {
    briefly "Send refund notification"
    described as {
      |Notifies customer of refund.
    }
  }
} with {
  option external()
  briefly "External customer notification"
  described as {
    |Customer communication system.
  }
}
