// Order Fulfillment - External Contexts
context CarrierSystem is {
  command RequestShipmentRates is  {
    warehouseId: WarehouseId with {
      briefly "Warehouse"
      described as {
        |Origin warehouse.
      }
    }
    destination: AddressInfo with {
      briefly "Destination"
      described as {
        |Delivery address.
      }
    }
    packages: PackageInfo+ with {
      briefly "Packages"
      described as {
        |Packages to ship.
      }
    }
    priority: ShipmentPriority with {
      briefly "Priority"
      described as {
        |Shipping priority.
      }
    }
  } with {
    briefly "Request shipment rates"
    described as {
      |Requests carrier rate quotes.
    }
  }
  result ShipmentRates is  {
    options: CarrierSelection+ with {
      briefly "Options"
      described as {
        |Available carrier options.
      }
    }
  } with {
    briefly "Shipment rates"
    described as {
      |Carrier rate quote results.
    }
  }
  command BookShipment is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    carrier: CarrierSelection with {
      briefly "Carrier"
      described as {
        |Selected carrier.
      }
    }
    packages: PackageInfo+ with {
      briefly "Packages"
      described as {
        |Packages to ship.
      }
    }
  } with {
    briefly "Book shipment"
    described as {
      |Books a shipment with the carrier.
    }
  }
  event ShipmentBooked is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    tracking: TrackingInfo with {
      briefly "Tracking"
      described as {
        |Tracking info.
      }
    }
  } with {
    briefly "Shipment booked"
    described as {
      |Emitted when shipment is booked with carrier.
    }
  }
  query GetTrackingStatus is  {
    trackingNumber: String(1,100) with {
      briefly "Tracking"
      described as {
        |Tracking number.
      }
    }
  } with {
    briefly "Get tracking status"
    described as {
      |Gets current shipment tracking status.
    }
  }
  result TrackingStatus is  {
    trackingNumber: String(1,100) with {
      briefly "Tracking"
      described as {
        |Tracking number.
      }
    }
    currentLocation: String(1,200) with {
      briefly "Location"
      described as {
        |Current location.
      }
    }
    shipmentStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Shipment status.
      }
    }
    estimatedDelivery: Date? with {
      briefly "ETA"
      described as {
        |Estimated delivery.
      }
    }
  } with {
    briefly "Tracking status"
    described as {
      |Current shipment tracking status.
    }
  }
} with {
  option external()
  briefly "External carrier system"
  described as {
    |Shipping carrier integration system.
  }
}
context WarehouseSystem is {
  query CheckInventoryAvailability is  {
    warehouseId: WarehouseId with {
      briefly "Warehouse"
      described as {
        |Warehouse ID.
      }
    }
    items: OrderLineItem+ with {
      briefly "Items"
      described as {
        |Items to check.
      }
    }
  } with {
    briefly "Check inventory availability"
    described as {
      |Checks item availability in warehouse.
    }
  }
  result InventoryAvailability is  {
    available: Boolean with {
      briefly "Available"
      described as {
        |All items available.
      }
    }
    unavailableItems: String(1,50)* with {
      briefly "Unavailable"
      described as {
        |Unavailable SKUs.
      }
    }
  } with {
    briefly "Inventory availability"
    described as {
      |Warehouse inventory availability result.
    }
  }
  command ReserveInventory is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    warehouseId: WarehouseId with {
      briefly "Warehouse"
      described as {
        |Warehouse ID.
      }
    }
    items: OrderLineItem+ with {
      briefly "Items"
      described as {
        |Items to reserve.
      }
    }
  } with {
    briefly "Reserve inventory"
    described as {
      |Reserves inventory for a fulfillment order.
    }
  }
  event InventoryReserved is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Inventory reserved"
    described as {
      |Emitted when inventory is reserved.
    }
  }
  command ReleaseInventory is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    warehouseId: WarehouseId with {
      briefly "Warehouse"
      described as {
        |Warehouse ID.
      }
    }
  } with {
    briefly "Release inventory"
    described as {
      |Releases reserved inventory on cancellation.
    }
  }
  event InventoryReleased is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    releasedAt: TimeStamp with {
      briefly "Released"
      described as {
        |Release time.
      }
    }
  } with {
    briefly "Inventory released"
    described as {
      |Emitted when reserved inventory is released.
    }
  }
} with {
  option external()
  briefly "External warehouse system"
  described as {
    |Warehouse management and inventory system.
  }
}
