// Order Fulfillment - External Contexts

context CarrierSystem is {

  command RequestShipmentRates is {
    warehouseId is WarehouseId with { briefly "Warehouse" described by "Origin warehouse." }
    destination is AddressInfo with { briefly "Destination" described by "Delivery address." }
    packages is many PackageInfo with { briefly "Packages" described by "Packages to ship." }
    priority is ShipmentPriority with { briefly "Priority" described by "Shipping priority." }
  } with {
    briefly "Request shipment rates"
    described by "Requests carrier rate quotes."
  }

  result ShipmentRates is {
    options is many CarrierSelection with { briefly "Options" described by "Available carrier options." }
  } with {
    briefly "Shipment rates"
    described by "Carrier rate quote results."
  }

  command BookShipment is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    carrier is CarrierSelection with { briefly "Carrier" described by "Selected carrier." }
    packages is many PackageInfo with { briefly "Packages" described by "Packages to ship." }
  } with {
    briefly "Book shipment"
    described by "Books a shipment with the carrier."
  }

  event ShipmentBooked is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    tracking is TrackingInfo with { briefly "Tracking" described by "Tracking info." }
  } with {
    briefly "Shipment booked"
    described by "Emitted when shipment is booked with carrier."
  }

  query GetTrackingStatus is {
    trackingNumber is String(1, 100) with { briefly "Tracking" described by "Tracking number." }
  } with {
    briefly "Get tracking status"
    described by "Gets current shipment tracking status."
  }

  result TrackingStatus is {
    trackingNumber is String(1, 100) with { briefly "Tracking" described by "Tracking number." }
    currentLocation is String(1, 200) with { briefly "Location" described by "Current location." }
    shipmentStatus is String(1, 50) with { briefly "Status" described by "Shipment status." }
    estimatedDelivery is optional Date with { briefly "ETA" described by "Estimated delivery." }
  } with {
    briefly "Tracking status"
    described by "Current shipment tracking status."
  }

} with {
  option is external
  briefly "External carrier system"
  described by "Shipping carrier integration system."
}

context WarehouseSystem is {

  query CheckInventoryAvailability is {
    warehouseId is WarehouseId with { briefly "Warehouse" described by "Warehouse ID." }
    items is many OrderLineItem with { briefly "Items" described by "Items to check." }
  } with {
    briefly "Check inventory availability"
    described by "Checks item availability in warehouse."
  }

  result InventoryAvailability is {
    available is Boolean with { briefly "Available" described by "All items available." }
    unavailableItems is many optional String(1, 50) with { briefly "Unavailable" described by "Unavailable SKUs." }
  } with {
    briefly "Inventory availability"
    described by "Warehouse inventory availability result."
  }

  command ReserveInventory is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    warehouseId is WarehouseId with { briefly "Warehouse" described by "Warehouse ID." }
    items is many OrderLineItem with { briefly "Items" described by "Items to reserve." }
  } with {
    briefly "Reserve inventory"
    described by "Reserves inventory for a fulfillment order."
  }

  event InventoryReserved is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    reservedAt is TimeStamp with { briefly "Reserved" described by "Reservation time." }
  } with {
    briefly "Inventory reserved"
    described by "Emitted when inventory is reserved."
  }

  command ReleaseInventory is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    warehouseId is WarehouseId with { briefly "Warehouse" described by "Warehouse ID." }
  } with {
    briefly "Release inventory"
    described by "Releases reserved inventory on cancellation."
  }

  event InventoryReleased is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    releasedAt is TimeStamp with { briefly "Released" described by "Release time." }
  } with {
    briefly "Inventory released"
    described by "Emitted when reserved inventory is released."
  }

} with {
  option is external
  briefly "External warehouse system"
  described by "Warehouse management and inventory system."
}
