// External Contexts - Integration points with external systems

context OrderManagementContext is {

  // Events received from order management
  event OrderCreated is {
    orderId: String(1, 50),
    customerId: String(1, 50),
    orderLines: OrderLine*,
    createdAt: TimeStamp
  } briefly "An order was created in the order management system"
    described by "Triggers inventory reservation process when a new order is placed."

  event OrderCancelled is {
    orderId: String(1, 50),
    reason: String(1, 500),
    cancelledAt: TimeStamp
  } briefly "An order was cancelled"
    described by "Triggers release of reserved inventory when an order is cancelled."

  event OrderShipmentRequested is {
    orderId: String(1, 50),
    warehouseId: WarehouseId,
    requestedShipDate: Date,
    priority: Integer
  } briefly "Shipment was requested for an order"
    described by "Initiates the picking and packing process for order fulfillment."

  // Types for order integration
  type OrderLine is {
    lineNumber: Integer,
    productId: ProductId,
    quantity: Integer,
    unitOfMeasure: UnitOfMeasure
  } briefly "A line item in an order"
    described by "Represents a single product and quantity requested in an order."

} with {
  option is external
  briefly "External order management system"
  described by {
    | The Order Management Context represents the external order management
    | system that creates customer orders and requests fulfillment from the
    | warehouse. Events from this context trigger inventory reservation,
    | picking, and shipping processes.
  }
}

context ShippingContext is {

  // Commands sent to shipping
  command CreateShipment is {
    shipmentId: ShipmentId,
    orderId: String(1, 50),
    warehouseId: WarehouseId,
    destinationAddress: Address,
    items: ShipmentItem*,
    requestedCarrier: String(0, 100),
    serviceLevel: String(1, 50)
  } briefly "Request creation of an outbound shipment"
    described by "Initiates the shipping process for packed inventory ready to leave the warehouse."

  // Events received from shipping
  event ShipmentDispatched is {
    shipmentId: ShipmentId,
    orderId: String(1, 50),
    carrier: String(1, 100),
    trackingNumber: String(1, 100),
    dispatchedAt: TimeStamp
  } briefly "A shipment was dispatched from the warehouse"
    described by "Confirms that inventory has left the warehouse and is in transit to the customer."

  event ShipmentDelivered is {
    shipmentId: ShipmentId,
    deliveredAt: TimeStamp,
    signedBy: String(0, 100)
  } briefly "A shipment was delivered to the destination"
    described by "Confirms successful delivery of the shipment to the customer."

  // Types for shipping integration
  type ShipmentItem is {
    productId: ProductId,
    quantity: Integer,
    lotNumber: String(0, 50)
  } briefly "An item included in a shipment"
    described by "Represents a single product and quantity in an outbound shipment."

} with {
  option is external
  briefly "External shipping and carrier integration"
  described by {
    | The Shipping Context represents external shipping systems and carrier
    | integrations. It receives shipment requests from the warehouse and
    | provides tracking updates as shipments move through the delivery network.
  }
}

context PurchasingContext is {

  // Events received from purchasing
  event PurchaseOrderReceived is {
    purchaseOrderId: String(1, 50),
    supplierId: String(1, 50),
    warehouseId: WarehouseId,
    expectedDeliveryDate: Date,
    items: PurchaseOrderItem*
  } briefly "A purchase order was confirmed by supplier"
    described by "Notifies the warehouse of incoming inventory so receiving can be planned."

  event InboundShipmentArrived is {
    shipmentId: ShipmentId,
    purchaseOrderId: String(1, 50),
    carrier: String(1, 100),
    arrivedAt: TimeStamp
  } briefly "An inbound shipment arrived at the warehouse"
    described by "Triggers the receiving process for incoming supplier shipments."

  // Types for purchasing integration
  type PurchaseOrderItem is {
    productId: ProductId,
    orderedQuantity: Integer,
    unitOfMeasure: UnitOfMeasure,
    unitCost: Number
  } briefly "A line item in a purchase order"
    described by "Represents a single product ordered from a supplier."

} with {
  option is external
  briefly "External purchasing and procurement system"
  described by {
    | The Purchasing Context represents the external procurement system that
    | creates purchase orders with suppliers and notifies the warehouse of
    | expected inbound shipments for receiving planning.
  }
}

context ProductCatalogContext is {

  // Queries to product catalog
  query GetProductDetails is {
    productId: ProductId
  } briefly "Retrieve product master data"
    described by "Fetches product information including name, dimensions, and handling requirements."

  result ProductDetailsResult is {
    productId: ProductId,
    productName: String(1, 200),
    sku: String(1, 50),
    description: String(0, 1000),
    weight: Number,
    weightUnit: UnitOfMeasure,
    dimensions: ProductDimensions,
    requiresLotTracking: Boolean,
    requiresExpirationTracking: Boolean,
    storageRequirements: String(0, 500)
  } briefly "Product master data details"
    described by "Complete product information needed for warehouse handling."

  // Types for product catalog integration
  type ProductDimensions is {
    length: Number,
    width: Number,
    height: Number,
    dimensionUnit: String(1, 20)
  } briefly "Physical dimensions of a product"
    described by "Used for space planning and carton selection during packing."

} with {
  option is external
  briefly "External product catalog and master data"
  described by {
    | The Product Catalog Context represents the external product information
    | management system that maintains master data for all products handled
    | in the warehouse including dimensions, weights, and handling requirements.
  }
}

context InventoryPlanningContext is {

  // Events received from planning
  event ReorderPointUpdated is {
    productId: ProductId,
    warehouseId: WarehouseId,
    newReorderPoint: Integer,
    newReorderQuantity: Integer,
    effectiveDate: Date
  } briefly "Inventory planning updated reorder parameters"
    described by "Updates the threshold at which low stock alerts are generated."

  event DemandForecastUpdated is {
    productId: ProductId,
    warehouseId: WarehouseId,
    forecastPeriod: String(1, 50),
    expectedDemand: Integer,
    confidenceLevel: Number
  } briefly "Demand forecast was updated"
    described by "Provides updated demand predictions for inventory positioning decisions."

} with {
  option is external
  briefly "External inventory planning and forecasting"
  described by {
    | The Inventory Planning Context represents external demand planning and
    | forecasting systems that provide reorder parameters and demand predictions
    | used for inventory optimization and replenishment decisions.
  }
}
