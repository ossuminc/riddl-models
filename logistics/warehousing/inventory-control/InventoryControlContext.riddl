// Inventory Control - Inventory Control Context

context InventoryControlContext is {

  include "types.riddl"
  include "InventoryItem.riddl"

  repository InventoryRepository is {
    schema InventoryData is relational
      of inventoryItems as InventoryItem
      index on field InventoryItem.itemId
      index on field InventoryItem.itemInfo.productId
      index on field InventoryItem.itemInfo.warehouseId
      index on field InventoryItem.status

    handler InventoryPersistence is {
      on event InventoryItem.InventoryItemCreated {
        prompt "Store new inventory item"
      }
      on event InventoryItem.QuantityAdjusted {
        prompt "Update item quantity"
      }
      on event InventoryItem.StockReserved {
        prompt "Update reserved quantity"
      }
      on event InventoryItem.CycleCountRecorded {
        prompt "Store cycle count result"
      }
      on event InventoryItem.ItemRelocated {
        prompt "Update item bin location"
      }
      on event InventoryItem.ItemDeactivated {
        prompt "Mark item as inactive"
      }
    } with {
      briefly "Persists inventory events"
      described by "Handles event-driven persistence."
    }
  } with {
    briefly "Inventory data persistence"
    described by "Persistent storage for inventory items."
  }

  projector InventoryAccuracyMetrics is {
    updates repository InventoryRepository

    record WarehouseAccuracy is {
      totalItemsCounted is Natural with { briefly "Counted" described by "Items counted." }
      accurateCount is Natural with { briefly "Accurate" described by "Accurate counts." }
      varianceCount is Natural with { briefly "Variances" described by "Counts with variance." }
      accuracyPercentage is Decimal(5, 2) with { briefly "Accuracy" described by "Accuracy percentage." }
      totalAdjustments is Natural with { briefly "Adjustments" described by "Total adjustments made." }
    } with {
      briefly "Warehouse accuracy"
      described by "Warehouse inventory accuracy metrics."
    }

    handler AccuracyMetricsHandler is {
      on event InventoryItem.CycleCountRecorded {
        prompt "Update count totals and accuracy rate"
      }
      on event InventoryItem.QuantityAdjusted {
        prompt "Increment adjustment count"
      }
      on event InventoryItem.ReplenishmentTriggered {
        prompt "Track replenishment frequency"
      }
    } with {
      briefly "Maintains accuracy metrics"
      described by "Projects events into accuracy metrics."
    }
  } with {
    briefly "Inventory accuracy metrics"
    described by "Inventory accuracy and count analytics."
  }

} with {
  briefly "Bounded context for inventory control"
  described by "Warehouse inventory control context."
}
