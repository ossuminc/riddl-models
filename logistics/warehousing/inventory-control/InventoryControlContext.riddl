// Inventory Control - Inventory Control Context
context InventoryControlContext is {
  include "types.riddl"
  include "InventoryItem.riddl"
  repository InventoryRepository is {
    schema InventoryData is relational
      of inventoryItems as type InventoryItem
        index on field InventoryItem.itemId
        index on field InventoryItem.itemInfo.productId
        index on field InventoryItem.itemInfo.warehouseId
        index on field InventoryItem.status

    handler InventoryPersistence is {
      on command InventoryItem.CreateInventoryItem is {
        prompt "Store new inventory item"
      }
      on command InventoryItem.AdjustQuantity is {
        prompt "Update item quantity"
      }
      on command InventoryItem.ReserveStock is {
        prompt "Update reserved quantity"
      }
      on command InventoryItem.RecordCycleCount is {
        prompt "Store cycle count result"
      }
      on command InventoryItem.RelocateItem is {
        prompt "Update item bin location"
      }
      on command InventoryItem.DeactivateItem is {
        prompt "Mark item as inactive"
      }
    } with {
      briefly "Persists inventory commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Inventory data persistence"
    described as {
      |Persistent storage for inventory items.
    }
  }
  projector InventoryAccuracyMetrics is {
    record WarehouseAccuracy is  {
      totalItemsCounted: Natural with {
        briefly "Counted"
        described as {
          |Items counted.
        }
      }
      accurateCount: Natural with {
        briefly "Accurate"
        described as {
          |Accurate counts.
        }
      }
      varianceCount: Natural with {
        briefly "Variances"
        described as {
          |Counts with variance.
        }
      }
      accuracyPercentage: Decimal(5,2) with {
        briefly "Accuracy"
        described as {
          |Accuracy percentage.
        }
      }
      totalAdjustments: Natural with {
        briefly "Adjustments"
        described as {
          |Total adjustments made.
        }
      }
    } with {
      briefly "Warehouse accuracy"
      described as {
        |Warehouse inventory accuracy metrics.
      }
    }
    handler AccuracyMetricsHandler is {
      on event InventoryItem.CycleCountRecorded is {
        prompt "Update count totals and accuracy rate"
      }
      on event InventoryItem.QuantityAdjusted is {
        prompt "Increment adjustment count"
      }
      on event InventoryItem.ReplenishmentTriggered is {
        prompt "Track replenishment frequency"
      }
    } with {
      briefly "Maintains accuracy metrics"
      described as {
        |Projects events into accuracy metrics.
      }
    }
  } with {
    briefly "Inventory accuracy metrics"
    described as {
      |Inventory accuracy and count analytics.
    }
  }
} with {
  briefly "Bounded context for inventory control"
  described as {
    |Warehouse inventory control context.
  }
}
