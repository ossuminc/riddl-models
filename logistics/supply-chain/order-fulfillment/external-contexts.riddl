// Order Fulfillment - External Contexts

context InventoryManagement is {

  query CheckAvailability is {
    sku is String(1, 50) with { briefly "SKU" described by "Product SKU." }
    warehouseId is WarehouseId with { briefly "Warehouse" described by "Warehouse." }
    quantity is Natural with { briefly "Quantity" described by "Requested qty." }
  } with {
    briefly "Check availability"
    described by "Checks inventory availability."
  }

  result InventoryAvailability is {
    sku is String(1, 50) with { briefly "SKU" described by "Product SKU." }
    available is Natural with { briefly "Available" described by "Available qty." }
    reserved is Natural with { briefly "Reserved" described by "Reserved qty." }
    locations is many String(1, 50) with { briefly "Locations" described by "Bin locations." }
  } with {
    briefly "Inventory availability"
    described by "Stock availability response."
  }

  command ReserveInventory is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    sku is String(1, 50) with { briefly "SKU" described by "Product SKU." }
    quantity is Natural with { briefly "Quantity" described by "Qty to reserve." }
  } with {
    briefly "Reserve inventory"
    described by "Reserves inventory for order."
  }

  event InventoryReserved is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    sku is String(1, 50) with { briefly "SKU" described by "Product SKU." }
    quantity is Natural with { briefly "Quantity" described by "Qty reserved." }
    reservedAt is TimeStamp with { briefly "Reserved" described by "Reserve time." }
  } with {
    briefly "Inventory reserved"
    described by "Emitted when stock reserved."
  }

} with {
  option is external
  briefly "External inventory management"
  described by "Warehouse inventory system."
}

context ShippingCarrier is {

  query GetShippingRates is {
    origin is ShippingAddress with { briefly "Origin" described by "Ship from." }
    destination is ShippingAddress with { briefly "Destination" described by "Ship to." }
    weight is Decimal(8, 2) with { briefly "Weight" described by "Package weight." }
    dimensions is String(1, 50) with { briefly "Dimensions" described by "Package dims." }
  } with {
    briefly "Get shipping rates"
    described by "Gets carrier rates."
  }

  result ShippingRates is {
    rates is many ShipmentInfo with { briefly "Rates" described by "Available rates." }
  } with {
    briefly "Shipping rates"
    described by "Carrier rate options."
  }

  command CreateShipment is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    carrier is String(1, 100) with { briefly "Carrier" described by "Carrier name." }
    serviceLevel is String(1, 50) with { briefly "Service" described by "Service level." }
    packages is many PackingSlip with { briefly "Packages" described by "Package details." }
  } with {
    briefly "Create shipment"
    described by "Creates carrier shipment."
  }

  event ShipmentCreated is {
    orderId is FulfillmentOrderId with { briefly "Order" described by "Order ID." }
    trackingNumber is String(1, 100) with { briefly "Tracking" described by "Tracking number." }
    labelUrl is String(1, 500) with { briefly "Label" described by "Label URL." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Shipment created"
    described by "Emitted when shipment created."
  }

} with {
  option is external
  briefly "External shipping carrier"
  described by "Carrier shipping API."
}

context OrderManagement is {

  event SalesOrderReceived is {
    salesOrderId is SalesOrderId with { briefly "Order" described by "Sales order ID." }
    customerId is UUID with { briefly "Customer" described by "Customer ID." }
    orderTotal is Decimal(12, 2) with { briefly "Total" described by "Order total." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receive time." }
  } with {
    briefly "Sales order received"
    described by "Emitted when sales order received."
  }

  command UpdateOrderStatus is {
    salesOrderId is SalesOrderId with { briefly "Order" described by "Sales order ID." }
    fulfillmentStatus is OrderStatus with { briefly "Status" described by "Fulfillment status." }
    trackingNumber is optional String(1, 100) with { briefly "Tracking" described by "Tracking." }
  } with {
    briefly "Update order status"
    described by "Updates sales order with fulfillment."
  }

} with {
  option is external
  briefly "External order management"
  described by "E-commerce order system."
}

context CustomerNotification is {

  command SendShipmentNotification is {
    salesOrderId is SalesOrderId with { briefly "Order" described by "Sales order ID." }
    trackingNumber is String(1, 100) with { briefly "Tracking" described by "Tracking number." }
    carrier is String(1, 100) with { briefly "Carrier" described by "Carrier name." }
    estimatedDelivery is Date with { briefly "Est delivery" described by "Est delivery." }
  } with {
    briefly "Send shipment notification"
    described by "Notifies customer of shipment."
  }

  command SendDeliveryNotification is {
    salesOrderId is SalesOrderId with { briefly "Order" described by "Sales order ID." }
    deliveredAt is TimeStamp with { briefly "Delivered" described by "Delivery time." }
  } with {
    briefly "Send delivery notification"
    described by "Notifies customer of delivery."
  }

} with {
  option is external
  briefly "External customer notification"
  described by "Customer communication system."
}
