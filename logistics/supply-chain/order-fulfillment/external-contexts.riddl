// Order Fulfillment - External Contexts
context InventoryManagement is {
  query CheckAvailability is  {
    sku: String(1,50) with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    warehouseId: WarehouseId with {
      briefly "Warehouse"
      described as {
        |Warehouse.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Requested qty.
      }
    }
  } with {
    briefly "Check availability"
    described as {
      |Checks inventory availability.
    }
  }
  result InventoryAvailability is  {
    sku: String(1,50) with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    available: Natural with {
      briefly "Available"
      described as {
        |Available qty.
      }
    }
    reserved: Natural with {
      briefly "Reserved"
      described as {
        |Reserved qty.
      }
    }
    locations: String(1,50)+ with {
      briefly "Locations"
      described as {
        |Bin locations.
      }
    }
  } with {
    briefly "Inventory availability"
    described as {
      |Stock availability response.
    }
  }
  command ReserveInventory is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    sku: String(1,50) with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Qty to reserve.
      }
    }
  } with {
    briefly "Reserve inventory"
    described as {
      |Reserves inventory for order.
    }
  }
  event InventoryReserved is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    sku: String(1,50) with {
      briefly "SKU"
      described as {
        |Product SKU.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Qty reserved.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |Reserve time.
      }
    }
  } with {
    briefly "Inventory reserved"
    described as {
      |Emitted when stock reserved.
    }
  }
} with {
  option external()
  briefly "External inventory management"
  described as {
    |Warehouse inventory system.
  }
}
context ShippingCarrier is {
  query GetShippingRates is  {
    origin: ShippingAddress with {
      briefly "Origin"
      described as {
        |Ship from.
      }
    }
    destination: ShippingAddress with {
      briefly "Destination"
      described as {
        |Ship to.
      }
    }
    weight: Decimal(8,2) with {
      briefly "Weight"
      described as {
        |Package weight.
      }
    }
    dimensions: String(1,50) with {
      briefly "Dimensions"
      described as {
        |Package dims.
      }
    }
  } with {
    briefly "Get shipping rates"
    described as {
      |Gets carrier rates.
    }
  }
  result ShippingRates is  {
    rates: ShipmentInfo+ with {
      briefly "Rates"
      described as {
        |Available rates.
      }
    }
  } with {
    briefly "Shipping rates"
    described as {
      |Carrier rate options.
    }
  }
  command CreateShipment is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    carrier: String(1,100) with {
      briefly "Carrier"
      described as {
        |Carrier name.
      }
    }
    serviceLevel: String(1,50) with {
      briefly "Service"
      described as {
        |Service level.
      }
    }
    packages: PackingSlip+ with {
      briefly "Packages"
      described as {
        |Package details.
      }
    }
  } with {
    briefly "Create shipment"
    described as {
      |Creates carrier shipment.
    }
  }
  event ShipmentCreated is  {
    orderId: FulfillmentOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    trackingNumber: String(1,100) with {
      briefly "Tracking"
      described as {
        |Tracking number.
      }
    }
    labelUrl: String(1,500) with {
      briefly "Label"
      described as {
        |Label URL.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Shipment created"
    described as {
      |Emitted when shipment created.
    }
  }
} with {
  option external()
  briefly "External shipping carrier"
  described as {
    |Carrier shipping API.
  }
}
context OrderManagement is {
  event SalesOrderReceived is  {
    salesOrderId: SalesOrderId with {
      briefly "Order"
      described as {
        |Sales order ID.
      }
    }
    customerId: UUID with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    orderTotal: Decimal(12,2) with {
      briefly "Total"
      described as {
        |Order total.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Receive time.
      }
    }
  } with {
    briefly "Sales order received"
    described as {
      |Emitted when sales order received.
    }
  }
  command UpdateOrderStatus is  {
    salesOrderId: SalesOrderId with {
      briefly "Order"
      described as {
        |Sales order ID.
      }
    }
    fulfillmentStatus: OrderStatus with {
      briefly "Status"
      described as {
        |Fulfillment status.
      }
    }
    fulfillmentTrackingNumber: String(1,100)? with {
      briefly "Tracking"
      described as {
        |Tracking.
      }
    }
  } with {
    briefly "Update order status"
    described as {
      |Updates sales order with fulfillment.
    }
  }
} with {
  option external()
  briefly "External order management"
  described as {
    |E-commerce order system.
  }
}
context CustomerNotification is {
  command SendShipmentNotification is  {
    salesOrderId: SalesOrderId with {
      briefly "Order"
      described as {
        |Sales order ID.
      }
    }
    trackingNumber: String(1,100) with {
      briefly "Tracking"
      described as {
        |Tracking number.
      }
    }
    carrier: String(1,100) with {
      briefly "Carrier"
      described as {
        |Carrier name.
      }
    }
    estimatedDelivery: Date with {
      briefly "Est delivery"
      described as {
        |Est delivery.
      }
    }
  } with {
    briefly "Send shipment notification"
    described as {
      |Notifies customer of shipment.
    }
  }
  command SendDeliveryNotification is  {
    salesOrderId: SalesOrderId with {
      briefly "Order"
      described as {
        |Sales order ID.
      }
    }
    deliveredAt: TimeStamp with {
      briefly "Delivered"
      described as {
        |Delivery time.
      }
    }
  } with {
    briefly "Send delivery notification"
    described as {
      |Notifies customer of delivery.
    }
  }
} with {
  option external()
  briefly "External customer notification"
  described as {
    |Customer communication system.
  }
}
