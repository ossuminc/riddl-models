// Order Fulfillment - Fulfillment Context
context FulfillmentContext is {
  include "types.riddl"
  include "FulfillmentOrder.riddl"
  repository FulfillmentRepository is {
    schema FulfillmentData is relational
      of orders as type FulfillmentOrder
        index on field FulfillmentOrder.orderId
        index on field FulfillmentOrder.salesOrderId
        index on field FulfillmentOrder.status
        index on field FulfillmentOrder.warehouseId

    handler FulfillmentPersistence is {
      on command FulfillmentOrder.CreateOrder is {
        prompt "Store new fulfillment order"
      }
      on command FulfillmentOrder.AllocateInventory is {
        prompt "Update order allocations"
      }
      on command FulfillmentOrder.RecordPick is {
        prompt "Update pick task status"
      }
      on command FulfillmentOrder.PackOrder is {
        prompt "Store packing slip"
      }
      on command FulfillmentOrder.ShipOrder is {
        prompt "Store shipment info"
      }
      on command FulfillmentOrder.ConfirmDelivery is {
        prompt "Update order to completed"
      }
    } with {
      briefly "Persists fulfillment commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Fulfillment data persistence"
    described as {
      |Persistent storage for orders.
    }
  }
  projector FulfillmentMetrics is {
    record WarehouseMetrics is  {
      warehouseId: WarehouseId with {
        briefly "Warehouse"
        described as {
          |Warehouse ID.
        }
      }
      ordersProcessed: Natural with {
        briefly "Processed"
        described as {
          |Orders processed.
        }
      }
      ordersShipped: Natural with {
        briefly "Shipped"
        described as {
          |Orders shipped.
        }
      }
      avgFulfillmentTime: Decimal(6,2) with {
        briefly "Avg time"
        described as {
          |Avg fulfillment hours.
        }
      }
      onTimeRate: Decimal(5,2) with {
        briefly "On time"
        described as {
          |On-time percentage.
        }
      }
      pickAccuracy: Decimal(5,2) with {
        briefly "Accuracy"
        described as {
          |Pick accuracy pct.
        }
      }
    } with {
      briefly "Warehouse metrics"
      described as {
        |Fulfillment metrics by warehouse.
      }
    }
    handler MetricsHandler is {
      on event FulfillmentOrder.OrderCreated is {
        prompt "Track order receipt"
      }
      on event FulfillmentOrder.OrderShipped is {
        prompt "Calculate fulfillment time and update metrics"
      }
      on event FulfillmentOrder.DeliveryConfirmed is {
        prompt "Update on-time delivery rate"
      }
    } with {
      briefly "Maintains fulfillment metrics"
      described as {
        |Projects events into metrics.
      }
    }
  } with {
    briefly "Fulfillment metrics"
    described as {
      |Order fulfillment analytics.
    }
  }
} with {
  briefly "Bounded context for order fulfillment"
  described as {
    |Supply chain fulfillment context.
  }
}
