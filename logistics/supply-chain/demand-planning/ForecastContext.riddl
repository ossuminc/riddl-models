// Demand Planning - Forecast Context
context ForecastContext is {
  include "types.riddl"
  include "Forecast.riddl"
  repository ForecastRepository is {
    schema ForecastData is relational
      of forecasts as type Forecast
        index on field Forecast.status
        index on field Forecast.horizon.startDate
        index on field Forecast.method

    handler ForecastPersistence is {
      on command Forecast.CreateForecast is {
        prompt "Store new forecast record"
      }
      on command Forecast.GenerateStatisticalForecast is {
        prompt "Store generated forecast data"
      }
      on command Forecast.AddLocationForecast is {
        prompt "Store location forecast"
      }
      on command Forecast.AdjustForecast is {
        prompt "Store forecast adjustment"
      }
      on command Forecast.AddConsensusInput is {
        prompt "Store consensus input"
      }
      on command Forecast.ApproveForecast is {
        prompt "Update forecast status"
      }
      on command Forecast.ActivateForecast is {
        prompt "Mark forecast as active"
      }
      on command Forecast.CalculateAccuracy is {
        prompt "Store accuracy metrics"
      }
      on command Forecast.ArchiveForecast is {
        prompt "Archive forecast record"
      }
    } with {
      briefly "Persists forecast commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Forecast data persistence"
    described as {
      |Persistent storage for forecasts.
    }
  }
  projector ForecastAnalytics is {
    record PlanningMetrics is  {
      activeForecastCount: Natural with {
        briefly "Active"
        described as {
          |Active forecasts.
        }
      }
      averageMAPE: Decimal(5,2) with {
        briefly "Avg MAPE"
        described as {
          |Average MAPE.
        }
      }
      bestPerformingMethod: String(1,50) with {
        briefly "Best method"
        described as {
          |Best method.
        }
      }
      totalAdjustmentCount: Natural with {
        briefly "Adjustments"
        described as {
          |Total adjustments.
        }
      }
      consensusAccuracy: Decimal(5,2) with {
        briefly "Consensus"
        described as {
          |Consensus accuracy.
        }
      }
    } with {
      briefly "Planning metrics"
      described as {
        |Demand planning metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Forecast.ForecastCreated is {
        prompt "Track forecast creation"
      }
      on event Forecast.ForecastActivated is {
        prompt "Update active count"
      }
      on event Forecast.AccuracyCalculated is {
        prompt "Update accuracy metrics"
      }
      on event Forecast.ForecastAdjusted is {
        prompt "Track adjustments"
      }
    } with {
      briefly "Maintains planning analytics"
      described as {
        |Projects events into metrics.
      }
    }
  } with {
    briefly "Forecast analytics"
    described as {
      |Demand planning performance.
    }
  }
} with {
  briefly "Bounded context for demand planning"
  described as {
    |Demand forecasting context.
  }
}
