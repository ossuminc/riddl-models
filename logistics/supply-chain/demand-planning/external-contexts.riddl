// Demand Planning - External Contexts

context ForecastingEngine is {

  command GenerateMLForecast is {
    historicalData is many HistoricalData with { briefly "History" described by "Historical data." }
    horizon is PlanningHorizon with { briefly "Horizon" described by "Planning horizon." }
    features is many String(1, 100) with { briefly "Features" described by "Model features." }
  } with {
    briefly "Generate ML forecast"
    described by "Generates machine learning forecast."
  }

  event MLForecastGenerated is {
    forecasts is many ProductForecast with { briefly "Forecasts" described by "Generated forecasts." }
    modelUsed is String(1, 100) with { briefly "Model" described by "Model used." }
    modelAccuracy is Decimal(5, 2) with { briefly "Accuracy" described by "Model accuracy." }
    generatedAt is TimeStamp with { briefly "Generated" described by "Generation time." }
  } with {
    briefly "ML forecast generated"
    described by "Emitted when ML forecast ready."
  }

  command RunTimeSeriesAnalysis is {
    data is many HistoricalData with { briefly "Data" described by "Time series data." }
    analysisMethod is String(1, 50) with { briefly "Method" described by "Analysis method." }
  } with {
    briefly "Run time series analysis"
    described by "Analyzes time series patterns."
  }

  event TimeSeriesAnalysisComplete is {
    trend is String(1, 50) with { briefly "Trend" described by "Detected trend." }
    seasonality is optional String(1, 100) with { briefly "Seasonality" described by "Seasonal pattern." }
    cyclicality is optional String(1, 100) with { briefly "Cyclicality" described by "Cyclic pattern." }
  } with {
    briefly "Analysis complete"
    described by "Emitted when analysis done."
  }

} with {
  option is external
  briefly "External forecasting engine"
  described by "ML and statistical forecasting."
}

context ERPIntegration is {

  command FetchHistoricalDemand is {
    productIds is many ProductId with { briefly "Products" described by "Products to fetch." }
    locationIds is many LocationId with { briefly "Locations" described by "Locations to fetch." }
    startDate is Date with { briefly "Start" described by "Period start." }
    endDate is Date with { briefly "End" described by "Period end." }
  } with {
    briefly "Fetch historical demand"
    described by "Gets demand history from ERP."
  }

  event HistoricalDemandFetched is {
    data is many HistoricalData with { briefly "Data" described by "Historical data." }
    recordCount is Natural with { briefly "Records" described by "Record count." }
    fetchedAt is TimeStamp with { briefly "Fetched" described by "Fetch time." }
  } with {
    briefly "Historical demand fetched"
    described by "Emitted when data retrieved."
  }

  command PublishForecast is {
    forecastId is ForecastId with { briefly "Forecast" described by "Forecast ID." }
    productForecasts is many ProductForecast with { briefly "Forecasts" described by "Product forecasts." }
  } with {
    briefly "Publish forecast"
    described by "Sends forecast to ERP."
  }

  event ForecastPublished is {
    forecastId is ForecastId with { briefly "Forecast" described by "Forecast ID." }
    recordsPublished is Natural with { briefly "Records" described by "Records published." }
    publishedAt is TimeStamp with { briefly "Published" described by "Publish time." }
  } with {
    briefly "Forecast published"
    described by "Emitted when published to ERP."
  }

} with {
  option is external
  briefly "External ERP integration"
  described by "ERP system integration."
}

context MarketIntelligence is {

  command GetMarketTrends is {
    productCategories is many String(1, 100) with { briefly "Categories" described by "Product categories." }
    regions is many String(1, 100) with { briefly "Regions" described by "Geographic regions." }
  } with {
    briefly "Get market trends"
    described by "Retrieves market intelligence."
  }

  event MarketTrendsReceived is {
    trends is many DemandDriver with { briefly "Trends" described by "Market trends." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Market trends received"
    described by "Emitted when trends available."
  }

  command GetCompetitorActivity is {
    competitors is many String(1, 100) with { briefly "Competitors" described by "Competitor names." }
  } with {
    briefly "Get competitor activity"
    described by "Gets competitor intelligence."
  }

  event CompetitorActivityReceived is {
    activities is many DemandDriver with { briefly "Activities" described by "Competitor activities." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Competitor activity received"
    described by "Emitted when intel available."
  }

} with {
  option is external
  briefly "External market intelligence"
  described by "Market and competitor intelligence."
}

context SalesInput is {

  command RequestSalesForecast is {
    productIds is many ProductId with { briefly "Products" described by "Products to forecast." }
    horizon is PlanningHorizon with { briefly "Horizon" described by "Forecast horizon." }
    salesReps is many String(1, 100) with { briefly "Reps" described by "Sales reps to request." }
  } with {
    briefly "Request sales forecast"
    described by "Requests input from sales."
  }

  event SalesForecastRequested is {
    requestId is UUID with { briefly "Request" described by "Request ID." }
    requestedAt is TimeStamp with { briefly "Requested" described by "Request time." }
  } with {
    briefly "Sales forecast requested"
    described by "Emitted when request sent."
  }

  event SalesForecastReceived is {
    inputs is many ConsensusInput with { briefly "Inputs" described by "Sales inputs." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Sales forecast received"
    described by "Emitted when sales input received."
  }

} with {
  option is external
  briefly "External sales input"
  described by "Sales team forecast input."
}
