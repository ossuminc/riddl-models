// Supplier Management - Supplier Entity
entity Supplier is {
  command RegisterSupplier is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |New supplier identifier.
      }
    }
    supplierInfo: SupplierInfo with {
      briefly "Supplier info"
      described as {
        |Supplier profile details.
      }
    }
  } with {
    briefly "Register supplier"
    described as {
      |Registers a new supplier application.
    }
  }
  command QualifySupplier is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |Supplier identifier.
      }
    }
    criteria: QualificationCriteria with {
      briefly "Criteria"
      described as {
        |Qualification assessment criteria.
      }
    }
    qualifiedBy: String(3,100) with {
      briefly "Qualified by"
      described as {
        |Person performing qualification.
      }
    }
  } with {
    briefly "Qualify supplier"
    described as {
      |Qualifies a supplier based on criteria.
    }
  }
  command ActivateSupplier is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |Supplier identifier.
      }
    }
    activatedBy: String(3,100) with {
      briefly "Activated by"
      described as {
        |Person activating the supplier.
      }
    }
  } with {
    briefly "Activate supplier"
    described as {
      |Activates a qualified supplier.
    }
  }
  command AssignContract is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |Supplier identifier.
      }
    }
    contract: ContractInfo with {
      briefly "Contract"
      described as {
        |Contract details.
      }
    }
  } with {
    briefly "Assign contract"
    described as {
      |Assigns a contract to the supplier.
    }
  }
  command RecordPerformance is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |Supplier identifier.
      }
    }
    score: PerformanceScore with {
      briefly "Score"
      described as {
        |Performance scorecard.
      }
    }
  } with {
    briefly "Record performance"
    described as {
      |Records supplier performance evaluation.
    }
  }
  command AddCertification is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |Supplier identifier.
      }
    }
    certification: CertificationInfo with {
      briefly "Certification"
      described as {
        |Certification details.
      }
    }
  } with {
    briefly "Add certification"
    described as {
      |Adds a certification to the supplier.
    }
  }
  command AssessRisk is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |Supplier identifier.
      }
    }
    assessment: RiskAssessment with {
      briefly "Assessment"
      described as {
        |Risk assessment details.
      }
    }
  } with {
    briefly "Assess risk"
    described as {
      |Records a risk assessment for the supplier.
    }
  }
  command SuspendSupplier is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |Supplier identifier.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
  } with {
    briefly "Suspend supplier"
    described as {
      |Suspends an active supplier.
    }
  }
  command DisqualifySupplier is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |Supplier identifier.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Disqualification reason.
      }
    }
  } with {
    briefly "Disqualify supplier"
    described as {
      |Disqualifies a supplier.
    }
  }
  command ReinstateSupplier is  {
    supplierId: SupplierId with {
      briefly "Supplier ID"
      described as {
        |Supplier identifier.
      }
    }
    reinstatedBy: String(3,100) with {
      briefly "Reinstated by"
      described as {
        |Person reinstating the supplier.
      }
    }
  } with {
    briefly "Reinstate supplier"
    described as {
      |Reinstates a suspended supplier.
    }
  }
  // Events
  event SupplierRegistered is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    supplierInfo: SupplierInfo with {
      briefly "Info"
      described as {
        |Supplier info.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Supplier registered"
    described as {
      |Emitted when a supplier is registered.
    }
  }
  event SupplierQualified is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    criteria: QualificationCriteria with {
      briefly "Criteria"
      described as {
        |Qualification criteria.
      }
    }
    qualifiedAt: TimeStamp with {
      briefly "Qualified"
      described as {
        |Qualification time.
      }
    }
  } with {
    briefly "Supplier qualified"
    described as {
      |Emitted when a supplier passes qualification.
    }
  }
  event SupplierActivated is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Supplier activated"
    described as {
      |Emitted when a supplier is activated.
    }
  }
  event ContractAssigned is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    contract: ContractInfo with {
      briefly "Contract"
      described as {
        |Contract details.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Contract assigned"
    described as {
      |Emitted when a contract is assigned.
    }
  }
  event PerformanceRecorded is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    score: PerformanceScore with {
      briefly "Score"
      described as {
        |Performance score.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Recording time.
      }
    }
  } with {
    briefly "Performance recorded"
    described as {
      |Emitted when performance is evaluated.
    }
  }
  event CertificationAdded is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    certification: CertificationInfo with {
      briefly "Certification"
      described as {
        |Certification info.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Addition time.
      }
    }
  } with {
    briefly "Certification added"
    described as {
      |Emitted when a certification is added.
    }
  }
  event RiskAssessed is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    assessment: RiskAssessment with {
      briefly "Assessment"
      described as {
        |Risk assessment.
      }
    }
    assessedAt: TimeStamp with {
      briefly "Assessed"
      described as {
        |Assessment time.
      }
    }
  } with {
    briefly "Risk assessed"
    described as {
      |Emitted when a risk assessment is recorded.
    }
  }
  event SupplierSuspended is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
    suspendedAt: TimeStamp with {
      briefly "Suspended"
      described as {
        |Suspension time.
      }
    }
  } with {
    briefly "Supplier suspended"
    described as {
      |Emitted when a supplier is suspended.
    }
  }
  event SupplierDisqualified is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Disqualification reason.
      }
    }
    disqualifiedAt: TimeStamp with {
      briefly "Disqualified"
      described as {
        |Disqualification time.
      }
    }
  } with {
    briefly "Supplier disqualified"
    described as {
      |Emitted when a supplier is disqualified.
    }
  }
  event SupplierReinstated is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    reinstatedAt: TimeStamp with {
      briefly "Reinstated"
      described as {
        |Reinstatement time.
      }
    }
  } with {
    briefly "Supplier reinstated"
    described as {
      |Emitted when a supplier is reinstated.
    }
  }
  // States
  record ActiveStateData is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    supplierInfo: SupplierInfo with {
      briefly "Info"
      described as {
        |Supplier profile.
      }
    }
    status: SupplierStatus with {
      briefly "Status"
      described as {
        |Current status.
      }
    }
    qualification: QualificationCriteria? with {
      briefly "Qualification"
      described as {
        |Qualification results.
      }
    }
    contracts: ContractInfo* with {
      briefly "Contracts"
      described as {
        |Active contracts.
      }
    }
    certifications: CertificationInfo* with {
      briefly "Certifications"
      described as {
        |Supplier certifications.
      }
    }
    performanceHistory: PerformanceScore* with {
      briefly "Performance"
      described as {
        |Performance history.
      }
    }
    riskAssessment: RiskAssessment? with {
      briefly "Risk"
      described as {
        |Latest risk assessment.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Active supplier state"
    described as {
      |State for an active supplier in the system.
    }
  }
  record InactiveStateData is  {
    supplierId: SupplierId with {
      briefly "Supplier"
      described as {
        |Supplier ID.
      }
    }
    supplierName: String(3,200) with {
      briefly "Name"
      described as {
        |Supplier name.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Reason for inactivation.
      }
    }
    inactiveSince: TimeStamp with {
      briefly "Since"
      described as {
        |Inactive since.
      }
    }
  } with {
    briefly "Inactive supplier state"
    described as {
      |State for a disqualified or inactive supplier.
    }
  }
  state ActiveState of type Supplier.ActiveStateData
  state InactiveState of type Supplier.InactiveStateData
  handler SupplierHandler is {
    on command RegisterSupplier is {
      morph entity SupplierContext.Supplier to state SupplierContext.Supplier.ActiveState with command RegisterSupplier
      tell event SupplierRegistered to entity SupplierContext.Supplier
    }
    on command QualifySupplier is {
      tell event SupplierQualified to entity SupplierContext.Supplier
    }
    on command ActivateSupplier is {
      tell event SupplierActivated to entity SupplierContext.Supplier
    }
    on command AssignContract is {
      tell event ContractAssigned to entity SupplierContext.Supplier
    }
    on command RecordPerformance is {
      tell event PerformanceRecorded to entity SupplierContext.Supplier
    }
    on command AddCertification is {
      tell event CertificationAdded to entity SupplierContext.Supplier
    }
    on command AssessRisk is {
      tell event RiskAssessed to entity SupplierContext.Supplier
    }
    on command SuspendSupplier is {
      tell event SupplierSuspended to entity SupplierContext.Supplier
    }
    on command DisqualifySupplier is {
      morph entity SupplierContext.Supplier to state SupplierContext.Supplier.InactiveState with command DisqualifySupplier
      tell event SupplierDisqualified to entity SupplierContext.Supplier
    }
    on command ReinstateSupplier is {
      morph entity SupplierContext.Supplier to state SupplierContext.Supplier.ActiveState with command ReinstateSupplier
      tell event SupplierReinstated to entity SupplierContext.Supplier
    }
  } with {
    briefly "Processes supplier commands"
    described as {
      |Handles supplier lifecycle management.
    }
  }
} with {
  briefly "Supplier aggregate"
  described as {
    |Manages supplier lifecycle and relationships.
  }
}
