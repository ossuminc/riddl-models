// Carrier Management - Carrier Entity
entity Carrier is {
  command RegisterCarrier is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |New carrier identifier.
      }
    }
    carrierInfo: CarrierInfo with {
      briefly "Info"
      described as {
        |Carrier information.
      }
    }
    carrierType: CarrierType with {
      briefly "Type"
      described as {
        |Carrier type.
      }
    }
    primaryContact: ContactInfo with {
      briefly "Contact"
      described as {
        |Primary contact.
      }
    }
  } with {
    briefly "Register carrier"
    described as {
      |Registers a new carrier.
    }
  }
  command VerifyCredentials is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    verifiedBy: String(1,100) with {
      briefly "Verified by"
      described as {
        |Verifier name.
      }
    }
    notes: String(1,1000)? with {
      briefly "Notes"
      described as {
        |Verification notes.
      }
    }
  } with {
    briefly "Verify credentials"
    described as {
      |Verifies carrier credentials.
    }
  }
  command AddInsurance is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    policy: InsurancePolicy with {
      briefly "Policy"
      described as {
        |Insurance policy.
      }
    }
  } with {
    briefly "Add insurance"
    described as {
      |Adds insurance policy.
    }
  }
  command UpdateInsurance is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    policy: InsurancePolicy with {
      briefly "Policy"
      described as {
        |Updated policy.
      }
    }
  } with {
    briefly "Update insurance"
    described as {
      |Updates insurance policy.
    }
  }
  command DefineServiceArea is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    serviceArea: ServiceArea with {
      briefly "Area"
      described as {
        |Service area.
      }
    }
  } with {
    briefly "Define service area"
    described as {
      |Sets carrier coverage.
    }
  }
  command AddRate is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    rate: RateInfo with {
      briefly "Rate"
      described as {
        |Rate details.
      }
    }
  } with {
    briefly "Add rate"
    described as {
      |Adds shipping rate.
    }
  }
  command UpdateRate is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    rateId: UUID with {
      briefly "Rate ID"
      described as {
        |Rate to update.
      }
    }
    rate: RateInfo with {
      briefly "Rate"
      described as {
        |Updated rate.
      }
    }
  } with {
    briefly "Update rate"
    described as {
      |Updates shipping rate.
    }
  }
  command ActivateCarrier is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    activatedBy: String(1,100) with {
      briefly "Activated by"
      described as {
        |Activator name.
      }
    }
  } with {
    briefly "Activate carrier"
    described as {
      |Activates carrier for assignments.
    }
  }
  command SuspendCarrier is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
  } with {
    briefly "Suspend carrier"
    described as {
      |Suspends carrier from assignments.
    }
  }
  command ReinstateCarrier is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    reinstatedBy: String(1,100) with {
      briefly "Reinstated by"
      described as {
        |Reinstater name.
      }
    }
  } with {
    briefly "Reinstate carrier"
    described as {
      |Reinstates suspended carrier.
    }
  }
  command RecordPerformance is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    metrics: PerformanceMetrics with {
      briefly "Metrics"
      described as {
        |Performance data.
      }
    }
    periodEnd: Date with {
      briefly "Period"
      described as {
        |Metrics period end.
      }
    }
  } with {
    briefly "Record performance"
    described as {
      |Records performance metrics.
    }
  }
  command UpdateCapacity is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    capacity: CapacityInfo with {
      briefly "Capacity"
      described as {
        |Capacity info.
      }
    }
  } with {
    briefly "Update capacity"
    described as {
      |Updates available capacity.
    }
  }
  command TerminateCarrier is  {
    carrierId: CarrierId with {
      briefly "Carrier ID"
      described as {
        |Carrier identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Termination reason.
      }
    }
  } with {
    briefly "Terminate carrier"
    described as {
      |Terminates carrier relationship.
    }
  }
  // Events
  event CarrierRegistered is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    carrierInfo: CarrierInfo with {
      briefly "Info"
      described as {
        |Carrier info.
      }
    }
    carrierType: CarrierType with {
      briefly "Type"
      described as {
        |Carrier type.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Carrier registered"
    described as {
      |Emitted when carrier registered.
    }
  }
  event CredentialsVerified is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    verifiedBy: String(1,100) with {
      briefly "Verified by"
      described as {
        |Verifier.
      }
    }
    verifiedAt: TimeStamp with {
      briefly "Verified"
      described as {
        |Verification time.
      }
    }
  } with {
    briefly "Credentials verified"
    described as {
      |Emitted when credentials verified.
    }
  }
  event InsuranceAdded is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    policy: InsurancePolicy with {
      briefly "Policy"
      described as {
        |Insurance policy.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Insurance added"
    described as {
      |Emitted when insurance added.
    }
  }
  event InsuranceUpdated is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    policy: InsurancePolicy with {
      briefly "Policy"
      described as {
        |Updated policy.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Insurance updated"
    described as {
      |Emitted when insurance updated.
    }
  }
  event ServiceAreaDefined is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    serviceArea: ServiceArea with {
      briefly "Area"
      described as {
        |Service area.
      }
    }
    definedAt: TimeStamp with {
      briefly "Defined"
      described as {
        |Definition time.
      }
    }
  } with {
    briefly "Service area defined"
    described as {
      |Emitted when coverage set.
    }
  }
  event RateAdded is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    rate: RateInfo with {
      briefly "Rate"
      described as {
        |Rate info.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Rate added"
    described as {
      |Emitted when rate added.
    }
  }
  event RateUpdated is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    rate: RateInfo with {
      briefly "Rate"
      described as {
        |Updated rate.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Rate updated"
    described as {
      |Emitted when rate updated.
    }
  }
  event CarrierActivated is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    activatedBy: String(1,100) with {
      briefly "Activated by"
      described as {
        |Activator.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Carrier activated"
    described as {
      |Emitted when carrier activated.
    }
  }
  event CarrierSuspended is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason.
      }
    }
    suspendedAt: TimeStamp with {
      briefly "Suspended"
      described as {
        |Suspension time.
      }
    }
  } with {
    briefly "Carrier suspended"
    described as {
      |Emitted when carrier suspended.
    }
  }
  event CarrierReinstated is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    reinstatedBy: String(1,100) with {
      briefly "Reinstated by"
      described as {
        |Reinstater.
      }
    }
    reinstatedAt: TimeStamp with {
      briefly "Reinstated"
      described as {
        |Reinstatement time.
      }
    }
  } with {
    briefly "Carrier reinstated"
    described as {
      |Emitted when carrier reinstated.
    }
  }
  event PerformanceRecorded is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    metrics: PerformanceMetrics with {
      briefly "Metrics"
      described as {
        |Performance.
      }
    }
    periodEnd: Date with {
      briefly "Period"
      described as {
        |Period end.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Performance recorded"
    described as {
      |Emitted when metrics recorded.
    }
  }
  event CapacityUpdated is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    capacity: CapacityInfo with {
      briefly "Capacity"
      described as {
        |Capacity.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Capacity updated"
    described as {
      |Emitted when capacity updated.
    }
  }
  event CarrierTerminated is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason.
      }
    }
    terminatedAt: TimeStamp with {
      briefly "Terminated"
      described as {
        |Termination time.
      }
    }
  } with {
    briefly "Carrier terminated"
    described as {
      |Emitted when carrier terminated.
    }
  }
  // States
  record ActiveStateData is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    carrierInfo: CarrierInfo with {
      briefly "Info"
      described as {
        |Carrier info.
      }
    }
    carrierType: CarrierType with {
      briefly "Type"
      described as {
        |Carrier type.
      }
    }
    status: CarrierStatus with {
      briefly "Status"
      described as {
        |Carrier status.
      }
    }
    primaryContact: ContactInfo with {
      briefly "Contact"
      described as {
        |Primary contact.
      }
    }
    insurancePolicies: InsurancePolicy+ with {
      briefly "Insurance"
      described as {
        |Insurance policies.
      }
    }
    serviceAreas: ServiceArea* with {
      briefly "Areas"
      described as {
        |Service areas.
      }
    }
    rates: RateInfo* with {
      briefly "Rates"
      described as {
        |Shipping rates.
      }
    }
    currentMetrics: PerformanceMetrics? with {
      briefly "Metrics"
      described as {
        |Performance.
      }
    }
    currentCapacity: CapacityInfo* with {
      briefly "Capacity"
      described as {
        |Capacity.
      }
    }
    credentialsVerified: Boolean with {
      briefly "Verified"
      described as {
        |Credentials verified.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Active carrier state"
    described as {
      |Active carrier data.
    }
  }
  record TerminatedStateData is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    legalName: String(1,200) with {
      briefly "Name"
      described as {
        |Legal name.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Termination reason.
      }
    }
    terminatedAt: TimeStamp with {
      briefly "Terminated"
      described as {
        |Termination time.
      }
    }
  } with {
    briefly "Terminated carrier state"
    described as {
      |Terminated carrier data.
    }
  }
  state ActiveState of type Carrier.ActiveStateData
  state TerminatedState of type Carrier.TerminatedStateData
  handler CarrierHandler is {
    on command RegisterCarrier is {
      morph entity CarrierContext.Carrier to state CarrierContext.Carrier.ActiveState with command RegisterCarrier
      tell event CarrierRegistered to entity CarrierContext.Carrier
    }
    on command VerifyCredentials is {
      tell event CredentialsVerified to entity CarrierContext.Carrier
    }
    on command AddInsurance is {
      tell event InsuranceAdded to entity CarrierContext.Carrier
    }
    on command UpdateInsurance is {
      tell event InsuranceUpdated to entity CarrierContext.Carrier
    }
    on command DefineServiceArea is {
      tell event ServiceAreaDefined to entity CarrierContext.Carrier
    }
    on command AddRate is {
      tell event RateAdded to entity CarrierContext.Carrier
    }
    on command UpdateRate is {
      tell event RateUpdated to entity CarrierContext.Carrier
    }
    on command ActivateCarrier is {
      tell event CarrierActivated to entity CarrierContext.Carrier
    }
    on command SuspendCarrier is {
      tell event CarrierSuspended to entity CarrierContext.Carrier
    }
    on command ReinstateCarrier is {
      tell event CarrierReinstated to entity CarrierContext.Carrier
    }
    on command RecordPerformance is {
      tell event PerformanceRecorded to entity CarrierContext.Carrier
    }
    on command UpdateCapacity is {
      tell event CapacityUpdated to entity CarrierContext.Carrier
    }
    on command TerminateCarrier is {
      morph entity CarrierContext.Carrier to state CarrierContext.Carrier.TerminatedState with command TerminateCarrier
      tell event CarrierTerminated to entity CarrierContext.Carrier
    }
  } with {
    briefly "Processes carrier commands"
    described as {
      |Handles carrier lifecycle.
    }
  }
} with {
  briefly "Carrier aggregate"
  described as {
    |Manages freight carriers.
  }
}
