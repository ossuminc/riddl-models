// Carrier Management - Carrier Entity

entity Carrier is {

  command RegisterCarrier is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "New carrier identifier."
    }
    carrierInfo is CarrierInfo with {
      briefly "Info"
      described by "Carrier information."
    }
    carrierType is CarrierType with {
      briefly "Type"
      described by "Carrier type."
    }
    primaryContact is ContactInfo with {
      briefly "Contact"
      described by "Primary contact."
    }
  } with {
    briefly "Register carrier"
    described by "Registers a new carrier."
  }

  command VerifyCredentials is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    verifiedBy is String(1, 100) with {
      briefly "Verified by"
      described by "Verifier name."
    }
    notes is optional String(1, 1000) with {
      briefly "Notes"
      described by "Verification notes."
    }
  } with {
    briefly "Verify credentials"
    described by "Verifies carrier credentials."
  }

  command AddInsurance is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    policy is InsurancePolicy with {
      briefly "Policy"
      described by "Insurance policy."
    }
  } with {
    briefly "Add insurance"
    described by "Adds insurance policy."
  }

  command UpdateInsurance is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    policy is InsurancePolicy with {
      briefly "Policy"
      described by "Updated policy."
    }
  } with {
    briefly "Update insurance"
    described by "Updates insurance policy."
  }

  command DefineServiceArea is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    serviceArea is ServiceArea with {
      briefly "Area"
      described by "Service area."
    }
  } with {
    briefly "Define service area"
    described by "Sets carrier coverage."
  }

  command AddRate is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    rate is RateInfo with {
      briefly "Rate"
      described by "Rate details."
    }
  } with {
    briefly "Add rate"
    described by "Adds shipping rate."
  }

  command UpdateRate is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    rateId is UUID with {
      briefly "Rate ID"
      described by "Rate to update."
    }
    rate is RateInfo with {
      briefly "Rate"
      described by "Updated rate."
    }
  } with {
    briefly "Update rate"
    described by "Updates shipping rate."
  }

  command ActivateCarrier is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    activatedBy is String(1, 100) with {
      briefly "Activated by"
      described by "Activator name."
    }
  } with {
    briefly "Activate carrier"
    described by "Activates carrier for assignments."
  }

  command SuspendCarrier is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Suspension reason."
    }
  } with {
    briefly "Suspend carrier"
    described by "Suspends carrier from assignments."
  }

  command ReinstateCarrier is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    reinstatedBy is String(1, 100) with {
      briefly "Reinstated by"
      described by "Reinstater name."
    }
  } with {
    briefly "Reinstate carrier"
    described by "Reinstates suspended carrier."
  }

  command RecordPerformance is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    metrics is PerformanceMetrics with {
      briefly "Metrics"
      described by "Performance data."
    }
    periodEnd is Date with {
      briefly "Period"
      described by "Metrics period end."
    }
  } with {
    briefly "Record performance"
    described by "Records performance metrics."
  }

  command UpdateCapacity is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    capacity is CapacityInfo with {
      briefly "Capacity"
      described by "Capacity info."
    }
  } with {
    briefly "Update capacity"
    described by "Updates available capacity."
  }

  command TerminateCarrier is {
    carrierId is CarrierId with {
      briefly "Carrier ID"
      described by "Carrier identifier."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Termination reason."
    }
  } with {
    briefly "Terminate carrier"
    described by "Terminates carrier relationship."
  }

  // Events
  event CarrierRegistered is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    carrierInfo is CarrierInfo with { briefly "Info" described by "Carrier info." }
    carrierType is CarrierType with { briefly "Type" described by "Carrier type." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Carrier registered"
    described by "Emitted when carrier registered."
  }

  event CredentialsVerified is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    verifiedBy is String(1, 100) with { briefly "Verified by" described by "Verifier." }
    verifiedAt is TimeStamp with { briefly "Verified" described by "Verification time." }
  } with {
    briefly "Credentials verified"
    described by "Emitted when credentials verified."
  }

  event InsuranceAdded is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    policy is InsurancePolicy with { briefly "Policy" described by "Insurance policy." }
    addedAt is TimeStamp with { briefly "Added" described by "Add time." }
  } with {
    briefly "Insurance added"
    described by "Emitted when insurance added."
  }

  event InsuranceUpdated is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    policy is InsurancePolicy with { briefly "Policy" described by "Updated policy." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Insurance updated"
    described by "Emitted when insurance updated."
  }

  event ServiceAreaDefined is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    serviceArea is ServiceArea with { briefly "Area" described by "Service area." }
    definedAt is TimeStamp with { briefly "Defined" described by "Definition time." }
  } with {
    briefly "Service area defined"
    described by "Emitted when coverage set."
  }

  event RateAdded is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    rate is RateInfo with { briefly "Rate" described by "Rate info." }
    addedAt is TimeStamp with { briefly "Added" described by "Add time." }
  } with {
    briefly "Rate added"
    described by "Emitted when rate added."
  }

  event RateUpdated is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    rate is RateInfo with { briefly "Rate" described by "Updated rate." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Rate updated"
    described by "Emitted when rate updated."
  }

  event CarrierActivated is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    activatedBy is String(1, 100) with { briefly "Activated by" described by "Activator." }
    activatedAt is TimeStamp with { briefly "Activated" described by "Activation time." }
  } with {
    briefly "Carrier activated"
    described by "Emitted when carrier activated."
  }

  event CarrierSuspended is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Reason." }
    suspendedAt is TimeStamp with { briefly "Suspended" described by "Suspension time." }
  } with {
    briefly "Carrier suspended"
    described by "Emitted when carrier suspended."
  }

  event CarrierReinstated is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    reinstatedBy is String(1, 100) with { briefly "Reinstated by" described by "Reinstater." }
    reinstatedAt is TimeStamp with { briefly "Reinstated" described by "Reinstatement time." }
  } with {
    briefly "Carrier reinstated"
    described by "Emitted when carrier reinstated."
  }

  event PerformanceRecorded is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    metrics is PerformanceMetrics with { briefly "Metrics" described by "Performance." }
    periodEnd is Date with { briefly "Period" described by "Period end." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Performance recorded"
    described by "Emitted when metrics recorded."
  }

  event CapacityUpdated is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    capacity is CapacityInfo with { briefly "Capacity" described by "Capacity." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Capacity updated"
    described by "Emitted when capacity updated."
  }

  event CarrierTerminated is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Reason." }
    terminatedAt is TimeStamp with { briefly "Terminated" described by "Termination time." }
  } with {
    briefly "Carrier terminated"
    described by "Emitted when carrier terminated."
  }

  // States
  record ActiveStateData is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    carrierInfo is CarrierInfo with { briefly "Info" described by "Carrier info." }
    carrierType is CarrierType with { briefly "Type" described by "Carrier type." }
    status is CarrierStatus with { briefly "Status" described by "Carrier status." }
    primaryContact is ContactInfo with { briefly "Contact" described by "Primary contact." }
    insurancePolicies is many InsurancePolicy with { briefly "Insurance" described by "Insurance policies." }
    serviceAreas is many optional ServiceArea with { briefly "Areas" described by "Service areas." }
    rates is many optional RateInfo with { briefly "Rates" described by "Shipping rates." }
    currentMetrics is optional PerformanceMetrics with { briefly "Metrics" described by "Performance." }
    currentCapacity is many optional CapacityInfo with { briefly "Capacity" described by "Capacity." }
    credentialsVerified is Boolean with { briefly "Verified" described by "Credentials verified." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Active carrier state"
    described by "Active carrier data."
  }

  record TerminatedStateData is {
    carrierId is CarrierId with { briefly "Carrier" described by "Carrier ID." }
    legalName is String(1, 200) with { briefly "Name" described by "Legal name." }
    reason is String(1, 500) with { briefly "Reason" described by "Termination reason." }
    terminatedAt is TimeStamp with { briefly "Terminated" described by "Termination time." }
  } with {
    briefly "Terminated carrier state"
    described by "Terminated carrier data."
  }

  state ActiveState of Carrier.ActiveStateData with {
    briefly "Carrier active"
    described by "Carrier is in active lifecycle."
  }

  state TerminatedState of Carrier.TerminatedStateData with {
    briefly "Carrier terminated"
    described by "Carrier has been terminated."
  }

  handler CarrierHandler is {
    on command RegisterCarrier {
      morph entity CarrierContext.Carrier to state CarrierContext.Carrier.ActiveState with command RegisterCarrier
      tell event CarrierRegistered to entity CarrierContext.Carrier
    }
    on command VerifyCredentials {
      tell event CredentialsVerified to entity CarrierContext.Carrier
    }
    on command AddInsurance {
      tell event InsuranceAdded to entity CarrierContext.Carrier
    }
    on command UpdateInsurance {
      tell event InsuranceUpdated to entity CarrierContext.Carrier
    }
    on command DefineServiceArea {
      tell event ServiceAreaDefined to entity CarrierContext.Carrier
    }
    on command AddRate {
      tell event RateAdded to entity CarrierContext.Carrier
    }
    on command UpdateRate {
      tell event RateUpdated to entity CarrierContext.Carrier
    }
    on command ActivateCarrier {
      tell event CarrierActivated to entity CarrierContext.Carrier
    }
    on command SuspendCarrier {
      tell event CarrierSuspended to entity CarrierContext.Carrier
    }
    on command ReinstateCarrier {
      tell event CarrierReinstated to entity CarrierContext.Carrier
    }
    on command RecordPerformance {
      tell event PerformanceRecorded to entity CarrierContext.Carrier
    }
    on command UpdateCapacity {
      tell event CapacityUpdated to entity CarrierContext.Carrier
    }
    on command TerminateCarrier {
      morph entity CarrierContext.Carrier to state CarrierContext.Carrier.TerminatedState with command TerminateCarrier
      tell event CarrierTerminated to entity CarrierContext.Carrier
    }
  } with {
    briefly "Processes carrier commands"
    described by "Handles carrier lifecycle."
  }

} with {
  briefly "Carrier aggregate"
  described by "Manages freight carriers."
}
