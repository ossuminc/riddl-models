// Shipment Tracking - External Contexts
context CarrierIntegration is {
  command RequestPickup is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    pickupAddress: Address with {
      briefly "Address"
      described as {
        |Pickup address.
      }
    }
    pickupWindow: DeliveryWindow with {
      briefly "Window"
      described as {
        |Pickup window.
      }
    }
  } with {
    briefly "Request pickup"
    described as {
      |Schedules carrier pickup.
    }
  }
  event PickupScheduled is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    confirmationNumber: String(1,50) with {
      briefly "Confirmation"
      described as {
        |Pickup confirmation.
      }
    }
    scheduledTime: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Scheduled time.
      }
    }
  } with {
    briefly "Pickup scheduled"
    described as {
      |Emitted when pickup confirmed.
    }
  }
  command GetTrackingUpdate is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    carrierTrackingNumber: String(1,50) with {
      briefly "Carrier tracking"
      described as {
        |Carrier's tracking number.
      }
    }
  } with {
    briefly "Get tracking update"
    described as {
      |Polls carrier for status.
    }
  }
  event TrackingUpdateReceived is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    events: TrackingEvent+ with {
      briefly "Events"
      described as {
        |New tracking events.
      }
    }
  } with {
    briefly "Tracking update received"
    described as {
      |Emitted when carrier provides update.
    }
  }
} with {
  option external()
  briefly "External carrier integration"
  described as {
    |Carrier API integration.
  }
}
context NotificationService is {
  command SendShipmentNotification is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    recipientEmail: EmailAddress with {
      briefly "Email"
      described as {
        |Recipient email.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    trackingUrl: URL with {
      briefly "URL"
      described as {
        |Tracking URL.
      }
    }
  } with {
    briefly "Send notification"
    described as {
      |Sends shipment notification.
    }
  }
  event NotificationSent is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification sent"
    described as {
      |Emitted when notification delivered.
    }
  }
} with {
  option external()
  briefly "External notification service"
  described as {
    |Email and SMS notifications.
  }
}
context GeolocationService is {
  command GeocodeAddress is  {
    address: Address with {
      briefly "Address"
      described as {
        |Address to geocode.
      }
    }
  } with {
    briefly "Geocode address"
    described as {
      |Converts address to coordinates.
    }
  }
  event AddressGeocoded is  {
    address: Address with {
      briefly "Address"
      described as {
        |Input address.
      }
    }
    geocodedLocation: GeoLocation with {
      briefly "Location"
      described as {
        |GPS coordinates.
      }
    }
  } with {
    briefly "Address geocoded"
    described as {
      |Emitted when geocoding complete.
    }
  }
  command CalculateRoute is  {
    origin: GeoLocation with {
      briefly "Origin"
      described as {
        |Start point.
      }
    }
    destination: GeoLocation with {
      briefly "Destination"
      described as {
        |End point.
      }
    }
  } with {
    briefly "Calculate route"
    described as {
      |Calculates delivery route.
    }
  }
  event RouteCalculated is  {
    distanceKm: Decimal(10,2) with {
      briefly "Distance"
      described as {
        |Route distance.
      }
    }
    estimatedMinutes: Natural with {
      briefly "Time"
      described as {
        |Estimated time.
      }
    }
  } with {
    briefly "Route calculated"
    described as {
      |Emitted when route computed.
    }
  }
} with {
  option external()
  briefly "External geolocation service"
  described as {
    |Maps and routing services.
  }
}
