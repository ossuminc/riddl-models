// Shipment Tracking - External Contexts

context CarrierIntegration is {

  command RequestPickup is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    pickupAddress is Address with { briefly "Address" described by "Pickup address." }
    pickupWindow is DeliveryWindow with { briefly "Window" described by "Pickup window." }
  } with {
    briefly "Request pickup"
    described by "Schedules carrier pickup."
  }

  event PickupScheduled is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    confirmationNumber is String(1, 50) with { briefly "Confirmation" described by "Pickup confirmation." }
    scheduledTime is TimeStamp with { briefly "Scheduled" described by "Scheduled time." }
  } with {
    briefly "Pickup scheduled"
    described by "Emitted when pickup confirmed."
  }

  command GetTrackingUpdate is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    carrierTrackingNumber is String(1, 50) with { briefly "Carrier tracking" described by "Carrier's tracking number." }
  } with {
    briefly "Get tracking update"
    described by "Polls carrier for status."
  }

  event TrackingUpdateReceived is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    events is many TrackingEvent with { briefly "Events" described by "New tracking events." }
  } with {
    briefly "Tracking update received"
    described by "Emitted when carrier provides update."
  }

} with {
  option is external
  briefly "External carrier integration"
  described by "Carrier API integration."
}

context NotificationService is {

  command SendShipmentNotification is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    recipientEmail is EmailAddress with { briefly "Email" described by "Recipient email." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    trackingUrl is URL with { briefly "URL" described by "Tracking URL." }
  } with {
    briefly "Send notification"
    described by "Sends shipment notification."
  }

  event NotificationSent is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification sent"
    described by "Emitted when notification delivered."
  }

} with {
  option is external
  briefly "External notification service"
  described by "Email and SMS notifications."
}

context GeolocationService is {

  command GeocodeAddress is {
    address is Address with { briefly "Address" described by "Address to geocode." }
  } with {
    briefly "Geocode address"
    described by "Converts address to coordinates."
  }

  event AddressGeocoded is {
    address is Address with { briefly "Address" described by "Input address." }
    location is GeoLocation with { briefly "Location" described by "GPS coordinates." }
  } with {
    briefly "Address geocoded"
    described by "Emitted when geocoding complete."
  }

  command CalculateRoute is {
    origin is GeoLocation with { briefly "Origin" described by "Start point." }
    destination is GeoLocation with { briefly "Destination" described by "End point." }
  } with {
    briefly "Calculate route"
    described by "Calculates delivery route."
  }

  event RouteCalculated is {
    distanceKm is Decimal(10, 2) with { briefly "Distance" described by "Route distance." }
    estimatedMinutes is Natural with { briefly "Time" described by "Estimated time." }
  } with {
    briefly "Route calculated"
    described by "Emitted when route computed."
  }

} with {
  option is external
  briefly "External geolocation service"
  described by "Maps and routing services."
}
