// Shipment Tracking - Tracking Context
context TrackingContext is {
  include "types.riddl"
  include "Shipment.riddl"
  repository ShipmentRepository is {
    schema ShipmentData is relational
      of shipments as type Shipment
        index on field Shipment.trackingNumber
        index on field Shipment.status
        index on field Shipment.consignee.address.postalCode

    handler ShipmentPersistence is {
      on command Shipment.CreateShipment is {
        prompt "Store new shipment record"
      }
      on command Shipment.RecordPickup is {
        prompt "Update shipment with pickup"
      }
      on command Shipment.AddTrackingEvent is {
        prompt "Append tracking event"
      }
      on command Shipment.UpdateLocation is {
        prompt "Update current location"
      }
      on command Shipment.UpdateETA is {
        prompt "Update delivery window"
      }
      on command Shipment.RecordDelivery is {
        prompt "Store delivery confirmation"
      }
      on command Shipment.ReportException is {
        prompt "Store exception details"
      }
    } with {
      briefly "Persists shipment commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Shipment data persistence"
    described as {
      |Persistent storage for shipments.
    }
  }
  projector ShipmentAnalytics is {
    record DeliveryMetrics is  {
      totalShipments: Natural with {
        briefly "Total"
        described as {
          |Total shipments.
        }
      }
      inTransit: Natural with {
        briefly "In transit"
        described as {
          |Currently in transit.
        }
      }
      deliveredToday: Natural with {
        briefly "Delivered"
        described as {
          |Delivered today.
        }
      }
      onTimeRate: Decimal(5,2) with {
        briefly "On-time"
        described as {
          |On-time delivery rate.
        }
      }
      averageTransitDays: Decimal(5,2) with {
        briefly "Transit time"
        described as {
          |Average transit days.
        }
      }
      exceptionRate: Decimal(5,2) with {
        briefly "Exceptions"
        described as {
          |Exception rate.
        }
      }
    } with {
      briefly "Delivery metrics"
      described as {
        |Delivery performance metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Shipment.ShipmentCreated is {
        prompt "Increment shipment count"
      }
      on event Shipment.DeliveryRecorded is {
        prompt "Update delivery statistics"
      }
      on event Shipment.ExceptionReported is {
        prompt "Update exception rate"
      }
    } with {
      briefly "Maintains delivery analytics"
      described as {
        |Projects events into metrics.
      }
    }
  } with {
    briefly "Shipment analytics"
    described as {
      |Delivery performance tracking.
    }
  }
} with {
  briefly "Bounded context for shipment tracking"
  described as {
    |Freight visibility context.
  }
}
