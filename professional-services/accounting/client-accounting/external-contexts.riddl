// Client Accounting - External Contexts

// Bank Feed Service
context BankFeedService is {

  query GetTransactions is {
    accountNumber is String(1, 50) with { briefly "Account" described by "Bank account." }
    startDate is Date with { briefly "Start" described by "Start date." }
    endDate is Date with { briefly "End" described by "End date." }
  } with {
    briefly "Get transactions"
    described by "Retrieves bank transactions."
  }

  result BankTransactionsResult is {
    transactions is many BankTransaction with { briefly "Transactions" described by "Bank transactions." }
    balance is Decimal(14, 2) with { briefly "Balance" described by "Ending balance." }
  } with {
    briefly "Bank transactions result"
    described by "Bank transaction data."
  }

  type BankTransaction is {
    transactionDate is Date with { briefly "Date" described by "Transaction date." }
    description is String(1, 200) with { briefly "Description" described by "Transaction description." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Transaction amount." }
    transactionType is String(1, 20) with { briefly "Type" described by "Debit or credit." }
    reference is optional String(1, 100) with { briefly "Reference" described by "Check/reference number." }
  } with {
    briefly "Bank transaction"
    described by "Single bank transaction."
  }

} with {
  option is external
  briefly "External bank feed"
  described by "Bank transaction feed service."
}

// Document Storage Service
context DocumentStorageService is {

  command StoreDocument is {
    engagementId is EngagementId with { briefly "Engagement" described by "Engagement ID." }
    documentType is String(1, 100) with { briefly "Type" described by "Document type." }
    fileName is String(1, 255) with { briefly "File" described by "File name." }
  } with {
    briefly "Store document"
    described by "Stores workpaper or document."
  }

  event DocumentStored is {
    engagementId is EngagementId with { briefly "Engagement" described by "Engagement ID." }
    documentId is UUID with { briefly "Document" described by "Document ID." }
    storedAt is TimeStamp with { briefly "Stored" described by "Storage time." }
  } with {
    briefly "Document stored"
    described by "Emitted when document is stored."
  }

  query RetrieveDocument is {
    documentId is UUID with { briefly "Document" described by "Document ID." }
  } with {
    briefly "Retrieve document"
    described by "Retrieves stored document."
  }

  result DocumentResult is {
    documentId is UUID with { briefly "Document" described by "Document ID." }
    downloadUrl is String(1, 500) with { briefly "URL" described by "Download URL." }
    expiresAt is TimeStamp with { briefly "Expires" described by "URL expiration." }
  } with {
    briefly "Document result"
    described by "Document retrieval result."
  }

} with {
  option is external
  briefly "External document service"
  described by "Workpaper and document storage."
}

// Tax Service
context TaxService is {

  query GetTaxRates is {
    jurisdiction is String(1, 100) with { briefly "Jurisdiction" described by "Tax jurisdiction." }
    taxYear is Natural with { briefly "Year" described by "Tax year." }
  } with {
    briefly "Get tax rates"
    described by "Retrieves tax rates."
  }

  result TaxRatesResult is {
    rates is many TaxRate with { briefly "Rates" described by "Tax rates." }
  } with {
    briefly "Tax rates result"
    described by "Tax rate information."
  }

  type TaxRate is {
    rateType is String(1, 100) with { briefly "Type" described by "Rate type." }
    rate is Decimal(6, 4) with { briefly "Rate" described by "Tax rate." }
    effectiveDate is Date with { briefly "Effective" described by "Effective date." }
  } with {
    briefly "Tax rate"
    described by "Individual tax rate."
  }

  command CalculateTaxLiability is {
    engagementId is EngagementId with { briefly "Engagement" described by "Engagement ID." }
    taxYear is Natural with { briefly "Year" described by "Tax year." }
    taxableIncome is Decimal(14, 2) with { briefly "Income" described by "Taxable income." }
  } with {
    briefly "Calculate tax liability"
    described by "Calculates tax liability."
  }

  event TaxLiabilityCalculated is {
    engagementId is EngagementId with { briefly "Engagement" described by "Engagement ID." }
    taxYear is Natural with { briefly "Year" described by "Tax year." }
    liability is Decimal(12, 2) with { briefly "Liability" described by "Tax liability." }
    calculatedAt is TimeStamp with { briefly "Calculated" described by "Calculation time." }
  } with {
    briefly "Tax liability calculated"
    described by "Emitted when liability is calculated."
  }

} with {
  option is external
  briefly "External tax service"
  described by "Tax rate and calculation service."
}

// Payment Processing Service
context PaymentProcessingService is {

  command ProcessPayment is {
    engagementId is EngagementId with { briefly "Engagement" described by "Engagement ID." }
    invoiceNumber is String(1, 50) with { briefly "Invoice" described by "Invoice number." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Payment amount." }
    paymentMethod is String(1, 50) with { briefly "Method" described by "Payment method." }
  } with {
    briefly "Process payment"
    described by "Processes client payment."
  }

  event PaymentProcessed is {
    engagementId is EngagementId with { briefly "Engagement" described by "Engagement ID." }
    invoiceNumber is String(1, 50) with { briefly "Invoice" described by "Invoice number." }
    confirmationNumber is String(1, 50) with { briefly "Confirmation" described by "Confirmation number." }
    processedAt is TimeStamp with { briefly "Processed" described by "Processing time." }
  } with {
    briefly "Payment processed"
    described by "Emitted when payment completes."
  }

} with {
  option is external
  briefly "External payment service"
  described by "Client payment processing."
}

// Client Portal Service
context ClientPortalService is {

  command PublishDocument is {
    engagementId is EngagementId with { briefly "Engagement" described by "Engagement ID." }
    documentId is UUID with { briefly "Document" described by "Document ID." }
    documentType is String(1, 100) with { briefly "Type" described by "Document type." }
  } with {
    briefly "Publish document"
    described by "Publishes document to portal."
  }

  event DocumentPublished is {
    engagementId is EngagementId with { briefly "Engagement" described by "Engagement ID." }
    documentId is UUID with { briefly "Document" described by "Document ID." }
    publishedAt is TimeStamp with { briefly "Published" described by "Publish time." }
  } with {
    briefly "Document published"
    described by "Emitted when document is published."
  }

  event ClientAccessedDocument is {
    engagementId is EngagementId with { briefly "Engagement" described by "Engagement ID." }
    documentId is UUID with { briefly "Document" described by "Document ID." }
    accessedAt is TimeStamp with { briefly "Accessed" described by "Access time." }
  } with {
    briefly "Client accessed document"
    described by "Emitted when client views document."
  }

} with {
  option is external
  briefly "External client portal"
  described by "Client document portal."
}
