// Payroll Processing - Payroll Context
context PayrollContext is {
  include "types.riddl"
  include "PayrollRun.riddl"
  repository PayrollRepository is {
    schema PayrollData is relational
      of payrollRuns as type PayrollRun
        index on field PayrollRun.runId
        index on field PayrollRun.payPeriod.periodId
        index on field PayrollRun.status

    handler PayrollPersistence is {
      on command PayrollRun.InitiatePayroll is {
        prompt "Store new payroll run"
      }
      on command PayrollRun.CalculatePayroll is {
        prompt "Store calculated totals"
      }
      on command PayrollRun.AddTimeEntry is {
        prompt "Store time entry"
      }
      on command PayrollRun.ApprovePayroll is {
        prompt "Update status to approved"
      }
      on command PayrollRun.CompletePayroll is {
        prompt "Update status to completed"
      }
    } with {
      briefly "Persists payroll commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Payroll data persistence"
    described as {
      |Persistent storage for payroll.
    }
  }
  projector PayrollAnalytics is {
    record PayrollMetrics is  {
      year: Natural with {
        briefly "Year"
        described as {
          |Fiscal year.
        }
      }
      month: Natural with {
        briefly "Month"
        described as {
          |Month number.
        }
      }
      totalGrossPaid: Decimal(18,2) with {
        briefly "Gross"
        described as {
          |Total gross paid.
        }
      }
      totalTaxesPaid: Decimal(18,2) with {
        briefly "Taxes"
        described as {
          |Total taxes paid.
        }
      }
      totalNetPaid: Decimal(18,2) with {
        briefly "Net"
        described as {
          |Total net paid.
        }
      }
      payrollRunCount: Natural with {
        briefly "Runs"
        described as {
          |Payroll runs.
        }
      }
    } with {
      briefly "Payroll metrics"
      described as {
        |Monthly payroll metrics.
      }
    }
    handler AnalyticsHandler is {
      on event PayrollRun.PayrollCompleted is {
        prompt "Aggregate payroll totals by month"
      }
    } with {
      briefly "Maintains payroll analytics"
      described as {
        |Projects events into analytics.
      }
    }
  } with {
    briefly "Payroll analytics"
    described as {
      |Payroll reporting and analysis.
    }
  }
} with {
  briefly "Bounded context for payroll processing"
  described as {
    |Payroll and compensation context.
  }
}
