// Payroll Processing - External Contexts
context HRISSystem is {
  query GetEmployeePayInfo is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
  } with {
    briefly "Get employee pay info"
    described as {
      |Gets employee compensation data.
    }
  }
  result EmployeePayInfo is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    payType: PayType with {
      briefly "Pay type"
      described as {
        |Pay type.
      }
    }
    salary: Decimal(12,2)? with {
      briefly "Salary"
      described as {
        |Annual salary.
      }
    }
    hourlyRate: Decimal(8,4)? with {
      briefly "Rate"
      described as {
        |Hourly rate.
      }
    }
    filingStatus: TaxFilingStatus with {
      briefly "Filing"
      described as {
        |Filing status.
      }
    }
    federalAllowances: Natural with {
      briefly "Fed allow"
      described as {
        |Federal allowances.
      }
    }
    stateAllowances: Natural with {
      briefly "State allow"
      described as {
        |State allowances.
      }
    }
    deductions: DeductionLine+ with {
      briefly "Deductions"
      described as {
        |Recurring deductions.
      }
    }
    directDeposit: DirectDeposit? with {
      briefly "DD"
      described as {
        |Direct deposit.
      }
    }
  } with {
    briefly "Employee pay info"
    described as {
      |Employee compensation profile.
    }
  }
  query GetEmployeeList is  {
    activeOnly: Boolean with {
      briefly "Active"
      described as {
        |Active employees only.
      }
    }
  } with {
    briefly "Get employee list"
    described as {
      |Gets list of employees.
    }
  }
  result EmployeeList is  {
    employees: EmployeeId+ with {
      briefly "Employees"
      described as {
        |Employee IDs.
      }
    }
  } with {
    briefly "Employee list"
    described as {
      |List of employees.
    }
  }
} with {
  option external()
  briefly "External HRIS system"
  described as {
    |Human resources information system.
  }
}
context TimeTracking is {
  query GetTimeEntries is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Start date.
      }
    }
    endDate: Date with {
      briefly "End"
      described as {
        |End date.
      }
    }
  } with {
    briefly "Get time entries"
    described as {
      |Gets employee time entries.
    }
  }
  result TimeEntries is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    entries: EarningsLine+ with {
      briefly "Entries"
      described as {
        |Time entries.
      }
    }
    totalRegularHours: Decimal(6,2) with {
      briefly "Regular"
      described as {
        |Regular hours.
      }
    }
    totalOvertimeHours: Decimal(6,2) with {
      briefly "Overtime"
      described as {
        |Overtime hours.
      }
    }
  } with {
    briefly "Time entries"
    described as {
      |Employee time data.
    }
  }
} with {
  option external()
  briefly "External time tracking"
  described as {
    |Time and attendance system.
  }
}
context TaxService is {
  command CalculateFederalTax is  {
    grossPay: Decimal(12,2) with {
      briefly "Gross"
      described as {
        |Gross pay.
      }
    }
    filingStatus: TaxFilingStatus with {
      briefly "Filing"
      described as {
        |Filing status.
      }
    }
    allowances: Natural with {
      briefly "Allowances"
      described as {
        |Allowances.
      }
    }
    preTaxDeductions: Decimal(10,2) with {
      briefly "Pre-tax"
      described as {
        |Pre-tax deductions.
      }
    }
  } with {
    briefly "Calculate federal tax"
    described as {
      |Calculates federal withholding.
    }
  }
  result TaxCalculation is  {
    taxType: String(1,50) with {
      briefly "Type"
      described as {
        |Tax type.
      }
    }
    taxableWages: Decimal(12,2) with {
      briefly "Taxable"
      described as {
        |Taxable wages.
      }
    }
    taxAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Tax amount.
      }
    }
  } with {
    briefly "Tax calculation"
    described as {
      |Calculated tax amount.
    }
  }
  command CalculateStateTax is  {
    grossPay: Decimal(12,2) with {
      briefly "Gross"
      described as {
        |Gross pay.
      }
    }
    stateCode: String(2,2) with {
      briefly "State"
      described as {
        |State code.
      }
    }
    filingStatus: TaxFilingStatus with {
      briefly "Filing"
      described as {
        |Filing status.
      }
    }
  } with {
    briefly "Calculate state tax"
    described as {
      |Calculates state withholding.
    }
  }
} with {
  option external()
  briefly "External tax service"
  described as {
    |Tax calculation service.
  }
}
context BankingService is {
  command SubmitACHBatch is  {
    runId: PayrollRunId with {
      briefly "Run"
      described as {
        |Payroll run ID.
      }
    }
    deposits: DirectDeposit+ with {
      briefly "Deposits"
      described as {
        |Direct deposits.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Effective date.
      }
    }
  } with {
    briefly "Submit ACH batch"
    described as {
      |Submits direct deposit batch.
    }
  }
  event ACHBatchSubmitted is  {
    runId: PayrollRunId with {
      briefly "Run"
      described as {
        |Payroll run ID.
      }
    }
    batchId: String(1,50) with {
      briefly "Batch"
      described as {
        |ACH batch ID.
      }
    }
    totalAmount: Decimal(15,2) with {
      briefly "Total"
      described as {
        |Total amount.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submit time.
      }
    }
  } with {
    briefly "ACH batch submitted"
    described as {
      |Emitted when ACH submitted.
    }
  }
  event ACHBatchSettled is  {
    batchId: String(1,50) with {
      briefly "Batch"
      described as {
        |ACH batch ID.
      }
    }
    settledAt: TimeStamp with {
      briefly "Settled"
      described as {
        |Settlement time.
      }
    }
  } with {
    briefly "ACH batch settled"
    described as {
      |Emitted when ACH settles.
    }
  }
} with {
  option external()
  briefly "External banking service"
  described as {
    |ACH and banking integration.
  }
}
context GeneralLedger is {
  command PostPayrollJournalEntry is  {
    runId: PayrollRunId with {
      briefly "Run"
      described as {
        |Payroll run ID.
      }
    }
    payPeriod: PayPeriod with {
      briefly "Period"
      described as {
        |Pay period.
      }
    }
    totals: PayrollTotals with {
      briefly "Totals"
      described as {
        |Payroll totals.
      }
    }
  } with {
    briefly "Post payroll journal entry"
    described as {
      |Posts payroll to GL.
    }
  }
  event JournalEntryPosted is  {
    runId: PayrollRunId with {
      briefly "Run"
      described as {
        |Payroll run ID.
      }
    }
    journalEntryId: UUID with {
      briefly "Entry"
      described as {
        |Journal entry ID.
      }
    }
    postedAt: TimeStamp with {
      briefly "Posted"
      described as {
        |Post time.
      }
    }
  } with {
    briefly "Journal entry posted"
    described as {
      |Emitted when posted to GL.
    }
  }
} with {
  option external()
  briefly "External general ledger"
  described as {
    |Financial accounting system.
  }
}
