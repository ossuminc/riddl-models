// Payroll Processing - External Contexts

context HRISSystem is {

  query GetEmployeePayInfo is {
    employeeId is EmployeeId with { briefly "Employee" described by "Employee ID." }
  } with {
    briefly "Get employee pay info"
    described by "Gets employee compensation data."
  }

  result EmployeePayInfo is {
    employeeId is EmployeeId with { briefly "Employee" described by "Employee ID." }
    payType is PayType with { briefly "Pay type" described by "Pay type." }
    salary is optional Decimal(12, 2) with { briefly "Salary" described by "Annual salary." }
    hourlyRate is optional Decimal(8, 4) with { briefly "Rate" described by "Hourly rate." }
    filingStatus is TaxFilingStatus with { briefly "Filing" described by "Filing status." }
    federalAllowances is Natural with { briefly "Fed allow" described by "Federal allowances." }
    stateAllowances is Natural with { briefly "State allow" described by "State allowances." }
    deductions is many DeductionLine with { briefly "Deductions" described by "Recurring deductions." }
    directDeposit is optional DirectDeposit with { briefly "DD" described by "Direct deposit." }
  } with {
    briefly "Employee pay info"
    described by "Employee compensation profile."
  }

  query GetEmployeeList is {
    activeOnly is Boolean with { briefly "Active" described by "Active employees only." }
  } with {
    briefly "Get employee list"
    described by "Gets list of employees."
  }

  result EmployeeList is {
    employees is many EmployeeId with { briefly "Employees" described by "Employee IDs." }
  } with {
    briefly "Employee list"
    described by "List of employees."
  }

} with {
  option is external
  briefly "External HRIS system"
  described by "Human resources information system."
}

context TimeTracking is {

  query GetTimeEntries is {
    employeeId is EmployeeId with { briefly "Employee" described by "Employee ID." }
    startDate is Date with { briefly "Start" described by "Start date." }
    endDate is Date with { briefly "End" described by "End date." }
  } with {
    briefly "Get time entries"
    described by "Gets employee time entries."
  }

  result TimeEntries is {
    employeeId is EmployeeId with { briefly "Employee" described by "Employee ID." }
    entries is many EarningsLine with { briefly "Entries" described by "Time entries." }
    totalRegularHours is Decimal(6, 2) with { briefly "Regular" described by "Regular hours." }
    totalOvertimeHours is Decimal(6, 2) with { briefly "Overtime" described by "Overtime hours." }
  } with {
    briefly "Time entries"
    described by "Employee time data."
  }

} with {
  option is external
  briefly "External time tracking"
  described by "Time and attendance system."
}

context TaxService is {

  command CalculateFederalTax is {
    grossPay is Decimal(12, 2) with { briefly "Gross" described by "Gross pay." }
    filingStatus is TaxFilingStatus with { briefly "Filing" described by "Filing status." }
    allowances is Natural with { briefly "Allowances" described by "Allowances." }
    preTaxDeductions is Decimal(10, 2) with { briefly "Pre-tax" described by "Pre-tax deductions." }
  } with {
    briefly "Calculate federal tax"
    described by "Calculates federal withholding."
  }

  result TaxCalculation is {
    taxType is String(1, 50) with { briefly "Type" described by "Tax type." }
    taxableWages is Decimal(12, 2) with { briefly "Taxable" described by "Taxable wages." }
    taxAmount is Decimal(10, 2) with { briefly "Amount" described by "Tax amount." }
  } with {
    briefly "Tax calculation"
    described by "Calculated tax amount."
  }

  command CalculateStateTax is {
    grossPay is Decimal(12, 2) with { briefly "Gross" described by "Gross pay." }
    stateCode is String(2, 2) with { briefly "State" described by "State code." }
    filingStatus is TaxFilingStatus with { briefly "Filing" described by "Filing status." }
  } with {
    briefly "Calculate state tax"
    described by "Calculates state withholding."
  }

} with {
  option is external
  briefly "External tax service"
  described by "Tax calculation service."
}

context BankingService is {

  command SubmitACHBatch is {
    runId is PayrollRunId with { briefly "Run" described by "Payroll run ID." }
    deposits is many DirectDeposit with { briefly "Deposits" described by "Direct deposits." }
    effectiveDate is Date with { briefly "Effective" described by "Effective date." }
  } with {
    briefly "Submit ACH batch"
    described by "Submits direct deposit batch."
  }

  event ACHBatchSubmitted is {
    runId is PayrollRunId with { briefly "Run" described by "Payroll run ID." }
    batchId is String(1, 50) with { briefly "Batch" described by "ACH batch ID." }
    totalAmount is Decimal(15, 2) with { briefly "Total" described by "Total amount." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submit time." }
  } with {
    briefly "ACH batch submitted"
    described by "Emitted when ACH submitted."
  }

  event ACHBatchSettled is {
    batchId is String(1, 50) with { briefly "Batch" described by "ACH batch ID." }
    settledAt is TimeStamp with { briefly "Settled" described by "Settlement time." }
  } with {
    briefly "ACH batch settled"
    described by "Emitted when ACH settles."
  }

} with {
  option is external
  briefly "External banking service"
  described by "ACH and banking integration."
}

context GeneralLedger is {

  command PostPayrollJournalEntry is {
    runId is PayrollRunId with { briefly "Run" described by "Payroll run ID." }
    payPeriod is PayPeriod with { briefly "Period" described by "Pay period." }
    totals is PayrollTotals with { briefly "Totals" described by "Payroll totals." }
  } with {
    briefly "Post payroll journal entry"
    described by "Posts payroll to GL."
  }

  event JournalEntryPosted is {
    runId is PayrollRunId with { briefly "Run" described by "Payroll run ID." }
    journalEntryId is UUID with { briefly "Entry" described by "Journal entry ID." }
    postedAt is TimeStamp with { briefly "Posted" described by "Post time." }
  } with {
    briefly "Journal entry posted"
    described by "Emitted when posted to GL."
  }

} with {
  option is external
  briefly "External general ledger"
  described by "Financial accounting system."
}
