// Recruiting - JobRequisition Entity
entity JobRequisition is {
  // Commands
  command CreateRequisition is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |New requisition identifier.
      }
    }
    requisitionInfo: RequisitionInfo with {
      briefly "Requisition info"
      described as {
        |Core requisition details.
      }
    }
    jobDescription: JobDescription with {
      briefly "Job description"
      described as {
        |Full job description.
      }
    }
    compensation: CompensationRange with {
      briefly "Compensation"
      described as {
        |Salary range and benefits.
      }
    }
  } with {
    briefly "Create requisition"
    described as {
      |Creates a new job requisition.
    }
  }
  command ApproveRequisition is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    approvedBy: String(3,100) with {
      briefly "Approved by"
      described as {
        |Person approving the requisition.
      }
    }
  } with {
    briefly "Approve requisition"
    described as {
      |Approves requisition for candidate sourcing.
    }
  }
  command AddCandidate is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    candidate: CandidateProfile with {
      briefly "Candidate"
      described as {
        |Candidate profile information.
      }
    }
  } with {
    briefly "Add candidate"
    described as {
      |Adds a candidate to the requisition pipeline.
    }
  }
  command ScreenCandidate is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate ID"
      described as {
        |Candidate identifier.
      }
    }
    passed: Boolean with {
      briefly "Passed"
      described as {
        |Whether candidate passed screening.
      }
    }
    screeningNotes: String(3,2000)? with {
      briefly "Notes"
      described as {
        |Screening notes.
      }
    }
  } with {
    briefly "Screen candidate"
    described as {
      |Records initial candidate screening result.
    }
  }
  command ScheduleInterview is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate ID"
      described as {
        |Candidate identifier.
      }
    }
    interview: InterviewRecord with {
      briefly "Interview"
      described as {
        |Interview scheduling details.
      }
    }
  } with {
    briefly "Schedule interview"
    described as {
      |Schedules an interview for a candidate.
    }
  }
  command RecordInterviewFeedback is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate ID"
      described as {
        |Candidate identifier.
      }
    }
    interviewId: InterviewId with {
      briefly "Interview ID"
      described as {
        |Interview identifier.
      }
    }
    rating: InterviewRating with {
      briefly "Rating"
      described as {
        |Interviewer rating.
      }
    }
    feedback: String(3,5000) with {
      briefly "Feedback"
      described as {
        |Written interview feedback.
      }
    }
  } with {
    briefly "Record interview feedback"
    described as {
      |Records interviewer feedback and rating.
    }
  }
  command ExtendOffer is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate ID"
      described as {
        |Candidate identifier.
      }
    }
    offer: OfferDetails with {
      briefly "Offer"
      described as {
        |Employment offer details.
      }
    }
  } with {
    briefly "Extend offer"
    described as {
      |Extends an employment offer to a candidate.
    }
  }
  command AcceptOffer is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate ID"
      described as {
        |Candidate identifier.
      }
    }
    offerId: OfferId with {
      briefly "Offer ID"
      described as {
        |Offer identifier.
      }
    }
    acceptedAt: TimeStamp with {
      briefly "Accepted"
      described as {
        |When the offer was accepted.
      }
    }
  } with {
    briefly "Accept offer"
    described as {
      |Records candidate acceptance of an offer.
    }
  }
  command DeclineOffer is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate ID"
      described as {
        |Candidate identifier.
      }
    }
    offerId: OfferId with {
      briefly "Offer ID"
      described as {
        |Offer identifier.
      }
    }
    declineReason: String(3,1000)? with {
      briefly "Reason"
      described as {
        |Reason for declining.
      }
    }
  } with {
    briefly "Decline offer"
    described as {
      |Records candidate declining an offer.
    }
  }
  command RejectCandidate is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate ID"
      described as {
        |Candidate identifier.
      }
    }
    reason: String(3,1000) with {
      briefly "Reason"
      described as {
        |Rejection reason.
      }
    }
  } with {
    briefly "Reject candidate"
    described as {
      |Rejects a candidate from the pipeline.
    }
  }
  command CancelRequisition is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
  } with {
    briefly "Cancel requisition"
    described as {
      |Cancels an open requisition.
    }
  }
  command PutRequisitionOnHold is  {
    requisitionId: RequisitionId with {
      briefly "Requisition ID"
      described as {
        |Requisition identifier.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Reason for putting on hold.
      }
    }
  } with {
    briefly "Put requisition on hold"
    described as {
      |Places a requisition on hold.
    }
  }
  // Events
  event RequisitionCreated is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    requisitionInfo: RequisitionInfo with {
      briefly "Info"
      described as {
        |Requisition info.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Requisition created"
    described as {
      |Emitted when a new requisition is created.
    }
  }
  event RequisitionApproved is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    approvedBy: String(3,100) with {
      briefly "Approver"
      described as {
        |Person who approved.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Requisition approved"
    described as {
      |Emitted when a requisition is approved.
    }
  }
  event CandidateAdded is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    sourceChannel: SourceChannel with {
      briefly "Source"
      described as {
        |Sourcing channel.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |When candidate was added.
      }
    }
  } with {
    briefly "Candidate added"
    described as {
      |Emitted when a candidate is added to the pipeline.
    }
  }
  event CandidateScreened is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    passed: Boolean with {
      briefly "Passed"
      described as {
        |Screening result.
      }
    }
    screenedAt: TimeStamp with {
      briefly "Screened"
      described as {
        |Screening time.
      }
    }
  } with {
    briefly "Candidate screened"
    described as {
      |Emitted when a candidate is screened.
    }
  }
  event InterviewScheduled is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    interviewId: InterviewId with {
      briefly "Interview"
      described as {
        |Interview ID.
      }
    }
    scheduledAt: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Interview date and time.
      }
    }
  } with {
    briefly "Interview scheduled"
    described as {
      |Emitted when an interview is scheduled.
    }
  }
  event InterviewFeedbackRecorded is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    interviewId: InterviewId with {
      briefly "Interview"
      described as {
        |Interview ID.
      }
    }
    rating: InterviewRating with {
      briefly "Rating"
      described as {
        |Interview rating.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |When feedback was recorded.
      }
    }
  } with {
    briefly "Interview feedback recorded"
    described as {
      |Emitted when interview feedback is submitted.
    }
  }
  event OfferExtended is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    offerId: OfferId with {
      briefly "Offer"
      described as {
        |Offer ID.
      }
    }
    extendedAt: TimeStamp with {
      briefly "Extended"
      described as {
        |When offer was extended.
      }
    }
  } with {
    briefly "Offer extended"
    described as {
      |Emitted when an offer is extended to a candidate.
    }
  }
  event OfferAccepted is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    offerId: OfferId with {
      briefly "Offer"
      described as {
        |Offer ID.
      }
    }
    acceptedAt: TimeStamp with {
      briefly "Accepted"
      described as {
        |Acceptance time.
      }
    }
  } with {
    briefly "Offer accepted"
    described as {
      |Emitted when a candidate accepts an offer.
    }
  }
  event OfferDeclined is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    offerId: OfferId with {
      briefly "Offer"
      described as {
        |Offer ID.
      }
    }
    declinedAt: TimeStamp with {
      briefly "Declined"
      described as {
        |When offer was declined.
      }
    }
  } with {
    briefly "Offer declined"
    described as {
      |Emitted when a candidate declines an offer.
    }
  }
  event CandidateRejected is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Candidate ID.
      }
    }
    reason: String(3,1000) with {
      briefly "Reason"
      described as {
        |Rejection reason.
      }
    }
    rejectedAt: TimeStamp with {
      briefly "Rejected"
      described as {
        |Rejection time.
      }
    }
  } with {
    briefly "Candidate rejected"
    described as {
      |Emitted when a candidate is rejected.
    }
  }
  event RequisitionCancelled is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
    cancelledAt: TimeStamp with {
      briefly "Cancelled"
      described as {
        |Cancellation time.
      }
    }
  } with {
    briefly "Requisition cancelled"
    described as {
      |Emitted when a requisition is cancelled.
    }
  }
  event RequisitionPutOnHold is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Hold reason.
      }
    }
    heldAt: TimeStamp with {
      briefly "Held"
      described as {
        |When put on hold.
      }
    }
  } with {
    briefly "Requisition put on hold"
    described as {
      |Emitted when a requisition is placed on hold.
    }
  }
  event RequisitionFilled is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    candidateId: CandidateId with {
      briefly "Candidate"
      described as {
        |Hired candidate ID.
      }
    }
    filledAt: TimeStamp with {
      briefly "Filled"
      described as {
        |When requisition was filled.
      }
    }
  } with {
    briefly "Requisition filled"
    described as {
      |Emitted when a requisition is filled by a hire.
    }
  }
  // Candidate tracking within the requisition
  record CandidateEntry is  {
    candidate: CandidateProfile with {
      briefly "Profile"
      described as {
        |Candidate profile.
      }
    }
    candidateStatus: CandidateStatus with {
      briefly "Status"
      described as {
        |Pipeline status.
      }
    }
    interviews: InterviewRecord* with {
      briefly "Interviews"
      described as {
        |Interview records.
      }
    }
    updatedOffer: OfferDetails? with {
      briefly "Offer"
      described as {
        |Offer if extended.
      }
    }
    appliedAt: TimeStamp with {
      briefly "Applied"
      described as {
        |Application time.
      }
    }
    screeningNotes: String(3,2000)? with {
      briefly "Screening notes"
      described as {
        |Initial screening notes.
      }
    }
  } with {
    briefly "Candidate entry"
    described as {
      |Candidate record within a requisition pipeline.
    }
  }
  // States
  record ActiveStateData is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    requisitionInfo: RequisitionInfo with {
      briefly "Info"
      described as {
        |Requisition details.
      }
    }
    jobDescription: JobDescription with {
      briefly "Description"
      described as {
        |Job description.
      }
    }
    compensation: CompensationRange with {
      briefly "Compensation"
      described as {
        |Pay range.
      }
    }
    status: RequisitionStatus with {
      briefly "Status"
      described as {
        |Requisition status.
      }
    }
    recruiterId: RecruiterId? with {
      briefly "Recruiter"
      described as {
        |Assigned recruiter.
      }
    }
    candidates: CandidateEntry* with {
      briefly "Candidates"
      described as {
        |Candidate pipeline.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Active requisition state"
    described as {
      |State for an active job requisition.
    }
  }
  record FilledStateData is  {
    requisitionId: RequisitionId with {
      briefly "Requisition"
      described as {
        |Requisition ID.
      }
    }
    hiredCandidateId: CandidateId with {
      briefly "Hired candidate"
      described as {
        |Candidate who was hired.
      }
    }
    filledAt: TimeStamp with {
      briefly "Filled"
      described as {
        |When position was filled.
      }
    }
  } with {
    briefly "Filled requisition state"
    described as {
      |State for a filled requisition.
    }
  }
  state ActiveState of type JobRequisition.ActiveStateData
  state FilledState of type JobRequisition.FilledStateData
  handler JobRequisitionHandler is {
    on command CreateRequisition is {
      morph entity RecruitingContext.JobRequisition to state RecruitingContext.JobRequisition.ActiveState with command CreateRequisition
      tell event RequisitionCreated to entity RecruitingContext.JobRequisition
    }
    on command ApproveRequisition is {
      tell event RequisitionApproved to entity RecruitingContext.JobRequisition
    }
    on command AddCandidate is {
      tell event CandidateAdded to entity RecruitingContext.JobRequisition
    }
    on command ScreenCandidate is {
      tell event CandidateScreened to entity RecruitingContext.JobRequisition
    }
    on command ScheduleInterview is {
      tell event InterviewScheduled to entity RecruitingContext.JobRequisition
    }
    on command RecordInterviewFeedback is {
      tell event InterviewFeedbackRecorded to entity RecruitingContext.JobRequisition
    }
    on command ExtendOffer is {
      tell event OfferExtended to entity RecruitingContext.JobRequisition
    }
    on command AcceptOffer is {
      morph entity RecruitingContext.JobRequisition to state RecruitingContext.JobRequisition.FilledState with command AcceptOffer
      tell event OfferAccepted to entity RecruitingContext.JobRequisition
      tell event RequisitionFilled to entity RecruitingContext.JobRequisition
    }
    on command DeclineOffer is {
      tell event OfferDeclined to entity RecruitingContext.JobRequisition
    }
    on command RejectCandidate is {
      tell event CandidateRejected to entity RecruitingContext.JobRequisition
    }
    on command CancelRequisition is {
      tell event RequisitionCancelled to entity RecruitingContext.JobRequisition
    }
    on command PutRequisitionOnHold is {
      tell event RequisitionPutOnHold to entity RecruitingContext.JobRequisition
    }
  } with {
    briefly "Processes job requisition commands"
    described as {
      |Handles job requisition lifecycle.
    }
  }
} with {
  briefly "JobRequisition aggregate"
  described as {
    |Manages job requisitions and candidate pipelines.
  }
}
