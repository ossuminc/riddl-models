// Recruiting - JobRequisition Entity

entity JobRequisition is {

  // Commands
  command CreateRequisition is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "New requisition identifier."
    }
    requisitionInfo is RequisitionInfo with {
      briefly "Requisition info"
      described by "Core requisition details."
    }
    jobDescription is JobDescription with {
      briefly "Job description"
      described by "Full job description."
    }
    compensation is CompensationRange with {
      briefly "Compensation"
      described by "Salary range and benefits."
    }
  } with {
    briefly "Create requisition"
    described by "Creates a new job requisition."
  }

  command ApproveRequisition is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    approvedBy is String(3, 100) with {
      briefly "Approved by"
      described by "Person approving the requisition."
    }
  } with {
    briefly "Approve requisition"
    described by "Approves requisition for candidate sourcing."
  }

  command AddCandidate is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    candidate is CandidateProfile with {
      briefly "Candidate"
      described by "Candidate profile information."
    }
  } with {
    briefly "Add candidate"
    described by "Adds a candidate to the requisition pipeline."
  }

  command ScreenCandidate is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    candidateId is CandidateId with {
      briefly "Candidate ID"
      described by "Candidate identifier."
    }
    passed is Boolean with {
      briefly "Passed"
      described by "Whether candidate passed screening."
    }
    screeningNotes is optional String(3, 2000) with {
      briefly "Notes"
      described by "Screening notes."
    }
  } with {
    briefly "Screen candidate"
    described by "Records initial candidate screening result."
  }

  command ScheduleInterview is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    candidateId is CandidateId with {
      briefly "Candidate ID"
      described by "Candidate identifier."
    }
    interview is InterviewRecord with {
      briefly "Interview"
      described by "Interview scheduling details."
    }
  } with {
    briefly "Schedule interview"
    described by "Schedules an interview for a candidate."
  }

  command RecordInterviewFeedback is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    candidateId is CandidateId with {
      briefly "Candidate ID"
      described by "Candidate identifier."
    }
    interviewId is InterviewId with {
      briefly "Interview ID"
      described by "Interview identifier."
    }
    rating is InterviewRating with {
      briefly "Rating"
      described by "Interviewer rating."
    }
    feedback is String(3, 5000) with {
      briefly "Feedback"
      described by "Written interview feedback."
    }
  } with {
    briefly "Record interview feedback"
    described by "Records interviewer feedback and rating."
  }

  command ExtendOffer is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    candidateId is CandidateId with {
      briefly "Candidate ID"
      described by "Candidate identifier."
    }
    offer is OfferDetails with {
      briefly "Offer"
      described by "Employment offer details."
    }
  } with {
    briefly "Extend offer"
    described by "Extends an employment offer to a candidate."
  }

  command AcceptOffer is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    candidateId is CandidateId with {
      briefly "Candidate ID"
      described by "Candidate identifier."
    }
    offerId is OfferId with {
      briefly "Offer ID"
      described by "Offer identifier."
    }
    acceptedAt is TimeStamp with {
      briefly "Accepted"
      described by "When the offer was accepted."
    }
  } with {
    briefly "Accept offer"
    described by "Records candidate acceptance of an offer."
  }

  command DeclineOffer is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    candidateId is CandidateId with {
      briefly "Candidate ID"
      described by "Candidate identifier."
    }
    offerId is OfferId with {
      briefly "Offer ID"
      described by "Offer identifier."
    }
    declineReason is optional String(3, 1000) with {
      briefly "Reason"
      described by "Reason for declining."
    }
  } with {
    briefly "Decline offer"
    described by "Records candidate declining an offer."
  }

  command RejectCandidate is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    candidateId is CandidateId with {
      briefly "Candidate ID"
      described by "Candidate identifier."
    }
    reason is String(3, 1000) with {
      briefly "Reason"
      described by "Rejection reason."
    }
  } with {
    briefly "Reject candidate"
    described by "Rejects a candidate from the pipeline."
  }

  command CancelRequisition is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    reason is String(3, 500) with {
      briefly "Reason"
      described by "Cancellation reason."
    }
  } with {
    briefly "Cancel requisition"
    described by "Cancels an open requisition."
  }

  command PutRequisitionOnHold is {
    requisitionId is RequisitionId with {
      briefly "Requisition ID"
      described by "Requisition identifier."
    }
    reason is String(3, 500) with {
      briefly "Reason"
      described by "Reason for putting on hold."
    }
  } with {
    briefly "Put requisition on hold"
    described by "Places a requisition on hold."
  }

  // Events
  event RequisitionCreated is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    requisitionInfo is RequisitionInfo with { briefly "Info" described by "Requisition info." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Requisition created"
    described by "Emitted when a new requisition is created."
  }

  event RequisitionApproved is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    approvedBy is String(3, 100) with { briefly "Approver" described by "Person who approved." }
    approvedAt is TimeStamp with { briefly "Approved" described by "Approval time." }
  } with {
    briefly "Requisition approved"
    described by "Emitted when a requisition is approved."
  }

  event CandidateAdded is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    sourceChannel is SourceChannel with { briefly "Source" described by "Sourcing channel." }
    addedAt is TimeStamp with { briefly "Added" described by "When candidate was added." }
  } with {
    briefly "Candidate added"
    described by "Emitted when a candidate is added to the pipeline."
  }

  event CandidateScreened is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    passed is Boolean with { briefly "Passed" described by "Screening result." }
    screenedAt is TimeStamp with { briefly "Screened" described by "Screening time." }
  } with {
    briefly "Candidate screened"
    described by "Emitted when a candidate is screened."
  }

  event InterviewScheduled is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    interviewId is InterviewId with { briefly "Interview" described by "Interview ID." }
    scheduledAt is TimeStamp with { briefly "Scheduled" described by "Interview date and time." }
  } with {
    briefly "Interview scheduled"
    described by "Emitted when an interview is scheduled."
  }

  event InterviewFeedbackRecorded is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    interviewId is InterviewId with { briefly "Interview" described by "Interview ID." }
    rating is InterviewRating with { briefly "Rating" described by "Interview rating." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "When feedback was recorded." }
  } with {
    briefly "Interview feedback recorded"
    described by "Emitted when interview feedback is submitted."
  }

  event OfferExtended is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    offerId is OfferId with { briefly "Offer" described by "Offer ID." }
    extendedAt is TimeStamp with { briefly "Extended" described by "When offer was extended." }
  } with {
    briefly "Offer extended"
    described by "Emitted when an offer is extended to a candidate."
  }

  event OfferAccepted is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    offerId is OfferId with { briefly "Offer" described by "Offer ID." }
    acceptedAt is TimeStamp with { briefly "Accepted" described by "Acceptance time." }
  } with {
    briefly "Offer accepted"
    described by "Emitted when a candidate accepts an offer."
  }

  event OfferDeclined is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    offerId is OfferId with { briefly "Offer" described by "Offer ID." }
    declinedAt is TimeStamp with { briefly "Declined" described by "When offer was declined." }
  } with {
    briefly "Offer declined"
    described by "Emitted when a candidate declines an offer."
  }

  event CandidateRejected is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Candidate ID." }
    reason is String(3, 1000) with { briefly "Reason" described by "Rejection reason." }
    rejectedAt is TimeStamp with { briefly "Rejected" described by "Rejection time." }
  } with {
    briefly "Candidate rejected"
    described by "Emitted when a candidate is rejected."
  }

  event RequisitionCancelled is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    reason is String(3, 500) with { briefly "Reason" described by "Cancellation reason." }
    cancelledAt is TimeStamp with { briefly "Cancelled" described by "Cancellation time." }
  } with {
    briefly "Requisition cancelled"
    described by "Emitted when a requisition is cancelled."
  }

  event RequisitionPutOnHold is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    reason is String(3, 500) with { briefly "Reason" described by "Hold reason." }
    heldAt is TimeStamp with { briefly "Held" described by "When put on hold." }
  } with {
    briefly "Requisition put on hold"
    described by "Emitted when a requisition is placed on hold."
  }

  event RequisitionFilled is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    candidateId is CandidateId with { briefly "Candidate" described by "Hired candidate ID." }
    filledAt is TimeStamp with { briefly "Filled" described by "When requisition was filled." }
  } with {
    briefly "Requisition filled"
    described by "Emitted when a requisition is filled by a hire."
  }

  // Candidate tracking within the requisition
  record CandidateEntry is {
    candidate is CandidateProfile with { briefly "Profile" described by "Candidate profile." }
    candidateStatus is CandidateStatus with { briefly "Status" described by "Pipeline status." }
    interviews is many optional InterviewRecord with { briefly "Interviews" described by "Interview records." }
    updatedOffer is optional OfferDetails with { briefly "Offer" described by "Offer if extended." }
    appliedAt is TimeStamp with { briefly "Applied" described by "Application time." }
    screeningNotes is optional String(3, 2000) with { briefly "Screening notes" described by "Initial screening notes." }
  } with {
    briefly "Candidate entry"
    described by "Candidate record within a requisition pipeline."
  }

  // States
  record ActiveStateData is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    requisitionInfo is RequisitionInfo with { briefly "Info" described by "Requisition details." }
    jobDescription is JobDescription with { briefly "Description" described by "Job description." }
    compensation is CompensationRange with { briefly "Compensation" described by "Pay range." }
    status is RequisitionStatus with { briefly "Status" described by "Requisition status." }
    recruiterId is optional RecruiterId with { briefly "Recruiter" described by "Assigned recruiter." }
    candidates is many optional CandidateEntry with { briefly "Candidates" described by "Candidate pipeline." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Active requisition state"
    described by "State for an active job requisition."
  }

  record FilledStateData is {
    requisitionId is RequisitionId with { briefly "Requisition" described by "Requisition ID." }
    hiredCandidateId is CandidateId with { briefly "Hired candidate" described by "Candidate who was hired." }
    filledAt is TimeStamp with { briefly "Filled" described by "When position was filled." }
  } with {
    briefly "Filled requisition state"
    described by "State for a filled requisition."
  }

  state ActiveState of JobRequisition.ActiveStateData with {
    briefly "Requisition active"
    described by "Job requisition is open and being worked."
  }

  state FilledState of JobRequisition.FilledStateData with {
    briefly "Requisition filled"
    described by "Job requisition has been filled."
  }

  handler JobRequisitionHandler is {
    on command CreateRequisition {
      morph entity RecruitingContext.JobRequisition to state RecruitingContext.JobRequisition.ActiveState with command CreateRequisition
      tell event RequisitionCreated to entity RecruitingContext.JobRequisition
    }
    on command ApproveRequisition {
      tell event RequisitionApproved to entity RecruitingContext.JobRequisition
    }
    on command AddCandidate {
      tell event CandidateAdded to entity RecruitingContext.JobRequisition
    }
    on command ScreenCandidate {
      tell event CandidateScreened to entity RecruitingContext.JobRequisition
    }
    on command ScheduleInterview {
      tell event InterviewScheduled to entity RecruitingContext.JobRequisition
    }
    on command RecordInterviewFeedback {
      tell event InterviewFeedbackRecorded to entity RecruitingContext.JobRequisition
    }
    on command ExtendOffer {
      tell event OfferExtended to entity RecruitingContext.JobRequisition
    }
    on command AcceptOffer {
      morph entity RecruitingContext.JobRequisition to state RecruitingContext.JobRequisition.FilledState with command AcceptOffer
      tell event OfferAccepted to entity RecruitingContext.JobRequisition
      tell event RequisitionFilled to entity RecruitingContext.JobRequisition
    }
    on command DeclineOffer {
      tell event OfferDeclined to entity RecruitingContext.JobRequisition
    }
    on command RejectCandidate {
      tell event CandidateRejected to entity RecruitingContext.JobRequisition
    }
    on command CancelRequisition {
      tell event RequisitionCancelled to entity RecruitingContext.JobRequisition
    }
    on command PutRequisitionOnHold {
      tell event RequisitionPutOnHold to entity RecruitingContext.JobRequisition
    }
  } with {
    briefly "Processes job requisition commands"
    described by "Handles job requisition lifecycle."
  }

} with {
  briefly "JobRequisition aggregate"
  described by "Manages job requisitions and candidate pipelines."
}
