// Recruiting - Recruiting Context

context RecruitingContext is {

  include "types.riddl"
  include "JobRequisition.riddl"

  repository RecruitingRepository is {
    schema RecruitingData is relational
      of jobRequisitions as JobRequisition
      index on field JobRequisition.requisitionId
      index on field JobRequisition.requisitionInfo.hiringManagerId
      index on field JobRequisition.status

    handler RecruitingPersistence is {
      on command JobRequisition.CreateRequisition {
        prompt "Store new job requisition"
      }
      on command JobRequisition.ApproveRequisition {
        prompt "Update requisition to approved"
      }
      on command JobRequisition.AddCandidate {
        prompt "Add candidate to requisition pipeline"
      }
      on command JobRequisition.ScheduleInterview {
        prompt "Store interview schedule"
      }
      on command JobRequisition.ExtendOffer {
        prompt "Store offer details"
      }
      on command JobRequisition.AcceptOffer {
        prompt "Update candidate and requisition to hired"
      }
      on command JobRequisition.AcceptOffer {
        prompt "Mark requisition as filled"
      }
    } with {
      briefly "Persists recruiting commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Recruiting data persistence"
    described by "Persistent storage for recruiting data."
  }

  projector RecruitingMetrics is {
    updates repository RecruitingRepository

    record PipelineMetrics is {
      openRequisitions is Natural with { briefly "Open" described by "Open requisitions." }
      totalCandidates is Natural with { briefly "Candidates" described by "Total candidates in pipeline." }
      interviewsScheduled is Natural with { briefly "Interviews" described by "Interviews scheduled." }
      offersExtended is Natural with { briefly "Offers" described by "Offers extended." }
      offerAcceptanceRate is Decimal(5, 2) with { briefly "Accept rate" described by "Offer acceptance percentage." }
      averageTimeToFill is Decimal(8, 2) with { briefly "Time to fill" described by "Average days to fill a requisition." }
    } with {
      briefly "Pipeline metrics"
      described by "Recruiting pipeline analytics."
    }

    handler MetricsHandler is {
      on event JobRequisition.RequisitionCreated {
        prompt "Increment open requisitions"
      }
      on event JobRequisition.CandidateAdded {
        prompt "Increment total candidates"
      }
      on event JobRequisition.InterviewScheduled {
        prompt "Increment interviews scheduled"
      }
      on event JobRequisition.OfferExtended {
        prompt "Increment offers extended"
      }
      on event JobRequisition.OfferAccepted {
        prompt "Update acceptance rate and decrement open requisitions"
      }
      on event JobRequisition.RequisitionFilled {
        prompt "Calculate time to fill"
      }
    } with {
      briefly "Maintains recruiting metrics"
      described by "Projects events into recruiting analytics."
    }
  } with {
    briefly "Recruiting metrics"
    described by "Talent acquisition analytics and reporting."
  }

} with {
  briefly "Bounded context for recruiting"
  described by "Talent acquisition and applicant tracking context."
}
