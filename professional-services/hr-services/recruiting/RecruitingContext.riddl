// Recruiting - Recruiting Context
context RecruitingContext is {
  include "types.riddl"
  include "JobRequisition.riddl"
  repository RecruitingRepository is {
    schema RecruitingData is relational
      of jobRequisitions as type JobRequisition
        index on field JobRequisition.requisitionId
        index on field JobRequisition.requisitionInfo.hiringManagerId
        index on field JobRequisition.status

    handler RecruitingPersistence is {
      on command JobRequisition.CreateRequisition is {
        prompt "Store new job requisition"
      }
      on command JobRequisition.ApproveRequisition is {
        prompt "Update requisition to approved"
      }
      on command JobRequisition.AddCandidate is {
        prompt "Add candidate to requisition pipeline"
      }
      on command JobRequisition.ScheduleInterview is {
        prompt "Store interview schedule"
      }
      on command JobRequisition.ExtendOffer is {
        prompt "Store offer details"
      }
      on command JobRequisition.AcceptOffer is {
        prompt "Update candidate and requisition to hired and mark as filled"
      }
    } with {
      briefly "Persists recruiting commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Recruiting data persistence"
    described as {
      |Persistent storage for recruiting data.
    }
  }
  projector RecruitingMetrics is {
    record PipelineMetrics is  {
      openRequisitions: Natural with {
        briefly "Open"
        described as {
          |Open requisitions.
        }
      }
      totalCandidates: Natural with {
        briefly "Candidates"
        described as {
          |Total candidates in pipeline.
        }
      }
      interviewsScheduled: Natural with {
        briefly "Interviews"
        described as {
          |Interviews scheduled.
        }
      }
      offersExtended: Natural with {
        briefly "Offers"
        described as {
          |Offers extended.
        }
      }
      offerAcceptanceRate: Decimal(5,2) with {
        briefly "Accept rate"
        described as {
          |Offer acceptance percentage.
        }
      }
      averageTimeToFill: Decimal(8,2) with {
        briefly "Time to fill"
        described as {
          |Average days to fill a requisition.
        }
      }
    } with {
      briefly "Pipeline metrics"
      described as {
        |Recruiting pipeline analytics.
      }
    }
    handler MetricsHandler is {
      on event JobRequisition.RequisitionCreated is {
        prompt "Increment open requisitions"
      }
      on event JobRequisition.CandidateAdded is {
        prompt "Increment total candidates"
      }
      on event JobRequisition.InterviewScheduled is {
        prompt "Increment interviews scheduled"
      }
      on event JobRequisition.OfferExtended is {
        prompt "Increment offers extended"
      }
      on event JobRequisition.OfferAccepted is {
        prompt "Update acceptance rate and decrement open requisitions"
      }
      on event JobRequisition.RequisitionFilled is {
        prompt "Calculate time to fill"
      }
    } with {
      briefly "Maintains recruiting metrics"
      described as {
        |Projects events into recruiting analytics.
      }
    }
  } with {
    briefly "Recruiting metrics"
    described as {
      |Talent acquisition analytics and reporting.
    }
  }
} with {
  briefly "Bounded context for recruiting"
  described as {
    |Talent acquisition and applicant tracking context.
  }
}
