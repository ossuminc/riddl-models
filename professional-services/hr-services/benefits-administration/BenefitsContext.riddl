// Benefits Administration - Benefits Context

context BenefitsContext is {

  include "types.riddl"
  include "BenefitsEnrollment.riddl"

  repository BenefitsRepository is {
    schema BenefitsData is relational
      of enrollments as BenefitsEnrollment
      index on field BenefitsEnrollment.enrollmentId
      index on field BenefitsEnrollment.employeeId
      index on field BenefitsEnrollment.status

    handler BenefitsPersistence is {
      on event BenefitsEnrollment.EnrollmentCreated {
        prompt "Store new benefits enrollment"
      }
      on event BenefitsEnrollment.PlanSelected {
        prompt "Store plan election"
      }
      on event BenefitsEnrollment.DependentAdded {
        prompt "Store added dependent"
      }
      on event BenefitsEnrollment.EnrollmentSubmitted {
        prompt "Update enrollment to submitted"
      }
      on event BenefitsEnrollment.EnrollmentApproved {
        prompt "Update enrollment to approved"
      }
      on event BenefitsEnrollment.EnrollmentTerminated {
        prompt "Update enrollment to terminated"
      }
    } with {
      briefly "Persists benefits events"
      described by "Handles event-driven persistence."
    }
  } with {
    briefly "Benefits data persistence"
    described by "Persistent storage for benefits enrollments."
  }

  projector BenefitsMetrics is {
    updates repository BenefitsRepository

    record EnrollmentMetrics is {
      totalEnrollments is Natural with { briefly "Total" described by "Total enrollments." }
      activeEnrollments is Natural with { briefly "Active" described by "Active enrollments." }
      pendingEnrollments is Natural with { briefly "Pending" described by "Pending enrollments." }
      terminatedEnrollments is Natural with { briefly "Terminated" described by "Terminated enrollments." }
      cobraEnrollments is Natural with { briefly "COBRA" described by "COBRA enrollments." }
      lifeEventChanges is Natural with { briefly "Life events" described by "Life event changes." }
    } with {
      briefly "Enrollment metrics"
      described by "Benefits enrollment metrics."
    }

    handler MetricsHandler is {
      on event BenefitsEnrollment.EnrollmentCreated {
        prompt "Increment total enrollments"
      }
      on event BenefitsEnrollment.EnrollmentApproved {
        prompt "Increment active enrollments"
      }
      on event BenefitsEnrollment.CobraInitiated {
        prompt "Increment COBRA enrollments"
      }
      on event BenefitsEnrollment.LifeEventRecorded {
        prompt "Increment life event changes"
      }
      on event BenefitsEnrollment.EnrollmentTerminated {
        prompt "Increment terminated enrollments"
      }
    } with {
      briefly "Maintains benefits metrics"
      described by "Projects events into enrollment metrics."
    }
  } with {
    briefly "Benefits metrics"
    described by "Benefits enrollment analytics and compliance reporting."
  }

} with {
  briefly "Bounded context for benefits administration"
  described by "Benefits enrollment and plan management context."
}
