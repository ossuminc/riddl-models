// Benefits Administration - Benefits Context
context BenefitsContext is {
  include "types.riddl"
  include "BenefitsEnrollment.riddl"
  repository BenefitsRepository is {
    schema BenefitsData is relational
      of enrollments as type BenefitsEnrollment
        index on field BenefitsEnrollment.enrollmentId
        index on field BenefitsEnrollment.employeeId
        index on field BenefitsEnrollment.status

    handler BenefitsPersistence is {
      on command BenefitsEnrollment.CreateEnrollment is {
        prompt "Store new benefits enrollment"
      }
      on command BenefitsEnrollment.SelectPlan is {
        prompt "Store plan election"
      }
      on command BenefitsEnrollment.AddDependent is {
        prompt "Store added dependent"
      }
      on command BenefitsEnrollment.SubmitEnrollment is {
        prompt "Update enrollment to submitted"
      }
      on command BenefitsEnrollment.ApproveEnrollment is {
        prompt "Update enrollment to approved"
      }
      on command BenefitsEnrollment.TerminateEnrollment is {
        prompt "Update enrollment to terminated"
      }
    } with {
      briefly "Persists benefits commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Benefits data persistence"
    described as {
      |Persistent storage for benefits enrollments.
    }
  }
  projector BenefitsMetrics is {
    record EnrollmentMetrics is  {
      totalEnrollments: Natural with {
        briefly "Total"
        described as {
          |Total enrollments.
        }
      }
      activeEnrollments: Natural with {
        briefly "Active"
        described as {
          |Active enrollments.
        }
      }
      pendingEnrollments: Natural with {
        briefly "Pending"
        described as {
          |Pending enrollments.
        }
      }
      terminatedEnrollments: Natural with {
        briefly "Terminated"
        described as {
          |Terminated enrollments.
        }
      }
      cobraEnrollments: Natural with {
        briefly "COBRA"
        described as {
          |COBRA enrollments.
        }
      }
      lifeEventChanges: Natural with {
        briefly "Life events"
        described as {
          |Life event changes.
        }
      }
    } with {
      briefly "Enrollment metrics"
      described as {
        |Benefits enrollment metrics.
      }
    }
    handler MetricsHandler is {
      on event BenefitsEnrollment.EnrollmentCreated is {
        prompt "Increment total enrollments"
      }
      on event BenefitsEnrollment.EnrollmentApproved is {
        prompt "Increment active enrollments"
      }
      on event BenefitsEnrollment.CobraInitiated is {
        prompt "Increment COBRA enrollments"
      }
      on event BenefitsEnrollment.LifeEventRecorded is {
        prompt "Increment life event changes"
      }
      on event BenefitsEnrollment.EnrollmentTerminated is {
        prompt "Increment terminated enrollments"
      }
    } with {
      briefly "Maintains benefits metrics"
      described as {
        |Projects events into enrollment metrics.
      }
    }
  } with {
    briefly "Benefits metrics"
    described as {
      |Benefits enrollment analytics and compliance reporting.
    }
  }
} with {
  briefly "Bounded context for benefits administration"
  described as {
    |Benefits enrollment and plan management context.
  }
}
