// Benefits Administration - External Contexts
context InsuranceCarrier is {
  command SubmitEnrollmentFile is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    enrollments: PlanElection+ with {
      briefly "Enrollments"
      described as {
        |Plan elections to submit.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Coverage effective date.
      }
    }
  } with {
    briefly "Submit enrollment file"
    described as {
      |Submits enrollment data to insurance carrier.
    }
  }
  event EnrollmentFileAccepted is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    acceptedAt: TimeStamp with {
      briefly "Accepted"
      described as {
        |Acceptance time.
      }
    }
    recordCount: Natural with {
      briefly "Records"
      described as {
        |Number of records accepted.
      }
    }
  } with {
    briefly "Enrollment file accepted"
    described as {
      |Emitted when carrier accepts enrollment file.
    }
  }
  event EnrollmentFileRejected is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    rejectedAt: TimeStamp with {
      briefly "Rejected"
      described as {
        |Rejection time.
      }
    }
    errors: String(3,500)+ with {
      briefly "Errors"
      described as {
        |Rejection errors.
      }
    }
  } with {
    briefly "Enrollment file rejected"
    described as {
      |Emitted when carrier rejects enrollment file.
    }
  }
  query GetPlanDetails is  {
    carrierId: CarrierId with {
      briefly "Carrier"
      described as {
        |Carrier ID.
      }
    }
    planId: PlanId with {
      briefly "Plan"
      described as {
        |Plan ID.
      }
    }
  } with {
    briefly "Get plan details"
    described as {
      |Retrieves plan details from carrier.
    }
  }
  result PlanDetails is  {
    planInfo: BenefitsPlanInfo with {
      briefly "Plan info"
      described as {
        |Plan details.
      }
    }
    premiumSchedule: Decimal(10,2)+ with {
      briefly "Premiums"
      described as {
        |Premium schedule.
      }
    }
    networkProviders: Natural with {
      briefly "Providers"
      described as {
        |Network provider count.
      }
    }
  } with {
    briefly "Plan details"
    described as {
      |Insurance plan details from carrier.
    }
  }
} with {
  option external()
  briefly "External insurance carrier"
  described as {
    |Insurance carrier system for plan and enrollment management.
  }
}
context PayrollSystem is {
  command UpdateDeductions is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    elections: PlanElection+ with {
      briefly "Elections"
      described as {
        |Plan elections.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Deduction effective date.
      }
    }
  } with {
    briefly "Update deductions"
    described as {
      |Updates payroll deductions for benefit elections.
    }
  }
  event DeductionsUpdated is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    totalDeduction: Decimal(10,2) with {
      briefly "Total"
      described as {
        |Total per-period deduction.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Deductions updated"
    described as {
      |Emitted when payroll deductions are updated.
    }
  }
  query GetEmployeeCompensation is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
  } with {
    briefly "Get employee compensation"
    described as {
      |Retrieves employee compensation details.
    }
  }
  result EmployeeCompensation is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    annualSalary: Decimal(12,2) with {
      briefly "Salary"
      described as {
        |Annual salary.
      }
    }
    payFrequency: String(3,50) with {
      briefly "Frequency"
      described as {
        |Pay frequency.
      }
    }
  } with {
    briefly "Employee compensation"
    described as {
      |Employee compensation details.
    }
  }
} with {
  option external()
  briefly "External payroll system"
  described as {
    |Payroll system for benefits deduction management.
  }
}
context ComplianceReportingSystem is {
  command GenerateAcaReport is  {
    reportingYear: Year with {
      briefly "Year"
      described as {
        |ACA reporting year.
      }
    }
    employeeRecords: AcaReportingInfo+ with {
      briefly "Records"
      described as {
        |Employee ACA records.
      }
    }
  } with {
    briefly "Generate ACA report"
    described as {
      |Generates ACA compliance report.
    }
  }
  event AcaReportGenerated is  {
    reportingYear: Year with {
      briefly "Year"
      described as {
        |Reporting year.
      }
    }
    generatedAt: TimeStamp with {
      briefly "Generated"
      described as {
        |Generation time.
      }
    }
    employeeCount: Natural with {
      briefly "Employees"
      described as {
        |Employee count.
      }
    }
  } with {
    briefly "ACA report generated"
    described as {
      |Emitted when ACA report is generated.
    }
  }
  command GenerateCobraNotice is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    cobraInfo: CobraInfo with {
      briefly "COBRA"
      described as {
        |COBRA details.
      }
    }
  } with {
    briefly "Generate COBRA notice"
    described as {
      |Generates COBRA election notice.
    }
  }
  event CobraNoticeGenerated is  {
    employeeId: EmployeeId with {
      briefly "Employee"
      described as {
        |Employee ID.
      }
    }
    generatedAt: TimeStamp with {
      briefly "Generated"
      described as {
        |Generation time.
      }
    }
    electionDeadline: Date with {
      briefly "Deadline"
      described as {
        |Election deadline.
      }
    }
  } with {
    briefly "COBRA notice generated"
    described as {
      |Emitted when COBRA notice is generated.
    }
  }
} with {
  option external()
  briefly "External compliance reporting"
  described as {
    |Compliance reporting system for ACA and COBRA.
  }
}
