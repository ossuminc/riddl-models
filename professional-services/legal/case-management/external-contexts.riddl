// External Contexts for Case Management Domain
context DocumentManagement is {
  type DocumentReference is {
    documentId: DocumentId
    storageUrl: URL
    checksum: String
  } with {
    briefly "Reference to stored document"
    described as {
      |Pointer to a document stored in the external DMS.
    }
  }
  command StoreDocument is  {
    documentId: DocumentId
    content: String
    metadata: CaseDocument
  } with {
    briefly "Store document in DMS"
    described as {
      |Uploads a document to the document management system.
    }
  }
  command RetrieveDocument is  { documentId: DocumentId } with {
    briefly "Retrieve document from DMS"
    described as {
      |Downloads a document from the document management system.
    }
  }
  command DeleteDocument is  { documentId: DocumentId } with {
    briefly "Delete document from DMS"
    described as {
      |Removes a document from the document management system.
    }
  }
  event DocumentStored is  {
    documentId: DocumentId
    storageUrl: URL
    storedAt: DateTime
  } with {
    briefly "Document stored"
    described as {
      |Confirms document was successfully stored in DMS.
    }
  }
  event DocumentRetrieved is  {
    documentId: DocumentId
    content: String
  } with {
    briefly "Document retrieved"
    described as {
      |Contains the retrieved document content.
    }
  }
  event DocumentDeleted is  {
    documentId: DocumentId
    deletedAt: DateTime
  } with {
    briefly "Document deleted"
    described as {
      |Confirms document was deleted from DMS.
    }
  }
} with {
  option external()
  briefly "External document management system"
  described as {
    | Integration with an external document management system (DMS) for
    | storing, retrieving, and managing legal documents. The DMS handles
    | document versioning, access control, and retention policies.
  }
}
context BillingSystem is {
  type InvoiceId is UUID with {
    briefly "Unique invoice identifier"
    described as {
      |Identifies an invoice in the billing system.
    }
  }
  type Invoice is {
    invoiceId: InvoiceId
    clientId: ClientId
    caseId: CaseId
    matterId: MatterId
    invoiceDate: Date
    invoiceDueDate: Date
    timeCharges: Decimal(15,2)
    expenseCharges: Decimal(15,2)
    totalAmount: Decimal(15,2)
    invoiceStatus: InvoiceStatus
  } with {
    briefly "Client invoice"
    described as {
      |Invoice sent to client for legal services.
    }
  }
  type InvoiceStatus is any of {
    Draft,
    Sent,
    Paid,
    Overdue,
    WrittenOff
  } with {
    briefly "Invoice payment status"
    described as {
      |Tracks the payment status of an invoice.
    }
  }
  command GenerateInvoice is  {
    caseId: CaseId
    timeEntries: TimeEntry*
    caseExpenses: Expense*
  } with {
    briefly "Generate invoice from time and expenses"
    described as {
      |Creates an invoice from unbilled time entries and expenses.
    }
  }
  command SendInvoice is  { invoiceId: InvoiceId } with {
    briefly "Send invoice to client"
    described as {
      |Delivers the invoice to the client via configured channels.
    }
  }
  command RecordPayment is  {
    invoiceId: InvoiceId
    amount: Decimal(15,2)
    paymentDate: Date
    paymentMethod: String
  } with {
    briefly "Record payment received"
    described as {
      |Records a payment received against an invoice.
    }
  }
  event InvoiceGenerated is  {
    invoiceId: InvoiceId
    caseId: CaseId
    totalAmount: Decimal(15,2)
  } with {
    briefly "Invoice created"
    described as {
      |Confirms a new invoice was generated.
    }
  }
  event InvoiceSent is  {
    invoiceId: InvoiceId
    sentAt: DateTime
  } with {
    briefly "Invoice sent"
    described as {
      |Confirms invoice was delivered to client.
    }
  }
  event PaymentReceived is  {
    invoiceId: InvoiceId
    amount: Decimal(15,2)
    paymentDate: Date
  } with {
    briefly "Payment received"
    described as {
      |Confirms payment was received and applied.
    }
  }
} with {
  option external()
  briefly "External billing and invoicing system"
  described as {
    | Integration with the firm's billing system for generating client
    | invoices, tracking accounts receivable, and recording payments.
    | The billing system handles invoice generation, delivery, and
    | payment processing.
  }
}
context CalendarSystem is {
  type CalendarEventId is UUID with {
    briefly "Calendar event identifier"
    described as {
      |Unique identifier for a calendar entry.
    }
  }
  type CalendarEntry is {
    eventId: CalendarEventId
    title: String
    startTime: DateTime
    endTime: DateTime
    eventLocation: String?
    attendees: String*
    relatedCaseId: CaseId?
    relatedEventType: CourtEventType?
  } with {
    briefly "Calendar entry"
    described as {
      |An event on the firm calendar.
    }
  }
  command CreateCalendarEvent is  { calendarEntry: CalendarEntry } with {
    briefly "Create calendar event"
    described as {
      |Adds an event to the firm calendar.
    }
  }
  command UpdateCalendarEvent is  {
    eventId: CalendarEventId
    calendarEntry: CalendarEntry
  } with {
    briefly "Update calendar event"
    described as {
      |Modifies an existing calendar event.
    }
  }
  command CancelCalendarEvent is  {
    eventId: CalendarEventId
    reason: String
  } with {
    briefly "Cancel calendar event"
    described as {
      |Removes an event from the calendar.
    }
  }
  command SendReminder is  {
    eventId: CalendarEventId
    reminderTime: DateTime
  } with {
    briefly "Send event reminder"
    described as {
      |Sends reminder notifications for an upcoming event.
    }
  }
  event CalendarEventCreated is  {
    eventId: CalendarEventId
    title: String
    startTime: DateTime
  } with {
    briefly "Calendar event created"
    described as {
      |Confirms a new event was added to the calendar.
    }
  }
  event CalendarEventUpdated is  {
    eventId: CalendarEventId
    updatedAt: DateTime
  } with {
    briefly "Calendar event updated"
    described as {
      |Confirms a calendar event was modified.
    }
  }
  event CalendarEventCancelled is  {
    eventId: CalendarEventId
    cancelledAt: DateTime
  } with {
    briefly "Calendar event cancelled"
    described as {
      |Confirms a calendar event was cancelled.
    }
  }
  event ReminderSent is  {
    eventId: CalendarEventId
    sentAt: DateTime
    recipients: String*
  } with {
    briefly "Reminder sent"
    described as {
      |Confirms reminder notifications were sent.
    }
  }
} with {
  option external()
  briefly "External calendar and scheduling system"
  described as {
    | Integration with the firm's calendar system for scheduling court
    | dates, deadlines, meetings, and other events. The calendar system
    | handles scheduling, conflict detection, and reminder notifications.
  }
}
context ClientPortal is {
  command PublishCaseUpdate is  {
    caseId: CaseId
    clientId: ClientId
    updateType: String
    message: String
  } with {
    briefly "Publish update to client portal"
    described as {
      |Posts a case status update visible to the client.
    }
  }
  command ShareDocument is  {
    caseId: CaseId
    clientId: ClientId
    documentId: DocumentId
    expirationDate: Date?
  } with {
    briefly "Share document with client"
    described as {
      |Makes a document available to the client via the portal.
    }
  }
  command SendSecureMessage is  {
    caseId: CaseId
    clientId: ClientId
    subject: String
    message: String
  } with {
    briefly "Send secure message to client"
    described as {
      |Sends an encrypted message to the client via the portal.
    }
  }
  event CaseUpdatePublished is  {
    caseId: CaseId
    clientId: ClientId
    publishedAt: DateTime
  } with {
    briefly "Update published"
    described as {
      |Confirms case update was posted to client portal.
    }
  }
  event DocumentShared is  {
    documentId: DocumentId
    clientId: ClientId
    sharedAt: DateTime
  } with {
    briefly "Document shared"
    described as {
      |Confirms document was made available to client.
    }
  }
  event SecureMessageSent is  {
    caseId: CaseId
    clientId: ClientId
    sentAt: DateTime
  } with {
    briefly "Secure message sent"
    described as {
      |Confirms message was delivered to client.
    }
  }
} with {
  option external()
  briefly "External client communication portal"
  described as {
    | Integration with the client-facing portal for secure communications.
    | The portal allows clients to view case updates, access shared
    | documents, and exchange secure messages with their legal team.
  }
}
context ConflictDatabase is {
  type ConflictSearchResult is {
    potentialConflicts: PotentialConflict*
    searchedAt: DateTime
  } with {
    briefly "Conflict search results"
    described as {
      |Results from a conflict of interest search.
    }
  }
  type PotentialConflict is {
    matchType: String
    matchedEntity: String
    relatedCase: CaseId?
    severity: ConflictSeverity
  } with {
    briefly "Potential conflict match"
    described as {
      |A potential conflict identified during screening.
    }
  }
  type ConflictSeverity is any of {
    None,
    Advisory,
    RequiresReview,
    Disqualifying
  } with {
    briefly "Conflict severity level"
    described as {
      |Indicates the seriousness of a potential conflict.
    }
  }
  command SearchConflicts is  {
    clientName: String
    adverseParties: String*
    relatedEntities: String*
  } with {
    briefly "Search for conflicts"
    described as {
      |Searches the conflict database for potential conflicts of interest.
    }
  }
  command RecordConflictWaiver is  {
    caseId: CaseId
    conflictDescription: String
    waiverGrantedBy: String
    waiverDate: Date
  } with {
    briefly "Record conflict waiver"
    described as {
      |Records that a conflict was waived by the appropriate party.
    }
  }
  event ConflictSearchCompleted is  {
    searchId: UUID
    results: ConflictSearchResult
  } with {
    briefly "Conflict search completed"
    described as {
      |Returns results of a conflict of interest search.
    }
  }
  event ConflictWaiverRecorded is  {
    caseId: CaseId
    recordedAt: DateTime
  } with {
    briefly "Waiver recorded"
    described as {
      |Confirms a conflict waiver was recorded.
    }
  }
} with {
  option external()
  briefly "External conflict of interest database"
  described as {
    | Integration with the firm's conflict of interest database for
    | screening new clients and matters. The system maintains a database
    | of all clients, adverse parties, and related entities for conflict
    | checking.
  }
}
