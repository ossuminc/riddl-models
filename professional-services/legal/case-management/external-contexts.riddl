// External Contexts for Case Management Domain

context DocumentManagement is {

  type DocumentReference is {
    documentId: DocumentId,
    storageUrl: URL,
    checksum: String
  } with {
    briefly "Reference to stored document"
    described by "Pointer to a document stored in the external DMS."
  }

  command StoreDocument is {
    documentId: DocumentId,
    content: String,
    metadata: CaseDocument
  } with {
    briefly "Store document in DMS"
    described by "Uploads a document to the document management system."
  }

  command RetrieveDocument is {
    documentId: DocumentId
  } with {
    briefly "Retrieve document from DMS"
    described by "Downloads a document from the document management system."
  }

  command DeleteDocument is {
    documentId: DocumentId
  } with {
    briefly "Delete document from DMS"
    described by "Removes a document from the document management system."
  }

  event DocumentStored is {
    documentId: DocumentId,
    storageUrl: URL,
    storedAt: DateTime
  } with {
    briefly "Document stored"
    described by "Confirms document was successfully stored in DMS."
  }

  event DocumentRetrieved is {
    documentId: DocumentId,
    content: String
  } with {
    briefly "Document retrieved"
    described by "Contains the retrieved document content."
  }

  event DocumentDeleted is {
    documentId: DocumentId,
    deletedAt: DateTime
  } with {
    briefly "Document deleted"
    described by "Confirms document was deleted from DMS."
  }

} with {
  option is external
  briefly "External document management system"
  described by {
    | Integration with an external document management system (DMS) for
    | storing, retrieving, and managing legal documents. The DMS handles
    | document versioning, access control, and retention policies.
  }
}

context BillingSystem is {

  type InvoiceId is UUID with {
    briefly "Unique invoice identifier"
    described by "Identifies an invoice in the billing system."
  }

  type Invoice is {
    invoiceId: InvoiceId,
    clientId: ClientId,
    caseId: CaseId,
    matterId: MatterId,
    invoiceDate: Date,
    dueDate: Date,
    timeCharges: Decimal(15, 2),
    expenses: Decimal(15, 2),
    totalAmount: Decimal(15, 2),
    status: InvoiceStatus
  } with {
    briefly "Client invoice"
    described by "Invoice sent to client for legal services."
  }

  type InvoiceStatus is any of {
    Draft,
    Sent,
    Paid,
    Overdue,
    WrittenOff
  } with {
    briefly "Invoice payment status"
    described by "Tracks the payment status of an invoice."
  }

  command GenerateInvoice is {
    caseId: CaseId,
    timeEntries: TimeEntry*,
    expenses: Expense*
  } with {
    briefly "Generate invoice from time and expenses"
    described by "Creates an invoice from unbilled time entries and expenses."
  }

  command SendInvoice is {
    invoiceId: InvoiceId
  } with {
    briefly "Send invoice to client"
    described by "Delivers the invoice to the client via configured channels."
  }

  command RecordPayment is {
    invoiceId: InvoiceId,
    amount: Decimal(15, 2),
    paymentDate: Date,
    paymentMethod: String
  } with {
    briefly "Record payment received"
    described by "Records a payment received against an invoice."
  }

  event InvoiceGenerated is {
    invoiceId: InvoiceId,
    caseId: CaseId,
    totalAmount: Decimal(15, 2)
  } with {
    briefly "Invoice created"
    described by "Confirms a new invoice was generated."
  }

  event InvoiceSent is {
    invoiceId: InvoiceId,
    sentAt: DateTime
  } with {
    briefly "Invoice sent"
    described by "Confirms invoice was delivered to client."
  }

  event PaymentReceived is {
    invoiceId: InvoiceId,
    amount: Decimal(15, 2),
    paymentDate: Date
  } with {
    briefly "Payment received"
    described by "Confirms payment was received and applied."
  }

} with {
  option is external
  briefly "External billing and invoicing system"
  described by {
    | Integration with the firm's billing system for generating client
    | invoices, tracking accounts receivable, and recording payments.
    | The billing system handles invoice generation, delivery, and
    | payment processing.
  }
}

context CalendarSystem is {

  type CalendarEventId is UUID with {
    briefly "Calendar event identifier"
    described by "Unique identifier for a calendar entry."
  }

  type CalendarEntry is {
    eventId: CalendarEventId,
    title: String,
    startTime: DateTime,
    endTime: DateTime,
    location: optional String,
    attendees: String*,
    caseId: optional CaseId,
    eventType: optional CourtEventType
  } with {
    briefly "Calendar entry"
    described by "An event on the firm calendar."
  }

  command CreateCalendarEvent is {
    entry: CalendarEntry
  } with {
    briefly "Create calendar event"
    described by "Adds an event to the firm calendar."
  }

  command UpdateCalendarEvent is {
    eventId: CalendarEventId,
    entry: CalendarEntry
  } with {
    briefly "Update calendar event"
    described by "Modifies an existing calendar event."
  }

  command CancelCalendarEvent is {
    eventId: CalendarEventId,
    reason: String
  } with {
    briefly "Cancel calendar event"
    described by "Removes an event from the calendar."
  }

  command SendReminder is {
    eventId: CalendarEventId,
    reminderTime: DateTime
  } with {
    briefly "Send event reminder"
    described by "Sends reminder notifications for an upcoming event."
  }

  event CalendarEventCreated is {
    eventId: CalendarEventId,
    title: String,
    startTime: DateTime
  } with {
    briefly "Calendar event created"
    described by "Confirms a new event was added to the calendar."
  }

  event CalendarEventUpdated is {
    eventId: CalendarEventId,
    updatedAt: DateTime
  } with {
    briefly "Calendar event updated"
    described by "Confirms a calendar event was modified."
  }

  event CalendarEventCancelled is {
    eventId: CalendarEventId,
    cancelledAt: DateTime
  } with {
    briefly "Calendar event cancelled"
    described by "Confirms a calendar event was cancelled."
  }

  event ReminderSent is {
    eventId: CalendarEventId,
    sentAt: DateTime,
    recipients: String*
  } with {
    briefly "Reminder sent"
    described by "Confirms reminder notifications were sent."
  }

} with {
  option is external
  briefly "External calendar and scheduling system"
  described by {
    | Integration with the firm's calendar system for scheduling court
    | dates, deadlines, meetings, and other events. The calendar system
    | handles scheduling, conflict detection, and reminder notifications.
  }
}

context ClientPortal is {

  command PublishCaseUpdate is {
    caseId: CaseId,
    clientId: ClientId,
    updateType: String,
    message: String
  } with {
    briefly "Publish update to client portal"
    described by "Posts a case status update visible to the client."
  }

  command ShareDocument is {
    caseId: CaseId,
    clientId: ClientId,
    documentId: DocumentId,
    expirationDate: optional Date
  } with {
    briefly "Share document with client"
    described by "Makes a document available to the client via the portal."
  }

  command SendSecureMessage is {
    caseId: CaseId,
    clientId: ClientId,
    subject: String,
    message: String
  } with {
    briefly "Send secure message to client"
    described by "Sends an encrypted message to the client via the portal."
  }

  event CaseUpdatePublished is {
    caseId: CaseId,
    clientId: ClientId,
    publishedAt: DateTime
  } with {
    briefly "Update published"
    described by "Confirms case update was posted to client portal."
  }

  event DocumentShared is {
    documentId: DocumentId,
    clientId: ClientId,
    sharedAt: DateTime
  } with {
    briefly "Document shared"
    described by "Confirms document was made available to client."
  }

  event SecureMessageSent is {
    caseId: CaseId,
    clientId: ClientId,
    sentAt: DateTime
  } with {
    briefly "Secure message sent"
    described by "Confirms message was delivered to client."
  }

} with {
  option is external
  briefly "External client communication portal"
  described by {
    | Integration with the client-facing portal for secure communications.
    | The portal allows clients to view case updates, access shared
    | documents, and exchange secure messages with their legal team.
  }
}

context ConflictDatabase is {

  type ConflictSearchResult is {
    potentialConflicts: PotentialConflict*,
    searchedAt: DateTime
  } with {
    briefly "Conflict search results"
    described by "Results from a conflict of interest search."
  }

  type PotentialConflict is {
    matchType: String,
    matchedEntity: String,
    relatedCase: optional CaseId,
    severity: ConflictSeverity
  } with {
    briefly "Potential conflict match"
    described by "A potential conflict identified during screening."
  }

  type ConflictSeverity is any of {
    None,
    Advisory,
    RequiresReview,
    Disqualifying
  } with {
    briefly "Conflict severity level"
    described by "Indicates the seriousness of a potential conflict."
  }

  command SearchConflicts is {
    clientName: String,
    adverseParties: String*,
    relatedEntities: String*
  } with {
    briefly "Search for conflicts"
    described by "Searches the conflict database for potential conflicts of interest."
  }

  command RecordConflictWaiver is {
    caseId: CaseId,
    conflictDescription: String,
    waiverGrantedBy: String,
    waiverDate: Date
  } with {
    briefly "Record conflict waiver"
    described by "Records that a conflict was waived by the appropriate party."
  }

  event ConflictSearchCompleted is {
    searchId: UUID,
    results: ConflictSearchResult
  } with {
    briefly "Conflict search completed"
    described by "Returns results of a conflict of interest search."
  }

  event ConflictWaiverRecorded is {
    caseId: CaseId,
    recordedAt: DateTime
  } with {
    briefly "Waiver recorded"
    described by "Confirms a conflict waiver was recorded."
  }

} with {
  option is external
  briefly "External conflict of interest database"
  described by {
    | Integration with the firm's conflict of interest database for
    | screening new clients and matters. The system maintains a database
    | of all clients, adverse parties, and related entities for conflict
    | checking.
  }
}
