// Matter Management - Matter Context
context MatterContext is {
  include "types.riddl"
  include "LegalMatter.riddl"
  repository MatterRepository is {
    schema MatterData is relational
      of legalMatters as type LegalMatter
        index on field LegalMatter.matterId
        index on field LegalMatter.matterInfo.clientInfo.clientId
        index on field LegalMatter.status

    handler MatterPersistence is {
      on command LegalMatter.CreateMatter is {
        prompt "Store new legal matter"
      }
      on command LegalMatter.RecordConflictCheck is {
        prompt "Update matter conflict check result"
      }
      on command LegalMatter.AssignTeam is {
        prompt "Store team assignment"
      }
      on command LegalMatter.ActivateMatter is {
        prompt "Update matter to active"
      }
      on command LegalMatter.RecordTime is {
        prompt "Store time entry"
      }
      on command LegalMatter.RecordExpense is {
        prompt "Store expense entry"
      }
      on command LegalMatter.AttachDocument is {
        prompt "Store document reference"
      }
      on command LegalMatter.CloseMatter is {
        prompt "Update matter to closed"
      }
    } with {
      briefly "Persists matter commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Matter data persistence"
    described as {
      |Persistent storage for legal matters.
    }
  }
  projector MatterMetrics is {
    record MatterAnalytics is  {
      mattersOpened: Natural with {
        briefly "Opened"
        described as {
          |Matters opened.
        }
      }
      mattersClosed: Natural with {
        briefly "Closed"
        described as {
          |Matters closed.
        }
      }
      mattersRejected: Natural with {
        briefly "Rejected"
        described as {
          |Matters rejected.
        }
      }
      totalBillableHours: Decimal(10,2) with {
        briefly "Hours"
        described as {
          |Total billable hours.
        }
      }
      totalExpenses: Decimal(12,2) with {
        briefly "Expenses"
        described as {
          |Total expenses.
        }
      }
      averageMatterDuration: Decimal(8,2) with {
        briefly "Avg duration"
        described as {
          |Average matter duration in days.
        }
      }
    } with {
      briefly "Matter analytics"
      described as {
        |Matter processing analytics.
      }
    }
    handler MetricsHandler is {
      on event LegalMatter.MatterCreated is {
        prompt "Increment matters opened"
      }
      on event LegalMatter.TimeRecorded is {
        prompt "Add to total billable hours"
      }
      on event LegalMatter.ExpenseRecorded is {
        prompt "Add to total expenses"
      }
      on event LegalMatter.MatterClosed is {
        prompt "Increment matters closed and calculate duration"
      }
      on event LegalMatter.MatterRejected is {
        prompt "Increment matters rejected"
      }
    } with {
      briefly "Maintains matter metrics"
      described as {
        |Projects events into analytics.
      }
    }
  } with {
    briefly "Matter metrics"
    described as {
      |Legal matter analytics and reporting.
    }
  }
} with {
  briefly "Bounded context for matter management"
  described as {
    |Legal matter management context.
  }
}
