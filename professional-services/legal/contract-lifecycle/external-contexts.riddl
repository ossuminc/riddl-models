// Contract Lifecycle - External Contexts
context ESignatureService is {
  command SendEnvelope is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
    documentUrl: URL with {
      briefly "Document"
      described as {
        |Document URL.
      }
    }
    signatories: ContractParty+ with {
      briefly "Signatories"
      described as {
        |Parties to sign.
      }
    }
  } with {
    briefly "Send envelope"
    described as {
      |Sends document for electronic signature.
    }
  }
  event EnvelopeSigned is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
    signature: SignatureRecord with {
      briefly "Signature"
      described as {
        |Signature record.
      }
    }
  } with {
    briefly "Envelope signed"
    described as {
      |Emitted when a signatory signs.
    }
  }
  event EnvelopeCompleted is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
    allSignatures: SignatureRecord+ with {
      briefly "Signatures"
      described as {
        |All signatures.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Envelope completed"
    described as {
      |Emitted when all parties have signed.
    }
  }
  query GetEnvelopeStatus is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
  } with {
    briefly "Get envelope status"
    described as {
      |Gets signature envelope status.
    }
  }
  result EnvelopeStatus is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
    envelopeStatus: String(3,50) with {
      briefly "Status"
      described as {
        |Envelope status.
      }
    }
    pendingSignatories: String(3,200)+ with {
      briefly "Pending"
      described as {
        |Signatories not yet signed.
      }
    }
  } with {
    briefly "Envelope status"
    described as {
      |Signature envelope status.
    }
  }
} with {
  option external()
  briefly "External e-signature service"
  described as {
    |Electronic signature platform such as DocuSign or Adobe Sign.
  }
}
context DocumentRepository is {
  command StoreDocument is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
    documentName: String(3,300) with {
      briefly "Name"
      described as {
        |Document name.
      }
    }
    documentContent: String(3,100000) with {
      briefly "Content"
      described as {
        |Document content.
      }
    }
    version: Natural with {
      briefly "Version"
      described as {
        |Document version.
      }
    }
  } with {
    briefly "Store document"
    described as {
      |Stores a contract document version.
    }
  }
  event DocumentStored is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
    documentUrl: URL with {
      briefly "URL"
      described as {
        |Stored document URL.
      }
    }
    version: Natural with {
      briefly "Version"
      described as {
        |Document version.
      }
    }
    storedAt: TimeStamp with {
      briefly "Stored"
      described as {
        |Storage time.
      }
    }
  } with {
    briefly "Document stored"
    described as {
      |Emitted when document is stored.
    }
  }
  query GetDocument is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
    requestedVersion: Natural? with {
      briefly "Version"
      described as {
        |Document version.
      }
    }
  } with {
    briefly "Get document"
    described as {
      |Retrieves a contract document.
    }
  }
  result DocumentContent is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
    documentName: String(3,300) with {
      briefly "Name"
      described as {
        |Document name.
      }
    }
    documentUrl: URL with {
      briefly "URL"
      described as {
        |Document URL.
      }
    }
    version: Natural with {
      briefly "Version"
      described as {
        |Document version.
      }
    }
  } with {
    briefly "Document content"
    described as {
      |Retrieved document details.
    }
  }
  query ListVersions is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
  } with {
    briefly "List versions"
    described as {
      |Lists all versions of a contract document.
    }
  }
  result VersionList is  {
    contractId: ContractId with {
      briefly "Contract"
      described as {
        |Contract ID.
      }
    }
    versions: Natural+ with {
      briefly "Versions"
      described as {
        |Available versions.
      }
    }
    latestVersion: Natural with {
      briefly "Latest"
      described as {
        |Latest version number.
      }
    }
  } with {
    briefly "Version list"
    described as {
      |List of document versions.
    }
  }
} with {
  option external()
  briefly "External document repository"
  described as {
    |Document management system for contract storage.
  }
}
