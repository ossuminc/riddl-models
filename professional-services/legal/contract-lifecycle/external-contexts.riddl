// Contract Lifecycle - External Contexts

context ESignatureService is {

  command SendEnvelope is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
    documentUrl is URL with { briefly "Document" described by "Document URL." }
    signatories is many ContractParty with { briefly "Signatories" described by "Parties to sign." }
  } with {
    briefly "Send envelope"
    described by "Sends document for electronic signature."
  }

  event EnvelopeSigned is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
    signature is SignatureRecord with { briefly "Signature" described by "Signature record." }
  } with {
    briefly "Envelope signed"
    described by "Emitted when a signatory signs."
  }

  event EnvelopeCompleted is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
    allSignatures is many SignatureRecord with { briefly "Signatures" described by "All signatures." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Envelope completed"
    described by "Emitted when all parties have signed."
  }

  query GetEnvelopeStatus is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
  } with {
    briefly "Get envelope status"
    described by "Gets signature envelope status."
  }

  result EnvelopeStatus is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
    envelopeStatus is String(3, 50) with { briefly "Status" described by "Envelope status." }
    pendingSignatories is many String(3, 200) with { briefly "Pending" described by "Signatories not yet signed." }
  } with {
    briefly "Envelope status"
    described by "Signature envelope status."
  }

} with {
  option is external
  briefly "External e-signature service"
  described by "Electronic signature platform such as DocuSign or Adobe Sign."
}

context DocumentRepository is {

  command StoreDocument is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
    documentName is String(3, 300) with { briefly "Name" described by "Document name." }
    documentContent is String(3, 100000) with { briefly "Content" described by "Document content." }
    version is Natural with { briefly "Version" described by "Document version." }
  } with {
    briefly "Store document"
    described by "Stores a contract document version."
  }

  event DocumentStored is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
    documentUrl is URL with { briefly "URL" described by "Stored document URL." }
    version is Natural with { briefly "Version" described by "Document version." }
    storedAt is TimeStamp with { briefly "Stored" described by "Storage time." }
  } with {
    briefly "Document stored"
    described by "Emitted when document is stored."
  }

  query GetDocument is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
    requestedVersion is optional Natural with { briefly "Version" described by "Document version." }
  } with {
    briefly "Get document"
    described by "Retrieves a contract document."
  }

  result DocumentContent is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
    documentName is String(3, 300) with { briefly "Name" described by "Document name." }
    documentUrl is URL with { briefly "URL" described by "Document URL." }
    version is Natural with { briefly "Version" described by "Document version." }
  } with {
    briefly "Document content"
    described by "Retrieved document details."
  }

  query ListVersions is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
  } with {
    briefly "List versions"
    described by "Lists all versions of a contract document."
  }

  result VersionList is {
    contractId is ContractId with { briefly "Contract" described by "Contract ID." }
    versions is many Natural with { briefly "Versions" described by "Available versions." }
    latestVersion is Natural with { briefly "Latest" described by "Latest version number." }
  } with {
    briefly "Version list"
    described by "List of document versions."
  }

} with {
  option is external
  briefly "External document repository"
  described by "Document management system for contract storage."
}
