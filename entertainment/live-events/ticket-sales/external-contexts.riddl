// Ticket Sales - External Contexts
// These represent external systems that Ticket Sales integrates with
context PaymentGateway is {
  type PaymentAmount is Decimal(10,2) with {
    briefly "Payment amount"
    described as {
      |Monetary amount for payment processing.
    }
  }
  command ProcessPayment is  {
    paymentTicketId: UUID with {
      briefly "Ticket reference"
      described as {
        |The ticket being purchased.
      }
    }
    paymentBuyerId: UUID with {
      briefly "Buyer"
      described as {
        |Who is making the payment.
      }
    }
    paymentAmount: PaymentAmount with {
      briefly "Amount"
      described as {
        |Total amount to charge.
      }
    }
    paymentMethod: String(1,50) with {
      briefly "Payment method"
      described as {
        |Type of payment (credit card, PayPal, etc.).
      }
    }
    paymentToken: String(1,500) with {
      briefly "Payment token"
      described as {
        |Tokenized payment credentials.
      }
    }
  } with {
    briefly "Process a payment transaction"
    described as {
      |Charges the buyer for a ticket purchase.
    }
  }
  command RefundPayment is  {
    transactionId: String(1,100) with {
      briefly "Transaction ID"
      described as {
        |Original payment transaction to refund.
      }
    }
    paymentRefundAmount: PaymentAmount with {
      briefly "Amount"
      described as {
        |Amount to refund.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason for the refund.
      }
    }
  } with {
    briefly "Refund a previous payment"
    described as {
      |Returns funds to the buyer's original payment method.
    }
  }
  event PaymentSucceeded is  {
    transactionId: String(1,100) with {
      briefly "Transaction ID"
      described as {
        |Unique payment transaction identifier.
      }
    }
    paidTicketId: UUID with {
      briefly "Ticket"
      described as {
        |The ticket that was paid for.
      }
    }
    chargedAmount: PaymentAmount with {
      briefly "Amount"
      described as {
        |Amount charged.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |When payment was processed.
      }
    }
  } with {
    briefly "Payment was successfully processed"
    described as {
      |Emitted when a payment charge succeeds.
    }
  }
  event PaymentFailed is  {
    failedTicketId: UUID with {
      briefly "Ticket"
      described as {
        |The ticket payment failed for.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Why the payment failed.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |When payment failed.
      }
    }
  } with {
    briefly "Payment processing failed"
    described as {
      |Emitted when a payment charge is declined or fails.
    }
  }
  event RefundCompleted is  {
    transactionId: String(1,100) with {
      briefly "Transaction ID"
      described as {
        |Original transaction that was refunded.
      }
    }
    refundedAmount: PaymentAmount with {
      briefly "Amount"
      described as {
        |Amount refunded.
      }
    }
    refundedAt: TimeStamp with {
      briefly "Refunded"
      described as {
        |When refund was processed.
      }
    }
  } with {
    briefly "Refund was processed"
    described as {
      |Emitted when a refund is successfully completed.
    }
  }
  handler PaymentHandler is {
    on command ProcessPayment is {
      tell event PaymentSucceeded to context PaymentGateway
    }
    on command RefundPayment is {
      tell event RefundCompleted to context PaymentGateway
    }
  } with {
    briefly "Handles payment commands"
    described as {
      |Processes payment and refund requests.
    }
  }
} with {
  briefly "External payment processing service"
  option external()
  described as {
    | The PaymentGateway context represents an external payment processor
    | (e.g., Stripe, Square, PayPal) that handles credit card processing,
    | digital wallets, refunds, and payment validation for ticket purchases.
  }
}
context VenueManagement is {
  type VenueCapacity is Natural with {
    briefly "Venue capacity"
    described as {
      |Maximum number of attendees for the venue.
    }
  }
  command GetSeatingChart is  {
    externalVenueId: UUID with {
      briefly "Venue"
      described as {
        |The venue to get seating for.
      }
    }
  } with {
    briefly "Retrieve venue seating chart"
    described as {
      |Gets the current seating configuration for a venue.
    }
  }
  command ReserveVenue is  {
    externalVenueId: UUID with {
      briefly "Venue"
      described as {
        |The venue to reserve.
      }
    }
    eventDate: DateTime with {
      briefly "Date"
      described as {
        |Date and time to reserve.
      }
    }
    eventName: String(1,200) with {
      briefly "Event name"
      described as {
        |Name of the event.
      }
    }
    expectedAttendance: Natural with {
      briefly "Expected attendance"
      described as {
        |Anticipated number of attendees.
      }
    }
  } with {
    briefly "Reserve a venue for an event"
    described as {
      |Books the venue for a specific date and event.
    }
  }
  event SeatingChartUpdated is  {
    externalVenueId: UUID with {
      briefly "Venue"
      described as {
        |The venue that was updated.
      }
    }
    totalSeats: Natural with {
      briefly "Total seats"
      described as {
        |New total seat count.
      }
    }
    sections: {
      sectionName: String(1,50) with {
        briefly "Section"
        described as {
          |Section name.
        }
      }
      seatCount: Natural with {
        briefly "Seats"
        described as {
          |Number of seats in section.
        }
      }
    }
+ with {
      briefly "Sections"
      described as {
        |Updated section information.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |When the chart was updated.
      }
    }
  } with {
    briefly "Venue seating chart was updated"
    described as {
      |Emitted when venue layout changes affect seat inventory.
    }
  }
  event VenueCapacityChanged is  {
    externalVenueId: UUID with {
      briefly "Venue"
      described as {
        |The venue with changed capacity.
      }
    }
    previousCapacity: VenueCapacity with {
      briefly "Previous"
      described as {
        |Previous capacity.
      }
    }
    newCapacity: VenueCapacity with {
      briefly "New"
      described as {
        |New capacity.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Why capacity changed.
      }
    }
    changedAt: TimeStamp with {
      briefly "Changed"
      described as {
        |When capacity changed.
      }
    }
  } with {
    briefly "Venue capacity was changed"
    described as {
      |Emitted when a venue's maximum capacity is adjusted.
    }
  }
  event VenueReserved is  {
    externalVenueId: UUID with {
      briefly "Venue"
      described as {
        |The reserved venue.
      }
    }
    eventDate: DateTime with {
      briefly "Date"
      described as {
        |Reserved date.
      }
    }
    confirmationNumber: String(1,50) with {
      briefly "Confirmation"
      described as {
        |Venue reservation confirmation.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |When reservation was made.
      }
    }
  } with {
    briefly "Venue was reserved for an event"
    described as {
      |Emitted when a venue booking is confirmed.
    }
  }
  handler VenueHandler is {
    on command GetSeatingChart is {
      tell event SeatingChartUpdated to context VenueManagement
    }
    on command ReserveVenue is {
      tell event VenueReserved to context VenueManagement
    }
  } with {
    briefly "Handles venue commands"
    described as {
      |Processes venue queries and reservations.
    }
  }
} with {
  briefly "External venue management system"
  option external()
  described as {
    | The VenueManagement context represents an external system that
    | manages venue information including seating charts, capacity,
    | availability calendars, and booking confirmations. It provides
    | the physical seat inventory that drives ticket creation.
  }
}
context MarketingService is {
  command AnnounceEvent is  {
    marketingEventId: UUID with {
      briefly "Event"
      described as {
        |The event to announce.
      }
    }
    eventName: String(1,200) with {
      briefly "Name"
      described as {
        |Event name for announcement.
      }
    }
    eventDate: DateTime with {
      briefly "Date"
      described as {
        |Event date.
      }
    }
    venueName: String(1,200) with {
      briefly "Venue"
      described as {
        |Venue name.
      }
    }
    description: String(1,2000) with {
      briefly "Description"
      described as {
        |Event description for marketing.
      }
    }
    imageUrl: URL? with {
      briefly "Image"
      described as {
        |Event promotional image.
      }
    }
  } with {
    briefly "Announce a new event"
    described as {
      |Triggers marketing announcement for a new event.
    }
  }
  command NotifySubscribers is  {
    marketingEventId: UUID with {
      briefly "Event"
      described as {
        |Event tickets are available for.
      }
    }
    eventName: String(1,200) with {
      briefly "Name"
      described as {
        |Event name.
      }
    }
    tierName: String(1,50) with {
      briefly "Tier"
      described as {
        |Which tier was released.
      }
    }
    ticketCount: Natural with {
      briefly "Available"
      described as {
        |Number of tickets available.
      }
    }
    salesUrl: URL with {
      briefly "URL"
      described as {
        |Link to purchase tickets.
      }
    }
  } with {
    briefly "Notify subscribers of ticket availability"
    described as {
      |Alerts interested buyers when tickets go on sale.
    }
  }
  command SendConfirmation is  {
    confirmationBuyerId: UUID with {
      briefly "Buyer"
      described as {
        |Who to send confirmation to.
      }
    }
    confirmationTicketId: UUID with {
      briefly "Ticket"
      described as {
        |The purchased ticket.
      }
    }
    eventName: String(1,200) with {
      briefly "Event"
      described as {
        |Event name.
      }
    }
    eventDate: DateTime with {
      briefly "Date"
      described as {
        |Event date.
      }
    }
    venueName: String(1,200) with {
      briefly "Venue"
      described as {
        |Venue name.
      }
    }
    seatInfo: String(1,100) with {
      briefly "Seat"
      described as {
        |Seat assignment details.
      }
    }
    confirmationNumber: String(1,50) with {
      briefly "Confirmation"
      described as {
        |Purchase confirmation number.
      }
    }
  } with {
    briefly "Send purchase confirmation"
    described as {
      |Sends email/SMS confirmation to buyer after purchase.
    }
  }
  command NotifyTransfer is  {
    recipientEmail: String(1,200) with {
      briefly "Recipient"
      described as {
        |Email of transfer recipient.
      }
    }
    senderName: String(1,100) with {
      briefly "Sender"
      described as {
        |Name of person who sent tickets.
      }
    }
    transferredTicketId: UUID with {
      briefly "Ticket"
      described as {
        |The transferred ticket.
      }
    }
    eventName: String(1,200) with {
      briefly "Event"
      described as {
        |Event name.
      }
    }
    eventDate: DateTime with {
      briefly "Date"
      described as {
        |Event date.
      }
    }
    claimUrl: URL with {
      briefly "Claim URL"
      described as {
        |Link for recipient to claim tickets.
      }
    }
  } with {
    briefly "Notify recipient of ticket transfer"
    described as {
      |Sends notification to someone receiving transferred tickets.
    }
  }
  event NotificationSent is  {
    recipientId: UUID with {
      briefly "Recipient"
      described as {
        |Who received the notification.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Type of notification sent.
      }
    }
    channel: String(1,20) with {
      briefly "Channel"
      described as {
        |Delivery channel (email, SMS, push).
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |When notification was sent.
      }
    }
  } with {
    briefly "Notification was sent"
    described as {
      |Emitted when a marketing notification is delivered.
    }
  }
  event CampaignTriggered is  {
    campaignId: UUID with {
      briefly "Campaign"
      described as {
        |Marketing campaign identifier.
      }
    }
    marketingEventId: UUID with {
      briefly "Event"
      described as {
        |Related event.
      }
    }
    campaignType: String(1,50) with {
      briefly "Type"
      described as {
        |Type of campaign triggered.
      }
    }
    audienceSize: Natural with {
      briefly "Audience"
      described as {
        |Number of recipients targeted.
      }
    }
    triggeredAt: TimeStamp with {
      briefly "Triggered"
      described as {
        |When campaign was triggered.
      }
    }
  } with {
    briefly "Marketing campaign was triggered"
    described as {
      |Emitted when an automated marketing campaign starts.
    }
  }
  handler MarketingHandler is {
    on command AnnounceEvent is {
      tell event CampaignTriggered to context MarketingService
    }
    on command NotifySubscribers is {
      tell event NotificationSent to context MarketingService
    }
    on command SendConfirmation is {
      tell event NotificationSent to context MarketingService
    }
    on command NotifyTransfer is {
      tell event NotificationSent to context MarketingService
    }
  } with {
    briefly "Handles marketing commands"
    described as {
      |Processes marketing notification and campaign requests.
    }
  }
} with {
  briefly "External marketing and communications service"
  option external()
  described as {
    | The MarketingService context represents an external marketing
    | automation system that handles email campaigns, SMS notifications,
    | push notifications, and subscriber management. It receives events
    | from ticket sales to trigger automated communications.
  }
}
