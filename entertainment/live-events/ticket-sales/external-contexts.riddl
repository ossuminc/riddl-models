// Ticket Sales - External Contexts
// These represent external systems that Ticket Sales integrates with

context PaymentGateway is {

  type PaymentAmount is Decimal(10, 2) with {
    briefly "Payment amount"
    described by "Monetary amount for payment processing."
  }

  command ProcessPayment is {
    ticketId is UUID with {
      briefly "Ticket reference"
      described by "The ticket being purchased."
    }
    buyerId is UUID with {
      briefly "Buyer"
      described by "Who is making the payment."
    }
    amount is PaymentAmount with {
      briefly "Amount"
      described by "Total amount to charge."
    }
    paymentMethod is String(1, 50) with {
      briefly "Payment method"
      described by "Type of payment (credit card, PayPal, etc.)."
    }
    paymentToken is String(1, 500) with {
      briefly "Payment token"
      described by "Tokenized payment credentials."
    }
  } with {
    briefly "Process a payment transaction"
    described by "Charges the buyer for a ticket purchase."
  }

  command RefundPayment is {
    transactionId is String(1, 100) with {
      briefly "Transaction ID"
      described by "Original payment transaction to refund."
    }
    amount is PaymentAmount with {
      briefly "Amount"
      described by "Amount to refund."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Reason for the refund."
    }
  } with {
    briefly "Refund a previous payment"
    described by "Returns funds to the buyer's original payment method."
  }

  event PaymentSucceeded is {
    transactionId is String(1, 100) with {
      briefly "Transaction ID"
      described by "Unique payment transaction identifier."
    }
    ticketId is UUID with {
      briefly "Ticket"
      described by "The ticket that was paid for."
    }
    amount is PaymentAmount with {
      briefly "Amount"
      described by "Amount charged."
    }
    processedAt is TimeStamp with {
      briefly "Processed"
      described by "When payment was processed."
    }
  } with {
    briefly "Payment was successfully processed"
    described by "Emitted when a payment charge succeeds."
  }

  event PaymentFailed is {
    ticketId is UUID with {
      briefly "Ticket"
      described by "The ticket payment failed for."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Why the payment failed."
    }
    failedAt is TimeStamp with {
      briefly "Failed"
      described by "When payment failed."
    }
  } with {
    briefly "Payment processing failed"
    described by "Emitted when a payment charge is declined or fails."
  }

  event RefundCompleted is {
    transactionId is String(1, 100) with {
      briefly "Transaction ID"
      described by "Original transaction that was refunded."
    }
    amount is PaymentAmount with {
      briefly "Amount"
      described by "Amount refunded."
    }
    refundedAt is TimeStamp with {
      briefly "Refunded"
      described by "When refund was processed."
    }
  } with {
    briefly "Refund was processed"
    described by "Emitted when a refund is successfully completed."
  }

  handler PaymentHandler is {
    on command ProcessPayment {
      tell event PaymentSucceeded to context PaymentGateway
    }
    on command RefundPayment {
      tell event RefundCompleted to context PaymentGateway
    }
  } with {
    briefly "Handles payment commands"
    described by "Processes payment and refund requests."
  }

} with {
  briefly "External payment processing service"
  option is external
  described by {
    | The PaymentGateway context represents an external payment processor
    | (e.g., Stripe, Square, PayPal) that handles credit card processing,
    | digital wallets, refunds, and payment validation for ticket purchases.
  }
}

context VenueManagement is {

  type VenueCapacity is Natural with {
    briefly "Venue capacity"
    described by "Maximum number of attendees for the venue."
  }

  command GetSeatingChart is {
    venueId is UUID with {
      briefly "Venue"
      described by "The venue to get seating for."
    }
  } with {
    briefly "Retrieve venue seating chart"
    described by "Gets the current seating configuration for a venue."
  }

  command ReserveVenue is {
    venueId is UUID with {
      briefly "Venue"
      described by "The venue to reserve."
    }
    eventDate is DateTime with {
      briefly "Date"
      described by "Date and time to reserve."
    }
    eventName is String(1, 200) with {
      briefly "Event name"
      described by "Name of the event."
    }
    expectedAttendance is Natural with {
      briefly "Expected attendance"
      described by "Anticipated number of attendees."
    }
  } with {
    briefly "Reserve a venue for an event"
    described by "Books the venue for a specific date and event."
  }

  event SeatingChartUpdated is {
    venueId is UUID with {
      briefly "Venue"
      described by "The venue that was updated."
    }
    totalSeats is Natural with {
      briefly "Total seats"
      described by "New total seat count."
    }
    sections is many {
      sectionName is String(1, 50) with {
        briefly "Section"
        described by "Section name."
      }
      seatCount is Natural with {
        briefly "Seats"
        described by "Number of seats in section."
      }
    } with {
      briefly "Sections"
      described by "Updated section information."
    }
    updatedAt is TimeStamp with {
      briefly "Updated"
      described by "When the chart was updated."
    }
  } with {
    briefly "Venue seating chart was updated"
    described by "Emitted when venue layout changes affect seat inventory."
  }

  event VenueCapacityChanged is {
    venueId is UUID with {
      briefly "Venue"
      described by "The venue with changed capacity."
    }
    previousCapacity is VenueCapacity with {
      briefly "Previous"
      described by "Previous capacity."
    }
    newCapacity is VenueCapacity with {
      briefly "New"
      described by "New capacity."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Why capacity changed."
    }
    changedAt is TimeStamp with {
      briefly "Changed"
      described by "When capacity changed."
    }
  } with {
    briefly "Venue capacity was changed"
    described by "Emitted when a venue's maximum capacity is adjusted."
  }

  event VenueReserved is {
    venueId is UUID with {
      briefly "Venue"
      described by "The reserved venue."
    }
    eventDate is DateTime with {
      briefly "Date"
      described by "Reserved date."
    }
    confirmationNumber is String(1, 50) with {
      briefly "Confirmation"
      described by "Venue reservation confirmation."
    }
    reservedAt is TimeStamp with {
      briefly "Reserved"
      described by "When reservation was made."
    }
  } with {
    briefly "Venue was reserved for an event"
    described by "Emitted when a venue booking is confirmed."
  }

  handler VenueHandler is {
    on command GetSeatingChart {
      tell event SeatingChartUpdated to context VenueManagement
    }
    on command ReserveVenue {
      tell event VenueReserved to context VenueManagement
    }
  } with {
    briefly "Handles venue commands"
    described by "Processes venue queries and reservations."
  }

} with {
  briefly "External venue management system"
  option is external
  described by {
    | The VenueManagement context represents an external system that
    | manages venue information including seating charts, capacity,
    | availability calendars, and booking confirmations. It provides
    | the physical seat inventory that drives ticket creation.
  }
}

context MarketingService is {

  command AnnounceEvent is {
    eventId is UUID with {
      briefly "Event"
      described by "The event to announce."
    }
    eventName is String(1, 200) with {
      briefly "Name"
      described by "Event name for announcement."
    }
    eventDate is DateTime with {
      briefly "Date"
      described by "Event date."
    }
    venueName is String(1, 200) with {
      briefly "Venue"
      described by "Venue name."
    }
    description is String(1, 2000) with {
      briefly "Description"
      described by "Event description for marketing."
    }
    imageUrl is optional URL with {
      briefly "Image"
      described by "Event promotional image."
    }
  } with {
    briefly "Announce a new event"
    described by "Triggers marketing announcement for a new event."
  }

  command NotifySubscribers is {
    eventId is UUID with {
      briefly "Event"
      described by "Event tickets are available for."
    }
    eventName is String(1, 200) with {
      briefly "Name"
      described by "Event name."
    }
    tierName is String(1, 50) with {
      briefly "Tier"
      described by "Which tier was released."
    }
    ticketCount is Natural with {
      briefly "Available"
      described by "Number of tickets available."
    }
    salesUrl is URL with {
      briefly "URL"
      described by "Link to purchase tickets."
    }
  } with {
    briefly "Notify subscribers of ticket availability"
    described by "Alerts interested buyers when tickets go on sale."
  }

  command SendConfirmation is {
    buyerId is UUID with {
      briefly "Buyer"
      described by "Who to send confirmation to."
    }
    ticketId is UUID with {
      briefly "Ticket"
      described by "The purchased ticket."
    }
    eventName is String(1, 200) with {
      briefly "Event"
      described by "Event name."
    }
    eventDate is DateTime with {
      briefly "Date"
      described by "Event date."
    }
    venueName is String(1, 200) with {
      briefly "Venue"
      described by "Venue name."
    }
    seatInfo is String(1, 100) with {
      briefly "Seat"
      described by "Seat assignment details."
    }
    confirmationNumber is String(1, 50) with {
      briefly "Confirmation"
      described by "Purchase confirmation number."
    }
  } with {
    briefly "Send purchase confirmation"
    described by "Sends email/SMS confirmation to buyer after purchase."
  }

  command NotifyTransfer is {
    recipientEmail is String(1, 200) with {
      briefly "Recipient"
      described by "Email of transfer recipient."
    }
    senderName is String(1, 100) with {
      briefly "Sender"
      described by "Name of person who sent tickets."
    }
    ticketId is UUID with {
      briefly "Ticket"
      described by "The transferred ticket."
    }
    eventName is String(1, 200) with {
      briefly "Event"
      described by "Event name."
    }
    eventDate is DateTime with {
      briefly "Date"
      described by "Event date."
    }
    claimUrl is URL with {
      briefly "Claim URL"
      described by "Link for recipient to claim tickets."
    }
  } with {
    briefly "Notify recipient of ticket transfer"
    described by "Sends notification to someone receiving transferred tickets."
  }

  event NotificationSent is {
    recipientId is UUID with {
      briefly "Recipient"
      described by "Who received the notification."
    }
    notificationType is String(1, 50) with {
      briefly "Type"
      described by "Type of notification sent."
    }
    channel is String(1, 20) with {
      briefly "Channel"
      described by "Delivery channel (email, SMS, push)."
    }
    sentAt is TimeStamp with {
      briefly "Sent"
      described by "When notification was sent."
    }
  } with {
    briefly "Notification was sent"
    described by "Emitted when a marketing notification is delivered."
  }

  event CampaignTriggered is {
    campaignId is UUID with {
      briefly "Campaign"
      described by "Marketing campaign identifier."
    }
    eventId is UUID with {
      briefly "Event"
      described by "Related event."
    }
    campaignType is String(1, 50) with {
      briefly "Type"
      described by "Type of campaign triggered."
    }
    audienceSize is Natural with {
      briefly "Audience"
      described by "Number of recipients targeted."
    }
    triggeredAt is TimeStamp with {
      briefly "Triggered"
      described by "When campaign was triggered."
    }
  } with {
    briefly "Marketing campaign was triggered"
    described by "Emitted when an automated marketing campaign starts."
  }

  handler MarketingHandler is {
    on command AnnounceEvent {
      tell event CampaignTriggered to context MarketingService
    }
    on command NotifySubscribers {
      tell event NotificationSent to context MarketingService
    }
    on command SendConfirmation {
      tell event NotificationSent to context MarketingService
    }
    on command NotifyTransfer {
      tell event NotificationSent to context MarketingService
    }
  } with {
    briefly "Handles marketing commands"
    described by "Processes marketing notification and campaign requests."
  }

} with {
  briefly "External marketing and communications service"
  option is external
  described by {
    | The MarketingService context represents an external marketing
    | automation system that handles email campaigns, SMS notifications,
    | push notifications, and subscriber management. It receives events
    | from ticket sales to trigger automated communications.
  }
}
