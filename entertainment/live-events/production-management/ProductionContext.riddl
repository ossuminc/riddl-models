// Production Management - Production Context
context ProductionContext is {
  include "types.riddl"
  include "Production.riddl"
  repository ProductionRepository is {
    schema ProductionData is relational
      of productions as type Production
        index on field Production.productionId
        index on field Production.productionInfo.venueId
        index on field Production.status

    handler ProductionPersistence is {
      on command Production.CreateProduction is {
        prompt "Store new production"
      }
      on command Production.AssignCrew is {
        prompt "Store crew assignment"
      }
      on command Production.AllocateEquipment is {
        prompt "Store equipment allocation"
      }
      on command Production.ScheduleRehearsal is {
        prompt "Store rehearsal schedule"
      }
      on command Production.CompleteRehearsal is {
        prompt "Update rehearsal to completed"
      }
      on command Production.CompleteShow is {
        prompt "Update production to completed"
      }
    } with {
      briefly "Persists production commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Production data persistence"
    described as {
      |Persistent storage for productions.
    }
  }
  projector ProductionMetrics is {
    record EventMetrics is  {
      productionsCreated: Natural with {
        briefly "Created"
        described as {
          |Productions created.
        }
      }
      productionsCompleted: Natural with {
        briefly "Completed"
        described as {
          |Productions completed.
        }
      }
      productionsCancelled: Natural with {
        briefly "Cancelled"
        described as {
          |Productions cancelled.
        }
      }
      totalAttendance: Natural with {
        briefly "Attendance"
        described as {
          |Total audience attendance.
        }
      }
      averageCrewSize: Decimal(8,2) with {
        briefly "Avg crew"
        described as {
          |Average crew size per production.
        }
      }
    } with {
      briefly "Event metrics"
      described as {
        |Production event metrics.
      }
    }
    handler MetricsHandler is {
      on event Production.ProductionCreated is {
        prompt "Increment productions created"
      }
      on event Production.ShowCompleted is {
        prompt "Increment productions completed and add attendance"
      }
      on event Production.ProductionCancelled is {
        prompt "Increment productions cancelled"
      }
    } with {
      briefly "Maintains production metrics"
      described as {
        |Projects events into metrics.
      }
    }
  } with {
    briefly "Production metrics"
    described as {
      |Production management analytics.
    }
  }
} with {
  briefly "Bounded context for production management"
  described as {
    |Live event production management context.
  }
}
