// Production Management - Production Context

context ProductionContext is {

  include "types.riddl"
  include "Production.riddl"

  repository ProductionRepository is {
    schema ProductionData is relational
      of productions as Production
      index on field Production.productionId
      index on field Production.productionInfo.venueId
      index on field Production.status

    handler ProductionPersistence is {
      on command Production.CreateProduction {
        prompt "Store new production"
      }
      on command Production.AssignCrew {
        prompt "Store crew assignment"
      }
      on command Production.AllocateEquipment {
        prompt "Store equipment allocation"
      }
      on command Production.ScheduleRehearsal {
        prompt "Store rehearsal schedule"
      }
      on command Production.CompleteRehearsal {
        prompt "Update rehearsal to completed"
      }
      on command Production.CompleteShow {
        prompt "Update production to completed"
      }
    } with {
      briefly "Persists production commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Production data persistence"
    described by "Persistent storage for productions."
  }

  projector ProductionMetrics is {
    updates repository ProductionRepository

    record EventMetrics is {
      productionsCreated is Natural with { briefly "Created" described by "Productions created." }
      productionsCompleted is Natural with { briefly "Completed" described by "Productions completed." }
      productionsCancelled is Natural with { briefly "Cancelled" described by "Productions cancelled." }
      totalAttendance is Natural with { briefly "Attendance" described by "Total audience attendance." }
      averageCrewSize is Decimal(8, 2) with { briefly "Avg crew" described by "Average crew size per production." }
    } with {
      briefly "Event metrics"
      described by "Production event metrics."
    }

    handler MetricsHandler is {
      on event Production.ProductionCreated {
        prompt "Increment productions created"
      }
      on event Production.ShowCompleted {
        prompt "Increment productions completed and add attendance"
      }
      on event Production.ProductionCancelled {
        prompt "Increment productions cancelled"
      }
    } with {
      briefly "Maintains production metrics"
      described by "Projects events into metrics."
    }
  } with {
    briefly "Production metrics"
    described by "Production management analytics."
  }

} with {
  briefly "Bounded context for production management"
  described by "Live event production management context."
}
