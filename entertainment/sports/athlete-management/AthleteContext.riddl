// Athlete Management - Athlete Context
context AthleteContext is {
  include "types.riddl"
  include "Athlete.riddl"
  repository AthleteRepository is {
    schema AthleteData is relational
      of athletes as type Athlete
        index on field Athlete.athleteId
        index on field Athlete.teamId
        index on field Athlete.status

    handler AthletePersistence is {
      on command Athlete.RegisterAthlete is {
        prompt "Store new athlete record"
      }
      on command Athlete.SignContract is {
        prompt "Update athlete contract"
      }
      on command Athlete.RecordInjury is {
        prompt "Store injury record"
      }
      on command Athlete.ClearInjury is {
        prompt "Update injury as cleared"
      }
      on command Athlete.RecordPerformance is {
        prompt "Store performance statistics"
      }
      on command Athlete.TransferAthlete is {
        prompt "Update athlete team assignment"
      }
      on command Athlete.RetireAthlete is {
        prompt "Update athlete to retired"
      }
    } with {
      briefly "Persists athlete commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Athlete data persistence"
    described as {
      |Persistent storage for athlete records.
    }
  }
  projector AthleteMetrics is {
    record RosterMetrics is  {
      totalAthletes: Natural with {
        briefly "Total"
        described as {
          |Total athletes.
        }
      }
      activeAthletes: Natural with {
        briefly "Active"
        described as {
          |Active athletes.
        }
      }
      injuredAthletes: Natural with {
        briefly "Injured"
        described as {
          |Injured athletes.
        }
      }
      averagePerformanceRating: Decimal(4,2) with {
        briefly "Avg rating"
        described as {
          |Average performance rating.
        }
      }
    } with {
      briefly "Roster metrics"
      described as {
        |Team roster analytics.
      }
    }
    handler MetricsHandler is {
      on event Athlete.AthleteRegistered is {
        prompt "Increment total and active athletes"
      }
      on event Athlete.InjuryRecorded is {
        prompt "Increment injured athletes count"
      }
      on event Athlete.InjuryCleared is {
        prompt "Decrement injured athletes count"
      }
      on event Athlete.PerformanceRecorded is {
        prompt "Update average performance rating"
      }
      on event Athlete.AthleteRetired is {
        prompt "Decrement active athletes count"
      }
    } with {
      briefly "Maintains athlete metrics"
      described as {
        |Projects events into roster metrics.
      }
    }
  } with {
    briefly "Athlete metrics"
    described as {
      |Athlete and roster analytics.
    }
  }
} with {
  briefly "Bounded context for athlete management"
  described as {
    |Athlete management bounded context.
  }
}
