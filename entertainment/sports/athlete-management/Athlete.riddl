// Athlete Management - Athlete Entity

entity Athlete is {

  command RegisterAthlete is {
    athleteId is AthleteId with {
      briefly "Athlete ID"
      described by "New athlete identifier."
    }
    profile is AthleteProfile with {
      briefly "Profile"
      described by "Athlete profile details."
    }
    teamId is TeamId with {
      briefly "Team"
      described by "Initial team assignment."
    }
  } with {
    briefly "Register athlete"
    described by "Registers a new athlete in the system."
  }

  command SignContract is {
    athleteId is AthleteId with {
      briefly "Athlete ID"
      described by "Athlete identifier."
    }
    contract is ContractInfo with {
      briefly "Contract"
      described by "Contract details."
    }
  } with {
    briefly "Sign contract"
    described by "Signs a contract for the athlete."
  }

  command RecordInjury is {
    athleteId is AthleteId with {
      briefly "Athlete ID"
      described by "Athlete identifier."
    }
    injury is InjuryRecord with {
      briefly "Injury"
      described by "Injury details."
    }
  } with {
    briefly "Record injury"
    described by "Records an injury for the athlete."
  }

  command ClearInjury is {
    athleteId is AthleteId with {
      briefly "Athlete ID"
      described by "Athlete identifier."
    }
    injuryId is InjuryId with {
      briefly "Injury ID"
      described by "Injury to clear."
    }
    clearedOn is Date with {
      briefly "Cleared on"
      described by "Date cleared to play."
    }
  } with {
    briefly "Clear injury"
    described by "Clears an athlete from injury status."
  }

  command RecordPerformance is {
    athleteId is AthleteId with {
      briefly "Athlete ID"
      described by "Athlete identifier."
    }
    stat is PerformanceStat with {
      briefly "Stat"
      described by "Performance statistics."
    }
  } with {
    briefly "Record performance"
    described by "Records game performance statistics."
  }

  command AssignTrainingProgram is {
    athleteId is AthleteId with {
      briefly "Athlete ID"
      described by "Athlete identifier."
    }
    program is TrainingProgram with {
      briefly "Program"
      described by "Training program details."
    }
  } with {
    briefly "Assign training program"
    described by "Assigns a training program to the athlete."
  }

  command TransferAthlete is {
    athleteId is AthleteId with {
      briefly "Athlete ID"
      described by "Athlete identifier."
    }
    newTeamId is TeamId with {
      briefly "New team"
      described by "Destination team."
    }
    transferDate is Date with {
      briefly "Transfer date"
      described by "Date of transfer."
    }
    transferFee is optional Decimal(12, 2) with {
      briefly "Fee"
      described by "Transfer fee if applicable."
    }
  } with {
    briefly "Transfer athlete"
    described by "Transfers athlete to another team."
  }

  command SuspendAthlete is {
    athleteId is AthleteId with {
      briefly "Athlete ID"
      described by "Athlete identifier."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Suspension reason."
    }
    suspendedUntil is optional Date with {
      briefly "Until"
      described by "Suspension end date."
    }
  } with {
    briefly "Suspend athlete"
    described by "Suspends athlete from competition."
  }

  command RetireAthlete is {
    athleteId is AthleteId with {
      briefly "Athlete ID"
      described by "Athlete identifier."
    }
    retirementDate is Date with {
      briefly "Retirement date"
      described by "Date of retirement."
    }
  } with {
    briefly "Retire athlete"
    described by "Retires athlete from active competition."
  }

  // Events
  event AthleteRegistered is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    profile is AthleteProfile with { briefly "Profile" described by "Athlete profile." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Athlete registered"
    described by "Emitted when an athlete is registered."
  }

  event ContractSigned is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    contract is ContractInfo with { briefly "Contract" described by "Contract details." }
    signedAt is TimeStamp with { briefly "Signed" described by "Signing time." }
  } with {
    briefly "Contract signed"
    described by "Emitted when a contract is signed."
  }

  event InjuryRecorded is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    injury is InjuryRecord with { briefly "Injury" described by "Injury details." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Injury recorded"
    described by "Emitted when an injury is recorded."
  }

  event InjuryCleared is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    injuryId is InjuryId with { briefly "Injury" described by "Injury ID." }
    clearedAt is TimeStamp with { briefly "Cleared" described by "Clearance time." }
  } with {
    briefly "Injury cleared"
    described by "Emitted when an athlete is cleared from injury."
  }

  event PerformanceRecorded is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    stat is PerformanceStat with { briefly "Stat" described by "Performance data." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Performance recorded"
    described by "Emitted when performance statistics are recorded."
  }

  event TrainingProgramAssigned is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    program is TrainingProgram with { briefly "Program" described by "Training program." }
    assignedAt is TimeStamp with { briefly "Assigned" described by "Assignment time." }
  } with {
    briefly "Training program assigned"
    described by "Emitted when a training program is assigned."
  }

  event AthleteTransferred is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    newTeamId is TeamId with { briefly "New team" described by "Destination team." }
    transferredAt is TimeStamp with { briefly "Transferred" described by "Transfer time." }
  } with {
    briefly "Athlete transferred"
    described by "Emitted when an athlete is transferred."
  }

  event AthleteSuspended is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Suspension reason." }
    suspendedAt is TimeStamp with { briefly "Suspended" described by "Suspension time." }
  } with {
    briefly "Athlete suspended"
    described by "Emitted when an athlete is suspended."
  }

  event AthleteRetired is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    retiredAt is TimeStamp with { briefly "Retired" described by "Retirement time." }
  } with {
    briefly "Athlete retired"
    described by "Emitted when an athlete retires."
  }

  // States
  record ActiveStateData is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    profile is AthleteProfile with { briefly "Profile" described by "Athlete profile." }
    teamId is TeamId with { briefly "Team" described by "Current team." }
    athleteStatus is AthleteStatus with { briefly "Status" described by "Athlete status." }
    currentContract is optional ContractInfo with { briefly "Contract" described by "Current contract." }
    injuries is many optional InjuryRecord with { briefly "Injuries" described by "Injury history." }
    performanceStats is many optional PerformanceStat with { briefly "Stats" described by "Performance history." }
    trainingPrograms is many optional TrainingProgram with { briefly "Programs" described by "Training programs." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Active athlete state"
    described by "State for an active athlete."
  }

  record RetiredStateData is {
    athleteId is AthleteId with { briefly "Athlete" described by "Athlete ID." }
    profile is AthleteProfile with { briefly "Profile" described by "Athlete profile." }
    retiredAt is TimeStamp with { briefly "Retired" described by "Retirement time." }
    careerStats is many optional PerformanceStat with { briefly "Career stats" described by "Career statistics." }
  } with {
    briefly "Retired athlete state"
    described by "State for a retired athlete."
  }

  state ActiveState of Athlete.ActiveStateData with {
    briefly "Athlete active"
    described by "Athlete is actively managed."
  }

  state RetiredState of Athlete.RetiredStateData with {
    briefly "Athlete retired"
    described by "Athlete has retired from competition."
  }

  handler AthleteHandler is {
    on command RegisterAthlete {
      morph entity AthleteContext.Athlete to state AthleteContext.Athlete.ActiveState with command RegisterAthlete
      tell event AthleteRegistered to entity AthleteContext.Athlete
    }
    on command SignContract {
      tell event ContractSigned to entity AthleteContext.Athlete
    }
    on command RecordInjury {
      tell event InjuryRecorded to entity AthleteContext.Athlete
    }
    on command ClearInjury {
      tell event InjuryCleared to entity AthleteContext.Athlete
    }
    on command RecordPerformance {
      tell event PerformanceRecorded to entity AthleteContext.Athlete
    }
    on command AssignTrainingProgram {
      tell event TrainingProgramAssigned to entity AthleteContext.Athlete
    }
    on command TransferAthlete {
      tell event AthleteTransferred to entity AthleteContext.Athlete
    }
    on command SuspendAthlete {
      tell event AthleteSuspended to entity AthleteContext.Athlete
    }
    on command RetireAthlete {
      morph entity AthleteContext.Athlete to state AthleteContext.Athlete.RetiredState with command RetireAthlete
      tell event AthleteRetired to entity AthleteContext.Athlete
    }
  } with {
    briefly "Processes athlete commands"
    described by "Handles athlete lifecycle commands."
  }

} with {
  briefly "Athlete aggregate"
  described by "Manages sports athlete profiles and lifecycle."
}
