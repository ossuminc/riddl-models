// Player entity for Team Management domain

entity Player is {

  // Commands
  command SignPlayer is {
    playerId is PlayerId with {
      briefly "Player to sign"
      described by "Identifier of the player being signed."
    }
    playerInfo is PlayerInfo with {
      briefly "Player information"
      described by "Biographical and physical information about the player."
    }
    contract is ContractInfo with {
      briefly "Contract terms"
      described by "Financial terms of the contract being offered."
    }
    teamId is TeamId with {
      briefly "Signing team"
      described by "Team that is signing the player."
    }
  } with {
    briefly "Sign a new player to the team"
    described by {
      | Initiates the signing of a player including their biographical
      | information and contract terms. Requires salary cap validation.
    }
  }

  command AssignToRoster is {
    playerId is PlayerId with {
      briefly "Player to assign"
      described by "Identifier of the player being assigned."
    }
    position is String(1, 20) with {
      briefly "Roster position"
      described by "Position the player will occupy on the roster."
    }
    jerseyNumber is Integer with {
      briefly "Jersey number"
      described by "Number to be worn by the player."
    }
    status is PlayerStatus with {
      briefly "Initial status"
      described by "Initial roster status for the player."
    }
  } with {
    briefly "Assign player to active roster slot"
    described by {
      | Places a signed player onto the active roster at a specific
      | position with their jersey number and initial status.
    }
  }

  command ExtendContract is {
    playerId is PlayerId with {
      briefly "Player to extend"
      described by "Identifier of the player whose contract is being extended."
    }
    newEndDate is Date with {
      briefly "New end date"
      described by "New contract expiration date."
    }
    additionalValue is Decimal(12, 2) with {
      briefly "Additional value"
      described by "Additional monetary value being added to the contract."
    }
    newAnnualSalary is Decimal(12, 2) with {
      briefly "New annual salary"
      described by "Updated annual salary for the extension years."
    }
  } with {
    briefly "Extend an existing player contract"
    described by {
      | Modifies an existing contract to extend the duration and
      | adjust compensation. Subject to salary cap approval.
    }
  }

  command TradePlayer is {
    playerId is PlayerId with {
      briefly "Player being traded"
      described by "Identifier of the player being traded."
    }
    tradeInfo is TradeInfo with {
      briefly "Trade details"
      described by "Complete details of the trade transaction."
    }
  } with {
    briefly "Trade player to another team"
    described by {
      | Initiates a trade transaction moving the player to another
      | team as part of a larger trade package.
    }
  }

  command ReleasePlayer is {
    playerId is PlayerId with {
      briefly "Player to release"
      described by "Identifier of the player being released."
    }
    releaseDate is Date with {
      briefly "Release date"
      described by "Effective date of the release."
    }
    reason is String(1, 500) with {
      briefly "Release reason"
      described by "Explanation for the release decision."
    }
  } with {
    briefly "Release player from the team"
    described by {
      | Terminates the player's association with the team, making
      | them a free agent. May have salary cap implications for guaranteed money.
    }
  }

  command PlaceOnInjuredReserve is {
    playerId is PlayerId with {
      briefly "Injured player"
      described by "Identifier of the player being placed on IR."
    }
    injuryDescription is String(1, 500) with {
      briefly "Injury description"
      described by "Description of the injury requiring IR placement."
    }
    expectedReturnDate is optional Date with {
      briefly "Expected return"
      described by "Estimated date the player may return to action."
    }
  } with {
    briefly "Place player on injured reserve"
    described by {
      | Moves the player to injured reserve status, opening a roster
      | spot but making them ineligible to play for a designated period.
    }
  }

  // Events
  event PlayerSigned is {
    playerId is PlayerId with {
      briefly "Signed player"
      described by "Identifier of the player who was signed."
    }
    playerInfo is PlayerInfo with {
      briefly "Player information"
      described by "Biographical information of the signed player."
    }
    contract is ContractInfo with {
      briefly "Contract terms"
      described by "Terms of the executed contract."
    }
    teamId is TeamId with {
      briefly "Signing team"
      described by "Team that signed the player."
    }
    signedAt is TimeStamp with {
      briefly "Signing timestamp"
      described by "When the signing was recorded."
    }
  } with {
    briefly "Player has been signed to a contract"
    described by {
      | Records the successful signing of a player including all
      | contract details and the timestamp of the transaction.
    }
  }

  event PlayerAssignedToRoster is {
    playerId is PlayerId with {
      briefly "Assigned player"
      described by "Identifier of the player assigned to roster."
    }
    position is String(1, 20) with {
      briefly "Assigned position"
      described by "Position the player was assigned to."
    }
    jerseyNumber is Integer with {
      briefly "Jersey number"
      described by "Jersey number assigned to the player."
    }
    status is PlayerStatus with {
      briefly "Roster status"
      described by "Status assigned to the player."
    }
    assignedAt is TimeStamp with {
      briefly "Assignment timestamp"
      described by "When the assignment was recorded."
    }
  } with {
    briefly "Player assigned to roster position"
    described by {
      | Records the assignment of a player to a specific roster
      | slot with their designated position and jersey number.
    }
  }

  event ContractExtended is {
    playerId is PlayerId with {
      briefly "Extended player"
      described by "Identifier of the player whose contract was extended."
    }
    contractId is ContractId with {
      briefly "Contract identifier"
      described by "Identifier of the extended contract."
    }
    newEndDate is Date with {
      briefly "New end date"
      described by "New contract expiration date."
    }
    newTotalValue is Decimal(12, 2) with {
      briefly "New total value"
      described by "Updated total contract value."
    }
    extendedAt is TimeStamp with {
      briefly "Extension timestamp"
      described by "When the extension was recorded."
    }
  } with {
    briefly "Player contract has been extended"
    described by {
      | Records the successful extension of a player's contract
      | with updated terms and duration.
    }
  }

  event PlayerTraded is {
    playerId is PlayerId with {
      briefly "Traded player"
      described by "Identifier of the player who was traded."
    }
    tradeInfo is TradeInfo with {
      briefly "Trade details"
      described by "Details of the completed trade."
    }
    tradedAt is TimeStamp with {
      briefly "Trade timestamp"
      described by "When the trade was recorded."
    }
  } with {
    briefly "Player has been traded"
    described by {
      | Records the completion of a trade transaction, indicating
      | the player has moved to a new team.
    }
  }

  event PlayerReleased is {
    playerId is PlayerId with {
      briefly "Released player"
      described by "Identifier of the player who was released."
    }
    releaseDate is Date with {
      briefly "Release date"
      described by "Effective date of the release."
    }
    reason is String(1, 500) with {
      briefly "Release reason"
      described by "Reason for the release."
    }
    releasedAt is TimeStamp with {
      briefly "Release timestamp"
      described by "When the release was recorded."
    }
  } with {
    briefly "Player has been released"
    described by {
      | Records the release of a player from the team roster,
      | making them available as a free agent.
    }
  }

  event PlayerPlacedOnInjuredReserve is {
    playerId is PlayerId with {
      briefly "IR player"
      described by "Identifier of the player placed on IR."
    }
    injuryDescription is String(1, 500) with {
      briefly "Injury description"
      described by "Description of the injury."
    }
    expectedReturnDate is optional Date with {
      briefly "Expected return"
      described by "Estimated return date if known."
    }
    placedAt is TimeStamp with {
      briefly "IR timestamp"
      described by "When the IR placement was recorded."
    }
  } with {
    briefly "Player placed on injured reserve"
    described by {
      | Records the placement of a player on injured reserve
      | including injury details and expected recovery timeline.
    }
  }

  // State Records
  record UnsignedStateData is {
    playerId is PlayerId with { briefly "Player ID" described by "Identifier for unsigned player." }
    initialPlayerInfo is optional PlayerInfo with { briefly "Player info" described by "Biographical info if known." }
  } with {
    briefly "Data for unsigned player state"
    described by "Contains data for a player not under contract."
  }

  record SignedStateData is {
    playerId is PlayerId with { briefly "Player ID" described by "Identifier for signed player." }
    playerInfo is PlayerInfo with { briefly "Player info" described by "Biographical information." }
    contract is ContractInfo with { briefly "Contract" described by "Current contract terms." }
    teamId is TeamId with { briefly "Team" described by "Team the player is signed with." }
    rosterSlot is optional RosterSlot with { briefly "Roster slot" described by "Current roster assignment." }
  } with {
    briefly "Data for signed player state"
    described by "Contains data for a player under contract."
  }

  record InjuredReserveStateData is {
    playerId is PlayerId with { briefly "Player ID" described by "Identifier for injured player." }
    playerInfo is PlayerInfo with { briefly "Player info" described by "Biographical information." }
    contract is ContractInfo with { briefly "Contract" described by "Current contract terms." }
    teamId is TeamId with { briefly "Team" described by "Team the player is signed with." }
    injuryDescription is String(1, 500) with { briefly "Injury" described by "Description of injury." }
    expectedReturnDate is optional Date with { briefly "Expected return" described by "Estimated return date." }
    placedOnIRDate is Date with { briefly "IR date" described by "Date placed on IR." }
  } with {
    briefly "Data for injured reserve state"
    described by "Contains data for a player on injured reserve."
  }

  record ReleasedStateData is {
    playerId is PlayerId with { briefly "Player ID" described by "Identifier for released player." }
    playerInfo is PlayerInfo with { briefly "Player info" described by "Biographical information." }
    previousTeamId is TeamId with { briefly "Previous team" described by "Team that released player." }
    releaseDate is Date with { briefly "Release date" described by "Date of release." }
    reason is String(1, 500) with { briefly "Reason" described by "Reason for release." }
  } with {
    briefly "Data for released player state"
    described by "Contains data for a recently released player."
  }

  // States
  state UnsignedState of Player.UnsignedStateData with {
    briefly "Player not currently signed to any team"
    described by {
      | Initial state for a player not under contract. May have
      | biographical info if previously in the league.
    }
  }

  state SignedState of Player.SignedStateData with {
    briefly "Player is signed and potentially rostered"
    described by {
      | Active state when player has a valid contract. May or may
      | not be assigned to an active roster slot.
    }
  }

  state InjuredReserveState of Player.InjuredReserveStateData with {
    briefly "Player is on injured reserve"
    described by {
      | Player remains under contract but is on injured reserve,
      | ineligible to play until cleared by medical staff.
    }
  }

  state ReleasedState of Player.ReleasedStateData with {
    briefly "Player has been released and is now a free agent"
    described by {
      | Transitional state after release. Player retains history
      | but is available to sign with any team.
    }
  }

  // Handler
  handler PlayerHandler is {
    on command SignPlayer {
      morph entity Player to state Player.SignedState with command SignPlayer
      tell event PlayerSigned to entity Player
    }
    on command AssignToRoster {
      tell event PlayerAssignedToRoster to entity Player
    }
    on command ExtendContract {
      tell event ContractExtended to entity Player
    }
    on command TradePlayer {
      morph entity Player to state Player.SignedState with command TradePlayer
      tell event PlayerTraded to entity Player
    }
    on command ReleasePlayer {
      morph entity Player to state Player.ReleasedState with command ReleasePlayer
      tell event PlayerReleased to entity Player
    }
    on command PlaceOnInjuredReserve {
      morph entity Player to state Player.InjuredReserveState with command PlaceOnInjuredReserve
      tell event PlayerPlacedOnInjuredReserve to entity Player
    }
  } with {
    briefly "Handles player lifecycle commands"
    described by {
      | Processes all player-related commands, validating against
      | salary cap and league rules before recording events.
    }
  }

} with {
  option is aggregate
  briefly "Represents a player in the team management system"
  described by {
    | The Player entity manages the complete lifecycle of a professional
    | athlete from signing through release or retirement. It tracks
    | contracts, roster assignments, injuries, and trades while ensuring
    | compliance with league rules and salary cap constraints.
  }
}
