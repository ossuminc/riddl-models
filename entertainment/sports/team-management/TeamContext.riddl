// Team Management bounded context

context TeamContext is {

  include "types.riddl"
  include "Player.riddl"
  include "external-contexts.riddl"

  // Team entity for managing team-level operations
  entity Team is {

    command CreateTeam is {
      teamId is TeamId with {
        briefly "Team identifier"
        described by "Unique identifier for the new team."
      }
      name is String(1, 100) with {
        briefly "Team name"
        described by "Official name of the team."
      }
      city is String(1, 50) with {
        briefly "City"
        described by "City where the team is based."
      }
      conference is String(1, 50) with {
        briefly "Conference"
        described by "League conference the team belongs to."
      }
      division is String(1, 50) with {
        briefly "Division"
        described by "Division within the conference."
      }
    } with {
      briefly "Create a new team in the system"
      described by {
        | Initializes a new franchise with basic identifying information
        | including geographic and league organizational details.
      }
    }

    event TeamCreated is {
      teamId is TeamId with {
        briefly "Team identifier"
        described by "Identifier of the created team."
      }
      name is String(1, 100) with {
        briefly "Team name"
        described by "Name of the created team."
      }
      city is String(1, 50) with {
        briefly "City"
        described by "City where the team is based."
      }
      conference is String(1, 50) with {
        briefly "Conference"
        described by "Conference assignment."
      }
      division is String(1, 50) with {
        briefly "Division"
        described by "Division assignment."
      }
      createdAt is TimeStamp with {
        briefly "Creation timestamp"
        described by "When the team was created."
      }
    } with {
      briefly "Team has been created"
      described by {
        | Records the creation of a new team entity in the system.
      }
    }

    record ActiveTeamData is {
      teamId is TeamId with { briefly "Team ID" described by "Unique team identifier." }
      name is String(1, 100) with { briefly "Name" described by "Official team name." }
      city is String(1, 50) with { briefly "City" described by "Team's home city." }
      conference is String(1, 50) with { briefly "Conference" described by "League conference." }
      division is String(1, 50) with { briefly "Division" described by "Conference division." }
      rosterSize is Integer with { briefly "Roster size" described by "Current player count." }
      salaryCap is Decimal(12, 2) with { briefly "Salary cap" described by "Maximum payroll." }
      currentPayroll is Decimal(12, 2) with { briefly "Payroll" described by "Current payroll." }
    } with {
      briefly "Active team state data"
      described by "Data for an active team in the league."
    }

    state ActiveTeam of Team.ActiveTeamData with {
      briefly "An active team in the league"
      described by {
        | Represents a functioning franchise with roster and
        | salary cap tracking capabilities.
      }
    }

    handler TeamHandler is {
      on command CreateTeam {
        tell event TeamCreated to entity Team
      }
    } with {
      briefly "Handles team management commands"
      described by {
        | Processes team-level commands for franchise operations.
      }
    }

  } with {
    option is aggregate
    briefly "Represents a professional sports team"
    described by {
      | Manages team identity, roster limits, and salary cap tracking
      | for a franchise within the league.
    }
  }

  // Repository for player data persistence
  repository PlayerRepository is {
    query GetPlayerById is {
      playerId is PlayerId with {
        briefly "Player to retrieve"
        described by "Identifier of the player to look up."
      }
    } with {
      briefly "Retrieve player by unique identifier"
      described by {
        | Fetches complete player record including current status,
        | contract, and roster assignment.
      }
    }

    query GetPlayersByTeam is {
      teamId is TeamId with {
        briefly "Team to query"
        described by "Identifier of the team whose roster to retrieve."
      }
    } with {
      briefly "Retrieve all players for a team"
      described by {
        | Returns the complete roster of players currently signed
        | to the specified team.
      }
    }

    query GetPlayersByStatus is {
      teamId is TeamId with {
        briefly "Team to query"
        described by "Identifier of the team to filter."
      }
      status is PlayerStatus with {
        briefly "Status filter"
        described by "Status to filter players by."
      }
    } with {
      briefly "Retrieve players by roster status"
      described by {
        | Filters team roster by status such as Active, InjuredReserve,
        | or PracticeSquad.
      }
    }

    query GetFreeAgents is {
      positionFilter is optional String(1, 20) with {
        briefly "Position filter"
        described by "Optional position to filter free agents."
      }
    } with {
      briefly "Retrieve available free agents"
      described by {
        | Returns players not currently under contract, optionally
        | filtered by position.
      }
    }

    result PlayerRecord is {
      playerId is PlayerId with {
        briefly "Player identifier"
        described by "Unique identifier for the player."
      }
      playerInfo is PlayerInfo with {
        briefly "Player information"
        described by "Biographical data for the player."
      }
      currentContract is optional ContractInfo with {
        briefly "Contract information"
        described by "Current contract if signed."
      }
      currentTeamId is optional TeamId with {
        briefly "Current team"
        described by "Team the player is signed with if any."
      }
      status is PlayerStatus with {
        briefly "Player status"
        described by "Current roster status."
      }
      rosterSlot is optional RosterSlot with {
        briefly "Roster slot"
        described by "Current roster assignment if any."
      }
    } with {
      briefly "Complete player data record"
      described by {
        | Full player information including biographical data,
        | contract terms, team assignment, and current status.
      }
    }

    result PlayerList is {
      players is many PlayerRecord with {
        briefly "Player records"
        described by "Collection of player records matching the query."
      }
    } with {
      briefly "Collection of player records"
      described by {
        | List of player records for roster queries.
      }
    }

  } with {
    briefly "Persistence layer for player data"
    described by {
      | Provides query capabilities for player data including lookups
      | by ID, team, status, and free agency. Supports roster management
      | and player acquisition workflows.
    }
  }

  // Projector for roster analytics
  projector RosterMetrics is {
    record RosterMetricsRecord is {
      teamId is TeamId with {
        briefly "Team identifier"
        described by "Team these metrics belong to."
      }
      totalPlayers is Integer with {
        briefly "Total players"
        described by "Total number of players under contract."
      }
      activePlayers is Integer with {
        briefly "Active players"
        described by "Players on the active roster."
      }
      injuredReservePlayers is Integer with {
        briefly "IR players"
        described by "Players on injured reserve."
      }
      practiceSquadPlayers is Integer with {
        briefly "Practice squad"
        described by "Players on the practice squad."
      }
      totalPayroll is Decimal(12, 2) with {
        briefly "Total payroll"
        described by "Sum of all player salaries."
      }
      capSpace is Decimal(12, 2) with {
        briefly "Cap space"
        described by "Remaining salary cap room."
      }
      averageAge is Decimal(4, 1) with {
        briefly "Average age"
        described by "Average age of rostered players."
      }
      averageSalary is Decimal(12, 2) with {
        briefly "Average salary"
        described by "Average player salary."
      }
      positionCounts is String(1, 500) with {
        briefly "Position counts"
        described by "JSON representation of players per position."
      }
      lastUpdated is TimeStamp with {
        briefly "Last updated"
        described by "When these metrics were last calculated."
      }
    } with {
      briefly "Aggregated roster statistics"
      described by {
        | Pre-computed metrics for roster composition, salary
        | distribution, and team demographics.
      }
    }

    handler RosterMetricsHandler is {
      on event Player.PlayerSigned {
        set field RosterMetricsRecord.totalPlayers to "RosterMetricsRecord.totalPlayers + 1"
      }
      on event Player.PlayerReleased {
        set field RosterMetricsRecord.totalPlayers to "RosterMetricsRecord.totalPlayers - 1"
      }
      on event Player.PlayerTraded {
        set field RosterMetricsRecord.lastUpdated to "now()"
      }
      on event Player.PlayerPlacedOnInjuredReserve {
        set field RosterMetricsRecord.injuredReservePlayers to "RosterMetricsRecord.injuredReservePlayers + 1"
      }
      on event Player.PlayerAssignedToRoster {
        set field RosterMetricsRecord.activePlayers to "RosterMetricsRecord.activePlayers + 1"
      }
    } with {
      briefly "Updates metrics based on roster events"
      described by {
        | Listens to player lifecycle events and maintains
        | up-to-date roster analytics for reporting and compliance.
      }
    }

  } with {
    briefly "Real-time roster analytics projection"
    described by {
      | Maintains a continuously updated view of roster composition,
      | salary cap utilization, and team demographics. Used for
      | front office decision support and league compliance reporting.
    }
  }

} with {
  briefly "Bounded context for team roster management"
  described by {
    | The TeamContext encompasses all operations related to managing
    | a professional sports team's roster. This includes player signing,
    | contract management, roster assignments, trades, and releases.
    | It integrates with external contexts for league approval, salary
    | cap validation, and injury reporting.
  }
}
