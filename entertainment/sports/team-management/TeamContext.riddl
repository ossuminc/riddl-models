// Team Management bounded context
context TeamContext is {
  include "types.riddl"
  include "Player.riddl"
  include "external-contexts.riddl"
  // Team entity for managing team-level operations
  entity Team is {
    command CreateTeam is  {
      teamId: TeamId with {
        briefly "Team identifier"
        described as {
          |Unique identifier for the new team.
        }
      }
      name: String(1,100) with {
        briefly "Team name"
        described as {
          |Official name of the team.
        }
      }
      city: String(1,50) with {
        briefly "City"
        described as {
          |City where the team is based.
        }
      }
      conference: String(1,50) with {
        briefly "Conference"
        described as {
          |League conference the team belongs to.
        }
      }
      division: String(1,50) with {
        briefly "Division"
        described as {
          |Division within the conference.
        }
      }
    } with {
      briefly "Create a new team in the system"
      described as {
        | Initializes a new franchise with basic identifying information
        | including geographic and league organizational details.
      }
    }
    event TeamCreated is  {
      teamId: TeamId with {
        briefly "Team identifier"
        described as {
          |Identifier of the created team.
        }
      }
      name: String(1,100) with {
        briefly "Team name"
        described as {
          |Name of the created team.
        }
      }
      city: String(1,50) with {
        briefly "City"
        described as {
          |City where the team is based.
        }
      }
      conference: String(1,50) with {
        briefly "Conference"
        described as {
          |Conference assignment.
        }
      }
      division: String(1,50) with {
        briefly "Division"
        described as {
          |Division assignment.
        }
      }
      createdAt: TimeStamp with {
        briefly "Creation timestamp"
        described as {
          |When the team was created.
        }
      }
    } with {
      briefly "Team has been created"
      described as {
        | Records the creation of a new team entity in the system.
      }
    }
    record ActiveTeamData is  {
      teamId: TeamId with {
        briefly "Team ID"
        described as {
          |Unique team identifier.
        }
      }
      name: String(1,100) with {
        briefly "Name"
        described as {
          |Official team name.
        }
      }
      city: String(1,50) with {
        briefly "City"
        described as {
          |Team's home city.
        }
      }
      conference: String(1,50) with {
        briefly "Conference"
        described as {
          |League conference.
        }
      }
      division: String(1,50) with {
        briefly "Division"
        described as {
          |Conference division.
        }
      }
      rosterSize: Integer with {
        briefly "Roster size"
        described as {
          |Current player count.
        }
      }
      salaryCap: Decimal(12,2) with {
        briefly "Salary cap"
        described as {
          |Maximum payroll.
        }
      }
      currentPayroll: Decimal(12,2) with {
        briefly "Payroll"
        described as {
          |Current payroll.
        }
      }
    } with {
      briefly "Active team state data"
      described as {
        |Data for an active team in the league.
      }
    }
    state ActiveTeam of type Team.ActiveTeamData
    handler TeamHandler is {
      on command CreateTeam is {
        tell event TeamCreated to entity Team
      }
    } with {
      briefly "Handles team management commands"
      described as {
        | Processes team-level commands for franchise operations.
      }
    }
  } with {
    option aggregate()
    briefly "Represents a professional sports team"
    described as {
      | Manages team identity, roster limits, and salary cap tracking
      | for a franchise within the league.
    }
  }
  // Repository for player data persistence
  repository PlayerRepository is {
    query GetPlayerById is  {
      playerId: PlayerId with {
        briefly "Player to retrieve"
        described as {
          |Identifier of the player to look up.
        }
      }
    } with {
      briefly "Retrieve player by unique identifier"
      described as {
        | Fetches complete player record including current status,
        | contract, and roster assignment.
      }
    }
    query GetPlayersByTeam is  {
      teamId: TeamId with {
        briefly "Team to query"
        described as {
          |Identifier of the team whose roster to retrieve.
        }
      }
    } with {
      briefly "Retrieve all players for a team"
      described as {
        | Returns the complete roster of players currently signed
        | to the specified team.
      }
    }
    query GetPlayersByStatus is  {
      teamId: TeamId with {
        briefly "Team to query"
        described as {
          |Identifier of the team to filter.
        }
      }
      status: PlayerStatus with {
        briefly "Status filter"
        described as {
          |Status to filter players by.
        }
      }
    } with {
      briefly "Retrieve players by roster status"
      described as {
        | Filters team roster by status such as Active, InjuredReserve,
        | or PracticeSquad.
      }
    }
    query GetFreeAgents is  {
      positionFilter: String(1,20)? with {
        briefly "Position filter"
        described as {
          |Optional position to filter free agents.
        }
      }
    } with {
      briefly "Retrieve available free agents"
      described as {
        | Returns players not currently under contract, optionally
        | filtered by position.
      }
    }
    result PlayerRecord is  {
      playerId: PlayerId with {
        briefly "Player identifier"
        described as {
          |Unique identifier for the player.
        }
      }
      playerInfo: PlayerInfo with {
        briefly "Player information"
        described as {
          |Biographical data for the player.
        }
      }
      currentContract: ContractInfo? with {
        briefly "Contract information"
        described as {
          |Current contract if signed.
        }
      }
      currentTeamId: TeamId? with {
        briefly "Current team"
        described as {
          |Team the player is signed with if any.
        }
      }
      status: PlayerStatus with {
        briefly "Player status"
        described as {
          |Current roster status.
        }
      }
      rosterSlot: RosterSlot? with {
        briefly "Roster slot"
        described as {
          |Current roster assignment if any.
        }
      }
    } with {
      briefly "Complete player data record"
      described as {
        | Full player information including biographical data,
        | contract terms, team assignment, and current status.
      }
    }
    result PlayerList is  {
      players: PlayerRecord+ with {
        briefly "Player records"
        described as {
          |Collection of player records matching the query.
        }
      }
    } with {
      briefly "Collection of player records"
      described as {
        | List of player records for roster queries.
      }
    }
  } with {
    briefly "Persistence layer for player data"
    described as {
      | Provides query capabilities for player data including lookups
      | by ID, team, status, and free agency. Supports roster management
      | and player acquisition workflows.
    }
  }
  // Projector for roster analytics
  projector RosterMetrics is {
    record RosterMetricsRecord is  {
      teamId: TeamId with {
        briefly "Team identifier"
        described as {
          |Team these metrics belong to.
        }
      }
      totalPlayers: Integer with {
        briefly "Total players"
        described as {
          |Total number of players under contract.
        }
      }
      activePlayers: Integer with {
        briefly "Active players"
        described as {
          |Players on the active roster.
        }
      }
      injuredReservePlayers: Integer with {
        briefly "IR players"
        described as {
          |Players on injured reserve.
        }
      }
      practiceSquadPlayers: Integer with {
        briefly "Practice squad"
        described as {
          |Players on the practice squad.
        }
      }
      totalPayroll: Decimal(12,2) with {
        briefly "Total payroll"
        described as {
          |Sum of all player salaries.
        }
      }
      capSpace: Decimal(12,2) with {
        briefly "Cap space"
        described as {
          |Remaining salary cap room.
        }
      }
      averageAge: Decimal(4,1) with {
        briefly "Average age"
        described as {
          |Average age of rostered players.
        }
      }
      averageSalary: Decimal(12,2) with {
        briefly "Average salary"
        described as {
          |Average player salary.
        }
      }
      positionCounts: String(1,500) with {
        briefly "Position counts"
        described as {
          |JSON representation of players per position.
        }
      }
      lastUpdated: TimeStamp with {
        briefly "Last updated"
        described as {
          |When these metrics were last calculated.
        }
      }
    } with {
      briefly "Aggregated roster statistics"
      described as {
        | Pre-computed metrics for roster composition, salary
        | distribution, and team demographics.
      }
    }
    handler RosterMetricsHandler is {
      on event Player.PlayerSigned is {
        set field RosterMetricsRecord.totalPlayers to "RosterMetricsRecord.totalPlayers + 1"
      }
      on event Player.PlayerReleased is {
        set field RosterMetricsRecord.totalPlayers to "RosterMetricsRecord.totalPlayers - 1"
      }
      on event Player.PlayerTraded is {
        set field RosterMetricsRecord.lastUpdated to "now()"
      }
      on event Player.PlayerPlacedOnInjuredReserve is {
        set field RosterMetricsRecord.injuredReservePlayers to "RosterMetricsRecord.injuredReservePlayers + 1"
      }
      on event Player.PlayerAssignedToRoster is {
        set field RosterMetricsRecord.activePlayers to "RosterMetricsRecord.activePlayers + 1"
      }
    } with {
      briefly "Updates metrics based on roster events"
      described as {
        | Listens to player lifecycle events and maintains
        | up-to-date roster analytics for reporting and compliance.
      }
    }
  } with {
    briefly "Real-time roster analytics projection"
    described as {
      | Maintains a continuously updated view of roster composition,
      | salary cap utilization, and team demographics. Used for
      | front office decision support and league compliance reporting.
    }
  }
} with {
  briefly "Bounded context for team roster management"
  described as {
    | The TeamContext encompasses all operations related to managing
    | a professional sports team's roster. This includes player signing,
    | contract management, roster assignments, trades, and releases.
    | It integrates with external contexts for league approval, salary
    | cap validation, and injury reporting.
  }
}
