// Content Management - Content Entity

entity Content is {

  // Commands
  command CreateContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "New content identifier."
    }
    info is ContentInfo with {
      briefly "Info"
      described by "Content information."
    }
    createdBy is UserId with {
      briefly "Created by"
      described by "Content creator."
    }
  } with {
    briefly "Create content"
    described by "Creates a new content item."
  }

  command UpdateMetadata is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content to update."
    }
    info is ContentInfo with {
      briefly "Info"
      described by "Updated metadata."
    }
  } with {
    briefly "Update metadata"
    described by "Updates content metadata."
  }

  command AddAsset is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    asset is MediaAsset with {
      briefly "Asset"
      described by "Media asset to add."
    }
  } with {
    briefly "Add asset"
    described by "Adds a media asset."
  }

  command RemoveAsset is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    assetId is AssetId with {
      briefly "Asset ID"
      described by "Asset to remove."
    }
  } with {
    briefly "Remove asset"
    described by "Removes a media asset."
  }

  command CreateVersion is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    version is ContentVersion with {
      briefly "Version"
      described by "New version."
    }
  } with {
    briefly "Create version"
    described by "Creates a content version."
  }

  command AssignRights is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    rights is ContentRights with {
      briefly "Rights"
      described by "Rights assignment."
    }
  } with {
    briefly "Assign rights"
    described by "Assigns content rights."
  }

  command SubmitForReview is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content to review."
    }
    submittedBy is UserId with {
      briefly "Submitted by"
      described by "Submitting user."
    }
  } with {
    briefly "Submit for review"
    described by "Submits content for approval."
  }

  command ApproveContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content to approve."
    }
    approvedBy is UserId with {
      briefly "Approved by"
      described by "Approving user."
    }
  } with {
    briefly "Approve content"
    described by "Approves content for publishing."
  }

  command RejectContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content to reject."
    }
    rejectedBy is UserId with {
      briefly "Rejected by"
      described by "Rejecting user."
    }
    reason is String(1, 1000) with {
      briefly "Reason"
      described by "Rejection reason."
    }
  } with {
    briefly "Reject content"
    described by "Rejects content with feedback."
  }

  command PublishContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content to publish."
    }
    schedule is optional PublishingSchedule with {
      briefly "Schedule"
      described by "Publishing schedule."
    }
    publishedBy is UserId with {
      briefly "Published by"
      described by "Publishing user."
    }
  } with {
    briefly "Publish content"
    described by "Publishes content to channels."
  }

  command UnpublishContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content to unpublish."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Unpublish reason."
    }
  } with {
    briefly "Unpublish content"
    described by "Removes content from distribution."
  }

  command ArchiveContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content to archive."
    }
  } with {
    briefly "Archive content"
    described by "Archives content item."
  }

  // Events
  event ContentCreated is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    info is ContentInfo with { briefly "Info" described by "Content info." }
    createdBy is UserId with { briefly "Created by" described by "Creator." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Content was created"
    described by "Emitted when content is created."
  }

  event MetadataUpdated is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    info is ContentInfo with { briefly "Info" described by "Updated info." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Metadata was updated"
    described by "Emitted when metadata changes."
  }

  event AssetAdded is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    asset is MediaAsset with { briefly "Asset" described by "New asset." }
    addedAt is TimeStamp with { briefly "Added" described by "Addition time." }
  } with {
    briefly "Asset was added"
    described by "Emitted when asset is added."
  }

  event AssetRemoved is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    assetId is AssetId with { briefly "Asset" described by "Removed asset." }
    removedAt is TimeStamp with { briefly "Removed" described by "Removal time." }
  } with {
    briefly "Asset was removed"
    described by "Emitted when asset is removed."
  }

  event VersionCreated is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    version is ContentVersion with { briefly "Version" described by "New version." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Version was created"
    described by "Emitted when version is created."
  }

  event RightsAssigned is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    rights is ContentRights with { briefly "Rights" described by "Assigned rights." }
    assignedAt is TimeStamp with { briefly "Assigned" described by "Assignment time." }
  } with {
    briefly "Rights were assigned"
    described by "Emitted when rights are assigned."
  }

  event ContentSubmittedForReview is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    submittedBy is UserId with { briefly "Submitted by" described by "Submitter." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submission time." }
  } with {
    briefly "Content was submitted"
    described by "Emitted when content is submitted."
  }

  event ContentApproved is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    approvedBy is UserId with { briefly "Approved by" described by "Approver." }
    approvedAt is TimeStamp with { briefly "Approved" described by "Approval time." }
  } with {
    briefly "Content was approved"
    described by "Emitted when content is approved."
  }

  event ContentRejected is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    rejectedBy is UserId with { briefly "Rejected by" described by "Rejector." }
    reason is String(1, 1000) with { briefly "Reason" described by "Rejection reason." }
    rejectedAt is TimeStamp with { briefly "Rejected" described by "Rejection time." }
  } with {
    briefly "Content was rejected"
    described by "Emitted when content is rejected."
  }

  event ContentPublished is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    publishedBy is UserId with { briefly "Published by" described by "Publisher." }
    publishedAt is TimeStamp with { briefly "Published" described by "Publish time." }
  } with {
    briefly "Content was published"
    described by "Emitted when content is published."
  }

  event ContentUnpublished is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Unpublish reason." }
    unpublishedAt is TimeStamp with { briefly "Unpublished" described by "Unpublish time." }
  } with {
    briefly "Content was unpublished"
    described by "Emitted when content is removed."
  }

  event ContentArchived is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    archivedAt is TimeStamp with { briefly "Archived" described by "Archive time." }
  } with {
    briefly "Content was archived"
    described by "Emitted when content is archived."
  }

  // State Records
  record DraftStateData is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    info is ContentInfo with { briefly "Info" described by "Content info." }
    assets is many MediaAsset with { briefly "Assets" described by "Media assets." }
    versions is many ContentVersion with { briefly "Versions" described by "Content versions." }
    createdBy is UserId with { briefly "Created by" described by "Creator." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Draft state data"
    described by "State data for draft content."
  }

  record ReviewStateData is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    info is ContentInfo with { briefly "Info" described by "Content info." }
    assets is many MediaAsset with { briefly "Assets" described by "Media assets." }
    versions is many ContentVersion with { briefly "Versions" described by "Content versions." }
    submittedBy is UserId with { briefly "Submitted by" described by "Submitter." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submission time." }
  } with {
    briefly "Review state data"
    described by "State data for content in review."
  }

  record PublishedStateData is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    info is ContentInfo with { briefly "Info" described by "Content info." }
    assets is many MediaAsset with { briefly "Assets" described by "Media assets." }
    versions is many ContentVersion with { briefly "Versions" described by "Content versions." }
    rights is many ContentRights with { briefly "Rights" described by "Content rights." }
    publishedAt is TimeStamp with { briefly "Published" described by "Publish time." }
    publishedBy is UserId with { briefly "Published by" described by "Publisher." }
  } with {
    briefly "Published state data"
    described by "State data for published content."
  }

  record ArchivedStateData is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    info is ContentInfo with { briefly "Info" described by "Content info." }
    archivedAt is TimeStamp with { briefly "Archived" described by "Archive time." }
  } with {
    briefly "Archived state data"
    described by "State data for archived content."
  }

  // States
  state DraftState of Content.DraftStateData with {
    briefly "Content in draft"
    described by "Content is being created."
  }

  state ReviewState of Content.ReviewStateData with {
    briefly "Content in review"
    described by "Content is under review."
  }

  state PublishedState of Content.PublishedStateData with {
    briefly "Content is published"
    described by "Content is live."
  }

  state ArchivedState of Content.ArchivedStateData with {
    briefly "Content is archived"
    described by "Content is archived."
  }

  // Handler
  handler ContentHandler is {
    on command CreateContent {
      morph entity ContentContext.Content to state ContentContext.Content.DraftState with command CreateContent
      tell event ContentCreated to entity ContentContext.Content
    }

    on command UpdateMetadata {
      tell event MetadataUpdated to entity ContentContext.Content
    }

    on command AddAsset {
      tell event AssetAdded to entity ContentContext.Content
    }

    on command RemoveAsset {
      tell event AssetRemoved to entity ContentContext.Content
    }

    on command CreateVersion {
      tell event VersionCreated to entity ContentContext.Content
    }

    on command AssignRights {
      tell event RightsAssigned to entity ContentContext.Content
    }

    on command SubmitForReview {
      morph entity ContentContext.Content to state ContentContext.Content.ReviewState with command SubmitForReview
      tell event ContentSubmittedForReview to entity ContentContext.Content
    }

    on command ApproveContent {
      tell event ContentApproved to entity ContentContext.Content
    }

    on command RejectContent {
      morph entity ContentContext.Content to state ContentContext.Content.DraftState with command RejectContent
      tell event ContentRejected to entity ContentContext.Content
    }

    on command PublishContent {
      morph entity ContentContext.Content to state ContentContext.Content.PublishedState with command PublishContent
      tell event ContentPublished to entity ContentContext.Content
    }

    on command UnpublishContent {
      morph entity ContentContext.Content to state ContentContext.Content.DraftState with command UnpublishContent
      tell event ContentUnpublished to entity ContentContext.Content
    }

    on command ArchiveContent {
      morph entity ContentContext.Content to state ContentContext.Content.ArchivedState with command ArchiveContent
      tell event ContentArchived to entity ContentContext.Content
    }
  } with {
    briefly "Processes content commands"
    described by {
      | Handles content lifecycle including creation,
      | review, publishing, and archival.
    }
  }

} with {
  briefly "Content aggregate"
  described by {
    | The Content entity manages digital content assets
    | including metadata, versions, rights, and distribution.
  }
}
