// Content Management - Content Context

context ContentContext is {

  include "types.riddl"
  include "Content.riddl"

  // Repository for content persistence
  repository ContentRepository is {
    schema ContentData is relational
      of contents as Content
      index on field Content.contentId
      index on field Content.info.contentType

    handler ContentPersistence is {
      on command Content.CreateContent {
        prompt "Store content record"
      }
      on command Content.UpdateMetadata {
        prompt "Update content metadata"
      }
      on command Content.AddAsset {
        prompt "Store asset reference"
      }
      on command Content.RemoveAsset {
        prompt "Remove asset reference"
      }
      on command Content.CreateVersion {
        prompt "Store content version"
      }
      on command Content.AssignRights {
        prompt "Store rights assignment"
      }
      on command Content.SubmitForReview {
        prompt "Update status to in review"
      }
      on command Content.ApproveContent {
        prompt "Update status to approved"
      }
      on command Content.RejectContent {
        prompt "Update status to rejected"
      }
      on command Content.PublishContent {
        prompt "Update status to published"
      }
      on command Content.UnpublishContent {
        prompt "Update status to unpublished"
      }
      on command Content.ArchiveContent {
        prompt "Update status to archived"
      }
    } with {
      briefly "Persists content commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Content data persistence"
    described by {
      | The ContentRepository provides persistent storage for
      | content items, assets, and rights.
    }
  }

  // Projector for content analytics
  projector ContentAnalytics is {
    updates repository ContentRepository

    record ContentStats is {
      contentType is ContentType with { briefly "Type" described by "Content type." }
      totalItems is Natural with { briefly "Items" described by "Total content items." }
      publishedItems is Natural with { briefly "Published" described by "Published items." }
      totalAssets is Natural with { briefly "Assets" described by "Total assets." }
      totalStorageBytes is Natural with { briefly "Storage" described by "Total storage used." }
    } with {
      briefly "Content statistics"
      described by "Content library metrics."
    }

    handler AnalyticsHandler is {
      on event Content.ContentCreated {
        prompt "Update content counts"
      }
      on event Content.AssetAdded {
        prompt "Update asset metrics"
      }
      on event Content.ContentPublished {
        prompt "Update publication metrics"
      }
      on event Content.ContentArchived {
        prompt "Update archive metrics"
      }
    } with {
      briefly "Maintains content analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Content analytics projections"
    described by "Maintains content library analytics data."
  }

} with {
  briefly "Bounded context for content management"
  described by {
    | The ContentContext is the bounded context for digital
    | content lifecycle, metadata, and distribution management.
  }
}
