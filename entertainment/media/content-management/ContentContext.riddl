// Content Management - Content Context

context ContentContext is {

  include "types.riddl"
  include "Content.riddl"

  // Repository for content persistence
  repository ContentRepository is {
    schema ContentData is relational
      of contents as Content
      index on field Content.contentId
      index on field Content.info.contentType

    handler ContentPersistence is {
      on event Content.ContentCreated {
        prompt "Store content record"
      }
      on event Content.MetadataUpdated {
        prompt "Update content metadata"
      }
      on event Content.AssetAdded {
        prompt "Store asset reference"
      }
      on event Content.AssetRemoved {
        prompt "Remove asset reference"
      }
      on event Content.VersionCreated {
        prompt "Store content version"
      }
      on event Content.RightsAssigned {
        prompt "Store rights assignment"
      }
      on event Content.ContentSubmittedForReview {
        prompt "Update status to in review"
      }
      on event Content.ContentApproved {
        prompt "Update status to approved"
      }
      on event Content.ContentRejected {
        prompt "Update status to rejected"
      }
      on event Content.ContentPublished {
        prompt "Update status to published"
      }
      on event Content.ContentUnpublished {
        prompt "Update status to unpublished"
      }
      on event Content.ContentArchived {
        prompt "Update status to archived"
      }
    } with {
      briefly "Persists content events"
      described by "Handles event-driven persistence."
    }
  } with {
    briefly "Content data persistence"
    described by {
      | The ContentRepository provides persistent storage for
      | content items, assets, and rights.
    }
  }

  // Projector for content analytics
  projector ContentAnalytics is {
    updates repository ContentRepository

    record ContentStats is {
      contentType is ContentType with { briefly "Type" described by "Content type." }
      totalItems is Natural with { briefly "Items" described by "Total content items." }
      publishedItems is Natural with { briefly "Published" described by "Published items." }
      totalAssets is Natural with { briefly "Assets" described by "Total assets." }
      totalStorageBytes is Natural with { briefly "Storage" described by "Total storage used." }
    } with {
      briefly "Content statistics"
      described by "Content library metrics."
    }

    handler AnalyticsHandler is {
      on event Content.ContentCreated {
        prompt "Update content counts"
      }
      on event Content.AssetAdded {
        prompt "Update asset metrics"
      }
      on event Content.ContentPublished {
        prompt "Update publication metrics"
      }
      on event Content.ContentArchived {
        prompt "Update archive metrics"
      }
    } with {
      briefly "Maintains content analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Content analytics projections"
    described by "Maintains content library analytics data."
  }

} with {
  briefly "Bounded context for content management"
  described by {
    | The ContentContext is the bounded context for digital
    | content lifecycle, metadata, and distribution management.
  }
}
