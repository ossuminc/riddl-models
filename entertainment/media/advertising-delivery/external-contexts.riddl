// Advertising Delivery - External Contexts

// Ad Decision Service
context AdDecisionService is {

  query RequestAd is {
    placement is AdPlacement with { briefly "Placement" described by "Ad placement." }
    viewer is ViewerContext with { briefly "Viewer" described by "Viewer context." }
  } with {
    briefly "Request ad"
    described by "Requests ad decision."
  }

  result AdDecision is {
    adUnit is optional AdUnit with { briefly "Ad unit" described by "Selected ad." }
    noFill is Boolean with { briefly "No fill" described by "No ad available." }
  } with {
    briefly "Ad decision"
    described by "Ad selection result."
  }

} with {
  option is external
  briefly "External ad decision service"
  described by "External ad selection engine."
}

// RTB Exchange
context RTBExchange is {

  command SendBidRequest is {
    placement is AdPlacement with { briefly "Placement" described by "Ad placement." }
    viewer is ViewerContext with { briefly "Viewer" described by "Viewer context." }
    timeout is Duration with { briefly "Timeout" described by "Bid timeout." }
  } with {
    briefly "Send bid request"
    described by "Sends RTB bid request."
  }

  event BidResponseReceived is {
    bids is many BidResponse with { briefly "Bids" described by "Bid responses." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Bid response received"
    described by "Emitted when bids arrive."
  }

} with {
  option is external
  briefly "External RTB exchange"
  described by "Real-time bidding exchange."
}

// Campaign Management Service
context CampaignService is {

  query GetCampaign is {
    campaignId is CampaignId with { briefly "Campaign" described by "Campaign ID." }
  } with {
    briefly "Get campaign"
    described by "Retrieves campaign details."
  }

  event CampaignUpdated is {
    campaignId is CampaignId with { briefly "Campaign" described by "Campaign ID." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Campaign was updated"
    described by "Emitted when campaign changes."
  }

} with {
  option is external
  briefly "External campaign service"
  described by "External campaign management."
}

// Targeting Service
context TargetingService is {

  query EvaluateTargeting is {
    criteria is many TargetingCriteria with { briefly "Criteria" described by "Targeting rules." }
    viewer is ViewerContext with { briefly "Viewer" described by "Viewer context." }
  } with {
    briefly "Evaluate targeting"
    described by "Checks if viewer matches targeting."
  }

  result TargetingResult is {
    matches is Boolean with { briefly "Matches" described by "Targeting matched." }
    score is Decimal(5, 4) with { briefly "Score" described by "Match score." }
  } with {
    briefly "Targeting result"
    described by "Targeting evaluation result."
  }

} with {
  option is external
  briefly "External targeting service"
  described by "External audience targeting."
}

// Billing Service
context BillingService is {

  command RecordBillableEvent is {
    impressionId is ImpressionId with { briefly "Impression" described by "Impression ID." }
    campaignId is CampaignId with { briefly "Campaign" described by "Campaign ID." }
    eventType is String(1, 50) with { briefly "Event" described by "Billable event type." }
    amount is Decimal(10, 6) with { briefly "Amount" described by "Billing amount." }
  } with {
    briefly "Record billable event"
    described by "Records billing event."
  }

  event BillableEventRecorded is {
    eventId is UUID with { briefly "Event" described by "Event ID." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Billable event recorded"
    described by "Emitted when billing is recorded."
  }

} with {
  option is external
  briefly "External billing service"
  described by "External ad billing system."
}

// Fraud Detection Service
context FraudDetectionService is {

  command CheckImpression is {
    impressionId is ImpressionId with { briefly "Impression" described by "Impression ID." }
    viewer is ViewerContext with { briefly "Viewer" described by "Viewer context." }
  } with {
    briefly "Check impression"
    described by "Validates impression authenticity."
  }

  event ImpressionValidated is {
    impressionId is ImpressionId with { briefly "Impression" described by "Impression ID." }
    valid is Boolean with { briefly "Valid" described by "Is valid." }
    riskScore is Decimal(5, 4) with { briefly "Risk" described by "Risk score." }
  } with {
    briefly "Impression was validated"
    described by "Emitted when validation completes."
  }

} with {
  option is external
  briefly "External fraud detection"
  described by "External ad fraud prevention."
}
