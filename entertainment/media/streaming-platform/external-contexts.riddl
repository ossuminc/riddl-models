// Streaming Platform - External Contexts

// CDN Service
context CDNService is {

  query GetStreamUrl is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    quality is StreamQuality with { briefly "Quality" described by "Requested quality." }
    region is String(1, 50) with { briefly "Region" described by "User region." }
  } with {
    briefly "Get stream URL"
    described by "Retrieves CDN playback URL."
  }

  result StreamUrlResult is {
    streamUrl is URL with { briefly "URL" described by "Stream URL." }
    expiresAt is TimeStamp with { briefly "Expires" described by "URL expiration." }
  } with {
    briefly "Stream URL result"
    described by "CDN stream URL response."
  }

} with {
  option is external
  briefly "External CDN service"
  described by "External content delivery network."
}

// DRM Service
context DRMService is {

  command RequestLicense is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    deviceId is DeviceId with { briefly "Device" described by "Device ID." }
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
  } with {
    briefly "Request license"
    described by "Requests DRM license."
  }

  event LicenseGranted is {
    licenseId is UUID with { briefly "License" described by "License ID." }
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    expiresAt is TimeStamp with { briefly "Expires" described by "License expiration." }
  } with {
    briefly "License was granted"
    described by "Emitted when license is issued."
  }

} with {
  option is external
  briefly "External DRM service"
  described by "External digital rights management."
}

// Recommendation Service
context RecommendationService is {

  query GetRecommendations is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    profileId is ProfileId with { briefly "Profile" described by "Profile ID." }
    limit is Natural with { briefly "Limit" described by "Max recommendations." }
  } with {
    briefly "Get recommendations"
    described by "Retrieves personalized recommendations."
  }

  result RecommendationList is {
    recommendations is many Recommendation with { briefly "Recommendations" described by "Content recommendations." }
  } with {
    briefly "Recommendation list"
    described by "Personalized recommendations."
  }

} with {
  option is external
  briefly "External recommendation service"
  described by "External recommendation engine."
}

// Subscription Service
context SubscriptionService is {

  query CheckEntitlement is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    contentId is ContentId with { briefly "Content" described by "Content ID." }
  } with {
    briefly "Check entitlement"
    described by "Verifies content access."
  }

  result EntitlementResult is {
    entitled is Boolean with { briefly "Entitled" described by "Has access." }
    denialReason is optional String(1, 200) with { briefly "Reason" described by "Denial reason." }
  } with {
    briefly "Entitlement result"
    described by "Access verification result."
  }

} with {
  option is external
  briefly "External subscription service"
  described by "External subscription management."
}

// Analytics Service
context AnalyticsService is {

  command TrackViewEvent is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    eventType is String(1, 50) with { briefly "Event" described by "Event type." }
    properties is String(1, 2000) with { briefly "Properties" described by "Event properties." }
  } with {
    briefly "Track event"
    described by "Tracks viewing analytics."
  }

  event ViewEventTracked is {
    eventId is UUID with { briefly "Event" described by "Event ID." }
    trackedAt is TimeStamp with { briefly "Tracked" described by "Track time." }
  } with {
    briefly "Event was tracked"
    described by "Emitted when event is recorded."
  }

} with {
  option is external
  briefly "External analytics service"
  described by "External analytics platform."
}

// Continue Watching Service
context ContinueWatchingService is {

  command SaveProgress is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    profileId is ProfileId with { briefly "Profile" described by "Profile ID." }
    progress is ViewingProgress with { briefly "Progress" described by "Watch progress." }
  } with {
    briefly "Save progress"
    described by "Saves viewing progress."
  }

  query GetProgress is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    profileId is ProfileId with { briefly "Profile" described by "Profile ID." }
    contentId is ContentId with { briefly "Content" described by "Content ID." }
  } with {
    briefly "Get progress"
    described by "Retrieves viewing progress."
  }

} with {
  option is external
  briefly "External continue watching service"
  described by "External progress tracking service."
}
