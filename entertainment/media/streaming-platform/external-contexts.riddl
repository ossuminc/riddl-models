// Streaming Platform - External Contexts
// CDN Service
context CDNService is {
  query GetStreamUrl is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    quality: StreamQuality with {
      briefly "Quality"
      described as {
        |Requested quality.
      }
    }
    region: String(1,50) with {
      briefly "Region"
      described as {
        |User region.
      }
    }
  } with {
    briefly "Get stream URL"
    described as {
      |Retrieves CDN playback URL.
    }
  }
  result StreamUrlResult is  {
    streamUrl: URL with {
      briefly "URL"
      described as {
        |Stream URL.
      }
    }
    expiresAt: TimeStamp with {
      briefly "Expires"
      described as {
        |URL expiration.
      }
    }
  } with {
    briefly "Stream URL result"
    described as {
      |CDN stream URL response.
    }
  }
} with {
  option external()
  briefly "External CDN service"
  described as {
    |External content delivery network.
  }
}
// DRM Service
context DRMService is {
  command RequestLicense is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
  } with {
    briefly "Request license"
    described as {
      |Requests DRM license.
    }
  }
  event LicenseGranted is  {
    licenseId: UUID with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    expiresAt: TimeStamp with {
      briefly "Expires"
      described as {
        |License expiration.
      }
    }
  } with {
    briefly "License was granted"
    described as {
      |Emitted when license is issued.
    }
  }
} with {
  option external()
  briefly "External DRM service"
  described as {
    |External digital rights management.
  }
}
// Recommendation Service
context RecommendationService is {
  query GetRecommendations is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    profileId: ProfileId with {
      briefly "Profile"
      described as {
        |Profile ID.
      }
    }
    limit: Natural with {
      briefly "Limit"
      described as {
        |Max recommendations.
      }
    }
  } with {
    briefly "Get recommendations"
    described as {
      |Retrieves personalized recommendations.
    }
  }
  result RecommendationList is  {
    recommendations: Recommendation+ with {
      briefly "Recommendations"
      described as {
        |Content recommendations.
      }
    }
  } with {
    briefly "Recommendation list"
    described as {
      |Personalized recommendations.
    }
  }
} with {
  option external()
  briefly "External recommendation service"
  described as {
    |External recommendation engine.
  }
}
// Subscription Service
context SubscriptionService is {
  query CheckEntitlement is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
  } with {
    briefly "Check entitlement"
    described as {
      |Verifies content access.
    }
  }
  result EntitlementResult is  {
    entitled: Boolean with {
      briefly "Entitled"
      described as {
        |Has access.
      }
    }
    denialReason: String(1,200)? with {
      briefly "Reason"
      described as {
        |Denial reason.
      }
    }
  } with {
    briefly "Entitlement result"
    described as {
      |Access verification result.
    }
  }
} with {
  option external()
  briefly "External subscription service"
  described as {
    |External subscription management.
  }
}
// Analytics Service
context AnalyticsService is {
  command TrackViewEvent is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    eventType: String(1,50) with {
      briefly "Event"
      described as {
        |Event type.
      }
    }
    properties: String(1,2000) with {
      briefly "Properties"
      described as {
        |Event properties.
      }
    }
  } with {
    briefly "Track event"
    described as {
      |Tracks viewing analytics.
    }
  }
  event ViewEventTracked is  {
    eventId: UUID with {
      briefly "Event"
      described as {
        |Event ID.
      }
    }
    trackedAt: TimeStamp with {
      briefly "Tracked"
      described as {
        |Track time.
      }
    }
  } with {
    briefly "Event was tracked"
    described as {
      |Emitted when event is recorded.
    }
  }
} with {
  option external()
  briefly "External analytics service"
  described as {
    |External analytics platform.
  }
}
// Continue Watching Service
context ContinueWatchingService is {
  command SaveProgress is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    profileId: ProfileId with {
      briefly "Profile"
      described as {
        |Profile ID.
      }
    }
    progress: ViewingProgress with {
      briefly "Progress"
      described as {
        |Watch progress.
      }
    }
  } with {
    briefly "Save progress"
    described as {
      |Saves viewing progress.
    }
  }
  query GetProgress is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    profileId: ProfileId with {
      briefly "Profile"
      described as {
        |Profile ID.
      }
    }
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
  } with {
    briefly "Get progress"
    described as {
      |Retrieves viewing progress.
    }
  }
} with {
  option external()
  briefly "External continue watching service"
  described as {
    |External progress tracking service.
  }
}
