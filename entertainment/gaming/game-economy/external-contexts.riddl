// Game Economy - External Contexts

// In-App Purchase Service
context IAPService is {

  command ProcessPurchase is {
    playerId is PlayerId with { briefly "Player" described by "Player ID." }
    productId is String(1, 100) with { briefly "Product" described by "Product ID." }
    receiptData is String(1, 5000) with { briefly "Receipt" described by "Purchase receipt." }
    platform is String(1, 50) with { briefly "Platform" described by "Purchase platform." }
  } with {
    briefly "Process purchase"
    described by "Processes real-money purchase."
  }

  event PurchaseVerified is {
    transactionId is TransactionId with { briefly "Transaction" described by "Transaction ID." }
    playerId is PlayerId with { briefly "Player" described by "Player ID." }
    purchaseAmount is Decimal(10, 2) with { briefly "Amount" described by "Purchase amount." }
    verifiedAt is TimeStamp with { briefly "Verified" described by "Verification time." }
  } with {
    briefly "Purchase was verified"
    described by "Emitted when purchase is validated."
  }

} with {
  option is external
  briefly "External IAP service"
  described by "External in-app purchase system."
}

// Item Catalog Service
context ItemCatalogService is {

  query GetStoreItems is {
    category is optional String(1, 50) with { briefly "Category" described by "Item category." }
    available is Boolean with { briefly "Available" described by "Only available." }
  } with {
    briefly "Get store items"
    described by "Retrieves store catalog."
  }

  result StoreCatalog is {
    storeItems is many StoreItem with { briefly "Items" described by "Store items." }
  } with {
    briefly "Store catalog"
    described by "Available store items."
  }

} with {
  option is external
  briefly "External catalog service"
  described by "External item catalog system."
}

// Trade Escrow Service
context TradeEscrowService is {

  command EscrowItems is {
    tradeId is UUID with { briefly "Trade" described by "Trade ID." }
    playerId is PlayerId with { briefly "Player" described by "Player ID." }
    escrowItems is many GameItem with { briefly "Items" described by "Items to escrow." }
  } with {
    briefly "Escrow items"
    described by "Holds items in escrow."
  }

  command ReleaseEscrow is {
    tradeId is UUID with { briefly "Trade" described by "Trade ID." }
    toPlayerId is PlayerId with { briefly "To player" described by "Recipient player." }
  } with {
    briefly "Release escrow"
    described by "Releases escrowed items."
  }

  event EscrowReleased is {
    tradeId is UUID with { briefly "Trade" described by "Trade ID." }
    releasedAt is TimeStamp with { briefly "Released" described by "Release time." }
  } with {
    briefly "Escrow was released"
    described by "Emitted when items are released."
  }

} with {
  option is external
  briefly "External escrow service"
  described by "External trade escrow system."
}

// Fraud Detection Service
context FraudDetectionService is {

  command CheckTransaction is {
    transactionId is TransactionId with { briefly "Transaction" described by "Transaction ID." }
    playerId is PlayerId with { briefly "Player" described by "Player ID." }
    amount is Decimal(15, 4) with { briefly "Amount" described by "Transaction amount." }
  } with {
    briefly "Check transaction"
    described by "Checks for fraudulent activity."
  }

  event TransactionChecked is {
    transactionId is TransactionId with { briefly "Transaction" described by "Transaction ID." }
    fraudulent is Boolean with { briefly "Fraudulent" described by "Is fraudulent." }
    riskScore is Decimal(5, 4) with { briefly "Risk" described by "Risk score." }
  } with {
    briefly "Transaction was checked"
    described by "Emitted when check completes."
  }

} with {
  option is external
  briefly "External fraud service"
  described by "External fraud detection system."
}

// Notification Service
context NotificationService is {

  command SendTransactionNotification is {
    playerId is PlayerId with { briefly "Player" described by "Player ID." }
    notificationTransactionType is String(1, 50) with { briefly "Type" described by "Transaction type." }
    message is String(1, 500) with { briefly "Message" described by "Notification message." }
  } with {
    briefly "Send notification"
    described by "Sends transaction notification."
  }

  event NotificationSent is {
    notificationId is UUID with { briefly "Notification" described by "Notification ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification was sent"
    described by "Emitted when notification is delivered."
  }

} with {
  option is external
  briefly "External notification service"
  described by "External player notification system."
}
