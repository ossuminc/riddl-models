// Matchmaking - Match Context
context MatchContext is {
  include "types.riddl"
  include "Match.riddl"
  // Repository for match persistence
  repository MatchRepository is {
    schema MatchData is relational
      of matches as type Match
        index on field Match.matchId
        index on field Match.gameMode

    handler MatchPersistence is {
      on command Match.CreateMatch is {
        prompt "Store match record"
      }
      on command Match.AssignServer is {
        prompt "Update match with server"
      }
      on command Match.ConfirmPlayer is {
        prompt "Update confirmed players"
      }
      on command Match.StartMatch is {
        prompt "Update match to active"
      }
      on command Match.UpdateScore is {
        prompt "Update player score"
      }
      on command Match.EndMatch is {
        prompt "Update match to completed"
      }
      on command Match.CancelMatch is {
        prompt "Update match to cancelled"
      }
      on command Match.RemovePlayer is {
        prompt "Remove player from match"
      }
    } with {
      briefly "Persists match commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Match data persistence"
    described as {
      | The MatchRepository provides persistent storage for
      | matches and matchmaking data.
    }
  }
  // Projector for matchmaking analytics
  projector MatchAnalytics is {
    record MatchStats is  {
      gameMode: GameMode with {
        briefly "Mode"
        described as {
          |Game mode.
        }
      }
      totalMatches: Natural with {
        briefly "Matches"
        described as {
          |Total matches.
        }
      }
      averageQueueTime: Duration with {
        briefly "Queue time"
        described as {
          |Avg queue time.
        }
      }
      averageMatchDuration: Duration with {
        briefly "Duration"
        described as {
          |Avg match duration.
        }
      }
      completionRate: Decimal(5,4) with {
        briefly "Completion"
        described as {
          |Completion rate.
        }
      }
      activePlayers: Natural with {
        briefly "Players"
        described as {
          |Active players.
        }
      }
    } with {
      briefly "Match statistics"
      described as {
        |Matchmaking metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Match.MatchCreated is {
        prompt "Update match counts"
      }
      on event Match.MatchStarted is {
        prompt "Update queue time metrics"
      }
      on event Match.MatchEnded is {
        prompt "Update completion metrics"
      }
    } with {
      briefly "Maintains match analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Match analytics projections"
    described as {
      |Maintains matchmaking analytics data.
    }
  }
} with {
  briefly "Bounded context for matchmaking"
  described as {
    | The MatchContext is the bounded context for player
    | matching, game sessions, and match results.
  }
}
