// Claims Processing Bounded Context
context ClaimsContext is {
  include "types.riddl"
  include "Claim.riddl"
  // Adaptors for external system integration
  adaptor PolicyAdapter from context PolicyService is { 
    handler InboundPolicy is {
      on event PolicyService.PolicyDetailsRetrieved is {
        prompt "Update claim with policy coverage details"
      }
      on event PolicyService.CoverageVerified is {
        prompt "Record coverage verification result on claim"
      }
    } with {
      briefly "Handles policy events from policy service"
      described as {
        |Processes inbound policy and coverage events for claims.
      }
    }
  } with {
    briefly "Translates policy service events"
    described as {
      | Receives policy and coverage events from the external PolicyService
      | and applies them to claim processing.
    }
  }
  adaptor PaymentAdapter from context PaymentService is { 
    handler InboundPayments is {
      on event PaymentService.PaymentProcessed is {
        tell command IssuePay to entity Claim
      }
      on event PaymentService.PaymentVoided is {
        prompt "Handle voided payment - may require reissue"
      }
    } with {
      briefly "Handles payment events from payment service"
      described as {
        |Processes payment confirmation events for claims.
      }
    }
  } with {
    briefly "Translates payment service events"
    described as {
      | Receives payment processing events from the external PaymentService
      | and updates claim payment status.
    }
  }
  adaptor FraudAdapter from context FraudDetection is { 
    handler InboundFraud is {
      on event FraudDetection.FraudAnalysisComplete is {
        prompt "Apply fraud risk score to claim and route if high risk"
      }
      on event FraudDetection.SIUReferralAccepted is {
        prompt "Mark claim as under special investigation"
      }
      on event FraudDetection.SIUInvestigationClosed is {
        prompt "Apply SIU findings to claim for decision"
      }
    } with {
      briefly "Handles fraud detection events"
      described as {
        |Processes fraud analysis and investigation events for claims.
      }
    }
  } with {
    briefly "Translates fraud detection events"
    described as {
      | Receives fraud detection events and SIU investigation updates
      | to apply to claim processing decisions.
    }
  }
  // Repository for claims persistence
  repository ClaimRepository is {
    schema ClaimData is relational
      of claims as type Claim
        index on field Claim.claimInfo.policyId
        index on field Claim.assignedAdjuster

    handler ClaimPersistence is {
      on command Claim.FileClaim is {
        prompt "Persist new claim to database"
      }
      on command Claim.AssignAdjuster is {
        prompt "Update claim with adjuster assignment"
      }
      on command Claim.InvestigateClaim is {
        prompt "Append investigation notes to claim history"
      }
      on command Claim.SetReserve is {
        prompt "Update claim reserves and financial exposure"
      }
      on command Claim.ApproveClaim is {
        prompt "Update claim with approval details"
      }
      on command Claim.IssuePay is {
        prompt "Record payment and update paid amounts"
      }
      on command Claim.DenyClaim is {
        prompt "Update claim with denial details"
      }
      on command Claim.CloseClaim is {
        prompt "Mark claim as closed with final status"
      }
    } with {
      briefly "Persists claim events to storage"
      described as {
        |Handles all event-driven persistence operations for claims.
      }
    }
    handler ClaimQueries is {
      on query FindClaimById is {
        prompt "Retrieve claim by its identifier"
      }
      on query FindClaimsByPolicy is {
        prompt "Find all claims for a specific policy"
      }
      on query FindClaimsByAdjuster is {
        prompt "Find claims assigned to an adjuster"
      }
      on query FindClaimsByStatus is {
        prompt "Find claims in a specific status"
      }
      on query FindOpenClaims is {
        prompt "Find all claims not in closed status"
      }
    } with {
      briefly "Query handler for claim repository"
      described as {
        | Provides query capabilities for retrieving claim data
        | based on various search criteria.
      }
    }
  } with {
    briefly "Persistent storage for claims"
    described as {
      | The ClaimRepository provides persistent storage for claim
      | aggregates with indexes for efficient queries by policy,
      | adjuster, and status.
    }
  }
  // Projector for loss ratio analytics
  projector LossRatioProjector is {
    record LossRatioMetric is  {
      periodStart: Date with {
        briefly "Period start"
        described as {
          |Start date of the measurement period.
        }
      }
      periodEnd: Date with {
        briefly "Period end"
        described as {
          |End date of the measurement period.
        }
      }
      policyType: String(1,50) with {
        briefly "Policy type"
        described as {
          |Type of policy being measured.
        }
      }
      earnedPremium: Decimal(14,2) with {
        briefly "Earned premium"
        described as {
          |Total premium earned during the period.
        }
      }
      incurredLosses: Decimal(14,2) with {
        briefly "Incurred losses"
        described as {
          |Total losses incurred including reserves.
        }
      }
      lossRatio: Decimal(5,4) with {
        briefly "Loss ratio"
        described as {
          |Ratio of incurred losses to earned premium.
        }
      }
      claimCount: Integer with {
        briefly "Claim count"
        described as {
          |Number of claims in the period.
        }
      }
      averageClaimSize: Decimal(12,2) with {
        briefly "Average claim size"
        described as {
          |Average incurred amount per claim.
        }
      }
    } with {
      briefly "Calculated loss ratio metrics"
      described as {
        | Aggregated financial metrics showing the ratio of claims
        | losses to earned premiums for a given period and policy type.
      }
    }
    handler LossRatioHandler is {
      on event Claim.ClaimFiled is {
        prompt "Increment claim counts for loss calculation"
      }
      on event Claim.ReserveEstablished is {
        prompt "Update incurred losses with reserve amounts"
      }
      on event Claim.PaymentIssued is {
        prompt "Record actual paid amounts to loss calculations"
      }
      on event Claim.ClaimClosed is {
        prompt "Finalize claim in loss calculations"
      }
    } with {
      briefly "Event handler for loss ratio projection"
      described as {
        | Consumes claim events to maintain real-time loss ratio
        | calculations and financial metrics.
      }
    }
  } with {
    briefly "Projector for loss ratio analytics"
    described as {
      | Maintains aggregated loss ratio metrics by consuming claim
      | lifecycle events. Provides key financial indicators for
      | underwriting and actuarial analysis.
    }
  }
  // Projector for cycle time metrics
  projector CycleTimeProjector is {
    record CycleTimeMetric is  {
      periodStart: Date with {
        briefly "Period start"
        described as {
          |Start date of the measurement period.
        }
      }
      periodEnd: Date with {
        briefly "Period end"
        described as {
          |End date of the measurement period.
        }
      }
      lossType: LossType with {
        briefly "Loss type"
        described as {
          |Type of loss being measured.
        }
      }
      averageDaysToAssign: Decimal(5,2) with {
        briefly "Days to assign"
        described as {
          |Average days from filing to adjuster assignment.
        }
      }
      averageDaysToReserve: Decimal(5,2) with {
        briefly "Days to reserve"
        described as {
          |Average days from filing to reserve establishment.
        }
      }
      averageDaysToClose: Decimal(6,2) with {
        briefly "Days to close"
        described as {
          |Average days from filing to closure.
        }
      }
      averageTouchCount: Decimal(5,2) with {
        briefly "Touch count"
        described as {
          |Average number of activities per claim.
        }
      }
      claimVolume: Integer with {
        briefly "Claim volume"
        described as {
          |Number of claims in the period.
        }
      }
    } with {
      briefly "Claims processing cycle time metrics"
      described as {
        | Operational metrics tracking the time and effort required
        | to process claims through various lifecycle stages.
      }
    }
    record ClaimCycleTracking is  {
      claimId: ClaimId with {
        briefly "Claim identifier"
        described as {
          |The claim being tracked.
        }
      }
      lossType: LossType with {
        briefly "Loss type"
        described as {
          |Type of loss for the claim.
        }
      }
      filedAt: TimeStamp with {
        briefly "Filed at"
        described as {
          |When the claim was filed.
        }
      }
      adjusterAssignedAt: TimeStamp? with {
        briefly "Assigned at"
        described as {
          |When adjuster was assigned.
        }
      }
      reserveSetAt: TimeStamp? with {
        briefly "Reserve set at"
        described as {
          |When reserves were established.
        }
      }
      claimClosedAt: TimeStamp? with {
        briefly "Closed at"
        described as {
          |When the claim was closed.
        }
      }
      touchCount: Integer with {
        briefly "Touch count"
        described as {
          |Number of activities on the claim.
        }
      }
    } with {
      briefly "Individual claim cycle tracking"
      described as {
        | Tracks timing milestones for individual claims to
        | calculate aggregate cycle time metrics.
      }
    }
    handler CycleTimeHandler is {
      on event Claim.ClaimFiled is {
        prompt "Start tracking claim cycle time"
      }
      on event Claim.AdjusterAssigned is {
        prompt "Record assignment timing milestone"
      }
      on event Claim.ReserveEstablished is {
        prompt "Record reserve timing milestone"
      }
      on event Claim.InvestigationUpdated is {
        prompt "Increment touch count for workload tracking"
      }
      on event Claim.ClaimClosed is {
        prompt "Finalize cycle time and update aggregates"
      }
    } with {
      briefly "Event handler for cycle time projection"
      described as {
        | Consumes claim events to track processing times and
        | calculate operational efficiency metrics.
      }
    }
  } with {
    briefly "Projector for claims processing efficiency metrics"
    described as {
      | Tracks and aggregates claims processing cycle times and
      | activity metrics. Provides operational KPIs for process
      | improvement and staffing decisions.
    }
  }
} with {
  briefly "Bounded context for claims processing operations"
  described as {
    | The ClaimsContext encapsulates all claims processing capabilities
    | including the Claim aggregate, persistence repository, and analytics
    | projections. It defines the boundary within which claims terminology
    | and rules have consistent meaning.
  }
}
