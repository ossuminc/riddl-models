// Claims Processing - External Contexts
// These represent external systems that Claims Processing integrates with
context PolicyService is {
  type PolicyDetails is {
    policyId: PolicyId with {
      briefly "Policy identifier"
      described as {
        |Unique identifier for the policy.
      }
    }
    policyNumber: String(1,50) with {
      briefly "Policy number"
      described as {
        |Human-readable policy number.
      }
    }
    policyholderName: String(1,200) with {
      briefly "Policyholder name"
      described as {
        |Name of the insured party.
      }
    }
    policyholderContact: String(1,200) with {
      briefly "Contact information"
      described as {
        |Contact details for the policyholder.
      }
    }
    policyType: String(1,50) with {
      briefly "Policy type"
      described as {
        |Type of insurance policy.
      }
    }
    effectiveDate: Date with {
      briefly "Effective date"
      described as {
        |When the policy became effective.
      }
    }
    expirationDate: Date with {
      briefly "Expiration date"
      described as {
        |When the policy expires.
      }
    }
    coverages: PolicyCoverage+ with {
      briefly "Coverages"
      described as {
        |List of coverages on the policy.
      }
    }
    policyStatus: String(1,20) with {
      briefly "Policy status"
      described as {
        |Current status of the policy.
      }
    }
  } with {
    briefly "Policy information from policy administration"
    described as {
      | Contains policy details retrieved from the policy administration
      | system for coverage verification and claim processing.
    }
  }
  type PolicyCoverage is {
    coverageCode: String(1,20) with {
      briefly "Coverage code"
      described as {
        |Identifier for the coverage type.
      }
    }
    coverageName: String(1,100) with {
      briefly "Coverage name"
      described as {
        |Name of the coverage.
      }
    }
    coverageLimit: Decimal(12,2) with {
      briefly "Coverage limit"
      described as {
        |Maximum amount payable for this coverage.
      }
    }
    deductible: Decimal(10,2) with {
      briefly "Deductible"
      described as {
        |Amount policyholder pays before coverage applies.
      }
    }
    effectiveDate: Date with {
      briefly "Effective date"
      described as {
        |When this coverage became effective.
      }
    }
    exclusions: String(1,500)+ with {
      briefly "Exclusions"
      described as {
        |Specific exclusions that apply to this coverage.
      }
    }
  } with {
    briefly "Individual coverage within a policy"
    described as {
      |Details of a specific coverage including limits, deductibles, and exclusions.
    }
  }
  command GetPolicyDetails is  {
    policyId: PolicyId with {
      briefly "Policy identifier"
      described as {
        |The policy to retrieve details for.
      }
    }
  } with {
    briefly "Request policy details for a claim"
    described as {
      |Retrieves full policy information needed for coverage analysis.
    }
  }
  command VerifyCoverage is  {
    policyId: PolicyId with {
      briefly "Policy identifier"
      described as {
        |The policy to verify coverage for.
      }
    }
    lossDate: Date with {
      briefly "Loss date"
      described as {
        |Date the loss occurred.
      }
    }
    lossType: LossType with {
      briefly "Loss type"
      described as {
        |Type of loss being claimed.
      }
    }
  } with {
    briefly "Verify coverage exists for a loss"
    described as {
      |Checks whether the policy was active and had coverage on the loss date.
    }
  }
  event PolicyDetailsRetrieved is  {
    policyId: PolicyId with {
      briefly "Policy identifier"
      described as {
        |The policy that was retrieved.
      }
    }
    policyDetails: PolicyDetails with {
      briefly "Policy details"
      described as {
        |The retrieved policy information.
      }
    }
  } with {
    briefly "Policy details have been retrieved"
    described as {
      |Response event containing policy information for claim processing.
    }
  }
  event CoverageVerified is  {
    policyId: PolicyId with {
      briefly "Policy identifier"
      described as {
        |The policy that was verified.
      }
    }
    lossDate: Date with {
      briefly "Loss date"
      described as {
        |The date coverage was verified for.
      }
    }
    lossType: LossType with {
      briefly "Loss type"
      described as {
        |Type of loss verified.
      }
    }
    isCovered: Boolean with {
      briefly "Is covered"
      described as {
        |Whether the loss is covered.
      }
    }
    applicableCoverage: PolicyCoverage? with {
      briefly "Applicable coverage"
      described as {
        |The coverage that applies, if any.
      }
    }
    verificationNotes: String(1,1000) with {
      briefly "Verification notes"
      described as {
        |Notes from the coverage verification.
      }
    }
  } with {
    briefly "Coverage verification result"
    described as {
      |Response event indicating whether coverage applies to the reported loss.
    }
  }
  handler PolicyHandler is {
    on command GetPolicyDetails is {
      tell event PolicyDetailsRetrieved to context PolicyService
    }
    on command VerifyCoverage is {
      tell event CoverageVerified to context PolicyService
    }
  } with {
    briefly "Handles policy commands"
    described as {
      |Processes policy lookup and coverage verification requests.
    }
  }
} with {
  briefly "External policy administration system"
  option external()
  described as {
    | Integration with the policy administration system to retrieve
    | policy details and verify coverage during claims processing.
    | This is a bounded context owned by the policy administration
    | domain that claims must integrate with.
  }
}
context PaymentService is {
  type PaymentRequest is {
    requestId: String(1,50) with {
      briefly "Request identifier"
      described as {
        |Unique identifier for this payment request.
      }
    }
    claimId: ClaimId with {
      briefly "Claim identifier"
      described as {
        |The claim this payment is for.
      }
    }
    payeeType: String(1,50) with {
      briefly "Payee type"
      described as {
        |Type of payee receiving the payment.
      }
    }
    payeeName: String(1,200) with {
      briefly "Payee name"
      described as {
        |Name of the payment recipient.
      }
    }
    payeeAddress: String(1,500) with {
      briefly "Payee address"
      described as {
        |Mailing address for check payments.
      }
    }
    paymentAmount: Decimal(12,2) with {
      briefly "Payment amount"
      described as {
        |Dollar amount to pay.
      }
    }
    paymentMethod: String(1,50) with {
      briefly "Payment method"
      described as {
        |Method of payment such as check or ACH.
      }
    }
    bankRoutingNumber: String(1,20)? with {
      briefly "Routing number"
      described as {
        |Bank routing number for ACH payments.
      }
    }
    bankAccountNumber: String(1,20)? with {
      briefly "Account number"
      described as {
        |Bank account number for ACH payments.
      }
    }
    paymentMemo: String(1,200) with {
      briefly "Payment memo"
      described as {
        |Memo or note on the payment.
      }
    }
  } with {
    briefly "Request to issue a claim payment"
    described as {
      |Contains all information needed to process a claim payment.
    }
  }
  type PaymentResult is {
    requestId: String(1,50) with {
      briefly "Request identifier"
      described as {
        |The original request this result is for.
      }
    }
    paymentId: String(1,50) with {
      briefly "Payment identifier"
      described as {
        |Identifier assigned to the payment.
      }
    }
    paymentStatus: String(1,20) with {
      briefly "Payment status"
      described as {
        |Status of the payment processing.
      }
    }
    checkNumber: String(1,50)? with {
      briefly "Check number"
      described as {
        |Check number if paid by check.
      }
    }
    confirmationNumber: String(1,50)? with {
      briefly "Confirmation number"
      described as {
        |Confirmation number for ACH payments.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed timestamp"
      described as {
        |When the payment was processed.
      }
    }
    errorMessage: String(1,500)? with {
      briefly "Error message"
      described as {
        |Error message if payment failed.
      }
    }
  } with {
    briefly "Result of payment processing"
    described as {
      |Confirmation of payment processing including identifiers and status.
    }
  }
  command RequestPayment is  {
    paymentRequest: PaymentRequest with {
      briefly "Payment request"
      described as {
        |The payment request details.
      }
    }
  } with {
    briefly "Request issuance of a claim payment"
    described as {
      |Submits a payment request to the payment processing system.
    }
  }
  command VoidPayment is  {
    paymentId: String(1,50) with {
      briefly "Payment identifier"
      described as {
        |The payment to void.
      }
    }
    voidReason: String(1,500) with {
      briefly "Void reason"
      described as {
        |Reason for voiding the payment.
      }
    }
  } with {
    briefly "Void a previously issued payment"
    described as {
      |Requests cancellation of a payment not yet cashed.
    }
  }
  event PaymentProcessed is  {
    claimId: ClaimId with {
      briefly "Claim identifier"
      described as {
        |The claim the payment was for.
      }
    }
    paymentResult: PaymentResult with {
      briefly "Payment result"
      described as {
        |Result of the payment processing.
      }
    }
  } with {
    briefly "Payment has been processed"
    described as {
      |Notification that a payment request has been processed.
    }
  }
  event PaymentVoided is  {
    paymentId: String(1,50) with {
      briefly "Payment identifier"
      described as {
        |The payment that was voided.
      }
    }
    voidedAt: TimeStamp with {
      briefly "Voided timestamp"
      described as {
        |When the payment was voided.
      }
    }
    voidReason: String(1,500) with {
      briefly "Void reason"
      described as {
        |Why the payment was voided.
      }
    }
  } with {
    briefly "Payment has been voided"
    described as {
      |Confirmation that a payment has been successfully voided.
    }
  }
  handler PaymentHandler is {
    on command RequestPayment is {
      tell event PaymentProcessed to context PaymentService
    }
    on command VoidPayment is {
      tell event PaymentVoided to context PaymentService
    }
  } with {
    briefly "Handles payment commands"
    described as {
      |Processes payment requests and void requests.
    }
  }
} with {
  briefly "External payment processing service"
  option external()
  described as {
    | Integration with the corporate payment processing system for
    | issuing claim payments via check, ACH, or other methods.
    | Handles payment disbursement, tracking, and reconciliation.
  }
}
context FraudDetection is {
  type FraudAlert is {
    alertId: String(1,50) with {
      briefly "Alert identifier"
      described as {
        |Unique identifier for this alert.
      }
    }
    claimId: ClaimId with {
      briefly "Claim identifier"
      described as {
        |The claim this alert is for.
      }
    }
    riskScore: Decimal(5,2) with {
      briefly "Risk score"
      described as {
        |Numeric fraud risk score.
      }
    }
    riskLevel: String(1,20) with {
      briefly "Risk level"
      described as {
        |Risk level such as low, medium, or high.
      }
    }
    indicators: FraudIndicator+ with {
      briefly "Fraud indicators"
      described as {
        |Specific indicators that triggered the alert.
      }
    }
    recommendedAction: String(1,100) with {
      briefly "Recommended action"
      described as {
        |Suggested action based on risk assessment.
      }
    }
    alertedAt: TimeStamp with {
      briefly "Alerted timestamp"
      described as {
        |When the alert was generated.
      }
    }
  } with {
    briefly "Fraud detection alert for a claim"
    described as {
      |Alert generated when suspicious patterns are identified in a claim.
    }
  }
  type FraudIndicator is {
    indicatorCode: String(1,20) with {
      briefly "Indicator code"
      described as {
        |Code identifying the indicator type.
      }
    }
    indicatorName: String(1,100) with {
      briefly "Indicator name"
      described as {
        |Human-readable name of the indicator.
      }
    }
    indicatorWeight: Decimal(5,2) with {
      briefly "Indicator weight"
      described as {
        |Weight of this indicator in the risk score.
      }
    }
    description: String(1,500) with {
      briefly "Description"
      described as {
        |Description of what triggered this indicator.
      }
    }
  } with {
    briefly "Individual fraud risk indicator"
    described as {
      |Specific pattern or characteristic contributing to fraud risk score.
    }
  }
  type FraudInvestigation is {
    investigationId: String(1,50) with {
      briefly "Investigation identifier"
      described as {
        |Unique identifier for the SIU investigation.
      }
    }
    claimId: ClaimId with {
      briefly "Claim identifier"
      described as {
        |The claim under investigation.
      }
    }
    investigationStatus: String(1,20) with {
      briefly "Investigation status"
      described as {
        |Current status of the investigation.
      }
    }
    assignedTo: String(1,100) with {
      briefly "Assigned to"
      described as {
        |SIU investigator assigned to the case.
      }
    }
    findings: String(1,4000)? with {
      briefly "Findings"
      described as {
        |Investigation findings if complete.
      }
    }
    conclusion: String(1,100)? with {
      briefly "Conclusion"
      described as {
        |Final conclusion of the investigation.
      }
    }
    investigationClosedAt: TimeStamp? with {
      briefly "Closed timestamp"
      described as {
        |When the investigation was closed.
      }
    }
  } with {
    briefly "Special investigation unit case"
    described as {
      |Tracks SIU review of claims flagged for potential fraud.
    }
  }
  command AnalyzeClaim is  {
    claimId: ClaimId with {
      briefly "Claim identifier"
      described as {
        |The claim to analyze for fraud.
      }
    }
    claimInfo: ClaimInfo with {
      briefly "Claim information"
      described as {
        |Details of the claim being analyzed.
      }
    }
    policyHistory: String(1,2000) with {
      briefly "Policy history"
      described as {
        |Historical information about the policy and claimant.
      }
    }
  } with {
    briefly "Request fraud analysis of a claim"
    described as {
      |Submits claim information to fraud detection for risk scoring.
    }
  }
  command ReferToSIU is  {
    claimId: ClaimId with {
      briefly "Claim identifier"
      described as {
        |The claim to refer to SIU.
      }
    }
    referralReason: String(1,1000) with {
      briefly "Referral reason"
      described as {
        |Reason for referring to special investigation.
      }
    }
    supportingEvidence: String(1,4000) with {
      briefly "Supporting evidence"
      described as {
        |Evidence supporting the fraud suspicion.
      }
    }
  } with {
    briefly "Refer claim to Special Investigation Unit"
    described as {
      |Escalates a claim for formal fraud investigation by SIU.
    }
  }
  event FraudAnalysisComplete is  {
    claimId: ClaimId with {
      briefly "Claim identifier"
      described as {
        |The claim that was analyzed.
      }
    }
    fraudAlert: FraudAlert? with {
      briefly "Fraud alert"
      described as {
        |Alert if fraud indicators were detected.
      }
    }
  } with {
    briefly "Fraud analysis has been completed"
    described as {
      |Response from fraud detection with risk assessment.
    }
  }
  event SIUReferralAccepted is  {
    investigationId: String(1,50) with {
      briefly "Investigation identifier"
      described as {
        |Identifier for the new SIU case.
      }
    }
    claimId: ClaimId with {
      briefly "Claim identifier"
      described as {
        |The claim referred to SIU.
      }
    }
    acceptedAt: TimeStamp with {
      briefly "Accepted timestamp"
      described as {
        |When SIU accepted the referral.
      }
    }
  } with {
    briefly "SIU has accepted the referral"
    described as {
      |Confirmation that SIU has accepted the claim for investigation.
    }
  }
  event SIUInvestigationClosed is  {
    investigation: FraudInvestigation with {
      briefly "Investigation"
      described as {
        |The completed investigation details.
      }
    }
  } with {
    briefly "SIU investigation has concluded"
    described as {
      |Notification that SIU investigation is complete with findings.
    }
  }
  handler FraudHandler is {
    on command AnalyzeClaim is {
      tell event FraudAnalysisComplete to context FraudDetection
    }
    on command ReferToSIU is {
      tell event SIUReferralAccepted to context FraudDetection
    }
  } with {
    briefly "Handles fraud detection commands"
    described as {
      |Processes fraud analysis requests and SIU referrals.
    }
  }
} with {
  briefly "External fraud detection and investigation service"
  option external()
  described as {
    | Integration with fraud detection systems that analyze claims
    | for suspicious patterns using predictive analytics, link analysis,
    | and business rules. Includes referral workflow for Special
    | Investigation Unit (SIU) cases requiring human investigation.
  }
}
