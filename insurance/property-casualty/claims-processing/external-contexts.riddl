// Claims Processing - External Contexts
// These represent external systems that Claims Processing integrates with

context PolicyService is {

  type PolicyDetails is {
    policyId is PolicyId with {
      briefly "Policy identifier"
      described by "Unique identifier for the policy."
    }
    policyNumber is String(1, 50) with {
      briefly "Policy number"
      described by "Human-readable policy number."
    }
    policyholderName is String(1, 200) with {
      briefly "Policyholder name"
      described by "Name of the insured party."
    }
    policyholderContact is String(1, 200) with {
      briefly "Contact information"
      described by "Contact details for the policyholder."
    }
    policyType is String(1, 50) with {
      briefly "Policy type"
      described by "Type of insurance policy."
    }
    effectiveDate is Date with {
      briefly "Effective date"
      described by "When the policy became effective."
    }
    expirationDate is Date with {
      briefly "Expiration date"
      described by "When the policy expires."
    }
    coverages is many PolicyCoverage with {
      briefly "Coverages"
      described by "List of coverages on the policy."
    }
    policyStatus is String(1, 20) with {
      briefly "Policy status"
      described by "Current status of the policy."
    }
  } with {
    briefly "Policy information from policy administration"
    described by {
      | Contains policy details retrieved from the policy administration
      | system for coverage verification and claim processing.
    }
  }

  type PolicyCoverage is {
    coverageCode is String(1, 20) with {
      briefly "Coverage code"
      described by "Identifier for the coverage type."
    }
    coverageName is String(1, 100) with {
      briefly "Coverage name"
      described by "Name of the coverage."
    }
    coverageLimit is Decimal(12, 2) with {
      briefly "Coverage limit"
      described by "Maximum amount payable for this coverage."
    }
    deductible is Decimal(10, 2) with {
      briefly "Deductible"
      described by "Amount policyholder pays before coverage applies."
    }
    effectiveDate is Date with {
      briefly "Effective date"
      described by "When this coverage became effective."
    }
    exclusions is many String(1, 500) with {
      briefly "Exclusions"
      described by "Specific exclusions that apply to this coverage."
    }
  } with {
    briefly "Individual coverage within a policy"
    described by "Details of a specific coverage including limits, deductibles, and exclusions."
  }

  command GetPolicyDetails is {
    policyId is PolicyId with {
      briefly "Policy identifier"
      described by "The policy to retrieve details for."
    }
  } with {
    briefly "Request policy details for a claim"
    described by "Retrieves full policy information needed for coverage analysis."
  }

  command VerifyCoverage is {
    policyId is PolicyId with {
      briefly "Policy identifier"
      described by "The policy to verify coverage for."
    }
    lossDate is Date with {
      briefly "Loss date"
      described by "Date the loss occurred."
    }
    lossType is LossType with {
      briefly "Loss type"
      described by "Type of loss being claimed."
    }
  } with {
    briefly "Verify coverage exists for a loss"
    described by "Checks whether the policy was active and had coverage on the loss date."
  }

  event PolicyDetailsRetrieved is {
    policyId is PolicyId with {
      briefly "Policy identifier"
      described by "The policy that was retrieved."
    }
    policyDetails is PolicyDetails with {
      briefly "Policy details"
      described by "The retrieved policy information."
    }
  } with {
    briefly "Policy details have been retrieved"
    described by "Response event containing policy information for claim processing."
  }

  event CoverageVerified is {
    policyId is PolicyId with {
      briefly "Policy identifier"
      described by "The policy that was verified."
    }
    lossDate is Date with {
      briefly "Loss date"
      described by "The date coverage was verified for."
    }
    lossType is LossType with {
      briefly "Loss type"
      described by "Type of loss verified."
    }
    isCovered is Boolean with {
      briefly "Is covered"
      described by "Whether the loss is covered."
    }
    applicableCoverage is optional PolicyCoverage with {
      briefly "Applicable coverage"
      described by "The coverage that applies, if any."
    }
    verificationNotes is String(1, 1000) with {
      briefly "Verification notes"
      described by "Notes from the coverage verification."
    }
  } with {
    briefly "Coverage verification result"
    described by "Response event indicating whether coverage applies to the reported loss."
  }

  handler PolicyHandler is {
    on command GetPolicyDetails {
      tell event PolicyDetailsRetrieved to context PolicyService
    }
    on command VerifyCoverage {
      tell event CoverageVerified to context PolicyService
    }
  } with {
    briefly "Handles policy commands"
    described by "Processes policy lookup and coverage verification requests."
  }

} with {
  briefly "External policy administration system"
  option is external
  described by {
    | Integration with the policy administration system to retrieve
    | policy details and verify coverage during claims processing.
    | This is a bounded context owned by the policy administration
    | domain that claims must integrate with.
  }
}

context PaymentService is {

  type PaymentRequest is {
    requestId is String(1, 50) with {
      briefly "Request identifier"
      described by "Unique identifier for this payment request."
    }
    claimId is ClaimId with {
      briefly "Claim identifier"
      described by "The claim this payment is for."
    }
    payeeType is String(1, 50) with {
      briefly "Payee type"
      described by "Type of payee receiving the payment."
    }
    payeeName is String(1, 200) with {
      briefly "Payee name"
      described by "Name of the payment recipient."
    }
    payeeAddress is String(1, 500) with {
      briefly "Payee address"
      described by "Mailing address for check payments."
    }
    paymentAmount is Decimal(12, 2) with {
      briefly "Payment amount"
      described by "Dollar amount to pay."
    }
    paymentMethod is String(1, 50) with {
      briefly "Payment method"
      described by "Method of payment such as check or ACH."
    }
    bankRoutingNumber is optional String(1, 20) with {
      briefly "Routing number"
      described by "Bank routing number for ACH payments."
    }
    bankAccountNumber is optional String(1, 20) with {
      briefly "Account number"
      described by "Bank account number for ACH payments."
    }
    paymentMemo is String(1, 200) with {
      briefly "Payment memo"
      described by "Memo or note on the payment."
    }
  } with {
    briefly "Request to issue a claim payment"
    described by "Contains all information needed to process a claim payment."
  }

  type PaymentResult is {
    requestId is String(1, 50) with {
      briefly "Request identifier"
      described by "The original request this result is for."
    }
    paymentId is String(1, 50) with {
      briefly "Payment identifier"
      described by "Identifier assigned to the payment."
    }
    paymentStatus is String(1, 20) with {
      briefly "Payment status"
      described by "Status of the payment processing."
    }
    checkNumber is optional String(1, 50) with {
      briefly "Check number"
      described by "Check number if paid by check."
    }
    confirmationNumber is optional String(1, 50) with {
      briefly "Confirmation number"
      described by "Confirmation number for ACH payments."
    }
    processedAt is TimeStamp with {
      briefly "Processed timestamp"
      described by "When the payment was processed."
    }
    errorMessage is optional String(1, 500) with {
      briefly "Error message"
      described by "Error message if payment failed."
    }
  } with {
    briefly "Result of payment processing"
    described by "Confirmation of payment processing including identifiers and status."
  }

  command RequestPayment is {
    paymentRequest is PaymentRequest with {
      briefly "Payment request"
      described by "The payment request details."
    }
  } with {
    briefly "Request issuance of a claim payment"
    described by "Submits a payment request to the payment processing system."
  }

  command VoidPayment is {
    paymentId is String(1, 50) with {
      briefly "Payment identifier"
      described by "The payment to void."
    }
    voidReason is String(1, 500) with {
      briefly "Void reason"
      described by "Reason for voiding the payment."
    }
  } with {
    briefly "Void a previously issued payment"
    described by "Requests cancellation of a payment not yet cashed."
  }

  event PaymentProcessed is {
    claimId is ClaimId with {
      briefly "Claim identifier"
      described by "The claim the payment was for."
    }
    paymentResult is PaymentResult with {
      briefly "Payment result"
      described by "Result of the payment processing."
    }
  } with {
    briefly "Payment has been processed"
    described by "Notification that a payment request has been processed."
  }

  event PaymentVoided is {
    paymentId is String(1, 50) with {
      briefly "Payment identifier"
      described by "The payment that was voided."
    }
    voidedAt is TimeStamp with {
      briefly "Voided timestamp"
      described by "When the payment was voided."
    }
    voidReason is String(1, 500) with {
      briefly "Void reason"
      described by "Why the payment was voided."
    }
  } with {
    briefly "Payment has been voided"
    described by "Confirmation that a payment has been successfully voided."
  }

  handler PaymentHandler is {
    on command RequestPayment {
      tell event PaymentProcessed to context PaymentService
    }
    on command VoidPayment {
      tell event PaymentVoided to context PaymentService
    }
  } with {
    briefly "Handles payment commands"
    described by "Processes payment requests and void requests."
  }

} with {
  briefly "External payment processing service"
  option is external
  described by {
    | Integration with the corporate payment processing system for
    | issuing claim payments via check, ACH, or other methods.
    | Handles payment disbursement, tracking, and reconciliation.
  }
}

context FraudDetection is {

  type FraudAlert is {
    alertId is String(1, 50) with {
      briefly "Alert identifier"
      described by "Unique identifier for this alert."
    }
    claimId is ClaimId with {
      briefly "Claim identifier"
      described by "The claim this alert is for."
    }
    riskScore is Decimal(5, 2) with {
      briefly "Risk score"
      described by "Numeric fraud risk score."
    }
    riskLevel is String(1, 20) with {
      briefly "Risk level"
      described by "Risk level such as low, medium, or high."
    }
    indicators is many FraudIndicator with {
      briefly "Fraud indicators"
      described by "Specific indicators that triggered the alert."
    }
    recommendedAction is String(1, 100) with {
      briefly "Recommended action"
      described by "Suggested action based on risk assessment."
    }
    alertedAt is TimeStamp with {
      briefly "Alerted timestamp"
      described by "When the alert was generated."
    }
  } with {
    briefly "Fraud detection alert for a claim"
    described by "Alert generated when suspicious patterns are identified in a claim."
  }

  type FraudIndicator is {
    indicatorCode is String(1, 20) with {
      briefly "Indicator code"
      described by "Code identifying the indicator type."
    }
    indicatorName is String(1, 100) with {
      briefly "Indicator name"
      described by "Human-readable name of the indicator."
    }
    indicatorWeight is Decimal(5, 2) with {
      briefly "Indicator weight"
      described by "Weight of this indicator in the risk score."
    }
    description is String(1, 500) with {
      briefly "Description"
      described by "Description of what triggered this indicator."
    }
  } with {
    briefly "Individual fraud risk indicator"
    described by "Specific pattern or characteristic contributing to fraud risk score."
  }

  type FraudInvestigation is {
    investigationId is String(1, 50) with {
      briefly "Investigation identifier"
      described by "Unique identifier for the SIU investigation."
    }
    claimId is ClaimId with {
      briefly "Claim identifier"
      described by "The claim under investigation."
    }
    investigationStatus is String(1, 20) with {
      briefly "Investigation status"
      described by "Current status of the investigation."
    }
    assignedTo is String(1, 100) with {
      briefly "Assigned to"
      described by "SIU investigator assigned to the case."
    }
    findings is optional String(1, 4000) with {
      briefly "Findings"
      described by "Investigation findings if complete."
    }
    conclusion is optional String(1, 100) with {
      briefly "Conclusion"
      described by "Final conclusion of the investigation."
    }
    investigationClosedAt is optional TimeStamp with {
      briefly "Closed timestamp"
      described by "When the investigation was closed."
    }
  } with {
    briefly "Special investigation unit case"
    described by "Tracks SIU review of claims flagged for potential fraud."
  }

  command AnalyzeClaim is {
    claimId is ClaimId with {
      briefly "Claim identifier"
      described by "The claim to analyze for fraud."
    }
    claimInfo is ClaimInfo with {
      briefly "Claim information"
      described by "Details of the claim being analyzed."
    }
    policyHistory is String(1, 2000) with {
      briefly "Policy history"
      described by "Historical information about the policy and claimant."
    }
  } with {
    briefly "Request fraud analysis of a claim"
    described by "Submits claim information to fraud detection for risk scoring."
  }

  command ReferToSIU is {
    claimId is ClaimId with {
      briefly "Claim identifier"
      described by "The claim to refer to SIU."
    }
    referralReason is String(1, 1000) with {
      briefly "Referral reason"
      described by "Reason for referring to special investigation."
    }
    supportingEvidence is String(1, 4000) with {
      briefly "Supporting evidence"
      described by "Evidence supporting the fraud suspicion."
    }
  } with {
    briefly "Refer claim to Special Investigation Unit"
    described by "Escalates a claim for formal fraud investigation by SIU."
  }

  event FraudAnalysisComplete is {
    claimId is ClaimId with {
      briefly "Claim identifier"
      described by "The claim that was analyzed."
    }
    fraudAlert is optional FraudAlert with {
      briefly "Fraud alert"
      described by "Alert if fraud indicators were detected."
    }
  } with {
    briefly "Fraud analysis has been completed"
    described by "Response from fraud detection with risk assessment."
  }

  event SIUReferralAccepted is {
    investigationId is String(1, 50) with {
      briefly "Investigation identifier"
      described by "Identifier for the new SIU case."
    }
    claimId is ClaimId with {
      briefly "Claim identifier"
      described by "The claim referred to SIU."
    }
    acceptedAt is TimeStamp with {
      briefly "Accepted timestamp"
      described by "When SIU accepted the referral."
    }
  } with {
    briefly "SIU has accepted the referral"
    described by "Confirmation that SIU has accepted the claim for investigation."
  }

  event SIUInvestigationClosed is {
    investigation is FraudInvestigation with {
      briefly "Investigation"
      described by "The completed investigation details."
    }
  } with {
    briefly "SIU investigation has concluded"
    described by "Notification that SIU investigation is complete with findings."
  }

  handler FraudHandler is {
    on command AnalyzeClaim {
      tell event FraudAnalysisComplete to context FraudDetection
    }
    on command ReferToSIU {
      tell event SIUReferralAccepted to context FraudDetection
    }
  } with {
    briefly "Handles fraud detection commands"
    described by "Processes fraud analysis requests and SIU referrals."
  }

} with {
  briefly "External fraud detection and investigation service"
  option is external
  described by {
    | Integration with fraud detection systems that analyze claims
    | for suspicious patterns using predictive analytics, link analysis,
    | and business rules. Includes referral workflow for Special
    | Investigation Unit (SIU) cases requiring human investigation.
  }
}
