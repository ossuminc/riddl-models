// Policy Administration - External Contexts
// Rating Engine - External premium calculation service
context RatingEngine is {
  type RatingFactors is {
    territoryCode: String(1,10) with {
      briefly "Territory"
      described as {
        |Geographic territory code.
      }
    }
    classCode: String(1,10) with {
      briefly "Class"
      described as {
        |Risk classification code.
      }
    }
    yearsWithCarrier: Integer with {
      briefly "Years"
      described as {
        |Years with carrier.
      }
    }
    claimsCount: Integer with {
      briefly "Claims"
      described as {
        |Number of prior claims.
      }
    }
    creditScore: Integer? with {
      briefly "Credit"
      described as {
        |Insurance credit score.
      }
    }
    protectionClass: String(1,5) with {
      briefly "Protection"
      described as {
        |Fire protection class.
      }
    }
  } with {
    briefly "Rating factors"
    described as {
      |Factors used in premium calculation.
    }
  }
  command RatePolicy is  {
    policyDetails: PolicyDetails with {
      briefly "Details"
      described as {
        |Policy details to rate.
      }
    }
    ratingFactors: RatingFactors with {
      briefly "Factors"
      described as {
        |Rating factors.
      }
    }
  } with {
    briefly "Rate policy"
    described as {
      |Calculates premium for a policy.
    }
  }
  command RateEndorsement is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy identifier.
      }
    }
    endorsementDetails: EndorsementInfo with {
      briefly "Endorsement"
      described as {
        |Endorsement to rate.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Endorsement effective date.
      }
    }
  } with {
    briefly "Rate endorsement"
    described as {
      |Calculates premium change for an endorsement.
    }
  }
  command RateRenewal is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy identifier.
      }
    }
    currentDetails: PolicyDetails with {
      briefly "Current"
      described as {
        |Current policy details.
      }
    }
    proposedChanges: PolicyDetails? with {
      briefly "Proposed"
      described as {
        |Proposed changes.
      }
    }
  } with {
    briefly "Rate renewal"
    described as {
      |Calculates premium for policy renewal.
    }
  }
  event PolicyRated is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy ID.
      }
    }
    basePremium: Decimal(12,2) with {
      briefly "Base"
      described as {
        |Base premium.
      }
    }
    discounts: Decimal(10,2) with {
      briefly "Discounts"
      described as {
        |Total discounts.
      }
    }
    surcharges: Decimal(10,2) with {
      briefly "Surcharges"
      described as {
        |Total surcharges.
      }
    }
    finalPremium: Decimal(12,2) with {
      briefly "Final"
      described as {
        |Final premium.
      }
    }
    ratedAt: TimeStamp with {
      briefly "Rated at"
      described as {
        |Rating time.
      }
    }
  } with {
    briefly "Policy rated"
    described as {
      |Emitted when premium calculation completes.
    }
  }
} with {
  option external()
  briefly "External rating engine"
  described as {
    |External system for premium calculation and rating.
  }
}
// Document Service - External document generation
context DocumentService is {
  command GeneratePolicyDocuments is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy identifier.
      }
    }
    documentTypes: String(1,50)+ with {
      briefly "Types"
      described as {
        |Document types to generate.
      }
    }
  } with {
    briefly "Generate documents"
    described as {
      |Generates policy documents.
    }
  }
  command GenerateRenewalNotice is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy identifier.
      }
    }
    renewalOffer: RenewalOffer with {
      briefly "Offer"
      described as {
        |Renewal offer details.
      }
    }
  } with {
    briefly "Generate renewal notice"
    described as {
      |Generates renewal notice document.
    }
  }
  command GenerateCancellationNotice is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy identifier.
      }
    }
    cancellationDate: Date with {
      briefly "Date"
      described as {
        |Cancellation effective date.
      }
    }
    reason: CancellationReason with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
  } with {
    briefly "Generate cancellation notice"
    described as {
      |Generates cancellation notice document.
    }
  }
  event DocumentGenerated is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy ID.
      }
    }
    documentType: String(1,50) with {
      briefly "Type"
      described as {
        |Document type.
      }
    }
    documentId: UUID with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    generatedAt: TimeStamp with {
      briefly "Generated"
      described as {
        |Generation time.
      }
    }
  } with {
    briefly "Document generated"
    described as {
      |Emitted when a document is generated.
    }
  }
} with {
  option external()
  briefly "External document service"
  described as {
    |External system for document generation and delivery.
  }
}
// Billing Service - External billing and payment
context BillingService is {
  command SetupBilling is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy identifier.
      }
    }
    schedule: BillingSchedule with {
      briefly "Schedule"
      described as {
        |Billing schedule.
      }
    }
    totalPremium: Decimal(12,2) with {
      briefly "Premium"
      described as {
        |Total premium amount.
      }
    }
  } with {
    briefly "Setup billing"
    described as {
      |Sets up billing for a new policy.
    }
  }
  command AdjustBilling is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy identifier.
      }
    }
    adjustmentAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Adjustment amount.
      }
    }
    adjustmentReason: String(1,200) with {
      briefly "Adjustment Reason"
      described as {
        |Adjustment reason.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Adjustment effective date.
      }
    }
  } with {
    briefly "Adjust billing"
    described as {
      |Adjusts billing for premium change.
    }
  }
  command ProcessRefund is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy identifier.
      }
    }
    refundAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    refundReason: String(1,200) with {
      briefly "Refund Reason"
      described as {
        |Refund reason.
      }
    }
  } with {
    briefly "Process refund"
    described as {
      |Processes a premium refund.
    }
  }
  command SuspendBilling is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy identifier.
      }
    }
    suspensionDate: Date with {
      briefly "Date"
      described as {
        |Suspension date.
      }
    }
  } with {
    briefly "Suspend billing"
    described as {
      |Suspends billing on a policy.
    }
  }
  event BillingSetupComplete is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy ID.
      }
    }
    firstDueDate: Date with {
      briefly "First due"
      described as {
        |First payment due date.
      }
    }
    installmentAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Installment amount.
      }
    }
  } with {
    briefly "Billing setup complete"
    described as {
      |Emitted when billing is established.
    }
  }
  event PaymentReceived is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    paymentDate: Date with {
      briefly "Date"
      described as {
        |Payment date.
      }
    }
    paymentMethod: String(1,30) with {
      briefly "Method"
      described as {
        |Payment method.
      }
    }
  } with {
    briefly "Payment received"
    described as {
      |Emitted when a payment is received.
    }
  }
  event PaymentPastDue is  {
    policyId: PolicyId with {
      briefly "Policy"
      described as {
        |Policy ID.
      }
    }
    amountDue: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Amount due.
      }
    }
    dueDate: Date with {
      briefly "Due date"
      described as {
        |Original due date.
      }
    }
    daysPastDue: Integer with {
      briefly "Days"
      described as {
        |Days past due.
      }
    }
  } with {
    briefly "Payment past due"
    described as {
      |Emitted when a payment is past due.
    }
  }
} with {
  option external()
  briefly "External billing service"
  described as {
    |External system for billing and payment processing.
  }
}
