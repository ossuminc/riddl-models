// Treaty Context
// Bounded context for treaty management operations

context TreatyContext is {

  include "Treaty.riddl"

  type TreatyEventRecord is {
    eventType is String(1, 50) with { briefly "Type" described by "Event type name." }
    treatyId is TreatyId with { briefly "Treaty ID" described by "Related treaty." }
    payload is String(1, 10000) with { briefly "Payload" described by "Event data." }
    timestamp is TimeStamp with { briefly "Timestamp" described by "Event time." }
  } with {
    briefly "Structure for treaty domain events"
    described by "Standard structure for treaty lifecycle events."
  }

  repository TreatyRepository is {

    query FindTreatyById is {
      treatyId is TreatyId with { briefly "Treaty ID" described by "Treaty to find." }
    } with { briefly "Query to find treaty by ID" }

    query FindTreatiesByCedent is {
      cedingCompanyId is String(1, 100) with { briefly "Cedent" described by "Ceding company ID." }
      includeExpired is Boolean with { briefly "Include expired" described by "Include expired treaties." }
    } with { briefly "Query to find treaties by ceding company" }

    query FindTreatiesByReinsurer is {
      reinsurerId is String(1, 100) with { briefly "Reinsurer" described by "Reinsurer ID." }
      includeExpired is Boolean with { briefly "Include expired" described by "Include expired treaties." }
    } with { briefly "Query to find treaties by reinsurer" }

    query FindActiveTreaties is {
      queryAsOfDate is optional Date with { briefly "As of" described by "Reference date." }
    } with { briefly "Query to find active treaties" }

    query FindExpiringTreaties is {
      startDate is Date with { briefly "Start" described by "Range start." }
      endDate is Date with { briefly "End" described by "Range end." }
    } with { briefly "Query to find expiring treaties" }

    query FindTreatiesByStatus is {
      status is TreatyStatus with { briefly "Status" described by "Status to filter." }
    } with { briefly "Query to find treaties by status" }

    query GetTreatyHistory is {
      treatyId is TreatyId with { briefly "Treaty ID" described by "Treaty to query." }
      fromDate is optional Date with { briefly "From" described by "History start date." }
      toDate is optional Date with { briefly "To" described by "History end date." }
    } with { briefly "Query to get treaty change history" }

    result TreatyRecord is {
      treatyId is TreatyId with { briefly "Treaty ID" described by "Treaty identifier." }
      cedingCompanyId is String(1, 100) with { briefly "Cedent" described by "Ceding company." }
      reinsurerId is String(1, 100) with { briefly "Reinsurer" described by "Reinsurer." }
      status is TreatyStatus with { briefly "Status" described by "Current status." }
      terms is TreatyTerms with { briefly "Terms" described by "Treaty terms." }
      commission is CommissionInfo with { briefly "Commission" described by "Commission info." }
      treatyExecutionDate is optional Date with { briefly "Executed" described by "Execution date." }
      cumulativeCededPremium is optional MonetaryAmount with { briefly "Premium" described by "Total ceded premium." }
      cumulativePaidLosses is optional MonetaryAmount with { briefly "Losses" described by "Total paid losses." }
    } with { briefly "Treaty data returned from queries" }

    result TreatyList is {
      treaties is many TreatyRecord with { briefly "Treaties" described by "Treaty records." }
      totalCount is Integer with { briefly "Count" described by "Total count." }
    } with { briefly "List of treaties from search queries" }

    handler TreatyQueries is {
      on query FindTreatyById {
        ???
      }
      on query FindTreatiesByCedent {
        ???
      }
      on query FindTreatiesByReinsurer {
        ???
      }
      on query FindActiveTreaties {
        ???
      }
      on query FindExpiringTreaties {
        ???
      }
      on query FindTreatiesByStatus {
        ???
      }
      on query GetTreatyHistory {
        ???
      }
    } with {
      briefly "Query handler for treaty lookups"
      described by "Handles all read operations against the treaty repository."
    }

  } with {
    briefly "Repository for treaty persistence and queries"
    described by {
      | The TreatyRepository provides persistence and query
      | capabilities for treaty aggregates.
    }
  }

  projector CessionMetricsProjector is {

    record CessionMetrics is {
      treatyId is TreatyId with { briefly "Treaty ID" described by "Related treaty." }
      periodStart is Date with { briefly "Start" described by "Period start." }
      periodEnd is Date with { briefly "End" described by "Period end." }
      cessionCount is Integer with { briefly "Count" described by "Number of cessions." }
      totalCededAmount is MonetaryAmount with { briefly "Ceded amount" described by "Total ceded." }
      totalCededPremium is MonetaryAmount with { briefly "Premium" described by "Total premium." }
      averageCessionSize is MonetaryAmount with { briefly "Average" described by "Average cession size." }
      utilizationPercentage is Percentage with { briefly "Utilization" described by "Capacity used." }
      largestCession is MonetaryAmount with { briefly "Largest" described by "Largest cession." }
      classOfBusinessBreakdown is String(1, 2000) with { briefly "Breakdown" described by "Class breakdown." }
    } with {
      briefly "Aggregated cession metrics for a treaty"
      described by "Read-optimized view of cession activity."
    }

    handler CessionMetricsHandler is {
      on event Treaty.CessionRecorded {
        ???
      }
      on event Treaty.TreatyExecuted {
        ???
      }
      on event Treaty.TreatyExpired {
        ???
      }
    } with {
      briefly "Handler for cession metrics updates"
      described by "Processes treaty events to maintain metrics."
    }

  } with {
    briefly "Projector for cession analytics"
    described by {
      | The CessionMetricsProjector maintains a read-optimized
      | view of cession activity per treaty.
    }
  }

  projector BordereauSummaryProjector is {

    record BordereauSummary is {
      treatyId is TreatyId with { briefly "Treaty ID" described by "Related treaty." }
      totalBordereaux is Integer with { briefly "Count" described by "Number submitted." }
      lastSubmissionDate is Date with { briefly "Last submitted" described by "Most recent submission." }
      cumulativePremium is MonetaryAmount with { briefly "Premium" described by "Cumulative premium." }
      cumulativeIncurred is MonetaryAmount with { briefly "Incurred" described by "Cumulative incurred." }
      cumulativePaid is MonetaryAmount with { briefly "Paid" described by "Cumulative paid." }
      currentLossRatio is Percentage with { briefly "Loss ratio" described by "Current loss ratio." }
      outstandingReserves is MonetaryAmount with { briefly "Reserves" described by "Outstanding reserves." }
    } with {
      briefly "Summary of bordereau activity for a treaty"
      described by "Aggregated view of all bordereau submissions."
    }

    handler BordereauSummaryHandler is {
      on event Treaty.BordereauReceived {
        ???
      }
      on event Treaty.SettlementProcessed {
        ???
      }
    } with {
      briefly "Handler for bordereau summary updates"
      described by "Maintains running totals from bordereau submissions."
    }

  } with {
    briefly "Projector for bordereau analytics"
    described by {
      | The BordereauSummaryProjector maintains cumulative views
      | of bordereau data for quick access to treaty metrics.
    }
  }

  projector SettlementLedgerProjector is {

    record SettlementLedger is {
      treatyId is TreatyId with { briefly "Treaty ID" described by "Related treaty." }
      settlements is many SettlementInfo with { briefly "Settlements" described by "Settlement history." }
      netPositionCedent is MonetaryAmount with { briefly "Cedent position" described by "Net owed to cedent." }
      netPositionReinsurer is MonetaryAmount with { briefly "Reinsurer position" described by "Net owed to reinsurer." }
      lastSettlementDate is Date with { briefly "Last settlement" described by "Most recent settlement." }
      nextSettlementDue is optional Date with { briefly "Next due" described by "Next settlement date." }
    } with {
      briefly "Running ledger of settlements for a treaty"
      described by "Tracks all settlements and net positions."
    }

    handler SettlementLedgerHandler is {
      on event Treaty.SettlementProcessed {
        ???
      }
    } with {
      briefly "Handler for settlement ledger updates"
      described by "Maintains settlement history and balances."
    }

  } with {
    briefly "Projector for settlement tracking"
    described by {
      | The SettlementLedgerProjector maintains a financial ledger
      | of all settlements for each treaty.
    }
  }

} with {
  briefly "Bounded context for treaty management"
  described by {
    | The TreatyContext encapsulates all treaty management
    | functionality including the Treaty aggregate, repository
    | for persistence, and projectors for analytics.
  }
}
