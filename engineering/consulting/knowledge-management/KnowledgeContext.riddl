// Knowledge Management - Knowledge Context

context KnowledgeContext is {

  include "types.riddl"
  include "KnowledgeItem.riddl"

  // Repository for knowledge persistence
  repository KnowledgeRepository is {
    schema KnowledgeData is relational
      of items as KnowledgeItem
      index on field KnowledgeItem.itemId
      index on field KnowledgeItem.metadata.categoryId

    handler KnowledgePersistence is {
      on command KnowledgeItem.CreateItem {
        prompt "Store knowledge item"
      }
      on command KnowledgeItem.UpdateItem {
        prompt "Update knowledge item"
      }
      on command KnowledgeItem.PublishItem {
        prompt "Update item status"
      }
      on command KnowledgeItem.ArchiveItem {
        prompt "Update item status"
      }
      on command KnowledgeItem.AddComment {
        prompt "Store comment"
      }
      on command KnowledgeItem.RateItem {
        prompt "Update rating"
      }
      on command KnowledgeItem.RecordView {
        prompt "Increment view count"
      }
    } with {
      briefly "Persists knowledge commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Knowledge data persistence"
    described by {
      | The KnowledgeRepository provides persistent storage for
      | knowledge items, categories, and engagement data.
    }
  }

  // Projector for knowledge analytics
  projector KnowledgeAnalytics is {
    updates repository KnowledgeRepository

    record KnowledgeStats is {
      categoryId is CategoryId with { briefly "Category" described by "Category ID." }
      totalItems is Natural with { briefly "Items" described by "Total items." }
      publishedItems is Natural with { briefly "Published" described by "Published count." }
      totalViews is Natural with { briefly "Views" described by "Total views." }
      averageRating is Decimal(3, 2) with { briefly "Rating" described by "Average rating." }
    } with {
      briefly "Knowledge statistics"
      described by "Knowledge category metrics."
    }

    handler AnalyticsHandler is {
      on event KnowledgeItem.ItemCreated {
        prompt "Update item counts"
      }
      on event KnowledgeItem.ItemPublished {
        prompt "Update published counts"
      }
      on event KnowledgeItem.ViewRecorded {
        prompt "Update view counts"
      }
      on event KnowledgeItem.ItemRated {
        prompt "Update rating metrics"
      }
    } with {
      briefly "Maintains knowledge analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Knowledge analytics projections"
    described by "Maintains knowledge analytics data."
  }

} with {
  briefly "Bounded context for knowledge management"
  described by {
    | The KnowledgeContext is the bounded context for organizational
    | knowledge capture, curation, sharing, and reuse.
  }
}
