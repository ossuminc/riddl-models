// Knowledge Management - Knowledge Context
context KnowledgeContext is {
  include "types.riddl"
  include "KnowledgeItem.riddl"
  // Repository for knowledge persistence
  repository KnowledgeRepository is {
    schema KnowledgeData is relational
      of items as type KnowledgeItem
        index on field KnowledgeItem.itemId
        index on field KnowledgeItem.metadata.categoryId

    handler KnowledgePersistence is {
      on command KnowledgeItem.CreateItem is {
        prompt "Store knowledge item"
      }
      on command KnowledgeItem.UpdateItem is {
        prompt "Update knowledge item"
      }
      on command KnowledgeItem.PublishItem is {
        prompt "Update item status"
      }
      on command KnowledgeItem.ArchiveItem is {
        prompt "Update item status"
      }
      on command KnowledgeItem.AddComment is {
        prompt "Store comment"
      }
      on command KnowledgeItem.RateItem is {
        prompt "Update rating"
      }
      on command KnowledgeItem.RecordView is {
        prompt "Increment view count"
      }
    } with {
      briefly "Persists knowledge commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Knowledge data persistence"
    described as {
      | The KnowledgeRepository provides persistent storage for
      | knowledge items, categories, and engagement data.
    }
  }
  // Projector for knowledge analytics
  projector KnowledgeAnalytics is {
    record KnowledgeStats is  {
      categoryId: CategoryId with {
        briefly "Category"
        described as {
          |Category ID.
        }
      }
      totalItems: Natural with {
        briefly "Items"
        described as {
          |Total items.
        }
      }
      publishedItems: Natural with {
        briefly "Published"
        described as {
          |Published count.
        }
      }
      totalViews: Natural with {
        briefly "Views"
        described as {
          |Total views.
        }
      }
      averageRating: Decimal(3,2) with {
        briefly "Rating"
        described as {
          |Average rating.
        }
      }
    } with {
      briefly "Knowledge statistics"
      described as {
        |Knowledge category metrics.
      }
    }
    handler AnalyticsHandler is {
      on event KnowledgeItem.ItemCreated is {
        prompt "Update item counts"
      }
      on event KnowledgeItem.ItemPublished is {
        prompt "Update published counts"
      }
      on event KnowledgeItem.ViewRecorded is {
        prompt "Update view counts"
      }
      on event KnowledgeItem.ItemRated is {
        prompt "Update rating metrics"
      }
    } with {
      briefly "Maintains knowledge analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Knowledge analytics projections"
    described as {
      |Maintains knowledge analytics data.
    }
  }
} with {
  briefly "Bounded context for knowledge management"
  described as {
    | The KnowledgeContext is the bounded context for organizational
    | knowledge capture, curation, sharing, and reuse.
  }
}
