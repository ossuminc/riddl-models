// Knowledge Management - External Contexts

// Search Service
context SearchService is {

  command IndexItem is {
    itemId is KnowledgeItemId with { briefly "Item" described by "Item ID." }
    content is KnowledgeContent with { briefly "Content" described by "Content to index." }
    metadata is KnowledgeMetadata with { briefly "Metadata" described by "Item metadata." }
  } with {
    briefly "Index item"
    described by "Indexes item for search."
  }

  command RemoveFromIndex is {
    itemId is KnowledgeItemId with { briefly "Item" described by "Item ID." }
  } with {
    briefly "Remove from index"
    described by "Removes item from search index."
  }

  event ItemIndexed is {
    itemId is KnowledgeItemId with { briefly "Item" described by "Item ID." }
    indexedAt is TimeStamp with { briefly "Indexed" described by "Index time." }
  } with {
    briefly "Item was indexed"
    described by "Emitted when item is indexed."
  }

} with {
  option is external
  briefly "External search service"
  described by "External search indexing system."
}

// Identity Service
context IdentityService is {

  event UserAuthenticated is {
    userId is AuthorId with { briefly "User" described by "User ID." }
    sessionId is UUID with { briefly "Session" described by "Session ID." }
    authenticatedAt is TimeStamp with { briefly "Auth time" described by "Authentication time." }
  } with {
    briefly "User authenticated"
    described by "Emitted when user logs in."
  }

  event PermissionsChecked is {
    userId is AuthorId with { briefly "User" described by "User ID." }
    resource is String(1, 200) with { briefly "Resource" described by "Resource checked." }
    allowed is Boolean with { briefly "Allowed" described by "Access granted." }
    checkedAt is TimeStamp with { briefly "Checked" described by "Check time." }
  } with {
    briefly "Permissions checked"
    described by "Emitted when access is verified."
  }

} with {
  option is external
  briefly "External identity service"
  described by "External authentication system."
}

// Notification Service
context NotificationService is {

  command SendContentAlert is {
    recipients is many AuthorId with { briefly "Recipients" described by "Alert recipients." }
    itemId is KnowledgeItemId with { briefly "Item" described by "Related item." }
    message is String(1, 500) with { briefly "Message" described by "Alert message." }
  } with {
    briefly "Send alert"
    described by "Sends content notification."
  }

  command SendReviewRequest is {
    reviewerId is AuthorId with { briefly "Reviewer" described by "Reviewer ID." }
    itemId is KnowledgeItemId with { briefly "Item" described by "Item to review." }
    requestedBy is AuthorId with { briefly "Requester" described by "Request author." }
  } with {
    briefly "Send review request"
    described by "Sends review request notification."
  }

  event NotificationSent is {
    notificationId is UUID with { briefly "Notification" described by "Notification ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification was sent"
    described by "Emitted when notification is delivered."
  }

} with {
  option is external
  briefly "External notification service"
  described by "External communications service."
}

// Document Storage Service
context DocumentStorageService is {

  command StoreAttachment is {
    itemId is KnowledgeItemId with { briefly "Item" described by "Item ID." }
    fileName is String(1, 255) with { briefly "File" described by "File name." }
    contentType is String(1, 100) with { briefly "Type" described by "MIME type." }
    size is Natural with { briefly "Size" described by "File size." }
  } with {
    briefly "Store attachment"
    described by "Stores file attachment."
  }

  event AttachmentStored is {
    attachmentId is UUID with { briefly "Attachment" described by "Attachment ID." }
    itemId is KnowledgeItemId with { briefly "Item" described by "Item ID." }
    storageUrl is URL with { briefly "URL" described by "Storage URL." }
    storedAt is TimeStamp with { briefly "Stored" described by "Storage time." }
  } with {
    briefly "Attachment was stored"
    described by "Emitted when file is stored."
  }

} with {
  option is external
  briefly "External storage service"
  described by "External document storage system."
}

// Analytics Service
context AnalyticsService is {

  command TrackEvent is {
    eventType is String(1, 50) with { briefly "Type" described by "Event type." }
    trackingUserId is optional AuthorId with { briefly "User" described by "User ID." }
    trackedItemId is optional KnowledgeItemId with { briefly "Item" described by "Item ID." }
    properties is many optional String(1, 500) with { briefly "Properties" described by "Event properties." }
  } with {
    briefly "Track event"
    described by "Tracks analytics event."
  }

  event EventTracked is {
    eventId is UUID with { briefly "Event" described by "Event ID." }
    trackedAt is TimeStamp with { briefly "Tracked" described by "Track time." }
  } with {
    briefly "Event was tracked"
    described by "Emitted when event is recorded."
  }

} with {
  option is external
  briefly "External analytics service"
  described by "External analytics tracking system."
}
