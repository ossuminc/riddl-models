// Knowledge Management - External Contexts
// Search Service
context SearchService is {
  command IndexItem is  {
    itemId: KnowledgeItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    content: KnowledgeContent with {
      briefly "Content"
      described as {
        |Content to index.
      }
    }
    metadata: KnowledgeMetadata with {
      briefly "Metadata"
      described as {
        |Item metadata.
      }
    }
  } with {
    briefly "Index item"
    described as {
      |Indexes item for search.
    }
  }
  command RemoveFromIndex is  {
    itemId: KnowledgeItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
  } with {
    briefly "Remove from index"
    described as {
      |Removes item from search index.
    }
  }
  event ItemIndexed is  {
    itemId: KnowledgeItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    indexedAt: TimeStamp with {
      briefly "Indexed"
      described as {
        |Index time.
      }
    }
  } with {
    briefly "Item was indexed"
    described as {
      |Emitted when item is indexed.
    }
  }
} with {
  option external()
  briefly "External search service"
  described as {
    |External search indexing system.
  }
}
// Identity Service
context IdentityService is {
  event UserAuthenticated is  {
    userId: AuthorId with {
      briefly "User"
      described as {
        |User ID.
      }
    }
    sessionId: UUID with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    authenticatedAt: TimeStamp with {
      briefly "Auth time"
      described as {
        |Authentication time.
      }
    }
  } with {
    briefly "User authenticated"
    described as {
      |Emitted when user logs in.
    }
  }
  event PermissionsChecked is  {
    userId: AuthorId with {
      briefly "User"
      described as {
        |User ID.
      }
    }
    resource: String(1,200) with {
      briefly "Resource"
      described as {
        |Resource checked.
      }
    }
    allowed: Boolean with {
      briefly "Allowed"
      described as {
        |Access granted.
      }
    }
    checkedAt: TimeStamp with {
      briefly "Checked"
      described as {
        |Check time.
      }
    }
  } with {
    briefly "Permissions checked"
    described as {
      |Emitted when access is verified.
    }
  }
} with {
  option external()
  briefly "External identity service"
  described as {
    |External authentication system.
  }
}
// Notification Service
context NotificationService is {
  command SendContentAlert is  {
    recipients: AuthorId+ with {
      briefly "Recipients"
      described as {
        |Alert recipients.
      }
    }
    itemId: KnowledgeItemId with {
      briefly "Item"
      described as {
        |Related item.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Alert message.
      }
    }
  } with {
    briefly "Send alert"
    described as {
      |Sends content notification.
    }
  }
  command SendReviewRequest is  {
    reviewerId: AuthorId with {
      briefly "Reviewer"
      described as {
        |Reviewer ID.
      }
    }
    itemId: KnowledgeItemId with {
      briefly "Item"
      described as {
        |Item to review.
      }
    }
    requestedBy: AuthorId with {
      briefly "Requester"
      described as {
        |Request author.
      }
    }
  } with {
    briefly "Send review request"
    described as {
      |Sends review request notification.
    }
  }
  event NotificationSent is  {
    notificationId: UUID with {
      briefly "Notification"
      described as {
        |Notification ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification was sent"
    described as {
      |Emitted when notification is delivered.
    }
  }
} with {
  option external()
  briefly "External notification service"
  described as {
    |External communications service.
  }
}
// Document Storage Service
context DocumentStorageService is {
  command StoreAttachment is  {
    itemId: KnowledgeItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    fileName: String(1,255) with {
      briefly "File"
      described as {
        |File name.
      }
    }
    contentType: String(1,100) with {
      briefly "Type"
      described as {
        |MIME type.
      }
    }
    size: Natural with {
      briefly "Size"
      described as {
        |File size.
      }
    }
  } with {
    briefly "Store attachment"
    described as {
      |Stores file attachment.
    }
  }
  event AttachmentStored is  {
    attachmentId: UUID with {
      briefly "Attachment"
      described as {
        |Attachment ID.
      }
    }
    itemId: KnowledgeItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    storageUrl: URL with {
      briefly "URL"
      described as {
        |Storage URL.
      }
    }
    storedAt: TimeStamp with {
      briefly "Stored"
      described as {
        |Storage time.
      }
    }
  } with {
    briefly "Attachment was stored"
    described as {
      |Emitted when file is stored.
    }
  }
} with {
  option external()
  briefly "External storage service"
  described as {
    |External document storage system.
  }
}
// Analytics Service
context AnalyticsService is {
  command TrackEvent is  {
    eventType: String(1,50) with {
      briefly "Type"
      described as {
        |Event type.
      }
    }
    trackingUserId: AuthorId? with {
      briefly "User"
      described as {
        |User ID.
      }
    }
    trackedItemId: KnowledgeItemId? with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    properties: String(1,500)* with {
      briefly "Properties"
      described as {
        |Event properties.
      }
    }
  } with {
    briefly "Track event"
    described as {
      |Tracks analytics event.
    }
  }
  event EventTracked is  {
    eventId: UUID with {
      briefly "Event"
      described as {
        |Event ID.
      }
    }
    trackedAt: TimeStamp with {
      briefly "Tracked"
      described as {
        |Track time.
      }
    }
  } with {
    briefly "Event was tracked"
    described as {
      |Emitted when event is recorded.
    }
  }
} with {
  option external()
  briefly "External analytics service"
  described as {
    |External analytics tracking system.
  }
}
