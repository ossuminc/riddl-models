// Design Review - Review Context
context ReviewContext is {
  include "types.riddl"
  include "Review.riddl"
  // Repository for review persistence
  repository ReviewRepository is {
    schema ReviewData is relational
      of reviews as type Review
        index on field Review.reviewId
        index on field Review.info.projectId

    handler ReviewPersistence is {
      on command Review.SubmitReview is {
        prompt "Store review record"
      }
      on command Review.AssignReviewer is {
        prompt "Store reviewer assignment"
      }
      on command Review.StartReview is {
        prompt "Update review status to active"
      }
      on command Review.AddComment is {
        prompt "Store review comment"
      }
      on command Review.RespondToComment is {
        prompt "Update comment with response"
      }
      on command Review.ResolveComment is {
        prompt "Update comment status"
      }
      on command Review.RecordDecision is {
        prompt "Store review decision"
      }
      on command Review.RequestRevision is {
        prompt "Update review status to needs revision"
      }
      on command Review.SubmitRevision is {
        prompt "Store revision details"
      }
      on command Review.FinalizeReview is {
        prompt "Update review to completed"
      }
      on command Review.CancelReview is {
        prompt "Update review to cancelled"
      }
    } with {
      briefly "Persists review commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Review data persistence"
    described as {
      | The ReviewRepository provides persistent storage for
      | design reviews, comments, and decisions.
    }
  }
  // Projector for review analytics
  projector ReviewAnalytics is {
    record ReviewStats is  {
      projectId: ProjectId with {
        briefly "Project"
        described as {
          |Project ID.
        }
      }
      totalReviews: Natural with {
        briefly "Reviews"
        described as {
          |Total reviews.
        }
      }
      pendingReviews: Natural with {
        briefly "Pending"
        described as {
          |Pending reviews.
        }
      }
      approvalRate: Decimal(5,2) with {
        briefly "Approval rate"
        described as {
          |Approval percentage.
        }
      }
      averageReviewTime: Duration with {
        briefly "Review time"
        described as {
          |Average review duration.
        }
      }
      averageComments: Decimal(5,2) with {
        briefly "Comments"
        described as {
          |Average comments per review.
        }
      }
    } with {
      briefly "Review statistics"
      described as {
        |Project review metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Review.ReviewSubmitted is {
        prompt "Update review counts"
      }
      on event Review.ReviewStarted is {
        prompt "Update active review metrics"
      }
      on event Review.CommentAdded is {
        prompt "Update comment metrics"
      }
      on event Review.ReviewFinalized is {
        prompt "Update completion metrics"
      }
    } with {
      briefly "Maintains review analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Review analytics projections"
    described as {
      |Maintains design review analytics data.
    }
  }
} with {
  briefly "Bounded context for design reviews"
  described as {
    | The ReviewContext is the bounded context for design
    | review management, approval workflows, and tracking.
  }
}
