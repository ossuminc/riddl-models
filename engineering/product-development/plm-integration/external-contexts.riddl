// PLM Integration - External Contexts

// PLM System Service
context PLMSystemService is {

  command FetchProduct is {
    productId is ProductId with { briefly "Product" described by "Product ID." }
    includeRelated is Boolean with { briefly "Related" described by "Include related data." }
  } with {
    briefly "Fetch product"
    described by "Retrieves product data from PLM."
  }

  command UpdateProduct is {
    productId is ProductId with { briefly "Product" described by "Product ID." }
    data is String(1, 10000) with { briefly "Data" described by "Product data JSON." }
  } with {
    briefly "Update product"
    described by "Updates product in PLM."
  }

  event ProductFetched is {
    productId is ProductId with { briefly "Product" described by "Product ID." }
    data is String(1, 10000) with { briefly "Data" described by "Product data." }
    fetchedAt is TimeStamp with { briefly "Fetched" described by "Fetch time." }
  } with {
    briefly "Product was fetched"
    described by "Emitted when product data is retrieved."
  }

} with {
  option is external
  briefly "External PLM service"
  described by "External PLM system interface."
}

// ERP System Service
context ERPSystemService is {

  command SyncBOM is {
    productId is ProductId with { briefly "Product" described by "Product ID." }
    bomData is String(1, 50000) with { briefly "BOM" described by "BOM data JSON." }
  } with {
    briefly "Sync BOM"
    described by "Synchronizes BOM to ERP."
  }

  event BOMSynced is {
    productId is ProductId with { briefly "Product" described by "Product ID." }
    itemsCreated is Natural with { briefly "Created" described by "Items created." }
    itemsUpdated is Natural with { briefly "Updated" described by "Items updated." }
    syncedAt is TimeStamp with { briefly "Synced" described by "Sync time." }
  } with {
    briefly "BOM was synced"
    described by "Emitted when BOM is synchronized."
  }

} with {
  option is external
  briefly "External ERP service"
  described by "External ERP system interface."
}

// CAD System Service
context CADSystemService is {

  command FetchCADFile is {
    documentId is DocumentId with { briefly "Document" described by "Document ID." }
    format is optional String(1, 20) with { briefly "Format" described by "Output format." }
  } with {
    briefly "Fetch CAD file"
    described by "Retrieves CAD file."
  }

  event CADFileFetched is {
    documentId is DocumentId with { briefly "Document" described by "Document ID." }
    fileUrl is URL with { briefly "URL" described by "File download URL." }
    fetchedAt is TimeStamp with { briefly "Fetched" described by "Fetch time." }
  } with {
    briefly "CAD file was fetched"
    described by "Emitted when CAD file is retrieved."
  }

} with {
  option is external
  briefly "External CAD service"
  described by "External CAD system interface."
}

// Message Queue Service
context MessageQueueService is {

  command PublishEvent is {
    topic is String(1, 200) with { briefly "Topic" described by "Message topic." }
    event is DataChangeEvent with { briefly "Event" described by "Event to publish." }
  } with {
    briefly "Publish event"
    described by "Publishes change event to queue."
  }

  command SubscribeToTopic is {
    topic is String(1, 200) with { briefly "Topic" described by "Topic to subscribe." }
    callback is URL with { briefly "Callback" described by "Callback URL." }
  } with {
    briefly "Subscribe"
    described by "Subscribes to message topic."
  }

  event EventPublished is {
    messageId is UUID with { briefly "Message" described by "Message ID." }
    topic is String(1, 200) with { briefly "Topic" described by "Message topic." }
    publishedAt is TimeStamp with { briefly "Published" described by "Publish time." }
  } with {
    briefly "Event was published"
    described by "Emitted when event is queued."
  }

} with {
  option is external
  briefly "External message queue"
  described by "External messaging system."
}

// Monitoring Service
context MonitoringService is {

  command RecordMetric is {
    metricName is String(1, 100) with { briefly "Metric" described by "Metric name." }
    value is Decimal(12, 4) with { briefly "Value" described by "Metric value." }
    tags is many optional String(1, 100) with { briefly "Tags" described by "Metric tags." }
  } with {
    briefly "Record metric"
    described by "Records performance metric."
  }

  command CreateAlert is {
    integrationId is IntegrationId with { briefly "Integration" described by "Integration ID." }
    severity is String(1, 20) with { briefly "Severity" described by "Alert severity." }
    message is String(1, 500) with { briefly "Message" described by "Alert message." }
  } with {
    briefly "Create alert"
    described by "Creates integration alert."
  }

  event AlertCreated is {
    alertId is UUID with { briefly "Alert" described by "Alert ID." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Alert was created"
    described by "Emitted when alert is raised."
  }

} with {
  option is external
  briefly "External monitoring service"
  described by "External monitoring system."
}
