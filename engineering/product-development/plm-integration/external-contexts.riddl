// PLM Integration - External Contexts
// PLM System Service
context PLMSystemService is {
  command FetchProduct is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    includeRelated: Boolean with {
      briefly "Related"
      described as {
        |Include related data.
      }
    }
  } with {
    briefly "Fetch product"
    described as {
      |Retrieves product data from PLM.
    }
  }
  command UpdateProduct is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    data: String(1,10000) with {
      briefly "Data"
      described as {
        |Product data JSON.
      }
    }
  } with {
    briefly "Update product"
    described as {
      |Updates product in PLM.
    }
  }
  event ProductFetched is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    data: String(1,10000) with {
      briefly "Data"
      described as {
        |Product data.
      }
    }
    fetchedAt: TimeStamp with {
      briefly "Fetched"
      described as {
        |Fetch time.
      }
    }
  } with {
    briefly "Product was fetched"
    described as {
      |Emitted when product data is retrieved.
    }
  }
} with {
  option external()
  briefly "External PLM service"
  described as {
    |External PLM system interface.
  }
}
// ERP System Service
context ERPSystemService is {
  command SyncBOM is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    bomData: String(1,50000) with {
      briefly "BOM"
      described as {
        |BOM data JSON.
      }
    }
  } with {
    briefly "Sync BOM"
    described as {
      |Synchronizes BOM to ERP.
    }
  }
  event BOMSynced is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    itemsCreated: Natural with {
      briefly "Created"
      described as {
        |Items created.
      }
    }
    itemsUpdated: Natural with {
      briefly "Updated"
      described as {
        |Items updated.
      }
    }
    syncedAt: TimeStamp with {
      briefly "Synced"
      described as {
        |Sync time.
      }
    }
  } with {
    briefly "BOM was synced"
    described as {
      |Emitted when BOM is synchronized.
    }
  }
} with {
  option external()
  briefly "External ERP service"
  described as {
    |External ERP system interface.
  }
}
// CAD System Service
context CADSystemService is {
  command FetchCADFile is  {
    documentId: DocumentId with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    format: String(1,20)? with {
      briefly "Format"
      described as {
        |Output format.
      }
    }
  } with {
    briefly "Fetch CAD file"
    described as {
      |Retrieves CAD file.
    }
  }
  event CADFileFetched is  {
    documentId: DocumentId with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    fileUrl: URL with {
      briefly "URL"
      described as {
        |File download URL.
      }
    }
    fetchedAt: TimeStamp with {
      briefly "Fetched"
      described as {
        |Fetch time.
      }
    }
  } with {
    briefly "CAD file was fetched"
    described as {
      |Emitted when CAD file is retrieved.
    }
  }
} with {
  option external()
  briefly "External CAD service"
  described as {
    |External CAD system interface.
  }
}
// Message Queue Service
context MessageQueueService is {
  command PublishEvent is  {
    topic: String(1,200) with {
      briefly "Topic"
      described as {
        |Message topic.
      }
    }
    event: DataChangeEvent with {
      briefly "Event"
      described as {
        |Event to publish.
      }
    }
  } with {
    briefly "Publish event"
    described as {
      |Publishes change event to queue.
    }
  }
  command SubscribeToTopic is  {
    topic: String(1,200) with {
      briefly "Topic"
      described as {
        |Topic to subscribe.
      }
    }
    callback: URL with {
      briefly "Callback"
      described as {
        |Callback URL.
      }
    }
  } with {
    briefly "Subscribe"
    described as {
      |Subscribes to message topic.
    }
  }
  event EventPublished is  {
    messageId: UUID with {
      briefly "Message"
      described as {
        |Message ID.
      }
    }
    topic: String(1,200) with {
      briefly "Topic"
      described as {
        |Message topic.
      }
    }
    publishedAt: TimeStamp with {
      briefly "Published"
      described as {
        |Publish time.
      }
    }
  } with {
    briefly "Event was published"
    described as {
      |Emitted when event is queued.
    }
  }
} with {
  option external()
  briefly "External message queue"
  described as {
    |External messaging system.
  }
}
// Monitoring Service
context MonitoringService is {
  command RecordMetric is  {
    metricName: String(1,100) with {
      briefly "Metric"
      described as {
        |Metric name.
      }
    }
    value: Decimal(12,4) with {
      briefly "Value"
      described as {
        |Metric value.
      }
    }
    tags: String(1,100)* with {
      briefly "Tags"
      described as {
        |Metric tags.
      }
    }
  } with {
    briefly "Record metric"
    described as {
      |Records performance metric.
    }
  }
  command CreateAlert is  {
    integrationId: IntegrationId with {
      briefly "Integration"
      described as {
        |Integration ID.
      }
    }
    severity: String(1,20) with {
      briefly "Severity"
      described as {
        |Alert severity.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Alert message.
      }
    }
  } with {
    briefly "Create alert"
    described as {
      |Creates integration alert.
    }
  }
  event AlertCreated is  {
    alertId: UUID with {
      briefly "Alert"
      described as {
        |Alert ID.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Alert was created"
    described as {
      |Emitted when alert is raised.
    }
  }
} with {
  option external()
  briefly "External monitoring service"
  described as {
    |External monitoring system.
  }
}
