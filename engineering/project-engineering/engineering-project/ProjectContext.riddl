// Engineering Project - Project Context
context ProjectContext is {
  include "types.riddl"
  include "Project.riddl"
  // Repository for project persistence
  repository ProjectRepository is {
    schema ProjectData is relational
      of projects as type Project
        index on field Project.projectId
        index on field Project.info.clientId

    handler ProjectPersistence is {
      on command Project.CreateProject is {
        prompt "Store project record"
      }
      on command Project.UpdateProject is {
        prompt "Update project info"
      }
      on command Project.AddPhase is {
        prompt "Store phase record"
      }
      on command Project.UpdatePhase is {
        prompt "Update phase status"
      }
      on command Project.AddTask is {
        prompt "Store task record"
      }
      on command Project.UpdateTaskStatus is {
        prompt "Update task status"
      }
      on command Project.AssignResource is {
        prompt "Store resource allocation"
      }
      on command Project.RecordTime is {
        prompt "Store time entry"
      }
      on command Project.AddMilestone is {
        prompt "Store milestone record"
      }
      on command Project.CompleteMilestone is {
        prompt "Update milestone completion"
      }
      on command Project.AddRisk is {
        prompt "Store risk record"
      }
      on command Project.UpdateRisk is {
        prompt "Update risk status"
      }
      on command Project.CompleteProject is {
        prompt "Update project to completed"
      }
      on command Project.CancelProject is {
        prompt "Update project to cancelled"
      }
    } with {
      briefly "Persists project commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Project data persistence"
    described as {
      | The ProjectRepository provides persistent storage for
      | engineering projects, tasks, and resources.
    }
  }
  // Projector for project analytics
  projector ProjectAnalytics is {
    record ProjectStats is  {
      clientId: UUID with {
        briefly "Client"
        described as {
          |Client ID.
        }
      }
      totalProjects: Natural with {
        briefly "Projects"
        described as {
          |Total projects.
        }
      }
      activeProjects: Natural with {
        briefly "Active"
        described as {
          |Active projects.
        }
      }
      completionRate: Decimal(5,2) with {
        briefly "Completion"
        described as {
          |Completion rate.
        }
      }
      averageDuration: Duration with {
        briefly "Duration"
        described as {
          |Average project duration.
        }
      }
      totalBudget: Decimal(15,2) with {
        briefly "Budget"
        described as {
          |Total budget allocated.
        }
      }
    } with {
      briefly "Project statistics"
      described as {
        |Client project metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Project.ProjectCreated is {
        prompt "Update project counts"
      }
      on event Project.TaskStatusUpdated is {
        prompt "Update task metrics"
      }
      on event Project.MilestoneCompleted is {
        prompt "Update milestone metrics"
      }
      on event Project.ProjectCompleted is {
        prompt "Update completion metrics"
      }
    } with {
      briefly "Maintains project analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Project analytics projections"
    described as {
      |Maintains engineering project analytics data.
    }
  }
} with {
  briefly "Bounded context for engineering projects"
  described as {
    | The ProjectContext is the bounded context for engineering
    | project management, execution, and resource tracking.
  }
}
