// Engineering Project - Project Context

context ProjectContext is {

  include "types.riddl"
  include "Project.riddl"

  // Repository for project persistence
  repository ProjectRepository is {
    schema ProjectData is relational
      of projects as Project
      index on field Project.projectId
      index on field Project.info.clientId

    handler ProjectPersistence is {
      on event Project.ProjectCreated {
        prompt "Store project record"
      }
      on event Project.ProjectUpdated {
        prompt "Update project info"
      }
      on event Project.PhaseAdded {
        prompt "Store phase record"
      }
      on event Project.PhaseUpdated {
        prompt "Update phase status"
      }
      on event Project.TaskAdded {
        prompt "Store task record"
      }
      on event Project.TaskStatusUpdated {
        prompt "Update task status"
      }
      on event Project.ResourceAssigned {
        prompt "Store resource allocation"
      }
      on event Project.TimeRecorded {
        prompt "Store time entry"
      }
      on event Project.MilestoneAdded {
        prompt "Store milestone record"
      }
      on event Project.MilestoneCompleted {
        prompt "Update milestone completion"
      }
      on event Project.RiskAdded {
        prompt "Store risk record"
      }
      on event Project.RiskUpdated {
        prompt "Update risk status"
      }
      on event Project.ProjectCompleted {
        prompt "Update project to completed"
      }
      on event Project.ProjectCancelled {
        prompt "Update project to cancelled"
      }
    } with {
      briefly "Persists project events"
      described by "Handles event-driven persistence."
    }
  } with {
    briefly "Project data persistence"
    described by {
      | The ProjectRepository provides persistent storage for
      | engineering projects, tasks, and resources.
    }
  }

  // Projector for project analytics
  projector ProjectAnalytics is {
    updates repository ProjectRepository

    record ProjectStats is {
      clientId is UUID with { briefly "Client" described by "Client ID." }
      totalProjects is Natural with { briefly "Projects" described by "Total projects." }
      activeProjects is Natural with { briefly "Active" described by "Active projects." }
      completionRate is Decimal(5, 2) with { briefly "Completion" described by "Completion rate." }
      averageDuration is Duration with { briefly "Duration" described by "Average project duration." }
      totalBudget is Decimal(15, 2) with { briefly "Budget" described by "Total budget allocated." }
    } with {
      briefly "Project statistics"
      described by "Client project metrics."
    }

    handler AnalyticsHandler is {
      on event Project.ProjectCreated {
        prompt "Update project counts"
      }
      on event Project.TaskStatusUpdated {
        prompt "Update task metrics"
      }
      on event Project.MilestoneCompleted {
        prompt "Update milestone metrics"
      }
      on event Project.ProjectCompleted {
        prompt "Update completion metrics"
      }
    } with {
      briefly "Maintains project analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Project analytics projections"
    described by "Maintains engineering project analytics data."
  }

} with {
  briefly "Bounded context for engineering projects"
  described by {
    | The ProjectContext is the bounded context for engineering
    | project management, execution, and resource tracking.
  }
}
