// Design Review - Design Review Context
context DesignReviewContext is {
  include "types.riddl"
  include "Submittal.riddl"
  // Repository for submittal persistence
  repository SubmittalRepository is {
    schema SubmittalData is relational
      of submittals as type Submittal
        index on field Submittal.submittalId
        index on field Submittal.info.projectId

    handler SubmittalPersistence is {
      on command Submittal.CreateSubmittal is {
        prompt "Store submittal record"
      }
      on command Submittal.UpdateSubmittal is {
        prompt "Update submittal info"
      }
      on command Submittal.SubmitForReview is {
        prompt "Update submittal status to submitted"
      }
      on command Submittal.AssignReviewer is {
        prompt "Store reviewer assignment"
      }
      on command Submittal.RemoveReviewer is {
        prompt "Remove reviewer assignment"
      }
      on command Submittal.AddComment is {
        prompt "Store review comment"
      }
      on command Submittal.ResolveComment is {
        prompt "Update comment resolution"
      }
      on command Submittal.SubmitRevision is {
        prompt "Store revision record"
      }
      on command Submittal.RecordApproval is {
        prompt "Store approval record"
      }
      on command Submittal.RejectSubmittal is {
        prompt "Update submittal to rejected"
      }
      on command Submittal.WithdrawSubmittal is {
        prompt "Update submittal to withdrawn"
      }
      on command Submittal.AddMilestone is {
        prompt "Store milestone record"
      }
      on command Submittal.SignOffMilestone is {
        prompt "Update milestone sign-off"
      }
    } with {
      briefly "Persists submittal commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Submittal data persistence"
    described as {
      | The SubmittalRepository provides persistent storage for
      | design submittals, reviews, comments, and approvals.
    }
  }
  // Projector for review analytics
  projector ReviewAnalytics is {
    record ReviewStats is  {
      projectId: UUID with {
        briefly "Project"
        described as {
          |Project ID.
        }
      }
      totalSubmittals: Natural with {
        briefly "Submittals"
        described as {
          |Total submittals.
        }
      }
      pendingReviews: Natural with {
        briefly "Pending"
        described as {
          |Pending reviews.
        }
      }
      approvalRate: Decimal(5,2) with {
        briefly "Approval rate"
        described as {
          |Approval percentage.
        }
      }
      averageReviewDuration: Duration with {
        briefly "Duration"
        described as {
          |Average review time.
        }
      }
      openComments: Natural with {
        briefly "Open comments"
        described as {
          |Unresolved comments.
        }
      }
    } with {
      briefly "Review statistics"
      described as {
        |Project review metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Submittal.SubmittalCreated is {
        prompt "Update submittal counts"
      }
      on event Submittal.SubmittalSubmitted is {
        prompt "Update pending review counts"
      }
      on event Submittal.CommentAdded is {
        prompt "Update comment metrics"
      }
      on event Submittal.CommentResolved is {
        prompt "Update resolved comment metrics"
      }
      on event Submittal.ApprovalRecorded is {
        prompt "Update approval metrics"
      }
      on event Submittal.SubmittalRejected is {
        prompt "Update rejection metrics"
      }
    } with {
      briefly "Maintains review analytics"
      described as {
        |Projects events into review analytics views.
      }
    }
  } with {
    briefly "Review analytics projections"
    described as {
      |Maintains design review analytics data.
    }
  }
} with {
  briefly "Bounded context for design reviews"
  described as {
    | The DesignReviewContext is the bounded context for design
    | submittal management, review routing, and approval tracking.
  }
}
