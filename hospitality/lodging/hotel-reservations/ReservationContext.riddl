// Hotel Reservations - Reservation Context
context ReservationContext is {
  include "types.riddl"
  include "Reservation.riddl"
  // Repository for reservation persistence
  repository ReservationRepository is {
    schema ReservationData is relational
      of reservations as type Reservation
        index on field Reservation.reservationId
        index on field Reservation.guest.guestId
        index on field Reservation.dates.checkIn

    handler ReservationPersistence is {
      on command Reservation.CreateReservation is {
        prompt "Store new reservation"
      }
      on command Reservation.ConfirmReservation is {
        prompt "Update to confirmed"
      }
      on command Reservation.ModifyReservation is {
        prompt "Update reservation details"
      }
      on command Reservation.AddSpecialRequest is {
        prompt "Store special request"
      }
      on command Reservation.CheckIn is {
        prompt "Update to checked in"
      }
      on command Reservation.PostCharge is {
        prompt "Store folio item"
      }
      on command Reservation.CheckOut is {
        prompt "Update to checked out"
      }
      on command Reservation.CancelReservation is {
        prompt "Update to cancelled"
      }
      on command Reservation.MarkNoShow is {
        prompt "Update to no-show"
      }
    } with {
      briefly "Persists reservation commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Reservation data persistence"
    described as {
      | The ReservationRepository provides persistent storage for
      | reservations, folios, and guest history.
    }
  }
  // Projector for hotel analytics
  projector HotelAnalytics is {
    record HotelStats is  {
      occupancyRate: Decimal(5,4) with {
        briefly "Occupancy"
        described as {
          |Occupancy rate.
        }
      }
      adr: Decimal(10,2) with {
        briefly "ADR"
        described as {
          |Average daily rate.
        }
      }
      revPar: Decimal(10,2) with {
        briefly "RevPAR"
        described as {
          |Revenue per available room.
        }
      }
      arrivalsToday: Natural with {
        briefly "Arrivals"
        described as {
          |Arrivals today.
        }
      }
      departuresToday: Natural with {
        briefly "Departures"
        described as {
          |Departures today.
        }
      }
      cancellationRate: Decimal(5,4) with {
        briefly "Cancellation rate"
        described as {
          |Cancellation rate.
        }
      }
    } with {
      briefly "Hotel statistics"
      described as {
        |Hotel performance metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Reservation.ReservationCreated is {
        prompt "Update booking metrics"
      }
      on event Reservation.GuestCheckedIn is {
        prompt "Update occupancy metrics"
      }
      on event Reservation.GuestCheckedOut is {
        prompt "Update revenue metrics"
      }
      on event Reservation.ReservationCancelled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains hotel analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Hotel analytics projections"
    described as {
      |Maintains hotel performance analytics data.
    }
  }
} with {
  briefly "Bounded context for hotel reservations"
  described as {
    | The ReservationContext is the bounded context for
    | hotel booking and guest management.
  }
}
