// Hotel Reservations - External Contexts

// Channel Manager Service
context ChannelManagerService is {

  command SyncAvailability is {
    propertyId is PropertyId with { briefly "Property" described by "Property ID." }
    roomType is RoomType with { briefly "Room type" described by "Room type." }
    date is Date with { briefly "Date" described by "Date to sync." }
    available is Natural with { briefly "Available" described by "Available count." }
  } with {
    briefly "Sync availability"
    described by "Syncs availability to channels."
  }

  event AvailabilitySynced is {
    propertyId is PropertyId with { briefly "Property" described by "Property ID." }
    channels is many String(1, 50) with { briefly "Channels" described by "Synced channels." }
    syncedAt is TimeStamp with { briefly "Synced" described by "Sync time." }
  } with {
    briefly "Availability synced"
    described by "Emitted when availability is synced."
  }

  command SyncRates is {
    propertyId is PropertyId with { briefly "Property" described by "Property ID." }
    roomType is RoomType with { briefly "Room type" described by "Room type." }
    date is Date with { briefly "Date" described by "Rate date." }
    rate is Decimal(10, 2) with { briefly "Rate" described by "Nightly rate." }
  } with {
    briefly "Sync rates"
    described by "Syncs rates to channels."
  }

  event RatesSynced is {
    propertyId is PropertyId with { briefly "Property" described by "Property ID." }
    channels is many String(1, 50) with { briefly "Channels" described by "Synced channels." }
    syncedAt is TimeStamp with { briefly "Synced" described by "Sync time." }
  } with {
    briefly "Rates synced"
    described by "Emitted when rates are synced."
  }

} with {
  option is external
  briefly "External channel manager"
  described by "External OTA channel management service."
}

// Payment Gateway Service
context PaymentGatewayService is {

  command AuthorizePayment is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Authorization amount." }
    currency is String(3, 3) with { briefly "Currency" described by "Currency code." }
    paymentToken is String(1, 200) with { briefly "Token" described by "Payment token." }
  } with {
    briefly "Authorize payment"
    described by "Authorizes payment."
  }

  event PaymentAuthorized is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    authorizationCode is String(1, 50) with { briefly "Auth code" described by "Authorization code." }
    authorizedAt is TimeStamp with { briefly "Authorized" described by "Authorization time." }
  } with {
    briefly "Payment authorized"
    described by "Emitted when payment is authorized."
  }

  command CapturePayment is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    authorizationCode is String(1, 50) with { briefly "Auth code" described by "Authorization code." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Capture amount." }
  } with {
    briefly "Capture payment"
    described by "Captures authorized payment."
  }

  event PaymentCaptured is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    transactionId is String(1, 50) with { briefly "Transaction" described by "Transaction ID." }
    capturedAt is TimeStamp with { briefly "Captured" described by "Capture time." }
  } with {
    briefly "Payment captured"
    described by "Emitted when payment is captured."
  }

  command RefundPayment is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    transactionId is String(1, 50) with { briefly "Transaction" described by "Original transaction." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Refund amount." }
  } with {
    briefly "Refund payment"
    described by "Refunds a payment."
  }

  event PaymentRefunded is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    refundId is String(1, 50) with { briefly "Refund" described by "Refund ID." }
    refundedAt is TimeStamp with { briefly "Refunded" described by "Refund time." }
  } with {
    briefly "Payment refunded"
    described by "Emitted when payment is refunded."
  }

} with {
  option is external
  briefly "External payment gateway"
  described by "External payment processing service."
}

// Housekeeping Service
context HousekeepingService is {

  command AssignRoom is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    assignedTo is String(1, 200) with { briefly "Assigned to" described by "Housekeeper name." }
    priority is Natural with { briefly "Priority" described by "Cleaning priority." }
  } with {
    briefly "Assign room"
    described by "Assigns room for cleaning."
  }

  event RoomAssigned is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    assignedTo is String(1, 200) with { briefly "Assigned to" described by "Housekeeper." }
    assignedAt is TimeStamp with { briefly "Assigned" described by "Assignment time." }
  } with {
    briefly "Room assigned"
    described by "Emitted when room is assigned."
  }

  command MarkRoomClean is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    cleanedBy is String(1, 200) with { briefly "Cleaned by" described by "Housekeeper." }
    inspected is Boolean with { briefly "Inspected" described by "Whether inspected." }
  } with {
    briefly "Mark room clean"
    described by "Marks room as clean."
  }

  event RoomCleaned is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    cleanedBy is String(1, 200) with { briefly "Cleaned by" described by "Housekeeper." }
    cleanedAt is TimeStamp with { briefly "Cleaned" described by "Cleaning time." }
  } with {
    briefly "Room cleaned"
    described by "Emitted when room is cleaned."
  }

  command ReportMaintenance is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    issue is String(1, 500) with { briefly "Issue" described by "Maintenance issue." }
    priority is Natural with { briefly "Priority" described by "Issue priority." }
  } with {
    briefly "Report maintenance"
    described by "Reports maintenance issue."
  }

  event MaintenanceReported is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    ticketId is UUID with { briefly "Ticket" described by "Maintenance ticket ID." }
    reportedAt is TimeStamp with { briefly "Reported" described by "Report time." }
  } with {
    briefly "Maintenance reported"
    described by "Emitted when maintenance is reported."
  }

} with {
  option is external
  briefly "External housekeeping"
  described by "External housekeeping management service."
}

// Loyalty Program Service
context LoyaltyProgramService is {

  query GetMemberStatus is {
    loyaltyNumber is String(1, 50) with { briefly "Loyalty" described by "Loyalty number." }
  } with {
    briefly "Get member status"
    described by "Retrieves loyalty member status."
  }

  result MemberStatus is {
    loyaltyNumber is String(1, 50) with { briefly "Loyalty" described by "Loyalty number." }
    tier is String(1, 50) with { briefly "Tier" described by "Membership tier." }
    points is Natural with { briefly "Points" described by "Available points." }
    benefits is many String(1, 200) with { briefly "Benefits" described by "Tier benefits." }
  } with {
    briefly "Member status"
    described by "Loyalty member information."
  }

  command AccruePoints is {
    loyaltyNumber is String(1, 50) with { briefly "Loyalty" described by "Loyalty number." }
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    points is Natural with { briefly "Points" described by "Points to accrue." }
  } with {
    briefly "Accrue points"
    described by "Accrues loyalty points."
  }

  event PointsAccrued is {
    loyaltyNumber is String(1, 50) with { briefly "Loyalty" described by "Loyalty number." }
    points is Natural with { briefly "Points" described by "Points accrued." }
    newBalance is Natural with { briefly "Balance" described by "New point balance." }
    accruedAt is TimeStamp with { briefly "Accrued" described by "Accrual time." }
  } with {
    briefly "Points accrued"
    described by "Emitted when points are accrued."
  }

  command RedeemPoints is {
    loyaltyNumber is String(1, 50) with { briefly "Loyalty" described by "Loyalty number." }
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    points is Natural with { briefly "Points" described by "Points to redeem." }
  } with {
    briefly "Redeem points"
    described by "Redeems loyalty points."
  }

  event PointsRedeemed is {
    loyaltyNumber is String(1, 50) with { briefly "Loyalty" described by "Loyalty number." }
    points is Natural with { briefly "Points" described by "Points redeemed." }
    value is Decimal(10, 2) with { briefly "Value" described by "Redemption value." }
    redeemedAt is TimeStamp with { briefly "Redeemed" described by "Redemption time." }
  } with {
    briefly "Points redeemed"
    described by "Emitted when points are redeemed."
  }

} with {
  option is external
  briefly "External loyalty program"
  described by "External loyalty and rewards service."
}

// Guest Communication Service
context GuestCommunicationService is {

  command SendConfirmation is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    guest is GuestInfo with { briefly "Guest" described by "Guest info." }
    confirmationNumber is String(1, 20) with { briefly "Confirmation" described by "Confirmation number." }
  } with {
    briefly "Send confirmation"
    described by "Sends booking confirmation."
  }

  event ConfirmationSent is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    channel is String(1, 50) with { briefly "Channel" described by "Communication channel." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Confirmation sent"
    described by "Emitted when confirmation is sent."
  }

  command SendPreArrivalMessage is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    guest is GuestInfo with { briefly "Guest" described by "Guest info." }
    checkInDate is Date with { briefly "Check-in" described by "Check-in date." }
  } with {
    briefly "Send pre-arrival"
    described by "Sends pre-arrival information."
  }

  event PreArrivalSent is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Pre-arrival sent"
    described by "Emitted when pre-arrival is sent."
  }

} with {
  option is external
  briefly "External guest communications"
  described by "External guest messaging service."
}
