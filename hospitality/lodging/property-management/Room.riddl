// Property Management - Room Entity
entity Room is {
  // Commands
  command CreateRoom is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |New room identifier.
      }
    }
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property identifier.
      }
    }
    details: RoomDetails with {
      briefly "Details"
      described as {
        |Room details.
      }
    }
    amenities: RoomAmenities with {
      briefly "Amenities"
      described as {
        |Room amenities.
      }
    }
  } with {
    briefly "Create room"
    described as {
      |Creates a new room in inventory.
    }
  }
  command UpdateRoomDetails is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    details: RoomDetails with {
      briefly "Details"
      described as {
        |Updated details.
      }
    }
  } with {
    briefly "Update room details"
    described as {
      |Updates room physical details.
    }
  }
  command UpdateAmenities is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    amenities: RoomAmenities with {
      briefly "Amenities"
      described as {
        |Updated amenities.
      }
    }
  } with {
    briefly "Update amenities"
    described as {
      |Updates room amenities.
    }
  }
  command UpdateRoomStatus is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    newStatus: RoomStatus with {
      briefly "Status"
      described as {
        |New room status.
      }
    }
    statusChangeReason: String(1,300)? with {
      briefly "Reason"
      described as {
        |Status change reason.
      }
    }
  } with {
    briefly "Update room status"
    described as {
      |Changes room housekeeping status.
    }
  }
  command AssignHousekeeper is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    assignment: HousekeepingAssignment with {
      briefly "Assignment"
      described as {
        |Housekeeper assignment.
      }
    }
  } with {
    briefly "Assign housekeeper"
    described as {
      |Assigns housekeeper to room.
    }
  }
  command RecordCleaning is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    cleaning: CleaningRecord with {
      briefly "Cleaning"
      described as {
        |Cleaning record.
      }
    }
  } with {
    briefly "Record cleaning"
    described as {
      |Records room cleaning completion.
    }
  }
  command InspectRoom is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    inspection: InspectionRecord with {
      briefly "Inspection"
      described as {
        |Inspection record.
      }
    }
  } with {
    briefly "Inspect room"
    described as {
      |Records room inspection.
    }
  }
  command ReportMaintenance is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    request: MaintenanceRequest with {
      briefly "Request"
      described as {
        |Maintenance request.
      }
    }
  } with {
    briefly "Report maintenance"
    described as {
      |Reports maintenance issue.
    }
  }
  command CompleteMaintenance is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    workOrderId: WorkOrderId with {
      briefly "Work order"
      described as {
        |Work order ID.
      }
    }
    completion: MaintenanceCompletion with {
      briefly "Completion"
      described as {
        |Completion details.
      }
    }
  } with {
    briefly "Complete maintenance"
    described as {
      |Completes maintenance work order.
    }
  }
  command BlockRoom is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    blocking: RoomBlocking with {
      briefly "Blocking"
      described as {
        |Blocking details.
      }
    }
  } with {
    briefly "Block room"
    described as {
      |Blocks room from inventory.
    }
  }
  command UnblockRoom is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    reason: String(1,200) with {
      briefly "Reason"
      described as {
        |Unblock reason.
      }
    }
  } with {
    briefly "Unblock room"
    described as {
      |Returns room to inventory.
    }
  }
  command DecommissionRoom is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Decommission reason.
      }
    }
  } with {
    briefly "Decommission room"
    described as {
      |Permanently removes room from inventory.
    }
  }
  // Events
  event RoomCreated is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    details: RoomDetails with {
      briefly "Details"
      described as {
        |Room details.
      }
    }
    amenities: RoomAmenities with {
      briefly "Amenities"
      described as {
        |Room amenities.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Room created"
    described as {
      |Emitted when room is created.
    }
  }
  event RoomDetailsUpdated is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    details: RoomDetails with {
      briefly "Details"
      described as {
        |New details.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Room details updated"
    described as {
      |Emitted when details are updated.
    }
  }
  event AmenitiesUpdated is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    amenities: RoomAmenities with {
      briefly "Amenities"
      described as {
        |New amenities.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Amenities updated"
    described as {
      |Emitted when amenities are updated.
    }
  }
  event RoomStatusChanged is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    previousStatus: RoomStatus with {
      briefly "Previous"
      described as {
        |Previous status.
      }
    }
    newStatus: RoomStatus with {
      briefly "New"
      described as {
        |New status.
      }
    }
    changedAt: TimeStamp with {
      briefly "Changed"
      described as {
        |Change time.
      }
    }
  } with {
    briefly "Room status changed"
    described as {
      |Emitted when status changes.
    }
  }
  event HousekeeperAssigned is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    assignment: HousekeepingAssignment with {
      briefly "Assignment"
      described as {
        |Assignment details.
      }
    }
  } with {
    briefly "Housekeeper assigned"
    described as {
      |Emitted when housekeeper is assigned.
    }
  }
  event CleaningRecorded is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    cleaning: CleaningRecord with {
      briefly "Cleaning"
      described as {
        |Cleaning record.
      }
    }
  } with {
    briefly "Cleaning recorded"
    described as {
      |Emitted when cleaning is recorded.
    }
  }
  event RoomInspected is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    inspection: InspectionRecord with {
      briefly "Inspection"
      described as {
        |Inspection record.
      }
    }
  } with {
    briefly "Room inspected"
    described as {
      |Emitted when room is inspected.
    }
  }
  event MaintenanceReported is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    request: MaintenanceRequest with {
      briefly "Request"
      described as {
        |Maintenance request.
      }
    }
  } with {
    briefly "Maintenance reported"
    described as {
      |Emitted when issue is reported.
    }
  }
  event MaintenanceCompleted is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    workOrderId: WorkOrderId with {
      briefly "Work order"
      described as {
        |Work order ID.
      }
    }
    completion: MaintenanceCompletion with {
      briefly "Completion"
      described as {
        |Completion details.
      }
    }
  } with {
    briefly "Maintenance completed"
    described as {
      |Emitted when maintenance is done.
    }
  }
  event RoomBlocked is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    blocking: RoomBlocking with {
      briefly "Blocking"
      described as {
        |Blocking details.
      }
    }
    blockedAt: TimeStamp with {
      briefly "Blocked"
      described as {
        |Block time.
      }
    }
  } with {
    briefly "Room blocked"
    described as {
      |Emitted when room is blocked.
    }
  }
  event RoomUnblocked is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    reason: String(1,200) with {
      briefly "Reason"
      described as {
        |Unblock reason.
      }
    }
    unblockedAt: TimeStamp with {
      briefly "Unblocked"
      described as {
        |Unblock time.
      }
    }
  } with {
    briefly "Room unblocked"
    described as {
      |Emitted when room is unblocked.
    }
  }
  event RoomDecommissioned is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Decommission reason.
      }
    }
    decommissionedAt: TimeStamp with {
      briefly "Decommissioned"
      described as {
        |Decommission time.
      }
    }
  } with {
    briefly "Room decommissioned"
    described as {
      |Emitted when room is decommissioned.
    }
  }
  // State Records
  record ActiveStateData is  {
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Room ID.
      }
    }
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    details: RoomDetails with {
      briefly "Details"
      described as {
        |Room details.
      }
    }
    amenities: RoomAmenities with {
      briefly "Amenities"
      described as {
        |Room amenities.
      }
    }
    status: RoomStatus with {
      briefly "Status"
      described as {
        |Room status.
      }
    }
    currentAssignment: HousekeepingAssignment? with {
      briefly "Assignment"
      described as {
        |Current assignment.
      }
    }
    lastCleaning: CleaningRecord? with {
      briefly "Cleaning"
      described as {
        |Last cleaning.
      }
    }
    lastInspection: InspectionRecord? with {
      briefly "Inspection"
      described as {
        |Last inspection.
      }
    }
    openMaintenanceRequests: MaintenanceRequest* with {
      briefly "Maintenance"
      described as {
        |Open requests.
      }
    }
    currentBlocking: RoomBlocking? with {
      briefly "Blocking"
      described as {
        |Current blocking.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Active state"
    described as {
      |State for active room.
    }
  }
  // States
  state ActiveState of type Room.ActiveStateData
  // Handler
  handler RoomHandler is {
    on command CreateRoom is {
      morph entity RoomContext.Room to state RoomContext.Room.ActiveState with command CreateRoom
      tell event RoomCreated to entity RoomContext.Room
    }
    on command UpdateRoomDetails is {
      tell event RoomDetailsUpdated to entity RoomContext.Room
    }
    on command UpdateAmenities is {
      tell event AmenitiesUpdated to entity RoomContext.Room
    }
    on command UpdateRoomStatus is {
      tell event RoomStatusChanged to entity RoomContext.Room
    }
    on command AssignHousekeeper is {
      tell event HousekeeperAssigned to entity RoomContext.Room
    }
    on command RecordCleaning is {
      tell event CleaningRecorded to entity RoomContext.Room
    }
    on command InspectRoom is {
      tell event RoomInspected to entity RoomContext.Room
    }
    on command ReportMaintenance is {
      tell event MaintenanceReported to entity RoomContext.Room
    }
    on command CompleteMaintenance is {
      tell event MaintenanceCompleted to entity RoomContext.Room
    }
    on command BlockRoom is {
      tell event RoomBlocked to entity RoomContext.Room
    }
    on command UnblockRoom is {
      tell event RoomUnblocked to entity RoomContext.Room
    }
    on command DecommissionRoom is {
      tell event RoomDecommissioned to entity RoomContext.Room
    }
  } with {
    briefly "Processes room commands"
    described as {
      | Handles room lifecycle from creation
      | through maintenance and decommissioning.
    }
  }
} with {
  briefly "Room aggregate"
  described as {
    | The Room entity manages hotel room inventory
    | and housekeeping operations.
  }
}
