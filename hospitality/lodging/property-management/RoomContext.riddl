// Property Management - Room Context
context RoomContext is {
  include "types.riddl"
  include "Room.riddl"
  // Repository for room persistence
  repository RoomRepository is {
    schema RoomData is relational
      of rooms as type Room
        index on field Room.roomId
        index on field Room.propertyId
        index on field Room.details.roomNumber
        index on field Room.details.floor
        index on field Room.status

    handler RoomPersistence is {
      on command Room.CreateRoom is {
        prompt "Store new room"
      }
      on command Room.UpdateRoomDetails is {
        prompt "Update room details"
      }
      on command Room.UpdateAmenities is {
        prompt "Update room amenities"
      }
      on command Room.UpdateRoomStatus is {
        prompt "Update room status"
      }
      on command Room.AssignHousekeeper is {
        prompt "Store assignment"
      }
      on command Room.RecordCleaning is {
        prompt "Store cleaning record"
      }
      on command Room.InspectRoom is {
        prompt "Store inspection record"
      }
      on command Room.ReportMaintenance is {
        prompt "Store maintenance request"
      }
      on command Room.CompleteMaintenance is {
        prompt "Update maintenance status"
      }
      on command Room.BlockRoom is {
        prompt "Update room blocking"
      }
      on command Room.UnblockRoom is {
        prompt "Clear room blocking"
      }
      on command Room.DecommissionRoom is {
        prompt "Archive room record"
      }
    } with {
      briefly "Persists room commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Room data persistence"
    described as {
      | The RoomRepository provides persistent storage
      | for room inventory and housekeeping data.
    }
  }
  // Projector for housekeeping analytics
  projector HousekeepingAnalytics is {
    record HousekeepingStats is  {
      date: Date with {
        briefly "Date"
        described as {
          |Statistics date.
        }
      }
      roomsCleaned: Natural with {
        briefly "Cleaned"
        described as {
          |Rooms cleaned.
        }
      }
      roomsInspected: Natural with {
        briefly "Inspected"
        described as {
          |Rooms inspected.
        }
      }
      inspectionPassRate: Decimal(5,2) with {
        briefly "Pass rate"
        described as {
          |Inspection pass rate.
        }
      }
      averageCleaningTime: Duration with {
        briefly "Avg time"
        described as {
          |Average cleaning time.
        }
      }
      openMaintenanceIssues: Natural with {
        briefly "Open issues"
        described as {
          |Open maintenance issues.
        }
      }
      roomsOutOfOrder: Natural with {
        briefly "Out of order"
        described as {
          |Rooms out of order.
        }
      }
    } with {
      briefly "Housekeeping statistics"
      described as {
        |Daily housekeeping metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Room.CleaningRecorded is {
        prompt "Update cleaning metrics"
      }
      on event Room.RoomInspected is {
        prompt "Update inspection metrics"
      }
      on event Room.MaintenanceReported is {
        prompt "Update maintenance metrics"
      }
      on event Room.MaintenanceCompleted is {
        prompt "Update resolution metrics"
      }
      on event Room.RoomStatusChanged is {
        prompt "Update status metrics"
      }
    } with {
      briefly "Maintains housekeeping analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Housekeeping analytics projections"
    described as {
      |Maintains housekeeping performance analytics.
    }
  }
} with {
  briefly "Bounded context for room management"
  described as {
    | The RoomContext is the bounded context for
    | room inventory and housekeeping management.
  }
}
