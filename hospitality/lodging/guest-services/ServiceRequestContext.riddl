// Guest Services - Service Request Context
context ServiceRequestContext is {
  include "types.riddl"
  include "ServiceRequest.riddl"
  // Repository for service request persistence
  repository ServiceRequestRepository is {
    schema ServiceRequestData is relational
      of requests as type ServiceRequest
        index on field ServiceRequest.requestId
        index on field ServiceRequest.guest.guestId
        index on field ServiceRequest.guest.roomNumber
        index on field ServiceRequest.request.category
        index on field ServiceRequest.status

    handler ServiceRequestPersistence is {
      on command ServiceRequest.CreateServiceRequest is {
        prompt "Store new service request"
      }
      on command ServiceRequest.UpdateRequestDetails is {
        prompt "Update request details"
      }
      on command ServiceRequest.AssignStaff is {
        prompt "Store staff assignment"
      }
      on command ServiceRequest.StartService is {
        prompt "Update to in progress"
      }
      on command ServiceRequest.CompleteService is {
        prompt "Update to completed"
      }
      on command ServiceRequest.CancelRequest is {
        prompt "Update to cancelled"
      }
      on command ServiceRequest.EscalateRequest is {
        prompt "Update priority"
      }
      on command ServiceRequest.RecordFeedback is {
        prompt "Store feedback"
      }
      on command ServiceRequest.AddRoomServiceOrder is {
        prompt "Store room service order"
      }
      on command ServiceRequest.AddLaundryOrder is {
        prompt "Store laundry order"
      }
      on command ServiceRequest.ScheduleWakeupCall is {
        prompt "Store wakeup call"
      }
    } with {
      briefly "Persists service request events"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Service request data persistence"
    described as {
      | The ServiceRequestRepository provides persistent
      | storage for service requests.
    }
  }
  // Projector for service analytics
  projector ServiceAnalytics is {
    record ServiceStats is  {
      date: Date with {
        briefly "Date"
        described as {
          |Statistics date.
        }
      }
      totalRequests: Natural with {
        briefly "Total"
        described as {
          |Total requests.
        }
      }
      completedRequests: Natural with {
        briefly "Completed"
        described as {
          |Completed requests.
        }
      }
      averageResponseTime: Duration with {
        briefly "Response time"
        described as {
          |Avg response time.
        }
      }
      averageFulfillmentTime: Duration with {
        briefly "Fulfillment time"
        described as {
          |Avg fulfillment time.
        }
      }
      averageRating: Decimal(3,2) with {
        briefly "Rating"
        described as {
          |Average rating.
        }
      }
      requestsByCategory: Natural+ with {
        briefly "By category"
        described as {
          |Requests by category.
        }
      }
    } with {
      briefly "Service statistics"
      described as {
        |Daily service metrics.
      }
    }
    handler AnalyticsHandler is {
      on event ServiceRequest.ServiceRequestCreated is {
        prompt "Update request counts"
      }
      on event ServiceRequest.StaffAssigned is {
        prompt "Calculate response time"
      }
      on event ServiceRequest.ServiceCompleted is {
        prompt "Update completion metrics"
      }
      on event ServiceRequest.FeedbackRecorded is {
        prompt "Update rating metrics"
      }
    } with {
      briefly "Maintains service analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Service analytics projections"
    described as {
      |Maintains service quality analytics.
    }
  }
} with {
  briefly "Bounded context for service requests"
  described as {
    | The ServiceRequestContext is the bounded context
    | for guest service request management.
  }
}
