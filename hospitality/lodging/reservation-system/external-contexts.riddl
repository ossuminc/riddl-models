// Reservation System - External Contexts

// Channel Management System
context ChannelManagementService is {

  command UpdateInventory is {
    roomType is RoomType with { briefly "Type" described by "Room type." }
    date is Date with { briefly "Date" described by "Availability date." }
    available is Natural with { briefly "Available" described by "Available rooms." }
  } with {
    briefly "Update inventory"
    described by "Updates room availability across channels."
  }

  event InventoryUpdated is {
    roomType is RoomType with { briefly "Type" described by "Room type." }
    date is Date with { briefly "Date" described by "Date updated." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Inventory updated"
    described by "Emitted when inventory is synced."
  }

  command SyncRates is {
    ratePlanId is RatePlanId with { briefly "Plan" described by "Rate plan." }
    rates is many RateInfo with { briefly "Rates" described by "Rates to sync." }
  } with {
    briefly "Sync rates"
    described by "Synchronizes rates to distribution channels."
  }

  event RatesSynced is {
    ratePlanId is RatePlanId with { briefly "Plan" described by "Rate plan." }
    syncedAt is TimeStamp with { briefly "Synced" described by "Sync time." }
  } with {
    briefly "Rates synced"
    described by "Emitted when rates are synced."
  }

} with {
  option is external
  briefly "External channel management"
  described by "External channel distribution service."
}

// Payment Processing Service
context PaymentProcessingService is {

  command AuthorizePayment is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Authorization amount." }
    paymentMethod is PaymentMethod with { briefly "Method" described by "Payment method." }
  } with {
    briefly "Authorize payment"
    described by "Authorizes payment on card."
  }

  event PaymentAuthorized is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    authorizationCode is String(1, 50) with { briefly "Auth code" described by "Authorization code." }
    authorizedAt is TimeStamp with { briefly "Authorized" described by "Authorization time." }
  } with {
    briefly "Payment authorized"
    described by "Emitted when payment is authorized."
  }

  command CapturePayment is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Capture amount." }
    authorizationCode is String(1, 50) with { briefly "Auth code" described by "Authorization code." }
  } with {
    briefly "Capture payment"
    described by "Captures authorized payment."
  }

  event PaymentCaptured is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Captured amount." }
    capturedAt is TimeStamp with { briefly "Captured" described by "Capture time." }
  } with {
    briefly "Payment captured"
    described by "Emitted when payment is captured."
  }

  command RefundPayment is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Refund amount." }
    reason is String(1, 500) with { briefly "Reason" described by "Refund reason." }
  } with {
    briefly "Refund payment"
    described by "Refunds a payment."
  }

  event PaymentRefunded is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Refunded amount." }
    refundedAt is TimeStamp with { briefly "Refunded" described by "Refund time." }
  } with {
    briefly "Payment refunded"
    described by "Emitted when payment is refunded."
  }

} with {
  option is external
  briefly "External payment processing"
  described by "External payment processor service."
}

// Guest Communication Service
context GuestCommunicationService is {

  command SendConfirmationEmail is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    guestEmail is String(5, 254) with { briefly "Email" described by "Guest email." }
    confirmationNumber is String(1, 50) with { briefly "Confirmation" described by "Confirmation number." }
    stayDetails is StayDetails with { briefly "Stay" described by "Stay details." }
  } with {
    briefly "Send confirmation"
    described by "Sends booking confirmation email."
  }

  event ConfirmationEmailSent is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Confirmation sent"
    described by "Emitted when confirmation is sent."
  }

  command SendPreArrivalEmail is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    guestEmail is String(5, 254) with { briefly "Email" described by "Guest email." }
    checkInDate is Date with { briefly "Check-in" described by "Check-in date." }
  } with {
    briefly "Send pre-arrival"
    described by "Sends pre-arrival information email."
  }

  event PreArrivalEmailSent is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Pre-arrival sent"
    described by "Emitted when pre-arrival email is sent."
  }

  command SendCheckoutReceipt is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    guestEmail is String(5, 254) with { briefly "Email" described by "Guest email." }
    billing is BillingDetails with { briefly "Billing" described by "Billing details." }
  } with {
    briefly "Send checkout receipt"
    described by "Sends checkout receipt email."
  }

  event CheckoutReceiptSent is {
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Receipt sent"
    described by "Emitted when checkout receipt is sent."
  }

} with {
  option is external
  briefly "External guest communication"
  described by "External email and SMS service."
}

// Loyalty Program Service
context LoyaltyProgramService is {

  query GetMemberTier is {
    loyaltyNumber is String(1, 50) with { briefly "Number" described by "Loyalty number." }
  } with {
    briefly "Get member tier"
    described by "Retrieves member loyalty tier."
  }

  result MemberTierResult is {
    tier is String(1, 50) with { briefly "Tier" described by "Member tier." }
    pointsBalance is Natural with { briefly "Points" described by "Points balance." }
    benefits is many String(1, 200) with { briefly "Benefits" described by "Tier benefits." }
  } with {
    briefly "Member tier result"
    described by "Loyalty tier information."
  }

  command AwardPoints is {
    loyaltyNumber is String(1, 50) with { briefly "Number" described by "Loyalty number." }
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    points is Natural with { briefly "Points" described by "Points to award." }
    reason is String(1, 200) with { briefly "Reason" described by "Award reason." }
  } with {
    briefly "Award points"
    described by "Awards loyalty points for stay."
  }

  event PointsAwarded is {
    loyaltyNumber is String(1, 50) with { briefly "Number" described by "Loyalty number." }
    points is Natural with { briefly "Points" described by "Points awarded." }
    awardedAt is TimeStamp with { briefly "Awarded" described by "Award time." }
  } with {
    briefly "Points awarded"
    described by "Emitted when points are awarded."
  }

} with {
  option is external
  briefly "External loyalty program"
  described by "External loyalty rewards service."
}

// Room Management Service
context RoomManagementService is {

  query GetAvailableRooms is {
    checkInDate is Date with { briefly "Check-in" described by "Check-in date." }
    checkOutDate is Date with { briefly "Check-out" described by "Check-out date." }
    roomType is RoomType with { briefly "Type" described by "Room type." }
    numberOfRooms is Natural with { briefly "Count" described by "Number of rooms needed." }
  } with {
    briefly "Get available rooms"
    described by "Queries available rooms for dates."
  }

  result AvailableRoomsResult is {
    rooms is many RoomAssignment with { briefly "Rooms" described by "Available rooms." }
    totalAvailable is Natural with { briefly "Total" described by "Total available." }
  } with {
    briefly "Available rooms result"
    described by "List of available rooms."
  }

  command ReserveRoom is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    fromDate is Date with { briefly "From" described by "Start date." }
    toDate is Date with { briefly "To" described by "End date." }
  } with {
    briefly "Reserve room"
    described by "Reserves a room for dates."
  }

  event RoomReserved is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
    reservedAt is TimeStamp with { briefly "Reserved" described by "Reservation time." }
  } with {
    briefly "Room reserved"
    described by "Emitted when room is reserved."
  }

  command ReleaseRoom is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    reservationId is ReservationId with { briefly "Reservation" described by "Reservation ID." }
  } with {
    briefly "Release room"
    described by "Releases a room reservation."
  }

  event RoomReleased is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    releasedAt is TimeStamp with { briefly "Released" described by "Release time." }
  } with {
    briefly "Room released"
    described by "Emitted when room is released."
  }

} with {
  option is external
  briefly "External room management"
  described by "External room inventory service."
}

// Housekeeping Service
context HousekeepingService is {

  command RequestRoomCleaning is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    roomNumber is String(1, 20) with { briefly "Number" described by "Room number." }
    priority is String(1, 20) with { briefly "Priority" described by "Cleaning priority." }
    expectedCheckIn is optional TimeStamp with { briefly "Check-in" described by "Expected check-in." }
  } with {
    briefly "Request cleaning"
    described by "Requests room to be cleaned."
  }

  event CleaningRequested is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    requestedAt is TimeStamp with { briefly "Requested" described by "Request time." }
  } with {
    briefly "Cleaning requested"
    described by "Emitted when cleaning is requested."
  }

  event RoomCleaningCompleted is {
    roomId is RoomId with { briefly "Room" described by "Room ID." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
    inspectedBy is optional String(1, 200) with { briefly "Inspector" described by "Inspector name." }
  } with {
    briefly "Cleaning completed"
    described by "Emitted when room is clean."
  }

} with {
  option is external
  briefly "External housekeeping"
  described by "External housekeeping service."
}
