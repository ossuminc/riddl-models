// Reservation System - Reservation Context

context ReservationContext is {

  include "types.riddl"
  include "Reservation.riddl"

  // Repository for reservation persistence
  repository ReservationRepository is {
    schema ReservationData is relational
      of reservations as Reservation
      index on field Reservation.reservationId
      index on field Reservation.guest.guestId
      index on field Reservation.stay.checkInDate
      index on field Reservation.stay.checkOutDate
      index on field Reservation.status

    handler ReservationPersistence is {
      on event Reservation.ReservationCreated {
        prompt "Store new reservation"
      }
      on event Reservation.ReservationModified {
        prompt "Update reservation details"
      }
      on event Reservation.ReservationConfirmed {
        prompt "Update confirmation status"
      }
      on event Reservation.RoomAssigned {
        prompt "Store room assignment"
      }
      on event Reservation.GuestCheckedIn {
        prompt "Update to checked in"
      }
      on event Reservation.ChargeAdded {
        prompt "Store charge"
      }
      on event Reservation.PaymentRecorded {
        prompt "Store payment"
      }
      on event Reservation.GuestCheckedOut {
        prompt "Update to checked out"
      }
      on event Reservation.ReservationCancelled {
        prompt "Update to cancelled"
      }
      on event Reservation.GuestMarkedNoShow {
        prompt "Update to no show"
      }
    } with {
      briefly "Persists reservation events"
      described by "Handles event-driven persistence."
    }
  } with {
    briefly "Reservation data persistence"
    described by {
      | The ReservationRepository provides persistent storage
      | for reservations and related data.
    }
  }

  // Projector for reservation analytics
  projector ReservationAnalytics is {
    updates repository ReservationRepository

    record OccupancyStats is {
      date is Date with { briefly "Date" described by "Statistics date." }
      totalRooms is Natural with { briefly "Total" described by "Total rooms." }
      occupiedRooms is Natural with { briefly "Occupied" described by "Occupied rooms." }
      occupancyRate is Decimal(5, 2) with { briefly "Rate" described by "Occupancy rate." }
      revenuePerRoom is Decimal(10, 2) with { briefly "RevPAR" described by "Revenue per available room." }
      averageDailyRate is Decimal(10, 2) with { briefly "ADR" described by "Average daily rate." }
    } with {
      briefly "Occupancy statistics"
      described by "Daily occupancy metrics."
    }

    handler AnalyticsHandler is {
      on event Reservation.ReservationCreated {
        prompt "Update booking metrics"
      }
      on event Reservation.GuestCheckedIn {
        prompt "Update occupancy"
      }
      on event Reservation.GuestCheckedOut {
        prompt "Update revenue metrics"
      }
      on event Reservation.ReservationCancelled {
        prompt "Update cancellation metrics"
      }
      on event Reservation.GuestMarkedNoShow {
        prompt "Update no-show metrics"
      }
    } with {
      briefly "Maintains reservation analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Reservation analytics projections"
    described by "Maintains occupancy and revenue analytics."
  }

} with {
  briefly "Bounded context for reservations"
  described by {
    | The ReservationContext is the bounded context for
    | hotel reservation management.
  }
}
