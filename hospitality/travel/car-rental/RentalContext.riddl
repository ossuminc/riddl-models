// Car Rental - Rental Context
context RentalContext is {
  include "types.riddl"
  include "Rental.riddl"
  // Repository for rental persistence
  repository RentalRepository is {
    schema RentalData is relational
      of rentals as type Rental
        index on field Rental.rentalId
        index on field Rental.customer.customerId
        index on field Rental.vehicle.vehicleId
        index on field Rental.period.pickupLocation.locationId

    handler RentalPersistence is {
      on command Rental.CreateRental is {
        prompt "Store new rental"
      }
      on command Rental.AddAddOn is {
        prompt "Add add-on to rental"
      }
      on command Rental.SelectInsurance is {
        prompt "Store insurance selection"
      }
      on command Rental.AuthorizePayment is {
        prompt "Store payment authorization"
      }
      on command Rental.CheckOutVehicle is {
        prompt "Update to active"
      }
      on command Rental.ExtendRental is {
        prompt "Update rental period"
      }
      on command Rental.ModifyReturnLocation is {
        prompt "Update return location"
      }
      on command Rental.CheckInVehicle is {
        prompt "Update to returned"
      }
      on command Rental.AssessDamages is {
        prompt "Store damage assessment"
      }
      on command Rental.ProcessFinalCharges is {
        prompt "Store final charges"
      }
      on command Rental.CompleteRental is {
        prompt "Update to completed"
      }
      on command Rental.CancelRental is {
        prompt "Update to cancelled"
      }
    } with {
      briefly "Persists rental commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Rental data persistence"
    described as {
      | The RentalRepository provides persistent storage for
      | rentals and related data.
    }
  }
  // Projector for rental analytics
  projector RentalAnalytics is {
    record RentalStats is  {
      totalRentals: Natural with {
        briefly "Total"
        described as {
          |Total rentals.
        }
      }
      activeRentals: Natural with {
        briefly "Active"
        described as {
          |Active rentals.
        }
      }
      completedRentals: Natural with {
        briefly "Completed"
        described as {
          |Completed rentals.
        }
      }
      cancelledRentals: Natural with {
        briefly "Cancelled"
        described as {
          |Cancelled rentals.
        }
      }
      totalRevenue: Decimal(12,2) with {
        briefly "Revenue"
        described as {
          |Total revenue.
        }
      }
      averageRentalDays: Decimal(5,2) with {
        briefly "Avg days"
        described as {
          |Average rental duration.
        }
      }
      fleetUtilization: Decimal(5,2) with {
        briefly "Utilization"
        described as {
          |Fleet utilization rate.
        }
      }
    } with {
      briefly "Rental statistics"
      described as {
        |Rental operations metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Rental.RentalCreated is {
        prompt "Update rental counts"
      }
      on event Rental.VehicleCheckedOut is {
        prompt "Update active counts"
      }
      on event Rental.FinalChargesProcessed is {
        prompt "Update revenue metrics"
      }
      on event Rental.RentalCompleted is {
        prompt "Update completion metrics"
      }
      on event Rental.RentalCancelled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains rental analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Rental analytics projections"
    described as {
      |Maintains rental operations analytics data.
    }
  }
} with {
  briefly "Bounded context for car rental"
  described as {
    | The RentalContext is the bounded context for
    | vehicle rentals and fleet management.
  }
}
