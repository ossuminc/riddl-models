// Car Rental - External Contexts

// Vehicle Availability Service
context VehicleAvailabilityService is {

  query SearchAvailableVehicles is {
    pickupLocationId is LocationId with { briefly "Pickup" described by "Pickup location." }
    returnLocationId is LocationId with { briefly "Return" described by "Return location." }
    pickupDateTime is TimeStamp with { briefly "Pickup time" described by "Pickup date/time." }
    returnDateTime is TimeStamp with { briefly "Return time" described by "Return date/time." }
    vehicleClass is optional VehicleClass with { briefly "Class" described by "Vehicle class filter." }
  } with {
    briefly "Search available vehicles"
    described by "Searches for available vehicles."
  }

  result AvailableVehicles is {
    vehicles is many VehicleInfo with { briefly "Vehicles" described by "Available vehicles." }
  } with {
    briefly "Available vehicles"
    described by "List of available vehicles."
  }

  command ReserveVehicle is {
    vehicleId is VehicleId with { briefly "Vehicle" described by "Vehicle ID." }
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    period is RentalPeriod with { briefly "Period" described by "Rental period." }
  } with {
    briefly "Reserve vehicle"
    described by "Reserves vehicle for rental."
  }

  event VehicleReserved is {
    vehicleId is VehicleId with { briefly "Vehicle" described by "Vehicle ID." }
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    reservedAt is TimeStamp with { briefly "Reserved" described by "Reservation time." }
  } with {
    briefly "Vehicle reserved"
    described by "Emitted when vehicle is reserved."
  }

  command ReleaseVehicle is {
    vehicleId is VehicleId with { briefly "Vehicle" described by "Vehicle ID." }
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
  } with {
    briefly "Release vehicle"
    described by "Releases vehicle reservation."
  }

  event VehicleReleased is {
    vehicleId is VehicleId with { briefly "Vehicle" described by "Vehicle ID." }
    releasedAt is TimeStamp with { briefly "Released" described by "Release time." }
  } with {
    briefly "Vehicle released"
    described by "Emitted when vehicle is released."
  }

} with {
  option is external
  briefly "External vehicle availability"
  described by "External fleet availability service."
}

// Pricing Service
context PricingService is {

  query CalculateRentalPrice is {
    vehicle is VehicleInfo with { briefly "Vehicle" described by "Vehicle info." }
    period is RentalPeriod with { briefly "Period" described by "Rental period." }
    addOns is many optional AddOn with { briefly "Add-ons" described by "Add-ons." }
    insurance is optional InsuranceOption with { briefly "Insurance" described by "Insurance." }
  } with {
    briefly "Calculate price"
    described by "Calculates rental price."
  }

  result RentalPrice is {
    charges is RentalCharges with { briefly "Charges" described by "Rental charges." }
  } with {
    briefly "Rental price"
    described by "Calculated pricing."
  }

} with {
  option is external
  briefly "External pricing"
  described by "External pricing service."
}

// Payment Processing Service
context PaymentProcessingService is {

  command AuthorizePayment is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Authorization amount." }
    paymentMethod is String(1, 50) with { briefly "Method" described by "Payment method." }
    paymentToken is String(1, 200) with { briefly "Token" described by "Payment token." }
  } with {
    briefly "Authorize payment"
    described by "Authorizes payment."
  }

  event PaymentAuthorized is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    authorizationId is String(1, 100) with { briefly "Authorization" described by "Authorization ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Authorized amount." }
    authorizedAt is TimeStamp with { briefly "Authorized" described by "Authorization time." }
  } with {
    briefly "Payment authorized"
    described by "Emitted when payment is authorized."
  }

  command CapturePayment is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    authorizationId is String(1, 100) with { briefly "Authorization" described by "Authorization ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Capture amount." }
  } with {
    briefly "Capture payment"
    described by "Captures authorized payment."
  }

  event PaymentCaptured is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    transactionId is String(1, 100) with { briefly "Transaction" described by "Transaction ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Captured amount." }
    capturedAt is TimeStamp with { briefly "Captured" described by "Capture time." }
  } with {
    briefly "Payment captured"
    described by "Emitted when payment is captured."
  }

  command ProcessRefund is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Refund amount." }
    reason is String(1, 500) with { briefly "Reason" described by "Refund reason." }
  } with {
    briefly "Process refund"
    described by "Processes refund."
  }

  event RefundProcessed is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    refundId is String(1, 100) with { briefly "Refund" described by "Refund ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Refund amount." }
    processedAt is TimeStamp with { briefly "Processed" described by "Process time." }
  } with {
    briefly "Refund processed"
    described by "Emitted when refund is processed."
  }

} with {
  option is external
  briefly "External payment processing"
  described by "External payment service."
}

// Driver Verification Service
context DriverVerificationService is {

  command VerifyDriver is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    licenseNumber is String(1, 50) with { briefly "License" described by "License number." }
    licenseState is String(2, 50) with { briefly "State" described by "License state." }
    dateOfBirth is Date with { briefly "DOB" described by "Date of birth." }
  } with {
    briefly "Verify driver"
    described by "Verifies driver credentials."
  }

  event DriverVerified is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    verified is Boolean with { briefly "Verified" described by "Verification result." }
    verifiedAt is TimeStamp with { briefly "Verified" described by "Verification time." }
  } with {
    briefly "Driver verified"
    described by "Emitted when driver is verified."
  }

  event VerificationFailed is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Failure reason." }
    failedAt is TimeStamp with { briefly "Failed" described by "Failure time." }
  } with {
    briefly "Verification failed"
    described by "Emitted when verification fails."
  }

} with {
  option is external
  briefly "External driver verification"
  described by "External license verification service."
}

// Insurance Provider Service
context InsuranceProviderService is {

  query GetInsuranceOptions is {
    vehicleClass is VehicleClass with { briefly "Class" described by "Vehicle class." }
    rentalDays is Natural with { briefly "Days" described by "Rental duration." }
  } with {
    briefly "Get insurance options"
    described by "Retrieves available insurance."
  }

  result InsuranceOptions is {
    options is many InsuranceOption with { briefly "Options" described by "Insurance options." }
  } with {
    briefly "Insurance options"
    described by "Available insurance options."
  }

  command ActivateCoverage is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    insurance is InsuranceOption with { briefly "Insurance" described by "Insurance selection." }
    startDate is Date with { briefly "Start" described by "Coverage start." }
    endDate is Date with { briefly "End" described by "Coverage end." }
  } with {
    briefly "Activate coverage"
    described by "Activates insurance coverage."
  }

  event CoverageActivated is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    policyNumber is String(1, 50) with { briefly "Policy" described by "Policy number." }
    activatedAt is TimeStamp with { briefly "Activated" described by "Activation time." }
  } with {
    briefly "Coverage activated"
    described by "Emitted when coverage is activated."
  }

} with {
  option is external
  briefly "External insurance provider"
  described by "External insurance service."
}

// Notification Service
context NotificationService is {

  command SendReservationConfirmation is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    customerEmail is String(5, 254) with { briefly "Email" described by "Customer email." }
    rentalDetails is String(1, 5000) with { briefly "Details" described by "Rental details." }
  } with {
    briefly "Send confirmation"
    described by "Sends reservation confirmation."
  }

  event ConfirmationSent is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Confirmation sent"
    described by "Emitted when confirmation is sent."
  }

  command SendPickupReminder is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    customerEmail is String(5, 254) with { briefly "Email" described by "Customer email." }
    pickupDateTime is TimeStamp with { briefly "Pickup" described by "Pickup time." }
  } with {
    briefly "Send pickup reminder"
    described by "Sends pickup reminder."
  }

  event ReminderSent is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Reminder sent"
    described by "Emitted when reminder is sent."
  }

  command SendReturnReminder is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    customerEmail is String(5, 254) with { briefly "Email" described by "Customer email." }
    returnDateTime is TimeStamp with { briefly "Return" described by "Return time." }
  } with {
    briefly "Send return reminder"
    described by "Sends return reminder."
  }

  command SendReceipt is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    customerEmail is String(5, 254) with { briefly "Email" described by "Customer email." }
    charges is RentalCharges with { briefly "Charges" described by "Final charges." }
  } with {
    briefly "Send receipt"
    described by "Sends rental receipt."
  }

  event ReceiptSent is {
    rentalId is RentalId with { briefly "Rental" described by "Rental ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Receipt sent"
    described by "Emitted when receipt is sent."
  }

} with {
  option is external
  briefly "External notifications"
  described by "External notification service."
}

// Fleet Maintenance Service
context FleetMaintenanceService is {

  command ScheduleInspection is {
    vehicleId is VehicleId with { briefly "Vehicle" described by "Vehicle ID." }
    inspectionType is String(1, 50) with { briefly "Type" described by "Inspection type." }
    scheduledDate is Date with { briefly "Date" described by "Scheduled date." }
  } with {
    briefly "Schedule inspection"
    described by "Schedules vehicle inspection."
  }

  event InspectionScheduled is {
    vehicleId is VehicleId with { briefly "Vehicle" described by "Vehicle ID." }
    scheduledFor is TimeStamp with { briefly "Scheduled" described by "Scheduled time." }
  } with {
    briefly "Inspection scheduled"
    described by "Emitted when inspection is scheduled."
  }

  command ReportDamage is {
    vehicleId is VehicleId with { briefly "Vehicle" described by "Vehicle ID." }
    rentalId is RentalId with { briefly "Rental" described by "Associated rental." }
    damages is many String(1, 200) with { briefly "Damages" described by "Damage descriptions." }
    estimatedCost is Decimal(10, 2) with { briefly "Cost" described by "Estimated cost." }
  } with {
    briefly "Report damage"
    described by "Reports vehicle damage."
  }

  event DamageReported is {
    vehicleId is VehicleId with { briefly "Vehicle" described by "Vehicle ID." }
    reportId is UUID with { briefly "Report" described by "Damage report ID." }
    reportedAt is TimeStamp with { briefly "Reported" described by "Report time." }
  } with {
    briefly "Damage reported"
    described by "Emitted when damage is reported."
  }

} with {
  option is external
  briefly "External fleet maintenance"
  described by "External maintenance service."
}
