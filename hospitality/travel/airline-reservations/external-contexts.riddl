// Airline Reservations - External Contexts
// Flight Search Service
context FlightSearchService is {
  query SearchFlights is  {
    origin: AirportCode with {
      briefly "Origin"
      described as {
        |Departure airport.
      }
    }
    destination: AirportCode with {
      briefly "Destination"
      described as {
        |Arrival airport.
      }
    }
    departureDate: Date with {
      briefly "Date"
      described as {
        |Departure date.
      }
    }
    returnDate: Date? with {
      briefly "Return"
      described as {
        |Return date.
      }
    }
    filterCabinClass: CabinClass? with {
      briefly "Class"
      described as {
        |Cabin class.
      }
    }
    passengers: Natural with {
      briefly "Passengers"
      described as {
        |Passenger count.
      }
    }
  } with {
    briefly "Search flights"
    described as {
      |Searches for available flights.
    }
  }
  result FlightSearchResults is  {
    outboundFlights: FlightInfo+ with {
      briefly "Outbound"
      described as {
        |Outbound flights.
      }
    }
    returnFlights: FlightInfo* with {
      briefly "Return"
      described as {
        |Return flights.
      }
    }
  } with {
    briefly "Flight search results"
    described as {
      |Available flights.
    }
  }
  query GetFlightDetails is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
  } with {
    briefly "Get flight details"
    described as {
      |Retrieves flight details.
    }
  }
  result FlightDetails is  {
    flight: FlightInfo with {
      briefly "Flight"
      described as {
        |Flight info.
      }
    }
    availableSeats: SeatInfo+ with {
      briefly "Seats"
      described as {
        |Available seats.
      }
    }
    fares: ReservationPricing+ with {
      briefly "Fares"
      described as {
        |Available fares.
      }
    }
  } with {
    briefly "Flight details"
    described as {
      |Full flight information.
    }
  }
} with {
  option external()
  briefly "External flight search"
  described as {
    |External flight inventory service.
  }
}
// Seat Inventory Service
context SeatInventoryService is {
  query GetAvailableSeats is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    cabinClass: CabinClass with {
      briefly "Class"
      described as {
        |Cabin class.
      }
    }
  } with {
    briefly "Get available seats"
    described as {
      |Retrieves available seats.
    }
  }
  result AvailableSeats is  {
    seats: SeatInfo+ with {
      briefly "Seats"
      described as {
        |Available seats.
      }
    }
  } with {
    briefly "Available seats"
    described as {
      |List of available seats.
    }
  }
  command ReserveSeat is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    seatId: SeatId with {
      briefly "Seat"
      described as {
        |Seat ID.
      }
    }
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
  } with {
    briefly "Reserve seat"
    described as {
      |Reserves seat for reservation.
    }
  }
  event SeatReserved is  {
    seatId: SeatId with {
      briefly "Seat"
      described as {
        |Seat ID.
      }
    }
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Seat reserved"
    described as {
      |Emitted when seat is reserved.
    }
  }
  command ReleaseSeat is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    seatId: SeatId with {
      briefly "Seat"
      described as {
        |Seat ID.
      }
    }
  } with {
    briefly "Release seat"
    described as {
      |Releases seat reservation.
    }
  }
  event SeatReleased is  {
    seatId: SeatId with {
      briefly "Seat"
      described as {
        |Seat ID.
      }
    }
    releasedAt: TimeStamp with {
      briefly "Released"
      described as {
        |Release time.
      }
    }
  } with {
    briefly "Seat released"
    described as {
      |Emitted when seat is released.
    }
  }
} with {
  option external()
  briefly "External seat inventory"
  described as {
    |External seat management service.
  }
}
// Pricing Service
context PricingService is {
  query CalculateFare is  {
    segments: FlightSegment+ with {
      briefly "Segments"
      described as {
        |Flight segments.
      }
    }
    passenger: PassengerInfo with {
      briefly "Passenger"
      described as {
        |Passenger info.
      }
    }
    cabinClass: CabinClass with {
      briefly "Class"
      described as {
        |Cabin class.
      }
    }
    extraBaggage: ExtraBaggage? with {
      briefly "Baggage"
      described as {
        |Extra baggage.
      }
    }
  } with {
    briefly "Calculate fare"
    described as {
      |Calculates fare for itinerary.
    }
  }
  result FareCalculation is  {
    pricing: ReservationPricing with {
      briefly "Pricing"
      described as {
        |Fare calculation.
      }
    }
    baggageAllowance: BaggageAllowance with {
      briefly "Baggage"
      described as {
        |Included baggage.
      }
    }
  } with {
    briefly "Fare calculation"
    described as {
      |Calculated fare.
    }
  }
} with {
  option external()
  briefly "External pricing"
  described as {
    |External fare calculation service.
  }
}
// Payment Processing Service
context PaymentProcessingService is {
  command ProcessReservationPayment is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    currency: String(3,3) with {
      briefly "Currency"
      described as {
        |Currency code.
      }
    }
    paymentMethod: String(1,50) with {
      briefly "Method"
      described as {
        |Payment method.
      }
    }
    paymentToken: String(1,200) with {
      briefly "Token"
      described as {
        |Payment token.
      }
    }
  } with {
    briefly "Process payment"
    described as {
      |Processes payment.
    }
  }
  event PaymentSucceeded is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    transactionId: String(1,100) with {
      briefly "Transaction"
      described as {
        |Transaction ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Amount processed.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Process time.
      }
    }
  } with {
    briefly "Payment succeeded"
    described as {
      |Emitted when payment succeeds.
    }
  }
  event PaymentFailed is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    errorCode: String(1,50) with {
      briefly "Error"
      described as {
        |Error code.
      }
    }
    errorMessage: String(1,500) with {
      briefly "Message"
      described as {
        |Error message.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |Failure time.
      }
    }
  } with {
    briefly "Payment failed"
    described as {
      |Emitted when payment fails.
    }
  }
  command ProcessReservationRefund is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    transactionId: String(1,100) with {
      briefly "Transaction"
      described as {
        |Original transaction.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Refund reason.
      }
    }
  } with {
    briefly "Process refund"
    described as {
      |Processes refund.
    }
  }
  event RefundSucceeded is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    refundId: String(1,100) with {
      briefly "Refund"
      described as {
        |Refund ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Process time.
      }
    }
  } with {
    briefly "Refund succeeded"
    described as {
      |Emitted when refund succeeds.
    }
  }
} with {
  option external()
  briefly "External payment processing"
  described as {
    |External payment service.
  }
}
// Check-In Service
context CheckInService is {
  command OpenCheckIn is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    opensAt: TimeStamp with {
      briefly "Opens"
      described as {
        |Check-in open time.
      }
    }
  } with {
    briefly "Open check-in"
    described as {
      |Opens check-in for flight.
    }
  }
  event CheckInOpened is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    openedAt: TimeStamp with {
      briefly "Opened"
      described as {
        |Open time.
      }
    }
  } with {
    briefly "Check-in opened"
    described as {
      |Emitted when check-in opens.
    }
  }
  command CloseCheckIn is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
  } with {
    briefly "Close check-in"
    described as {
      |Closes check-in for flight.
    }
  }
  event CheckInClosed is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    closedAt: TimeStamp with {
      briefly "Closed"
      described as {
        |Close time.
      }
    }
  } with {
    briefly "Check-in closed"
    described as {
      |Emitted when check-in closes.
    }
  }
} with {
  option external()
  briefly "External check-in service"
  described as {
    |External check-in management.
  }
}
// Boarding Service
context BoardingService is {
  command StartBoarding is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    gate: String(1,10) with {
      briefly "Gate"
      described as {
        |Departure gate.
      }
    }
  } with {
    briefly "Start boarding"
    described as {
      |Starts boarding process.
    }
  }
  event BoardingStarted is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    gate: String(1,10) with {
      briefly "Gate"
      described as {
        |Gate.
      }
    }
    startedAt: TimeStamp with {
      briefly "Started"
      described as {
        |Start time.
      }
    }
  } with {
    briefly "Boarding started"
    described as {
      |Emitted when boarding starts.
    }
  }
  command ScanBoardingPass is  {
    passNumber: String(1,20) with {
      briefly "Pass"
      described as {
        |Pass number.
      }
    }
    barcode: String(1,500) with {
      briefly "Barcode"
      described as {
        |Scanned barcode.
      }
    }
  } with {
    briefly "Scan boarding pass"
    described as {
      |Scans boarding pass.
    }
  }
  event BoardingPassScanned is  {
    passNumber: String(1,20) with {
      briefly "Pass"
      described as {
        |Pass number.
      }
    }
    valid: Boolean with {
      briefly "Valid"
      described as {
        |Whether valid.
      }
    }
    scannedAt: TimeStamp with {
      briefly "Scanned"
      described as {
        |Scan time.
      }
    }
  } with {
    briefly "Boarding pass scanned"
    described as {
      |Emitted when pass is scanned.
    }
  }
  command CompleteBoarding is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    passengerCount: Natural with {
      briefly "Count"
      described as {
        |Boarded passengers.
      }
    }
  } with {
    briefly "Complete boarding"
    described as {
      |Completes boarding process.
    }
  }
  event BoardingCompleted is  {
    flightId: FlightId with {
      briefly "Flight"
      described as {
        |Flight ID.
      }
    }
    passengerCount: Natural with {
      briefly "Count"
      described as {
        |Boarded count.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Boarding completed"
    described as {
      |Emitted when boarding completes.
    }
  }
} with {
  option external()
  briefly "External boarding service"
  described as {
    |External boarding management.
  }
}
// Notification Service
context NotificationService is {
  command SendItineraryConfirmation is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    passengerEmail: String(5,254) with {
      briefly "Email"
      described as {
        |Passenger email.
      }
    }
    confirmationCode: String(6,6) with {
      briefly "Confirmation"
      described as {
        |Confirmation code.
      }
    }
    itinerary: String(1,10000) with {
      briefly "Itinerary"
      described as {
        |Full itinerary.
      }
    }
  } with {
    briefly "Send itinerary"
    described as {
      |Sends itinerary confirmation.
    }
  }
  event ItinerarySent is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Itinerary sent"
    described as {
      |Emitted when itinerary is sent.
    }
  }
  command SendCheckInReminder is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    passengerEmail: String(5,254) with {
      briefly "Email"
      described as {
        |Passenger email.
      }
    }
    checkInOpens: TimeStamp with {
      briefly "Opens"
      described as {
        |Check-in opens.
      }
    }
  } with {
    briefly "Send check-in reminder"
    described as {
      |Sends check-in reminder.
    }
  }
  event CheckInReminderSent is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Check-in reminder sent"
    described as {
      |Emitted when reminder is sent.
    }
  }
  command SendBoardingPass is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    passengerEmail: String(5,254) with {
      briefly "Email"
      described as {
        |Passenger email.
      }
    }
    boardingPass: BoardingPass with {
      briefly "Pass"
      described as {
        |Boarding pass.
      }
    }
  } with {
    briefly "Send boarding pass"
    described as {
      |Sends boarding pass.
    }
  }
  event BoardingPassSent is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Boarding pass sent"
    described as {
      |Emitted when pass is sent.
    }
  }
  command SendFlightStatusUpdate is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    passengerEmail: String(5,254) with {
      briefly "Email"
      described as {
        |Passenger email.
      }
    }
    statusMessage: String(1,500) with {
      briefly "Status"
      described as {
        |Status message.
      }
    }
  } with {
    briefly "Send flight status"
    described as {
      |Sends flight status update.
    }
  }
  event FlightStatusSent is  {
    reservationId: ReservationId with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Flight status sent"
    described as {
      |Emitted when status is sent.
    }
  }
} with {
  option external()
  briefly "External notifications"
  described as {
    |External notification service.
  }
}
