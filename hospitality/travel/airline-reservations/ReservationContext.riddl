// Airline Reservations - Reservation Context
context ReservationContext is {
  include "types.riddl"
  include "Reservation.riddl"
  // Repository for reservation persistence
  repository ReservationRepository is {
    schema ReservationData is relational
      of reservations as type Reservation
        index on field Reservation.reservationId
        index on field Reservation.passenger.passengerId
        index on field Reservation.confirmationCode

    handler ReservationPersistence is {
      on command Reservation.CreateReservation is {
        prompt "Store new reservation"
      }
      on command Reservation.SelectSeat is {
        prompt "Update seat assignment"
      }
      on command Reservation.AddExtraBaggage is {
        prompt "Store extra baggage"
      }
      on command Reservation.SetMealPreference is {
        prompt "Store meal preference"
      }
      on command Reservation.RequestSpecialService is {
        prompt "Store special service"
      }
      on command Reservation.ProcessPayment is {
        prompt "Store payment"
      }
      on command Reservation.ConfirmReservation is {
        prompt "Update to confirmed"
      }
      on command Reservation.CheckIn is {
        prompt "Update to checked in"
      }
      on command Reservation.IssueBoardingPass is {
        prompt "Store boarding pass"
      }
      on command Reservation.BoardFlight is {
        prompt "Update to boarded"
      }
      on command Reservation.ChangeFlightSegment is {
        prompt "Update flight segment"
      }
      on command Reservation.CancelReservation is {
        prompt "Update to cancelled"
      }
      on command Reservation.ProcessRefund is {
        prompt "Store refund"
      }
    } with {
      briefly "Persists reservation commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Reservation data persistence"
    described as {
      | The ReservationRepository provides persistent storage for
      | reservations and related data.
    }
  }
  // Projector for airline analytics
  projector AirlineAnalytics is {
    record AirlineStats is  {
      totalReservations: Natural with {
        briefly "Total"
        described as {
          |Total reservations.
        }
      }
      confirmedReservations: Natural with {
        briefly "Confirmed"
        described as {
          |Confirmed reservations.
        }
      }
      checkedInCount: Natural with {
        briefly "Checked in"
        described as {
          |Checked in count.
        }
      }
      cancelledReservations: Natural with {
        briefly "Cancelled"
        described as {
          |Cancelled reservations.
        }
      }
      totalRevenue: Decimal(12,2) with {
        briefly "Revenue"
        described as {
          |Total revenue.
        }
      }
      loadFactor: Decimal(5,2) with {
        briefly "Load factor"
        described as {
          |Seat occupancy rate.
        }
      }
    } with {
      briefly "Airline statistics"
      described as {
        |Airline booking metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Reservation.ReservationCreated is {
        prompt "Update reservation counts"
      }
      on event Reservation.ReservationConfirmed is {
        prompt "Update confirmed counts"
      }
      on event Reservation.PaymentProcessed is {
        prompt "Update revenue metrics"
      }
      on event Reservation.PassengerCheckedIn is {
        prompt "Update check-in metrics"
      }
      on event Reservation.ReservationCancelled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains airline analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Airline analytics projections"
    described as {
      |Maintains airline booking analytics data.
    }
  }
} with {
  briefly "Bounded context for airline reservations"
  described as {
    | The ReservationContext is the bounded context for
    | flight reservations and passenger management.
  }
}
