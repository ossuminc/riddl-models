// Restaurant Operations - External Contexts
// Table Management Service
context TableManagementService is {
  query GetAvailableTables is  {
    partySize: Natural with {
      briefly "Party size"
      described as {
        |Number of guests.
      }
    }
    filterSection: String(1,50)? with {
      briefly "Section"
      described as {
        |Preferred section.
      }
    }
  } with {
    briefly "Get available tables"
    described as {
      |Finds available tables.
    }
  }
  result AvailableTables is  {
    tables: TableInfo+ with {
      briefly "Tables"
      described as {
        |Available tables.
      }
    }
  } with {
    briefly "Available tables"
    described as {
      |List of available tables.
    }
  }
  command AssignTable is  {
    tableId: TableId with {
      briefly "Table"
      described as {
        |Table ID.
      }
    }
    orderId: TableOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
  } with {
    briefly "Assign table"
    described as {
      |Assigns table to order.
    }
  }
  event TableAssigned is  {
    tableId: TableId with {
      briefly "Table"
      described as {
        |Table ID.
      }
    }
    orderId: TableOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Table assigned"
    described as {
      |Emitted when table is assigned.
    }
  }
  command ReleaseTable is  {
    tableId: TableId with {
      briefly "Table"
      described as {
        |Table ID.
      }
    }
  } with {
    briefly "Release table"
    described as {
      |Releases table after close.
    }
  }
  event TableReleased is  {
    tableId: TableId with {
      briefly "Table"
      described as {
        |Table ID.
      }
    }
    releasedAt: TimeStamp with {
      briefly "Released"
      described as {
        |Release time.
      }
    }
  } with {
    briefly "Table released"
    described as {
      |Emitted when table is released.
    }
  }
} with {
  option external()
  briefly "External table management"
  described as {
    |External table tracking service.
  }
}
// Menu Service
context MenuService is {
  query GetMenuItems is  {
    filterCourseType: CourseType? with {
      briefly "Course"
      described as {
        |Course filter.
      }
    }
    filterAvailable: Boolean? with {
      briefly "Available"
      described as {
        |Availability filter.
      }
    }
  } with {
    briefly "Get menu items"
    described as {
      |Retrieves menu items.
    }
  }
  result MenuItems is  {
    menuItems: MenuItem+ with {
      briefly "Items"
      described as {
        |Menu items.
      }
    }
  } with {
    briefly "Menu items"
    described as {
      |List of menu items.
    }
  }
  query GetItemDetails is  {
    itemId: MenuItemId with {
      briefly "Item"
      described as {
        |Menu item ID.
      }
    }
  } with {
    briefly "Get item details"
    described as {
      |Retrieves item details.
    }
  }
  result ItemDetails is  {
    item: MenuItem with {
      briefly "Item"
      described as {
        |Menu item.
      }
    }
    ingredients: String(1,100)+ with {
      briefly "Ingredients"
      described as {
        |Item ingredients.
      }
    }
    allergens: String(1,50)+ with {
      briefly "Allergens"
      described as {
        |Allergen info.
      }
    }
    available: Boolean with {
      briefly "Available"
      described as {
        |Currently available.
      }
    }
  } with {
    briefly "Item details"
    described as {
      |Full item information.
    }
  }
  command UpdateAvailability is  {
    itemId: MenuItemId with {
      briefly "Item"
      described as {
        |Menu item ID.
      }
    }
    available: Boolean with {
      briefly "Available"
      described as {
        |Availability status.
      }
    }
  } with {
    briefly "Update availability"
    described as {
      |Updates item availability.
    }
  }
  event AvailabilityUpdated is  {
    itemId: MenuItemId with {
      briefly "Item"
      described as {
        |Menu item ID.
      }
    }
    available: Boolean with {
      briefly "Available"
      described as {
        |New status.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Availability updated"
    described as {
      |Emitted when availability changes.
    }
  }
} with {
  option external()
  briefly "External menu service"
  described as {
    |External menu management service.
  }
}
// Kitchen Display System
context KitchenDisplayService is {
  command SendTicket is  {
    ticket: KitchenTicket with {
      briefly "Ticket"
      described as {
        |Kitchen ticket.
      }
    }
  } with {
    briefly "Send ticket"
    described as {
      |Sends ticket to kitchen display.
    }
  }
  event TicketDisplayed is  {
    ticketId: UUID with {
      briefly "Ticket"
      described as {
        |Ticket ID.
      }
    }
    station: KitchenStationId with {
      briefly "Station"
      described as {
        |Kitchen station.
      }
    }
    displayedAt: TimeStamp with {
      briefly "Displayed"
      described as {
        |Display time.
      }
    }
  } with {
    briefly "Ticket displayed"
    described as {
      |Emitted when ticket is displayed.
    }
  }
  command BumpTicket is  {
    ticketId: UUID with {
      briefly "Ticket"
      described as {
        |Ticket ID.
      }
    }
    bumpedBy: String(1,100) with {
      briefly "Bumped by"
      described as {
        |Kitchen staff.
      }
    }
  } with {
    briefly "Bump ticket"
    described as {
      |Marks ticket as complete.
    }
  }
  event TicketBumped is  {
    ticketId: UUID with {
      briefly "Ticket"
      described as {
        |Ticket ID.
      }
    }
    bumpedAt: TimeStamp with {
      briefly "Bumped"
      described as {
        |Bump time.
      }
    }
  } with {
    briefly "Ticket bumped"
    described as {
      |Emitted when ticket is completed.
    }
  }
} with {
  option external()
  briefly "External kitchen display"
  described as {
    |External kitchen display system.
  }
}
// Payment Processing Service
context PaymentProcessingService is {
  command ProcessCardPayment is  {
    orderId: TableOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    cardToken: String(1,200) with {
      briefly "Token"
      described as {
        |Card token.
      }
    }
    tipAmount: Decimal(10,2)? with {
      briefly "Tip"
      described as {
        |Tip amount.
      }
    }
  } with {
    briefly "Process card payment"
    described as {
      |Processes card payment.
    }
  }
  event CardPaymentProcessed is  {
    orderId: TableOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    transactionId: String(1,100) with {
      briefly "Transaction"
      described as {
        |Transaction ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Amount processed.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Process time.
      }
    }
  } with {
    briefly "Card payment processed"
    described as {
      |Emitted when payment succeeds.
    }
  }
  event CardPaymentFailed is  {
    orderId: TableOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    errorCode: String(1,50) with {
      briefly "Error"
      described as {
        |Error code.
      }
    }
    errorMessage: String(1,500) with {
      briefly "Message"
      described as {
        |Error message.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |Failure time.
      }
    }
  } with {
    briefly "Card payment failed"
    described as {
      |Emitted when payment fails.
    }
  }
  command ProcessRefund is  {
    orderId: TableOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    transactionId: String(1,100) with {
      briefly "Transaction"
      described as {
        |Original transaction.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Refund reason.
      }
    }
  } with {
    briefly "Process refund"
    described as {
      |Processes payment refund.
    }
  }
  event RefundProcessed is  {
    orderId: TableOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    refundId: String(1,100) with {
      briefly "Refund"
      described as {
        |Refund ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Process time.
      }
    }
  } with {
    briefly "Refund processed"
    described as {
      |Emitted when refund is processed.
    }
  }
} with {
  option external()
  briefly "External payment processing"
  described as {
    |External payment processing service.
  }
}
// Receipt Printing Service
context ReceiptPrintingService is {
  command PrintReceipt is  {
    orderId: TableOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    receiptType: String(1,50) with {
      briefly "Type"
      described as {
        |Receipt type.
      }
    }
    copies: Natural with {
      briefly "Copies"
      described as {
        |Number of copies.
      }
    }
  } with {
    briefly "Print receipt"
    described as {
      |Prints order receipt.
    }
  }
  event ReceiptPrinted is  {
    orderId: TableOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    printedAt: TimeStamp with {
      briefly "Printed"
      described as {
        |Print time.
      }
    }
  } with {
    briefly "Receipt printed"
    described as {
      |Emitted when receipt is printed.
    }
  }
  command PrintKitchenTicket is  {
    ticket: KitchenTicket with {
      briefly "Ticket"
      described as {
        |Kitchen ticket.
      }
    }
  } with {
    briefly "Print kitchen ticket"
    described as {
      |Prints kitchen order ticket.
    }
  }
  event KitchenTicketPrinted is  {
    ticketId: UUID with {
      briefly "Ticket"
      described as {
        |Ticket ID.
      }
    }
    printedAt: TimeStamp with {
      briefly "Printed"
      described as {
        |Print time.
      }
    }
  } with {
    briefly "Kitchen ticket printed"
    described as {
      |Emitted when ticket is printed.
    }
  }
} with {
  option external()
  briefly "External receipt printing"
  described as {
    |External printing service.
  }
}
// Reservation Service
context ReservationService is {
  query GetReservation is  {
    reservationId: UUID with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
  } with {
    briefly "Get reservation"
    described as {
      |Retrieves reservation details.
    }
  }
  result ReservationDetails is  {
    reservationId: UUID with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    guestName: String(1,100) with {
      briefly "Name"
      described as {
        |Guest name.
      }
    }
    partySize: Natural with {
      briefly "Party size"
      described as {
        |Number of guests.
      }
    }
    reservationTime: TimeStamp with {
      briefly "Time"
      described as {
        |Reservation time.
      }
    }
    assignedTableId: TableId? with {
      briefly "Table"
      described as {
        |Assigned table.
      }
    }
    specialRequests: String(1,500)? with {
      briefly "Requests"
      described as {
        |Special requests.
      }
    }
  } with {
    briefly "Reservation details"
    described as {
      |Full reservation information.
    }
  }
  command MarkSeated is  {
    reservationId: UUID with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    tableId: TableId with {
      briefly "Table"
      described as {
        |Seated table.
      }
    }
    seatedAt: TimeStamp with {
      briefly "Seated"
      described as {
        |Seating time.
      }
    }
  } with {
    briefly "Mark seated"
    described as {
      |Marks reservation as seated.
    }
  }
  event ReservationSeated is  {
    reservationId: UUID with {
      briefly "Reservation"
      described as {
        |Reservation ID.
      }
    }
    tableId: TableId with {
      briefly "Table"
      described as {
        |Table ID.
      }
    }
    seatedAt: TimeStamp with {
      briefly "Seated"
      described as {
        |Seating time.
      }
    }
  } with {
    briefly "Reservation seated"
    described as {
      |Emitted when guests are seated.
    }
  }
} with {
  option external()
  briefly "External reservation service"
  described as {
    |External reservation management.
  }
}
