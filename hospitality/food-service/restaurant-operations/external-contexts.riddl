// Restaurant Operations - External Contexts

// Table Management Service
context TableManagementService is {

  query GetAvailableTables is {
    partySize is Natural with { briefly "Party size" described by "Number of guests." }
    filterSection is optional String(1, 50) with { briefly "Section" described by "Preferred section." }
  } with {
    briefly "Get available tables"
    described by "Finds available tables."
  }

  result AvailableTables is {
    tables is many TableInfo with { briefly "Tables" described by "Available tables." }
  } with {
    briefly "Available tables"
    described by "List of available tables."
  }

  command AssignTable is {
    tableId is TableId with { briefly "Table" described by "Table ID." }
    orderId is TableOrderId with { briefly "Order" described by "Order ID." }
  } with {
    briefly "Assign table"
    described by "Assigns table to order."
  }

  event TableAssigned is {
    tableId is TableId with { briefly "Table" described by "Table ID." }
    orderId is TableOrderId with { briefly "Order" described by "Order ID." }
    assignedAt is TimeStamp with { briefly "Assigned" described by "Assignment time." }
  } with {
    briefly "Table assigned"
    described by "Emitted when table is assigned."
  }

  command ReleaseTable is {
    tableId is TableId with { briefly "Table" described by "Table ID." }
  } with {
    briefly "Release table"
    described by "Releases table after close."
  }

  event TableReleased is {
    tableId is TableId with { briefly "Table" described by "Table ID." }
    releasedAt is TimeStamp with { briefly "Released" described by "Release time." }
  } with {
    briefly "Table released"
    described by "Emitted when table is released."
  }

} with {
  option is external
  briefly "External table management"
  described by "External table tracking service."
}

// Menu Service
context MenuService is {

  query GetMenuItems is {
    filterCourseType is optional CourseType with { briefly "Course" described by "Course filter." }
    filterAvailable is optional Boolean with { briefly "Available" described by "Availability filter." }
  } with {
    briefly "Get menu items"
    described by "Retrieves menu items."
  }

  result MenuItems is {
    menuItems is many MenuItem with { briefly "Items" described by "Menu items." }
  } with {
    briefly "Menu items"
    described by "List of menu items."
  }

  query GetItemDetails is {
    itemId is MenuItemId with { briefly "Item" described by "Menu item ID." }
  } with {
    briefly "Get item details"
    described by "Retrieves item details."
  }

  result ItemDetails is {
    item is MenuItem with { briefly "Item" described by "Menu item." }
    ingredients is many String(1, 100) with { briefly "Ingredients" described by "Item ingredients." }
    allergens is many String(1, 50) with { briefly "Allergens" described by "Allergen info." }
    available is Boolean with { briefly "Available" described by "Currently available." }
  } with {
    briefly "Item details"
    described by "Full item information."
  }

  command UpdateAvailability is {
    itemId is MenuItemId with { briefly "Item" described by "Menu item ID." }
    available is Boolean with { briefly "Available" described by "Availability status." }
  } with {
    briefly "Update availability"
    described by "Updates item availability."
  }

  event AvailabilityUpdated is {
    itemId is MenuItemId with { briefly "Item" described by "Menu item ID." }
    available is Boolean with { briefly "Available" described by "New status." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Availability updated"
    described by "Emitted when availability changes."
  }

} with {
  option is external
  briefly "External menu service"
  described by "External menu management service."
}

// Kitchen Display System
context KitchenDisplayService is {

  command SendTicket is {
    ticket is KitchenTicket with { briefly "Ticket" described by "Kitchen ticket." }
  } with {
    briefly "Send ticket"
    described by "Sends ticket to kitchen display."
  }

  event TicketDisplayed is {
    ticketId is UUID with { briefly "Ticket" described by "Ticket ID." }
    station is KitchenStationId with { briefly "Station" described by "Kitchen station." }
    displayedAt is TimeStamp with { briefly "Displayed" described by "Display time." }
  } with {
    briefly "Ticket displayed"
    described by "Emitted when ticket is displayed."
  }

  command BumpTicket is {
    ticketId is UUID with { briefly "Ticket" described by "Ticket ID." }
    bumpedBy is String(1, 100) with { briefly "Bumped by" described by "Kitchen staff." }
  } with {
    briefly "Bump ticket"
    described by "Marks ticket as complete."
  }

  event TicketBumped is {
    ticketId is UUID with { briefly "Ticket" described by "Ticket ID." }
    bumpedAt is TimeStamp with { briefly "Bumped" described by "Bump time." }
  } with {
    briefly "Ticket bumped"
    described by "Emitted when ticket is completed."
  }

} with {
  option is external
  briefly "External kitchen display"
  described by "External kitchen display system."
}

// Payment Processing Service
context PaymentProcessingService is {

  command ProcessCardPayment is {
    orderId is TableOrderId with { briefly "Order" described by "Order ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Payment amount." }
    cardToken is String(1, 200) with { briefly "Token" described by "Card token." }
    tipAmount is optional Decimal(10, 2) with { briefly "Tip" described by "Tip amount." }
  } with {
    briefly "Process card payment"
    described by "Processes card payment."
  }

  event CardPaymentProcessed is {
    orderId is TableOrderId with { briefly "Order" described by "Order ID." }
    transactionId is String(1, 100) with { briefly "Transaction" described by "Transaction ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Amount processed." }
    processedAt is TimeStamp with { briefly "Processed" described by "Process time." }
  } with {
    briefly "Card payment processed"
    described by "Emitted when payment succeeds."
  }

  event CardPaymentFailed is {
    orderId is TableOrderId with { briefly "Order" described by "Order ID." }
    errorCode is String(1, 50) with { briefly "Error" described by "Error code." }
    errorMessage is String(1, 500) with { briefly "Message" described by "Error message." }
    failedAt is TimeStamp with { briefly "Failed" described by "Failure time." }
  } with {
    briefly "Card payment failed"
    described by "Emitted when payment fails."
  }

  command ProcessRefund is {
    orderId is TableOrderId with { briefly "Order" described by "Order ID." }
    transactionId is String(1, 100) with { briefly "Transaction" described by "Original transaction." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Refund amount." }
    reason is String(1, 500) with { briefly "Reason" described by "Refund reason." }
  } with {
    briefly "Process refund"
    described by "Processes payment refund."
  }

  event RefundProcessed is {
    orderId is TableOrderId with { briefly "Order" described by "Order ID." }
    refundId is String(1, 100) with { briefly "Refund" described by "Refund ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Refund amount." }
    processedAt is TimeStamp with { briefly "Processed" described by "Process time." }
  } with {
    briefly "Refund processed"
    described by "Emitted when refund is processed."
  }

} with {
  option is external
  briefly "External payment processing"
  described by "External payment processing service."
}

// Receipt Printing Service
context ReceiptPrintingService is {

  command PrintReceipt is {
    orderId is TableOrderId with { briefly "Order" described by "Order ID." }
    receiptType is String(1, 50) with { briefly "Type" described by "Receipt type." }
    copies is Natural with { briefly "Copies" described by "Number of copies." }
  } with {
    briefly "Print receipt"
    described by "Prints order receipt."
  }

  event ReceiptPrinted is {
    orderId is TableOrderId with { briefly "Order" described by "Order ID." }
    printedAt is TimeStamp with { briefly "Printed" described by "Print time." }
  } with {
    briefly "Receipt printed"
    described by "Emitted when receipt is printed."
  }

  command PrintKitchenTicket is {
    ticket is KitchenTicket with { briefly "Ticket" described by "Kitchen ticket." }
  } with {
    briefly "Print kitchen ticket"
    described by "Prints kitchen order ticket."
  }

  event KitchenTicketPrinted is {
    ticketId is UUID with { briefly "Ticket" described by "Ticket ID." }
    printedAt is TimeStamp with { briefly "Printed" described by "Print time." }
  } with {
    briefly "Kitchen ticket printed"
    described by "Emitted when ticket is printed."
  }

} with {
  option is external
  briefly "External receipt printing"
  described by "External printing service."
}

// Reservation Service
context ReservationService is {

  query GetReservation is {
    reservationId is UUID with { briefly "Reservation" described by "Reservation ID." }
  } with {
    briefly "Get reservation"
    described by "Retrieves reservation details."
  }

  result ReservationDetails is {
    reservationId is UUID with { briefly "Reservation" described by "Reservation ID." }
    guestName is String(1, 100) with { briefly "Name" described by "Guest name." }
    partySize is Natural with { briefly "Party size" described by "Number of guests." }
    reservationTime is TimeStamp with { briefly "Time" described by "Reservation time." }
    assignedTableId is optional TableId with { briefly "Table" described by "Assigned table." }
    specialRequests is optional String(1, 500) with { briefly "Requests" described by "Special requests." }
  } with {
    briefly "Reservation details"
    described by "Full reservation information."
  }

  command MarkSeated is {
    reservationId is UUID with { briefly "Reservation" described by "Reservation ID." }
    tableId is TableId with { briefly "Table" described by "Seated table." }
    seatedAt is TimeStamp with { briefly "Seated" described by "Seating time." }
  } with {
    briefly "Mark seated"
    described by "Marks reservation as seated."
  }

  event ReservationSeated is {
    reservationId is UUID with { briefly "Reservation" described by "Reservation ID." }
    tableId is TableId with { briefly "Table" described by "Table ID." }
    seatedAt is TimeStamp with { briefly "Seated" described by "Seating time." }
  } with {
    briefly "Reservation seated"
    described by "Emitted when guests are seated."
  }

} with {
  option is external
  briefly "External reservation service"
  described by "External reservation management."
}
