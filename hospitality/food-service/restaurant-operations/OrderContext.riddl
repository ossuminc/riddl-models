// Restaurant Operations - Order Context
context OrderContext is {
  include "types.riddl"
  include "TableOrder.riddl"
  // Repository for order persistence
  repository OrderRepository is {
    schema OrderData is relational
      of orders as type TableOrder
        index on field TableOrder.orderId
        index on field TableOrder.table.tableId
        index on field TableOrder.server

    handler OrderPersistence is {
      on command TableOrder.CreateOrder is {
        prompt "Store new order"
      }
      on command TableOrder.AddItem is {
        prompt "Add line item to order"
      }
      on command TableOrder.ModifyItem is {
        prompt "Update line item"
      }
      on command TableOrder.VoidItem is {
        prompt "Mark item as voided"
      }
      on command TableOrder.SubmitOrder is {
        prompt "Update order to submitted"
      }
      on command TableOrder.MarkItemPreparing is {
        prompt "Update item to preparing"
      }
      on command TableOrder.MarkItemReady is {
        prompt "Update item to ready"
      }
      on command TableOrder.ServeItem is {
        prompt "Update item to served"
      }
      on command TableOrder.RequestBill is {
        prompt "Store bill request"
      }
      on command TableOrder.ApplyDiscount is {
        prompt "Store discount"
      }
      on command TableOrder.ProcessPayment is {
        prompt "Store payment"
      }
      on command TableOrder.SplitBill is {
        prompt "Store bill split"
      }
      on command TableOrder.CloseOrder is {
        prompt "Update order to closed"
      }
      on command TableOrder.CancelOrder is {
        prompt "Update order to cancelled"
      }
    } with {
      briefly "Persists order commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Order data persistence"
    described as {
      | The OrderRepository provides persistent storage for
      | table orders and related data.
    }
  }
  // Projector for restaurant analytics
  projector RestaurantAnalytics is {
    record RestaurantStats is  {
      totalOrders: Natural with {
        briefly "Total"
        described as {
          |Total orders.
        }
      }
      openOrders: Natural with {
        briefly "Open"
        described as {
          |Open orders.
        }
      }
      completedOrders: Natural with {
        briefly "Completed"
        described as {
          |Completed orders.
        }
      }
      totalRevenue: Decimal(12,2) with {
        briefly "Revenue"
        described as {
          |Total revenue.
        }
      }
      averageOrderValue: Decimal(10,2) with {
        briefly "AOV"
        described as {
          |Average order value.
        }
      }
      averageTableTurnTime: Duration with {
        briefly "Turn time"
        described as {
          |Average table turn.
        }
      }
    } with {
      briefly "Restaurant statistics"
      described as {
        |Restaurant operations metrics.
      }
    }
    handler AnalyticsHandler is {
      on event TableOrder.OrderCreated is {
        prompt "Update order counts"
      }
      on event TableOrder.OrderClosed is {
        prompt "Update completion and revenue metrics"
      }
      on event TableOrder.PaymentProcessed is {
        prompt "Update payment metrics"
      }
      on event TableOrder.OrderCancelled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains restaurant analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Restaurant analytics projections"
    described as {
      |Maintains restaurant operations analytics data.
    }
  }
} with {
  briefly "Bounded context for restaurant orders"
  described as {
    | The OrderContext is the bounded context for
    | table orders and restaurant service operations.
  }
}
