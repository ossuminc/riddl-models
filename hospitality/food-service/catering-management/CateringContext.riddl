// Catering Management - Catering Context

context CateringContext is {

  include "types.riddl"
  include "CateringOrder.riddl"

  // Repository for order persistence
  repository OrderRepository is {
    schema OrderData is relational
      of orders as CateringOrder
      index on field CateringOrder.orderId
      index on field CateringOrder.customer.customerId
      index on field CateringOrder.event.eventDate

    handler OrderPersistence is {
      on command CateringOrder.CreateOrder {
        prompt "Store new order"
      }
      on command CateringOrder.AddMenuItem {
        prompt "Add line item to order"
      }
      on command CateringOrder.RemoveMenuItem {
        prompt "Remove line item from order"
      }
      on command CateringOrder.ConfirmOrder {
        prompt "Update order to confirmed"
      }
      on command CateringOrder.SetDeliveryInfo {
        prompt "Store delivery info"
      }
      on command CateringOrder.AssignStaff {
        prompt "Store staff assignment"
      }
      on command CateringOrder.StartPreparation {
        prompt "Update to in preparation"
      }
      on command CateringOrder.MarkReady {
        prompt "Update to ready"
      }
      on command CateringOrder.DispatchDelivery {
        prompt "Update to in transit"
      }
      on command CateringOrder.ConfirmDelivery {
        prompt "Update to delivered"
      }
      on command CateringOrder.RecordPayment {
        prompt "Store payment record"
      }
      on command CateringOrder.CompleteOrder {
        prompt "Update to completed"
      }
      on command CateringOrder.CancelOrder {
        prompt "Update to cancelled"
      }
    } with {
      briefly "Persists order commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Order data persistence"
    described by {
      | The OrderRepository provides persistent storage for
      | catering orders and related data.
    }
  }

  // Projector for catering analytics
  projector CateringAnalytics is {
    updates repository OrderRepository

    record CateringStats is {
      totalOrders is Natural with { briefly "Total" described by "Total orders." }
      activeOrders is Natural with { briefly "Active" described by "Active orders." }
      completedOrders is Natural with { briefly "Completed" described by "Completed orders." }
      cancelledOrders is Natural with { briefly "Cancelled" described by "Cancelled orders." }
      totalRevenue is Decimal(12, 2) with { briefly "Revenue" described by "Total revenue." }
      averageOrderValue is Decimal(10, 2) with { briefly "AOV" described by "Average order value." }
    } with {
      briefly "Catering statistics"
      described by "Catering operations metrics."
    }

    handler AnalyticsHandler is {
      on event CateringOrder.OrderCreated {
        prompt "Update order counts"
      }
      on event CateringOrder.OrderConfirmed {
        prompt "Update confirmed metrics"
      }
      on event CateringOrder.OrderCompleted {
        prompt "Update completion and revenue metrics"
      }
      on event CateringOrder.OrderCancelled {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains catering analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Catering analytics projections"
    described by "Maintains catering operations analytics data."
  }

} with {
  briefly "Bounded context for catering management"
  described by {
    | The CateringContext is the bounded context for
    | event catering orders and operations.
  }
}
