// Catering Management - Catering Context
context CateringContext is {
  include "types.riddl"
  include "CateringOrder.riddl"
  // Repository for order persistence
  repository OrderRepository is {
    schema OrderData is relational
      of orders as type CateringOrder
        index on field CateringOrder.orderId
        index on field CateringOrder.customer.customerId
        index on field CateringOrder.event.eventDate

    handler OrderPersistence is {
      on command CateringOrder.CreateOrder is {
        prompt "Store new order"
      }
      on command CateringOrder.AddMenuItem is {
        prompt "Add line item to order"
      }
      on command CateringOrder.RemoveMenuItem is {
        prompt "Remove line item from order"
      }
      on command CateringOrder.ConfirmOrder is {
        prompt "Update order to confirmed"
      }
      on command CateringOrder.SetDeliveryInfo is {
        prompt "Store delivery info"
      }
      on command CateringOrder.AssignStaff is {
        prompt "Store staff assignment"
      }
      on command CateringOrder.StartPreparation is {
        prompt "Update to in preparation"
      }
      on command CateringOrder.MarkReady is {
        prompt "Update to ready"
      }
      on command CateringOrder.DispatchDelivery is {
        prompt "Update to in transit"
      }
      on command CateringOrder.ConfirmDelivery is {
        prompt "Update to delivered"
      }
      on command CateringOrder.RecordPayment is {
        prompt "Store payment record"
      }
      on command CateringOrder.CompleteOrder is {
        prompt "Update to completed"
      }
      on command CateringOrder.CancelOrder is {
        prompt "Update to cancelled"
      }
    } with {
      briefly "Persists order commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Order data persistence"
    described as {
      | The OrderRepository provides persistent storage for
      | catering orders and related data.
    }
  }
  // Projector for catering analytics
  projector CateringAnalytics is {
    record CateringStats is  {
      totalOrders: Natural with {
        briefly "Total"
        described as {
          |Total orders.
        }
      }
      activeOrders: Natural with {
        briefly "Active"
        described as {
          |Active orders.
        }
      }
      completedOrders: Natural with {
        briefly "Completed"
        described as {
          |Completed orders.
        }
      }
      cancelledOrders: Natural with {
        briefly "Cancelled"
        described as {
          |Cancelled orders.
        }
      }
      totalRevenue: Decimal(12,2) with {
        briefly "Revenue"
        described as {
          |Total revenue.
        }
      }
      averageOrderValue: Decimal(10,2) with {
        briefly "AOV"
        described as {
          |Average order value.
        }
      }
    } with {
      briefly "Catering statistics"
      described as {
        |Catering operations metrics.
      }
    }
    handler AnalyticsHandler is {
      on event CateringOrder.OrderCreated is {
        prompt "Update order counts"
      }
      on event CateringOrder.OrderConfirmed is {
        prompt "Update confirmed metrics"
      }
      on event CateringOrder.OrderCompleted is {
        prompt "Update completion and revenue metrics"
      }
      on event CateringOrder.OrderCancelled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains catering analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Catering analytics projections"
    described as {
      |Maintains catering operations analytics data.
    }
  }
} with {
  briefly "Bounded context for catering management"
  described as {
    | The CateringContext is the bounded context for
    | event catering orders and operations.
  }
}
