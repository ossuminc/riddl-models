// Catering Management - CateringOrder Entity
entity CateringOrder is {
  // Commands
  command CreateOrder is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |New order identifier.
      }
    }
    customer: CustomerInfo with {
      briefly "Customer"
      described as {
        |Customer information.
      }
    }
    event: EventDetails with {
      briefly "Event"
      described as {
        |Event details.
      }
    }
    serviceType: ServiceType with {
      briefly "Service"
      described as {
        |Type of service.
      }
    }
  } with {
    briefly "Create order"
    described as {
      |Creates a new catering order.
    }
  }
  command AddMenuItem is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    item: MenuItem with {
      briefly "Item"
      described as {
        |Menu item to add.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Number of servings.
      }
    }
    specialRequests: String(1,500)? with {
      briefly "Requests"
      described as {
        |Special requests.
      }
    }
  } with {
    briefly "Add menu item"
    described as {
      |Adds item to order.
    }
  }
  command RemoveMenuItem is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    itemId: MenuItemId with {
      briefly "Item"
      described as {
        |Item to remove.
      }
    }
  } with {
    briefly "Remove menu item"
    described as {
      |Removes item from order.
    }
  }
  command ConfirmOrder is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    confirmedBy: String(1,200) with {
      briefly "Confirmed by"
      described as {
        |Person confirming.
      }
    }
  } with {
    briefly "Confirm order"
    described as {
      |Confirms the catering order.
    }
  }
  command SetDeliveryInfo is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    delivery: DeliveryInfo with {
      briefly "Delivery"
      described as {
        |Delivery details.
      }
    }
  } with {
    briefly "Set delivery info"
    described as {
      |Sets delivery information.
    }
  }
  command AssignStaff is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    staffId: StaffId with {
      briefly "Staff"
      described as {
        |Staff member.
      }
    }
    role: String(1,50) with {
      briefly "Role"
      described as {
        |Assignment role.
      }
    }
  } with {
    briefly "Assign staff"
    described as {
      |Assigns staff to order.
    }
  }
  command StartPreparation is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    startedBy: StaffId with {
      briefly "Started by"
      described as {
        |Chef starting prep.
      }
    }
  } with {
    briefly "Start preparation"
    described as {
      |Begins food preparation.
    }
  }
  command MarkReady is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    readyAt: TimeStamp with {
      briefly "Ready at"
      described as {
        |Time marked ready.
      }
    }
  } with {
    briefly "Mark ready"
    described as {
      |Marks order ready for delivery.
    }
  }
  command DispatchDelivery is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    dispatchedAt: TimeStamp with {
      briefly "Dispatched"
      described as {
        |Dispatch time.
      }
    }
    driver: String(1,200) with {
      briefly "Driver"
      described as {
        |Delivery driver.
      }
    }
  } with {
    briefly "Dispatch delivery"
    described as {
      |Dispatches order for delivery.
    }
  }
  command ConfirmDelivery is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    deliveredAt: TimeStamp with {
      briefly "Delivered"
      described as {
        |Delivery time.
      }
    }
    receivedBy: String(1,200) with {
      briefly "Received by"
      described as {
        |Person receiving delivery.
      }
    }
  } with {
    briefly "Confirm delivery"
    described as {
      |Confirms delivery completed.
    }
  }
  command RecordPayment is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    paymentMethod: String(1,50) with {
      briefly "Method"
      described as {
        |Payment method.
      }
    }
    reference: String(1,100) with {
      briefly "Reference"
      described as {
        |Payment reference.
      }
    }
  } with {
    briefly "Record payment"
    described as {
      |Records payment received.
    }
  }
  command CompleteOrder is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Complete order"
    described as {
      |Marks order as completed.
    }
  }
  command CancelOrder is  {
    orderId: OrderId with {
      briefly "Order ID"
      described as {
        |Order identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
    cancelledBy: String(1,200) with {
      briefly "Cancelled by"
      described as {
        |Person cancelling.
      }
    }
  } with {
    briefly "Cancel order"
    described as {
      |Cancels the catering order.
    }
  }
  // Events
  event OrderCreated is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    customer: CustomerInfo with {
      briefly "Customer"
      described as {
        |Customer info.
      }
    }
    event: EventDetails with {
      briefly "Event"
      described as {
        |Event details.
      }
    }
    serviceType: ServiceType with {
      briefly "Service"
      described as {
        |Service type.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Order created"
    described as {
      |Emitted when order is created.
    }
  }
  event MenuItemAdded is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    lineItem: OrderLineItem with {
      briefly "Item"
      described as {
        |Added line item.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Menu item added"
    described as {
      |Emitted when item is added.
    }
  }
  event MenuItemRemoved is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    itemId: MenuItemId with {
      briefly "Item"
      described as {
        |Removed item ID.
      }
    }
    removedAt: TimeStamp with {
      briefly "Removed"
      described as {
        |Removal time.
      }
    }
  } with {
    briefly "Menu item removed"
    described as {
      |Emitted when item is removed.
    }
  }
  event OrderConfirmed is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    confirmedBy: String(1,200) with {
      briefly "Confirmed by"
      described as {
        |Confirmer.
      }
    }
    confirmedAt: TimeStamp with {
      briefly "Confirmed"
      described as {
        |Confirmation time.
      }
    }
    payment: PaymentInfo with {
      briefly "Payment"
      described as {
        |Payment details.
      }
    }
  } with {
    briefly "Order confirmed"
    described as {
      |Emitted when order is confirmed.
    }
  }
  event DeliveryInfoSet is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    delivery: DeliveryInfo with {
      briefly "Delivery"
      described as {
        |Delivery details.
      }
    }
    setAt: TimeStamp with {
      briefly "Set"
      described as {
        |Set time.
      }
    }
  } with {
    briefly "Delivery info set"
    described as {
      |Emitted when delivery info is set.
    }
  }
  event StaffAssigned is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    assignment: StaffAssignment with {
      briefly "Assignment"
      described as {
        |Staff assignment.
      }
    }
  } with {
    briefly "Staff assigned"
    described as {
      |Emitted when staff is assigned.
    }
  }
  event PreparationStarted is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    startedBy: StaffId with {
      briefly "Started by"
      described as {
        |Chef.
      }
    }
    startedAt: TimeStamp with {
      briefly "Started"
      described as {
        |Start time.
      }
    }
  } with {
    briefly "Preparation started"
    described as {
      |Emitted when prep begins.
    }
  }
  event OrderReady is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    readyAt: TimeStamp with {
      briefly "Ready"
      described as {
        |Ready time.
      }
    }
  } with {
    briefly "Order ready"
    described as {
      |Emitted when order is ready.
    }
  }
  event DeliveryDispatched is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    dispatchedAt: TimeStamp with {
      briefly "Dispatched"
      described as {
        |Dispatch time.
      }
    }
    driver: String(1,200) with {
      briefly "Driver"
      described as {
        |Delivery driver.
      }
    }
  } with {
    briefly "Delivery dispatched"
    described as {
      |Emitted when order is dispatched.
    }
  }
  event DeliveryConfirmed is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    deliveredAt: TimeStamp with {
      briefly "Delivered"
      described as {
        |Delivery time.
      }
    }
    receivedBy: String(1,200) with {
      briefly "Received by"
      described as {
        |Receiver.
      }
    }
  } with {
    briefly "Delivery confirmed"
    described as {
      |Emitted when delivery is confirmed.
    }
  }
  event PaymentRecorded is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    paymentMethod: String(1,50) with {
      briefly "Method"
      described as {
        |Payment method.
      }
    }
    reference: String(1,100) with {
      briefly "Reference"
      described as {
        |Reference.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Payment recorded"
    described as {
      |Emitted when payment is recorded.
    }
  }
  event OrderCompleted is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Order completed"
    described as {
      |Emitted when order is completed.
    }
  }
  event OrderCancelled is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
    cancelledBy: String(1,200) with {
      briefly "Cancelled by"
      described as {
        |Canceller.
      }
    }
    cancelledAt: TimeStamp with {
      briefly "Cancelled"
      described as {
        |Cancellation time.
      }
    }
  } with {
    briefly "Order cancelled"
    described as {
      |Emitted when order is cancelled.
    }
  }
  // State Records
  record ActiveStateData is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    customer: CustomerInfo with {
      briefly "Customer"
      described as {
        |Customer info.
      }
    }
    event: EventDetails with {
      briefly "Event"
      described as {
        |Event details.
      }
    }
    serviceType: ServiceType with {
      briefly "Service"
      described as {
        |Service type.
      }
    }
    currentLineItems: OrderLineItem* with {
      briefly "Items"
      described as {
        |Order items.
      }
    }
    currentStatus: OrderStatus with {
      briefly "Status"
      described as {
        |Order status.
      }
    }
    scheduledDelivery: DeliveryInfo? with {
      briefly "Delivery"
      described as {
        |Delivery info.
      }
    }
    staffAssignments: StaffAssignment* with {
      briefly "Staff"
      described as {
        |Assigned staff.
      }
    }
    recordedPayment: PaymentInfo? with {
      briefly "Payment"
      described as {
        |Payment info.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Active state"
    described as {
      |State for active order.
    }
  }
  // States
  state ActiveState of type CateringOrder.ActiveStateData
  // Handler
  handler CateringOrderHandler is {
    on command CreateOrder is {
      morph entity CateringContext.CateringOrder to state CateringContext.CateringOrder.ActiveState with command CreateOrder
      tell event OrderCreated to entity CateringContext.CateringOrder
    }
    on command AddMenuItem is {
      tell event MenuItemAdded to entity CateringContext.CateringOrder
    }
    on command RemoveMenuItem is {
      tell event MenuItemRemoved to entity CateringContext.CateringOrder
    }
    on command ConfirmOrder is {
      tell event OrderConfirmed to entity CateringContext.CateringOrder
    }
    on command SetDeliveryInfo is {
      tell event DeliveryInfoSet to entity CateringContext.CateringOrder
    }
    on command AssignStaff is {
      tell event StaffAssigned to entity CateringContext.CateringOrder
    }
    on command StartPreparation is {
      tell event PreparationStarted to entity CateringContext.CateringOrder
    }
    on command MarkReady is {
      tell event OrderReady to entity CateringContext.CateringOrder
    }
    on command DispatchDelivery is {
      tell event DeliveryDispatched to entity CateringContext.CateringOrder
    }
    on command ConfirmDelivery is {
      tell event DeliveryConfirmed to entity CateringContext.CateringOrder
    }
    on command RecordPayment is {
      tell event PaymentRecorded to entity CateringContext.CateringOrder
    }
    on command CompleteOrder is {
      tell event OrderCompleted to entity CateringContext.CateringOrder
    }
    on command CancelOrder is {
      tell event OrderCancelled to entity CateringContext.CateringOrder
    }
  } with {
    briefly "Processes order commands"
    described as {
      | Handles catering order lifecycle from creation
      | through preparation, delivery, and completion.
    }
  }
} with {
  briefly "Catering order aggregate"
  described as {
    | The CateringOrder entity manages catering orders
    | and their lifecycle through service delivery.
  }
}
