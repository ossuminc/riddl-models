// Reservation entity for the Front of House context
entity Reservation is {
  // ---- Commands ----
  command MakeReservation is  {
    reservationId: ReservationId with {
      briefly "ID"
      described as {
        |Identifier for the new reservation.
      }
    }
    guestName: GuestName with {
      briefly "Guest"
      described as {
        |Name of the guest.
      }
    }
    guestPhone: GuestPhone with {
      briefly "Phone"
      described as {
        |Contact phone for the guest.
      }
    }
    partySize: PartySize with {
      briefly "Party size"
      described as {
        |Number of guests.
      }
    }
    reservationTime: TimeStamp with {
      briefly "Time"
      described as {
        |Requested reservation date and time.
      }
    }
  } with {
    briefly "Make reservation"
    described as {
      |Request a new reservation.
    }
  }
  command ConfirmReservation is  {
    reservationId: ReservationId with {
      briefly "ID"
      described as {
        |Reservation to confirm.
      }
    }
    confirmedTable: TableNumber with {
      briefly "Table"
      described as {
        |Table assigned for this reservation.
      }
    }
  } with {
    briefly "Confirm reservation"
    described as {
      |Confirm a pending reservation with a table assignment.
    }
  }
  command CancelReservation is  {
    reservationId: ReservationId with {
      briefly "ID"
      described as {
        |Reservation to cancel.
      }
    }
    cancellationReason: String(1,500)? with {
      briefly "Reason"
      described as {
        |Reason for cancellation.
      }
    }
  } with {
    briefly "Cancel reservation"
    described as {
      |Cancel an existing reservation.
    }
  }
  command SeatParty is  {
    reservationId: ReservationId with {
      briefly "ID"
      described as {
        |Reservation for the party being seated.
      }
    }
    seatedTable: TableNumber with {
      briefly "Table"
      described as {
        |Table where the party is seated.
      }
    }
    seatedAt: TimeStamp with {
      briefly "Seated at"
      described as {
        |Time the party was seated.
      }
    }
  } with {
    briefly "Seat party"
    described as {
      |Mark a reservation as seated at a table.
    }
  }
  // ---- Events ----
  event ReservationMade is  {
    reservationId: ReservationId with {
      briefly "ID"
      described as {
        |Identifier of the reservation.
      }
    }
    guestName: GuestName with {
      briefly "Guest"
      described as {
        |Guest name.
      }
    }
    guestPhone: GuestPhone with {
      briefly "Phone"
      described as {
        |Guest phone.
      }
    }
    partySize: PartySize with {
      briefly "Party size"
      described as {
        |Number of guests.
      }
    }
    reservationTime: TimeStamp with {
      briefly "Time"
      described as {
        |Reservation date and time.
      }
    }
    madeAt: TimeStamp with {
      briefly "Made at"
      described as {
        |When the reservation was made.
      }
    }
  } with {
    briefly "Reservation made"
    described as {
      |Emitted when a new reservation is requested.
    }
  }
  event ReservationConfirmed is  {
    reservationId: ReservationId with {
      briefly "ID"
      described as {
        |Reservation identifier.
      }
    }
    confirmedTable: TableNumber with {
      briefly "Table"
      described as {
        |Assigned table.
      }
    }
    confirmedAt: TimeStamp with {
      briefly "Confirmed at"
      described as {
        |When the reservation was confirmed.
      }
    }
  } with {
    briefly "Reservation confirmed"
    described as {
      |Emitted when a reservation is confirmed.
    }
  }
  event ReservationCancelled is  {
    reservationId: ReservationId with {
      briefly "ID"
      described as {
        |Reservation identifier.
      }
    }
    cancellationReason: String(1,500)? with {
      briefly "Reason"
      described as {
        |Reason for cancellation.
      }
    }
    cancelledAt: TimeStamp with {
      briefly "Cancelled at"
      described as {
        |When the reservation was cancelled.
      }
    }
  } with {
    briefly "Reservation cancelled"
    described as {
      |Emitted when a reservation is cancelled.
    }
  }
  event PartySeated is  {
    reservationId: ReservationId with {
      briefly "ID"
      described as {
        |Reservation identifier.
      }
    }
    seatedTable: TableNumber with {
      briefly "Table"
      described as {
        |Table where party was seated.
      }
    }
    seatedAt: TimeStamp with {
      briefly "Seated at"
      described as {
        |When the party was seated.
      }
    }
  } with {
    briefly "Party seated"
    described as {
      |Emitted when a party is seated at their table.
    }
  }
  // ---- State ----
  record ReservationStateData is  {
    reservationId: ReservationId with {
      briefly "ID"
      described as {
        |Reservation identifier.
      }
    }
    guestName: GuestName with {
      briefly "Guest"
      described as {
        |Guest name.
      }
    }
    guestPhone: GuestPhone with {
      briefly "Phone"
      described as {
        |Guest phone.
      }
    }
    partySize: PartySize with {
      briefly "Party size"
      described as {
        |Number of guests.
      }
    }
    reservationTime: TimeStamp with {
      briefly "Time"
      described as {
        |Reservation date and time.
      }
    }
    reservationStatus: ReservationStatus with {
      briefly "Status"
      described as {
        |Current reservation status.
      }
    }
    assignedTable: TableNumber? with {
      briefly "Table"
      described as {
        |Assigned table number.
      }
    }
    actualSeatedAt: TimeStamp? with {
      briefly "Seated at"
      described as {
        |When the party was seated.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created at"
      described as {
        |When the reservation was created.
      }
    }
  } with {
    briefly "Reservation state data"
    described as {
      |Full state of a reservation.
    }
  }
  state ActiveReservation of type Reservation.ReservationStateData
  handler ReservationHandler is {
    on command MakeReservation is {
      morph entity FrontOfHouse.Reservation to state FrontOfHouse.Reservation.ActiveReservation with command MakeReservation
      tell event ReservationMade to entity FrontOfHouse.Reservation
    }
    on command ConfirmReservation is {
      tell event ReservationConfirmed to entity FrontOfHouse.Reservation
    }
    on command CancelReservation is {
      tell event ReservationCancelled to entity FrontOfHouse.Reservation
    }
    on command SeatParty is {
      tell event PartySeated to entity FrontOfHouse.Reservation
    }
  } with {
    briefly "Reservation command handler"
    described as {
      |Processes reservation lifecycle commands.
    }
  }
} with {
  briefly "Reservation entity"
  described as {
    | Manages the lifecycle of a restaurant reservation
    | from request through confirmation, seating, or
    | cancellation.
  }
}
