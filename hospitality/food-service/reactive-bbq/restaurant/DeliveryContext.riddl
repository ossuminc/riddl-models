// Delivery bounded context
context Delivery is {
  include "delivery-types.riddl"
  include "Delivery.riddl"
  repository DeliveryRepository is {
    schema DeliveryData is relational
      of deliveries as type DeliveryOrder
        index on field DeliveryOrder.deliveryId
        index on field DeliveryOrder.deliveryStatus
        index on field DeliveryOrder.assignedDriverId

    handler DeliveryPersistence is {
      on command DeliveryOrder.CreateDelivery is {
        prompt "Store new delivery"
      }
      on command DeliveryOrder.AssignDriver is {
        prompt "Record driver assignment"
      }
      on command DeliveryOrder.DispatchDriver is {
        prompt "Mark delivery as dispatched"
      }
      on command DeliveryOrder.RecordDeliveryLocation is {
        prompt "Store driver location update"
      }
      on command DeliveryOrder.ConfirmDelivery is {
        prompt "Mark delivery as confirmed"
      }
      on command DeliveryOrder.RecordDeliveryPayment is {
        prompt "Record delivery payment"
      }
      on command DeliveryOrder.ReportDeliveryIssue is {
        prompt "Store delivery issue report"
      }
    } with {
      briefly "Delivery persistence"
      described as {
        |Persists delivery commands.
      }
    }
  } with {
    briefly "Delivery repository"
    described as {
      |Stores and retrieves delivery data.
    }
  }
  adaptor FromOnlineOrdering from context Restaurant.OnlineOrdering is { 
    handler OnlineDeliveryIntake is {
      on event Restaurant.OnlineOrdering.OnlineOrder.FulfillmentSelected is {
        prompt "Create delivery when delivery fulfillment is selected"
      }
    } with {
      briefly "Online delivery intake"
      described as {
        |Creates deliveries from online orders.
      }
    }
  } with {
    briefly "Online ordering adaptor"
    described as {
      |Receives delivery-fulfillment orders from online ordering.
    }
  }
} with {
  briefly "Delivery context"
  described as {
    | Manages delivery driver dispatch, GPS tracking, and
    | offline-resilient delivery operations. Drivers can
    | cache order details and report issues when connectivity
    | resumes. Decoupled from online ordering via adaptors.
  }
}
