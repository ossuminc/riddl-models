// Bar bounded context

context Bar is {

  include "bar-types.riddl"
  include "DrinkOrder.riddl"

  repository DrinkOrderRepository is {
    schema DrinkOrderData is relational
      of drinkOrders as DrinkOrder
      index on field DrinkOrder.drinkOrderId
      index on field DrinkOrder.drinkOrderStatus

    handler DrinkOrderPersistence is {
      on command DrinkOrder.ReceiveDrinkOrder {
        prompt "Store new drink order"
      }
      on command DrinkOrder.PrepareDrink {
        prompt "Mark drink preparation started"
      }
      on command DrinkOrder.MarkDrinkReady {
        prompt "Mark drinks as ready"
      }
      on command DrinkOrder.NotifyServerDrinksReady {
        prompt "Record server notification"
      }
      on command DrinkOrder.CompleteDrinkOrder {
        prompt "Mark drink order completed"
      }
    } with {
      briefly "Drink order persistence"
      described by "Persists drink order commands."
    }
  } with {
    briefly "Drink order repository"
    described by "Stores and retrieves drink order data."
  }

  adaptor FromFrontOfHouse from context Restaurant.FrontOfHouse is {
    handler DrinkIntake is {
      on event Restaurant.FrontOfHouse.TableOrder.OrderSubmitted {
        prompt "Extract drink items from submitted order and create drink order"
      }
    } with {
      briefly "Drink intake"
      described by "Extracts drink items from table orders."
    }
  } with {
    briefly "Front of house adaptor"
    described by "Receives drink portions of submitted table orders."
  }

} with {
  briefly "Bar context"
  described by {
    | Manages drink order preparation and server notification.
    | Push notifications when drinks are ready solve the
    | melting-ice problem caused by communication gaps
    | between bartenders and servers.
  }
}
