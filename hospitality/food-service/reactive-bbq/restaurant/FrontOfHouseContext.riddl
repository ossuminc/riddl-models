// Front of House bounded context

context FrontOfHouse is {

  include "front-of-house-types.riddl"
  include "Reservation.riddl"
  include "TableOrder.riddl"

  repository ReservationRepository is {
    schema ReservationData is relational
      of reservations as Reservation
      index on field Reservation.reservationId
      index on field Reservation.guestName
      index on field Reservation.reservationTime

    handler ReservationPersistence is {
      on command Reservation.MakeReservation {
        prompt "Store new reservation"
      }
      on command Reservation.ConfirmReservation {
        prompt "Update reservation to confirmed"
      }
      on command Reservation.CancelReservation {
        prompt "Update reservation to cancelled"
      }
      on command Reservation.SeatParty {
        prompt "Update reservation to seated"
      }
    } with {
      briefly "Reservation persistence"
      described by "Persists reservation commands."
    }
  } with {
    briefly "Reservation repository"
    described by "Stores and retrieves reservation data."
  }

  repository TableOrderRepository is {
    schema TableOrderData is relational
      of orders as TableOrder
      index on field TableOrder.tableOrderId
      index on field TableOrder.tableNumber

    handler TableOrderPersistence is {
      on command TableOrder.CreateOrder {
        prompt "Store new table order"
      }
      on command TableOrder.AddItem {
        prompt "Add item to order"
      }
      on command TableOrder.RemoveItem {
        prompt "Remove item from order"
      }
      on command TableOrder.SubmitOrder {
        prompt "Mark order as submitted"
      }
      on command TableOrder.ProcessPayment {
        prompt "Record payment"
      }
      on command TableOrder.CloseOrder {
        prompt "Mark order as closed"
      }
    } with {
      briefly "Order persistence"
      described by "Persists table order commands."
    }
  } with {
    briefly "Table order repository"
    described by "Stores and retrieves table order data."
  }

  projector ReservationBoard is {
    updates repository ReservationRepository

    record ReservationBoardEntry is {
      reservationId is ReservationId with {
        briefly "ID"
        described by "Reservation identifier."
      }
      guestName is GuestName with {
        briefly "Guest"
        described by "Guest name."
      }
      partySize is PartySize with {
        briefly "Party size"
        described by "Number of guests."
      }
      reservationTime is TimeStamp with {
        briefly "Time"
        described by "Reservation time."
      }
      reservationStatus is ReservationStatus with {
        briefly "Status"
        described by "Current status."
      }
      assignedTable is optional TableNumber with {
        briefly "Table"
        described by "Assigned table."
      }
    } with {
      briefly "Board entry"
      described by "A single entry on the reservation board."
    }

    handler ReservationBoardHandler is {
      on event Reservation.ReservationMade {
        prompt "Add reservation to board"
      }
      on event Reservation.ReservationConfirmed {
        prompt "Update board entry to confirmed"
      }
      on event Reservation.ReservationCancelled {
        prompt "Remove cancelled reservation from board"
      }
      on event Reservation.PartySeated {
        prompt "Update board entry to seated"
      }
    } with {
      briefly "Board event handler"
      described by "Projects reservation events onto the board."
    }
  } with {
    briefly "Reservation board projector"
    described by {
      | Real-time view of current reservations replacing
      | the host's paper backup system.
    }
  }

  adaptor ToKitchen to context Restaurant.Kitchen is {
    handler KitchenRouting is {
      on command Restaurant.Kitchen.KitchenTicket.ReceiveTicket {
        prompt "Route food items from submitted order to kitchen"
      }
    } with {
      briefly "Kitchen routing"
      described by "Routes food items to kitchen context."
    }
  } with {
    briefly "Kitchen adaptor"
    described by "Sends submitted food orders to the kitchen."
  }

  adaptor ToBar to context Restaurant.Bar is {
    handler BarRouting is {
      on command Restaurant.Bar.DrinkOrder.ReceiveDrinkOrder {
        prompt "Route drink items from submitted order to bar"
      }
    } with {
      briefly "Bar routing"
      described by "Routes drink items to bar context."
    }
  } with {
    briefly "Bar adaptor"
    described by "Sends submitted drink orders to the bar."
  }

  adaptor ToLoyalty to context Restaurant.Loyalty is {
    handler LoyaltyRouting is {
      on command Restaurant.Loyalty.LoyaltyAccount.AccruePoints {
        prompt "Send payment event to loyalty for point accrual"
      }
    } with {
      briefly "Loyalty routing"
      described by "Routes payment events for loyalty accrual."
    }
  } with {
    briefly "Loyalty adaptor"
    described by "Sends payment events to the loyalty context."
  }

} with {
  briefly "Front of house context"
  described by {
    | Manages reservations, table seating, dine-in orders,
    | billing, and payment. Communicates with kitchen, bar,
    | and loyalty contexts via adaptors.
  }
}
