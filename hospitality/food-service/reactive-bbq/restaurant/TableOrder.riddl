// TableOrder entity for the Front of House context
entity TableOrder is {
  // ---- Commands ----
  command CreateOrder is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Identifier for the new order.
      }
    }
    tableNumber: TableNumber with {
      briefly "Table"
      described as {
        |Table this order belongs to.
      }
    }
    serverId: String(1,50) with {
      briefly "Server ID"
      described as {
        |Identifier of the assigned server.
      }
    }
  } with {
    briefly "Create order"
    described as {
      |Create a new table order.
    }
  }
  command AddItem is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order to add item to.
      }
    }
    addedItem: OrderLine with {
      briefly "Item"
      described as {
        |Line item to add.
      }
    }
  } with {
    briefly "Add item"
    described as {
      |Add a menu item to the order.
    }
  }
  command RemoveItem is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order to remove item from.
      }
    }
    removedMenuItemId: String(1,50) with {
      briefly "Menu item ID"
      described as {
        |Identifier of the menu item to remove.
      }
    }
  } with {
    briefly "Remove item"
    described as {
      |Remove a menu item from the order.
    }
  }
  command SubmitOrder is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order to submit.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted at"
      described as {
        |When the order was submitted.
      }
    }
  } with {
    briefly "Submit order"
    described as {
      |Submit the order to kitchen and bar.
    }
  }
  command PresentBill is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order to present bill for.
      }
    }
    billTotal: Decimal(10,2) with {
      briefly "Total"
      described as {
        |Calculated bill total.
      }
    }
  } with {
    briefly "Present bill"
    described as {
      |Present the bill to the table.
    }
  }
  command ProcessPayment is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order to process payment for.
      }
    }
    orderPayment: PaymentInfo with {
      briefly "Payment"
      described as {
        |Payment details.
      }
    }
  } with {
    briefly "Process payment"
    described as {
      |Process payment for the order.
    }
  }
  command CloseOrder is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order to close.
      }
    }
    closedAt: TimeStamp with {
      briefly "Closed at"
      described as {
        |When the order was closed.
      }
    }
  } with {
    briefly "Close order"
    described as {
      |Close the order after payment.
    }
  }
  // ---- Events ----
  event OrderCreated is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order identifier.
      }
    }
    tableNumber: TableNumber with {
      briefly "Table"
      described as {
        |Table number.
      }
    }
    serverId: String(1,50) with {
      briefly "Server ID"
      described as {
        |Assigned server.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created at"
      described as {
        |When the order was created.
      }
    }
  } with {
    briefly "Order created"
    described as {
      |Emitted when a new table order is created.
    }
  }
  event ItemAdded is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order identifier.
      }
    }
    addedItem: OrderLine with {
      briefly "Item"
      described as {
        |Item that was added.
      }
    }
  } with {
    briefly "Item added"
    described as {
      |Emitted when an item is added to the order.
    }
  }
  event ItemRemoved is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order identifier.
      }
    }
    removedMenuItemId: String(1,50) with {
      briefly "Menu item ID"
      described as {
        |Identifier of the removed item.
      }
    }
  } with {
    briefly "Item removed"
    described as {
      |Emitted when an item is removed from the order.
    }
  }
  event OrderSubmitted is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order identifier.
      }
    }
    orderItems: OrderLine+ with {
      briefly "Items"
      described as {
        |All items in the submitted order.
      }
    }
    tableNumber: TableNumber with {
      briefly "Table"
      described as {
        |Table number.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted at"
      described as {
        |When the order was submitted.
      }
    }
  } with {
    briefly "Order submitted"
    described as {
      |Emitted when the order is submitted to kitchen and bar.
    }
  }
  event BillPresented is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order identifier.
      }
    }
    billTotal: Decimal(10,2) with {
      briefly "Total"
      described as {
        |Bill total amount.
      }
    }
    presentedAt: TimeStamp with {
      briefly "Presented at"
      described as {
        |When the bill was presented.
      }
    }
  } with {
    briefly "Bill presented"
    described as {
      |Emitted when the bill is presented to the table.
    }
  }
  event PaymentProcessed is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order identifier.
      }
    }
    orderPayment: PaymentInfo with {
      briefly "Payment"
      described as {
        |Payment details.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed at"
      described as {
        |When payment was processed.
      }
    }
  } with {
    briefly "Payment processed"
    described as {
      |Emitted when payment is successfully processed.
    }
  }
  event OrderClosed is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order identifier.
      }
    }
    closedAt: TimeStamp with {
      briefly "Closed at"
      described as {
        |When the order was closed.
      }
    }
  } with {
    briefly "Order closed"
    described as {
      |Emitted when the order is closed after payment.
    }
  }
  // ---- State ----
  record TableOrderStateData is  {
    tableOrderId: TableOrderId with {
      briefly "ID"
      described as {
        |Order identifier.
      }
    }
    tableNumber: TableNumber with {
      briefly "Table"
      described as {
        |Table number.
      }
    }
    serverId: String(1,50) with {
      briefly "Server ID"
      described as {
        |Assigned server.
      }
    }
    orderItems: OrderLine+ with {
      briefly "Items"
      described as {
        |Items in the order.
      }
    }
    orderStatus: OrderStatus with {
      briefly "Status"
      described as {
        |Current order status.
      }
    }
    presentedBillTotal: Decimal(10,2)? with {
      briefly "Total"
      described as {
        |Bill total when presented.
      }
    }
    processedPayment: PaymentInfo? with {
      briefly "Payment"
      described as {
        |Payment info when processed.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created at"
      described as {
        |When the order was created.
      }
    }
    actualSubmittedAt: TimeStamp? with {
      briefly "Submitted at"
      described as {
        |When the order was submitted.
      }
    }
    actualClosedAt: TimeStamp? with {
      briefly "Closed at"
      described as {
        |When the order was closed.
      }
    }
  } with {
    briefly "Table order state data"
    described as {
      |Full state of a table order.
    }
  }
  state ActiveOrder of type TableOrder.TableOrderStateData
  handler TableOrderHandler is {
    on command CreateOrder is {
      morph entity FrontOfHouse.TableOrder to state FrontOfHouse.TableOrder.ActiveOrder with command CreateOrder
      tell event OrderCreated to entity FrontOfHouse.TableOrder
    }
    on command AddItem is {
      tell event ItemAdded to entity FrontOfHouse.TableOrder
    }
    on command RemoveItem is {
      tell event ItemRemoved to entity FrontOfHouse.TableOrder
    }
    on command SubmitOrder is {
      tell event OrderSubmitted to entity FrontOfHouse.TableOrder
    }
    on command PresentBill is {
      tell event BillPresented to entity FrontOfHouse.TableOrder
    }
    on command ProcessPayment is {
      tell event PaymentProcessed to entity FrontOfHouse.TableOrder
    }
    on command CloseOrder is {
      tell event OrderClosed to entity FrontOfHouse.TableOrder
    }
  } with {
    briefly "Table order command handler"
    described as {
      |Processes table order lifecycle commands.
    }
  }
} with {
  briefly "Table order entity"
  described as {
    | Manages the full lifecycle of a dine-in table order
    | from creation through item management, submission
    | to kitchen and bar, billing, payment, and closing.
  }
}
