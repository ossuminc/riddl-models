// Kitchen bounded context
context Kitchen is {
  include "kitchen-types.riddl"
  include "KitchenTicket.riddl"
  repository KitchenTicketRepository is {
    schema KitchenTicketData is relational
      of tickets as type KitchenTicket
        index on field KitchenTicket.kitchenTicketId
        index on field KitchenTicket.ticketStatus
        index on field KitchenTicket.assignedStation

    handler KitchenTicketPersistence is {
      on command KitchenTicket.ReceiveTicket is {
        prompt "Store new kitchen ticket"
      }
      on command KitchenTicket.AssignStation is {
        prompt "Update ticket with station assignment"
      }
      on command KitchenTicket.StartPreparation is {
        prompt "Mark ticket preparation started"
      }
      on command KitchenTicket.MarkItemReady is {
        prompt "Update item readiness on ticket"
      }
      on command KitchenTicket.ApproveTicket is {
        prompt "Mark ticket as approved"
      }
      on command KitchenTicket.NotifyServer is {
        prompt "Mark server notified"
      }
    } with {
      briefly "Kitchen ticket persistence"
      described as {
        |Persists kitchen ticket commands.
      }
    }
  } with {
    briefly "Kitchen ticket repository"
    described as {
      |Stores and retrieves kitchen ticket data.
    }
  }
  projector KitchenDisplay is {
    record KitchenDisplayEntry is  {
      kitchenTicketId: KitchenTicketId with {
        briefly "ID"
        described as {
          |Ticket identifier.
        }
      }
      ticketSource: TicketSource with {
        briefly "Source"
        described as {
          |Dine-in or online.
        }
      }
      ticketItems: TicketItem+ with {
        briefly "Items"
        described as {
          |Items on the ticket.
        }
      }
      ticketStatus: TicketStatus with {
        briefly "Status"
        described as {
          |Current status.
        }
      }
      displayStation: StationName? with {
        briefly "Station"
        described as {
          |Assigned station.
        }
      }
      receivedAt: TimeStamp with {
        briefly "Received at"
        described as {
          |When received.
        }
      }
    } with {
      briefly "Display entry"
      described as {
        |A single entry on the kitchen display.
      }
    }
    handler KitchenDisplayHandler is {
      on event KitchenTicket.TicketReceived is {
        prompt "Add ticket to kitchen display"
      }
      on event KitchenTicket.StationAssigned is {
        prompt "Update display with station assignment"
      }
      on event KitchenTicket.PreparationStarted is {
        prompt "Update display to show preparation in progress"
      }
      on event KitchenTicket.ItemMarkedReady is {
        prompt "Update item readiness on display"
      }
      on event KitchenTicket.TicketApproved is {
        prompt "Mark ticket as approved on display"
      }
      on event KitchenTicket.ServerNotified is {
        prompt "Remove completed ticket from active display"
      }
    } with {
      briefly "Kitchen display handler"
      described as {
        |Projects ticket events onto the kitchen display.
      }
    }
  } with {
    briefly "Kitchen display projector"
    described as {
      | Real-time kitchen display screen showing active
      | tickets, station assignments, and preparation status.
      | Replaces handwritten tickets and prevents order loss.
    }
  }
  adaptor FromFrontOfHouse from context Restaurant.FrontOfHouse is { 
    handler FrontOfHouseIntake is {
      on event Restaurant.FrontOfHouse.TableOrder.OrderSubmitted is {
        prompt "Convert submitted dine-in order into kitchen ticket"
      }
    } with {
      briefly "FOH intake"
      described as {
        |Converts dine-in orders to kitchen tickets.
      }
    }
  } with {
    briefly "Front of house adaptor"
    described as {
      |Receives submitted dine-in orders.
    }
  }
  adaptor FromOnlineOrdering from context Restaurant.OnlineOrdering is { 
    handler OnlineIntake is {
      on event Restaurant.OnlineOrdering.OnlineOrder.OnlineOrderSubmitted is {
        prompt "Convert submitted online order into kitchen ticket"
      }
    } with {
      briefly "Online intake"
      described as {
        |Converts online orders to kitchen tickets.
      }
    }
  } with {
    briefly "Online ordering adaptor"
    described as {
      |Receives submitted online orders.
    }
  }
} with {
  briefly "Kitchen context"
  described as {
    | Manages kitchen ticket queue, station assignments,
    | preparation tracking, and quality control. Provides
    | the kitchen display screen that replaces handwritten
    | tickets and prevents order loss during peak hours.
  }
}
