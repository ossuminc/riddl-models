// Shift entity for the Scheduling context
entity Shift is {
  // ---- Commands ----
  command CreateShift is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Identifier for the new shift.
      }
    }
    shiftDate: Date with {
      briefly "Date"
      described as {
        |Date of the shift.
      }
    }
    shiftStart: TimeStamp with {
      briefly "Start"
      described as {
        |Shift start time.
      }
    }
    shiftEnd: TimeStamp with {
      briefly "End"
      described as {
        |Shift end time.
      }
    }
    shiftRole: ShiftRole with {
      briefly "Role"
      described as {
        |Role needed for this shift.
      }
    }
  } with {
    briefly "Create shift"
    described as {
      |Create a new shift in the schedule.
    }
  }
  command AssignEmployee is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift to assign.
      }
    }
    employeeId: EmployeeId with {
      briefly "Employee ID"
      described as {
        |Employee to assign.
      }
    }
    employeeName: String(1,100) with {
      briefly "Employee name"
      described as {
        |Name of the employee.
      }
    }
  } with {
    briefly "Assign employee"
    described as {
      |Assign an employee to the shift.
    }
  }
  command SwapShift is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift to swap.
      }
    }
    originalEmployeeId: EmployeeId with {
      briefly "Original employee"
      described as {
        |Employee leaving the shift.
      }
    }
    replacementEmployeeId: EmployeeId with {
      briefly "Replacement employee"
      described as {
        |Employee taking over the shift.
      }
    }
    replacementName: String(1,100) with {
      briefly "Replacement name"
      described as {
        |Name of the replacement employee.
      }
    }
  } with {
    briefly "Swap shift"
    described as {
      |Swap one employee for another on a shift.
    }
  }
  command ClockIn is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift to clock in for.
      }
    }
    clockedInAt: TimeStamp with {
      briefly "Clocked in at"
      described as {
        |Actual clock-in time.
      }
    }
  } with {
    briefly "Clock in"
    described as {
      |Record employee clock-in for the shift.
    }
  }
  command ClockOut is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift to clock out of.
      }
    }
    clockedOutAt: TimeStamp with {
      briefly "Clocked out at"
      described as {
        |Actual clock-out time.
      }
    }
  } with {
    briefly "Clock out"
    described as {
      |Record employee clock-out for the shift.
    }
  }
  command CancelShift is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift to cancel.
      }
    }
    shiftCancelReason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason for cancellation.
      }
    }
  } with {
    briefly "Cancel shift"
    described as {
      |Cancel a scheduled shift.
    }
  }
  // ---- Events ----
  event ShiftCreated is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift identifier.
      }
    }
    shiftDate: Date with {
      briefly "Date"
      described as {
        |Shift date.
      }
    }
    shiftStart: TimeStamp with {
      briefly "Start"
      described as {
        |Start time.
      }
    }
    shiftEnd: TimeStamp with {
      briefly "End"
      described as {
        |End time.
      }
    }
    shiftRole: ShiftRole with {
      briefly "Role"
      described as {
        |Shift role.
      }
    }
    shiftCreatedAt: TimeStamp with {
      briefly "Created at"
      described as {
        |When created.
      }
    }
  } with {
    briefly "Shift created"
    described as {
      |Emitted when a new shift is created.
    }
  }
  event EmployeeAssigned is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift identifier.
      }
    }
    employeeId: EmployeeId with {
      briefly "Employee ID"
      described as {
        |Assigned employee.
      }
    }
    employeeName: String(1,100) with {
      briefly "Employee name"
      described as {
        |Employee name.
      }
    }
    employeeAssignedAt: TimeStamp with {
      briefly "Assigned at"
      described as {
        |When assigned.
      }
    }
  } with {
    briefly "Employee assigned"
    described as {
      |Emitted when an employee is assigned to a shift.
    }
  }
  event ShiftSwapped is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift identifier.
      }
    }
    originalEmployeeId: EmployeeId with {
      briefly "Original employee"
      described as {
        |Employee who left.
      }
    }
    replacementEmployeeId: EmployeeId with {
      briefly "Replacement employee"
      described as {
        |Employee who took over.
      }
    }
    swappedAt: TimeStamp with {
      briefly "Swapped at"
      described as {
        |When swapped.
      }
    }
  } with {
    briefly "Shift swapped"
    described as {
      |Emitted when a shift swap occurs.
    }
  }
  event ClockedIn is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift identifier.
      }
    }
    clockedInAt: TimeStamp with {
      briefly "Clocked in at"
      described as {
        |Clock-in time.
      }
    }
  } with {
    briefly "Clocked in"
    described as {
      |Emitted when an employee clocks in.
    }
  }
  event ClockedOut is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift identifier.
      }
    }
    clockedOutAt: TimeStamp with {
      briefly "Clocked out at"
      described as {
        |Clock-out time.
      }
    }
  } with {
    briefly "Clocked out"
    described as {
      |Emitted when an employee clocks out.
    }
  }
  event ShiftCancelled is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift identifier.
      }
    }
    shiftCancelReason: String(1,500) with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
    shiftCancelledAt: TimeStamp with {
      briefly "Cancelled at"
      described as {
        |When cancelled.
      }
    }
  } with {
    briefly "Shift cancelled"
    described as {
      |Emitted when a shift is cancelled.
    }
  }
  // ---- State ----
  record ShiftStateData is  {
    shiftId: ShiftId with {
      briefly "ID"
      described as {
        |Shift identifier.
      }
    }
    shiftDate: Date with {
      briefly "Date"
      described as {
        |Shift date.
      }
    }
    shiftStart: TimeStamp with {
      briefly "Start"
      described as {
        |Start time.
      }
    }
    shiftEnd: TimeStamp with {
      briefly "End"
      described as {
        |End time.
      }
    }
    shiftRole: ShiftRole with {
      briefly "Role"
      described as {
        |Shift role.
      }
    }
    shiftStatus: ShiftStatus with {
      briefly "Status"
      described as {
        |Current shift status.
      }
    }
    assignedEmployeeId: EmployeeId? with {
      briefly "Employee ID"
      described as {
        |Assigned employee.
      }
    }
    assignedEmployeeName: String(1,100)? with {
      briefly "Employee name"
      described as {
        |Employee name.
      }
    }
    actualClockedInAt: TimeStamp? with {
      briefly "Clocked in at"
      described as {
        |Clock-in time.
      }
    }
    actualClockedOutAt: TimeStamp? with {
      briefly "Clocked out at"
      described as {
        |Clock-out time.
      }
    }
    shiftCreatedAt: TimeStamp with {
      briefly "Created at"
      described as {
        |When created.
      }
    }
  } with {
    briefly "Shift state data"
    described as {
      |Full state of a shift.
    }
  }
  state ActiveShift of type Shift.ShiftStateData
  handler ShiftHandler is {
    on command CreateShift is {
      morph entity Scheduling.Shift to state Scheduling.Shift.ActiveShift with command CreateShift
      tell event ShiftCreated to entity Scheduling.Shift
    }
    on command AssignEmployee is {
      tell event EmployeeAssigned to entity Scheduling.Shift
    }
    on command SwapShift is {
      tell event ShiftSwapped to entity Scheduling.Shift
    }
    on command ClockIn is {
      tell event ClockedIn to entity Scheduling.Shift
    }
    on command ClockOut is {
      tell event ClockedOut to entity Scheduling.Shift
    }
    on command CancelShift is {
      tell event ShiftCancelled to entity Scheduling.Shift
    }
  } with {
    briefly "Shift command handler"
    described as {
      |Processes shift lifecycle commands.
    }
  }
} with {
  briefly "Shift entity"
  described as {
    | Manages the lifecycle of a staff shift from creation
    | through assignment, clock-in/out, swaps, and
    | cancellation.
  }
}
