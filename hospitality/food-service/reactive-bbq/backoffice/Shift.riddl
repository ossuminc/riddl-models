// Shift entity for the Scheduling context

entity Shift is {

  // ---- Commands ----

  command CreateShift is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Identifier for the new shift."
    }
    shiftDate is Date with {
      briefly "Date"
      described by "Date of the shift."
    }
    shiftStart is TimeStamp with {
      briefly "Start"
      described by "Shift start time."
    }
    shiftEnd is TimeStamp with {
      briefly "End"
      described by "Shift end time."
    }
    shiftRole is ShiftRole with {
      briefly "Role"
      described by "Role needed for this shift."
    }
  } with {
    briefly "Create shift"
    described by "Create a new shift in the schedule."
  }

  command AssignEmployee is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift to assign."
    }
    employeeId is EmployeeId with {
      briefly "Employee ID"
      described by "Employee to assign."
    }
    employeeName is String(1, 100) with {
      briefly "Employee name"
      described by "Name of the employee."
    }
  } with {
    briefly "Assign employee"
    described by "Assign an employee to the shift."
  }

  command SwapShift is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift to swap."
    }
    originalEmployeeId is EmployeeId with {
      briefly "Original employee"
      described by "Employee leaving the shift."
    }
    replacementEmployeeId is EmployeeId with {
      briefly "Replacement employee"
      described by "Employee taking over the shift."
    }
    replacementName is String(1, 100) with {
      briefly "Replacement name"
      described by "Name of the replacement employee."
    }
  } with {
    briefly "Swap shift"
    described by "Swap one employee for another on a shift."
  }

  command ClockIn is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift to clock in for."
    }
    clockedInAt is TimeStamp with {
      briefly "Clocked in at"
      described by "Actual clock-in time."
    }
  } with {
    briefly "Clock in"
    described by "Record employee clock-in for the shift."
  }

  command ClockOut is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift to clock out of."
    }
    clockedOutAt is TimeStamp with {
      briefly "Clocked out at"
      described by "Actual clock-out time."
    }
  } with {
    briefly "Clock out"
    described by "Record employee clock-out for the shift."
  }

  command CancelShift is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift to cancel."
    }
    shiftCancelReason is String(1, 500) with {
      briefly "Reason"
      described by "Reason for cancellation."
    }
  } with {
    briefly "Cancel shift"
    described by "Cancel a scheduled shift."
  }

  // ---- Events ----

  event ShiftCreated is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift identifier."
    }
    shiftDate is Date with {
      briefly "Date"
      described by "Shift date."
    }
    shiftStart is TimeStamp with {
      briefly "Start"
      described by "Start time."
    }
    shiftEnd is TimeStamp with {
      briefly "End"
      described by "End time."
    }
    shiftRole is ShiftRole with {
      briefly "Role"
      described by "Shift role."
    }
    shiftCreatedAt is TimeStamp with {
      briefly "Created at"
      described by "When created."
    }
  } with {
    briefly "Shift created"
    described by "Emitted when a new shift is created."
  }

  event EmployeeAssigned is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift identifier."
    }
    employeeId is EmployeeId with {
      briefly "Employee ID"
      described by "Assigned employee."
    }
    employeeName is String(1, 100) with {
      briefly "Employee name"
      described by "Employee name."
    }
    employeeAssignedAt is TimeStamp with {
      briefly "Assigned at"
      described by "When assigned."
    }
  } with {
    briefly "Employee assigned"
    described by "Emitted when an employee is assigned to a shift."
  }

  event ShiftSwapped is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift identifier."
    }
    originalEmployeeId is EmployeeId with {
      briefly "Original employee"
      described by "Employee who left."
    }
    replacementEmployeeId is EmployeeId with {
      briefly "Replacement employee"
      described by "Employee who took over."
    }
    swappedAt is TimeStamp with {
      briefly "Swapped at"
      described by "When swapped."
    }
  } with {
    briefly "Shift swapped"
    described by "Emitted when a shift swap occurs."
  }

  event ClockedIn is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift identifier."
    }
    clockedInAt is TimeStamp with {
      briefly "Clocked in at"
      described by "Clock-in time."
    }
  } with {
    briefly "Clocked in"
    described by "Emitted when an employee clocks in."
  }

  event ClockedOut is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift identifier."
    }
    clockedOutAt is TimeStamp with {
      briefly "Clocked out at"
      described by "Clock-out time."
    }
  } with {
    briefly "Clocked out"
    described by "Emitted when an employee clocks out."
  }

  event ShiftCancelled is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift identifier."
    }
    shiftCancelReason is String(1, 500) with {
      briefly "Reason"
      described by "Cancellation reason."
    }
    shiftCancelledAt is TimeStamp with {
      briefly "Cancelled at"
      described by "When cancelled."
    }
  } with {
    briefly "Shift cancelled"
    described by "Emitted when a shift is cancelled."
  }

  // ---- State ----

  record ShiftStateData is {
    shiftId is ShiftId with {
      briefly "ID"
      described by "Shift identifier."
    }
    shiftDate is Date with {
      briefly "Date"
      described by "Shift date."
    }
    shiftStart is TimeStamp with {
      briefly "Start"
      described by "Start time."
    }
    shiftEnd is TimeStamp with {
      briefly "End"
      described by "End time."
    }
    shiftRole is ShiftRole with {
      briefly "Role"
      described by "Shift role."
    }
    shiftStatus is ShiftStatus with {
      briefly "Status"
      described by "Current shift status."
    }
    assignedEmployeeId is optional EmployeeId with {
      briefly "Employee ID"
      described by "Assigned employee."
    }
    assignedEmployeeName is optional String(1, 100) with {
      briefly "Employee name"
      described by "Employee name."
    }
    actualClockedInAt is optional TimeStamp with {
      briefly "Clocked in at"
      described by "Clock-in time."
    }
    actualClockedOutAt is optional TimeStamp with {
      briefly "Clocked out at"
      described by "Clock-out time."
    }
    shiftCreatedAt is TimeStamp with {
      briefly "Created at"
      described by "When created."
    }
  } with {
    briefly "Shift state data"
    described by "Full state of a shift."
  }

  state ActiveShift of Shift.ShiftStateData with {
    briefly "Active shift"
    described by "A shift that exists in the schedule."
  }

  handler ShiftHandler is {
    on command CreateShift {
      morph entity Scheduling.Shift to state
        Scheduling.Shift.ActiveShift
        with command CreateShift
      tell event ShiftCreated to
        entity Scheduling.Shift
    }
    on command AssignEmployee {
      tell event EmployeeAssigned to
        entity Scheduling.Shift
    }
    on command SwapShift {
      tell event ShiftSwapped to
        entity Scheduling.Shift
    }
    on command ClockIn {
      tell event ClockedIn to
        entity Scheduling.Shift
    }
    on command ClockOut {
      tell event ClockedOut to
        entity Scheduling.Shift
    }
    on command CancelShift {
      tell event ShiftCancelled to
        entity Scheduling.Shift
    }
  } with {
    briefly "Shift command handler"
    described by "Processes shift lifecycle commands."
  }

} with {
  briefly "Shift entity"
  described by {
    | Manages the lifecycle of a staff shift from creation
    | through assignment, clock-in/out, swaps, and
    | cancellation.
  }
}
