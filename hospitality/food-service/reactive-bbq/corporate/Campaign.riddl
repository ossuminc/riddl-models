// Campaign entity for the Marketing context

entity Campaign is {

  // ---- Commands ----

  command CreateCampaign is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Identifier for the new campaign."
    }
    campaignName is String(1, 200) with {
      briefly "Name"
      described by "Campaign name."
    }
    campaignDescription is String(1, 2000) with {
      briefly "Description"
      described by "Campaign description and goals."
    }
    campaignChannels is many CampaignChannel with {
      briefly "Channels"
      described by "Marketing channels for the campaign."
    }
    campaignPromotion is optional CampaignPromotion with {
      briefly "Promotion"
      described by "Promotional offer if applicable."
    }
  } with {
    briefly "Create campaign"
    described by "Create a new marketing campaign."
  }

  command ScheduleCampaign is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign to schedule."
    }
    campaignStartDate is Date with {
      briefly "Start date"
      described by "Campaign start date."
    }
    campaignEndDate is Date with {
      briefly "End date"
      described by "Campaign end date."
    }
  } with {
    briefly "Schedule campaign"
    described by "Schedule the campaign for a date range."
  }

  command LaunchCampaign is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign to launch."
    }
    launchedAt is TimeStamp with {
      briefly "Launched at"
      described by "When the campaign was launched."
    }
  } with {
    briefly "Launch campaign"
    described by "Launch the campaign to make it live."
  }

  command PauseCampaign is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign to pause."
    }
    pauseReason is String(1, 500) with {
      briefly "Reason"
      described by "Reason for pausing."
    }
  } with {
    briefly "Pause campaign"
    described by "Temporarily pause a live campaign."
  }

  command EndCampaign is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign to end."
    }
    endedAt is TimeStamp with {
      briefly "Ended at"
      described by "When the campaign ended."
    }
  } with {
    briefly "End campaign"
    described by "End the campaign."
  }

  // ---- Events ----

  event CampaignCreated is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign identifier."
    }
    campaignName is String(1, 200) with {
      briefly "Name"
      described by "Campaign name."
    }
    campaignChannels is many CampaignChannel with {
      briefly "Channels"
      described by "Marketing channels."
    }
    campaignCreatedAt is TimeStamp with {
      briefly "Created at"
      described by "When created."
    }
  } with {
    briefly "Campaign created"
    described by "Emitted when a new campaign is created."
  }

  event CampaignScheduled is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign identifier."
    }
    campaignStartDate is Date with {
      briefly "Start date"
      described by "Start date."
    }
    campaignEndDate is Date with {
      briefly "End date"
      described by "End date."
    }
    campaignScheduledAt is TimeStamp with {
      briefly "Scheduled at"
      described by "When scheduled."
    }
  } with {
    briefly "Campaign scheduled"
    described by "Emitted when a campaign is scheduled."
  }

  event CampaignLaunched is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign identifier."
    }
    launchedAt is TimeStamp with {
      briefly "Launched at"
      described by "When launched."
    }
  } with {
    briefly "Campaign launched"
    described by "Emitted when a campaign goes live."
  }

  event CampaignPaused is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign identifier."
    }
    pauseReason is String(1, 500) with {
      briefly "Reason"
      described by "Pause reason."
    }
    pausedAt is TimeStamp with {
      briefly "Paused at"
      described by "When paused."
    }
  } with {
    briefly "Campaign paused"
    described by "Emitted when a live campaign is paused."
  }

  event CampaignEnded is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign identifier."
    }
    endedAt is TimeStamp with {
      briefly "Ended at"
      described by "When ended."
    }
  } with {
    briefly "Campaign ended"
    described by "Emitted when a campaign ends."
  }

  // ---- State ----

  record CampaignStateData is {
    campaignId is CampaignId with {
      briefly "ID"
      described by "Campaign identifier."
    }
    campaignName is String(1, 200) with {
      briefly "Name"
      described by "Campaign name."
    }
    campaignDescription is String(1, 2000) with {
      briefly "Description"
      described by "Campaign description."
    }
    campaignChannels is many CampaignChannel with {
      briefly "Channels"
      described by "Marketing channels."
    }
    campaignPromotion is optional CampaignPromotion with {
      briefly "Promotion"
      described by "Promotional offer."
    }
    campaignStatus is CampaignStatus with {
      briefly "Status"
      described by "Current campaign status."
    }
    scheduledStartDate is optional Date with {
      briefly "Start date"
      described by "Scheduled start date."
    }
    scheduledEndDate is optional Date with {
      briefly "End date"
      described by "Scheduled end date."
    }
    campaignCreatedAt is TimeStamp with {
      briefly "Created at"
      described by "When created."
    }
    actualLaunchedAt is optional TimeStamp with {
      briefly "Launched at"
      described by "When launched."
    }
  } with {
    briefly "Campaign state data"
    described by "Full state of a marketing campaign."
  }

  state ActiveCampaign of Campaign.CampaignStateData with {
    briefly "Active campaign"
    described by "A campaign in the system."
  }

  handler CampaignHandler is {
    on command CreateCampaign {
      morph entity Marketing.Campaign to state
        Marketing.Campaign.ActiveCampaign
        with command CreateCampaign
      tell event CampaignCreated to
        entity Marketing.Campaign
    }
    on command ScheduleCampaign {
      tell event CampaignScheduled to
        entity Marketing.Campaign
    }
    on command LaunchCampaign {
      tell event CampaignLaunched to
        entity Marketing.Campaign
    }
    on command PauseCampaign {
      tell event CampaignPaused to
        entity Marketing.Campaign
    }
    on command EndCampaign {
      tell event CampaignEnded to
        entity Marketing.Campaign
    }
  } with {
    briefly "Campaign command handler"
    described by "Processes campaign lifecycle commands."
  }

} with {
  briefly "Campaign entity"
  described by {
    | Manages the lifecycle of a marketing campaign from
    | creation through scheduling, launch, pause, and
    | completion.
  }
}
