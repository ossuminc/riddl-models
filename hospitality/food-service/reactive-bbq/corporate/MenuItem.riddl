// MenuItem entity for the MenuManagement context
entity MenuItem is {
  // ---- Commands ----
  command CreateMenuItem is  {
    menuItemId: MenuItemId with {
      briefly "ID"
      described as {
        |Identifier for the new menu item.
      }
    }
    menuItemName: String(1,200) with {
      briefly "Name"
      described as {
        |Display name of the menu item.
      }
    }
    menuItemCategory: MenuItemCategory with {
      briefly "Category"
      described as {
        |Item category.
      }
    }
    menuItemDescription: String(1,1000) with {
      briefly "Description"
      described as {
        |Customer-facing description.
      }
    }
    recipe: RecipeInfo with {
      briefly "Recipe"
      described as {
        |Recipe details.
      }
    }
    pricing: PriceInfo with {
      briefly "Pricing"
      described as {
        |Price and cost information.
      }
    }
  } with {
    briefly "Create menu item"
    described as {
      |Create a new menu item with recipe and pricing.
    }
  }
  command UpdateMenuItem is  {
    menuItemId: MenuItemId with {
      briefly "ID"
      described as {
        |Item to update.
      }
    }
    updatedName: String(1,200)? with {
      briefly "Name"
      described as {
        |Updated name.
      }
    }
    updatedDescription: String(1,1000)? with {
      briefly "Description"
      described as {
        |Updated description.
      }
    }
    updatedRecipe: RecipeInfo? with {
      briefly "Recipe"
      described as {
        |Updated recipe.
      }
    }
  } with {
    briefly "Update menu item"
    described as {
      |Update menu item details.
    }
  }
  command SetPrice is  {
    menuItemId: MenuItemId with {
      briefly "ID"
      described as {
        |Item to set price for.
      }
    }
    updatedPricing: PriceInfo with {
      briefly "Pricing"
      described as {
        |New pricing details.
      }
    }
    effectiveDate: Date with {
      briefly "Effective date"
      described as {
        |When the new price takes effect.
      }
    }
  } with {
    briefly "Set price"
    described as {
      |Set new pricing for a menu item.
    }
  }
  command RetireMenuItem is  {
    menuItemId: MenuItemId with {
      briefly "ID"
      described as {
        |Item to retire.
      }
    }
    retiredReason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason for retirement.
      }
    }
  } with {
    briefly "Retire menu item"
    described as {
      |Retire a menu item from active use.
    }
  }
  // ---- Events ----
  event MenuItemCreated is  {
    menuItemId: MenuItemId with {
      briefly "ID"
      described as {
        |Item identifier.
      }
    }
    menuItemName: String(1,200) with {
      briefly "Name"
      described as {
        |Item name.
      }
    }
    menuItemCategory: MenuItemCategory with {
      briefly "Category"
      described as {
        |Item category.
      }
    }
    menuItemCreatedAt: TimeStamp with {
      briefly "Created at"
      described as {
        |When created.
      }
    }
  } with {
    briefly "Menu item created"
    described as {
      |Emitted when a new menu item is created.
    }
  }
  event MenuItemUpdated is  {
    menuItemId: MenuItemId with {
      briefly "ID"
      described as {
        |Item identifier.
      }
    }
    menuItemUpdatedAt: TimeStamp with {
      briefly "Updated at"
      described as {
        |When updated.
      }
    }
  } with {
    briefly "Menu item updated"
    described as {
      |Emitted when a menu item is updated.
    }
  }
  event PriceSet is  {
    menuItemId: MenuItemId with {
      briefly "ID"
      described as {
        |Item identifier.
      }
    }
    updatedPricing: PriceInfo with {
      briefly "Pricing"
      described as {
        |New pricing.
      }
    }
    effectiveDate: Date with {
      briefly "Effective date"
      described as {
        |When effective.
      }
    }
    priceSetAt: TimeStamp with {
      briefly "Set at"
      described as {
        |When price was set.
      }
    }
  } with {
    briefly "Price set"
    described as {
      |Emitted when menu item pricing is changed.
    }
  }
  event MenuItemRetired is  {
    menuItemId: MenuItemId with {
      briefly "ID"
      described as {
        |Item identifier.
      }
    }
    retiredReason: String(1,500) with {
      briefly "Reason"
      described as {
        |Retirement reason.
      }
    }
    retiredAt: TimeStamp with {
      briefly "Retired at"
      described as {
        |When retired.
      }
    }
  } with {
    briefly "Menu item retired"
    described as {
      |Emitted when a menu item is retired.
    }
  }
  // ---- State ----
  record MenuItemStateData is  {
    menuItemId: MenuItemId with {
      briefly "ID"
      described as {
        |Item identifier.
      }
    }
    menuItemName: String(1,200) with {
      briefly "Name"
      described as {
        |Item name.
      }
    }
    menuItemCategory: MenuItemCategory with {
      briefly "Category"
      described as {
        |Item category.
      }
    }
    menuItemDescription: String(1,1000) with {
      briefly "Description"
      described as {
        |Customer-facing description.
      }
    }
    recipe: RecipeInfo with {
      briefly "Recipe"
      described as {
        |Recipe details.
      }
    }
    pricing: PriceInfo with {
      briefly "Pricing"
      described as {
        |Current pricing.
      }
    }
    menuItemLifecycle: MenuItemLifecycle with {
      briefly "Lifecycle"
      described as {
        |Current lifecycle stage.
      }
    }
    menuItemCreatedAt: TimeStamp with {
      briefly "Created at"
      described as {
        |When created.
      }
    }
  } with {
    briefly "Menu item state data"
    described as {
      |Full state of a menu item.
    }
  }
  state ActiveMenuItem of type MenuItem.MenuItemStateData
  handler MenuItemHandler is {
    on command CreateMenuItem is {
      morph entity MenuManagement.MenuItem to state MenuManagement.MenuItem.ActiveMenuItem with command CreateMenuItem
      tell event MenuItemCreated to entity MenuManagement.MenuItem
    }
    on command UpdateMenuItem is {
      tell event MenuItemUpdated to entity MenuManagement.MenuItem
    }
    on command SetPrice is {
      tell event PriceSet to entity MenuManagement.MenuItem
    }
    on command RetireMenuItem is {
      tell event MenuItemRetired to entity MenuManagement.MenuItem
    }
  } with {
    briefly "Menu item command handler"
    described as {
      |Processes menu item lifecycle commands.
    }
  }
} with {
  briefly "Menu item entity"
  described as {
    | Manages the lifecycle of a corporate menu item
    | from creation through recipe updates, pricing
    | changes, and retirement.
  }
}
