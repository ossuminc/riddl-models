// MenuItem entity for the MenuManagement context

entity MenuItem is {

  // ---- Commands ----

  command CreateMenuItem is {
    menuItemId is MenuItemId with {
      briefly "ID"
      described by "Identifier for the new menu item."
    }
    menuItemName is String(1, 200) with {
      briefly "Name"
      described by "Display name of the menu item."
    }
    menuItemCategory is MenuItemCategory with {
      briefly "Category"
      described by "Item category."
    }
    menuItemDescription is String(1, 1000) with {
      briefly "Description"
      described by "Customer-facing description."
    }
    recipe is RecipeInfo with {
      briefly "Recipe"
      described by "Recipe details."
    }
    pricing is PriceInfo with {
      briefly "Pricing"
      described by "Price and cost information."
    }
  } with {
    briefly "Create menu item"
    described by "Create a new menu item with recipe and pricing."
  }

  command UpdateMenuItem is {
    menuItemId is MenuItemId with {
      briefly "ID"
      described by "Item to update."
    }
    updatedName is optional String(1, 200) with {
      briefly "Name"
      described by "Updated name."
    }
    updatedDescription is optional String(1, 1000) with {
      briefly "Description"
      described by "Updated description."
    }
    updatedRecipe is optional RecipeInfo with {
      briefly "Recipe"
      described by "Updated recipe."
    }
  } with {
    briefly "Update menu item"
    described by "Update menu item details."
  }

  command SetPrice is {
    menuItemId is MenuItemId with {
      briefly "ID"
      described by "Item to set price for."
    }
    updatedPricing is PriceInfo with {
      briefly "Pricing"
      described by "New pricing details."
    }
    effectiveDate is Date with {
      briefly "Effective date"
      described by "When the new price takes effect."
    }
  } with {
    briefly "Set price"
    described by "Set new pricing for a menu item."
  }

  command RetireMenuItem is {
    menuItemId is MenuItemId with {
      briefly "ID"
      described by "Item to retire."
    }
    retiredReason is String(1, 500) with {
      briefly "Reason"
      described by "Reason for retirement."
    }
  } with {
    briefly "Retire menu item"
    described by "Retire a menu item from active use."
  }

  // ---- Events ----

  event MenuItemCreated is {
    menuItemId is MenuItemId with {
      briefly "ID"
      described by "Item identifier."
    }
    menuItemName is String(1, 200) with {
      briefly "Name"
      described by "Item name."
    }
    menuItemCategory is MenuItemCategory with {
      briefly "Category"
      described by "Item category."
    }
    menuItemCreatedAt is TimeStamp with {
      briefly "Created at"
      described by "When created."
    }
  } with {
    briefly "Menu item created"
    described by "Emitted when a new menu item is created."
  }

  event MenuItemUpdated is {
    menuItemId is MenuItemId with {
      briefly "ID"
      described by "Item identifier."
    }
    menuItemUpdatedAt is TimeStamp with {
      briefly "Updated at"
      described by "When updated."
    }
  } with {
    briefly "Menu item updated"
    described by "Emitted when a menu item is updated."
  }

  event PriceSet is {
    menuItemId is MenuItemId with {
      briefly "ID"
      described by "Item identifier."
    }
    updatedPricing is PriceInfo with {
      briefly "Pricing"
      described by "New pricing."
    }
    effectiveDate is Date with {
      briefly "Effective date"
      described by "When effective."
    }
    priceSetAt is TimeStamp with {
      briefly "Set at"
      described by "When price was set."
    }
  } with {
    briefly "Price set"
    described by "Emitted when menu item pricing is changed."
  }

  event MenuItemRetired is {
    menuItemId is MenuItemId with {
      briefly "ID"
      described by "Item identifier."
    }
    retiredReason is String(1, 500) with {
      briefly "Reason"
      described by "Retirement reason."
    }
    retiredAt is TimeStamp with {
      briefly "Retired at"
      described by "When retired."
    }
  } with {
    briefly "Menu item retired"
    described by "Emitted when a menu item is retired."
  }

  // ---- State ----

  record MenuItemStateData is {
    menuItemId is MenuItemId with {
      briefly "ID"
      described by "Item identifier."
    }
    menuItemName is String(1, 200) with {
      briefly "Name"
      described by "Item name."
    }
    menuItemCategory is MenuItemCategory with {
      briefly "Category"
      described by "Item category."
    }
    menuItemDescription is String(1, 1000) with {
      briefly "Description"
      described by "Customer-facing description."
    }
    recipe is RecipeInfo with {
      briefly "Recipe"
      described by "Recipe details."
    }
    pricing is PriceInfo with {
      briefly "Pricing"
      described by "Current pricing."
    }
    menuItemLifecycle is MenuItemLifecycle with {
      briefly "Lifecycle"
      described by "Current lifecycle stage."
    }
    menuItemCreatedAt is TimeStamp with {
      briefly "Created at"
      described by "When created."
    }
  } with {
    briefly "Menu item state data"
    described by "Full state of a menu item."
  }

  state ActiveMenuItem of MenuItem.MenuItemStateData with {
    briefly "Active menu item"
    described by "A menu item that exists in the system."
  }

  handler MenuItemHandler is {
    on command CreateMenuItem {
      morph entity MenuManagement.MenuItem to state
        MenuManagement.MenuItem.ActiveMenuItem
        with command CreateMenuItem
      tell event MenuItemCreated to
        entity MenuManagement.MenuItem
    }
    on command UpdateMenuItem {
      tell event MenuItemUpdated to
        entity MenuManagement.MenuItem
    }
    on command SetPrice {
      tell event PriceSet to
        entity MenuManagement.MenuItem
    }
    on command RetireMenuItem {
      tell event MenuItemRetired to
        entity MenuManagement.MenuItem
    }
  } with {
    briefly "Menu item command handler"
    described by "Processes menu item lifecycle commands."
  }

} with {
  briefly "Menu item entity"
  described by {
    | Manages the lifecycle of a corporate menu item
    | from creation through recipe updates, pricing
    | changes, and retirement.
  }
}
