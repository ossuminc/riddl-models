// Venue Management - Venue Context
context VenueContext is {
  include "types.riddl"
  include "Booking.riddl"
  // Repository for booking persistence
  repository BookingRepository is {
    schema BookingData is relational
      of bookings as type Booking
        index on field Booking.bookingId
        index on field Booking.venue.venueId
        index on field Booking.space.spaceId
        index on field Booking.customer.customerId

    handler BookingPersistence is {
      on command Booking.CreateBooking is {
        prompt "Store new booking"
      }
      on command Booking.AddResource is {
        prompt "Add resource to booking"
      }
      on command Booking.RemoveResource is {
        prompt "Remove resource from booking"
      }
      on command Booking.SetCatering is {
        prompt "Store catering selection"
      }
      on command Booking.UpdateEventDetails is {
        prompt "Update event details"
      }
      on command Booking.ChangeBookingPeriod is {
        prompt "Update booking period"
      }
      on command Booking.ConfirmBooking is {
        prompt "Update to confirmed"
      }
      on command Booking.RecordDeposit is {
        prompt "Store deposit payment"
      }
      on command Booking.ProcessFinalPayment is {
        prompt "Store final payment"
      }
      on command Booking.StartEvent is {
        prompt "Update to in progress"
      }
      on command Booking.CompleteEvent is {
        prompt "Update to completed"
      }
      on command Booking.CancelBooking is {
        prompt "Update to cancelled"
      }
    } with {
      briefly "Persists booking commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Booking data persistence"
    described as {
      | The BookingRepository provides persistent storage for
      | venue bookings and related data.
    }
  }
  // Projector for venue analytics
  projector VenueAnalytics is {
    record VenueStats is  {
      totalBookings: Natural with {
        briefly "Total"
        described as {
          |Total bookings.
        }
      }
      confirmedBookings: Natural with {
        briefly "Confirmed"
        described as {
          |Confirmed bookings.
        }
      }
      completedEvents: Natural with {
        briefly "Completed"
        described as {
          |Completed events.
        }
      }
      cancelledBookings: Natural with {
        briefly "Cancelled"
        described as {
          |Cancelled bookings.
        }
      }
      totalRevenue: Decimal(12,2) with {
        briefly "Revenue"
        described as {
          |Total revenue.
        }
      }
      averageBookingValue: Decimal(10,2) with {
        briefly "ABV"
        described as {
          |Average booking value.
        }
      }
      spaceUtilization: Decimal(5,2) with {
        briefly "Utilization"
        described as {
          |Space utilization rate.
        }
      }
    } with {
      briefly "Venue statistics"
      described as {
        |Venue booking metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Booking.BookingCreated is {
        prompt "Update booking counts"
      }
      on event Booking.BookingConfirmed is {
        prompt "Update confirmed counts"
      }
      on event Booking.FinalPaymentProcessed is {
        prompt "Update revenue metrics"
      }
      on event Booking.EventCompleted is {
        prompt "Update completion metrics"
      }
      on event Booking.BookingCancelled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains venue analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Venue analytics projections"
    described as {
      |Maintains venue booking analytics data.
    }
  }
} with {
  briefly "Bounded context for venue management"
  described as {
    | The VenueContext is the bounded context for
    | venue booking and space management.
  }
}
