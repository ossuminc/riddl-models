// Venue Management - Venue Context

context VenueContext is {

  include "types.riddl"
  include "Booking.riddl"

  // Repository for booking persistence
  repository BookingRepository is {
    schema BookingData is relational
      of bookings as Booking
      index on field Booking.bookingId
      index on field Booking.venue.venueId
      index on field Booking.space.spaceId
      index on field Booking.customer.customerId

    handler BookingPersistence is {
      on event Booking.BookingCreated {
        prompt "Store new booking"
      }
      on event Booking.ResourceAdded {
        prompt "Add resource to booking"
      }
      on event Booking.ResourceRemoved {
        prompt "Remove resource from booking"
      }
      on event Booking.CateringSet {
        prompt "Store catering selection"
      }
      on event Booking.EventDetailsUpdated {
        prompt "Update event details"
      }
      on event Booking.BookingPeriodChanged {
        prompt "Update booking period"
      }
      on event Booking.BookingConfirmed {
        prompt "Update to confirmed"
      }
      on event Booking.DepositRecorded {
        prompt "Store deposit payment"
      }
      on event Booking.FinalPaymentProcessed {
        prompt "Store final payment"
      }
      on event Booking.EventStarted {
        prompt "Update to in progress"
      }
      on event Booking.EventCompleted {
        prompt "Update to completed"
      }
      on event Booking.BookingCancelled {
        prompt "Update to cancelled"
      }
    } with {
      briefly "Persists booking events"
      described by "Handles event-driven persistence."
    }
  } with {
    briefly "Booking data persistence"
    described by {
      | The BookingRepository provides persistent storage for
      | venue bookings and related data.
    }
  }

  // Projector for venue analytics
  projector VenueAnalytics is {
    updates repository BookingRepository

    record VenueStats is {
      totalBookings is Natural with { briefly "Total" described by "Total bookings." }
      confirmedBookings is Natural with { briefly "Confirmed" described by "Confirmed bookings." }
      completedEvents is Natural with { briefly "Completed" described by "Completed events." }
      cancelledBookings is Natural with { briefly "Cancelled" described by "Cancelled bookings." }
      totalRevenue is Decimal(12, 2) with { briefly "Revenue" described by "Total revenue." }
      averageBookingValue is Decimal(10, 2) with { briefly "ABV" described by "Average booking value." }
      spaceUtilization is Decimal(5, 2) with { briefly "Utilization" described by "Space utilization rate." }
    } with {
      briefly "Venue statistics"
      described by "Venue booking metrics."
    }

    handler AnalyticsHandler is {
      on event Booking.BookingCreated {
        prompt "Update booking counts"
      }
      on event Booking.BookingConfirmed {
        prompt "Update confirmed counts"
      }
      on event Booking.FinalPaymentProcessed {
        prompt "Update revenue metrics"
      }
      on event Booking.EventCompleted {
        prompt "Update completion metrics"
      }
      on event Booking.BookingCancelled {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains venue analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Venue analytics projections"
    described by "Maintains venue booking analytics data."
  }

} with {
  briefly "Bounded context for venue management"
  described by {
    | The VenueContext is the bounded context for
    | venue booking and space management.
  }
}
