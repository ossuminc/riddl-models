// Event Registration - Registration Context
context RegistrationContext is {
  include "types.riddl"
  include "Registration.riddl"
  // Repository for registration persistence
  repository RegistrationRepository is {
    schema RegistrationData is relational
      of registrations as type Registration
        index on field Registration.registrationId
        index on field Registration.attendee.attendeeId
        index on field Registration.event.eventId

    handler RegistrationPersistence is {
      on command Registration.CreateRegistration is {
        prompt "Store new registration"
      }
      on command Registration.ApplyDiscountCode is {
        prompt "Store discount application"
      }
      on command Registration.ProcessPayment is {
        prompt "Store payment"
      }
      on command Registration.ConfirmRegistration is {
        prompt "Update to confirmed"
      }
      on command Registration.AddToWaitlist is {
        prompt "Update to waitlisted"
      }
      on command Registration.RegisterForSession is {
        prompt "Store session registration"
      }
      on command Registration.UnregisterFromSession is {
        prompt "Remove session registration"
      }
      on command Registration.CheckIn is {
        prompt "Update to checked in"
      }
      on command Registration.AssignBadge is {
        prompt "Store badge assignment"
      }
      on command Registration.RecordSessionAttendance is {
        prompt "Update session attendance"
      }
      on command Registration.UpdateAttendeeInfo is {
        prompt "Update attendee info"
      }
      on command Registration.TransferRegistration is {
        prompt "Update attendee for transfer"
      }
      on command Registration.CancelRegistration is {
        prompt "Update to cancelled"
      }
      on command Registration.ProcessRefund is {
        prompt "Store refund"
      }
    } with {
      briefly "Persists registration commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Registration data persistence"
    described as {
      | The RegistrationRepository provides persistent storage for
      | registrations and related data.
    }
  }
  // Projector for event analytics
  projector EventAnalytics is {
    record EventStats is  {
      totalRegistrations: Natural with {
        briefly "Total"
        described as {
          |Total registrations.
        }
      }
      confirmedRegistrations: Natural with {
        briefly "Confirmed"
        described as {
          |Confirmed registrations.
        }
      }
      waitlistSize: Natural with {
        briefly "Waitlist"
        described as {
          |Waitlist size.
        }
      }
      checkedInCount: Natural with {
        briefly "Checked in"
        described as {
          |Checked in count.
        }
      }
      totalRevenue: Decimal(12,2) with {
        briefly "Revenue"
        described as {
          |Total revenue.
        }
      }
      checkInRate: Decimal(5,2) with {
        briefly "Check-in rate"
        described as {
          |Check-in percentage.
        }
      }
    } with {
      briefly "Event statistics"
      described as {
        |Event registration metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Registration.RegistrationCreated is {
        prompt "Update registration counts"
      }
      on event Registration.RegistrationConfirmed is {
        prompt "Update confirmed counts"
      }
      on event Registration.PaymentProcessed is {
        prompt "Update revenue metrics"
      }
      on event Registration.AttendeeCheckedIn is {
        prompt "Update check-in metrics"
      }
      on event Registration.RegistrationCancelled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains event analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Event analytics projections"
    described as {
      |Maintains event registration analytics data.
    }
  }
} with {
  briefly "Bounded context for event registration"
  described as {
    | The RegistrationContext is the bounded context for
    | event registration and attendee management.
  }
}
