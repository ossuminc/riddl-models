// Event Registration - External Contexts
// Event Catalog Service
context EventCatalogService is {
  query GetEvents is  {
    filterStartDate: Date? with {
      briefly "Start"
      described as {
        |Start date filter.
      }
    }
    filterEndDate: Date? with {
      briefly "End"
      described as {
        |End date filter.
      }
    }
    category: String(1,50)? with {
      briefly "Category"
      described as {
        |Event category.
      }
    }
  } with {
    briefly "Get events"
    described as {
      |Retrieves available events.
    }
  }
  result EventList is  {
    events: EventInfo+ with {
      briefly "Events"
      described as {
        |Available events.
      }
    }
  } with {
    briefly "Event list"
    described as {
      |List of events.
    }
  }
  query GetEventDetails is  {
    eventId: EventId with {
      briefly "Event"
      described as {
        |Event ID.
      }
    }
  } with {
    briefly "Get event details"
    described as {
      |Retrieves event details.
    }
  }
  result EventDetails is  {
    event: EventInfo with {
      briefly "Event"
      described as {
        |Event info.
      }
    }
    tickets: TicketInfo+ with {
      briefly "Tickets"
      described as {
        |Available tickets.
      }
    }
    sessions: SessionInfo+ with {
      briefly "Sessions"
      described as {
        |Event sessions.
      }
    }
    spotsRemaining: Natural with {
      briefly "Spots"
      described as {
        |Remaining spots.
      }
    }
  } with {
    briefly "Event details"
    described as {
      |Full event information.
    }
  }
} with {
  option external()
  briefly "External event catalog"
  described as {
    |External event management service.
  }
}
// Ticket Availability Service
context TicketAvailabilityService is {
  query CheckAvailability is  {
    eventId: EventId with {
      briefly "Event"
      described as {
        |Event ID.
      }
    }
    ticketTypeId: TicketTypeId with {
      briefly "Ticket type"
      described as {
        |Ticket type ID.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Requested quantity.
      }
    }
  } with {
    briefly "Check availability"
    described as {
      |Checks ticket availability.
    }
  }
  result TicketAvailability is  {
    available: Boolean with {
      briefly "Available"
      described as {
        |Whether available.
      }
    }
    remainingQuantity: Natural with {
      briefly "Remaining"
      described as {
        |Remaining tickets.
      }
    }
    waitlistAvailable: Boolean with {
      briefly "Waitlist"
      described as {
        |Waitlist available.
      }
    }
  } with {
    briefly "Ticket availability"
    described as {
      |Availability status.
    }
  }
  command ReserveTicket is  {
    eventId: EventId with {
      briefly "Event"
      described as {
        |Event ID.
      }
    }
    ticketTypeId: TicketTypeId with {
      briefly "Ticket type"
      described as {
        |Ticket type ID.
      }
    }
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
  } with {
    briefly "Reserve ticket"
    described as {
      |Reserves a ticket.
    }
  }
  event TicketReserved is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    reservationExpires: TimeStamp with {
      briefly "Expires"
      described as {
        |Reservation expiration.
      }
    }
  } with {
    briefly "Ticket reserved"
    described as {
      |Emitted when ticket is reserved.
    }
  }
  command ReleaseTicket is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
  } with {
    briefly "Release ticket"
    described as {
      |Releases reserved ticket.
    }
  }
  event TicketReleased is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    releasedAt: TimeStamp with {
      briefly "Released"
      described as {
        |Release time.
      }
    }
  } with {
    briefly "Ticket released"
    described as {
      |Emitted when ticket is released.
    }
  }
} with {
  option external()
  briefly "External ticket availability"
  described as {
    |External inventory service.
  }
}
// Discount Service
context DiscountService is {
  query ValidateDiscountCode is  {
    code: String(1,50) with {
      briefly "Code"
      described as {
        |Discount code.
      }
    }
    eventId: EventId with {
      briefly "Event"
      described as {
        |Event ID.
      }
    }
    ticketTypeId: TicketTypeId with {
      briefly "Ticket type"
      described as {
        |Ticket type ID.
      }
    }
  } with {
    briefly "Validate discount"
    described as {
      |Validates discount code.
    }
  }
  result DiscountValidation is  {
    valid: Boolean with {
      briefly "Valid"
      described as {
        |Whether code is valid.
      }
    }
    discountType: String(1,50)? with {
      briefly "Type"
      described as {
        |Discount type.
      }
    }
    validatedDiscountAmount: Decimal(10,2)? with {
      briefly "Amount"
      described as {
        |Discount amount.
      }
    }
    discountPercent: Decimal(5,2)? with {
      briefly "Percent"
      described as {
        |Discount percent.
      }
    }
    validationErrorMessage: String(1,200)? with {
      briefly "Error"
      described as {
        |Error message.
      }
    }
  } with {
    briefly "Discount validation"
    described as {
      |Validation result.
    }
  }
  command RedeemDiscount is  {
    code: String(1,50) with {
      briefly "Code"
      described as {
        |Discount code.
      }
    }
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
  } with {
    briefly "Redeem discount"
    described as {
      |Redeems discount code.
    }
  }
  event DiscountRedeemed is  {
    code: String(1,50) with {
      briefly "Code"
      described as {
        |Discount code.
      }
    }
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    redeemedAt: TimeStamp with {
      briefly "Redeemed"
      described as {
        |Redemption time.
      }
    }
  } with {
    briefly "Discount redeemed"
    described as {
      |Emitted when discount is redeemed.
    }
  }
} with {
  option external()
  briefly "External discount service"
  described as {
    |External promotion management.
  }
}
// Payment Processing Service
context PaymentProcessingService is {
  command ProcessRegistrationPayment is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    paymentMethod: String(1,50) with {
      briefly "Method"
      described as {
        |Payment method.
      }
    }
    paymentToken: String(1,200) with {
      briefly "Token"
      described as {
        |Payment token.
      }
    }
  } with {
    briefly "Process payment"
    described as {
      |Processes registration payment.
    }
  }
  event PaymentSucceeded is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    transactionId: String(1,100) with {
      briefly "Transaction"
      described as {
        |Transaction ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Amount processed.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Process time.
      }
    }
  } with {
    briefly "Payment succeeded"
    described as {
      |Emitted when payment succeeds.
    }
  }
  event PaymentFailed is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    errorCode: String(1,50) with {
      briefly "Error"
      described as {
        |Error code.
      }
    }
    errorMessage: String(1,500) with {
      briefly "Message"
      described as {
        |Error message.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |Failure time.
      }
    }
  } with {
    briefly "Payment failed"
    described as {
      |Emitted when payment fails.
    }
  }
  command ProcessRegistrationRefund is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Refund reason.
      }
    }
  } with {
    briefly "Process refund"
    described as {
      |Processes refund.
    }
  }
  event RefundSucceeded is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    refundId: String(1,100) with {
      briefly "Refund"
      described as {
        |Refund ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Process time.
      }
    }
  } with {
    briefly "Refund succeeded"
    described as {
      |Emitted when refund succeeds.
    }
  }
} with {
  option external()
  briefly "External payment processing"
  described as {
    |External payment service.
  }
}
// Email Service
context EmailService is {
  command SendConfirmationEmail is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    attendeeEmail: String(5,254) with {
      briefly "Email"
      described as {
        |Attendee email.
      }
    }
    confirmationNumber: String(1,50) with {
      briefly "Confirmation"
      described as {
        |Confirmation number.
      }
    }
    eventDetails: EventInfo with {
      briefly "Event"
      described as {
        |Event details.
      }
    }
  } with {
    briefly "Send confirmation"
    described as {
      |Sends confirmation email.
    }
  }
  event ConfirmationEmailSent is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Confirmation email sent"
    described as {
      |Emitted when email is sent.
    }
  }
  command SendReminderEmail is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    attendeeEmail: String(5,254) with {
      briefly "Email"
      described as {
        |Attendee email.
      }
    }
    daysUntilEvent: Natural with {
      briefly "Days"
      described as {
        |Days until event.
      }
    }
  } with {
    briefly "Send reminder"
    described as {
      |Sends event reminder.
    }
  }
  event ReminderEmailSent is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Reminder email sent"
    described as {
      |Emitted when reminder is sent.
    }
  }
  command SendCancellationEmail is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    attendeeEmail: String(5,254) with {
      briefly "Email"
      described as {
        |Attendee email.
      }
    }
    updatedRefundAmount: Decimal(10,2)? with {
      briefly "Refund"
      described as {
        |Refund amount.
      }
    }
  } with {
    briefly "Send cancellation"
    described as {
      |Sends cancellation email.
    }
  }
  event CancellationEmailSent is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Cancellation email sent"
    described as {
      |Emitted when cancellation is sent.
    }
  }
} with {
  option external()
  briefly "External email service"
  described as {
    |External email notification service.
  }
}
// Badge Printing Service
context BadgePrintingService is {
  command PrintBadge is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    attendee: AttendeeInfo with {
      briefly "Attendee"
      described as {
        |Attendee info.
      }
    }
    badgeNumber: String(1,50) with {
      briefly "Badge"
      described as {
        |Badge number.
      }
    }
    ticketType: TicketType with {
      briefly "Ticket"
      described as {
        |Ticket type.
      }
    }
  } with {
    briefly "Print badge"
    described as {
      |Prints attendee badge.
    }
  }
  event BadgePrinted is  {
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    badgeNumber: String(1,50) with {
      briefly "Badge"
      described as {
        |Badge number.
      }
    }
    printedAt: TimeStamp with {
      briefly "Printed"
      described as {
        |Print time.
      }
    }
  } with {
    briefly "Badge printed"
    described as {
      |Emitted when badge is printed.
    }
  }
} with {
  option external()
  briefly "External badge printing"
  described as {
    |External badge printing service.
  }
}
// Session Capacity Service
context SessionCapacityService is {
  query CheckSessionCapacity is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
  } with {
    briefly "Check session capacity"
    described as {
      |Checks session availability.
    }
  }
  result SessionCapacity is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    totalCapacity: Natural with {
      briefly "Capacity"
      described as {
        |Total capacity.
      }
    }
    registeredCount: Natural with {
      briefly "Registered"
      described as {
        |Registered count.
      }
    }
    spotsRemaining: Natural with {
      briefly "Remaining"
      described as {
        |Spots remaining.
      }
    }
  } with {
    briefly "Session capacity"
    described as {
      |Capacity information.
    }
  }
  command ReserveSessionSpot is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
  } with {
    briefly "Reserve session spot"
    described as {
      |Reserves spot in session.
    }
  }
  event SessionSpotReserved is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Session spot reserved"
    described as {
      |Emitted when spot is reserved.
    }
  }
  command ReleaseSessionSpot is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
  } with {
    briefly "Release session spot"
    described as {
      |Releases session spot.
    }
  }
  event SessionSpotReleased is  {
    sessionId: SessionId with {
      briefly "Session"
      described as {
        |Session ID.
      }
    }
    registrationId: RegistrationId with {
      briefly "Registration"
      described as {
        |Registration ID.
      }
    }
    releasedAt: TimeStamp with {
      briefly "Released"
      described as {
        |Release time.
      }
    }
  } with {
    briefly "Session spot released"
    described as {
      |Emitted when spot is released.
    }
  }
} with {
  option external()
  briefly "External session capacity"
  described as {
    |External session management service.
  }
}
