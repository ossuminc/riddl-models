// Media Buying - External Contexts

context MediaVendor is {

  query GetAvailableInventory is {
    channelType is ChannelType with { briefly "Channel" described by "Media channel." }
    targetAudience is String(3, 300) with { briefly "Audience" described by "Target audience." }
    flightStartDate is Date with { briefly "Start" described by "Flight start date." }
    flightEndDate is Date with { briefly "End" described by "Flight end date." }
  } with {
    briefly "Get available inventory"
    described by "Queries vendor for available ad inventory."
  }

  result AvailableInventory is {
    placements is many PlacementSpec with { briefly "Placements" described by "Available placements." }
    hasCapacity is Boolean with { briefly "Capacity" described by "Has available capacity." }
  } with {
    briefly "Available inventory"
    described by "Vendor inventory availability."
  }

  command SubmitInsertionOrder is {
    orderId is MediaOrderId with { briefly "Order" described by "Order ID." }
    insertionOrder is InsertionOrder with { briefly "IO" described by "Insertion order." }
  } with {
    briefly "Submit insertion order"
    described by "Submits insertion order to vendor."
  }

  event InsertionOrderAccepted is {
    orderId is MediaOrderId with { briefly "Order" described by "Order ID." }
    acceptedAt is TimeStamp with { briefly "Accepted" described by "Acceptance time." }
  } with {
    briefly "Insertion order accepted"
    described by "Emitted when vendor accepts insertion order."
  }

} with {
  option is external
  briefly "External media vendor"
  described by "Media vendor providing ad inventory."
}

context AnalyticsPlatform is {

  command SendPerformanceData is {
    orderId is MediaOrderId with { briefly "Order" described by "Order ID." }
    metrics is many PerformanceMetric with { briefly "Metrics" described by "Performance metrics." }
  } with {
    briefly "Send performance data"
    described by "Sends performance data to analytics."
  }

  event PerformanceDataReceived is {
    orderId is MediaOrderId with { briefly "Order" described by "Order ID." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Performance data received"
    described by "Emitted when analytics receives data."
  }

  query GetCampaignROI is {
    campaignId is CampaignId with { briefly "Campaign" described by "Campaign ID." }
  } with {
    briefly "Get campaign ROI"
    described by "Gets return on investment for a campaign."
  }

  result CampaignROI is {
    campaignId is CampaignId with { briefly "Campaign" described by "Campaign ID." }
    totalSpend is Decimal(12, 2) with { briefly "Spend" described by "Total media spend." }
    totalRevenue is Decimal(12, 2) with { briefly "Revenue" described by "Attributed revenue." }
    returnOnAdSpend is Decimal(8, 4) with { briefly "ROAS" described by "Return on ad spend." }
  } with {
    briefly "Campaign ROI"
    described by "Campaign return on investment metrics."
  }

} with {
  option is external
  briefly "External analytics platform"
  described by "Analytics platform for performance tracking."
}
