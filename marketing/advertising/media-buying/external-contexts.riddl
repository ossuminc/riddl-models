// Media Buying - External Contexts
context MediaVendor is {
  query GetAvailableInventory is  {
    channelType: ChannelType with {
      briefly "Channel"
      described as {
        |Media channel.
      }
    }
    targetAudience: String(3,300) with {
      briefly "Audience"
      described as {
        |Target audience.
      }
    }
    flightStartDate: Date with {
      briefly "Start"
      described as {
        |Flight start date.
      }
    }
    flightEndDate: Date with {
      briefly "End"
      described as {
        |Flight end date.
      }
    }
  } with {
    briefly "Get available inventory"
    described as {
      |Queries vendor for available ad inventory.
    }
  }
  result AvailableInventory is  {
    placements: PlacementSpec+ with {
      briefly "Placements"
      described as {
        |Available placements.
      }
    }
    hasCapacity: Boolean with {
      briefly "Capacity"
      described as {
        |Has available capacity.
      }
    }
  } with {
    briefly "Available inventory"
    described as {
      |Vendor inventory availability.
    }
  }
  command SubmitInsertionOrder is  {
    orderId: MediaOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    insertionOrder: InsertionOrder with {
      briefly "IO"
      described as {
        |Insertion order.
      }
    }
  } with {
    briefly "Submit insertion order"
    described as {
      |Submits insertion order to vendor.
    }
  }
  event InsertionOrderAccepted is  {
    orderId: MediaOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    acceptedAt: TimeStamp with {
      briefly "Accepted"
      described as {
        |Acceptance time.
      }
    }
  } with {
    briefly "Insertion order accepted"
    described as {
      |Emitted when vendor accepts insertion order.
    }
  }
} with {
  option external()
  briefly "External media vendor"
  described as {
    |Media vendor providing ad inventory.
  }
}
context AnalyticsPlatform is {
  command SendPerformanceData is  {
    orderId: MediaOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    metrics: PerformanceMetric+ with {
      briefly "Metrics"
      described as {
        |Performance metrics.
      }
    }
  } with {
    briefly "Send performance data"
    described as {
      |Sends performance data to analytics.
    }
  }
  event PerformanceDataReceived is  {
    orderId: MediaOrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Receipt time.
      }
    }
  } with {
    briefly "Performance data received"
    described as {
      |Emitted when analytics receives data.
    }
  }
  query GetCampaignROI is  {
    campaignId: CampaignId with {
      briefly "Campaign"
      described as {
        |Campaign ID.
      }
    }
  } with {
    briefly "Get campaign ROI"
    described as {
      |Gets return on investment for a campaign.
    }
  }
  result CampaignROI is  {
    campaignId: CampaignId with {
      briefly "Campaign"
      described as {
        |Campaign ID.
      }
    }
    totalSpend: Decimal(12,2) with {
      briefly "Spend"
      described as {
        |Total media spend.
      }
    }
    totalRevenue: Decimal(12,2) with {
      briefly "Revenue"
      described as {
        |Attributed revenue.
      }
    }
    returnOnAdSpend: Decimal(8,4) with {
      briefly "ROAS"
      described as {
        |Return on ad spend.
      }
    }
  } with {
    briefly "Campaign ROI"
    described as {
      |Campaign return on investment metrics.
    }
  }
} with {
  option external()
  briefly "External analytics platform"
  described as {
    |Analytics platform for performance tracking.
  }
}
