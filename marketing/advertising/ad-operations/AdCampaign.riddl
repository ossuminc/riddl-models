// Ad Operations - AdCampaign Entity

entity AdCampaign is {

  command CreateCampaign is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "New campaign identifier."
    }
    campaignInfo is CampaignInfo with {
      briefly "Campaign info"
      described by "Campaign details."
    }
  } with {
    briefly "Create campaign"
    described by "Creates a new ad campaign."
  }

  command SubmitCampaign is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    submittedBy is String(3, 100) with {
      briefly "Submitted by"
      described by "Person submitting campaign."
    }
  } with {
    briefly "Submit campaign"
    described by "Submits campaign for approval."
  }

  command ApproveCampaign is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    approvedBy is String(3, 100) with {
      briefly "Approved by"
      described by "Person approving campaign."
    }
  } with {
    briefly "Approve campaign"
    described by "Approves campaign for trafficking."
  }

  command AttachCreative is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    creative is CreativeAsset with {
      briefly "Creative"
      described by "Creative asset to attach."
    }
  } with {
    briefly "Attach creative"
    described by "Attaches a creative asset to the campaign."
  }

  command SchedulePlacement is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    placement is AdPlacement with {
      briefly "Placement"
      described by "Ad placement to schedule."
    }
  } with {
    briefly "Schedule placement"
    described by "Schedules an ad placement for the campaign."
  }

  command LaunchCampaign is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    launchedAt is TimeStamp with {
      briefly "Launched"
      described by "Launch timestamp."
    }
  } with {
    briefly "Launch campaign"
    described by "Launches campaign to go live."
  }

  command RecordPerformance is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    metric is PerformanceMetric with {
      briefly "Metric"
      described by "Performance metric data."
    }
  } with {
    briefly "Record performance"
    described by "Records ad performance metrics."
  }

  command PauseCampaign is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    reason is String(3, 500) with {
      briefly "Reason"
      described by "Pause reason."
    }
  } with {
    briefly "Pause campaign"
    described by "Pauses a live campaign."
  }

  command CompleteCampaign is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    completedAt is TimeStamp with {
      briefly "Completed"
      described by "Completion timestamp."
    }
  } with {
    briefly "Complete campaign"
    described by "Marks campaign as completed."
  }

  command CancelCampaign is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    reason is String(3, 500) with {
      briefly "Reason"
      described by "Cancellation reason."
    }
  } with {
    briefly "Cancel campaign"
    described by "Cancels an ad campaign."
  }

  command GenerateInvoice is {
    campaignId is AdCampaignId with {
      briefly "Campaign ID"
      described by "Campaign identifier."
    }
    billingRecord is BillingRecord with {
      briefly "Billing"
      described by "Billing record details."
    }
  } with {
    briefly "Generate invoice"
    described by "Generates billing invoice for the campaign."
  }

  // Events
  event CampaignCreated is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    campaignInfo is CampaignInfo with { briefly "Info" described by "Campaign info." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Campaign created"
    described by "Emitted when campaign is created."
  }

  event CampaignSubmitted is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submission time." }
  } with {
    briefly "Campaign submitted"
    described by "Emitted when campaign is submitted for approval."
  }

  event CampaignApproved is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    approvedAt is TimeStamp with { briefly "Approved" described by "Approval time." }
  } with {
    briefly "Campaign approved"
    described by "Emitted when campaign is approved."
  }

  event CreativeAttached is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    creativeId is CreativeId with { briefly "Creative" described by "Creative ID." }
    attachedAt is TimeStamp with { briefly "Attached" described by "Attachment time." }
  } with {
    briefly "Creative attached"
    described by "Emitted when creative is attached to campaign."
  }

  event PlacementScheduled is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    placementId is PlacementId with { briefly "Placement" described by "Placement ID." }
    scheduledAt is TimeStamp with { briefly "Scheduled" described by "Scheduling time." }
  } with {
    briefly "Placement scheduled"
    described by "Emitted when ad placement is scheduled."
  }

  event CampaignLaunched is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    launchedAt is TimeStamp with { briefly "Launched" described by "Launch time." }
  } with {
    briefly "Campaign launched"
    described by "Emitted when campaign goes live."
  }

  event PerformanceRecorded is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    metric is PerformanceMetric with { briefly "Metric" described by "Performance data." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Performance recorded"
    described by "Emitted when performance metrics are recorded."
  }

  event CampaignPaused is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    reason is String(3, 500) with { briefly "Reason" described by "Pause reason." }
    pausedAt is TimeStamp with { briefly "Paused" described by "Pause time." }
  } with {
    briefly "Campaign paused"
    described by "Emitted when campaign is paused."
  }

  event CampaignCompleted is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Campaign completed"
    described by "Emitted when campaign is completed."
  }

  event CampaignCancelled is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    reason is String(3, 500) with { briefly "Reason" described by "Cancel reason." }
    cancelledAt is TimeStamp with { briefly "Cancelled" described by "Cancel time." }
  } with {
    briefly "Campaign cancelled"
    described by "Emitted when campaign is cancelled."
  }

  event InvoiceGenerated is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    invoiceId is UUID with { briefly "Invoice" described by "Invoice ID." }
    totalAmount is Decimal(12, 2) with { briefly "Amount" described by "Invoice amount." }
    generatedAt is TimeStamp with { briefly "Generated" described by "Generation time." }
  } with {
    briefly "Invoice generated"
    described by "Emitted when billing invoice is generated."
  }

  // States
  record ActiveStateData is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    campaignInfo is CampaignInfo with { briefly "Info" described by "Campaign info." }
    status is CampaignStatus with { briefly "Status" described by "Campaign status." }
    creatives is many optional CreativeAsset with { briefly "Creatives" described by "Creative assets." }
    placements is many optional AdPlacement with { briefly "Placements" described by "Ad placements." }
    metrics is many optional PerformanceMetric with { briefly "Metrics" described by "Performance metrics." }
    billingRecords is many optional BillingRecord with { briefly "Billing" described by "Billing records." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Active campaign state"
    described by "State for an active ad campaign."
  }

  record CompletedStateData is {
    campaignId is AdCampaignId with { briefly "Campaign" described by "Campaign ID." }
    totalSpend is Decimal(12, 2) with { briefly "Total spend" described by "Total campaign spend." }
    totalImpressions is Natural with { briefly "Impressions" described by "Total impressions served." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Completed campaign state"
    described by "State for a completed campaign."
  }

  state ActiveState of AdCampaign.ActiveStateData with {
    briefly "Campaign active"
    described by "Ad campaign is being processed or live."
  }

  state CompletedState of AdCampaign.CompletedStateData with {
    briefly "Campaign completed"
    described by "Ad campaign has finished."
  }

  handler AdCampaignHandler is {
    on command CreateCampaign {
      morph entity AdOpsContext.AdCampaign to state AdOpsContext.AdCampaign.ActiveState with command CreateCampaign
      tell event CampaignCreated to entity AdOpsContext.AdCampaign
    }
    on command SubmitCampaign {
      tell event CampaignSubmitted to entity AdOpsContext.AdCampaign
    }
    on command ApproveCampaign {
      tell event CampaignApproved to entity AdOpsContext.AdCampaign
    }
    on command AttachCreative {
      tell event CreativeAttached to entity AdOpsContext.AdCampaign
    }
    on command SchedulePlacement {
      tell event PlacementScheduled to entity AdOpsContext.AdCampaign
    }
    on command LaunchCampaign {
      tell event CampaignLaunched to entity AdOpsContext.AdCampaign
    }
    on command RecordPerformance {
      tell event PerformanceRecorded to entity AdOpsContext.AdCampaign
    }
    on command PauseCampaign {
      tell event CampaignPaused to entity AdOpsContext.AdCampaign
    }
    on command CompleteCampaign {
      morph entity AdOpsContext.AdCampaign to state AdOpsContext.AdCampaign.CompletedState with command CompleteCampaign
      tell event CampaignCompleted to entity AdOpsContext.AdCampaign
    }
    on command CancelCampaign {
      tell event CampaignCancelled to entity AdOpsContext.AdCampaign
    }
    on command GenerateInvoice {
      tell event InvoiceGenerated to entity AdOpsContext.AdCampaign
    }
  } with {
    briefly "Processes ad campaign commands"
    described by "Handles ad campaign lifecycle."
  }

} with {
  briefly "AdCampaign aggregate"
  described by "Manages ad campaign trafficking and operations."
}
