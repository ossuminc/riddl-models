// Ad Operations - AdOps Context
context AdOpsContext is {
  include "types.riddl"
  include "AdCampaign.riddl"
  repository AdOpsRepository is {
    schema AdOpsData is relational
      of adCampaigns as type AdCampaign
        index on field AdCampaign.campaignId
        index on field AdCampaign.campaignInfo.advertiserId
        index on field AdCampaign.status

    handler AdOpsPersistence is {
      on command AdCampaign.CreateCampaign is {
        prompt "Store new ad campaign"
      }
      on command AdCampaign.ApproveCampaign is {
        prompt "Update campaign to approved"
      }
      on command AdCampaign.AttachCreative is {
        prompt "Store creative attachment"
      }
      on command AdCampaign.SchedulePlacement is {
        prompt "Store placement schedule"
      }
      on command AdCampaign.LaunchCampaign is {
        prompt "Update campaign to live"
      }
      on command AdCampaign.RecordPerformance is {
        prompt "Store performance metrics"
      }
      on command AdCampaign.CompleteCampaign is {
        prompt "Update campaign to completed"
      }
    } with {
      briefly "Persists ad ops events"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Ad ops data persistence"
    described as {
      |Persistent storage for ad operations.
    }
  }
  projector CampaignPerformance is {
    record CampaignMetrics is  {
      campaignsCreated: Natural with {
        briefly "Created"
        described as {
          |Campaigns created.
        }
      }
      campaignsLive: Natural with {
        briefly "Live"
        described as {
          |Campaigns currently live.
        }
      }
      campaignsCompleted: Natural with {
        briefly "Completed"
        described as {
          |Campaigns completed.
        }
      }
      totalImpressions: Natural with {
        briefly "Impressions"
        described as {
          |Total impressions served.
        }
      }
      totalClicks: Natural with {
        briefly "Clicks"
        described as {
          |Total clicks recorded.
        }
      }
      aggregateTotalSpend: Decimal(14,2) with {
        briefly "Spend"
        described as {
          |Total ad spend.
        }
      }
    } with {
      briefly "Campaign metrics"
      described as {
        |Aggregate campaign performance metrics.
      }
    }
    handler PerformanceHandler is {
      on event AdCampaign.CampaignCreated is {
        prompt "Increment campaigns created"
      }
      on event AdCampaign.CampaignLaunched is {
        prompt "Increment campaigns live"
      }
      on event AdCampaign.PerformanceRecorded is {
        prompt "Accumulate impressions clicks and spend"
      }
      on event AdCampaign.CampaignCompleted is {
        prompt "Decrement live and increment completed"
      }
    } with {
      briefly "Maintains campaign performance metrics"
      described as {
        |Projects events into performance analytics.
      }
    }
  } with {
    briefly "Campaign performance projector"
    described as {
      |Ad campaign performance analytics.
    }
  }
} with {
  briefly "Bounded context for ad operations"
  described as {
    |Ad operations bounded context for campaign trafficking and management.
  }
}
