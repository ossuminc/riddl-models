// Ad Operations - AdOps Context

context AdOpsContext is {

  include "types.riddl"
  include "AdCampaign.riddl"

  repository AdOpsRepository is {
    schema AdOpsData is relational
      of adCampaigns as AdCampaign
      index on field AdCampaign.campaignId
      index on field AdCampaign.campaignInfo.advertiserId
      index on field AdCampaign.status

    handler AdOpsPersistence is {
      on command AdCampaign.CreateCampaign {
        prompt "Store new ad campaign"
      }
      on command AdCampaign.ApproveCampaign {
        prompt "Update campaign to approved"
      }
      on command AdCampaign.AttachCreative {
        prompt "Store creative attachment"
      }
      on command AdCampaign.SchedulePlacement {
        prompt "Store placement schedule"
      }
      on command AdCampaign.LaunchCampaign {
        prompt "Update campaign to live"
      }
      on command AdCampaign.RecordPerformance {
        prompt "Store performance metrics"
      }
      on command AdCampaign.CompleteCampaign {
        prompt "Update campaign to completed"
      }
    } with {
      briefly "Persists ad ops events"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Ad ops data persistence"
    described by "Persistent storage for ad operations."
  }

  projector CampaignPerformance is {
    updates repository AdOpsRepository

    record CampaignMetrics is {
      campaignsCreated is Natural with { briefly "Created" described by "Campaigns created." }
      campaignsLive is Natural with { briefly "Live" described by "Campaigns currently live." }
      campaignsCompleted is Natural with { briefly "Completed" described by "Campaigns completed." }
      totalImpressions is Natural with { briefly "Impressions" described by "Total impressions served." }
      totalClicks is Natural with { briefly "Clicks" described by "Total clicks recorded." }
      totalSpend is Decimal(14, 2) with { briefly "Spend" described by "Total ad spend." }
    } with {
      briefly "Campaign metrics"
      described by "Aggregate campaign performance metrics."
    }

    handler PerformanceHandler is {
      on event AdCampaign.CampaignCreated {
        prompt "Increment campaigns created"
      }
      on event AdCampaign.CampaignLaunched {
        prompt "Increment campaigns live"
      }
      on event AdCampaign.PerformanceRecorded {
        prompt "Accumulate impressions clicks and spend"
      }
      on event AdCampaign.CampaignCompleted {
        prompt "Decrement live and increment completed"
      }
    } with {
      briefly "Maintains campaign performance metrics"
      described by "Projects events into performance analytics."
    }
  } with {
    briefly "Campaign performance projector"
    described by "Ad campaign performance analytics."
  }

} with {
  briefly "Bounded context for ad operations"
  described by "Ad operations bounded context for campaign trafficking and management."
}
