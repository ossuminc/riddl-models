// Ad Serving - External Contexts

context AdExchange is {

  query GetBidRequest is {
    placementId is PlacementId with { briefly "Placement" described by "Placement ID." }
    userContext is String(1, 2000) with { briefly "Context" described by "User context." }
  } with {
    briefly "Get bid request"
    described by "Gets bid request from exchange."
  }

  result BidRequest is {
    requestId is UUID with { briefly "Request" described by "Request ID." }
    placementId is PlacementId with { briefly "Placement" described by "Placement ID." }
    requestFloorPrice is Decimal(10, 4) with { briefly "Floor" described by "Floor price." }
    impressionContext is String(1, 2000) with { briefly "Context" described by "Impression context." }
  } with {
    briefly "Bid request"
    described by "RTB bid request."
  }

  command SubmitBid is {
    requestId is UUID with { briefly "Request" described by "Request ID." }
    adId is AdId with { briefly "Ad" described by "Ad ID." }
    bidPrice is Decimal(10, 4) with { briefly "Bid" described by "Bid price." }
    adMarkup is String(1, 5000) with { briefly "Markup" described by "Ad markup." }
  } with {
    briefly "Submit bid"
    described by "Submits RTB bid."
  }

  event BidWon is {
    requestId is UUID with { briefly "Request" described by "Request ID." }
    adId is AdId with { briefly "Ad" described by "Ad ID." }
    winPrice is Decimal(10, 4) with { briefly "Price" described by "Winning price." }
  } with {
    briefly "Bid won"
    described by "Emitted when bid wins."
  }

} with {
  option is external
  briefly "External ad exchange"
  described by "Real-time bidding exchange."
}

context CDN is {

  command CacheCreative is {
    creativeId is CreativeId with { briefly "Creative" described by "Creative ID." }
    assetUrl is URL with { briefly "URL" described by "Asset URL." }
    regions is many String(1, 50) with { briefly "Regions" described by "Cache regions." }
  } with {
    briefly "Cache creative"
    described by "Caches creative on CDN."
  }

  event CreativeCached is {
    creativeId is CreativeId with { briefly "Creative" described by "Creative ID." }
    cdnUrl is URL with { briefly "CDN URL" described by "CDN URL." }
    cachedAt is TimeStamp with { briefly "Cached" described by "Cache time." }
  } with {
    briefly "Creative cached"
    described by "Emitted when cached."
  }

  command PurgeCreative is {
    creativeId is CreativeId with { briefly "Creative" described by "Creative ID." }
  } with {
    briefly "Purge creative"
    described by "Purges creative from CDN."
  }

} with {
  option is external
  briefly "External CDN"
  described by "Content delivery network."
}

context DataManagementPlatform is {

  query GetAudienceSegments is {
    userId is String(1, 100) with { briefly "User" described by "User identifier." }
  } with {
    briefly "Get audience segments"
    described by "Gets user's audience segments."
  }

  result AudienceSegments is {
    userId is String(1, 100) with { briefly "User" described by "User ID." }
    segments is many String(1, 100) with { briefly "Segments" described by "Audience segments." }
    recency is Natural with { briefly "Recency" described by "Data recency days." }
  } with {
    briefly "Audience segments"
    described by "User audience data."
  }

  command SyncConversion is {
    conversionId is UUID with { briefly "Conversion" described by "Conversion ID." }
    userId is String(1, 100) with { briefly "User" described by "User ID." }
    conversionType is String(1, 50) with { briefly "Type" described by "Conversion type." }
    value is Decimal(10, 2) with { briefly "Value" described by "Conversion value." }
  } with {
    briefly "Sync conversion"
    described by "Syncs conversion to DMP."
  }

} with {
  option is external
  briefly "External DMP"
  described by "Data management platform."
}

context AdVerification is {

  command VerifyImpression is {
    impressionId is UUID with { briefly "Impression" described by "Impression ID." }
    adId is AdId with { briefly "Ad" described by "Ad ID." }
    pageUrl is URL with { briefly "URL" described by "Page URL." }
  } with {
    briefly "Verify impression"
    described by "Verifies impression validity."
  }

  result VerificationResult is {
    impressionId is UUID with { briefly "Impression" described by "Impression ID." }
    viewable is Boolean with { briefly "Viewable" described by "Was viewable." }
    brandSafe is Boolean with { briefly "Brand safe" described by "Brand safe." }
    humanTraffic is Boolean with { briefly "Human" described by "Human traffic." }
    viewabilityScore is Decimal(5, 2) with { briefly "Score" described by "Viewability score." }
  } with {
    briefly "Verification result"
    described by "Impression verification result."
  }

} with {
  option is external
  briefly "External ad verification"
  described by "Ad verification service."
}
