// Social Media Management - Social Context

context SocialContext is {

  include "types.riddl"
  include "SocialPost.riddl"

  repository SocialRepository is {
    schema PostData is relational
      of posts as SocialPost
      index on field SocialPost.status
      index on field SocialPost.contentType
      index on field SocialPost.schedule.scheduledTime

    handler PostPersistence is {
      on command SocialPost.CreatePost {
        prompt "Store new post record"
      }
      on command SocialPost.UpdateContent {
        prompt "Update post content"
      }
      on command SocialPost.SchedulePost {
        prompt "Store schedule information"
      }
      on command SocialPost.RecordPublishResult {
        prompt "Store publish result"
      }
      on command SocialPost.UpdateEngagement {
        prompt "Store engagement metrics"
      }
      on command SocialPost.AddComment {
        prompt "Store comment"
      }
      on command SocialPost.DeletePost {
        prompt "Mark post as deleted"
      }
    } with {
      briefly "Persists post commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Social data persistence"
    described by "Persistent storage for posts."
  }

  projector SocialAnalytics is {
    updates repository SocialRepository

    record SocialMetrics is {
      totalPosts is Natural with { briefly "Posts" described by "Total posts." }
      scheduledPosts is Natural with { briefly "Scheduled" described by "Scheduled posts." }
      totalEngagement is Natural with { briefly "Engagement" described by "Total engagement." }
      averageEngagementRate is Decimal(5, 2) with { briefly "Rate" described by "Avg rate." }
      topPlatform is String(1, 20) with { briefly "Top" described by "Best performing." }
      totalReach is Natural with { briefly "Reach" described by "Total reach." }
    } with {
      briefly "Social metrics"
      described by "Social media metrics."
    }

    handler AnalyticsHandler is {
      on event SocialPost.PostCreated {
        prompt "Increment post count"
      }
      on event SocialPost.PostScheduled {
        prompt "Track scheduled posts"
      }
      on event SocialPost.PublishResultRecorded {
        prompt "Update publish statistics"
      }
      on event SocialPost.EngagementUpdated {
        prompt "Aggregate engagement"
      }
    } with {
      briefly "Maintains social analytics"
      described by "Projects events into metrics."
    }
  } with {
    briefly "Social analytics"
    described by "Social media performance."
  }

} with {
  briefly "Bounded context for social media"
  described by "Social content management context."
}
