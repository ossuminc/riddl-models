// Marketing Automation - External Contexts

context EmailDelivery is {

  command SendEmail is {
    recipientId is LeadId with { briefly "Recipient" described by "Recipient lead ID." }
    subject is String(3, 200) with { briefly "Subject" described by "Email subject line." }
    contentBody is String(3, 10000) with { briefly "Content" described by "Email body content." }
    channel is ChannelType with { briefly "Channel" described by "Delivery channel." }
    testVariant is optional TestVariant with { briefly "Variant" described by "A/B test variant." }
  } with {
    briefly "Send email"
    described by "Sends an email through the delivery system."
  }

  event EmailDelivered is {
    recipientId is LeadId with { briefly "Recipient" described by "Recipient lead ID." }
    deliveredAt is TimeStamp with { briefly "Delivered" described by "Delivery timestamp." }
    success is Boolean with { briefly "Success" described by "Delivery success." }
  } with {
    briefly "Email delivered"
    described by "Emitted when an email is delivered."
  }

  event EmailOpened is {
    recipientId is LeadId with { briefly "Recipient" described by "Recipient lead ID." }
    openedAt is TimeStamp with { briefly "Opened" described by "Open timestamp." }
  } with {
    briefly "Email opened"
    described by "Emitted when an email is opened."
  }

  event LinkClicked is {
    recipientId is LeadId with { briefly "Recipient" described by "Recipient lead ID." }
    linkUrl is URL with { briefly "URL" described by "Clicked link URL." }
    clickedAt is TimeStamp with { briefly "Clicked" described by "Click timestamp." }
  } with {
    briefly "Link clicked"
    described by "Emitted when a link in an email is clicked."
  }

  query GetDeliveryStatus is {
    recipientId is LeadId with { briefly "Recipient" described by "Recipient lead ID." }
  } with {
    briefly "Get delivery status"
    described by "Gets email delivery status for a recipient."
  }

  result DeliveryStatus is {
    recipientId is LeadId with { briefly "Recipient" described by "Recipient lead ID." }
    delivered is Boolean with { briefly "Delivered" described by "Was delivered." }
    opened is Boolean with { briefly "Opened" described by "Was opened." }
    clicked is Boolean with { briefly "Clicked" described by "Had link clicks." }
  } with {
    briefly "Delivery status"
    described by "Email delivery status."
  }

} with {
  option is external
  briefly "External email delivery system"
  described by "Email delivery and tracking service."
}

context CRMSystem is {

  query GetLeadInfo is {
    leadId is LeadId with { briefly "Lead" described by "Lead ID." }
  } with {
    briefly "Get lead info"
    described by "Gets lead information from CRM."
  }

  result LeadInfo is {
    leadId is LeadId with { briefly "Lead" described by "Lead ID." }
    email is String(3, 254) with { briefly "Email" described by "Lead email address." }
    firstName is String(3, 100) with { briefly "First name" described by "Lead first name." }
    lastName is String(3, 100) with { briefly "Last name" described by "Lead last name." }
    leadScore is Natural with { briefly "Score" described by "Lead score." }
  } with {
    briefly "Lead info"
    described by "Lead information from CRM."
  }

  command UpdateLeadScore is {
    leadId is LeadId with { briefly "Lead" described by "Lead ID." }
    newScore is Natural with { briefly "Score" described by "Updated lead score." }
    reason is String(3, 300) with { briefly "Reason" described by "Score change reason." }
  } with {
    briefly "Update lead score"
    described by "Updates lead score in CRM."
  }

  event LeadScoreUpdated is {
    leadId is LeadId with { briefly "Lead" described by "Lead ID." }
    newScore is Natural with { briefly "Score" described by "New lead score." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update timestamp." }
  } with {
    briefly "Lead score updated"
    described by "Emitted when lead score is updated."
  }

  query GetSegmentMembers is {
    segmentId is SegmentId with { briefly "Segment" described by "Segment ID." }
  } with {
    briefly "Get segment members"
    described by "Gets leads in a segment."
  }

  result SegmentMembers is {
    segmentId is SegmentId with { briefly "Segment" described by "Segment ID." }
    leadIds is many LeadId with { briefly "Leads" described by "Lead identifiers." }
    totalCount is Natural with { briefly "Count" described by "Total member count." }
  } with {
    briefly "Segment members"
    described by "Leads belonging to a segment."
  }

} with {
  option is external
  briefly "External CRM system"
  described by "Customer relationship management system."
}
