// Marketing Automation - External Contexts
context EmailDelivery is {
  command SendEmail is  {
    recipientId: LeadId with {
      briefly "Recipient"
      described as {
        |Recipient lead ID.
      }
    }
    subject: String(3,200) with {
      briefly "Subject"
      described as {
        |Email subject line.
      }
    }
    contentBody: String(3,10000) with {
      briefly "Content"
      described as {
        |Email body content.
      }
    }
    channel: ChannelType with {
      briefly "Channel"
      described as {
        |Delivery channel.
      }
    }
    testVariant: TestVariant? with {
      briefly "Variant"
      described as {
        |A/B test variant.
      }
    }
  } with {
    briefly "Send email"
    described as {
      |Sends an email through the delivery system.
    }
  }
  event EmailDelivered is  {
    recipientId: LeadId with {
      briefly "Recipient"
      described as {
        |Recipient lead ID.
      }
    }
    deliveredAt: TimeStamp with {
      briefly "Delivered"
      described as {
        |Delivery timestamp.
      }
    }
    success: Boolean with {
      briefly "Success"
      described as {
        |Delivery success.
      }
    }
  } with {
    briefly "Email delivered"
    described as {
      |Emitted when an email is delivered.
    }
  }
  event EmailOpened is  {
    recipientId: LeadId with {
      briefly "Recipient"
      described as {
        |Recipient lead ID.
      }
    }
    openedAt: TimeStamp with {
      briefly "Opened"
      described as {
        |Open timestamp.
      }
    }
  } with {
    briefly "Email opened"
    described as {
      |Emitted when an email is opened.
    }
  }
  event LinkClicked is  {
    recipientId: LeadId with {
      briefly "Recipient"
      described as {
        |Recipient lead ID.
      }
    }
    linkUrl: URL with {
      briefly "URL"
      described as {
        |Clicked link URL.
      }
    }
    clickedAt: TimeStamp with {
      briefly "Clicked"
      described as {
        |Click timestamp.
      }
    }
  } with {
    briefly "Link clicked"
    described as {
      |Emitted when a link in an email is clicked.
    }
  }
  query GetDeliveryStatus is  {
    recipientId: LeadId with {
      briefly "Recipient"
      described as {
        |Recipient lead ID.
      }
    }
  } with {
    briefly "Get delivery status"
    described as {
      |Gets email delivery status for a recipient.
    }
  }
  result DeliveryStatus is  {
    recipientId: LeadId with {
      briefly "Recipient"
      described as {
        |Recipient lead ID.
      }
    }
    delivered: Boolean with {
      briefly "Delivered"
      described as {
        |Was delivered.
      }
    }
    opened: Boolean with {
      briefly "Opened"
      described as {
        |Was opened.
      }
    }
    clicked: Boolean with {
      briefly "Clicked"
      described as {
        |Had link clicks.
      }
    }
  } with {
    briefly "Delivery status"
    described as {
      |Email delivery status.
    }
  }
} with {
  option external()
  briefly "External email delivery system"
  described as {
    |Email delivery and tracking service.
  }
}
context CRMSystem is {
  query GetLeadInfo is  {
    leadId: LeadId with {
      briefly "Lead"
      described as {
        |Lead ID.
      }
    }
  } with {
    briefly "Get lead info"
    described as {
      |Gets lead information from CRM.
    }
  }
  result LeadInfo is  {
    leadId: LeadId with {
      briefly "Lead"
      described as {
        |Lead ID.
      }
    }
    email: String(3,254) with {
      briefly "Email"
      described as {
        |Lead email address.
      }
    }
    firstName: String(3,100) with {
      briefly "First name"
      described as {
        |Lead first name.
      }
    }
    lastName: String(3,100) with {
      briefly "Last name"
      described as {
        |Lead last name.
      }
    }
    leadScore: Natural with {
      briefly "Score"
      described as {
        |Lead score.
      }
    }
  } with {
    briefly "Lead info"
    described as {
      |Lead information from CRM.
    }
  }
  command UpdateLeadScore is  {
    leadId: LeadId with {
      briefly "Lead"
      described as {
        |Lead ID.
      }
    }
    newScore: Natural with {
      briefly "Score"
      described as {
        |Updated lead score.
      }
    }
    reason: String(3,300) with {
      briefly "Reason"
      described as {
        |Score change reason.
      }
    }
  } with {
    briefly "Update lead score"
    described as {
      |Updates lead score in CRM.
    }
  }
  event LeadScoreUpdated is  {
    leadId: LeadId with {
      briefly "Lead"
      described as {
        |Lead ID.
      }
    }
    newScore: Natural with {
      briefly "Score"
      described as {
        |New lead score.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update timestamp.
      }
    }
  } with {
    briefly "Lead score updated"
    described as {
      |Emitted when lead score is updated.
    }
  }
  query GetSegmentMembers is  {
    segmentId: SegmentId with {
      briefly "Segment"
      described as {
        |Segment ID.
      }
    }
  } with {
    briefly "Get segment members"
    described as {
      |Gets leads in a segment.
    }
  }
  result SegmentMembers is  {
    segmentId: SegmentId with {
      briefly "Segment"
      described as {
        |Segment ID.
      }
    }
    leadIds: LeadId+ with {
      briefly "Leads"
      described as {
        |Lead identifiers.
      }
    }
    totalCount: Natural with {
      briefly "Count"
      described as {
        |Total member count.
      }
    }
  } with {
    briefly "Segment members"
    described as {
      |Leads belonging to a segment.
    }
  }
} with {
  option external()
  briefly "External CRM system"
  described as {
    |Customer relationship management system.
  }
}
