// Email Marketing - Email Context
context EmailContext is {
  include "types.riddl"
  include "EmailCampaign.riddl"
  repository EmailRepository is {
    schema CampaignData is relational
      of campaigns as type EmailCampaign
        index on field EmailCampaign.status
        index on field EmailCampaign.campaignType
        index on field EmailCampaign.createdAt

    handler CampaignPersistence is {
      on command EmailCampaign.CreateCampaign is {
        prompt "Store new campaign record"
      }
      on command EmailCampaign.SetAudience is {
        prompt "Store audience configuration"
      }
      on command EmailCampaign.UpdateTemplate is {
        prompt "Update email template"
      }
      on command EmailCampaign.ScheduleCampaign is {
        prompt "Store schedule information"
      }
      on command EmailCampaign.SendImmediately is {
        prompt "Update status to sending"
      }
      on command EmailCampaign.RecordDelivery is {
        prompt "Store delivery metrics"
      }
      on command EmailCampaign.RecordEngagement is {
        prompt "Store engagement event"
      }
      on command EmailCampaign.CompleteCampaign is {
        prompt "Archive completed campaign"
      }
    } with {
      briefly "Persists campaign commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Email data persistence"
    described as {
      |Persistent storage for campaigns.
    }
  }
  projector CampaignAnalytics is {
    record EmailMetrics is  {
      totalCampaigns: Natural with {
        briefly "Total"
        described as {
          |Total campaigns.
        }
      }
      activeCampaigns: Natural with {
        briefly "Active"
        described as {
          |Active campaigns.
        }
      }
      averageOpenRate: Decimal(5,2) with {
        briefly "Open rate"
        described as {
          |Avg open rate.
        }
      }
      averageClickRate: Decimal(5,2) with {
        briefly "Click rate"
        described as {
          |Avg click rate.
        }
      }
      totalSent: Natural with {
        briefly "Sent"
        described as {
          |Total emails sent.
        }
      }
      totalOpened: Natural with {
        briefly "Opened"
        described as {
          |Total opens.
        }
      }
    } with {
      briefly "Email metrics"
      described as {
        |Email marketing metrics.
      }
    }
    handler AnalyticsHandler is {
      on event EmailCampaign.CampaignCreated is {
        prompt "Increment campaign count"
      }
      on event EmailCampaign.CampaignSending is {
        prompt "Track active campaigns"
      }
      on event EmailCampaign.DeliveryRecorded is {
        prompt "Update delivery totals"
      }
      on event EmailCampaign.CampaignCompleted is {
        prompt "Calculate campaign performance"
      }
    } with {
      briefly "Maintains email analytics"
      described as {
        |Projects events into metrics.
      }
    }
  } with {
    briefly "Campaign analytics"
    described as {
      |Email marketing performance.
    }
  }
} with {
  briefly "Bounded context for email marketing"
  described as {
    |Email campaign management context.
  }
}
