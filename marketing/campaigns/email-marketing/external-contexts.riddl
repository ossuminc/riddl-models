// Email Marketing - External Contexts
context EmailDeliveryService is {
  command SendEmail is  {
    campaignId: EmailCampaignId with {
      briefly "Campaign"
      described as {
        |Campaign ID.
      }
    }
    recipientEmail: EmailAddress with {
      briefly "Email"
      described as {
        |Recipient email.
      }
    }
    template: EmailTemplate with {
      briefly "Template"
      described as {
        |Email template.
      }
    }
    personalizationData: String(1,10000) with {
      briefly "Data"
      described as {
        |Personalization JSON.
      }
    }
  } with {
    briefly "Send email"
    described as {
      |Sends individual email.
    }
  }
  event EmailSent is  {
    campaignId: EmailCampaignId with {
      briefly "Campaign"
      described as {
        |Campaign ID.
      }
    }
    messageId: String(1,100) with {
      briefly "Message"
      described as {
        |Message ID.
      }
    }
    recipientEmail: EmailAddress with {
      briefly "Email"
      described as {
        |Recipient.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Email sent"
    described as {
      |Emitted when email sent.
    }
  }
  event EmailBounced is  {
    campaignId: EmailCampaignId with {
      briefly "Campaign"
      described as {
        |Campaign ID.
      }
    }
    messageId: String(1,100) with {
      briefly "Message"
      described as {
        |Message ID.
      }
    }
    recipientEmail: EmailAddress with {
      briefly "Email"
      described as {
        |Recipient.
      }
    }
    bounceType: String(1,20) with {
      briefly "Type"
      described as {
        |Hard or soft bounce.
      }
    }
    bounceReason: String(1,500) with {
      briefly "Reason"
      described as {
        |Bounce reason.
      }
    }
  } with {
    briefly "Email bounced"
    described as {
      |Emitted when email bounces.
    }
  }
  event EmailOpened is  {
    campaignId: EmailCampaignId with {
      briefly "Campaign"
      described as {
        |Campaign ID.
      }
    }
    messageId: String(1,100) with {
      briefly "Message"
      described as {
        |Message ID.
      }
    }
    openedAt: TimeStamp with {
      briefly "Opened"
      described as {
        |Open time.
      }
    }
    userAgent: String(1,500)? with {
      briefly "Agent"
      described as {
        |User agent.
      }
    }
  } with {
    briefly "Email opened"
    described as {
      |Emitted when email opened.
    }
  }
  event LinkClicked is  {
    campaignId: EmailCampaignId with {
      briefly "Campaign"
      described as {
        |Campaign ID.
      }
    }
    messageId: String(1,100) with {
      briefly "Message"
      described as {
        |Message ID.
      }
    }
    url: URL with {
      briefly "URL"
      described as {
        |Clicked URL.
      }
    }
    clickedAt: TimeStamp with {
      briefly "Clicked"
      described as {
        |Click time.
      }
    }
  } with {
    briefly "Link clicked"
    described as {
      |Emitted when link clicked.
    }
  }
} with {
  option external()
  briefly "External email delivery"
  described as {
    |Email sending service (ESP).
  }
}
context ListManagement is {
  command GetListSubscribers is  {
    listId: ListId with {
      briefly "List"
      described as {
        |List ID.
      }
    }
    segments: AudienceSegment* with {
      briefly "Segments"
      described as {
        |Segments to apply.
      }
    }
    excludeLists: ListId* with {
      briefly "Exclude"
      described as {
        |Lists to exclude.
      }
    }
  } with {
    briefly "Get subscribers"
    described as {
      |Retrieves list subscribers.
    }
  }
  event SubscribersRetrieved is  {
    listId: ListId with {
      briefly "List"
      described as {
        |List ID.
      }
    }
    subscriberCount: Natural with {
      briefly "Count"
      described as {
        |Subscriber count.
      }
    }
    retrievedAt: TimeStamp with {
      briefly "Retrieved"
      described as {
        |Retrieval time.
      }
    }
  } with {
    briefly "Subscribers retrieved"
    described as {
      |Emitted when subscribers fetched.
    }
  }
  command ProcessUnsubscribe is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    campaignId: EmailCampaignId with {
      briefly "Campaign"
      described as {
        |Source campaign.
      }
    }
    unsubscribeReason: String(1,500)? with {
      briefly "Reason"
      described as {
        |Unsubscribe reason.
      }
    }
  } with {
    briefly "Process unsubscribe"
    described as {
      |Handles unsubscribe request.
    }
  }
  event SubscriberUnsubscribed is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    unsubscribedAt: TimeStamp with {
      briefly "Unsubscribed"
      described as {
        |Unsub time.
      }
    }
  } with {
    briefly "Subscriber unsubscribed"
    described as {
      |Emitted when unsubscribed.
    }
  }
} with {
  option external()
  briefly "External list management"
  described as {
    |Subscriber list service.
  }
}
context TemplateRenderer is {
  command RenderTemplate is  {
    templateId: TemplateId with {
      briefly "Template"
      described as {
        |Template ID.
      }
    }
    htmlContent: String(1,500000) with {
      briefly "HTML"
      described as {
        |Template HTML.
      }
    }
    personalizationData: String(1,10000) with {
      briefly "Data"
      described as {
        |Personalization data.
      }
    }
  } with {
    briefly "Render template"
    described as {
      |Renders personalized email.
    }
  }
  event TemplateRendered is  {
    templateId: TemplateId with {
      briefly "Template"
      described as {
        |Template ID.
      }
    }
    renderedHtml: String(1,500000) with {
      briefly "HTML"
      described as {
        |Rendered HTML.
      }
    }
    renderedPlainText: String(1,100000) with {
      briefly "Plain text"
      described as {
        |Plain text version.
      }
    }
  } with {
    briefly "Template rendered"
    described as {
      |Emitted when template rendered.
    }
  }
  command ValidateTemplate is  {
    htmlContent: String(1,500000) with {
      briefly "HTML"
      described as {
        |Template HTML.
      }
    }
  } with {
    briefly "Validate template"
    described as {
      |Validates email template.
    }
  }
  event TemplateValidated is  {
    isValid: Boolean with {
      briefly "Valid"
      described as {
        |Validation result.
      }
    }
    errors: String(1,500)* with {
      briefly "Errors"
      described as {
        |Validation errors.
      }
    }
    warnings: String(1,500)* with {
      briefly "Warnings"
      described as {
        |Warnings.
      }
    }
  } with {
    briefly "Template validated"
    described as {
      |Emitted when validation done.
    }
  }
} with {
  option external()
  briefly "External template renderer"
  described as {
    |Email template rendering.
  }
}
context SpamChecker is {
  command CheckSpamScore is  {
    subject: String(1,500) with {
      briefly "Subject"
      described as {
        |Email subject.
      }
    }
    htmlContent: String(1,500000) with {
      briefly "HTML"
      described as {
        |Email HTML.
      }
    }
    fromEmail: EmailAddress with {
      briefly "From"
      described as {
        |Sender email.
      }
    }
  } with {
    briefly "Check spam score"
    described as {
      |Analyzes spam likelihood.
    }
  }
  event SpamScoreCalculated is  {
    score: Decimal(4,2) with {
      briefly "Score"
      described as {
        |Spam score.
      }
    }
    issues: String(1,200)* with {
      briefly "Issues"
      described as {
        |Spam issues found.
      }
    }
    recommendation: String(1,500) with {
      briefly "Recommendation"
      described as {
        |Improvement tips.
      }
    }
  } with {
    briefly "Spam score calculated"
    described as {
      |Emitted when analysis complete.
    }
  }
} with {
  option external()
  briefly "External spam checker"
  described as {
    |Email spam analysis.
  }
}
