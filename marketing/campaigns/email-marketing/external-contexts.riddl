// Email Marketing - External Contexts

context EmailDeliveryService is {

  command SendEmail is {
    campaignId is EmailCampaignId with { briefly "Campaign" described by "Campaign ID." }
    recipientEmail is EmailAddress with { briefly "Email" described by "Recipient email." }
    template is EmailTemplate with { briefly "Template" described by "Email template." }
    personalizationData is String(1, 10000) with { briefly "Data" described by "Personalization JSON." }
  } with {
    briefly "Send email"
    described by "Sends individual email."
  }

  event EmailSent is {
    campaignId is EmailCampaignId with { briefly "Campaign" described by "Campaign ID." }
    messageId is String(1, 100) with { briefly "Message" described by "Message ID." }
    recipientEmail is EmailAddress with { briefly "Email" described by "Recipient." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Email sent"
    described by "Emitted when email sent."
  }

  event EmailBounced is {
    campaignId is EmailCampaignId with { briefly "Campaign" described by "Campaign ID." }
    messageId is String(1, 100) with { briefly "Message" described by "Message ID." }
    recipientEmail is EmailAddress with { briefly "Email" described by "Recipient." }
    bounceType is String(1, 20) with { briefly "Type" described by "Hard or soft bounce." }
    bounceReason is String(1, 500) with { briefly "Reason" described by "Bounce reason." }
  } with {
    briefly "Email bounced"
    described by "Emitted when email bounces."
  }

  event EmailOpened is {
    campaignId is EmailCampaignId with { briefly "Campaign" described by "Campaign ID." }
    messageId is String(1, 100) with { briefly "Message" described by "Message ID." }
    openedAt is TimeStamp with { briefly "Opened" described by "Open time." }
    userAgent is optional String(1, 500) with { briefly "Agent" described by "User agent." }
  } with {
    briefly "Email opened"
    described by "Emitted when email opened."
  }

  event LinkClicked is {
    campaignId is EmailCampaignId with { briefly "Campaign" described by "Campaign ID." }
    messageId is String(1, 100) with { briefly "Message" described by "Message ID." }
    url is URL with { briefly "URL" described by "Clicked URL." }
    clickedAt is TimeStamp with { briefly "Clicked" described by "Click time." }
  } with {
    briefly "Link clicked"
    described by "Emitted when link clicked."
  }

} with {
  option is external
  briefly "External email delivery"
  described by "Email sending service (ESP)."
}

context ListManagement is {

  command GetListSubscribers is {
    listId is ListId with { briefly "List" described by "List ID." }
    segments is many optional AudienceSegment with { briefly "Segments" described by "Segments to apply." }
    excludeLists is many optional ListId with { briefly "Exclude" described by "Lists to exclude." }
  } with {
    briefly "Get subscribers"
    described by "Retrieves list subscribers."
  }

  event SubscribersRetrieved is {
    listId is ListId with { briefly "List" described by "List ID." }
    subscriberCount is Natural with { briefly "Count" described by "Subscriber count." }
    retrievedAt is TimeStamp with { briefly "Retrieved" described by "Retrieval time." }
  } with {
    briefly "Subscribers retrieved"
    described by "Emitted when subscribers fetched."
  }

  command ProcessUnsubscribe is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    campaignId is EmailCampaignId with { briefly "Campaign" described by "Source campaign." }
    reason is optional String(1, 500) with { briefly "Reason" described by "Unsubscribe reason." }
  } with {
    briefly "Process unsubscribe"
    described by "Handles unsubscribe request."
  }

  event SubscriberUnsubscribed is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    unsubscribedAt is TimeStamp with { briefly "Unsubscribed" described by "Unsub time." }
  } with {
    briefly "Subscriber unsubscribed"
    described by "Emitted when unsubscribed."
  }

} with {
  option is external
  briefly "External list management"
  described by "Subscriber list service."
}

context TemplateRenderer is {

  command RenderTemplate is {
    templateId is TemplateId with { briefly "Template" described by "Template ID." }
    htmlContent is String(1, 500000) with { briefly "HTML" described by "Template HTML." }
    personalizationData is String(1, 10000) with { briefly "Data" described by "Personalization data." }
  } with {
    briefly "Render template"
    described by "Renders personalized email."
  }

  event TemplateRendered is {
    templateId is TemplateId with { briefly "Template" described by "Template ID." }
    renderedHtml is String(1, 500000) with { briefly "HTML" described by "Rendered HTML." }
    renderedPlainText is String(1, 100000) with { briefly "Plain text" described by "Plain text version." }
  } with {
    briefly "Template rendered"
    described by "Emitted when template rendered."
  }

  command ValidateTemplate is {
    htmlContent is String(1, 500000) with { briefly "HTML" described by "Template HTML." }
  } with {
    briefly "Validate template"
    described by "Validates email template."
  }

  event TemplateValidated is {
    isValid is Boolean with { briefly "Valid" described by "Validation result." }
    errors is many optional String(1, 500) with { briefly "Errors" described by "Validation errors." }
    warnings is many optional String(1, 500) with { briefly "Warnings" described by "Warnings." }
  } with {
    briefly "Template validated"
    described by "Emitted when validation done."
  }

} with {
  option is external
  briefly "External template renderer"
  described by "Email template rendering."
}

context SpamChecker is {

  command CheckSpamScore is {
    subject is String(1, 500) with { briefly "Subject" described by "Email subject." }
    htmlContent is String(1, 500000) with { briefly "HTML" described by "Email HTML." }
    fromEmail is EmailAddress with { briefly "From" described by "Sender email." }
  } with {
    briefly "Check spam score"
    described by "Analyzes spam likelihood."
  }

  event SpamScoreCalculated is {
    score is Decimal(4, 2) with { briefly "Score" described by "Spam score." }
    issues is many optional String(1, 200) with { briefly "Issues" described by "Spam issues found." }
    recommendation is String(1, 500) with { briefly "Recommendation" described by "Improvement tips." }
  } with {
    briefly "Spam score calculated"
    described by "Emitted when analysis complete."
  }

} with {
  option is external
  briefly "External spam checker"
  described by "Email spam analysis."
}
