// Campaign Entity
entity Campaign is {
  // Commands
  command CreateCampaign is  {
    campaignId: CampaignId
    name: CampaignName
    objective: CampaignObjective
    schedule: CampaignSchedule
    totalBudget: BudgetAmount
  } with {
    briefly "Create a new marketing campaign"
    described as {
      | Initializes a new campaign with basic configuration including
      | name, objective, schedule, and budget. The campaign starts in Draft status.
    }
  }
  command UpdateCampaignDetails is  {
    campaignId: CampaignId
    name: CampaignName
    objective: CampaignObjective
    schedule: CampaignSchedule
  } with {
    briefly "Update campaign details"
    described as {
      | Modifies the campaign name, objective, or schedule.
      | Only allowed when campaign is in Draft or Paused status.
    }
  }
  command AllocateChannelBudget is  {
    campaignId: CampaignId
    allocation: ChannelAllocation
  } with {
    briefly "Allocate budget to a channel"
    described as {
      | Assigns a portion of the campaign budget to a specific channel.
      | Total channel allocations cannot exceed the campaign budget.
    }
  }
  command AddTargetAudience is  {
    campaignId: CampaignId
    audience: AudienceTarget
  } with {
    briefly "Add a target audience to the campaign"
    described as {
      | Includes an audience segment in the campaign targeting.
      | Multiple audiences can be added with different priorities.
    }
  }
  command RemoveTargetAudience is  {
    campaignId: CampaignId
    audienceId: AudienceId
  } with {
    briefly "Remove a target audience from the campaign"
    described as {
      | Removes an audience segment from campaign targeting.
    }
  }
  command ScheduleCampaign is  { campaignId: CampaignId } with {
    briefly "Schedule the campaign for launch"
    described as {
      | Transitions the campaign from Draft to Scheduled status.
      | Validates that all required configuration is complete.
    }
  }
  command LaunchCampaign is  { campaignId: CampaignId } with {
    briefly "Launch the campaign immediately"
    described as {
      | Activates the campaign, beginning delivery across configured channels.
      | Can be used on Draft or Scheduled campaigns.
    }
  }
  command PauseCampaign is  {
    campaignId: CampaignId
    reason: String
  } with {
    briefly "Pause an active campaign"
    described as {
      | Temporarily stops campaign delivery while preserving configuration.
      | Records the reason for the pause for audit purposes.
    }
  }
  command ResumeCampaign is  { campaignId: CampaignId } with {
    briefly "Resume a paused campaign"
    described as {
      | Reactivates a paused campaign, resuming delivery.
    }
  }
  command RecordPerformanceUpdate is  {
    campaignId: CampaignId
    channelPerformance: ChannelPerformance
  } with {
    briefly "Record performance metrics update"
    described as {
      | Updates the campaign with the latest performance metrics
      | from a specific channel. Typically triggered by channel integrations.
    }
  }
  command CompleteCampaign is  {
    campaignId: CampaignId
    finalMetrics: PerformanceMetrics
  } with {
    briefly "Complete and close the campaign"
    described as {
      | Marks the campaign as completed, recording final metrics.
      | No further delivery or budget spend will occur.
    }
  }
  command ArchiveCampaign is  { campaignId: CampaignId } with {
    briefly "Archive the campaign"
    described as {
      | Moves the campaign to archived status for long-term retention.
      | Archived campaigns are read-only.
    }
  }
  // Events
  event CampaignCreated is  {
    campaignId: CampaignId
    name: CampaignName
    objective: CampaignObjective
    schedule: CampaignSchedule
    totalBudget: BudgetAmount
    createdAt: TimeStamp
  } with {
    briefly "Campaign was created"
    described as {
      | Emitted when a new campaign is successfully created.
      | Contains all initial campaign configuration.
    }
  }
  event CampaignDetailsUpdated is  {
    campaignId: CampaignId
    name: CampaignName
    objective: CampaignObjective
    schedule: CampaignSchedule
    updatedAt: TimeStamp
  } with {
    briefly "Campaign details were updated"
    described as {
      | Emitted when campaign name, objective, or schedule changes.
    }
  }
  event ChannelBudgetAllocated is  {
    campaignId: CampaignId
    allocation: ChannelAllocation
    allocatedAt: TimeStamp
  } with {
    briefly "Budget was allocated to a channel"
    described as {
      | Emitted when budget is assigned to a marketing channel.
    }
  }
  event TargetAudienceAdded is  {
    campaignId: CampaignId
    audience: AudienceTarget
    addedAt: TimeStamp
  } with {
    briefly "Target audience was added"
    described as {
      | Emitted when an audience segment is added to the campaign.
    }
  }
  event TargetAudienceRemoved is  {
    campaignId: CampaignId
    audienceId: AudienceId
    removedAt: TimeStamp
  } with {
    briefly "Target audience was removed"
    described as {
      | Emitted when an audience segment is removed from the campaign.
    }
  }
  event CampaignScheduled is  {
    campaignId: CampaignId
    scheduledAt: TimeStamp
  } with {
    briefly "Campaign was scheduled for launch"
    described as {
      | Emitted when campaign transitions to Scheduled status.
    }
  }
  event CampaignLaunched is  {
    campaignId: CampaignId
    launchedAt: TimeStamp
  } with {
    briefly "Campaign was launched"
    described as {
      | Emitted when campaign becomes active and begins delivery.
    }
  }
  event CampaignPaused is  {
    campaignId: CampaignId
    reason: String
    pausedAt: TimeStamp
  } with {
    briefly "Campaign was paused"
    described as {
      | Emitted when an active campaign is temporarily stopped.
    }
  }
  event CampaignResumed is  {
    campaignId: CampaignId
    resumedAt: TimeStamp
  } with {
    briefly "Campaign was resumed"
    described as {
      | Emitted when a paused campaign is reactivated.
    }
  }
  event PerformanceMetricsRecorded is  {
    campaignId: CampaignId
    channelPerformance: ChannelPerformance
    recordedAt: TimeStamp
  } with {
    briefly "Performance metrics were recorded"
    described as {
      | Emitted when new performance data is received from a channel.
    }
  }
  event CampaignCompleted is  {
    campaignId: CampaignId
    finalMetrics: PerformanceMetrics
    completedAt: TimeStamp
  } with {
    briefly "Campaign was completed"
    described as {
      | Emitted when the campaign finishes its run.
    }
  }
  event CampaignArchived is  {
    campaignId: CampaignId
    archivedAt: TimeStamp
  } with {
    briefly "Campaign was archived"
    described as {
      | Emitted when the campaign is moved to archive storage.
    }
  }
  // State Records
  record CampaignStateRecord is  {
    info: CampaignInfo
    channelAllocations: ChannelAllocation*
    targetAudiences: AudienceTarget*
    aggregateMetrics: PerformanceMetrics
    channelMetrics: ChannelPerformance*
    budgetAlerts: BudgetAlert*
  } with {
    briefly "Complete campaign state record"
    described as {
      | Contains all campaign data including basic info, channel allocations,
      | audience targeting, and accumulated performance metrics.
    }
  }
  // States
  state DraftState of type Campaign.CampaignStateRecord
  state ScheduledState of type Campaign.CampaignStateRecord
  state ActiveState of type Campaign.CampaignStateRecord
  state PausedState of type Campaign.CampaignStateRecord
  state CompletedState of type Campaign.CampaignStateRecord
  state ArchivedState of type Campaign.CampaignStateRecord
  // Handler
  handler CampaignHandler is {
    on command CreateCampaign is {
      morph entity CampaignContext.Campaign to state CampaignContext.Campaign.DraftState with command CreateCampaign
      tell event CampaignCreated to entity CampaignContext.Campaign
    }
    on command UpdateCampaignDetails is {
      tell event CampaignDetailsUpdated to entity CampaignContext.Campaign
    }
    on command AllocateChannelBudget is {
      tell event ChannelBudgetAllocated to entity CampaignContext.Campaign
    }
    on command AddTargetAudience is {
      tell event TargetAudienceAdded to entity CampaignContext.Campaign
    }
    on command RemoveTargetAudience is {
      tell event TargetAudienceRemoved to entity CampaignContext.Campaign
    }
    on command ScheduleCampaign is {
      morph entity CampaignContext.Campaign to state CampaignContext.Campaign.ScheduledState with command ScheduleCampaign
      tell event CampaignScheduled to entity CampaignContext.Campaign
    }
    on command LaunchCampaign is {
      morph entity CampaignContext.Campaign to state CampaignContext.Campaign.ActiveState with command LaunchCampaign
      tell event CampaignLaunched to entity CampaignContext.Campaign
    }
    on command Campaign.PauseCampaign is {
      morph entity CampaignContext.Campaign to state CampaignContext.Campaign.PausedState with command Campaign.PauseCampaign
      tell event CampaignPaused to entity CampaignContext.Campaign
    }
    on command ResumeCampaign is {
      morph entity CampaignContext.Campaign to state CampaignContext.Campaign.ActiveState with command ResumeCampaign
      tell event CampaignResumed to entity CampaignContext.Campaign
    }
    on command RecordPerformanceUpdate is {
      tell event PerformanceMetricsRecorded to entity CampaignContext.Campaign
    }
    on command Campaign.CompleteCampaign is {
      morph entity CampaignContext.Campaign to state CampaignContext.Campaign.CompletedState with command Campaign.CompleteCampaign
      tell event CampaignCompleted to entity CampaignContext.Campaign
    }
    on command ArchiveCampaign is {
      morph entity CampaignContext.Campaign to state CampaignContext.Campaign.ArchivedState with command ArchiveCampaign
      tell event CampaignArchived to entity CampaignContext.Campaign
    }
  } with {
    briefly "Processes campaign commands"
    described as {
      | Handles the full campaign lifecycle including creation,
      | configuration, state transitions, and performance tracking.
    }
  }
} with {
  option aggregate()
  option event-sourced()
  briefly "Marketing campaign aggregate entity"
  described as {
    | The Campaign entity is the aggregate root for marketing campaigns.
    | It manages the full lifecycle from creation through archival,
    | including budget allocation, audience targeting, and performance tracking.
  }
}
