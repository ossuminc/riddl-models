// Marketing Attribution - External Contexts

context WebAnalytics is {

  query GetPageViews is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    period is ReportPeriod with { briefly "Period" described by "Report period." }
  } with {
    briefly "Get page views"
    described by "Retrieves page view data for a customer."
  }

  result PageViewData is {
    pageViews is many TouchpointInfo with { briefly "Views" described by "Page view touchpoints." }
    sessionCount is Natural with { briefly "Sessions" described by "Session count." }
  } with {
    briefly "Page view data"
    described by "Customer page view information."
  }

  command TrackEvent is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    eventName is String(3, 100) with { briefly "Event" described by "Event name." }
    eventData is String(3, 2000) with { briefly "Data" described by "Event data." }
    timestamp is TimeStamp with { briefly "Time" described by "Event time." }
  } with {
    briefly "Track event"
    described by "Tracks a web analytics event."
  }

  event EventTracked is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    eventName is String(3, 100) with { briefly "Event" described by "Event name." }
    trackedAt is TimeStamp with { briefly "Tracked" described by "Tracking time." }
  } with {
    briefly "Event tracked"
    described by "Emitted when a web event is tracked."
  }

} with {
  option is external
  briefly "External web analytics system"
  described by "Web analytics platform providing page view and event data."
}

context CRMSystem is {

  query GetCustomerJourney is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    period is ReportPeriod with { briefly "Period" described by "Report period." }
  } with {
    briefly "Get customer journey"
    described by "Retrieves customer journey data."
  }

  result CustomerJourneyData is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    interactions is many TouchpointInfo with { briefly "Interactions" described by "Customer interactions." }
    customerSegment is String(3, 100) with { briefly "Segment" described by "Customer segment." }
  } with {
    briefly "Customer journey data"
    described by "Customer journey information from CRM."
  }

  command UpdateCustomerAttribution is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    attributionResults is many AttributionResult with { briefly "Results" described by "Attribution results." }
    modelType is AttributionModelType with { briefly "Model" described by "Model used." }
  } with {
    briefly "Update customer attribution"
    described by "Updates CRM with attribution results."
  }

  event CustomerAttributionUpdated is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Customer attribution updated"
    described by "Emitted when CRM attribution is updated."
  }

} with {
  option is external
  briefly "External CRM system"
  described by "Customer relationship management system."
}
