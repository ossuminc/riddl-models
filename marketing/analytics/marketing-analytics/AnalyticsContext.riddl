// Marketing Analytics - Analytics Context
context AnalyticsContext is {
  include "types.riddl"
  include "AnalyticsReport.riddl"
  repository AnalyticsRepository is {
    schema AnalyticsData is relational
      of reports as type AnalyticsReport
        index on field AnalyticsReport.reportId
        index on field AnalyticsReport.status
        index on field AnalyticsReport.requestedBy

    handler AnalyticsPersistence is {
      on command AnalyticsReport.CreateReport is {
        prompt "Store new report record"
      }
      on command AnalyticsReport.AddChannelMetrics is {
        prompt "Store channel metrics"
      }
      on command AnalyticsReport.AddCampaignPerformance is {
        prompt "Store campaign performance"
      }
      on command AnalyticsReport.AddAttributionResults is {
        prompt "Store attribution results"
      }
      on command AnalyticsReport.CompleteReport is {
        prompt "Update report to ready status"
      }
      on command AnalyticsReport.ArchiveReport is {
        prompt "Move report to archive storage"
      }
    } with {
      briefly "Persists analytics commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Analytics data persistence"
    described as {
      |Persistent storage for analytics.
    }
  }
  projector PerformanceDashboard is {
    record DashboardMetrics is  {
      period: MetricPeriod with {
        briefly "Period"
        described as {
          |Dashboard period.
        }
      }
      aggregateTotalSpend: Decimal(15,2) with {
        briefly "Spend"
        described as {
          |Total spend.
        }
      }
      aggregateTotalRevenue: Decimal(15,2) with {
        briefly "Revenue"
        described as {
          |Total revenue.
        }
      }
      overallROAS: Decimal(8,2) with {
        briefly "ROAS"
        described as {
          |Overall ROAS.
        }
      }
      topChannel: ChannelType with {
        briefly "Top channel"
        described as {
          |Best channel.
        }
      }
      activeCampaigns: Natural with {
        briefly "Active"
        described as {
          |Active campaigns.
        }
      }
    } with {
      briefly "Dashboard metrics"
      described as {
        |Executive dashboard metrics.
      }
    }
    handler DashboardHandler is {
      on event AnalyticsReport.ReportCompleted is {
        prompt "Update dashboard with latest report data"
      }
    } with {
      briefly "Maintains dashboard"
      described as {
        |Projects reports into dashboard.
      }
    }
  } with {
    briefly "Performance dashboard"
    described as {
      |Marketing executive dashboard.
    }
  }
} with {
  briefly "Bounded context for marketing analytics"
  described as {
    |Marketing performance analysis context.
  }
}
