// Content Management - Content Entity
entity Content is {
  command CreateContent is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |New content identifier.
      }
    }
    category: ContentCategory with {
      briefly "Category"
      described as {
        |Content category.
      }
    }
    brief: ContentBrief with {
      briefly "Brief"
      described as {
        |Content brief.
      }
    }
    assignedWriter: String(1,100) with {
      briefly "Writer"
      described as {
        |Assigned writer.
      }
    }
  } with {
    briefly "Create content"
    described as {
      |Creates new content item.
    }
  }
  command SubmitDraft is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    body: ContentBody with {
      briefly "Body"
      described as {
        |Draft content.
      }
    }
    seo: SEOMetadata? with {
      briefly "SEO"
      described as {
        |SEO metadata.
      }
    }
  } with {
    briefly "Submit draft"
    described as {
      |Submits content draft.
    }
  }
  command AttachMedia is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    attachment: MediaAttachment with {
      briefly "Attachment"
      described as {
        |Media to attach.
      }
    }
  } with {
    briefly "Attach media"
    described as {
      |Attaches media file.
    }
  }
  command RequestReview is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    assignedEditor: String(1,100) with {
      briefly "Editor"
      described as {
        |Assigned editor.
      }
    }
    notes: String(1,1000)? with {
      briefly "Notes"
      described as {
        |Review notes.
      }
    }
  } with {
    briefly "Request review"
    described as {
      |Submits for editorial review.
    }
  }
  command AddReviewComment is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    comment: ReviewComment with {
      briefly "Comment"
      described as {
        |Review comment.
      }
    }
  } with {
    briefly "Add review comment"
    described as {
      |Adds editor comment.
    }
  }
  command ResolveComment is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    commentId: UUID with {
      briefly "Comment"
      described as {
        |Comment to resolve.
      }
    }
  } with {
    briefly "Resolve comment"
    described as {
      |Marks comment resolved.
    }
  }
  command RequestRevision is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    reason: String(1,2000) with {
      briefly "Reason"
      described as {
        |Revision reason.
      }
    }
  } with {
    briefly "Request revision"
    described as {
      |Requests content revision.
    }
  }
  command SubmitRevision is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    body: ContentBody with {
      briefly "Body"
      described as {
        |Revised content.
      }
    }
    changeNotes: String(1,1000) with {
      briefly "Notes"
      described as {
        |Change notes.
      }
    }
  } with {
    briefly "Submit revision"
    described as {
      |Submits revised content.
    }
  }
  command ApproveContent is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    approvedBy: String(1,100) with {
      briefly "Approved by"
      described as {
        |Approver name.
      }
    }
  } with {
    briefly "Approve content"
    described as {
      |Approves for publishing.
    }
  }
  command SchedulePublish is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    settings: PublishSettings with {
      briefly "Settings"
      described as {
        |Publish settings.
      }
    }
  } with {
    briefly "Schedule publish"
    described as {
      |Schedules content publish.
    }
  }
  command PublishContent is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
  } with {
    briefly "Publish content"
    described as {
      |Publishes content now.
    }
  }
  command UpdateMetrics is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    metrics: ContentMetrics with {
      briefly "Metrics"
      described as {
        |Performance metrics.
      }
    }
  } with {
    briefly "Update metrics"
    described as {
      |Updates performance data.
    }
  }
  command ArchiveContent is  {
    contentId: ContentId with {
      briefly "Content ID"
      described as {
        |Content identifier.
      }
    }
    archiveReason: String(1,500)? with {
      briefly "Reason"
      described as {
        |Archive reason.
      }
    }
  } with {
    briefly "Archive content"
    described as {
      |Archives content.
    }
  }
  // Events
  event ContentCreated is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    category: ContentCategory with {
      briefly "Category"
      described as {
        |Category.
      }
    }
    assignedWriter: String(1,100) with {
      briefly "Writer"
      described as {
        |Writer.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Content created"
    described as {
      |Emitted when content created.
    }
  }
  event DraftSubmitted is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    headline: String(1,200) with {
      briefly "Headline"
      described as {
        |Draft headline.
      }
    }
    draftWordCount: Natural with {
      briefly "Words"
      described as {
        |Word count.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submit time.
      }
    }
  } with {
    briefly "Draft submitted"
    described as {
      |Emitted when draft ready.
    }
  }
  event MediaAttached is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    attachmentId: UUID with {
      briefly "Attachment"
      described as {
        |Attachment ID.
      }
    }
    attachedAt: TimeStamp with {
      briefly "Attached"
      described as {
        |Attach time.
      }
    }
  } with {
    briefly "Media attached"
    described as {
      |Emitted when media added.
    }
  }
  event ReviewRequested is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    assignedEditor: String(1,100) with {
      briefly "Editor"
      described as {
        |Editor.
      }
    }
    requestedAt: TimeStamp with {
      briefly "Requested"
      described as {
        |Request time.
      }
    }
  } with {
    briefly "Review requested"
    described as {
      |Emitted when review needed.
    }
  }
  event ReviewCommentAdded is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    comment: ReviewComment with {
      briefly "Comment"
      described as {
        |Review comment.
      }
    }
  } with {
    briefly "Review comment added"
    described as {
      |Emitted when editor comments.
    }
  }
  event CommentResolved is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    commentId: UUID with {
      briefly "Comment"
      described as {
        |Comment ID.
      }
    }
    resolvedAt: TimeStamp with {
      briefly "Resolved"
      described as {
        |Resolve time.
      }
    }
  } with {
    briefly "Comment resolved"
    described as {
      |Emitted when comment addressed.
    }
  }
  event RevisionRequested is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    reason: String(1,2000) with {
      briefly "Reason"
      described as {
        |Revision reason.
      }
    }
    requestedAt: TimeStamp with {
      briefly "Requested"
      described as {
        |Request time.
      }
    }
  } with {
    briefly "Revision requested"
    described as {
      |Emitted when revision needed.
    }
  }
  event RevisionSubmitted is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    versionNumber: Natural with {
      briefly "Version"
      described as {
        |New version.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submit time.
      }
    }
  } with {
    briefly "Revision submitted"
    described as {
      |Emitted when revised.
    }
  }
  event ContentApproved is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    approvedBy: String(1,100) with {
      briefly "Approved by"
      described as {
        |Approver.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Content approved"
    described as {
      |Emitted when approved.
    }
  }
  event PublishScheduled is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    publishDate: TimeStamp with {
      briefly "Date"
      described as {
        |Publish date.
      }
    }
    scheduledAt: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Schedule time.
      }
    }
  } with {
    briefly "Publish scheduled"
    described as {
      |Emitted when scheduled.
    }
  }
  event ContentPublished is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    publishUrl: URL with {
      briefly "URL"
      described as {
        |Published URL.
      }
    }
    publishedAt: TimeStamp with {
      briefly "Published"
      described as {
        |Publish time.
      }
    }
  } with {
    briefly "Content published"
    described as {
      |Emitted when published.
    }
  }
  event MetricsUpdated is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    metrics: ContentMetrics with {
      briefly "Metrics"
      described as {
        |Performance.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Metrics updated"
    described as {
      |Emitted when metrics refresh.
    }
  }
  event ContentArchived is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    archivedAt: TimeStamp with {
      briefly "Archived"
      described as {
        |Archive time.
      }
    }
  } with {
    briefly "Content archived"
    described as {
      |Emitted when archived.
    }
  }
  // States
  record ActiveStateData is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    category: ContentCategory with {
      briefly "Category"
      described as {
        |Category.
      }
    }
    brief: ContentBrief with {
      briefly "Brief"
      described as {
        |Content brief.
      }
    }
    status: ContentStatus with {
      briefly "Status"
      described as {
        |Content status.
      }
    }
    currentBody: ContentBody? with {
      briefly "Body"
      described as {
        |Current content.
      }
    }
    seo: SEOMetadata? with {
      briefly "SEO"
      described as {
        |SEO metadata.
      }
    }
    attachments: MediaAttachment* with {
      briefly "Media"
      described as {
        |Attachments.
      }
    }
    versions: ContentVersion* with {
      briefly "Versions"
      described as {
        |Versions.
      }
    }
    reviewComments: ReviewComment* with {
      briefly "Comments"
      described as {
        |Comments.
      }
    }
    publishSettings: PublishSettings? with {
      briefly "Publish"
      described as {
        |Publish settings.
      }
    }
    currentMetrics: ContentMetrics? with {
      briefly "Metrics"
      described as {
        |Metrics.
      }
    }
    assignedWriter: String(1,100) with {
      briefly "Writer"
      described as {
        |Writer.
      }
    }
    currentEditor: String(1,100)? with {
      briefly "Editor"
      described as {
        |Editor.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Active content state"
    described as {
      |Active content data.
    }
  }
  record ArchivedStateData is  {
    contentId: ContentId with {
      briefly "Content"
      described as {
        |Content ID.
      }
    }
    headline: String(1,200) with {
      briefly "Headline"
      described as {
        |Headline.
      }
    }
    finalMetrics: ContentMetrics? with {
      briefly "Metrics"
      described as {
        |Final metrics.
      }
    }
    archivedAt: TimeStamp with {
      briefly "Archived"
      described as {
        |Archive time.
      }
    }
  } with {
    briefly "Archived content state"
    described as {
      |Archived content data.
    }
  }
  state ActiveState of type Content.ActiveStateData
  state ArchivedState of type Content.ArchivedStateData
  handler ContentHandler is {
    on command CreateContent is {
      morph entity ContentContext.Content to state ContentContext.Content.ActiveState with command CreateContent
      tell event ContentCreated to entity ContentContext.Content
    }
    on command SubmitDraft is {
      tell event DraftSubmitted to entity ContentContext.Content
    }
    on command AttachMedia is {
      tell event MediaAttached to entity ContentContext.Content
    }
    on command RequestReview is {
      tell event ReviewRequested to entity ContentContext.Content
    }
    on command AddReviewComment is {
      tell event ReviewCommentAdded to entity ContentContext.Content
    }
    on command ResolveComment is {
      tell event CommentResolved to entity ContentContext.Content
    }
    on command RequestRevision is {
      tell event RevisionRequested to entity ContentContext.Content
    }
    on command SubmitRevision is {
      tell event RevisionSubmitted to entity ContentContext.Content
    }
    on command ApproveContent is {
      tell event ContentApproved to entity ContentContext.Content
    }
    on command SchedulePublish is {
      tell event PublishScheduled to entity ContentContext.Content
    }
    on command PublishContent is {
      tell event ContentPublished to entity ContentContext.Content
    }
    on command UpdateMetrics is {
      tell event MetricsUpdated to entity ContentContext.Content
    }
    on command ArchiveContent is {
      morph entity ContentContext.Content to state ContentContext.Content.ArchivedState with command ArchiveContent
      tell event ContentArchived to entity ContentContext.Content
    }
  } with {
    briefly "Processes content commands"
    described as {
      |Handles content lifecycle.
    }
  }
} with {
  briefly "Content aggregate"
  described as {
    |Manages marketing content.
  }
}
