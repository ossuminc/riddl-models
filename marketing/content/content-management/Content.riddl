// Content Management - Content Entity

entity Content is {

  command CreateContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "New content identifier."
    }
    category is ContentCategory with {
      briefly "Category"
      described by "Content category."
    }
    brief is ContentBrief with {
      briefly "Brief"
      described by "Content brief."
    }
    assignedWriter is String(1, 100) with {
      briefly "Writer"
      described by "Assigned writer."
    }
  } with {
    briefly "Create content"
    described by "Creates new content item."
  }

  command SubmitDraft is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    body is ContentBody with {
      briefly "Body"
      described by "Draft content."
    }
    seo is optional SEOMetadata with {
      briefly "SEO"
      described by "SEO metadata."
    }
  } with {
    briefly "Submit draft"
    described by "Submits content draft."
  }

  command AttachMedia is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    attachment is MediaAttachment with {
      briefly "Attachment"
      described by "Media to attach."
    }
  } with {
    briefly "Attach media"
    described by "Attaches media file."
  }

  command RequestReview is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    assignedEditor is String(1, 100) with {
      briefly "Editor"
      described by "Assigned editor."
    }
    notes is optional String(1, 1000) with {
      briefly "Notes"
      described by "Review notes."
    }
  } with {
    briefly "Request review"
    described by "Submits for editorial review."
  }

  command AddReviewComment is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    comment is ReviewComment with {
      briefly "Comment"
      described by "Review comment."
    }
  } with {
    briefly "Add review comment"
    described by "Adds editor comment."
  }

  command ResolveComment is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    commentId is UUID with {
      briefly "Comment"
      described by "Comment to resolve."
    }
  } with {
    briefly "Resolve comment"
    described by "Marks comment resolved."
  }

  command RequestRevision is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    reason is String(1, 2000) with {
      briefly "Reason"
      described by "Revision reason."
    }
  } with {
    briefly "Request revision"
    described by "Requests content revision."
  }

  command SubmitRevision is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    body is ContentBody with {
      briefly "Body"
      described by "Revised content."
    }
    changeNotes is String(1, 1000) with {
      briefly "Notes"
      described by "Change notes."
    }
  } with {
    briefly "Submit revision"
    described by "Submits revised content."
  }

  command ApproveContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    approvedBy is String(1, 100) with {
      briefly "Approved by"
      described by "Approver name."
    }
  } with {
    briefly "Approve content"
    described by "Approves for publishing."
  }

  command SchedulePublish is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    settings is PublishSettings with {
      briefly "Settings"
      described by "Publish settings."
    }
  } with {
    briefly "Schedule publish"
    described by "Schedules content publish."
  }

  command PublishContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
  } with {
    briefly "Publish content"
    described by "Publishes content now."
  }

  command UpdateMetrics is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    metrics is ContentMetrics with {
      briefly "Metrics"
      described by "Performance metrics."
    }
  } with {
    briefly "Update metrics"
    described by "Updates performance data."
  }

  command ArchiveContent is {
    contentId is ContentId with {
      briefly "Content ID"
      described by "Content identifier."
    }
    reason is optional String(1, 500) with {
      briefly "Reason"
      described by "Archive reason."
    }
  } with {
    briefly "Archive content"
    described by "Archives content."
  }

  // Events
  event ContentCreated is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    category is ContentCategory with { briefly "Category" described by "Category." }
    assignedWriter is String(1, 100) with { briefly "Writer" described by "Writer." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Content created"
    described by "Emitted when content created."
  }

  event DraftSubmitted is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    headline is String(1, 200) with { briefly "Headline" described by "Draft headline." }
    wordCount is Natural with { briefly "Words" described by "Word count." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submit time." }
  } with {
    briefly "Draft submitted"
    described by "Emitted when draft ready."
  }

  event MediaAttached is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    attachmentId is UUID with { briefly "Attachment" described by "Attachment ID." }
    attachedAt is TimeStamp with { briefly "Attached" described by "Attach time." }
  } with {
    briefly "Media attached"
    described by "Emitted when media added."
  }

  event ReviewRequested is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    assignedEditor is String(1, 100) with { briefly "Editor" described by "Editor." }
    requestedAt is TimeStamp with { briefly "Requested" described by "Request time." }
  } with {
    briefly "Review requested"
    described by "Emitted when review needed."
  }

  event ReviewCommentAdded is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    comment is ReviewComment with { briefly "Comment" described by "Review comment." }
  } with {
    briefly "Review comment added"
    described by "Emitted when editor comments."
  }

  event CommentResolved is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    commentId is UUID with { briefly "Comment" described by "Comment ID." }
    resolvedAt is TimeStamp with { briefly "Resolved" described by "Resolve time." }
  } with {
    briefly "Comment resolved"
    described by "Emitted when comment addressed."
  }

  event RevisionRequested is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    reason is String(1, 2000) with { briefly "Reason" described by "Revision reason." }
    requestedAt is TimeStamp with { briefly "Requested" described by "Request time." }
  } with {
    briefly "Revision requested"
    described by "Emitted when revision needed."
  }

  event RevisionSubmitted is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    versionNumber is Natural with { briefly "Version" described by "New version." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submit time." }
  } with {
    briefly "Revision submitted"
    described by "Emitted when revised."
  }

  event ContentApproved is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    approvedBy is String(1, 100) with { briefly "Approved by" described by "Approver." }
    approvedAt is TimeStamp with { briefly "Approved" described by "Approval time." }
  } with {
    briefly "Content approved"
    described by "Emitted when approved."
  }

  event PublishScheduled is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    publishDate is TimeStamp with { briefly "Date" described by "Publish date." }
    scheduledAt is TimeStamp with { briefly "Scheduled" described by "Schedule time." }
  } with {
    briefly "Publish scheduled"
    described by "Emitted when scheduled."
  }

  event ContentPublished is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    publishUrl is URL with { briefly "URL" described by "Published URL." }
    publishedAt is TimeStamp with { briefly "Published" described by "Publish time." }
  } with {
    briefly "Content published"
    described by "Emitted when published."
  }

  event MetricsUpdated is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    metrics is ContentMetrics with { briefly "Metrics" described by "Performance." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Metrics updated"
    described by "Emitted when metrics refresh."
  }

  event ContentArchived is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    archivedAt is TimeStamp with { briefly "Archived" described by "Archive time." }
  } with {
    briefly "Content archived"
    described by "Emitted when archived."
  }

  // States
  record ActiveStateData is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    category is ContentCategory with { briefly "Category" described by "Category." }
    brief is ContentBrief with { briefly "Brief" described by "Content brief." }
    status is ContentStatus with { briefly "Status" described by "Content status." }
    currentBody is optional ContentBody with { briefly "Body" described by "Current content." }
    seo is optional SEOMetadata with { briefly "SEO" described by "SEO metadata." }
    attachments is many optional MediaAttachment with { briefly "Media" described by "Attachments." }
    versions is many optional ContentVersion with { briefly "Versions" described by "Versions." }
    reviewComments is many optional ReviewComment with { briefly "Comments" described by "Comments." }
    publishSettings is optional PublishSettings with { briefly "Publish" described by "Publish settings." }
    currentMetrics is optional ContentMetrics with { briefly "Metrics" described by "Metrics." }
    assignedWriter is String(1, 100) with { briefly "Writer" described by "Writer." }
    assignedEditor is optional String(1, 100) with { briefly "Editor" described by "Editor." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Active content state"
    described by "Active content data."
  }

  record ArchivedStateData is {
    contentId is ContentId with { briefly "Content" described by "Content ID." }
    headline is String(1, 200) with { briefly "Headline" described by "Headline." }
    finalMetrics is optional ContentMetrics with { briefly "Metrics" described by "Final metrics." }
    archivedAt is TimeStamp with { briefly "Archived" described by "Archive time." }
  } with {
    briefly "Archived content state"
    described by "Archived content data."
  }

  state ActiveState of Content.ActiveStateData with {
    briefly "Content active"
    described by "Content is in workflow."
  }

  state ArchivedState of Content.ArchivedStateData with {
    briefly "Content archived"
    described by "Content has been archived."
  }

  handler ContentHandler is {
    on command CreateContent {
      morph entity ContentContext.Content to state ContentContext.Content.ActiveState with command CreateContent
      tell event ContentCreated to entity ContentContext.Content
    }
    on command SubmitDraft {
      tell event DraftSubmitted to entity ContentContext.Content
    }
    on command AttachMedia {
      tell event MediaAttached to entity ContentContext.Content
    }
    on command RequestReview {
      tell event ReviewRequested to entity ContentContext.Content
    }
    on command AddReviewComment {
      tell event ReviewCommentAdded to entity ContentContext.Content
    }
    on command ResolveComment {
      tell event CommentResolved to entity ContentContext.Content
    }
    on command RequestRevision {
      tell event RevisionRequested to entity ContentContext.Content
    }
    on command SubmitRevision {
      tell event RevisionSubmitted to entity ContentContext.Content
    }
    on command ApproveContent {
      tell event ContentApproved to entity ContentContext.Content
    }
    on command SchedulePublish {
      tell event PublishScheduled to entity ContentContext.Content
    }
    on command PublishContent {
      tell event ContentPublished to entity ContentContext.Content
    }
    on command UpdateMetrics {
      tell event MetricsUpdated to entity ContentContext.Content
    }
    on command ArchiveContent {
      morph entity ContentContext.Content to state ContentContext.Content.ArchivedState with command ArchiveContent
      tell event ContentArchived to entity ContentContext.Content
    }
  } with {
    briefly "Processes content commands"
    described by "Handles content lifecycle."
  }

} with {
  briefly "Content aggregate"
  described by "Manages marketing content."
}
