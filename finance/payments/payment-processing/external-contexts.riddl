// Payment Processing - External Contexts
// Card Network Service
context CardNetworkService is {
  command SendAuthRequest is  {
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    cardBrand: CardBrand with {
      briefly "Brand"
      described as {
        |Card brand.
      }
    }
    amount: Decimal(12,2) with {
      briefly "Amount"
      described as {
        |Auth amount.
      }
    }
    currency: String(1,3) with {
      briefly "Currency"
      described as {
        |Currency code.
      }
    }
  } with {
    briefly "Send auth request"
    described as {
      |Sends authorization to network.
    }
  }
  event AuthResponseReceived is  {
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    result: AuthorizationResult with {
      briefly "Result"
      described as {
        |Auth result.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Response time.
      }
    }
  } with {
    briefly "Auth response received"
    described as {
      |Emitted when network responds.
    }
  }
} with {
  option external()
  briefly "External card network"
  described as {
    |External card network gateway.
  }
}
// Fraud Detection Service
context FraudService is {
  command ScreenTransaction is  {
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    info: PaymentInfo with {
      briefly "Info"
      described as {
        |Payment info.
      }
    }
    card: CardDetails with {
      briefly "Card"
      described as {
        |Card details.
      }
    }
  } with {
    briefly "Screen transaction"
    described as {
      |Screens for fraud.
    }
  }
  event FraudScreenCompleted is  {
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    approved: Boolean with {
      briefly "Approved"
      described as {
        |Passed screening.
      }
    }
    riskScore: Decimal(5,4) with {
      briefly "Risk"
      described as {
        |Risk score.
      }
    }
  } with {
    briefly "Fraud screen completed"
    described as {
      |Emitted when screening finishes.
    }
  }
} with {
  option external()
  briefly "External fraud service"
  described as {
    |External fraud detection system.
  }
}
// Merchant Service
context MerchantService is {
  query GetMerchant is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
  } with {
    briefly "Get merchant"
    described as {
      |Retrieves merchant details.
    }
  }
  result MerchantDetails is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Merchant name.
      }
    }
    mcc: String(4,4) with {
      briefly "MCC"
      described as {
        |Merchant category code.
      }
    }
  } with {
    briefly "Merchant details"
    described as {
      |Merchant information.
    }
  }
} with {
  option external()
  briefly "External merchant service"
  described as {
    |External merchant management.
  }
}
// Settlement Service
context SettlementService is {
  command SubmitForSettlement is  {
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    amount: Decimal(12,2) with {
      briefly "Amount"
      described as {
        |Settlement amount.
      }
    }
  } with {
    briefly "Submit for settlement"
    described as {
      |Submits payment for settlement.
    }
  }
  event SettlementSubmitted is  {
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    batchId: String(1,50) with {
      briefly "Batch"
      described as {
        |Settlement batch.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Settlement submitted"
    described as {
      |Emitted when submitted for settlement.
    }
  }
} with {
  option external()
  briefly "External settlement service"
  described as {
    |External settlement processor.
  }
}
// Notification Service
context NotificationService is {
  command SendPaymentNotification is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Message content.
      }
    }
  } with {
    briefly "Send notification"
    described as {
      |Sends payment notification.
    }
  }
  event NotificationSent is  {
    notificationId: UUID with {
      briefly "Notification"
      described as {
        |Notification ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification was sent"
    described as {
      |Emitted when notification is delivered.
    }
  }
} with {
  option external()
  briefly "External notification service"
  described as {
    |External notification system.
  }
}
// 3D Secure Service
context ThreeDSecureService is {
  command InitiateAuthentication is  {
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    cardBrand: CardBrand with {
      briefly "Brand"
      described as {
        |Card brand.
      }
    }
    amount: Decimal(12,2) with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
  } with {
    briefly "Initiate 3DS"
    described as {
      |Initiates 3D Secure authentication.
    }
  }
  event AuthenticationCompleted is  {
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    authenticated: Boolean with {
      briefly "Authenticated"
      described as {
        |Is authenticated.
      }
    }
    cavv: String(1,50)? with {
      briefly "CAVV"
      described as {
        |Cardholder verification.
      }
    }
  } with {
    briefly "3DS completed"
    described as {
      |Emitted when 3DS completes.
    }
  }
} with {
  option external()
  briefly "External 3DS service"
  described as {
    |External 3D Secure authentication.
  }
}
