// Payment Processing - External Contexts

// Card Network Service
context CardNetworkService is {

  command SendAuthRequest is {
    paymentId is PaymentId with { briefly "Payment" described by "Payment ID." }
    cardBrand is CardBrand with { briefly "Brand" described by "Card brand." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Auth amount." }
    currency is String(1, 3) with { briefly "Currency" described by "Currency code." }
  } with {
    briefly "Send auth request"
    described by "Sends authorization to network."
  }

  event AuthResponseReceived is {
    paymentId is PaymentId with { briefly "Payment" described by "Payment ID." }
    result is AuthorizationResult with { briefly "Result" described by "Auth result." }
    receivedAt is TimeStamp with { briefly "Received" described by "Response time." }
  } with {
    briefly "Auth response received"
    described by "Emitted when network responds."
  }

} with {
  option is external
  briefly "External card network"
  described by "External card network gateway."
}

// Fraud Detection Service
context FraudService is {

  command ScreenTransaction is {
    paymentId is PaymentId with { briefly "Payment" described by "Payment ID." }
    info is PaymentInfo with { briefly "Info" described by "Payment info." }
    card is CardDetails with { briefly "Card" described by "Card details." }
  } with {
    briefly "Screen transaction"
    described by "Screens for fraud."
  }

  event FraudScreenCompleted is {
    paymentId is PaymentId with { briefly "Payment" described by "Payment ID." }
    approved is Boolean with { briefly "Approved" described by "Passed screening." }
    riskScore is Decimal(5, 4) with { briefly "Risk" described by "Risk score." }
  } with {
    briefly "Fraud screen completed"
    described by "Emitted when screening finishes."
  }

} with {
  option is external
  briefly "External fraud service"
  described by "External fraud detection system."
}

// Merchant Service
context MerchantService is {

  query GetMerchant is {
    merchantId is MerchantId with { briefly "Merchant" described by "Merchant ID." }
  } with {
    briefly "Get merchant"
    described by "Retrieves merchant details."
  }

  result MerchantDetails is {
    merchantId is MerchantId with { briefly "Merchant" described by "Merchant ID." }
    name is String(1, 200) with { briefly "Name" described by "Merchant name." }
    mcc is String(4, 4) with { briefly "MCC" described by "Merchant category code." }
  } with {
    briefly "Merchant details"
    described by "Merchant information."
  }

} with {
  option is external
  briefly "External merchant service"
  described by "External merchant management."
}

// Settlement Service
context SettlementService is {

  command SubmitForSettlement is {
    paymentId is PaymentId with { briefly "Payment" described by "Payment ID." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Settlement amount." }
  } with {
    briefly "Submit for settlement"
    described by "Submits payment for settlement."
  }

  event SettlementSubmitted is {
    paymentId is PaymentId with { briefly "Payment" described by "Payment ID." }
    batchId is String(1, 50) with { briefly "Batch" described by "Settlement batch." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submission time." }
  } with {
    briefly "Settlement submitted"
    described by "Emitted when submitted for settlement."
  }

} with {
  option is external
  briefly "External settlement service"
  described by "External settlement processor."
}

// Notification Service
context NotificationService is {

  command SendPaymentNotification is {
    merchantId is MerchantId with { briefly "Merchant" described by "Merchant ID." }
    paymentId is PaymentId with { briefly "Payment" described by "Payment ID." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    message is String(1, 500) with { briefly "Message" described by "Message content." }
  } with {
    briefly "Send notification"
    described by "Sends payment notification."
  }

  event NotificationSent is {
    notificationId is UUID with { briefly "Notification" described by "Notification ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification was sent"
    described by "Emitted when notification is delivered."
  }

} with {
  option is external
  briefly "External notification service"
  described by "External notification system."
}

// 3D Secure Service
context ThreeDSecureService is {

  command InitiateAuthentication is {
    paymentId is PaymentId with { briefly "Payment" described by "Payment ID." }
    cardBrand is CardBrand with { briefly "Brand" described by "Card brand." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Payment amount." }
  } with {
    briefly "Initiate 3DS"
    described by "Initiates 3D Secure authentication."
  }

  event AuthenticationCompleted is {
    paymentId is PaymentId with { briefly "Payment" described by "Payment ID." }
    authenticated is Boolean with { briefly "Authenticated" described by "Is authenticated." }
    cavv is optional String(1, 50) with { briefly "CAVV" described by "Cardholder verification." }
  } with {
    briefly "3DS completed"
    described by "Emitted when 3DS completes."
  }

} with {
  option is external
  briefly "External 3DS service"
  described by "External 3D Secure authentication."
}
