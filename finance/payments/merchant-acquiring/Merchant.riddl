// Merchant Acquiring - Merchant Entity
entity Merchant is {
  // Commands
  command SubmitApplication is  {
    merchantId: MerchantId with {
      briefly "Merchant ID"
      described as {
        |New merchant identifier.
      }
    }
    business: BusinessInfo with {
      briefly "Business"
      described as {
        |Business information.
      }
    }
    contact: ContactInfo with {
      briefly "Contact"
      described as {
        |Primary contact.
      }
    }
    banking: BankingInfo with {
      briefly "Banking"
      described as {
        |Settlement account.
      }
    }
    volume: ProcessingVolume with {
      briefly "Volume"
      described as {
        |Expected volumes.
      }
    }
  } with {
    briefly "Submit application"
    described as {
      |Submits merchant application.
    }
  }
  command ApproveApplication is  {
    merchantId: MerchantId with {
      briefly "Merchant ID"
      described as {
        |Merchant identifier.
      }
    }
    decision: UnderwritingDecision with {
      briefly "Decision"
      described as {
        |Underwriting decision.
      }
    }
    pricing: PricingTerms with {
      briefly "Pricing"
      described as {
        |Approved pricing.
      }
    }
  } with {
    briefly "Approve application"
    described as {
      |Approves merchant application.
    }
  }
  command DeclineApplication is  {
    merchantId: MerchantId with {
      briefly "Merchant ID"
      described as {
        |Merchant identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Decline reason.
      }
    }
  } with {
    briefly "Decline application"
    described as {
      |Declines merchant application.
    }
  }
  command ActivateMerchant is  {
    merchantId: MerchantId with {
      briefly "Merchant ID"
      described as {
        |Merchant identifier.
      }
    }
    activatedBy: String(1,100) with {
      briefly "Activated by"
      described as {
        |Person activating.
      }
    }
  } with {
    briefly "Activate merchant"
    described as {
      |Activates merchant for processing.
    }
  }
  command UpdatePricing is  {
    merchantId: MerchantId with {
      briefly "Merchant ID"
      described as {
        |Merchant identifier.
      }
    }
    newPricing: PricingTerms with {
      briefly "New pricing"
      described as {
        |Updated pricing terms.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |When pricing takes effect.
      }
    }
  } with {
    briefly "Update pricing"
    described as {
      |Updates merchant pricing.
    }
  }
  command SuspendMerchant is  {
    merchantId: MerchantId with {
      briefly "Merchant ID"
      described as {
        |Merchant identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
  } with {
    briefly "Suspend merchant"
    described as {
      |Suspends merchant processing.
    }
  }
  command ReactivateMerchant is  {
    merchantId: MerchantId with {
      briefly "Merchant ID"
      described as {
        |Merchant identifier.
      }
    }
    notes: String(1,500)? with {
      briefly "Notes"
      described as {
        |Reactivation notes.
      }
    }
  } with {
    briefly "Reactivate merchant"
    described as {
      |Reactivates suspended merchant.
    }
  }
  command TerminateMerchant is  {
    merchantId: MerchantId with {
      briefly "Merchant ID"
      described as {
        |Merchant identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Termination reason.
      }
    }
    addToMatchList: Boolean with {
      briefly "MATCH list"
      described as {
        |Add to MATCH list.
      }
    }
  } with {
    briefly "Terminate merchant"
    described as {
      |Terminates merchant relationship.
    }
  }
  // Events
  event ApplicationSubmitted is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    business: BusinessInfo with {
      briefly "Business"
      described as {
        |Business info.
      }
    }
    contact: ContactInfo with {
      briefly "Contact"
      described as {
        |Contact info.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Application submitted"
    described as {
      |Emitted when application is submitted.
    }
  }
  event ApplicationApproved is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    decision: UnderwritingDecision with {
      briefly "Decision"
      described as {
        |Underwriting decision.
      }
    }
    pricing: PricingTerms with {
      briefly "Pricing"
      described as {
        |Approved pricing.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Application approved"
    described as {
      |Emitted when application is approved.
    }
  }
  event ApplicationDeclined is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Decline reason.
      }
    }
    declinedAt: TimeStamp with {
      briefly "Declined"
      described as {
        |Decline time.
      }
    }
  } with {
    briefly "Application declined"
    described as {
      |Emitted when application is declined.
    }
  }
  event MerchantActivated is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    activatedBy: String(1,100) with {
      briefly "Activated by"
      described as {
        |Person who activated.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Merchant activated"
    described as {
      |Emitted when merchant is activated.
    }
  }
  event PricingUpdated is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    oldPricing: PricingTerms with {
      briefly "Old"
      described as {
        |Previous pricing.
      }
    }
    newPricing: PricingTerms with {
      briefly "New"
      described as {
        |New pricing.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Effective date.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Pricing updated"
    described as {
      |Emitted when pricing changes.
    }
  }
  event MerchantSuspended is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
    suspendedAt: TimeStamp with {
      briefly "Suspended"
      described as {
        |Suspension time.
      }
    }
  } with {
    briefly "Merchant suspended"
    described as {
      |Emitted when merchant is suspended.
    }
  }
  event MerchantReactivated is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    notes: String(1,500)? with {
      briefly "Notes"
      described as {
        |Reactivation notes.
      }
    }
    reactivatedAt: TimeStamp with {
      briefly "Reactivated"
      described as {
        |Reactivation time.
      }
    }
  } with {
    briefly "Merchant reactivated"
    described as {
      |Emitted when merchant is reactivated.
    }
  }
  event MerchantTerminated is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Termination reason.
      }
    }
    addedToMatchList: Boolean with {
      briefly "MATCH"
      described as {
        |Added to MATCH list.
      }
    }
    terminatedAt: TimeStamp with {
      briefly "Terminated"
      described as {
        |Termination time.
      }
    }
  } with {
    briefly "Merchant terminated"
    described as {
      |Emitted when merchant is terminated.
    }
  }
  // State Records
  record ApplicationStateData is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    business: BusinessInfo with {
      briefly "Business"
      described as {
        |Business info.
      }
    }
    contact: ContactInfo with {
      briefly "Contact"
      described as {
        |Contact info.
      }
    }
    banking: BankingInfo with {
      briefly "Banking"
      described as {
        |Banking info.
      }
    }
    volume: ProcessingVolume with {
      briefly "Volume"
      described as {
        |Expected volumes.
      }
    }
    status: MerchantStatus with {
      briefly "Status"
      described as {
        |Application status.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Application state data"
    described as {
      |State data for application.
    }
  }
  record ApprovedStateData is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    business: BusinessInfo with {
      briefly "Business"
      described as {
        |Business info.
      }
    }
    contact: ContactInfo with {
      briefly "Contact"
      described as {
        |Contact info.
      }
    }
    banking: BankingInfo with {
      briefly "Banking"
      described as {
        |Banking info.
      }
    }
    decision: UnderwritingDecision with {
      briefly "Decision"
      described as {
        |Underwriting decision.
      }
    }
    pricing: PricingTerms with {
      briefly "Pricing"
      described as {
        |Approved pricing.
      }
    }
    status: MerchantStatus with {
      briefly "Status"
      described as {
        |Merchant status.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Approved state data"
    described as {
      |State data for approved merchant.
    }
  }
  record ActiveStateData is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    business: BusinessInfo with {
      briefly "Business"
      described as {
        |Business info.
      }
    }
    contact: ContactInfo with {
      briefly "Contact"
      described as {
        |Contact info.
      }
    }
    banking: BankingInfo with {
      briefly "Banking"
      described as {
        |Banking info.
      }
    }
    pricing: PricingTerms with {
      briefly "Pricing"
      described as {
        |Current pricing.
      }
    }
    riskLevel: RiskLevel with {
      briefly "Risk"
      described as {
        |Risk level.
      }
    }
    status: MerchantStatus with {
      briefly "Status"
      described as {
        |Merchant status.
      }
    }
    activatedAt: TimeStamp with {
      briefly "Activated"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Active state data"
    described as {
      |State data for active merchant.
    }
  }
  record SuspendedStateData is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    business: BusinessInfo with {
      briefly "Business"
      described as {
        |Business info.
      }
    }
    previousState: ActiveStateData with {
      briefly "Previous"
      described as {
        |Prior state.
      }
    }
    suspension: SuspensionInfo with {
      briefly "Suspension"
      described as {
        |Suspension details.
      }
    }
    status: MerchantStatus with {
      briefly "Status"
      described as {
        |Merchant status.
      }
    }
  } with {
    briefly "Suspended state data"
    described as {
      |State data for suspended merchant.
    }
  }
  record TerminatedStateData is  {
    merchantId: MerchantId with {
      briefly "Merchant"
      described as {
        |Merchant ID.
      }
    }
    business: BusinessInfo with {
      briefly "Business"
      described as {
        |Business info.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Termination reason.
      }
    }
    addedToMatchList: Boolean with {
      briefly "MATCH"
      described as {
        |On MATCH list.
      }
    }
    terminatedAt: TimeStamp with {
      briefly "Terminated"
      described as {
        |Termination time.
      }
    }
  } with {
    briefly "Terminated state data"
    described as {
      |State data for terminated merchant.
    }
  }
  // States
  state ApplicationState of type Merchant.ApplicationStateData
  state ApprovedState of type Merchant.ApprovedStateData
  state ActiveState of type Merchant.ActiveStateData
  state SuspendedState of type Merchant.SuspendedStateData
  state TerminatedState of type Merchant.TerminatedStateData
  // Handler
  handler MerchantHandler is {
    on command SubmitApplication is {
      morph entity MerchantContext.Merchant to state MerchantContext.Merchant.ApplicationState with command SubmitApplication
      tell event ApplicationSubmitted to entity MerchantContext.Merchant
    }
    on command ApproveApplication is {
      morph entity MerchantContext.Merchant to state MerchantContext.Merchant.ApprovedState with command ApproveApplication
      tell event ApplicationApproved to entity MerchantContext.Merchant
    }
    on command DeclineApplication is {
      tell event ApplicationDeclined to entity MerchantContext.Merchant
    }
    on command ActivateMerchant is {
      morph entity MerchantContext.Merchant to state MerchantContext.Merchant.ActiveState with command ActivateMerchant
      tell event MerchantActivated to entity MerchantContext.Merchant
    }
    on command UpdatePricing is {
      tell event PricingUpdated to entity MerchantContext.Merchant
    }
    on command SuspendMerchant is {
      morph entity MerchantContext.Merchant to state MerchantContext.Merchant.SuspendedState with command SuspendMerchant
      tell event MerchantSuspended to entity MerchantContext.Merchant
    }
    on command ReactivateMerchant is {
      morph entity MerchantContext.Merchant to state MerchantContext.Merchant.ActiveState with command ReactivateMerchant
      tell event MerchantReactivated to entity MerchantContext.Merchant
    }
    on command TerminateMerchant is {
      morph entity MerchantContext.Merchant to state MerchantContext.Merchant.TerminatedState with command TerminateMerchant
      tell event MerchantTerminated to entity MerchantContext.Merchant
    }
  } with {
    briefly "Processes merchant commands"
    described as {
      | Handles merchant lifecycle from application
      | through activation, suspension, and termination.
    }
  }
} with {
  briefly "Merchant aggregate"
  described as {
    | The Merchant entity manages merchant accounts from
    | onboarding through ongoing relationship management.
  }
}
