// Digital Wallet - External Contexts

// Card Tokenization Service
context TokenizationService is {

  command TokenizeCard is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    cardNumber is String(13, 19) with { briefly "Card" described by "Card number." }
    expiryMonth is Natural with { briefly "Month" described by "Expiry month." }
    expiryYear is Natural with { briefly "Year" described by "Expiry year." }
    cvv is String(3, 4) with { briefly "CVV" described by "Security code." }
  } with {
    briefly "Tokenize card"
    described by "Creates a payment token."
  }

  event CardTokenized is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    token is String(1, 100) with { briefly "Token" described by "Payment token." }
    last4 is String(4, 4) with { briefly "Last 4" described by "Last four digits." }
    brand is String(1, 20) with { briefly "Brand" described by "Card brand." }
  } with {
    briefly "Card tokenized"
    described by "Emitted when card is tokenized."
  }

} with {
  option is external
  briefly "External tokenization"
  described by "External card tokenization service."
}

// Payment Processor Service
context PaymentProcessorService is {

  command ProcessPayment is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    token is String(1, 100) with { briefly "Token" described by "Payment token." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Payment amount." }
    currency is String(3, 3) with { briefly "Currency" described by "Currency code." }
    merchantId is String(1, 50) with { briefly "Merchant" described by "Merchant ID." }
  } with {
    briefly "Process payment"
    described by "Processes card payment."
  }

  event PaymentProcessed is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    transactionId is String(1, 50) with { briefly "Transaction" described by "Processor transaction ID." }
    approved is Boolean with { briefly "Approved" described by "Is approved." }
    authCode is optional String(1, 20) with { briefly "Auth code" described by "Authorization code." }
  } with {
    briefly "Payment processed"
    described by "Emitted when payment is processed."
  }

} with {
  option is external
  briefly "External payment processor"
  described by "External card payment processing."
}

// Bank Transfer Service
context BankTransferService is {

  command InitiateACH is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    routingNumber is String(9, 9) with { briefly "Routing" described by "Routing number." }
    accountNumber is String(1, 17) with { briefly "Account" described by "Account number." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Transfer amount." }
    direction is String(1, 10) with { briefly "Direction" described by "Pull or push." }
  } with {
    briefly "Initiate ACH"
    described by "Initiates ACH transfer."
  }

  event ACHInitiated is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    transferId is String(1, 50) with { briefly "Transfer" described by "ACH transfer ID." }
    estimatedSettlement is Date with { briefly "Settlement" described by "Expected settlement." }
  } with {
    briefly "ACH initiated"
    described by "Emitted when ACH is started."
  }

  event ACHCompleted is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    transferId is String(1, 50) with { briefly "Transfer" described by "ACH transfer ID." }
    settledAt is TimeStamp with { briefly "Settled" described by "Settlement time." }
  } with {
    briefly "ACH completed"
    described by "Emitted when ACH settles."
  }

} with {
  option is external
  briefly "External bank transfer"
  described by "External ACH processing service."
}

// Identity Verification Service
context IdentityService is {

  command VerifyIdentity is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    userId is UserId with { briefly "User" described by "User ID." }
    documentType is String(1, 50) with { briefly "Document" described by "Document type." }
    documentData is String(1, 5000) with { briefly "Data" described by "Encoded document." }
  } with {
    briefly "Verify identity"
    described by "Verifies user identity."
  }

  event IdentityVerified is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    userId is UserId with { briefly "User" described by "User ID." }
    verified is Boolean with { briefly "Verified" described by "Is verified." }
    verificationLevel is String(1, 20) with { briefly "Level" described by "Verification level." }
  } with {
    briefly "Identity verified"
    described by "Emitted when verification completes."
  }

} with {
  option is external
  briefly "External identity verification"
  described by "External KYC/identity service."
}

// Fraud Detection Service
context FraudService is {

  command ScreenTransaction is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    transactionId is TransactionId with { briefly "Transaction" described by "Transaction ID." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Transaction amount." }
    transactionType is String(1, 20) with { briefly "Type" described by "Transaction type." }
  } with {
    briefly "Screen transaction"
    described by "Screens for fraud."
  }

  event FraudScreened is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    transactionId is TransactionId with { briefly "Transaction" described by "Transaction ID." }
    approved is Boolean with { briefly "Approved" described by "Passed screening." }
    riskScore is Decimal(5, 4) with { briefly "Risk" described by "Risk score." }
  } with {
    briefly "Fraud screened"
    described by "Emitted when screening completes."
  }

} with {
  option is external
  briefly "External fraud service"
  described by "External fraud detection system."
}

// Notification Service
context NotificationService is {

  command SendTransactionAlert is {
    walletId is WalletId with { briefly "Wallet" described by "Wallet ID." }
    userId is UserId with { briefly "User" described by "User ID." }
    alertType is String(1, 50) with { briefly "Type" described by "Alert type." }
    message is String(1, 500) with { briefly "Message" described by "Alert message." }
  } with {
    briefly "Send alert"
    described by "Sends transaction alert."
  }

  event AlertSent is {
    alertId is UUID with { briefly "Alert" described by "Alert ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Alert sent"
    described by "Emitted when alert is delivered."
  }

} with {
  option is external
  briefly "External notifications"
  described by "External notification system."
}
