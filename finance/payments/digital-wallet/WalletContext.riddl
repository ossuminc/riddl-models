// Digital Wallet - Wallet Context
context WalletContext is {
  include "types.riddl"
  include "Wallet.riddl"
  // Repository for wallet persistence
  repository WalletRepository is {
    schema WalletData is relational
      of wallets as type Wallet
        index on field Wallet.walletId
        index on field Wallet.userId

    handler WalletPersistence is {
      on command Wallet.CreateWallet is {
        prompt "Store new wallet"
      }
      on command Wallet.AddPaymentMethod is {
        prompt "Store linked payment method"
      }
      on command Wallet.RemovePaymentMethod is {
        prompt "Remove payment method"
      }
      on command Wallet.SetDefaultMethod is {
        prompt "Update default method"
      }
      on command Wallet.TopUpBalance is {
        prompt "Update wallet balance"
      }
      on command Wallet.MakePayment is {
        prompt "Record payment transaction"
      }
      on command Wallet.TransferFunds is {
        prompt "Record outgoing transfer"
      }
      on command Wallet.ReceiveFunds is {
        prompt "Record incoming transfer"
      }
      on command Wallet.WithdrawFunds is {
        prompt "Record withdrawal"
      }
      on command Wallet.SuspendWallet is {
        prompt "Update wallet to suspended"
      }
      on command Wallet.ReactivateWallet is {
        prompt "Update wallet to active"
      }
      on command Wallet.CloseWallet is {
        prompt "Update wallet to closed"
      }
    } with {
      briefly "Persists wallet commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Wallet data persistence"
    described as {
      | The WalletRepository provides persistent storage for
      | wallet accounts, transactions, and payment methods.
    }
  }
  // Projector for wallet analytics
  projector WalletAnalytics is {
    record WalletStats is  {
      totalWallets: Natural with {
        briefly "Wallets"
        described as {
          |Total wallets.
        }
      }
      activeWallets: Natural with {
        briefly "Active"
        described as {
          |Active wallets.
        }
      }
      totalBalance: Decimal(18,2) with {
        briefly "Balance"
        described as {
          |Total platform balance.
        }
      }
      dailyTransactions: Natural with {
        briefly "Daily"
        described as {
          |Daily transactions.
        }
      }
      dailyVolume: Decimal(15,2) with {
        briefly "Volume"
        described as {
          |Daily transaction volume.
        }
      }
      avgTransactionSize: Decimal(10,2) with {
        briefly "Avg size"
        described as {
          |Average transaction.
        }
      }
    } with {
      briefly "Wallet statistics"
      described as {
        |Platform wallet metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Wallet.WalletCreated is {
        prompt "Update wallet counts"
      }
      on event Wallet.PaymentMade is {
        prompt "Update payment metrics"
      }
      on event Wallet.FundsTransferred is {
        prompt "Update transfer metrics"
      }
      on event Wallet.BalanceToppedUp is {
        prompt "Update top-up metrics"
      }
    } with {
      briefly "Maintains wallet analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Wallet analytics projections"
    described as {
      |Maintains wallet platform analytics data.
    }
  }
} with {
  briefly "Bounded context for digital wallets"
  described as {
    | The WalletContext is the bounded context for digital
    | wallet management, payments, and P2P transfers.
  }
}
