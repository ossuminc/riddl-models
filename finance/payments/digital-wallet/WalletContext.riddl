// Digital Wallet - Wallet Context

context WalletContext is {

  include "types.riddl"
  include "Wallet.riddl"

  // Repository for wallet persistence
  repository WalletRepository is {
    schema WalletData is relational
      of wallets as Wallet
      index on field Wallet.walletId
      index on field Wallet.userId

    handler WalletPersistence is {
      on command Wallet.CreateWallet {
        prompt "Store new wallet"
      }
      on command Wallet.AddPaymentMethod {
        prompt "Store linked payment method"
      }
      on command Wallet.RemovePaymentMethod {
        prompt "Remove payment method"
      }
      on command Wallet.SetDefaultMethod {
        prompt "Update default method"
      }
      on command Wallet.TopUpBalance {
        prompt "Update wallet balance"
      }
      on command Wallet.MakePayment {
        prompt "Record payment transaction"
      }
      on command Wallet.TransferFunds {
        prompt "Record outgoing transfer"
      }
      on command Wallet.ReceiveFunds {
        prompt "Record incoming transfer"
      }
      on command Wallet.WithdrawFunds {
        prompt "Record withdrawal"
      }
      on command Wallet.SuspendWallet {
        prompt "Update wallet to suspended"
      }
      on command Wallet.ReactivateWallet {
        prompt "Update wallet to active"
      }
      on command Wallet.CloseWallet {
        prompt "Update wallet to closed"
      }
    } with {
      briefly "Persists wallet commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Wallet data persistence"
    described by {
      | The WalletRepository provides persistent storage for
      | wallet accounts, transactions, and payment methods.
    }
  }

  // Projector for wallet analytics
  projector WalletAnalytics is {
    updates repository WalletRepository

    record WalletStats is {
      totalWallets is Natural with { briefly "Wallets" described by "Total wallets." }
      activeWallets is Natural with { briefly "Active" described by "Active wallets." }
      totalBalance is Decimal(18, 2) with { briefly "Balance" described by "Total platform balance." }
      dailyTransactions is Natural with { briefly "Daily" described by "Daily transactions." }
      dailyVolume is Decimal(15, 2) with { briefly "Volume" described by "Daily transaction volume." }
      avgTransactionSize is Decimal(10, 2) with { briefly "Avg size" described by "Average transaction." }
    } with {
      briefly "Wallet statistics"
      described by "Platform wallet metrics."
    }

    handler AnalyticsHandler is {
      on event Wallet.WalletCreated {
        prompt "Update wallet counts"
      }
      on event Wallet.PaymentMade {
        prompt "Update payment metrics"
      }
      on event Wallet.FundsTransferred {
        prompt "Update transfer metrics"
      }
      on event Wallet.BalanceToppedUp {
        prompt "Update top-up metrics"
      }
    } with {
      briefly "Maintains wallet analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Wallet analytics projections"
    described by "Maintains wallet platform analytics data."
  }

} with {
  briefly "Bounded context for digital wallets"
  described by {
    | The WalletContext is the bounded context for digital
    | wallet management, payments, and P2P transfers.
  }
}
