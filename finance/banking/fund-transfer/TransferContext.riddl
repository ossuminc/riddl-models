// Fund Transfer - Transfer Context
context TransferContext is {
  include "types.riddl"
  include "Transfer.riddl"
  // Repository for transfer persistence
  repository TransferRepository is {
    schema TransferData is relational
      of transfers as type Transfer
        index on field Transfer.transferId
        index on field Transfer.info.sourceAccountId

    handler TransferPersistence is {
      on command Transfer.SubmitTransfer is {
        prompt "Store transfer record"
      }
      on command Transfer.ValidateTransfer is {
        prompt "Update transfer status to validated"
      }
      on command Transfer.ApplyFees is {
        prompt "Store transfer fees"
      }
      on command Transfer.ApplyExchangeRate is {
        prompt "Store exchange rate"
      }
      on command Transfer.RouteTransfer is {
        prompt "Update with network reference"
      }
      on command Transfer.ProcessTransfer is {
        prompt "Update transfer status"
      }
      on command Transfer.CompleteTransfer is {
        prompt "Update transfer to completed"
      }
      on command Transfer.ReturnTransfer is {
        prompt "Update transfer to returned"
      }
      on command Transfer.CancelTransfer is {
        prompt "Update transfer to cancelled"
      }
    } with {
      briefly "Persists transfer commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Transfer data persistence"
    described as {
      | The TransferRepository provides persistent storage for
      | fund transfers and payment tracking.
    }
  }
  // Projector for transfer analytics
  projector TransferAnalytics is {
    record TransferStats is  {
      transferType: TransferType with {
        briefly "Type"
        described as {
          |Transfer type.
        }
      }
      totalTransfers: Natural with {
        briefly "Transfers"
        described as {
          |Total transfers.
        }
      }
      totalVolume: Decimal(20,2) with {
        briefly "Volume"
        described as {
          |Total volume.
        }
      }
      avgAmount: Decimal(15,2) with {
        briefly "Average"
        described as {
          |Average amount.
        }
      }
      successRate: Decimal(5,4) with {
        briefly "Success"
        described as {
          |Success rate.
        }
      }
      avgProcessingTime: Duration with {
        briefly "Processing"
        described as {
          |Avg processing time.
        }
      }
    } with {
      briefly "Transfer statistics"
      described as {
        |Fund transfer metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Transfer.TransferSubmitted is {
        prompt "Update transfer counts"
      }
      on event Transfer.TransferCompleted is {
        prompt "Update completion metrics"
      }
      on event Transfer.TransferReturned is {
        prompt "Update return metrics"
      }
    } with {
      briefly "Maintains transfer analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Transfer analytics projections"
    described as {
      |Maintains fund transfer analytics data.
    }
  }
} with {
  briefly "Bounded context for transfers"
  described as {
    | The TransferContext is the bounded context for fund
    | transfers, payment routing, and settlement.
  }
}
