// Fund Transfer - External Contexts
// ACH Network Service
context ACHNetworkService is {
  command SubmitACHTransaction is  {
    transferId: TransferId with {
      briefly "Transfer"
      described as {
        |Transfer ID.
      }
    }
    routingNumber: String(9,9) with {
      briefly "Routing"
      described as {
        |Routing number.
      }
    }
    accountNumber: String(1,20) with {
      briefly "Account"
      described as {
        |Account number.
      }
    }
    amount: Decimal(15,2) with {
      briefly "Amount"
      described as {
        |Transfer amount.
      }
    }
  } with {
    briefly "Submit ACH"
    described as {
      |Submits ACH transaction.
    }
  }
  event ACHProcessed is  {
    transferId: TransferId with {
      briefly "Transfer"
      described as {
        |Transfer ID.
      }
    }
    traceNumber: String(1,20) with {
      briefly "Trace"
      described as {
        |ACH trace number.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Processing time.
      }
    }
  } with {
    briefly "ACH was processed"
    described as {
      |Emitted when ACH completes.
    }
  }
} with {
  option external()
  briefly "External ACH service"
  described as {
    |External ACH network connection.
  }
}
// Wire Network Service
context WireNetworkService is {
  command SubmitWire is  {
    transferId: TransferId with {
      briefly "Transfer"
      described as {
        |Transfer ID.
      }
    }
    swiftCode: String(8,11) with {
      briefly "SWIFT"
      described as {
        |SWIFT code.
      }
    }
    beneficiaryAccount: String(1,34) with {
      briefly "Account"
      described as {
        |Beneficiary account.
      }
    }
    amount: Decimal(15,2) with {
      briefly "Amount"
      described as {
        |Wire amount.
      }
    }
    currency: String(1,3) with {
      briefly "Currency"
      described as {
        |Wire currency.
      }
    }
  } with {
    briefly "Submit wire"
    described as {
      |Submits wire transfer.
    }
  }
  event WireProcessed is  {
    transferId: TransferId with {
      briefly "Transfer"
      described as {
        |Transfer ID.
      }
    }
    uetr: String(1,36) with {
      briefly "UETR"
      described as {
        |Unique end-to-end reference.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Processing time.
      }
    }
  } with {
    briefly "Wire was processed"
    described as {
      |Emitted when wire completes.
    }
  }
} with {
  option external()
  briefly "External wire service"
  described as {
    |External wire transfer network.
  }
}
// Foreign Exchange Service
context FXService is {
  query GetExchangeRate is  {
    fromCurrency: String(1,3) with {
      briefly "From"
      described as {
        |Source currency.
      }
    }
    toCurrency: String(1,3) with {
      briefly "To"
      described as {
        |Target currency.
      }
    }
    amount: Decimal(15,2) with {
      briefly "Amount"
      described as {
        |Exchange amount.
      }
    }
  } with {
    briefly "Get rate"
    described as {
      |Retrieves exchange rate.
    }
  }
  result ExchangeQuote is  {
    quotedRate: ExchangeRate with {
      briefly "Rate"
      described as {
        |Exchange rate.
      }
    }
    convertedAmount: Decimal(15,2) with {
      briefly "Amount"
      described as {
        |Converted amount.
      }
    }
    validUntil: TimeStamp with {
      briefly "Valid"
      described as {
        |Quote expiration.
      }
    }
  } with {
    briefly "Exchange quote"
    described as {
      |Currency exchange quote.
    }
  }
} with {
  option external()
  briefly "External FX service"
  described as {
    |External foreign exchange system.
  }
}
// Sanctions Screening Service
context SanctionsService is {
  command ScreenTransfer is  {
    transferId: TransferId with {
      briefly "Transfer"
      described as {
        |Transfer ID.
      }
    }
    beneficiaryName: String(1,100) with {
      briefly "Name"
      described as {
        |Beneficiary name.
      }
    }
    country: String(2,2) with {
      briefly "Country"
      described as {
        |Country code.
      }
    }
  } with {
    briefly "Screen transfer"
    described as {
      |Screens against sanctions.
    }
  }
  event ScreeningCompleted is  {
    transferId: TransferId with {
      briefly "Transfer"
      described as {
        |Transfer ID.
      }
    }
    passed: Boolean with {
      briefly "Passed"
      described as {
        |Screening passed.
      }
    }
    matchDetails: String(1,500)? with {
      briefly "Match"
      described as {
        |Match details.
      }
    }
  } with {
    briefly "Screening completed"
    described as {
      |Emitted when screening finishes.
    }
  }
} with {
  option external()
  briefly "External sanctions service"
  described as {
    |External sanctions screening system.
  }
}
// Account Service
context AccountService is {
  command DebitAccount is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    amount: Decimal(15,2) with {
      briefly "Amount"
      described as {
        |Debit amount.
      }
    }
    reference: String(1,50) with {
      briefly "Reference"
      described as {
        |Transaction reference.
      }
    }
  } with {
    briefly "Debit account"
    described as {
      |Debits source account.
    }
  }
  event AccountDebited is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    newBalance: Decimal(15,2) with {
      briefly "Balance"
      described as {
        |New balance.
      }
    }
    debitedAt: TimeStamp with {
      briefly "Debited"
      described as {
        |Debit time.
      }
    }
  } with {
    briefly "Account was debited"
    described as {
      |Emitted when debit completes.
    }
  }
} with {
  option external()
  briefly "External account service"
  described as {
    |External account management system.
  }
}
// Notification Service
context NotificationService is {
  command SendTransferNotification is  {
    customerId: CustomerId with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    transferId: TransferId with {
      briefly "Transfer"
      described as {
        |Transfer ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Message content.
      }
    }
  } with {
    briefly "Send notification"
    described as {
      |Sends transfer notification.
    }
  }
  event NotificationSent is  {
    notificationId: UUID with {
      briefly "Notification"
      described as {
        |Notification ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification was sent"
    described as {
      |Emitted when notification is delivered.
    }
  }
} with {
  option external()
  briefly "External notification service"
  described as {
    |External customer notification system.
  }
}
