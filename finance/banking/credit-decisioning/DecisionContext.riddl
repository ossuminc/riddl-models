// Credit Decisioning - Decision Context
context DecisionContext is {
  include "types.riddl"
  include "Decision.riddl"
  // Repository for decision persistence
  repository DecisionRepository is {
    schema DecisionData is relational
      of decisions as type Decision
        index on field Decision.decisionId
        index on field Decision.applicationId

    handler DecisionPersistence is {
      on command Decision.EvaluateApplication is {
        prompt "Store new decision record"
      }
      on command Decision.AddBureauData is {
        prompt "Store bureau data"
      }
      on command Decision.CalculateScore is {
        prompt "Store calculated scores"
      }
      on command Decision.ApplyPolicy is {
        prompt "Store policy results"
      }
      on command Decision.RenderDecision is {
        prompt "Store final decision"
      }
      on command Decision.ReferToUnderwriter is {
        prompt "Update status to manual review"
      }
      on command Decision.ApproveManually is {
        prompt "Store manual approval"
      }
      on command Decision.DeclineManually is {
        prompt "Store manual decline"
      }
      on command Decision.OverrideDecision is {
        prompt "Store override record"
      }
    } with {
      briefly "Persists decision commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Decision data persistence"
    described as {
      | The DecisionRepository provides persistent storage for
      | credit decisions and evaluation data.
    }
  }
  // Projector for decision analytics
  projector DecisionAnalytics is {
    record DecisionStats is  {
      totalApplications: Natural with {
        briefly "Total"
        described as {
          |Total applications.
        }
      }
      autoApprovalRate: Decimal(5,4) with {
        briefly "Auto approval"
        described as {
          |Auto-approval rate.
        }
      }
      manualReviewRate: Decimal(5,4) with {
        briefly "Manual review"
        described as {
          |Manual review rate.
        }
      }
      overallApprovalRate: Decimal(5,4) with {
        briefly "Approval"
        described as {
          |Overall approval rate.
        }
      }
      avgDecisionTime: Duration with {
        briefly "Avg time"
        described as {
          |Average decision time.
        }
      }
      avgApprovedAmount: Decimal(12,2) with {
        briefly "Avg amount"
        described as {
          |Average approved amount.
        }
      }
    } with {
      briefly "Decision statistics"
      described as {
        |Credit decisioning metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Decision.ApplicationEvaluationStarted is {
        prompt "Update application counts"
      }
      on event Decision.DecisionRendered is {
        prompt "Update decision metrics"
      }
      on event Decision.ManuallyApproved is {
        prompt "Update approval metrics"
      }
      on event Decision.ManuallyDeclined is {
        prompt "Update decline metrics"
      }
    } with {
      briefly "Maintains decision analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Decision analytics projections"
    described as {
      |Maintains credit decisioning analytics data.
    }
  }
} with {
  briefly "Bounded context for credit decisioning"
  described as {
    | The DecisionContext is the bounded context for credit
    | evaluation, scoring, and approval decisions.
  }
}
