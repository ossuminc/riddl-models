// Credit Decisioning - External Contexts

// Credit Bureau Service
context CreditBureauService is {

  command PullCreditReport is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    ssn is String(9, 9) with { briefly "SSN" described by "Social security number." }
    firstName is String(1, 100) with { briefly "First" described by "First name." }
    lastName is String(1, 100) with { briefly "Last" described by "Last name." }
    bureauName is String(1, 50) with { briefly "Bureau" described by "Bureau to query." }
  } with {
    briefly "Pull credit report"
    described by "Requests credit bureau report."
  }

  event CreditReportReceived is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    bureauData is CreditBureauData with { briefly "Data" described by "Bureau data." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Credit report received"
    described by "Emitted when report is returned."
  }

} with {
  option is external
  briefly "External credit bureau"
  described by "External credit bureau integration."
}

// Fraud Detection Service
context FraudService is {

  command CheckFraud is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    applicant is ApplicantInfo with { briefly "Applicant" described by "Applicant info." }
  } with {
    briefly "Check fraud"
    described by "Checks for fraud indicators."
  }

  event FraudCheckCompleted is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    fraudScore is Decimal(5, 4) with { briefly "Score" described by "Fraud risk score." }
    alerts is many optional String(1, 200) with { briefly "Alerts" described by "Fraud alerts." }
  } with {
    briefly "Fraud check completed"
    described by "Emitted when fraud check completes."
  }

} with {
  option is external
  briefly "External fraud service"
  described by "External fraud detection system."
}

// Identity Verification Service
context IdentityService is {

  command VerifyIdentity is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    ssn is String(9, 9) with { briefly "SSN" described by "Social security number." }
    firstName is String(1, 100) with { briefly "First" described by "First name." }
    lastName is String(1, 100) with { briefly "Last" described by "Last name." }
    dateOfBirth is Date with { briefly "DOB" described by "Date of birth." }
  } with {
    briefly "Verify identity"
    described by "Verifies applicant identity."
  }

  event IdentityVerified is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    verified is Boolean with { briefly "Verified" described by "Is verified." }
    confidenceScore is Decimal(5, 4) with { briefly "Confidence" described by "Verification confidence." }
  } with {
    briefly "Identity verified"
    described by "Emitted when verification completes."
  }

} with {
  option is external
  briefly "External identity service"
  described by "External KYC/identity verification."
}

// Income Verification Service
context IncomeService is {

  command VerifyIncome is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    applicantId is ApplicantId with { briefly "Applicant" described by "Applicant ID." }
    statedIncome is Decimal(12, 2) with { briefly "Stated" described by "Stated income." }
  } with {
    briefly "Verify income"
    described by "Verifies applicant income."
  }

  event IncomeVerified is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    verifiedIncome is Decimal(12, 2) with { briefly "Verified" described by "Verified income." }
    verificationMethod is String(1, 50) with { briefly "Method" described by "Verification method." }
  } with {
    briefly "Income verified"
    described by "Emitted when income is verified."
  }

} with {
  option is external
  briefly "External income verification"
  described by "External income verification service."
}

// Policy Engine Service
context PolicyEngineService is {

  command EvaluatePolicy is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    productType is ProductType with { briefly "Product" described by "Product type." }
    score is CreditScore with { briefly "Score" described by "Credit scores." }
    request is CreditRequest with { briefly "Request" described by "Credit request." }
  } with {
    briefly "Evaluate policy"
    described by "Runs policy rules."
  }

  event PolicyEvaluated is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    rules is many PolicyRule with { briefly "Rules" described by "Rule results." }
    recommendation is DecisionOutcome with { briefly "Recommendation" described by "Policy recommendation." }
  } with {
    briefly "Policy evaluated"
    described by "Emitted when policy evaluation completes."
  }

} with {
  option is external
  briefly "External policy engine"
  described by "External credit policy rules engine."
}

// Notification Service
context NotificationService is {

  command SendDecisionNotification is {
    decisionId is DecisionId with { briefly "Decision" described by "Decision ID." }
    applicantId is ApplicantId with { briefly "Applicant" described by "Applicant ID." }
    outcome is DecisionOutcome with { briefly "Outcome" described by "Decision outcome." }
  } with {
    briefly "Send notification"
    described by "Sends decision notification."
  }

  event NotificationSent is {
    notificationId is UUID with { briefly "Notification" described by "Notification ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification sent"
    described by "Emitted when notification is delivered."
  }

} with {
  option is external
  briefly "External notification service"
  described by "External notification system."
}
