// Loan Origination - External Contexts
// Credit Decisioning Service
context CreditDecisioningService is {
  command RequestDecision is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    borrower: BorrowerInfo with {
      briefly "Borrower"
      described as {
        |Borrower info.
      }
    }
    request: LoanRequest with {
      briefly "Request"
      described as {
        |Loan request.
      }
    }
  } with {
    briefly "Request decision"
    described as {
      |Requests credit decision.
    }
  }
  event DecisionReceived is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    approved: Boolean with {
      briefly "Approved"
      described as {
        |Is approved.
      }
    }
    approvedTerms: LoanTerms? with {
      briefly "Terms"
      described as {
        |Approved terms.
      }
    }
    declineReasons: String(1,200)* with {
      briefly "Reasons"
      described as {
        |Decline reasons.
      }
    }
  } with {
    briefly "Decision received"
    described as {
      |Emitted when decision is returned.
    }
  }
} with {
  option external()
  briefly "External credit decisioning"
  described as {
    |External credit decisioning service.
  }
}
// Document Verification Service
context DocumentVerificationService is {
  command VerifyDocument is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    documentId: DocumentId with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    documentType: DocumentType with {
      briefly "Type"
      described as {
        |Document type.
      }
    }
    documentUrl: URL with {
      briefly "URL"
      described as {
        |Document location.
      }
    }
  } with {
    briefly "Verify document"
    described as {
      |Verifies uploaded document.
    }
  }
  event DocumentVerified is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    documentId: DocumentId with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    valid: Boolean with {
      briefly "Valid"
      described as {
        |Is document valid.
      }
    }
    findings: String(1,200)* with {
      briefly "Findings"
      described as {
        |Verification findings.
      }
    }
  } with {
    briefly "Document verified"
    described as {
      |Emitted when verification completes.
    }
  }
} with {
  option external()
  briefly "External document verification"
  described as {
    |External document verification service.
  }
}
// Income Verification Service
context IncomeVerificationService is {
  command VerifyIncome is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    borrowerId: BorrowerId with {
      briefly "Borrower"
      described as {
        |Borrower ID.
      }
    }
    statedIncome: Decimal(12,2) with {
      briefly "Stated"
      described as {
        |Stated income.
      }
    }
  } with {
    briefly "Verify income"
    described as {
      |Verifies borrower income.
    }
  }
  event IncomeVerified is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    verifiedIncome: Decimal(12,2) with {
      briefly "Verified"
      described as {
        |Verified income.
      }
    }
    method: String(1,50) with {
      briefly "Method"
      described as {
        |Verification method.
      }
    }
  } with {
    briefly "Income verified"
    described as {
      |Emitted when income is verified.
    }
  }
} with {
  option external()
  briefly "External income verification"
  described as {
    |External income verification service.
  }
}
// Employment Verification Service
context EmploymentVerificationService is {
  command VerifyEmployment is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    borrowerId: BorrowerId with {
      briefly "Borrower"
      described as {
        |Borrower ID.
      }
    }
    employer: String(1,200) with {
      briefly "Employer"
      described as {
        |Employer name.
      }
    }
  } with {
    briefly "Verify employment"
    described as {
      |Verifies borrower employment.
    }
  }
  event EmploymentVerified is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    verified: Boolean with {
      briefly "Verified"
      described as {
        |Is verified.
      }
    }
    employmentStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Employment status.
      }
    }
    startDate: Date? with {
      briefly "Start"
      described as {
        |Employment start date.
      }
    }
  } with {
    briefly "Employment verified"
    described as {
      |Emitted when employment is verified.
    }
  }
} with {
  option external()
  briefly "External employment verification"
  described as {
    |External employment verification service.
  }
}
// Document Storage Service
context DocumentStorageService is {
  command StoreDocument is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    documentId: DocumentId with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    fileName: String(1,200) with {
      briefly "File"
      described as {
        |File name.
      }
    }
    contentUrl: URL with {
      briefly "Content"
      described as {
        |Document content URL.
      }
    }
  } with {
    briefly "Store document"
    described as {
      |Stores loan document.
    }
  }
  event DocumentStored is  {
    documentId: DocumentId with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    storageUrl: URL with {
      briefly "URL"
      described as {
        |Storage location.
      }
    }
    storedAt: TimeStamp with {
      briefly "Stored"
      described as {
        |Storage time.
      }
    }
  } with {
    briefly "Document stored"
    described as {
      |Emitted when document is stored.
    }
  }
} with {
  option external()
  briefly "External document storage"
  described as {
    |External document storage service.
  }
}
// Disbursement Service
context DisbursementService is {
  command DisburseFunds is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    amount: Decimal(12,2) with {
      briefly "Amount"
      described as {
        |Disbursement amount.
      }
    }
    accountNumber: String(1,50) with {
      briefly "Account"
      described as {
        |Target account.
      }
    }
    routingNumber: String(9,9) with {
      briefly "Routing"
      described as {
        |Routing number.
      }
    }
  } with {
    briefly "Disburse funds"
    described as {
      |Disburses loan funds.
    }
  }
  event FundsDisbursed is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    disbursementId: String(1,50) with {
      briefly "Disbursement"
      described as {
        |Disbursement ID.
      }
    }
    amount: Decimal(12,2) with {
      briefly "Amount"
      described as {
        |Disbursed amount.
      }
    }
    disbursedAt: TimeStamp with {
      briefly "Disbursed"
      described as {
        |Disbursement time.
      }
    }
  } with {
    briefly "Funds disbursed"
    described as {
      |Emitted when funds are sent.
    }
  }
} with {
  option external()
  briefly "External disbursement"
  described as {
    |External fund disbursement service.
  }
}
// Notification Service
context NotificationService is {
  command SendLoanNotification is  {
    loanId: LoanId with {
      briefly "Loan"
      described as {
        |Loan ID.
      }
    }
    borrowerId: BorrowerId with {
      briefly "Borrower"
      described as {
        |Borrower ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    message: String(1,2000) with {
      briefly "Message"
      described as {
        |Message content.
      }
    }
  } with {
    briefly "Send notification"
    described as {
      |Sends loan notification.
    }
  }
  event NotificationSent is  {
    notificationId: UUID with {
      briefly "Notification"
      described as {
        |Notification ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification sent"
    described as {
      |Emitted when notification is sent.
    }
  }
} with {
  option external()
  briefly "External notifications"
  described as {
    |External notification system.
  }
}
