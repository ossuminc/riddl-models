// Loan Origination - External Contexts

// Credit Decisioning Service
context CreditDecisioningService is {

  command RequestDecision is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    borrower is BorrowerInfo with { briefly "Borrower" described by "Borrower info." }
    request is LoanRequest with { briefly "Request" described by "Loan request." }
  } with {
    briefly "Request decision"
    described by "Requests credit decision."
  }

  event DecisionReceived is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    approved is Boolean with { briefly "Approved" described by "Is approved." }
    approvedTerms is optional LoanTerms with { briefly "Terms" described by "Approved terms." }
    declineReasons is many optional String(1, 200) with { briefly "Reasons" described by "Decline reasons." }
  } with {
    briefly "Decision received"
    described by "Emitted when decision is returned."
  }

} with {
  option is external
  briefly "External credit decisioning"
  described by "External credit decisioning service."
}

// Document Verification Service
context DocumentVerificationService is {

  command VerifyDocument is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    documentId is DocumentId with { briefly "Document" described by "Document ID." }
    documentType is DocumentType with { briefly "Type" described by "Document type." }
    documentUrl is URL with { briefly "URL" described by "Document location." }
  } with {
    briefly "Verify document"
    described by "Verifies uploaded document."
  }

  event DocumentVerified is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    documentId is DocumentId with { briefly "Document" described by "Document ID." }
    valid is Boolean with { briefly "Valid" described by "Is document valid." }
    findings is many optional String(1, 200) with { briefly "Findings" described by "Verification findings." }
  } with {
    briefly "Document verified"
    described by "Emitted when verification completes."
  }

} with {
  option is external
  briefly "External document verification"
  described by "External document verification service."
}

// Income Verification Service
context IncomeVerificationService is {

  command VerifyIncome is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    borrowerId is BorrowerId with { briefly "Borrower" described by "Borrower ID." }
    statedIncome is Decimal(12, 2) with { briefly "Stated" described by "Stated income." }
  } with {
    briefly "Verify income"
    described by "Verifies borrower income."
  }

  event IncomeVerified is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    verifiedIncome is Decimal(12, 2) with { briefly "Verified" described by "Verified income." }
    method is String(1, 50) with { briefly "Method" described by "Verification method." }
  } with {
    briefly "Income verified"
    described by "Emitted when income is verified."
  }

} with {
  option is external
  briefly "External income verification"
  described by "External income verification service."
}

// Employment Verification Service
context EmploymentVerificationService is {

  command VerifyEmployment is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    borrowerId is BorrowerId with { briefly "Borrower" described by "Borrower ID." }
    employer is String(1, 200) with { briefly "Employer" described by "Employer name." }
  } with {
    briefly "Verify employment"
    described by "Verifies borrower employment."
  }

  event EmploymentVerified is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    verified is Boolean with { briefly "Verified" described by "Is verified." }
    employmentStatus is String(1, 50) with { briefly "Status" described by "Employment status." }
    startDate is optional Date with { briefly "Start" described by "Employment start date." }
  } with {
    briefly "Employment verified"
    described by "Emitted when employment is verified."
  }

} with {
  option is external
  briefly "External employment verification"
  described by "External employment verification service."
}

// Document Storage Service
context DocumentStorageService is {

  command StoreDocument is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    documentId is DocumentId with { briefly "Document" described by "Document ID." }
    fileName is String(1, 200) with { briefly "File" described by "File name." }
    contentUrl is URL with { briefly "Content" described by "Document content URL." }
  } with {
    briefly "Store document"
    described by "Stores loan document."
  }

  event DocumentStored is {
    documentId is DocumentId with { briefly "Document" described by "Document ID." }
    storageUrl is URL with { briefly "URL" described by "Storage location." }
    storedAt is TimeStamp with { briefly "Stored" described by "Storage time." }
  } with {
    briefly "Document stored"
    described by "Emitted when document is stored."
  }

} with {
  option is external
  briefly "External document storage"
  described by "External document storage service."
}

// Disbursement Service
context DisbursementService is {

  command DisburseFunds is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Disbursement amount." }
    accountNumber is String(1, 50) with { briefly "Account" described by "Target account." }
    routingNumber is String(9, 9) with { briefly "Routing" described by "Routing number." }
  } with {
    briefly "Disburse funds"
    described by "Disburses loan funds."
  }

  event FundsDisbursed is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    disbursementId is String(1, 50) with { briefly "Disbursement" described by "Disbursement ID." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Disbursed amount." }
    disbursedAt is TimeStamp with { briefly "Disbursed" described by "Disbursement time." }
  } with {
    briefly "Funds disbursed"
    described by "Emitted when funds are sent."
  }

} with {
  option is external
  briefly "External disbursement"
  described by "External fund disbursement service."
}

// Notification Service
context NotificationService is {

  command SendLoanNotification is {
    loanId is LoanId with { briefly "Loan" described by "Loan ID." }
    borrowerId is BorrowerId with { briefly "Borrower" described by "Borrower ID." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    message is String(1, 2000) with { briefly "Message" described by "Message content." }
  } with {
    briefly "Send notification"
    described by "Sends loan notification."
  }

  event NotificationSent is {
    notificationId is UUID with { briefly "Notification" described by "Notification ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification sent"
    described by "Emitted when notification is sent."
  }

} with {
  option is external
  briefly "External notifications"
  described by "External notification system."
}
