// Account Management - Account Context
context AccountContext is {
  include "types.riddl"
  include "Account.riddl"
  // Repository for account persistence
  repository AccountRepository is {
    schema AccountData is relational
      of accounts as type Account
        index on field Account.accountId
        index on field Account.info.customerId

    handler AccountPersistence is {
      on command Account.OpenAccount is {
        prompt "Store account record"
      }
      on command Account.UpdateAccountInfo is {
        prompt "Update account info"
      }
      on command Account.AddAccountHolder is {
        prompt "Store account holder"
      }
      on command Account.RecordTransaction is {
        prompt "Store transaction and update balance"
      }
      on command Account.ProcessTransfer is {
        prompt "Record transfer"
      }
      on command Account.SetLimit is {
        prompt "Update account limit"
      }
      on command Account.ApplyFee is {
        prompt "Record fee transaction"
      }
      on command Account.FreezeAccount is {
        prompt "Update account status to frozen"
      }
      on command Account.UnfreezeAccount is {
        prompt "Update account status to active"
      }
      on command Account.CloseAccount is {
        prompt "Update account status to closed"
      }
    } with {
      briefly "Persists account commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Account data persistence"
    described as {
      | The AccountRepository provides persistent storage for
      | bank accounts, transactions, and balances.
    }
  }
  // Projector for account analytics
  projector AccountAnalytics is {
    record AccountStats is  {
      accountType: AccountType with {
        briefly "Type"
        described as {
          |Account type.
        }
      }
      totalAccounts: Natural with {
        briefly "Accounts"
        described as {
          |Total accounts.
        }
      }
      totalBalance: Decimal(20,2) with {
        briefly "Balance"
        described as {
          |Total balance.
        }
      }
      avgBalance: Decimal(15,2) with {
        briefly "Average"
        described as {
          |Average balance.
        }
      }
      dailyTransactions: Natural with {
        briefly "Transactions"
        described as {
          |Daily transactions.
        }
      }
      dailyVolume: Decimal(20,2) with {
        briefly "Volume"
        described as {
          |Daily volume.
        }
      }
    } with {
      briefly "Account statistics"
      described as {
        |Banking account metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Account.AccountOpened is {
        prompt "Update account counts"
      }
      on event Account.TransactionRecorded is {
        prompt "Update transaction metrics"
      }
      on event Account.AccountClosed is {
        prompt "Update closure metrics"
      }
    } with {
      briefly "Maintains account analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Account analytics projections"
    described as {
      |Maintains banking account analytics data.
    }
  }
} with {
  briefly "Bounded context for accounts"
  described as {
    | The AccountContext is the bounded context for bank
    | account management, transactions, and reporting.
  }
}
