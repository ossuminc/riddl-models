// Order Management - External Contexts
// Execution Venue Service
context ExecutionVenueService is {
  command RouteOrder is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    details: OrderDetails with {
      briefly "Details"
      described as {
        |Order details.
      }
    }
    preferredVenue: Exchange? with {
      briefly "Venue"
      described as {
        |Preferred venue.
      }
    }
  } with {
    briefly "Route order"
    described as {
      |Routes order to execution venue.
    }
  }
  event OrderRouted is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    venue: Exchange with {
      briefly "Venue"
      described as {
        |Routed venue.
      }
    }
    venueOrderId: String(1,50) with {
      briefly "Venue ID"
      described as {
        |Venue order reference.
      }
    }
    routedAt: TimeStamp with {
      briefly "Routed"
      described as {
        |Routing time.
      }
    }
  } with {
    briefly "Order routed"
    described as {
      |Emitted when order is routed.
    }
  }
  event VenueExecution is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    execution: Execution with {
      briefly "Execution"
      described as {
        |Execution details.
      }
    }
  } with {
    briefly "Venue execution"
    described as {
      |Emitted when venue reports fill.
    }
  }
} with {
  option external()
  briefly "External execution venue"
  described as {
    |External market execution service.
  }
}
// Risk Management Service
context RiskManagementService is {
  command CheckOrderRisk is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Trading account.
      }
    }
    details: OrderDetails with {
      briefly "Details"
      described as {
        |Order details.
      }
    }
  } with {
    briefly "Check order risk"
    described as {
      |Validates order against risk limits.
    }
  }
  event RiskCheckCompleted is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    checks: RiskCheck+ with {
      briefly "Checks"
      described as {
        |Risk check results.
      }
    }
    approved: Boolean with {
      briefly "Approved"
      described as {
        |Risk approved.
      }
    }
  } with {
    briefly "Risk check completed"
    described as {
      |Emitted when risk check completes.
    }
  }
} with {
  option external()
  briefly "External risk management"
  described as {
    |External pre-trade risk checking.
  }
}
// Compliance Service
context ComplianceService is {
  command CheckCompliance is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Trading account.
      }
    }
    details: OrderDetails with {
      briefly "Details"
      described as {
        |Order details.
      }
    }
  } with {
    briefly "Check compliance"
    described as {
      |Validates order against regulations.
    }
  }
  event ComplianceCheckCompleted is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    compliant: Boolean with {
      briefly "Compliant"
      described as {
        |Is compliant.
      }
    }
    violations: String(1,200)* with {
      briefly "Violations"
      described as {
        |Compliance violations.
      }
    }
  } with {
    briefly "Compliance check completed"
    described as {
      |Emitted when compliance check completes.
    }
  }
} with {
  option external()
  briefly "External compliance"
  described as {
    |External regulatory compliance checking.
  }
}
// Market Data Service
context MarketDataService is {
  command GetQuote is  {
    securityId: SecurityId with {
      briefly "Security"
      described as {
        |Security identifier.
      }
    }
  } with {
    briefly "Get quote"
    described as {
      |Requests current market quote.
    }
  }
  event QuoteReceived is  {
    securityId: SecurityId with {
      briefly "Security"
      described as {
        |Security identifier.
      }
    }
    bidPrice: Decimal(12,4) with {
      briefly "Bid"
      described as {
        |Bid price.
      }
    }
    askPrice: Decimal(12,4) with {
      briefly "Ask"
      described as {
        |Ask price.
      }
    }
    bidSize: Natural with {
      briefly "Bid size"
      described as {
        |Bid quantity.
      }
    }
    askSize: Natural with {
      briefly "Ask size"
      described as {
        |Ask quantity.
      }
    }
    lastPrice: Decimal(12,4) with {
      briefly "Last"
      described as {
        |Last trade price.
      }
    }
    asOf: TimeStamp with {
      briefly "As of"
      described as {
        |Quote timestamp.
      }
    }
  } with {
    briefly "Quote received"
    described as {
      |Emitted when quote is returned.
    }
  }
} with {
  option external()
  briefly "External market data"
  described as {
    |External market data service.
  }
}
// Account Service
context AccountService is {
  query GetAccountInfo is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
  } with {
    briefly "Get account info"
    described as {
      |Retrieves trading account info.
    }
  }
  result AccountInfo is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    buyingPower: Decimal(15,2) with {
      briefly "Buying power"
      described as {
        |Available buying power.
      }
    }
    cashBalance: Decimal(15,2) with {
      briefly "Cash"
      described as {
        |Cash balance.
      }
    }
    marginAvailable: Decimal(15,2) with {
      briefly "Margin"
      described as {
        |Available margin.
      }
    }
  } with {
    briefly "Account info"
    described as {
      |Trading account information.
    }
  }
} with {
  option external()
  briefly "External account service"
  described as {
    |External trading account service.
  }
}
// Notification Service
context NotificationService is {
  command SendOrderNotification is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Notification message.
      }
    }
  } with {
    briefly "Send notification"
    described as {
      |Sends order notification.
    }
  }
  event NotificationSent is  {
    notificationId: UUID with {
      briefly "Notification"
      described as {
        |Notification ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification sent"
    described as {
      |Emitted when notification is delivered.
    }
  }
} with {
  option external()
  briefly "External notifications"
  described as {
    |External notification system.
  }
}
