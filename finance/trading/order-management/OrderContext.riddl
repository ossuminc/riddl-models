// Order Management - Order Context
context OrderContext is {
  include "types.riddl"
  include "TradingOrder.riddl"
  // Repository for order persistence
  repository OrderRepository is {
    schema OrderData is relational
      of orders as type TradingOrder
        index on field TradingOrder.orderId
        index on field TradingOrder.details.accountId

    handler OrderPersistence is {
      on command TradingOrder.PlaceOrder is {
        prompt "Store new order"
      }
      on command TradingOrder.AcknowledgeOrder is {
        prompt "Update broker reference"
      }
      on command TradingOrder.ReportExecution is {
        prompt "Store execution record"
      }
      on command TradingOrder.FillOrder is {
        prompt "Update order to filled"
      }
      on command TradingOrder.AmendOrder is {
        prompt "Update order details"
      }
      on command TradingOrder.CancelOrder is {
        prompt "Update order to canceled"
      }
      on command TradingOrder.RejectOrder is {
        prompt "Update order to rejected"
      }
      on command TradingOrder.ExpireOrder is {
        prompt "Update order to expired"
      }
      on command TradingOrder.SuspendOrder is {
        prompt "Update order to suspended"
      }
      on command TradingOrder.ResumeOrder is {
        prompt "Update order to active"
      }
    } with {
      briefly "Persists order commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Order data persistence"
    described as {
      | The OrderRepository provides persistent storage for
      | trading orders, executions, and status history.
    }
  }
  // Projector for trading analytics
  projector TradingAnalytics is {
    record TradingStats is  {
      totalOrders: Natural with {
        briefly "Orders"
        described as {
          |Total orders.
        }
      }
      totalVolume: Decimal(18,2) with {
        briefly "Volume"
        described as {
          |Total traded value.
        }
      }
      fillRate: Decimal(5,4) with {
        briefly "Fill rate"
        described as {
          |Order fill rate.
        }
      }
      avgFillTime: Duration with {
        briefly "Avg time"
        described as {
          |Average fill time.
        }
      }
      cancelRate: Decimal(5,4) with {
        briefly "Cancel rate"
        described as {
          |Cancellation rate.
        }
      }
      totalCommissions: Decimal(15,2) with {
        briefly "Commissions"
        described as {
          |Total commissions.
        }
      }
    } with {
      briefly "Trading statistics"
      described as {
        |Trading activity metrics.
      }
    }
    handler AnalyticsHandler is {
      on event TradingOrder.OrderPlaced is {
        prompt "Update order counts"
      }
      on event TradingOrder.ExecutionReported is {
        prompt "Update execution metrics"
      }
      on event TradingOrder.OrderFilled is {
        prompt "Update fill metrics"
      }
      on event TradingOrder.OrderCanceled is {
        prompt "Update cancel metrics"
      }
    } with {
      briefly "Maintains trading analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Trading analytics projections"
    described as {
      |Maintains trading order analytics data.
    }
  }
} with {
  briefly "Bounded context for order management"
  described as {
    | The OrderContext is the bounded context for trading
    | order management, execution, and tracking.
  }
}
