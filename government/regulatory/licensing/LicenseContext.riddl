// Licensing - License Context

context LicenseContext is {

  include "types.riddl"
  include "License.riddl"

  // Repository
  repository LicenseRepository is {

    query FindLicenseById is {
      licenseId is LicenseId with {
        briefly "License"
        described by "License identifier."
      }
    } with {
      briefly "Find license by ID"
      described by "Retrieves license by identifier."
    }

    result LicenseResult is {
      license is License.ActiveStateData with {
        briefly "License"
        described by "License data."
      }
    } with {
      briefly "License result"
      described by "Returns license data."
    }

    query SearchLicenses is {
      profession is optional String(1, 200) with {
        briefly "Profession"
        described by "Filter by profession."
      }
      licenseType is optional LicenseType with {
        briefly "Type"
        described by "Filter by license type."
      }
      status is optional LicenseStatus with {
        briefly "Status"
        described by "Filter by status."
      }
      city is optional String(1, 100) with {
        briefly "City"
        described by "Filter by city."
      }
      state is optional String(2, 50) with {
        briefly "State"
        described by "Filter by state."
      }
    } with {
      briefly "Search licenses"
      described by "Searches licenses by criteria."
    }

    result LicensesResult is {
      licenses is many License.ActiveStateData with {
        briefly "Licenses"
        described by "Matching licenses."
      }
      totalCount is Natural with {
        briefly "Count"
        described by "Total matches."
      }
    } with {
      briefly "Licenses result"
      described by "Returns matching licenses."
    }

    query FindByApplicant is {
      applicantId is ApplicantId with {
        briefly "Applicant"
        described by "Applicant identifier."
      }
    } with {
      briefly "Find by applicant"
      described by "Finds licenses for applicant."
    }

    query FindExpiringLicenses is {
      expirationBefore is Date with {
        briefly "Before"
        described by "Expiration cutoff date."
      }
      profession is optional String(1, 200) with {
        briefly "Profession"
        described by "Filter by profession."
      }
    } with {
      briefly "Find expiring licenses"
      described by "Finds licenses expiring before date."
    }

    query FindByDisciplinaryStatus is {
      hasActiveAction is Boolean with {
        briefly "Active action"
        described by "Has active disciplinary action."
      }
      actionType is optional DisciplinaryAction with {
        briefly "Action type"
        described by "Filter by action type."
      }
    } with {
      briefly "Find by disciplinary status"
      described by "Finds licenses with disciplinary history."
    }

    handler LicenseRepositoryHandler is {
      on query FindLicenseById {
        ???
      }
      on query SearchLicenses {
        ???
      }
      on query FindByApplicant {
        ???
      }
      on query FindExpiringLicenses {
        ???
      }
      on query FindByDisciplinaryStatus {
        ???
      }
    } with {
      briefly "Handles repository queries"
      described by "Processes license queries."
    }

  } with {
    briefly "License repository"
    described by "Persistence for license records."
  }

  // Projector for analytics
  projector LicenseAnalytics is {

    record AnalyticsData is {
      totalApplications is Natural with {
        briefly "Applications"
        described by "Total applications."
      }
      pendingApplications is Natural with {
        briefly "Pending"
        described by "Pending applications."
      }
      approvedApplications is Natural with {
        briefly "Approved"
        described by "Approved applications."
      }
      deniedApplications is Natural with {
        briefly "Denied"
        described by "Denied applications."
      }
      activeLicenses is Natural with {
        briefly "Active"
        described by "Active licenses."
      }
      suspendedLicenses is Natural with {
        briefly "Suspended"
        described by "Suspended licenses."
      }
      revokedLicenses is Natural with {
        briefly "Revoked"
        described by "Revoked licenses."
      }
      expiringThisMonth is Natural with {
        briefly "Expiring"
        described by "Expiring this month."
      }
      totalRenewalRevenue is Decimal(12, 2) with {
        briefly "Revenue"
        described by "Renewal revenue."
      }
      openComplaints is Natural with {
        briefly "Complaints"
        described by "Open complaints."
      }
      averageProcessingDays is Decimal(5, 2) with {
        briefly "Processing days"
        described by "Average processing time."
      }
      applicationsByProfession is many ProfessionCount with {
        briefly "By profession"
        described by "Applications by profession."
      }
    } with {
      briefly "Analytics data"
      described by "License analytics metrics."
    }

    record ProfessionCount is {
      profession is String(1, 200) with {
        briefly "Profession"
        described by "Profession name."
      }
      count is Natural with {
        briefly "Count"
        described by "Application count."
      }
    } with {
      briefly "Profession count"
      described by "Count by profession."
    }

    handler AnalyticsHandler is {
      on event License.ApplicationSubmitted {
        ???
      }
      on event License.ApplicationApproved {
        ???
      }
      on event License.ApplicationDenied {
        ???
      }
      on event License.LicenseRenewed {
        ???
      }
      on event License.LicenseSuspended {
        ???
      }
      on event License.LicenseRevoked {
        ???
      }
      on event License.ComplaintFiled {
        ???
      }
      on event License.PaymentProcessed {
        ???
      }
    } with {
      briefly "Processes analytics events"
      described by "Updates analytics from license events."
    }

  } with {
    briefly "License analytics"
    described by "Projects license metrics for reporting."
  }

  // Projector for public license lookup
  projector PublicLicenseDirectory is {

    record DirectoryEntry is {
      licenseNumber is String(1, 50) with {
        briefly "Number"
        described by "License number."
      }
      profession is String(1, 200) with {
        briefly "Profession"
        described by "Licensed profession."
      }
      licenseeName is String(1, 200) with {
        briefly "Name"
        described by "Licensee name."
      }
      city is String(1, 100) with {
        briefly "City"
        described by "City."
      }
      state is String(2, 50) with {
        briefly "State"
        described by "State."
      }
      status is LicenseStatus with {
        briefly "Status"
        described by "License status."
      }
      issueDate is Date with {
        briefly "Issued"
        described by "Issue date."
      }
      expirationDate is Date with {
        briefly "Expires"
        described by "Expiration date."
      }
      hasPublicDisciplinaryAction is Boolean with {
        briefly "Disciplinary"
        described by "Has public disciplinary action."
      }
    } with {
      briefly "Directory entry"
      described by "Public license information."
    }

    handler DirectoryHandler is {
      on event License.ApplicationApproved {
        ???
      }
      on event License.LicenseRenewed {
        ???
      }
      on event License.LicenseSuspended {
        ???
      }
      on event License.LicenseRevoked {
        ???
      }
      on event License.LicenseReinstated {
        ???
      }
      on event License.DisciplinaryActionRecorded {
        ???
      }
    } with {
      briefly "Processes directory events"
      described by "Updates public directory from license events."
    }

  } with {
    briefly "Public license directory"
    described by "Projects public license verification data."
  }

} with {
  briefly "License context"
  described by {
    | The License context manages professional
    | and business license processing.
  }
}
