// Licensing - License Entity
entity License is {
  // Commands
  command SubmitApplication is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |New license identifier.
      }
    }
    application: LicenseApplication with {
      briefly "Application"
      described as {
        |Application details.
      }
    }
  } with {
    briefly "Submit application"
    described as {
      |Submits a license application.
    }
  }
  command UpdateApplication is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    updates: LicenseApplication with {
      briefly "Updates"
      described as {
        |Application updates.
      }
    }
  } with {
    briefly "Update application"
    described as {
      |Updates application details.
    }
  }
  command RequestAdditionalInfo is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    infoNeeded: String(1,1000) with {
      briefly "Info needed"
      described as {
        |Information requested.
      }
    }
    deadline: Date with {
      briefly "Deadline"
      described as {
        |Response deadline.
      }
    }
  } with {
    briefly "Request additional info"
    described as {
      |Requests more information.
    }
  }
  command VerifyCredentials is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    credentialType: String(1,50) with {
      briefly "Type"
      described as {
        |Credential type.
      }
    }
    verified: Boolean with {
      briefly "Verified"
      described as {
        |Verification result.
      }
    }
    verificationNotes: String(1,500)? with {
      briefly "Notes"
      described as {
        |Verification notes.
      }
    }
  } with {
    briefly "Verify credentials"
    described as {
      |Verifies applicant credentials.
    }
  }
  command RecordExamResult is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    examScore: ExamScore with {
      briefly "Score"
      described as {
        |Exam result.
      }
    }
  } with {
    briefly "Record exam result"
    described as {
      |Records examination results.
    }
  }
  command ApproveApplication is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    approvedBy: String(1,200) with {
      briefly "Approved by"
      described as {
        |Approving official.
      }
    }
    licenseDetails: LicenseDetails with {
      briefly "Details"
      described as {
        |License details.
      }
    }
  } with {
    briefly "Approve application"
    described as {
      |Approves and issues license.
    }
  }
  command DenyApplication is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    deniedBy: String(1,200) with {
      briefly "Denied by"
      described as {
        |Denying official.
      }
    }
    reason: String(1,1000) with {
      briefly "Reason"
      described as {
        |Denial reason.
      }
    }
    appealDeadline: Date with {
      briefly "Appeal deadline"
      described as {
        |Appeal filing deadline.
      }
    }
  } with {
    briefly "Deny application"
    described as {
      |Denies the application.
    }
  }
  command ProcessPayment is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    payment: FeePayment with {
      briefly "Payment"
      described as {
        |Payment details.
      }
    }
  } with {
    briefly "Process payment"
    described as {
      |Processes fee payment.
    }
  }
  command RenewLicense is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    renewal: RenewalInfo with {
      briefly "Renewal"
      described as {
        |Renewal details.
      }
    }
  } with {
    briefly "Renew license"
    described as {
      |Renews the license.
    }
  }
  command FileComplaint is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    complaint: ComplaintInfo with {
      briefly "Complaint"
      described as {
        |Complaint details.
      }
    }
  } with {
    briefly "File complaint"
    described as {
      |Files complaint against licensee.
    }
  }
  command RecordDisciplinaryAction is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    disciplinaryRecord: DisciplinaryRecord with {
      briefly "Record"
      described as {
        |Disciplinary action.
      }
    }
  } with {
    briefly "Record disciplinary action"
    described as {
      |Records enforcement action.
    }
  }
  command SuspendLicense is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Suspension start.
      }
    }
    endDate: Date? with {
      briefly "End"
      described as {
        |Suspension end.
      }
    }
  } with {
    briefly "Suspend license"
    described as {
      |Suspends the license.
    }
  }
  command RevokeLicense is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    reason: String(1,1000) with {
      briefly "Reason"
      described as {
        |Revocation reason.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Revocation date.
      }
    }
  } with {
    briefly "Revoke license"
    described as {
      |Revokes the license.
    }
  }
  command ReinstateLicense is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License identifier.
      }
    }
    conditions: String(1,500)* with {
      briefly "Conditions"
      described as {
        |Reinstatement conditions.
      }
    }
    reinstatedAt: TimeStamp with {
      briefly "Reinstated"
      described as {
        |Reinstatement time.
      }
    }
  } with {
    briefly "Reinstate license"
    described as {
      |Reinstates the license.
    }
  }
  // Events
  event ApplicationSubmitted is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    application: LicenseApplication with {
      briefly "Application"
      described as {
        |Application.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Application submitted"
    described as {
      |Emitted when application is filed.
    }
  }
  event ApplicationUpdated is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Application updated"
    described as {
      |Emitted when application is updated.
    }
  }
  event AdditionalInfoRequested is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    infoNeeded: String(1,1000) with {
      briefly "Info"
      described as {
        |Info requested.
      }
    }
    deadline: Date with {
      briefly "Deadline"
      described as {
        |Response deadline.
      }
    }
    requestedAt: TimeStamp with {
      briefly "Requested"
      described as {
        |Request time.
      }
    }
  } with {
    briefly "Info requested"
    described as {
      |Emitted when more info is needed.
    }
  }
  event CredentialsVerified is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    credentialType: String(1,50) with {
      briefly "Type"
      described as {
        |Credential type.
      }
    }
    verified: Boolean with {
      briefly "Verified"
      described as {
        |Result.
      }
    }
    verifiedAt: TimeStamp with {
      briefly "Verified"
      described as {
        |Verification time.
      }
    }
  } with {
    briefly "Credentials verified"
    described as {
      |Emitted when credentials checked.
    }
  }
  event ExamResultRecorded is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    examScore: ExamScore with {
      briefly "Score"
      described as {
        |Exam result.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Exam result recorded"
    described as {
      |Emitted when exam result is recorded.
    }
  }
  event ApplicationApproved is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    licenseDetails: LicenseDetails with {
      briefly "Details"
      described as {
        |License details.
      }
    }
    approvedBy: String(1,200) with {
      briefly "By"
      described as {
        |Approved by.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Application approved"
    described as {
      |Emitted when license is issued.
    }
  }
  event ApplicationDenied is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    reason: String(1,1000) with {
      briefly "Reason"
      described as {
        |Denial reason.
      }
    }
    appealDeadline: Date with {
      briefly "Appeal"
      described as {
        |Appeal deadline.
      }
    }
    deniedAt: TimeStamp with {
      briefly "Denied"
      described as {
        |Denial time.
      }
    }
  } with {
    briefly "Application denied"
    described as {
      |Emitted when application is denied.
    }
  }
  event PaymentProcessed is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    payment: FeePayment with {
      briefly "Payment"
      described as {
        |Payment.
      }
    }
  } with {
    briefly "Payment processed"
    described as {
      |Emitted when payment is received.
    }
  }
  event LicenseRenewed is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    newExpirationDate: Date with {
      briefly "Expires"
      described as {
        |New expiration.
      }
    }
    renewalCompletedAt: TimeStamp with {
      briefly "Renewed"
      described as {
        |Renewal time.
      }
    }
  } with {
    briefly "License renewed"
    described as {
      |Emitted when license is renewed.
    }
  }
  event ComplaintFiled is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    complaint: ComplaintInfo with {
      briefly "Complaint"
      described as {
        |Complaint.
      }
    }
  } with {
    briefly "Complaint filed"
    described as {
      |Emitted when complaint is filed.
    }
  }
  event DisciplinaryActionRecorded is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    disciplinaryRecord: DisciplinaryRecord with {
      briefly "Record"
      described as {
        |Action.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Disciplinary action recorded"
    described as {
      |Emitted for enforcement action.
    }
  }
  event LicenseSuspended is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Start date.
      }
    }
    suspendedAt: TimeStamp with {
      briefly "Suspended"
      described as {
        |Suspension time.
      }
    }
  } with {
    briefly "License suspended"
    described as {
      |Emitted when license is suspended.
    }
  }
  event LicenseRevoked is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    reason: String(1,1000) with {
      briefly "Reason"
      described as {
        |Revocation reason.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Effective date.
      }
    }
    revokedAt: TimeStamp with {
      briefly "Revoked"
      described as {
        |Revocation time.
      }
    }
  } with {
    briefly "License revoked"
    described as {
      |Emitted when license is revoked.
    }
  }
  event LicenseReinstated is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    reinstatedAt: TimeStamp with {
      briefly "Reinstated"
      described as {
        |Reinstatement time.
      }
    }
  } with {
    briefly "License reinstated"
    described as {
      |Emitted when license is reinstated.
    }
  }
  // State Records
  record ActiveStateData is  {
    licenseId: LicenseId with {
      briefly "License"
      described as {
        |License ID.
      }
    }
    application: LicenseApplication with {
      briefly "Application"
      described as {
        |Application.
      }
    }
    applicationStatus: ApplicationStatus with {
      briefly "App status"
      described as {
        |Application status.
      }
    }
    issuedLicenseDetails: LicenseDetails? with {
      briefly "Details"
      described as {
        |License details.
      }
    }
    licenseStatus: LicenseStatus with {
      briefly "License status"
      described as {
        |License status.
      }
    }
    currentRenewal: RenewalInfo? with {
      briefly "Renewal"
      described as {
        |Renewal info.
      }
    }
    complaints: ComplaintInfo* with {
      briefly "Complaints"
      described as {
        |Complaints.
      }
    }
    licenseeDisciplinaryHistory: DisciplinaryRecord* with {
      briefly "Disciplinary"
      described as {
        |Disciplinary history.
      }
    }
    payments: FeePayment* with {
      briefly "Payments"
      described as {
        |Payment history.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Active state"
    described as {
      |State for active license.
    }
  }
  // States
  state ActiveState of type License.ActiveStateData
  // Handler
  handler LicenseHandler is {
    on command SubmitApplication is {
      morph entity LicenseContext.License to state LicenseContext.License.ActiveState with command SubmitApplication
      tell event ApplicationSubmitted to entity LicenseContext.License
    }
    on command UpdateApplication is {
      tell event ApplicationUpdated to entity LicenseContext.License
    }
    on command RequestAdditionalInfo is {
      tell event AdditionalInfoRequested to entity LicenseContext.License
    }
    on command VerifyCredentials is {
      tell event CredentialsVerified to entity LicenseContext.License
    }
    on command RecordExamResult is {
      tell event ExamResultRecorded to entity LicenseContext.License
    }
    on command ApproveApplication is {
      tell event ApplicationApproved to entity LicenseContext.License
    }
    on command DenyApplication is {
      tell event ApplicationDenied to entity LicenseContext.License
    }
    on command ProcessPayment is {
      tell event PaymentProcessed to entity LicenseContext.License
    }
    on command RenewLicense is {
      tell event LicenseRenewed to entity LicenseContext.License
    }
    on command FileComplaint is {
      tell event ComplaintFiled to entity LicenseContext.License
    }
    on command RecordDisciplinaryAction is {
      tell event DisciplinaryActionRecorded to entity LicenseContext.License
    }
    on command SuspendLicense is {
      tell event LicenseSuspended to entity LicenseContext.License
    }
    on command RevokeLicense is {
      tell event LicenseRevoked to entity LicenseContext.License
    }
    on command ReinstateLicense is {
      tell event LicenseReinstated to entity LicenseContext.License
    }
  } with {
    briefly "Processes license commands"
    described as {
      | Handles license lifecycle from application
      | through renewal and enforcement.
    }
  }
} with {
  briefly "License aggregate"
  described as {
    | The License entity manages professional
    | and business licenses.
  }
}
