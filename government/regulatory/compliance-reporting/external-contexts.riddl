// Compliance Reporting - External Contexts
// Regulatory Portal Service
context RegulatoryPortalService is {
  command SubmitFiling is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    agencyId: RegulatoryAgencyId with {
      briefly "Agency"
      described as {
        |Agency ID.
      }
    }
    filingType: String(1,50) with {
      briefly "Type"
      described as {
        |Filing type.
      }
    }
    content: String(1,100000) with {
      briefly "Content"
      described as {
        |Filing content.
      }
    }
    attachments: URL* with {
      briefly "Attachments"
      described as {
        |Attachment URLs.
      }
    }
  } with {
    briefly "Submit filing"
    described as {
      |Submits filing to regulatory portal.
    }
  }
  event FilingSubmitted is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    filingId: FilingId with {
      briefly "Filing"
      described as {
        |Filing ID.
      }
    }
    confirmationNumber: String(1,50) with {
      briefly "Confirmation"
      described as {
        |Confirmation number.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Filing submitted"
    described as {
      |Emitted when filing is submitted.
    }
  }
  event FilingRejected is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    errorCode: String(1,50) with {
      briefly "Error"
      described as {
        |Error code.
      }
    }
    errorMessage: String(1,1000) with {
      briefly "Message"
      described as {
        |Error message.
      }
    }
    rejectedAt: TimeStamp with {
      briefly "Rejected"
      described as {
        |Rejection time.
      }
    }
  } with {
    briefly "Filing rejected"
    described as {
      |Emitted when filing is rejected.
    }
  }
  query GetFilingStatus is  {
    filingId: FilingId with {
      briefly "Filing"
      described as {
        |Filing ID.
      }
    }
  } with {
    briefly "Get filing status"
    described as {
      |Retrieves filing status from portal.
    }
  }
  result FilingStatus is  {
    filingId: FilingId with {
      briefly "Filing"
      described as {
        |Filing ID.
      }
    }
    status: String(1,50) with {
      briefly "Status"
      described as {
        |Filing status.
      }
    }
    lastUpdated: TimeStamp with {
      briefly "Updated"
      described as {
        |Last update time.
      }
    }
    agencyComments: String(1,2000)? with {
      briefly "Comments"
      described as {
        |Agency comments.
      }
    }
  } with {
    briefly "Filing status"
    described as {
      |Current filing status.
    }
  }
} with {
  option external()
  briefly "External regulatory portal"
  described as {
    |External regulatory agency submission portal.
  }
}
// Document Management Service
context DocumentManagementService is {
  command StoreDocument is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    documentName: String(1,200) with {
      briefly "Name"
      described as {
        |Document name.
      }
    }
    documentType: String(1,50) with {
      briefly "Type"
      described as {
        |Document type.
      }
    }
    content: String(1,100000) with {
      briefly "Content"
      described as {
        |Document content.
      }
    }
  } with {
    briefly "Store document"
    described as {
      |Stores compliance document.
    }
  }
  event DocumentStored is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    documentId: UUID with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    documentUrl: URL with {
      briefly "URL"
      described as {
        |Document URL.
      }
    }
    storedAt: TimeStamp with {
      briefly "Stored"
      described as {
        |Storage time.
      }
    }
  } with {
    briefly "Document stored"
    described as {
      |Emitted when document is stored.
    }
  }
  query GetDocument is  {
    documentId: UUID with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
  } with {
    briefly "Get document"
    described as {
      |Retrieves stored document.
    }
  }
  result DocumentContent is  {
    documentId: UUID with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    documentName: String(1,200) with {
      briefly "Name"
      described as {
        |Document name.
      }
    }
    content: String(1,100000) with {
      briefly "Content"
      described as {
        |Document content.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Document content"
    described as {
      |Retrieved document.
    }
  }
} with {
  option external()
  briefly "External document management"
  described as {
    |External document storage service.
  }
}
// Data Collection Service
context DataCollectionService is {
  command CollectReportData is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    requirement: ComplianceRequirement with {
      briefly "Requirement"
      described as {
        |Compliance requirement.
      }
    }
    period: ReportPeriod with {
      briefly "Period"
      described as {
        |Report period.
      }
    }
    dataSources: String(1,200)+ with {
      briefly "Sources"
      described as {
        |Data sources.
      }
    }
  } with {
    briefly "Collect data"
    described as {
      |Collects data for report.
    }
  }
  event DataCollected is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    dataPoints: Natural with {
      briefly "Points"
      described as {
        |Data points collected.
      }
    }
    collectedAt: TimeStamp with {
      briefly "Collected"
      described as {
        |Collection time.
      }
    }
  } with {
    briefly "Data collected"
    described as {
      |Emitted when data is collected.
    }
  }
  event DataCollectionFailed is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    failedSources: String(1,200)+ with {
      briefly "Failed"
      described as {
        |Failed data sources.
      }
    }
    errorMessage: String(1,1000) with {
      briefly "Error"
      described as {
        |Error message.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |Failure time.
      }
    }
  } with {
    briefly "Collection failed"
    described as {
      |Emitted when data collection fails.
    }
  }
} with {
  option external()
  briefly "External data collection"
  described as {
    |External data aggregation service.
  }
}
// Audit Management Service
context AuditManagementService is {
  command ScheduleAudit is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    auditType: String(1,50) with {
      briefly "Type"
      described as {
        |Audit type.
      }
    }
    scheduledDate: Date with {
      briefly "Date"
      described as {
        |Scheduled date.
      }
    }
    auditor: String(1,200) with {
      briefly "Auditor"
      described as {
        |Assigned auditor.
      }
    }
  } with {
    briefly "Schedule audit"
    described as {
      |Schedules compliance audit.
    }
  }
  event AuditScheduled is  {
    auditId: AuditId with {
      briefly "Audit"
      described as {
        |Audit ID.
      }
    }
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    scheduledDate: Date with {
      briefly "Date"
      described as {
        |Scheduled date.
      }
    }
    scheduledAt: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Scheduling time.
      }
    }
  } with {
    briefly "Audit scheduled"
    described as {
      |Emitted when audit is scheduled.
    }
  }
  command RecordAuditResults is  {
    auditId: AuditId with {
      briefly "Audit"
      described as {
        |Audit ID.
      }
    }
    findings: ComplianceFinding+ with {
      briefly "Findings"
      described as {
        |Audit findings.
      }
    }
    conclusion: String(1,2000) with {
      briefly "Conclusion"
      described as {
        |Audit conclusion.
      }
    }
    completedBy: String(1,200) with {
      briefly "Completed by"
      described as {
        |Auditor name.
      }
    }
  } with {
    briefly "Record results"
    described as {
      |Records audit results.
    }
  }
  event AuditCompleted is  {
    auditId: AuditId with {
      briefly "Audit"
      described as {
        |Audit ID.
      }
    }
    findingCount: Natural with {
      briefly "Findings"
      described as {
        |Number of findings.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Audit completed"
    described as {
      |Emitted when audit is completed.
    }
  }
} with {
  option external()
  briefly "External audit management"
  described as {
    |External audit scheduling and tracking service.
  }
}
// Notification Service
context NotificationService is {
  command SendDeadlineReminder is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    recipients: String(5,254)+ with {
      briefly "Recipients"
      described as {
        |Email recipients.
      }
    }
    daysUntilDue: Natural with {
      briefly "Days"
      described as {
        |Days until due.
      }
    }
  } with {
    briefly "Send reminder"
    described as {
      |Sends deadline reminder.
    }
  }
  event ReminderSent is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    recipientCount: Natural with {
      briefly "Recipients"
      described as {
        |Number notified.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Reminder sent"
    described as {
      |Emitted when reminder is sent.
    }
  }
  command SendSubmissionConfirmation is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    recipients: String(5,254)+ with {
      briefly "Recipients"
      described as {
        |Email recipients.
      }
    }
    confirmationNumber: String(1,50) with {
      briefly "Confirmation"
      described as {
        |Confirmation number.
      }
    }
  } with {
    briefly "Send confirmation"
    described as {
      |Sends submission confirmation.
    }
  }
  event ConfirmationSent is  {
    reportId: ReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Confirmation sent"
    described as {
      |Emitted when confirmation is sent.
    }
  }
} with {
  option external()
  briefly "External notifications"
  described as {
    |External notification service.
  }
}
// Regulatory Calendar Service
context RegulatoryCalendarService is {
  query GetUpcomingDeadlines is  {
    organizationId: OrganizationId with {
      briefly "Organization"
      described as {
        |Organization ID.
      }
    }
    daysAhead: Natural with {
      briefly "Days"
      described as {
        |Days to look ahead.
      }
    }
  } with {
    briefly "Get deadlines"
    described as {
      |Retrieves upcoming compliance deadlines.
    }
  }
  result UpcomingDeadlines is  {
    deadlines: ComplianceRequirement+ with {
      briefly "Deadlines"
      described as {
        |Upcoming requirements.
      }
    }
  } with {
    briefly "Upcoming deadlines"
    described as {
      |List of upcoming deadlines.
    }
  }
  command SubscribeToUpdates is  {
    organizationId: OrganizationId with {
      briefly "Organization"
      described as {
        |Organization ID.
      }
    }
    regulationCodes: String(1,50)+ with {
      briefly "Regulations"
      described as {
        |Regulation codes to track.
      }
    }
  } with {
    briefly "Subscribe to updates"
    described as {
      |Subscribes to regulatory updates.
    }
  }
  event SubscriptionCreated is  {
    organizationId: OrganizationId with {
      briefly "Organization"
      described as {
        |Organization ID.
      }
    }
    subscriptionId: UUID with {
      briefly "Subscription"
      described as {
        |Subscription ID.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Subscription created"
    described as {
      |Emitted when subscription is created.
    }
  }
} with {
  option external()
  briefly "External regulatory calendar"
  described as {
    |External regulatory deadline tracking service.
  }
}
