// Records Management - External Contexts

// NCIC (National Crime Information Center) Service
context NCICService is {

  query RunPersonCheck is {
    firstName is String(1, 100) with { briefly "First" described by "First name." }
    lastName is String(1, 100) with { briefly "Last" described by "Last name." }
    checkDateOfBirth is optional Date with { briefly "DOB" described by "Date of birth." }
    ssn is optional String(9, 9) with { briefly "SSN" described by "Social security number." }
  } with {
    briefly "Run person check"
    described by "Queries NCIC for person."
  }

  result PersonCheckResult is {
    warrants is many WarrantInfo with { briefly "Warrants" described by "Active warrants." }
    priorArrest is Boolean with { briefly "Prior arrest" described by "Has prior arrests." }
    isSexOffender is Boolean with { briefly "Sex offender" described by "Registered sex offender." }
    isGangMember is Boolean with { briefly "Gang member" described by "Known gang member." }
    alerts is many String(1, 200) with { briefly "Alerts" described by "Officer safety alerts." }
  } with {
    briefly "Person check result"
    described by "NCIC person query results."
  }

  type WarrantInfo is {
    warrantNumber is String(1, 50) with { briefly "Warrant" described by "Warrant number." }
    warrantType is String(1, 50) with { briefly "Type" described by "Warrant type." }
    warrantOffense is String(1, 200) with { briefly "Offense" described by "Offense description." }
    issuingJurisdiction is String(1, 100) with { briefly "Jurisdiction" described by "Issuing authority." }
    isExtraditable is Boolean with { briefly "Extraditable" described by "Will extradite." }
  } with {
    briefly "Warrant info"
    described by "Active warrant details."
  }

  query RunVehicleCheck is {
    checkLicensePlate is optional String(1, 20) with { briefly "Plate" described by "License plate." }
    vin is optional String(17, 17) with { briefly "VIN" described by "Vehicle ID number." }
  } with {
    briefly "Run vehicle check"
    described by "Queries NCIC for vehicle."
  }

  result VehicleCheckResult is {
    isStolen is Boolean with { briefly "Stolen" described by "Reported stolen." }
    isWanted is Boolean with { briefly "Wanted" described by "Wanted in connection." }
    registrationStatus is String(1, 50) with { briefly "Registration" described by "Registration status." }
    ownerInfo is optional PersonInfo with { briefly "Owner" described by "Registered owner." }
    alerts is many String(1, 200) with { briefly "Alerts" described by "Associated alerts." }
  } with {
    briefly "Vehicle check result"
    described by "NCIC vehicle query results."
  }

  query RunPropertyCheck is {
    checkSerialNumber is String(1, 100) with { briefly "Serial" described by "Item serial number." }
    itemType is String(1, 50) with { briefly "Type" described by "Item type." }
  } with {
    briefly "Run property check"
    described by "Queries NCIC for stolen property."
  }

  result PropertyCheckResult is {
    isStolen is Boolean with { briefly "Stolen" described by "Reported stolen." }
    reportingAgency is optional String(1, 100) with { briefly "Agency" described by "Reporting agency." }
    caseNumber is optional String(1, 50) with { briefly "Case" described by "Original case number." }
  } with {
    briefly "Property check result"
    described by "NCIC property query results."
  }

} with {
  option is external
  briefly "External NCIC service"
  described by "National crime information database."
}

// State DMV Service
context DMVService is {

  query GetDriverInfo is {
    driversLicense is String(1, 50) with { briefly "DL" described by "Driver's license number." }
    state is String(2, 2) with { briefly "State" described by "Issuing state." }
  } with {
    briefly "Get driver info"
    described by "Queries DMV for driver information."
  }

  result DriverInfoResult is {
    name is String(1, 200) with { briefly "Name" described by "Driver name." }
    address is Address with { briefly "Address" described by "Address on license." }
    dateOfBirth is Date with { briefly "DOB" described by "Date of birth." }
    licenseClass is String(1, 10) with { briefly "Class" described by "License class." }
    expirationDate is Date with { briefly "Expires" described by "License expiration." }
    status is String(1, 50) with { briefly "Status" described by "License status." }
    restrictions is many String(1, 100) with { briefly "Restrictions" described by "License restrictions." }
    endorsements is many String(1, 50) with { briefly "Endorsements" described by "License endorsements." }
    photoUrl is optional String(1, 500) with { briefly "Photo" described by "License photo URL." }
  } with {
    briefly "Driver info result"
    described by "DMV driver query results."
  }

  query GetVehicleRegistration is {
    registrationPlate is String(1, 20) with { briefly "Plate" described by "License plate." }
    plateState is String(2, 2) with { briefly "State" described by "Plate state." }
  } with {
    briefly "Get vehicle registration"
    described by "Queries vehicle registration."
  }

  result VehicleRegistrationResult is {
    owner is PersonInfo with { briefly "Owner" described by "Registered owner." }
    vehicle is VehicleInfo with { briefly "Vehicle" described by "Vehicle details." }
    registrationStatus is String(1, 50) with { briefly "Status" described by "Registration status." }
    expirationDate is Date with { briefly "Expires" described by "Registration expiration." }
  } with {
    briefly "Vehicle registration result"
    described by "DMV registration query results."
  }

} with {
  option is external
  briefly "External DMV service"
  described by "State department of motor vehicles."
}

// Prosecutor's Office Service
context ProsecutorService is {

  command SubmitCasePacket is {
    reportId is ReportId with { briefly "Report" described by "Report ID." }
    charges is many OffenseCode with { briefly "Charges" described by "Recommended charges." }
    caseNarrative is String(1, 10000) with { briefly "Narrative" described by "Case narrative." }
    evidenceList is many EvidenceId with { briefly "Evidence" described by "Evidence items." }
  } with {
    briefly "Submit case packet"
    described by "Submits case for prosecution review."
  }

  event CasePacketReceived is {
    reportId is ReportId with { briefly "Report" described by "Report ID." }
    prosecutorCaseId is String(1, 50) with { briefly "Case ID" described by "Prosecutor's case ID." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Case packet received"
    described by "Emitted when prosecutor receives case."
  }

  event ChargesFiledNotification is {
    reportId is ReportId with { briefly "Report" described by "Report ID." }
    prosecutorCaseId is String(1, 50) with { briefly "Case ID" described by "Prosecutor's case ID." }
    chargesFiled is many OffenseCode with { briefly "Charges" described by "Filed charges." }
    filedAt is TimeStamp with { briefly "Filed" described by "Filing time." }
  } with {
    briefly "Charges filed notification"
    described by "Emitted when charges are filed."
  }

  event CaseDeclinedNotification is {
    reportId is ReportId with { briefly "Report" described by "Report ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Decline reason." }
    declinedAt is TimeStamp with { briefly "Declined" described by "Decline time." }
  } with {
    briefly "Case declined notification"
    described by "Emitted when case is declined."
  }

} with {
  option is external
  briefly "External prosecutor service"
  described by "District attorney's office."
}

// Jail Management Service
context JailService is {

  query GetInmateStatus is {
    bookingNumber is String(1, 50) with { briefly "Booking" described by "Booking number." }
  } with {
    briefly "Get inmate status"
    described by "Queries inmate custody status."
  }

  result InmateStatusResult is {
    bookingNumber is String(1, 50) with { briefly "Booking" described by "Booking number." }
    inmate is PersonInfo with { briefly "Inmate" described by "Inmate info." }
    currentLocation is String(1, 100) with { briefly "Location" described by "Current housing." }
    status is String(1, 50) with { briefly "Status" described by "Custody status." }
    charges is many OffenseCode with { briefly "Charges" described by "Booking charges." }
    bondAmount is optional Decimal(10, 2) with { briefly "Bond" described by "Bond amount." }
    nextCourtDate is optional Date with { briefly "Court date" described by "Next court date." }
  } with {
    briefly "Inmate status result"
    described by "Jail inmate status."
  }

  event InmateReleased is {
    bookingNumber is String(1, 50) with { briefly "Booking" described by "Booking number." }
    releaseType is String(1, 50) with { briefly "Type" described by "Release type." }
    releasedAt is TimeStamp with { briefly "Released" described by "Release time." }
  } with {
    briefly "Inmate released"
    described by "Emitted when inmate is released."
  }

} with {
  option is external
  briefly "External jail service"
  described by "Jail management system."
}

// Court System Service
context CourtService is {

  event WarrantIssued is {
    warrantId is WarrantId with { briefly "Warrant" described by "Warrant ID." }
    personId is PersonId with { briefly "Person" described by "Subject of warrant." }
    warrantType is String(1, 50) with { briefly "Type" described by "Warrant type." }
    charges is many OffenseCode with { briefly "Charges" described by "Associated charges." }
    issuedAt is TimeStamp with { briefly "Issued" described by "Issue time." }
  } with {
    briefly "Warrant issued"
    described by "Emitted when court issues warrant."
  }

  event WarrantRecalled is {
    warrantId is WarrantId with { briefly "Warrant" described by "Warrant ID." }
    reason is String(1, 200) with { briefly "Reason" described by "Recall reason." }
    recalledAt is TimeStamp with { briefly "Recalled" described by "Recall time." }
  } with {
    briefly "Warrant recalled"
    described by "Emitted when warrant is recalled."
  }

  event ProtectiveOrderIssued is {
    orderId is UUID with { briefly "Order" described by "Order ID." }
    protectedParty is PersonInfo with { briefly "Protected" described by "Protected person." }
    restrainedParty is PersonInfo with { briefly "Restrained" described by "Restrained person." }
    conditions is many String(1, 500) with { briefly "Conditions" described by "Order conditions." }
    expirationDate is Date with { briefly "Expires" described by "Expiration date." }
    issuedAt is TimeStamp with { briefly "Issued" described by "Issue time." }
  } with {
    briefly "Protective order issued"
    described by "Emitted when protective order is issued."
  }

} with {
  option is external
  briefly "External court service"
  described by "Court records system."
}

// Evidence Lab Service
context EvidenceLabService is {

  command SubmitForAnalysis is {
    evidenceId is EvidenceId with { briefly "Evidence" described by "Evidence ID." }
    reportId is ReportId with { briefly "Report" described by "Associated report." }
    analysisType is String(1, 100) with { briefly "Type" described by "Analysis requested." }
    priority is String(1, 20) with { briefly "Priority" described by "Analysis priority." }
  } with {
    briefly "Submit for analysis"
    described by "Submits evidence for lab analysis."
  }

  event AnalysisReceived is {
    evidenceId is EvidenceId with { briefly "Evidence" described by "Evidence ID." }
    labCaseNumber is String(1, 50) with { briefly "Lab case" described by "Lab case number." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Analysis received"
    described by "Emitted when lab receives evidence."
  }

  event AnalysisCompleted is {
    evidenceId is EvidenceId with { briefly "Evidence" described by "Evidence ID." }
    labCaseNumber is String(1, 50) with { briefly "Lab case" described by "Lab case number." }
    findings is String(1, 5000) with { briefly "Findings" described by "Analysis findings." }
    analyst is String(1, 100) with { briefly "Analyst" described by "Performing analyst." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Analysis completed"
    described by "Emitted when analysis is complete."
  }

} with {
  option is external
  briefly "External evidence lab"
  described by "Forensic laboratory service."
}
