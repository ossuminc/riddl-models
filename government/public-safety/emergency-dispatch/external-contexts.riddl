// Emergency Dispatch - External Contexts
// AVL (Automatic Vehicle Location) Service
context AVLService is {
  query GetUnitLocation is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
  } with {
    briefly "Get unit location"
    described as {
      |Queries current unit GPS location.
    }
  }
  result UnitLocationResult is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    gpsLocation: GpsLocation with {
      briefly "Location"
      described as {
        |Current GPS location.
      }
    }
    speed: Decimal(5,2) with {
      briefly "Speed"
      described as {
        |Current speed (mph).
      }
    }
    heading: Natural with {
      briefly "Heading"
      described as {
        |Direction (degrees).
      }
    }
    timestamp: TimeStamp with {
      briefly "Time"
      described as {
        |Position timestamp.
      }
    }
  } with {
    briefly "Unit location result"
    described as {
      |Current unit location data.
    }
  }
  event UnitLocationUpdated is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    updatedGpsLocation: GpsLocation with {
      briefly "Location"
      described as {
        |New GPS location.
      }
    }
    speed: Decimal(5,2) with {
      briefly "Speed"
      described as {
        |Current speed.
      }
    }
    timestamp: TimeStamp with {
      briefly "Time"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Unit location updated"
    described as {
      |Emitted when unit position changes.
    }
  }
  query FindNearestUnits is  {
    latitude: Decimal(9,6) with {
      briefly "Latitude"
      described as {
        |Target latitude.
      }
    }
    longitude: Decimal(10,6) with {
      briefly "Longitude"
      described as {
        |Target longitude.
      }
    }
    filterUnitType: UnitType? with {
      briefly "Type"
      described as {
        |Filter by unit type.
      }
    }
    maxUnits: Natural with {
      briefly "Max"
      described as {
        |Maximum units to return.
      }
    }
  } with {
    briefly "Find nearest units"
    described as {
      |Finds available units closest to location.
    }
  }
  result NearestUnitsResult is  {
    units: NearbyUnit+ with {
      briefly "Units"
      described as {
        |Nearby units.
      }
    }
  } with {
    briefly "Nearest units result"
    described as {
      |List of nearest available units.
    }
  }
  type NearbyUnit is {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    unitNumber: String(1,20) with {
      briefly "Number"
      described as {
        |Unit number.
      }
    }
    nearbyUnitType: UnitType with {
      briefly "Type"
      described as {
        |Unit type.
      }
    }
    distanceMiles: Decimal(5,2) with {
      briefly "Distance"
      described as {
        |Distance in miles.
      }
    }
    estimatedMinutes: Natural with {
      briefly "ETA"
      described as {
        |Estimated arrival minutes.
      }
    }
  } with {
    briefly "Nearby unit"
    described as {
      |Unit with distance information.
    }
  }
} with {
  option external()
  briefly "External AVL service"
  described as {
    |Automatic vehicle location system.
  }
}
// Mobile Data Terminal Service
context MDTService is {
  command SendDispatchNotification is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    incidentId: IncidentId with {
      briefly "Incident"
      described as {
        |Incident ID.
      }
    }
    incidentDetails: IncidentDetails with {
      briefly "Details"
      described as {
        |Incident info.
      }
    }
  } with {
    briefly "Send dispatch notification"
    described as {
      |Sends incident to unit MDT.
    }
  }
  event DispatchAcknowledged is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    incidentId: IncidentId with {
      briefly "Incident"
      described as {
        |Incident ID.
      }
    }
    acknowledgedAt: TimeStamp with {
      briefly "Ack"
      described as {
        |Acknowledgment time.
      }
    }
  } with {
    briefly "Dispatch acknowledged"
    described as {
      |Emitted when unit acknowledges dispatch.
    }
  }
  command SendUnitMessage is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Message text.
      }
    }
    messagePriority: String(1,20) with {
      briefly "Priority"
      described as {
        |Message priority.
      }
    }
  } with {
    briefly "Send unit message"
    described as {
      |Sends message to unit MDT.
    }
  }
  event MessageReceived is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Message text.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Receipt time.
      }
    }
  } with {
    briefly "Message received"
    described as {
      |Emitted when unit sends message.
    }
  }
} with {
  option external()
  briefly "External MDT service"
  described as {
    |Mobile data terminal communication.
  }
}
// Radio System Service
context RadioService is {
  command RequestTalkgroup is  {
    incidentId: IncidentId with {
      briefly "Incident"
      described as {
        |Incident ID.
      }
    }
    talkgroupType: String(1,50) with {
      briefly "Type"
      described as {
        |Talkgroup type.
      }
    }
  } with {
    briefly "Request talkgroup"
    described as {
      |Requests dedicated talkgroup.
    }
  }
  event TalkgroupAssigned is  {
    incidentId: IncidentId with {
      briefly "Incident"
      described as {
        |Incident ID.
      }
    }
    talkgroupId: String(1,50) with {
      briefly "Talkgroup"
      described as {
        |Assigned talkgroup.
      }
    }
    frequency: String(1,20) with {
      briefly "Frequency"
      described as {
        |Radio frequency.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Talkgroup assigned"
    described as {
      |Emitted when talkgroup is assigned.
    }
  }
  event EmergencyButtonPressed is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    emergencyLocation: GpsLocation with {
      briefly "Location"
      described as {
        |Unit location.
      }
    }
    pressedAt: TimeStamp with {
      briefly "Pressed"
      described as {
        |Activation time.
      }
    }
  } with {
    briefly "Emergency button pressed"
    described as {
      |Emitted when officer activates emergency.
    }
  }
} with {
  option external()
  briefly "External radio service"
  described as {
    |Radio communication system.
  }
}
// GIS (Geographic Information System) Service
context GISService is {
  query GetAddressFromCoordinates is  {
    latitude: Decimal(9,6) with {
      briefly "Latitude"
      described as {
        |GPS latitude.
      }
    }
    longitude: Decimal(10,6) with {
      briefly "Longitude"
      described as {
        |GPS longitude.
      }
    }
  } with {
    briefly "Reverse geocode"
    described as {
      |Gets address from coordinates.
    }
  }
  result AddressResult is  {
    address: Address with {
      briefly "Address"
      described as {
        |Physical address.
      }
    }
    confidence: Decimal(3,2) with {
      briefly "Confidence"
      described as {
        |Match confidence.
      }
    }
  } with {
    briefly "Address result"
    described as {
      |Geocoded address.
    }
  }
  query GetCoordinatesFromAddress is  {
    address: Address with {
      briefly "Address"
      described as {
        |Physical address.
      }
    }
  } with {
    briefly "Geocode address"
    described as {
      |Gets coordinates from address.
    }
  }
  result CoordinatesResult is  {
    latitude: Decimal(9,6) with {
      briefly "Latitude"
      described as {
        |GPS latitude.
      }
    }
    longitude: Decimal(10,6) with {
      briefly "Longitude"
      described as {
        |GPS longitude.
      }
    }
    confidence: Decimal(3,2) with {
      briefly "Confidence"
      described as {
        |Match confidence.
      }
    }
  } with {
    briefly "Coordinates result"
    described as {
      |Geocoded coordinates.
    }
  }
  query GetDispatchZone is  {
    latitude: Decimal(9,6) with {
      briefly "Latitude"
      described as {
        |GPS latitude.
      }
    }
    longitude: Decimal(10,6) with {
      briefly "Longitude"
      described as {
        |GPS longitude.
      }
    }
  } with {
    briefly "Get dispatch zone"
    described as {
      |Determines dispatch zone for location.
    }
  }
  result DispatchZoneResult is  {
    zoneId: String(1,50) with {
      briefly "Zone"
      described as {
        |Dispatch zone ID.
      }
    }
    zoneName: String(1,100) with {
      briefly "Name"
      described as {
        |Zone name.
      }
    }
    jurisdiction: String(1,100) with {
      briefly "Jurisdiction"
      described as {
        |Responsible jurisdiction.
      }
    }
  } with {
    briefly "Dispatch zone result"
    described as {
      |Zone information for location.
    }
  }
  query GetHazards is  {
    address: Address with {
      briefly "Address"
      described as {
        |Location address.
      }
    }
  } with {
    briefly "Get hazards"
    described as {
      |Queries known hazards at location.
    }
  }
  result HazardsResult is  {
    hazards: LocationHazard+ with {
      briefly "Hazards"
      described as {
        |Known hazards.
      }
    }
  } with {
    briefly "Hazards result"
    described as {
      |Hazard information for location.
    }
  }
  type LocationHazard is {
    hazardType: String(1,100) with {
      briefly "Type"
      described as {
        |Hazard type.
      }
    }
    description: String(1,500) with {
      briefly "Description"
      described as {
        |Hazard description.
      }
    }
    severity: String(1,20) with {
      briefly "Severity"
      described as {
        |Severity level.
      }
    }
  } with {
    briefly "Location hazard"
    described as {
      |Known hazard at location.
    }
  }
} with {
  option external()
  briefly "External GIS service"
  described as {
    |Geographic information system.
  }
}
// E911 Service
context E911Service is {
  event IncomingCall is  {
    callId: CallId with {
      briefly "Call"
      described as {
        |Call ID.
      }
    }
    ani: String(10,20) with {
      briefly "ANI"
      described as {
        |Caller phone number.
      }
    }
    ali: Address? with {
      briefly "ALI"
      described as {
        |Caller location.
      }
    }
    callType: String(1,50) with {
      briefly "Type"
      described as {
        |Call type.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Call time.
      }
    }
  } with {
    briefly "Incoming call"
    described as {
      |Emitted when 911 call is received.
    }
  }
  event CallAnswered is  {
    callId: CallId with {
      briefly "Call"
      described as {
        |Call ID.
      }
    }
    dispatcherId: DispatcherId with {
      briefly "Dispatcher"
      described as {
        |Answering dispatcher.
      }
    }
    answeredAt: TimeStamp with {
      briefly "Answered"
      described as {
        |Answer time.
      }
    }
  } with {
    briefly "Call answered"
    described as {
      |Emitted when call is answered.
    }
  }
  event CallEnded is  {
    callId: CallId with {
      briefly "Call"
      described as {
        |Call ID.
      }
    }
    duration: Natural with {
      briefly "Duration"
      described as {
        |Call duration (seconds).
      }
    }
    endedAt: TimeStamp with {
      briefly "Ended"
      described as {
        |End time.
      }
    }
  } with {
    briefly "Call ended"
    described as {
      |Emitted when call ends.
    }
  }
  query GetCallRecording is  {
    callId: CallId with {
      briefly "Call"
      described as {
        |Call ID.
      }
    }
  } with {
    briefly "Get call recording"
    described as {
      |Retrieves call audio recording.
    }
  }
  result CallRecordingResult is  {
    callId: CallId with {
      briefly "Call"
      described as {
        |Call ID.
      }
    }
    recordingUrl: String(1,500) with {
      briefly "URL"
      described as {
        |Recording URL.
      }
    }
    durationSeconds: Natural with {
      briefly "Duration"
      described as {
        |Recording length.
      }
    }
  } with {
    briefly "Call recording result"
    described as {
      |Call recording information.
    }
  }
} with {
  option external()
  briefly "External E911 service"
  described as {
    |Enhanced 911 telephone system.
  }
}
// Records Management System
context RMSService is {
  query GetLocationHistory is  {
    address: Address with {
      briefly "Address"
      described as {
        |Location address.
      }
    }
  } with {
    briefly "Get location history"
    described as {
      |Queries previous incidents at location.
    }
  }
  result LocationHistoryResult is  {
    previousIncidents: PreviousIncident+ with {
      briefly "Incidents"
      described as {
        |Previous incidents.
      }
    }
    totalCount: Natural with {
      briefly "Count"
      described as {
        |Total incidents.
      }
    }
  } with {
    briefly "Location history result"
    described as {
      |Previous incident history.
    }
  }
  type PreviousIncident is {
    incidentNumber: String(1,50) with {
      briefly "Number"
      described as {
        |Incident number.
      }
    }
    previousIncidentType: String(1,100) with {
      briefly "Type"
      described as {
        |Incident type.
      }
    }
    incidentDate: Date with {
      briefly "Date"
      described as {
        |Incident date.
      }
    }
    previousDisposition: String(1,100) with {
      briefly "Disposition"
      described as {
        |How resolved.
      }
    }
  } with {
    briefly "Previous incident"
    described as {
      |Historical incident at location.
    }
  }
  query GetPersonWarnings is  {
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Person name.
      }
    }
    dateOfBirth: Date? with {
      briefly "DOB"
      described as {
        |Date of birth.
      }
    }
  } with {
    briefly "Get person warnings"
    described as {
      |Queries warnings for a person.
    }
  }
  result PersonWarningsResult is  {
    warnings: PersonWarning+ with {
      briefly "Warnings"
      described as {
        |Active warnings.
      }
    }
  } with {
    briefly "Person warnings result"
    described as {
      |Warnings for person.
    }
  }
  type PersonWarning is {
    warningType: String(1,100) with {
      briefly "Type"
      described as {
        |Warning type.
      }
    }
    description: String(1,500) with {
      briefly "Description"
      described as {
        |Warning details.
      }
    }
    expirationDate: Date? with {
      briefly "Expires"
      described as {
        |Expiration date.
      }
    }
  } with {
    briefly "Person warning"
    described as {
      |Warning about a person.
    }
  }
} with {
  option external()
  briefly "External RMS"
  described as {
    |Records management system.
  }
}
