// Benefits Administration - Benefit Entity
entity Benefit is {
  // Commands
  command SubmitApplication is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |New benefit identifier.
      }
    }
    programType: ProgramType with {
      briefly "Program"
      described as {
        |Program type.
      }
    }
    beneficiary: BeneficiaryInfo with {
      briefly "Beneficiary"
      described as {
        |Applicant info.
      }
    }
    household: HouseholdInfo with {
      briefly "Household"
      described as {
        |Household details.
      }
    }
  } with {
    briefly "Submit application"
    described as {
      |Submits benefit application.
    }
  }
  command UploadDocument is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    document: VerificationDocument with {
      briefly "Document"
      described as {
        |Supporting document.
      }
    }
  } with {
    briefly "Upload document"
    described as {
      |Uploads verification document.
    }
  }
  command VerifyDocument is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    documentType: String(1,100) with {
      briefly "Type"
      described as {
        |Document type.
      }
    }
    verified: Boolean with {
      briefly "Verified"
      described as {
        |Verification result.
      }
    }
    verifiedBy: String(1,100) with {
      briefly "By"
      described as {
        |Verifying agent.
      }
    }
  } with {
    briefly "Verify document"
    described as {
      |Verifies uploaded document.
    }
  }
  command DetermineEligibility is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    result: EligibilityResult with {
      briefly "Result"
      described as {
        |Eligibility result.
      }
    }
    determinedBy: String(1,100) with {
      briefly "By"
      described as {
        |Determining agent.
      }
    }
  } with {
    briefly "Determine eligibility"
    described as {
      |Determines benefit eligibility.
    }
  }
  command ApproveBenefit is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    monthlyAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Monthly benefit amount.
      }
    }
    frequency: PaymentFrequency with {
      briefly "Frequency"
      described as {
        |Payment frequency.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Benefit start date.
      }
    }
    approvedBy: String(1,100) with {
      briefly "By"
      described as {
        |Approving agent.
      }
    }
  } with {
    briefly "Approve benefit"
    described as {
      |Approves the benefit.
    }
  }
  command DenyBenefit is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    reason: String(1,1000) with {
      briefly "Reason"
      described as {
        |Denial reason.
      }
    }
    deniedBy: String(1,100) with {
      briefly "By"
      described as {
        |Denying agent.
      }
    }
  } with {
    briefly "Deny benefit"
    described as {
      |Denies the benefit application.
    }
  }
  command IssuePay is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    payment: PaymentInfo with {
      briefly "Payment"
      described as {
        |Payment details.
      }
    }
  } with {
    briefly "Issue payment"
    described as {
      |Issues benefit payment.
    }
  }
  command SuspendBenefit is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
    suspendedBy: String(1,100) with {
      briefly "By"
      described as {
        |Suspending agent.
      }
    }
  } with {
    briefly "Suspend benefit"
    described as {
      |Suspends benefit payments.
    }
  }
  command ReinstatedBenefit is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    reinstatedBy: String(1,100) with {
      briefly "By"
      described as {
        |Reinstating agent.
      }
    }
  } with {
    briefly "Reinstate benefit"
    described as {
      |Reinstates suspended benefit.
    }
  }
  command FileAppeal is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    appeal: AppealInfo with {
      briefly "Appeal"
      described as {
        |Appeal details.
      }
    }
  } with {
    briefly "File appeal"
    described as {
      |Files benefit appeal.
    }
  }
  command ResolveAppeal is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    appealId: UUID with {
      briefly "Appeal"
      described as {
        |Appeal identifier.
      }
    }
    decision: String(1,1000) with {
      briefly "Decision"
      described as {
        |Appeal decision.
      }
    }
    resolvedBy: String(1,100) with {
      briefly "By"
      described as {
        |Resolving official.
      }
    }
  } with {
    briefly "Resolve appeal"
    described as {
      |Resolves the appeal.
    }
  }
  command InitiateRecertification is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Recertification due date.
      }
    }
  } with {
    briefly "Initiate recertification"
    described as {
      |Starts recertification process.
    }
  }
  command CompleteRecertification is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    result: EligibilityResult with {
      briefly "Result"
      described as {
        |Recertification result.
      }
    }
    completedBy: String(1,100) with {
      briefly "By"
      described as {
        |Completing agent.
      }
    }
  } with {
    briefly "Complete recertification"
    described as {
      |Completes recertification.
    }
  }
  command UpdateHousehold is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    household: HouseholdInfo with {
      briefly "Household"
      described as {
        |Updated household info.
      }
    }
  } with {
    briefly "Update household"
    described as {
      |Updates household information.
    }
  }
  command TerminateBenefit is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Termination reason.
      }
    }
    terminatedBy: String(1,100) with {
      briefly "By"
      described as {
        |Terminating agent.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Termination date.
      }
    }
  } with {
    briefly "Terminate benefit"
    described as {
      |Terminates the benefit.
    }
  }
  // Events
  event ApplicationSubmitted is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    programType: ProgramType with {
      briefly "Program"
      described as {
        |Program type.
      }
    }
    beneficiary: BeneficiaryInfo with {
      briefly "Beneficiary"
      described as {
        |Applicant.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Application submitted"
    described as {
      |Emitted when application is submitted.
    }
  }
  event DocumentUploaded is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    document: VerificationDocument with {
      briefly "Document"
      described as {
        |Uploaded document.
      }
    }
  } with {
    briefly "Document uploaded"
    described as {
      |Emitted when document is uploaded.
    }
  }
  event DocumentVerified is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    documentType: String(1,100) with {
      briefly "Type"
      described as {
        |Document type.
      }
    }
    verified: Boolean with {
      briefly "Verified"
      described as {
        |Verification result.
      }
    }
    verifiedAt: TimeStamp with {
      briefly "Verified"
      described as {
        |Verification time.
      }
    }
  } with {
    briefly "Document verified"
    described as {
      |Emitted when document is verified.
    }
  }
  event EligibilityDetermined is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    result: EligibilityResult with {
      briefly "Result"
      described as {
        |Eligibility result.
      }
    }
  } with {
    briefly "Eligibility determined"
    described as {
      |Emitted when eligibility is determined.
    }
  }
  event BenefitApproved is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    monthlyAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Monthly amount.
      }
    }
    frequency: PaymentFrequency with {
      briefly "Frequency"
      described as {
        |Payment frequency.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Start date.
      }
    }
    approvedBy: String(1,100) with {
      briefly "By"
      described as {
        |Approved by.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Benefit approved"
    described as {
      |Emitted when benefit is approved.
    }
  }
  event BenefitDenied is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    reason: String(1,1000) with {
      briefly "Reason"
      described as {
        |Denial reason.
      }
    }
    deniedBy: String(1,100) with {
      briefly "By"
      described as {
        |Denied by.
      }
    }
    deniedAt: TimeStamp with {
      briefly "Denied"
      described as {
        |Denial time.
      }
    }
  } with {
    briefly "Benefit denied"
    described as {
      |Emitted when benefit is denied.
    }
  }
  event PaymentIssued is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    payment: PaymentInfo with {
      briefly "Payment"
      described as {
        |Payment details.
      }
    }
  } with {
    briefly "Payment issued"
    described as {
      |Emitted when payment is issued.
    }
  }
  event BenefitSuspended is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Suspension reason.
      }
    }
    suspendedAt: TimeStamp with {
      briefly "Suspended"
      described as {
        |Suspension time.
      }
    }
  } with {
    briefly "Benefit suspended"
    described as {
      |Emitted when benefit is suspended.
    }
  }
  event BenefitReinstated is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    reinstatedAt: TimeStamp with {
      briefly "Reinstated"
      described as {
        |Reinstatement time.
      }
    }
  } with {
    briefly "Benefit reinstated"
    described as {
      |Emitted when benefit is reinstated.
    }
  }
  event AppealFiled is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    appeal: AppealInfo with {
      briefly "Appeal"
      described as {
        |Appeal details.
      }
    }
  } with {
    briefly "Appeal filed"
    described as {
      |Emitted when appeal is filed.
    }
  }
  event AppealResolved is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    appealId: UUID with {
      briefly "Appeal"
      described as {
        |Appeal ID.
      }
    }
    decision: String(1,1000) with {
      briefly "Decision"
      described as {
        |Appeal decision.
      }
    }
    resolvedAt: TimeStamp with {
      briefly "Resolved"
      described as {
        |Resolution time.
      }
    }
  } with {
    briefly "Appeal resolved"
    described as {
      |Emitted when appeal is resolved.
    }
  }
  event RecertificationInitiated is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due date.
      }
    }
    initiatedAt: TimeStamp with {
      briefly "Initiated"
      described as {
        |Initiation time.
      }
    }
  } with {
    briefly "Recertification initiated"
    described as {
      |Emitted when recertification starts.
    }
  }
  event RecertificationCompleted is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    result: EligibilityResult with {
      briefly "Result"
      described as {
        |Recertification result.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Recertification completed"
    described as {
      |Emitted when recertification completes.
    }
  }
  event HouseholdUpdated is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Household updated"
    described as {
      |Emitted when household is updated.
    }
  }
  event BenefitTerminated is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Termination reason.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Effective date.
      }
    }
    terminatedAt: TimeStamp with {
      briefly "Terminated"
      described as {
        |Termination time.
      }
    }
  } with {
    briefly "Benefit terminated"
    described as {
      |Emitted when benefit is terminated.
    }
  }
  // State Records
  record ActiveStateData is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    programType: ProgramType with {
      briefly "Program"
      described as {
        |Program type.
      }
    }
    benefitStatus: BenefitStatus with {
      briefly "Status"
      described as {
        |Current status.
      }
    }
    beneficiary: BeneficiaryInfo with {
      briefly "Beneficiary"
      described as {
        |Beneficiary info.
      }
    }
    household: HouseholdInfo with {
      briefly "Household"
      described as {
        |Household info.
      }
    }
    eligibility: EligibilityResult? with {
      briefly "Eligibility"
      described as {
        |Eligibility result.
      }
    }
    updatedMonthlyAmount: Decimal(10,2)? with {
      briefly "Amount"
      described as {
        |Monthly benefit.
      }
    }
    updatedFrequency: PaymentFrequency? with {
      briefly "Frequency"
      described as {
        |Payment frequency.
      }
    }
    documents: VerificationDocument* with {
      briefly "Documents"
      described as {
        |Verification docs.
      }
    }
    payments: PaymentInfo* with {
      briefly "Payments"
      described as {
        |Payment history.
      }
    }
    appeals: AppealInfo* with {
      briefly "Appeals"
      described as {
        |Filed appeals.
      }
    }
    recertification: RecertificationInfo? with {
      briefly "Recert"
      described as {
        |Recertification.
      }
    }
    appliedAt: TimeStamp with {
      briefly "Applied"
      described as {
        |Application time.
      }
    }
    updatedApprovedAt: TimeStamp? with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
    updatedTerminatedAt: TimeStamp? with {
      briefly "Terminated"
      described as {
        |Termination time.
      }
    }
  } with {
    briefly "Active state"
    described as {
      |State for active benefit.
    }
  }
  // States
  state ActiveState of type Benefit.ActiveStateData
  // Handler
  handler BenefitHandler is {
    on command SubmitApplication is {
      morph entity BenefitContext.Benefit to state BenefitContext.Benefit.ActiveState with command SubmitApplication
      tell event ApplicationSubmitted to entity BenefitContext.Benefit
    }
    on command UploadDocument is {
      tell event DocumentUploaded to entity BenefitContext.Benefit
    }
    on command VerifyDocument is {
      tell event DocumentVerified to entity BenefitContext.Benefit
    }
    on command DetermineEligibility is {
      tell event EligibilityDetermined to entity BenefitContext.Benefit
    }
    on command ApproveBenefit is {
      tell event BenefitApproved to entity BenefitContext.Benefit
    }
    on command DenyBenefit is {
      tell event BenefitDenied to entity BenefitContext.Benefit
    }
    on command IssuePay is {
      tell event PaymentIssued to entity BenefitContext.Benefit
    }
    on command SuspendBenefit is {
      tell event BenefitSuspended to entity BenefitContext.Benefit
    }
    on command ReinstatedBenefit is {
      tell event BenefitReinstated to entity BenefitContext.Benefit
    }
    on command FileAppeal is {
      tell event AppealFiled to entity BenefitContext.Benefit
    }
    on command ResolveAppeal is {
      tell event AppealResolved to entity BenefitContext.Benefit
    }
    on command InitiateRecertification is {
      tell event RecertificationInitiated to entity BenefitContext.Benefit
    }
    on command CompleteRecertification is {
      tell event RecertificationCompleted to entity BenefitContext.Benefit
    }
    on command UpdateHousehold is {
      tell event HouseholdUpdated to entity BenefitContext.Benefit
    }
    on command TerminateBenefit is {
      tell event BenefitTerminated to entity BenefitContext.Benefit
    }
  } with {
    briefly "Processes benefit commands"
    described as {
      | Handles benefit lifecycle from application
      | through payment and termination.
    }
  }
} with {
  briefly "Benefit aggregate"
  described as {
    | The Benefit entity manages government
    | assistance benefits.
  }
}
