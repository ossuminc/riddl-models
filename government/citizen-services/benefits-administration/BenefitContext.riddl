// Benefits Administration - Benefit Context

context BenefitContext is {

  include "types.riddl"
  include "Benefit.riddl"

  // Repository
  repository BenefitRepository is {

    query FindBenefitById is {
      benefitId is BenefitId with {
        briefly "Benefit"
        described by "Benefit identifier."
      }
    } with {
      briefly "Find benefit by ID"
      described by "Retrieves benefit by identifier."
    }

    result BenefitResult is {
      benefit is Benefit.ActiveStateData with {
        briefly "Benefit"
        described by "Benefit data."
      }
    } with {
      briefly "Benefit result"
      described by "Returns benefit data."
    }

    query SearchBenefits is {
      filterProgramType is optional ProgramType with {
        briefly "Program"
        described by "Filter by program."
      }
      filterStatus is optional BenefitStatus with {
        briefly "Status"
        described by "Filter by status."
      }
    } with {
      briefly "Search benefits"
      described by "Searches benefits by criteria."
    }

    result BenefitsResult is {
      benefits is many Benefit.ActiveStateData with {
        briefly "Benefits"
        described by "Matching benefits."
      }
      totalCount is Natural with {
        briefly "Count"
        described by "Total matches."
      }
    } with {
      briefly "Benefits result"
      described by "Returns matching benefits."
    }

    query FindByBeneficiary is {
      beneficiaryId is BeneficiaryId with {
        briefly "Beneficiary"
        described by "Beneficiary identifier."
      }
    } with {
      briefly "Find by beneficiary"
      described by "Finds benefits for beneficiary."
    }

    query FindBySSN is {
      ssn is String(9, 9) with {
        briefly "SSN"
        described by "Social security number."
      }
    } with {
      briefly "Find by SSN"
      described by "Finds benefits by SSN."
    }

    query FindPendingRecertification is {
      daysUntilDue is Natural with {
        briefly "Days"
        described by "Days until due."
      }
    } with {
      briefly "Find pending recertification"
      described by "Finds benefits needing recert."
    }

    handler BenefitRepositoryHandler is {
      on query FindBenefitById {
        ???
      }
      on query SearchBenefits {
        ???
      }
      on query FindByBeneficiary {
        ???
      }
      on query FindBySSN {
        ???
      }
      on query FindPendingRecertification {
        ???
      }
    } with {
      briefly "Handles repository queries"
      described by "Processes benefit queries."
    }

  } with {
    briefly "Benefit repository"
    described by "Persistence for benefit records."
  }

  // Projector for program analytics
  projector ProgramAnalytics is {

    record AnalyticsData is {
      programStats is many ProgramStat with {
        briefly "Stats"
        described by "Per-program statistics."
      }
      totalBeneficiaries is Natural with {
        briefly "Beneficiaries"
        described by "Total beneficiaries."
      }
      totalMonthlyPayments is Decimal(14, 2) with {
        briefly "Monthly"
        described by "Total monthly payments."
      }
      approvalRate is Decimal(5, 2) with {
        briefly "Approval"
        described by "Approval rate."
      }
      pendingApplications is Natural with {
        briefly "Pending"
        described by "Pending applications."
      }
      overdueRecertifications is Natural with {
        briefly "Overdue"
        described by "Overdue recertifications."
      }
    } with {
      briefly "Analytics data"
      described by "Program analytics."
    }

    record ProgramStat is {
      programType is ProgramType with {
        briefly "Program"
        described by "Program type."
      }
      activeBenefits is Natural with {
        briefly "Active"
        described by "Active benefits."
      }
      monthlyPayments is Decimal(12, 2) with {
        briefly "Monthly"
        described by "Monthly payments."
      }
      averageBenefit is Decimal(10, 2) with {
        briefly "Average"
        described by "Average benefit."
      }
    } with {
      briefly "Program stat"
      described by "Statistics for program."
    }

    handler AnalyticsHandler is {
      on event Benefit.ApplicationSubmitted {
        ???
      }
      on event Benefit.BenefitApproved {
        ???
      }
      on event Benefit.BenefitDenied {
        ???
      }
      on event Benefit.PaymentIssued {
        ???
      }
      on event Benefit.BenefitTerminated {
        ???
      }
    } with {
      briefly "Processes analytics events"
      described by "Updates program analytics."
    }

  } with {
    briefly "Program analytics"
    described by "Projects program metrics for reporting."
  }

} with {
  briefly "Benefit context"
  described by {
    | The Benefit context manages government
    | assistance programs.
  }
}
