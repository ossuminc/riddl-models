// Benefits Administration - External Contexts
// Identity Verification Service
context IdentityVerificationService is {
  command VerifyIdentity is  {
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    ssn: String(9,9) with {
      briefly "SSN"
      described as {
        |Social security number.
      }
    }
    firstName: String(1,100) with {
      briefly "First"
      described as {
        |First name.
      }
    }
    lastName: String(1,100) with {
      briefly "Last"
      described as {
        |Last name.
      }
    }
    dateOfBirth: Date with {
      briefly "DOB"
      described as {
        |Date of birth.
      }
    }
  } with {
    briefly "Verify identity"
    described as {
      |Verifies beneficiary identity.
    }
  }
  event IdentityVerified is  {
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    verified: Boolean with {
      briefly "Verified"
      described as {
        |Verification result.
      }
    }
    confidence: Decimal(3,2) with {
      briefly "Confidence"
      described as {
        |Match confidence.
      }
    }
    verifiedAt: TimeStamp with {
      briefly "Verified"
      described as {
        |Verification time.
      }
    }
  } with {
    briefly "Identity verified"
    described as {
      |Emitted when identity is verified.
    }
  }
} with {
  option external()
  briefly "External identity service"
  described as {
    |Identity verification service.
  }
}
// Income Verification Service
context IncomeVerificationService is {
  query GetWageData is  {
    ssn: String(9,9) with {
      briefly "SSN"
      described as {
        |Social security number.
      }
    }
    quarters: Natural with {
      briefly "Quarters"
      described as {
        |Quarters to retrieve.
      }
    }
  } with {
    briefly "Get wage data"
    described as {
      |Retrieves wage history.
    }
  }
  result WageDataResult is  {
    totalIncome: Decimal(12,2) with {
      briefly "Total"
      described as {
        |Total income.
      }
    }
    quarterlyWages: QuarterlyWage+ with {
      briefly "Wages"
      described as {
        |Quarterly wages.
      }
    }
  } with {
    briefly "Wage data result"
    described as {
      |Wage history data.
    }
  }
  type QuarterlyWage is {
    quarter: String(1,10) with {
      briefly "Quarter"
      described as {
        |Quarter (YYYY-Q).
      }
    }
    employer: String(1,200) with {
      briefly "Employer"
      described as {
        |Employer name.
      }
    }
    wages: Decimal(10,2) with {
      briefly "Wages"
      described as {
        |Wages paid.
      }
    }
  } with {
    briefly "Quarterly wage"
    described as {
      |Wages for a quarter.
    }
  }
} with {
  option external()
  briefly "External income service"
  described as {
    |Wage and income verification.
  }
}
// Payment Processing Service
context PaymentProcessingService is {
  command ProcessPayment is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    paymentMethod: String(1,50) with {
      briefly "Method"
      described as {
        |Payment method.
      }
    }
  } with {
    briefly "Process payment"
    described as {
      |Processes benefit payment.
    }
  }
  event PaymentProcessed is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    paymentId: PaymentId with {
      briefly "Payment"
      described as {
        |Payment ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    confirmationNumber: String(1,50) with {
      briefly "Confirmation"
      described as {
        |Confirmation number.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Processing time.
      }
    }
  } with {
    briefly "Payment processed"
    described as {
      |Emitted when payment completes.
    }
  }
  event PaymentFailed is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    reason: String(1,200) with {
      briefly "Reason"
      described as {
        |Failure reason.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |Failure time.
      }
    }
  } with {
    briefly "Payment failed"
    described as {
      |Emitted when payment fails.
    }
  }
} with {
  option external()
  briefly "External payment service"
  described as {
    |Benefit payment processing.
  }
}
// EBT Card Service
context EBTCardService is {
  command IssueCard is  {
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    cardType: String(1,50) with {
      briefly "Type"
      described as {
        |Card type.
      }
    }
  } with {
    briefly "Issue card"
    described as {
      |Issues new EBT card.
    }
  }
  event CardIssued is  {
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    cardNumber: String(16,16) with {
      briefly "Card"
      described as {
        |Card number (masked).
      }
    }
    issuedAt: TimeStamp with {
      briefly "Issued"
      described as {
        |Issue time.
      }
    }
  } with {
    briefly "Card issued"
    described as {
      |Emitted when card is issued.
    }
  }
  command ReplaceCard is  {
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    reason: String(1,100) with {
      briefly "Reason"
      described as {
        |Replacement reason.
      }
    }
  } with {
    briefly "Replace card"
    described as {
      |Replaces EBT card.
    }
  }
  event CardReplaced is  {
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    newCardNumber: String(16,16) with {
      briefly "New card"
      described as {
        |New card number.
      }
    }
    replacedAt: TimeStamp with {
      briefly "Replaced"
      described as {
        |Replacement time.
      }
    }
  } with {
    briefly "Card replaced"
    described as {
      |Emitted when card is replaced.
    }
  }
  query GetCardBalance is  {
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
  } with {
    briefly "Get card balance"
    described as {
      |Queries EBT card balance.
    }
  }
  result CardBalanceResult is  {
    balance: Decimal(10,2) with {
      briefly "Balance"
      described as {
        |Current balance.
      }
    }
    lastTransaction: TimeStamp? with {
      briefly "Last"
      described as {
        |Last transaction.
      }
    }
  } with {
    briefly "Card balance result"
    described as {
      |EBT card balance.
    }
  }
} with {
  option external()
  briefly "External EBT service"
  described as {
    |Electronic benefit transfer cards.
  }
}
// Notification Service
context NotificationService is {
  command SendNotification is  {
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    channel: String(1,20) with {
      briefly "Channel"
      described as {
        |Delivery channel.
      }
    }
    content: String(1,2000) with {
      briefly "Content"
      described as {
        |Message content.
      }
    }
  } with {
    briefly "Send notification"
    described as {
      |Sends notification to beneficiary.
    }
  }
  event NotificationSent is  {
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification sent"
    described as {
      |Emitted when notification is sent.
    }
  }
} with {
  option external()
  briefly "External notification service"
  described as {
    |Beneficiary notifications.
  }
}
// Fraud Detection Service
context FraudDetectionService is {
  command CheckForFraud is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    beneficiaryId: BeneficiaryId with {
      briefly "Beneficiary"
      described as {
        |Beneficiary ID.
      }
    }
    household: HouseholdInfo with {
      briefly "Household"
      described as {
        |Household info.
      }
    }
  } with {
    briefly "Check for fraud"
    described as {
      |Runs fraud detection checks.
    }
  }
  event FraudCheckCompleted is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    riskScore: Decimal(3,2) with {
      briefly "Risk"
      described as {
        |Risk score.
      }
    }
    flagged: Boolean with {
      briefly "Flagged"
      described as {
        |Flagged for review.
      }
    }
    checkCompletedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Check time.
      }
    }
  } with {
    briefly "Fraud check completed"
    described as {
      |Emitted when fraud check completes.
    }
  }
  event FraudAlert is  {
    benefitId: BenefitId with {
      briefly "Benefit"
      described as {
        |Benefit ID.
      }
    }
    alertType: String(1,100) with {
      briefly "Type"
      described as {
        |Alert type.
      }
    }
    description: String(1,500) with {
      briefly "Description"
      described as {
        |Alert details.
      }
    }
    alertedAt: TimeStamp with {
      briefly "Alerted"
      described as {
        |Alert time.
      }
    }
  } with {
    briefly "Fraud alert"
    described as {
      |Emitted when fraud is suspected.
    }
  }
} with {
  option external()
  briefly "External fraud detection"
  described as {
    |Benefits fraud detection service.
  }
}
