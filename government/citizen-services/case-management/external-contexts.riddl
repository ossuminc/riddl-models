// Case Management - External Contexts

// Identity Verification Service
context IdentityVerificationService is {

  command VerifyIdentity is {
    citizenId is CitizenId with { briefly "Citizen" described by "Citizen ID." }
    firstName is String(1, 100) with { briefly "First" described by "First name." }
    lastName is String(1, 100) with { briefly "Last" described by "Last name." }
    dateOfBirth is Date with { briefly "DOB" described by "Date of birth." }
    ssn is String(9, 9) with { briefly "SSN" described by "Social security number." }
  } with {
    briefly "Verify identity"
    described by "Verifies citizen identity."
  }

  event IdentityVerified is {
    citizenId is CitizenId with { briefly "Citizen" described by "Citizen ID." }
    isVerified is Boolean with { briefly "Verified" described by "Verification result." }
    confidence is Decimal(3, 2) with { briefly "Confidence" described by "Match confidence." }
    verifiedAt is TimeStamp with { briefly "Verified" described by "Verification time." }
  } with {
    briefly "Identity verified"
    described by "Emitted when identity is verified."
  }

} with {
  option is external
  briefly "External identity service"
  described by "Identity verification service."
}

// Income Verification Service
context IncomeVerificationService is {

  command VerifyEmployment is {
    citizenId is CitizenId with { briefly "Citizen" described by "Citizen ID." }
    employer is String(1, 200) with { briefly "Employer" described by "Employer name." }
    ssn is String(9, 9) with { briefly "SSN" described by "Social security number." }
  } with {
    briefly "Verify employment"
    described by "Verifies employment and income."
  }

  event EmploymentVerified is {
    citizenId is CitizenId with { briefly "Citizen" described by "Citizen ID." }
    employer is String(1, 200) with { briefly "Employer" described by "Employer name." }
    isEmployed is Boolean with { briefly "Employed" described by "Currently employed." }
    monthlyIncome is optional Decimal(10, 2) with { briefly "Income" described by "Monthly income." }
    verifiedAt is TimeStamp with { briefly "Verified" described by "Verification time." }
  } with {
    briefly "Employment verified"
    described by "Emitted when employment is verified."
  }

  query GetWageHistory is {
    ssn is String(9, 9) with { briefly "SSN" described by "Social security number." }
    quarters is Natural with { briefly "Quarters" described by "Number of quarters." }
  } with {
    briefly "Get wage history"
    described by "Retrieves wage history from state records."
  }

  result WageHistoryResult is {
    wages is many QuarterlyWage with { briefly "Wages" described by "Quarterly wages." }
    totalIncome is Decimal(12, 2) with { briefly "Total" described by "Total income." }
  } with {
    briefly "Wage history result"
    described by "Wage history from state records."
  }

  type QuarterlyWage is {
    quarter is String(1, 10) with { briefly "Quarter" described by "Quarter (YYYY-Q)." }
    employer is String(1, 200) with { briefly "Employer" described by "Employer name." }
    wages is Decimal(10, 2) with { briefly "Wages" described by "Wages paid." }
  } with {
    briefly "Quarterly wage"
    described by "Wages for a quarter."
  }

} with {
  option is external
  briefly "External income service"
  described by "Income and employment verification."
}

// Benefits Integration Service
context BenefitsIntegrationService is {

  query GetCurrentBenefits is {
    ssn is String(9, 9) with { briefly "SSN" described by "Social security number." }
  } with {
    briefly "Get current benefits"
    described by "Queries other benefit programs."
  }

  result CurrentBenefitsResult is {
    benefits is many ExistingBenefit with { briefly "Benefits" described by "Current benefits." }
  } with {
    briefly "Current benefits result"
    described by "Benefits from other programs."
  }

  type ExistingBenefit is {
    programName is String(1, 200) with { briefly "Program" described by "Program name." }
    monthlyAmount is Decimal(10, 2) with { briefly "Amount" described by "Monthly benefit." }
    startDate is Date with { briefly "Start" described by "Start date." }
    endDate is optional Date with { briefly "End" described by "End date." }
  } with {
    briefly "Existing benefit"
    described by "Benefit from another program."
  }

  event BenefitStatusChanged is {
    ssn is String(9, 9) with { briefly "SSN" described by "Social security number." }
    programName is String(1, 200) with { briefly "Program" described by "Program name." }
    changeType is String(1, 50) with { briefly "Change" described by "Type of change." }
    changedAt is TimeStamp with { briefly "Changed" described by "Change time." }
  } with {
    briefly "Benefit status changed"
    described by "Emitted when other benefits change."
  }

} with {
  option is external
  briefly "External benefits service"
  described by "Cross-program benefits coordination."
}

// Document Management Service
context DocumentManagementService is {

  command StoreDocument is {
    caseId is CaseId with { briefly "Case" described by "Case ID." }
    fileName is String(1, 255) with { briefly "File" described by "File name." }
    documentType is String(1, 100) with { briefly "Type" described by "Document type." }
    contentHash is String(64, 64) with { briefly "Hash" described by "Content hash." }
  } with {
    briefly "Store document"
    described by "Stores document in repository."
  }

  event DocumentStored is {
    caseId is CaseId with { briefly "Case" described by "Case ID." }
    documentId is UUID with { briefly "Document" described by "Document ID." }
    storedAt is TimeStamp with { briefly "Stored" described by "Storage time." }
  } with {
    briefly "Document stored"
    described by "Emitted when document is stored."
  }

  query RetrieveDocument is {
    documentId is UUID with { briefly "Document" described by "Document ID." }
  } with {
    briefly "Retrieve document"
    described by "Retrieves document from storage."
  }

  result DocumentResult is {
    documentId is UUID with { briefly "Document" described by "Document ID." }
    fileName is String(1, 255) with { briefly "File" described by "File name." }
    documentUrl is String(1, 500) with { briefly "URL" described by "Download URL." }
    expiresAt is TimeStamp with { briefly "Expires" described by "URL expiration." }
  } with {
    briefly "Document result"
    described by "Document retrieval result."
  }

} with {
  option is external
  briefly "External document service"
  described by "Document storage and retrieval."
}

// Payment Service
context PaymentService is {

  command IssueBenefit is {
    caseId is CaseId with { briefly "Case" described by "Case ID." }
    citizenId is CitizenId with { briefly "Citizen" described by "Citizen ID." }
    programId is ProgramId with { briefly "Program" described by "Program ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Payment amount." }
    paymentMethod is String(1, 50) with { briefly "Method" described by "Payment method." }
  } with {
    briefly "Issue benefit"
    described by "Issues benefit payment."
  }

  event BenefitIssued is {
    caseId is CaseId with { briefly "Case" described by "Case ID." }
    paymentId is UUID with { briefly "Payment" described by "Payment ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Payment amount." }
    issuedAt is TimeStamp with { briefly "Issued" described by "Issue time." }
  } with {
    briefly "Benefit issued"
    described by "Emitted when benefit is paid."
  }

  event PaymentFailed is {
    caseId is CaseId with { briefly "Case" described by "Case ID." }
    reason is String(1, 200) with { briefly "Reason" described by "Failure reason." }
    failedAt is TimeStamp with { briefly "Failed" described by "Failure time." }
  } with {
    briefly "Payment failed"
    described by "Emitted when payment fails."
  }

} with {
  option is external
  briefly "External payment service"
  described by "Benefit payment processing."
}

// Notification Service
context NotificationService is {

  command SendNotification is {
    caseId is CaseId with { briefly "Case" described by "Case ID." }
    citizenId is CitizenId with { briefly "Citizen" described by "Citizen ID." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    channel is String(1, 20) with { briefly "Channel" described by "Delivery channel." }
    content is String(1, 2000) with { briefly "Content" described by "Message content." }
  } with {
    briefly "Send notification"
    described by "Sends notification to citizen."
  }

  event NotificationSent is {
    caseId is CaseId with { briefly "Case" described by "Case ID." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    channel is String(1, 20) with { briefly "Channel" described by "Delivery channel." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification sent"
    described by "Emitted when notification is sent."
  }

} with {
  option is external
  briefly "External notification service"
  described by "Citizen notification service."
}

// Appointment Service
context AppointmentService is {

  command ScheduleAppointment is {
    caseId is CaseId with { briefly "Case" described by "Case ID." }
    citizenId is CitizenId with { briefly "Citizen" described by "Citizen ID." }
    workerId is WorkerId with { briefly "Worker" described by "Worker ID." }
    appointmentType is String(1, 100) with { briefly "Type" described by "Appointment type." }
    requestedDate is Date with { briefly "Date" described by "Requested date." }
    location is optional String(1, 200) with { briefly "Location" described by "Meeting location." }
  } with {
    briefly "Schedule appointment"
    described by "Schedules citizen appointment."
  }

  event AppointmentScheduled is {
    caseId is CaseId with { briefly "Case" described by "Case ID." }
    appointmentId is UUID with { briefly "Appointment" described by "Appointment ID." }
    scheduledDate is TimeStamp with { briefly "Date" described by "Scheduled date/time." }
    location is String(1, 200) with { briefly "Location" described by "Meeting location." }
  } with {
    briefly "Appointment scheduled"
    described by "Emitted when appointment is scheduled."
  }

  event AppointmentCancelled is {
    appointmentId is UUID with { briefly "Appointment" described by "Appointment ID." }
    reason is String(1, 200) with { briefly "Reason" described by "Cancellation reason." }
    cancelledAt is TimeStamp with { briefly "Cancelled" described by "Cancellation time." }
  } with {
    briefly "Appointment cancelled"
    described by "Emitted when appointment is cancelled."
  }

} with {
  option is external
  briefly "External appointment service"
  described by "Appointment scheduling service."
}
