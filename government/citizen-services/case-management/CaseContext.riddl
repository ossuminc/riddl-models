// Case Management - Case Context
context CaseContext is {
  include "types.riddl"
  include "Case.riddl"
  // Repository
  repository CaseRepository is {
    query FindCaseById is  {
      caseId: CaseId with {
        briefly "Case"
        described as {
          |Case identifier.
        }
      }
    } with {
      briefly "Find case by ID"
      described as {
        |Retrieves case by identifier.
      }
    }
    result CaseResult is  {
      caseObj: Case.ActiveStateData with {
        briefly "Case"
        described as {
          |Case data.
        }
      }
    } with {
      briefly "Case result"
      described as {
        |Returns case data.
      }
    }
    query SearchCases is  {
      filterCaseType: CaseType? with {
        briefly "Type"
        described as {
          |Filter by type.
        }
      }
      filterStatus: CaseStatus? with {
        briefly "Status"
        described as {
          |Filter by status.
        }
      }
      filterWorkerId: WorkerId? with {
        briefly "Worker"
        described as {
          |Filter by worker.
        }
      }
      filterPriority: CasePriority? with {
        briefly "Priority"
        described as {
          |Filter by priority.
        }
      }
    } with {
      briefly "Search cases"
      described as {
        |Searches cases by criteria.
      }
    }
    result CasesResult is  {
      cases: Case.ActiveStateData+ with {
        briefly "Cases"
        described as {
          |Matching cases.
        }
      }
      totalCount: Natural with {
        briefly "Count"
        described as {
          |Total matches.
        }
      }
    } with {
      briefly "Cases result"
      described as {
        |Returns matching cases.
      }
    }
    query FindByCitizen is  {
      citizenId: CitizenId with {
        briefly "Citizen"
        described as {
          |Citizen identifier.
        }
      }
    } with {
      briefly "Find by citizen"
      described as {
        |Finds cases for a citizen.
      }
    }
    query FindBySSN is  {
      ssn: String(9,9) with {
        briefly "SSN"
        described as {
          |Social security number.
        }
      }
    } with {
      briefly "Find by SSN"
      described as {
        |Finds cases by SSN.
      }
    }
    query FindPendingTasks is  {
      workerId: WorkerId with {
        briefly "Worker"
        described as {
          |Worker identifier.
        }
      }
    } with {
      briefly "Find pending tasks"
      described as {
        |Finds worker's pending tasks.
      }
    }
    query FindPendingApprovals is  {
      supervisorId: WorkerId with {
        briefly "Supervisor"
        described as {
          |Supervisor identifier.
        }
      }
    } with {
      briefly "Find pending approvals"
      described as {
        |Finds cases awaiting approval.
      }
    }
    handler CaseRepositoryHandler is {
      on query FindCaseById is { ??? }
      on query SearchCases is { ??? }
      on query FindByCitizen is { ??? }
      on query FindBySSN is { ??? }
      on query FindPendingTasks is { ??? }
      on query FindPendingApprovals is { ??? }
    } with {
      briefly "Handles repository queries"
      described as {
        |Processes case queries.
      }
    }
  } with {
    briefly "Case repository"
    described as {
      |Persistence for case records.
    }
  }
  // Projector for workload analytics
  projector WorkloadAnalytics is {
    record AnalyticsData is  {
      totalOpenCases: Natural with {
        briefly "Open"
        described as {
          |Total open cases.
        }
      }
      casesByType: TypeCount+ with {
        briefly "By type"
        described as {
          |Cases by type.
        }
      }
      casesByStatus: StatusCount+ with {
        briefly "By status"
        described as {
          |Cases by status.
        }
      }
      casesByWorker: WorkerCaseload+ with {
        briefly "By worker"
        described as {
          |Cases per worker.
        }
      }
      averageProcessingDays: Decimal(6,2) with {
        briefly "Avg days"
        described as {
          |Average processing time.
        }
      }
      pendingApprovals: Natural with {
        briefly "Pending"
        described as {
          |Awaiting approval.
        }
      }
      overdueTasks: Natural with {
        briefly "Overdue"
        described as {
          |Overdue tasks.
        }
      }
    } with {
      briefly "Analytics data"
      described as {
        |Workload metrics.
      }
    }
    record TypeCount is  {
      caseType: CaseType with {
        briefly "Type"
        described as {
          |Case type.
        }
      }
      count: Natural with {
        briefly "Count"
        described as {
          |Case count.
        }
      }
    } with {
      briefly "Type count"
      described as {
        |Count by case type.
      }
    }
    record StatusCount is  {
      status: CaseStatus with {
        briefly "Status"
        described as {
          |Case status.
        }
      }
      count: Natural with {
        briefly "Count"
        described as {
          |Case count.
        }
      }
    } with {
      briefly "Status count"
      described as {
        |Count by status.
      }
    }
    record WorkerCaseload is  {
      workerId: WorkerId with {
        briefly "Worker"
        described as {
          |Worker ID.
        }
      }
      openCases: Natural with {
        briefly "Open"
        described as {
          |Open cases.
        }
      }
      pendingTasks: Natural with {
        briefly "Tasks"
        described as {
          |Pending tasks.
        }
      }
    } with {
      briefly "Worker caseload"
      described as {
        |Worker's caseload.
      }
    }
    handler AnalyticsHandler is {
      on event Case.CaseOpened is { ??? }
      on event Case.WorkerAssigned is { ??? }
      on event Case.TaskCreated is { ??? }
      on event Case.TaskCompleted is { ??? }
      on event Case.CaseClosed is { ??? }
    } with {
      briefly "Processes analytics events"
      described as {
        |Updates workload analytics.
      }
    }
  } with {
    briefly "Workload analytics"
    described as {
      |Projects workload metrics for management.
    }
  }
  // Projector for program statistics
  projector ProgramStatistics is {
    record StatisticsData is  {
      programStats: ProgramStat+ with {
        briefly "Stats"
        described as {
          |Per-program statistics.
        }
      }
      totalBenefitsPaid: Decimal(12,2) with {
        briefly "Benefits"
        described as {
          |Total benefits paid.
        }
      }
      approvalRate: Decimal(5,2) with {
        briefly "Approval"
        described as {
          |Approval rate percentage.
        }
      }
      averageBenefit: Decimal(10,2) with {
        briefly "Average"
        described as {
          |Average benefit amount.
        }
      }
      appealCount: Natural with {
        briefly "Appeals"
        described as {
          |Total appeals filed.
        }
      }
      appealSuccessRate: Decimal(5,2) with {
        briefly "Appeal success"
        described as {
          |Appeal success rate.
        }
      }
    } with {
      briefly "Statistics data"
      described as {
        |Program statistics.
      }
    }
    record ProgramStat is  {
      programId: ProgramId with {
        briefly "Program"
        described as {
          |Program ID.
        }
      }
      programName: String(1,200) with {
        briefly "Name"
        described as {
          |Program name.
        }
      }
      applicationsReceived: Natural with {
        briefly "Received"
        described as {
          |Applications received.
        }
      }
      approved: Natural with {
        briefly "Approved"
        described as {
          |Applications approved.
        }
      }
      denied: Natural with {
        briefly "Denied"
        described as {
          |Applications denied.
        }
      }
      totalPaid: Decimal(12,2) with {
        briefly "Paid"
        described as {
          |Total benefits paid.
        }
      }
    } with {
      briefly "Program stat"
      described as {
        |Statistics for program.
      }
    }
    handler StatisticsHandler is {
      on event Case.ServicesRequested is { ??? }
      on event Case.ServicesApproved is { ??? }
      on event Case.ServicesDenied is { ??? }
      on event Case.AppealFiled is { ??? }
      on event Case.AppealResolved is { ??? }
    } with {
      briefly "Processes statistics events"
      described as {
        |Updates program statistics.
      }
    }
  } with {
    briefly "Program statistics"
    described as {
      |Projects program performance metrics.
    }
  }
} with {
  briefly "Case context"
  described as {
    | The Case context manages citizen services
    | and assistance cases.
  }
}
