// Mineral Tracking - MineralTracking Context
context MineralTrackingContext is {
  include "types.riddl"
  include "MineralBatch.riddl"
  repository MineralTrackingRepository is {
    schema MineralTrackingData is relational
      of mineralBatches as type MineralBatch
        index on field MineralBatch.batchId
        index on field MineralBatch.extractionInfo.mineId
        index on field MineralBatch.status

    handler MineralTrackingPersistence is {
      on command MineralBatch.RecordExtraction is {
        prompt "Store new mineral batch extraction"
      }
      on command MineralBatch.RecordAssayResult is {
        prompt "Update batch with assay result"
      }
      on command MineralBatch.MoveToStockpile is {
        prompt "Update batch stockpile location"
      }
      on command MineralBatch.RecordProcessingResult is {
        prompt "Store processing result"
      }
      on command MineralBatch.ReconcileGrade is {
        prompt "Store grade reconciliation"
      }
      on command MineralBatch.ShipToSmelter is {
        prompt "Update batch with shipment info"
      }
      on command MineralBatch.ConfirmDelivery is {
        prompt "Update batch to delivered"
      }
    } with {
      briefly "Persists mineral tracking events"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Mineral tracking data persistence"
    described as {
      |Persistent storage for mineral tracking.
    }
  }
  projector MineralTrackingMetrics is {
    record BatchMetrics is  {
      batchesExtracted: Natural with {
        briefly "Extracted"
        described as {
          |Batches extracted.
        }
      }
      batchesProcessed: Natural with {
        briefly "Processed"
        described as {
          |Batches processed.
        }
      }
      batchesShipped: Natural with {
        briefly "Shipped"
        described as {
          |Batches shipped.
        }
      }
      batchesRejected: Natural with {
        briefly "Rejected"
        described as {
          |Batches rejected.
        }
      }
      totalTonnageExtracted: Decimal(14,2) with {
        briefly "Total tonnage"
        described as {
          |Total tonnage extracted.
        }
      }
      averageRecoveryRate: Decimal(5,2) with {
        briefly "Avg recovery"
        described as {
          |Average recovery rate.
        }
      }
    } with {
      briefly "Batch metrics"
      described as {
        |Mineral batch processing metrics.
      }
    }
    handler MetricsHandler is {
      on event MineralBatch.ExtractionRecorded is {
        prompt "Increment batches extracted and total tonnage"
      }
      on event MineralBatch.ProcessingResultRecorded is {
        prompt "Increment batches processed and update recovery rate"
      }
      on event MineralBatch.ShippedToSmelter is {
        prompt "Increment batches shipped"
      }
      on event MineralBatch.BatchRejected is {
        prompt "Increment batches rejected"
      }
    } with {
      briefly "Maintains mineral tracking metrics"
      described as {
        |Projects events into metrics.
      }
    }
  } with {
    briefly "Mineral tracking metrics"
    described as {
      |Mineral tracking analytics and KPIs.
    }
  }
} with {
  briefly "Bounded context for mineral tracking"
  described as {
    |Mineral tracking from extraction through smelter delivery.
  }
}
