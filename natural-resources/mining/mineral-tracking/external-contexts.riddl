// Mineral Tracking - External Contexts

context AssayLaboratory is {

  command SubmitSample is {
    batchId is MineralBatchId with { briefly "Batch" described by "Batch ID." }
    sampleId is UUID with { briefly "Sample" described by "Sample identifier." }
    mineralType is MineralType with { briefly "Mineral" described by "Mineral type." }
    sampleWeight is Decimal(8, 2) with { briefly "Weight" described by "Sample weight in grams." }
  } with {
    briefly "Submit sample"
    described by "Submits a sample for assay analysis."
  }

  event AssayCompleted is {
    batchId is MineralBatchId with { briefly "Batch" described by "Batch ID." }
    result is AssayResult with { briefly "Result" described by "Assay result." }
  } with {
    briefly "Assay completed"
    described by "Emitted when assay analysis is complete."
  }

  query GetAssayHistory is {
    batchId is MineralBatchId with { briefly "Batch" described by "Batch ID." }
  } with {
    briefly "Get assay history"
    described by "Retrieves assay history for a batch."
  }

  result AssayHistory is {
    batchId is MineralBatchId with { briefly "Batch" described by "Batch ID." }
    results is many AssayResult with { briefly "Results" described by "Assay results." }
  } with {
    briefly "Assay history"
    described by "Historical assay results for a batch."
  }

} with {
  option is external
  briefly "External assay laboratory"
  described by "Laboratory system performing mineral assay analysis."
}

context SmelterSystem is {

  command ScheduleDelivery is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    batchId is MineralBatchId with { briefly "Batch" described by "Batch ID." }
    tonnage is Decimal(12, 2) with { briefly "Tonnage" described by "Shipment tonnage." }
    concentrateGrade is Decimal(10, 4) with { briefly "Grade" described by "Concentrate grade." }
    gradeUnit is GradeUnit with { briefly "Unit" described by "Grade unit." }
    estimatedArrival is Date with { briefly "ETA" described by "Estimated arrival." }
  } with {
    briefly "Schedule delivery"
    described by "Schedules a concentrate delivery to smelter."
  }

  event DeliveryReceived is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    receivedTonnage is Decimal(12, 2) with { briefly "Received" described by "Tonnage received." }
    receivedAt is TimeStamp with { briefly "Received at" described by "Receipt time." }
    accepted is Boolean with { briefly "Accepted" described by "Shipment accepted." }
  } with {
    briefly "Delivery received"
    described by "Emitted when smelter receives delivery."
  }

  query GetDeliveryStatus is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
  } with {
    briefly "Get delivery status"
    described by "Gets current delivery status."
  }

  result DeliveryStatus is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    deliveryStatus is String(3, 50) with { briefly "Status" described by "Delivery status." }
    lastUpdated is TimeStamp with { briefly "Updated" described by "Last status update." }
  } with {
    briefly "Delivery status"
    described by "Current delivery status."
  }

} with {
  option is external
  briefly "External smelter system"
  described by "Smelter system receiving mineral concentrate shipments."
}
