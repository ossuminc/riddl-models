// Mine Operations - Mine Context
context MineContext is {
  include "types.riddl"
  include "ExtractionZone.riddl"
  repository MineRepository is {
    schema MineData is relational
      of extractionZones as type ExtractionZone
        index on field ExtractionZone.zoneId
        index on field ExtractionZone.zone.mineId
        index on field ExtractionZone.status

    handler MinePersistence is {
      on command ExtractionZone.CreateZone is {
        prompt "Store new extraction zone"
      }
      on command ExtractionZone.SurveyZone is {
        prompt "Store survey data"
      }
      on command ExtractionZone.RecordProduction is {
        prompt "Store production record"
      }
      on command ExtractionZone.RecordSafetyIncident is {
        prompt "Store safety incident"
      }
      on command ExtractionZone.RecordEnvironmental is {
        prompt "Store environmental reading"
      }
      on command ExtractionZone.ExhaustZone is {
        prompt "Update zone to exhausted"
      }
    } with {
      briefly "Persists mine commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Mine data persistence"
    described as {
      |Persistent storage for mine operations.
    }
  }
  projector ProductionAnalytics is {
    record DailyProduction is  {
      productionDate: Date with {
        briefly "Date"
        described as {
          |Production date.
        }
      }
      totalExtracted: Decimal(15,2) with {
        briefly "Extracted"
        described as {
          |Total extracted.
        }
      }
      totalProcessed: Decimal(15,2) with {
        briefly "Processed"
        described as {
          |Total processed.
        }
      }
      averageRecovery: Decimal(5,2) with {
        briefly "Recovery"
        described as {
          |Average recovery rate.
        }
      }
    } with {
      briefly "Daily production"
      described as {
        |Daily production summary.
      }
    }
    record SafetyMetrics is  {
      lostTimeIncidents: Natural with {
        briefly "LTI"
        described as {
          |Lost time incidents.
        }
      }
      nearMisses: Natural with {
        briefly "Near misses"
        described as {
          |Near miss incidents.
        }
      }
      daysWithoutIncident: Natural with {
        briefly "Safe days"
        described as {
          |Days without incident.
        }
      }
    } with {
      briefly "Safety metrics"
      described as {
        |Safety performance metrics.
      }
    }
    handler AnalyticsHandler is {
      on event ExtractionZone.ProductionRecorded is {
        prompt "Update production analytics"
      }
      on event ExtractionZone.SafetyIncidentRecorded is {
        prompt "Update safety metrics"
      }
    } with {
      briefly "Maintains production analytics"
      described as {
        |Projects events into analytics.
      }
    }
  } with {
    briefly "Production analytics"
    described as {
      |Mining production analytics.
    }
  }
} with {
  briefly "Bounded context for mine operations"
  described as {
    |Mine extraction and processing context.
  }
}
