// Pipeline Operations - External Contexts
context SCADASystem is {
  query GetLiveReadings is  {
    segmentId: SegmentId with {
      briefly "Segment"
      described as {
        |Segment ID.
      }
    }
  } with {
    briefly "Get live readings"
    described as {
      |Gets live telemetry readings from SCADA sensors.
    }
  }
  result LiveReadings is  {
    readings: FlowReading+ with {
      briefly "Readings"
      described as {
        |Live flow readings.
      }
    }
    sensorCount: Natural with {
      briefly "Sensors"
      described as {
        |Number of active sensors.
      }
    }
  } with {
    briefly "Live readings"
    described as {
      |Live SCADA telemetry data.
    }
  }
  command SendControlSignal is  {
    segmentId: SegmentId with {
      briefly "Segment"
      described as {
        |Segment ID.
      }
    }
    signalType: String(3,100) with {
      briefly "Signal type"
      described as {
        |Control signal type.
      }
    }
    parameters: String(3,1000) with {
      briefly "Parameters"
      described as {
        |Signal parameters.
      }
    }
  } with {
    briefly "Send control signal"
    described as {
      |Sends a control signal to pipeline equipment.
    }
  }
  event ControlSignalSent is  {
    segmentId: SegmentId with {
      briefly "Segment"
      described as {
        |Segment ID.
      }
    }
    signalType: String(3,100) with {
      briefly "Signal type"
      described as {
        |Control signal type.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Signal send time.
      }
    }
  } with {
    briefly "Control signal sent"
    described as {
      |Emitted when control signal is sent.
    }
  }
} with {
  option external()
  briefly "External SCADA system"
  described as {
    |Supervisory control and data acquisition system.
  }
}
context RegulatoryPortal is {
  command SubmitComplianceFiling is  {
    segmentId: SegmentId with {
      briefly "Segment"
      described as {
        |Segment ID.
      }
    }
    filing: ComplianceFiling with {
      briefly "Filing"
      described as {
        |Compliance filing.
      }
    }
  } with {
    briefly "Submit compliance filing"
    described as {
      |Submits filing to regulatory portal.
    }
  }
  event FilingSubmitted is  {
    filingId: UUID with {
      briefly "Filing"
      described as {
        |Filing ID.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
    acknowledgementRef: String(3,100) with {
      briefly "Ref"
      described as {
        |Acknowledgement reference.
      }
    }
  } with {
    briefly "Filing submitted"
    described as {
      |Emitted when filing is submitted.
    }
  }
  query GetComplianceStatus is  {
    segmentId: SegmentId with {
      briefly "Segment"
      described as {
        |Segment ID.
      }
    }
  } with {
    briefly "Get compliance status"
    described as {
      |Gets regulatory compliance status.
    }
  }
  result ComplianceStatus is  {
    segmentId: SegmentId with {
      briefly "Segment"
      described as {
        |Segment ID.
      }
    }
    isCompliant: Boolean with {
      briefly "Compliant"
      described as {
        |Compliance status.
      }
    }
    nextFilingDue: Date with {
      briefly "Next due"
      described as {
        |Next filing due date.
      }
    }
    outstandingItems: String(3,300)+ with {
      briefly "Outstanding"
      described as {
        |Outstanding items.
      }
    }
  } with {
    briefly "Compliance status"
    described as {
      |Regulatory compliance status.
    }
  }
} with {
  option external()
  briefly "External regulatory portal"
  described as {
    |Government regulatory compliance portal.
  }
}
