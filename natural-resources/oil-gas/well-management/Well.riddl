// Well Management - Well Entity
entity Well is {
  command PlanWell is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |New well identifier.
      }
    }
    leaseId: LeaseId with {
      briefly "Lease"
      described as {
        |Mineral lease ID.
      }
    }
    fieldId: FieldId with {
      briefly "Field"
      described as {
        |Oil/gas field ID.
      }
    }
    wellName: String(1,200) with {
      briefly "Name"
      described as {
        |Well name.
      }
    }
    wellType: WellType with {
      briefly "Type"
      described as {
        |Well purpose.
      }
    }
    location: WellLocation with {
      briefly "Location"
      described as {
        |Well location.
      }
    }
    program: DrillingProgram with {
      briefly "Program"
      described as {
        |Drilling program.
      }
    }
  } with {
    briefly "Plan well"
    described as {
      |Plans a new well.
    }
  }
  command SubmitForPermit is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    regulatoryAgency: String(1,100) with {
      briefly "Agency"
      described as {
        |Regulatory agency.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Submit for permit"
    described as {
      |Submits well for regulatory permit.
    }
  }
  command ApprovePermit is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    permitNumber: String(1,100) with {
      briefly "Permit"
      described as {
        |Permit number.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Approve permit"
    described as {
      |Records permit approval.
    }
  }
  command SpudWell is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    spudDate: Date with {
      briefly "Spud date"
      described as {
        |Date drilling started.
      }
    }
    rigId: String(1,100) with {
      briefly "Rig"
      described as {
        |Drilling rig identifier.
      }
    }
  } with {
    briefly "Spud well"
    described as {
      |Records well spud (drilling start).
    }
  }
  command UpdateDrillingProgress is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    progress: DrillingProgress with {
      briefly "Progress"
      described as {
        |Current drilling progress.
      }
    }
  } with {
    briefly "Update drilling progress"
    described as {
      |Updates drilling status.
    }
  }
  command CompleteWell is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    completion: CompletionData with {
      briefly "Completion"
      described as {
        |Completion data.
      }
    }
  } with {
    briefly "Complete well"
    described as {
      |Records well completion.
    }
  }
  command BringOnline is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    firstProductionDate: Date with {
      briefly "First production"
      described as {
        |First production date.
      }
    }
    hydrocarbonType: HydrocarbonType with {
      briefly "Hydrocarbon"
      described as {
        |Primary produced hydrocarbon.
      }
    }
  } with {
    briefly "Bring online"
    described as {
      |Brings well into production.
    }
  }
  command RecordProduction is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    production: ProductionData with {
      briefly "Production"
      described as {
        |Production data.
      }
    }
  } with {
    briefly "Record production"
    described as {
      |Records daily production.
    }
  }
  command ShutinWell is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Shutin reason.
      }
    }
    shutinDate: Date with {
      briefly "Shutin date"
      described as {
        |Date well shut in.
      }
    }
  } with {
    briefly "Shutin well"
    described as {
      |Shuts in well.
    }
  }
  command StartWorkover is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    workover: WorkoverRecord with {
      briefly "Workover"
      described as {
        |Workover details.
      }
    }
  } with {
    briefly "Start workover"
    described as {
      |Starts well workover.
    }
  }
  command CompleteWorkover is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    workorderId: UUID with {
      briefly "Work order"
      described as {
        |Workover work order.
      }
    }
    endDate: Date with {
      briefly "End date"
      described as {
        |Workover completion date.
      }
    }
    success: Boolean with {
      briefly "Success"
      described as {
        |Workover successful.
      }
    }
  } with {
    briefly "Complete workover"
    described as {
      |Completes workover.
    }
  }
  command AbandonWell is  {
    wellId: WellId with {
      briefly "Well ID"
      described as {
        |Well identifier.
      }
    }
    abandonmentDate: Date with {
      briefly "Abandonment date"
      described as {
        |Date of abandonment.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Abandonment reason.
      }
    }
    pluggingReport: String(1,2000) with {
      briefly "Plugging"
      described as {
        |Plugging and abandonment report.
      }
    }
  } with {
    briefly "Abandon well"
    described as {
      |Abandons and plugs well.
    }
  }
  // Events
  event WellPlanned is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    wellName: String(1,200) with {
      briefly "Name"
      described as {
        |Well name.
      }
    }
    location: WellLocation with {
      briefly "Location"
      described as {
        |Well location.
      }
    }
    plannedAt: TimeStamp with {
      briefly "Planned"
      described as {
        |Planning time.
      }
    }
  } with {
    briefly "Well planned"
    described as {
      |Emitted when well is planned.
    }
  }
  event PermitSubmitted is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    regulatoryAgency: String(1,100) with {
      briefly "Agency"
      described as {
        |Agency.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Permit submitted"
    described as {
      |Emitted when permit is submitted.
    }
  }
  event PermitApproved is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    permitNumber: String(1,100) with {
      briefly "Permit"
      described as {
        |Permit number.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Permit approved"
    described as {
      |Emitted when permit is approved.
    }
  }
  event WellSpudded is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    spudDate: Date with {
      briefly "Spud date"
      described as {
        |Drilling start.
      }
    }
    rigId: String(1,100) with {
      briefly "Rig"
      described as {
        |Rig ID.
      }
    }
  } with {
    briefly "Well spudded"
    described as {
      |Emitted when drilling starts.
    }
  }
  event DrillingProgressUpdated is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    progress: DrillingProgress with {
      briefly "Progress"
      described as {
        |Drilling progress.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Drilling progress updated"
    described as {
      |Emitted when drilling progress is updated.
    }
  }
  event WellCompleted is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    completion: CompletionData with {
      briefly "Completion"
      described as {
        |Completion data.
      }
    }
  } with {
    briefly "Well completed"
    described as {
      |Emitted when well is completed.
    }
  }
  event WellBroughtOnline is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    firstProductionDate: Date with {
      briefly "First production"
      described as {
        |First production.
      }
    }
    hydrocarbonType: HydrocarbonType with {
      briefly "Hydrocarbon"
      described as {
        |Type.
      }
    }
  } with {
    briefly "Well brought online"
    described as {
      |Emitted when well starts production.
    }
  }
  event ProductionRecorded is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    production: ProductionData with {
      briefly "Production"
      described as {
        |Production data.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Production recorded"
    described as {
      |Emitted when production is recorded.
    }
  }
  event WellShutIn is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Shutin reason.
      }
    }
    shutinDate: Date with {
      briefly "Shutin"
      described as {
        |Shutin date.
      }
    }
  } with {
    briefly "Well shut in"
    described as {
      |Emitted when well is shut in.
    }
  }
  event WorkoverStarted is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    workorderId: UUID with {
      briefly "Work order"
      described as {
        |Work order ID.
      }
    }
    workType: String(1,100) with {
      briefly "Type"
      described as {
        |Workover type.
      }
    }
    startedAt: TimeStamp with {
      briefly "Started"
      described as {
        |Start time.
      }
    }
  } with {
    briefly "Workover started"
    described as {
      |Emitted when workover starts.
    }
  }
  event WorkoverCompleted is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    workorderId: UUID with {
      briefly "Work order"
      described as {
        |Work order ID.
      }
    }
    success: Boolean with {
      briefly "Success"
      described as {
        |Success.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Workover completed"
    described as {
      |Emitted when workover completes.
    }
  }
  event WellAbandoned is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    abandonmentDate: Date with {
      briefly "Date"
      described as {
        |Abandonment date.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason.
      }
    }
  } with {
    briefly "Well abandoned"
    described as {
      |Emitted when well is abandoned.
    }
  }
  // States
  record ActiveStateData is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    wellName: String(1,200) with {
      briefly "Name"
      described as {
        |Well name.
      }
    }
    leaseId: LeaseId with {
      briefly "Lease"
      described as {
        |Lease ID.
      }
    }
    fieldId: FieldId with {
      briefly "Field"
      described as {
        |Field ID.
      }
    }
    wellType: WellType with {
      briefly "Type"
      described as {
        |Well type.
      }
    }
    status: WellStatus with {
      briefly "Status"
      described as {
        |Current status.
      }
    }
    location: WellLocation with {
      briefly "Location"
      described as {
        |Well location.
      }
    }
    program: DrillingProgram with {
      briefly "Program"
      described as {
        |Drilling program.
      }
    }
    updatedPermitNumber: String(1,100)? with {
      briefly "Permit"
      described as {
        |Permit number.
      }
    }
    updatedSpudDate: Date? with {
      briefly "Spud"
      described as {
        |Spud date.
      }
    }
    updatedCompletion: CompletionData? with {
      briefly "Completion"
      described as {
        |Completion data.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Active well state"
    described as {
      |State for active well.
    }
  }
  record AbandonedStateData is  {
    wellId: WellId with {
      briefly "Well"
      described as {
        |Well ID.
      }
    }
    wellName: String(1,200) with {
      briefly "Name"
      described as {
        |Well name.
      }
    }
    abandonmentDate: Date with {
      briefly "Date"
      described as {
        |Abandonment date.
      }
    }
    totalProduction: Decimal(15,2)? with {
      briefly "Total"
      described as {
        |Total production BOE.
      }
    }
  } with {
    briefly "Abandoned well state"
    described as {
      |State for abandoned well.
    }
  }
  state ActiveState of type Well.ActiveStateData
  state AbandonedState of type Well.AbandonedStateData
  handler WellHandler is {
    on command PlanWell is {
      morph entity WellContext.Well to state WellContext.Well.ActiveState with command PlanWell
      tell event WellPlanned to entity WellContext.Well
    }
    on command SubmitForPermit is {
      tell event PermitSubmitted to entity WellContext.Well
    }
    on command ApprovePermit is {
      tell event PermitApproved to entity WellContext.Well
    }
    on command SpudWell is {
      tell event WellSpudded to entity WellContext.Well
    }
    on command UpdateDrillingProgress is {
      tell event DrillingProgressUpdated to entity WellContext.Well
    }
    on command CompleteWell is {
      tell event WellCompleted to entity WellContext.Well
    }
    on command BringOnline is {
      tell event WellBroughtOnline to entity WellContext.Well
    }
    on command RecordProduction is {
      tell event ProductionRecorded to entity WellContext.Well
    }
    on command ShutinWell is {
      tell event WellShutIn to entity WellContext.Well
    }
    on command StartWorkover is {
      tell event WorkoverStarted to entity WellContext.Well
    }
    on command CompleteWorkover is {
      tell event WorkoverCompleted to entity WellContext.Well
    }
    on command AbandonWell is {
      morph entity WellContext.Well to state WellContext.Well.AbandonedState with command AbandonWell
      tell event WellAbandoned to entity WellContext.Well
    }
  } with {
    briefly "Processes well commands"
    described as {
      |Handles well lifecycle.
    }
  }
} with {
  briefly "Well aggregate"
  described as {
    |Manages oil and gas wells.
  }
}
