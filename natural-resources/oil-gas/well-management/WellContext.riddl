// Well Management - Well Context

context WellContext is {

  include "types.riddl"
  include "Well.riddl"

  repository WellRepository is {
    schema WellData is relational
      of wells as Well
      index on field Well.wellId
      index on field Well.leaseId
      index on field Well.fieldId
      index on field Well.status

    handler WellPersistence is {
      on event Well.WellPlanned {
        prompt "Store new well record"
      }
      on event Well.PermitApproved {
        prompt "Update well permit information"
      }
      on event Well.WellSpudded {
        prompt "Update well to drilling status"
      }
      on event Well.WellCompleted {
        prompt "Store well completion data"
      }
      on event Well.WellBroughtOnline {
        prompt "Update well to producing status"
      }
      on event Well.ProductionRecorded {
        prompt "Store production record"
      }
      on event Well.WellAbandoned {
        prompt "Update well to abandoned status"
      }
    } with {
      briefly "Persists well events"
      described by "Handles event-driven persistence."
    }
  } with {
    briefly "Well data persistence"
    described by "Persistent storage for wells."
  }

  projector ProductionAnalytics is {
    updates repository WellRepository

    record FieldProduction is {
      fieldId is FieldId with { briefly "Field" described by "Field ID." }
      totalOilBBL is Decimal(15, 2) with { briefly "Oil" described by "Total oil barrels." }
      totalGasMCF is Decimal(15, 2) with { briefly "Gas" described by "Total gas MCF." }
      activeWells is Natural with { briefly "Active" described by "Active well count." }
      averageIPRate is Decimal(10, 2) with { briefly "Avg IP" described by "Average initial potential." }
    } with {
      briefly "Field production"
      described by "Production by field."
    }

    handler AnalyticsHandler is {
      on event Well.ProductionRecorded {
        prompt "Aggregate production by field"
      }
      on event Well.WellBroughtOnline {
        prompt "Increment active well count and record IP"
      }
      on event Well.WellShutIn {
        prompt "Decrement active well count"
      }
      on event Well.WellAbandoned {
        prompt "Update field statistics"
      }
    } with {
      briefly "Maintains production analytics"
      described by "Projects events into analytics."
    }
  } with {
    briefly "Production analytics"
    described by "Well and field production analysis."
  }

} with {
  briefly "Bounded context for well management"
  described by "Oil and gas well lifecycle context."
}
