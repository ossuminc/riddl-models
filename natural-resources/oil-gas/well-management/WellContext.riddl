// Well Management - Well Context
context WellContext is {
  include "types.riddl"
  include "Well.riddl"
  repository WellRepository is {
    schema WellData is relational
      of wells as type Well
        index on field Well.wellId
        index on field Well.leaseId
        index on field Well.fieldId
        index on field Well.status

    handler WellPersistence is {
      on command Well.PlanWell is {
        prompt "Store new well record"
      }
      on command Well.ApprovePermit is {
        prompt "Update well permit information"
      }
      on command Well.SpudWell is {
        prompt "Update well to drilling status"
      }
      on command Well.CompleteWell is {
        prompt "Store well completion data"
      }
      on command Well.BringOnline is {
        prompt "Update well to producing status"
      }
      on command Well.RecordProduction is {
        prompt "Store production record"
      }
      on command Well.AbandonWell is {
        prompt "Update well to abandoned status"
      }
    } with {
      briefly "Persists well commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Well data persistence"
    described as {
      |Persistent storage for wells.
    }
  }
  projector ProductionAnalytics is {
    record FieldProduction is  {
      fieldId: FieldId with {
        briefly "Field"
        described as {
          |Field ID.
        }
      }
      totalOilBBL: Decimal(15,2) with {
        briefly "Oil"
        described as {
          |Total oil barrels.
        }
      }
      totalGasMCF: Decimal(15,2) with {
        briefly "Gas"
        described as {
          |Total gas MCF.
        }
      }
      activeWells: Natural with {
        briefly "Active"
        described as {
          |Active well count.
        }
      }
      averageIPRate: Decimal(10,2) with {
        briefly "Avg IP"
        described as {
          |Average initial potential.
        }
      }
    } with {
      briefly "Field production"
      described as {
        |Production by field.
      }
    }
    handler AnalyticsHandler is {
      on event Well.ProductionRecorded is {
        prompt "Aggregate production by field"
      }
      on event Well.WellBroughtOnline is {
        prompt "Increment active well count and record IP"
      }
      on event Well.WellShutIn is {
        prompt "Decrement active well count"
      }
      on event Well.WellAbandoned is {
        prompt "Update field statistics"
      }
    } with {
      briefly "Maintains production analytics"
      described as {
        |Projects events into analytics.
      }
    }
  } with {
    briefly "Production analytics"
    described as {
      |Well and field production analysis.
    }
  }
} with {
  briefly "Bounded context for well management"
  described as {
    |Oil and gas well lifecycle context.
  }
}
