// Log Tracking - Log Tracking Context
context LogTrackingContext is {
  include "types.riddl"
  include "TimberLog.riddl"
  repository LogTrackingRepository is {
    schema LogTrackingData is relational
      of timberLogs as type TimberLog
        index on field TimberLog.logId
        index on field TimberLog.fellingInfo.harvestSiteId
        index on field TimberLog.status

    handler LogTrackingPersistence is {
      on command TimberLog.RegisterLog is {
        prompt "Store new timber log"
      }
      on command TimberLog.ScaleLog is {
        prompt "Update log with scaling measurement"
      }
      on command TimberLog.LoadForTransport is {
        prompt "Update log with transport info"
      }
      on command TimberLog.RecordDelivery is {
        prompt "Update log to delivered status"
      }
      on command TimberLog.RejectLog is {
        prompt "Update log to rejected status"
      }
      on command TimberLog.AttachComplianceDocument is {
        prompt "Store compliance document for log"
      }
    } with {
      briefly "Persists log tracking events"
      described as {
        |Handles command-driven persistence for timber logs.
      }
    }
  } with {
    briefly "Log tracking data persistence"
    described as {
      |Persistent storage for timber log tracking.
    }
  }
  projector LogTrackingMetrics is {
    record VolumeMetrics is  {
      logsRegistered: Natural with {
        briefly "Registered"
        described as {
          |Total logs registered.
        }
      }
      logsDelivered: Natural with {
        briefly "Delivered"
        described as {
          |Total logs delivered.
        }
      }
      logsRejected: Natural with {
        briefly "Rejected"
        described as {
          |Total logs rejected.
        }
      }
      totalVolumeCubicMeters: Decimal(12,4) with {
        briefly "Total volume"
        described as {
          |Total volume in cubic meters.
        }
      }
      averageGradeScore: Decimal(4,2) with {
        briefly "Avg grade"
        described as {
          |Average grade quality score.
        }
      }
    } with {
      briefly "Volume metrics"
      described as {
        |Log volume and quality metrics.
      }
    }
    handler MetricsHandler is {
      on event TimberLog.LogRegistered is {
        prompt "Increment logs registered"
      }
      on event TimberLog.LogDelivered is {
        prompt "Increment logs delivered and update volume totals"
      }
      on event TimberLog.LogRejected is {
        prompt "Increment logs rejected"
      }
      on event TimberLog.LogScaled is {
        prompt "Update volume and grade metrics"
      }
    } with {
      briefly "Maintains log tracking metrics"
      described as {
        |Projects events into volume and quality metrics.
      }
    }
  } with {
    briefly "Log tracking metrics"
    described as {
      |Forestry log tracking analytics.
    }
  }
} with {
  briefly "Bounded context for log tracking"
  described as {
    |Forestry log tracking from felling through transport to sawmill.
  }
}
