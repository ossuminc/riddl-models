// Log Tracking - External Contexts
context TransportSystem is {
  command DispatchTruck is  {
    transportId: TransportId with {
      briefly "Transport"
      described as {
        |Transport ID.
      }
    }
    truckNumber: String(3,50) with {
      briefly "Truck"
      described as {
        |Truck number.
      }
    }
    harvestSiteId: HarvestSiteId with {
      briefly "Site"
      described as {
        |Harvest site ID.
      }
    }
    destinationMill: SawmillId with {
      briefly "Destination"
      described as {
        |Sawmill ID.
      }
    }
  } with {
    briefly "Dispatch truck"
    described as {
      |Dispatches a truck to a harvest site for log pickup.
    }
  }
  event TruckDispatched is  {
    transportId: TransportId with {
      briefly "Transport"
      described as {
        |Transport ID.
      }
    }
    dispatchedAt: TimeStamp with {
      briefly "Dispatched"
      described as {
        |Dispatch time.
      }
    }
  } with {
    briefly "Truck dispatched"
    described as {
      |Emitted when a truck is dispatched.
    }
  }
  query GetTransportStatus is  {
    transportId: TransportId with {
      briefly "Transport"
      described as {
        |Transport ID.
      }
    }
  } with {
    briefly "Get transport status"
    described as {
      |Gets current transport shipment status.
    }
  }
  result TransportStatus is  {
    transportId: TransportId with {
      briefly "Transport"
      described as {
        |Transport ID.
      }
    }
    transportStatus: String(3,50) with {
      briefly "Status"
      described as {
        |Transport status.
      }
    }
    currentLocation: String(3,200)? with {
      briefly "Location"
      described as {
        |Current GPS location.
      }
    }
    updatedEstimatedArrival: TimeStamp? with {
      briefly "ETA"
      described as {
        |Estimated arrival.
      }
    }
  } with {
    briefly "Transport status"
    described as {
      |Current transport shipment status.
    }
  }
} with {
  option external()
  briefly "External transport system"
  described as {
    |Truck dispatch and transport tracking system.
  }
}
context SawmillSystem is {
  command NotifyIncomingLoad is  {
    transportId: TransportId with {
      briefly "Transport"
      described as {
        |Transport ID.
      }
    }
    sawmillId: SawmillId with {
      briefly "Sawmill"
      described as {
        |Sawmill ID.
      }
    }
    logCount: Natural with {
      briefly "Count"
      described as {
        |Number of logs.
      }
    }
    estimatedArrival: TimeStamp with {
      briefly "ETA"
      described as {
        |Estimated arrival.
      }
    }
  } with {
    briefly "Notify incoming load"
    described as {
      |Notifies sawmill of an incoming log shipment.
    }
  }
  event LoadReceived is  {
    transportId: TransportId with {
      briefly "Transport"
      described as {
        |Transport ID.
      }
    }
    sawmillId: SawmillId with {
      briefly "Sawmill"
      described as {
        |Sawmill ID.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Reception time.
      }
    }
  } with {
    briefly "Load received"
    described as {
      |Emitted when sawmill receives a log shipment.
    }
  }
  query GetMillCapacity is  {
    sawmillId: SawmillId with {
      briefly "Sawmill"
      described as {
        |Sawmill ID.
      }
    }
  } with {
    briefly "Get mill capacity"
    described as {
      |Gets current sawmill receiving capacity.
    }
  }
  result MillCapacity is  {
    sawmillId: SawmillId with {
      briefly "Sawmill"
      described as {
        |Sawmill ID.
      }
    }
    availableSlots: Natural with {
      briefly "Slots"
      described as {
        |Available receiving slots.
      }
    }
    nextAvailable: TimeStamp with {
      briefly "Next"
      described as {
        |Next available time.
      }
    }
  } with {
    briefly "Mill capacity"
    described as {
      |Sawmill receiving capacity information.
    }
  }
} with {
  option external()
  briefly "External sawmill system"
  described as {
    |Sawmill receiving and processing system.
  }
}
context RegulatorySystem is {
  command SubmitHarvestReport is  {
    harvestSiteId: HarvestSiteId with {
      briefly "Site"
      described as {
        |Harvest site ID.
      }
    }
    logCount: Natural with {
      briefly "Count"
      described as {
        |Number of logs harvested.
      }
    }
    totalVolume: Decimal(12,4) with {
      briefly "Volume"
      described as {
        |Total volume harvested.
      }
    }
    reportPeriod: String(3,50) with {
      briefly "Period"
      described as {
        |Reporting period.
      }
    }
  } with {
    briefly "Submit harvest report"
    described as {
      |Submits harvest volume report to regulatory authority.
    }
  }
  event ReportAccepted is  {
    harvestSiteId: HarvestSiteId with {
      briefly "Site"
      described as {
        |Harvest site ID.
      }
    }
    acceptedAt: TimeStamp with {
      briefly "Accepted"
      described as {
        |Acceptance time.
      }
    }
    referenceNumber: String(3,100) with {
      briefly "Reference"
      described as {
        |Report reference number.
      }
    }
  } with {
    briefly "Report accepted"
    described as {
      |Emitted when harvest report is accepted by regulator.
    }
  }
  query VerifyPermit is  {
    harvestPermit: String(3,100) with {
      briefly "Permit"
      described as {
        |Harvest permit number.
      }
    }
  } with {
    briefly "Verify permit"
    described as {
      |Verifies a harvest permit with regulatory authority.
    }
  }
  result PermitVerification is  {
    harvestPermit: String(3,100) with {
      briefly "Permit"
      described as {
        |Harvest permit number.
      }
    }
    isValid: Boolean with {
      briefly "Valid"
      described as {
        |Permit validity.
      }
    }
    expiresAt: Date? with {
      briefly "Expires"
      described as {
        |Permit expiration date.
      }
    }
    allowedSpecies: String(3,50)* with {
      briefly "Species"
      described as {
        |Permitted species.
      }
    }
  } with {
    briefly "Permit verification"
    described as {
      |Harvest permit verification result.
    }
  }
} with {
  option external()
  briefly "External regulatory system"
  described as {
    |Government regulatory and compliance system.
  }
}
