// Log Tracking - External Contexts

context TransportSystem is {

  command DispatchTruck is {
    transportId is TransportId with { briefly "Transport" described by "Transport ID." }
    truckNumber is String(3, 50) with { briefly "Truck" described by "Truck number." }
    harvestSiteId is HarvestSiteId with { briefly "Site" described by "Harvest site ID." }
    destinationMill is SawmillId with { briefly "Destination" described by "Sawmill ID." }
  } with {
    briefly "Dispatch truck"
    described by "Dispatches a truck to a harvest site for log pickup."
  }

  event TruckDispatched is {
    transportId is TransportId with { briefly "Transport" described by "Transport ID." }
    dispatchedAt is TimeStamp with { briefly "Dispatched" described by "Dispatch time." }
  } with {
    briefly "Truck dispatched"
    described by "Emitted when a truck is dispatched."
  }

  query GetTransportStatus is {
    transportId is TransportId with { briefly "Transport" described by "Transport ID." }
  } with {
    briefly "Get transport status"
    described by "Gets current transport shipment status."
  }

  result TransportStatus is {
    transportId is TransportId with { briefly "Transport" described by "Transport ID." }
    status is String(3, 50) with { briefly "Status" described by "Transport status." }
    currentLocation is optional String(3, 200) with { briefly "Location" described by "Current GPS location." }
    estimatedArrival is optional TimeStamp with { briefly "ETA" described by "Estimated arrival." }
  } with {
    briefly "Transport status"
    described by "Current transport shipment status."
  }

} with {
  option is external
  briefly "External transport system"
  described by "Truck dispatch and transport tracking system."
}

context SawmillSystem is {

  command NotifyIncomingLoad is {
    transportId is TransportId with { briefly "Transport" described by "Transport ID." }
    sawmillId is SawmillId with { briefly "Sawmill" described by "Sawmill ID." }
    logCount is Natural with { briefly "Count" described by "Number of logs." }
    estimatedArrival is TimeStamp with { briefly "ETA" described by "Estimated arrival." }
  } with {
    briefly "Notify incoming load"
    described by "Notifies sawmill of an incoming log shipment."
  }

  event LoadReceived is {
    transportId is TransportId with { briefly "Transport" described by "Transport ID." }
    sawmillId is SawmillId with { briefly "Sawmill" described by "Sawmill ID." }
    receivedAt is TimeStamp with { briefly "Received" described by "Reception time." }
  } with {
    briefly "Load received"
    described by "Emitted when sawmill receives a log shipment."
  }

  query GetMillCapacity is {
    sawmillId is SawmillId with { briefly "Sawmill" described by "Sawmill ID." }
  } with {
    briefly "Get mill capacity"
    described by "Gets current sawmill receiving capacity."
  }

  result MillCapacity is {
    sawmillId is SawmillId with { briefly "Sawmill" described by "Sawmill ID." }
    availableSlots is Natural with { briefly "Slots" described by "Available receiving slots." }
    nextAvailable is TimeStamp with { briefly "Next" described by "Next available time." }
  } with {
    briefly "Mill capacity"
    described by "Sawmill receiving capacity information."
  }

} with {
  option is external
  briefly "External sawmill system"
  described by "Sawmill receiving and processing system."
}

context RegulatorySystem is {

  command SubmitHarvestReport is {
    harvestSiteId is HarvestSiteId with { briefly "Site" described by "Harvest site ID." }
    logCount is Natural with { briefly "Count" described by "Number of logs harvested." }
    totalVolume is Decimal(12, 4) with { briefly "Volume" described by "Total volume harvested." }
    reportPeriod is String(3, 50) with { briefly "Period" described by "Reporting period." }
  } with {
    briefly "Submit harvest report"
    described by "Submits harvest volume report to regulatory authority."
  }

  event ReportAccepted is {
    harvestSiteId is HarvestSiteId with { briefly "Site" described by "Harvest site ID." }
    acceptedAt is TimeStamp with { briefly "Accepted" described by "Acceptance time." }
    referenceNumber is String(3, 100) with { briefly "Reference" described by "Report reference number." }
  } with {
    briefly "Report accepted"
    described by "Emitted when harvest report is accepted by regulator."
  }

  query VerifyPermit is {
    harvestPermit is String(3, 100) with { briefly "Permit" described by "Harvest permit number." }
  } with {
    briefly "Verify permit"
    described by "Verifies a harvest permit with regulatory authority."
  }

  result PermitVerification is {
    harvestPermit is String(3, 100) with { briefly "Permit" described by "Harvest permit number." }
    isValid is Boolean with { briefly "Valid" described by "Permit validity." }
    expiresAt is optional Date with { briefly "Expires" described by "Permit expiration date." }
    allowedSpecies is many optional String(3, 50) with { briefly "Species" described by "Permitted species." }
  } with {
    briefly "Permit verification"
    described by "Harvest permit verification result."
  }

} with {
  option is external
  briefly "External regulatory system"
  described by "Government regulatory and compliance system."
}
