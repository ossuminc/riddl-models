// Harvest Planning - Harvest Planning Context
context HarvestPlanningContext is {
  include "types.riddl"
  include "HarvestBlock.riddl"
  repository HarvestPlanningRepository is {
    schema HarvestPlanningData is relational
      of harvestBlocks as type HarvestBlock
        index on field HarvestBlock.blockId
        index on field HarvestBlock.standAssessment.standId
        index on field HarvestBlock.status

    handler HarvestPlanningPersistence is {
      on command HarvestBlock.CreateHarvestBlock is {
        prompt "Store new harvest block"
      }
      on command HarvestBlock.DelineateBlock is {
        prompt "Update block boundary"
      }
      on command HarvestBlock.RecordReviewOutcome is {
        prompt "Store environmental review outcome"
      }
      on command HarvestBlock.ScheduleHarvest is {
        prompt "Store harvest schedule"
      }
      on command HarvestBlock.CompleteHarvest is {
        prompt "Update block to completed"
      }
      on command HarvestBlock.PlanReforestation is {
        prompt "Store reforestation plan"
      }
    } with {
      briefly "Persists harvest planning events"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Harvest planning data persistence"
    described as {
      |Persistent storage for harvest planning.
    }
  }
  projector HarvestMetrics is {
    record BlockMetrics is  {
      blocksProposed: Natural with {
        briefly "Proposed"
        described as {
          |Blocks proposed.
        }
      }
      blocksApproved: Natural with {
        briefly "Approved"
        described as {
          |Blocks approved.
        }
      }
      blocksCompleted: Natural with {
        briefly "Completed"
        described as {
          |Blocks harvested.
        }
      }
      blocksRejected: Natural with {
        briefly "Rejected"
        described as {
          |Blocks rejected.
        }
      }
      totalVolumeHarvested: Decimal(12,2) with {
        briefly "Volume"
        described as {
          |Total volume harvested.
        }
      }
      averageBlockArea: Decimal(8,2) with {
        briefly "Avg area"
        described as {
          |Average block area in hectares.
        }
      }
    } with {
      briefly "Block metrics"
      described as {
        |Harvest block processing metrics.
      }
    }
    handler MetricsHandler is {
      on event HarvestBlock.HarvestBlockCreated is {
        prompt "Increment blocks proposed"
      }
      on event HarvestBlock.ReviewOutcomeRecorded is {
        prompt "Increment blocks approved or rejected"
      }
      on event HarvestBlock.HarvestCompleted is {
        prompt "Increment blocks completed and add volume"
      }
    } with {
      briefly "Maintains harvest metrics"
      described as {
        |Projects events into harvest metrics.
      }
    }
  } with {
    briefly "Harvest metrics"
    described as {
      |Harvest planning analytics.
    }
  }
} with {
  briefly "Bounded context for harvest planning"
  described as {
    |Forestry harvest planning context.
  }
}
