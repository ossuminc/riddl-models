// Crop Management - Crop Context

context CropContext is {

  include "types.riddl"
  include "Field.riddl"

  repository CropRepository is {
    schema CropData is relational
      of fields as Field
      index on field Field.fieldId
      index on field Field.seasonId
      index on field Field.status
      index on field Field.currentCrop

    handler CropPersistence is {
      on command Field.RegisterField {
        prompt "Store new field record"
      }
      on command Field.PlantCrop {
        prompt "Update field with planting data"
      }
      on command Field.RecordApplication {
        prompt "Store application record"
      }
      on command Field.RecordScouting {
        prompt "Store scouting report"
      }
      on command Field.RecordHarvest {
        prompt "Store harvest record"
      }
      on command Field.CompleteHarvest {
        prompt "Update field to harvested status"
      }
    } with {
      briefly "Persists crop commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Crop data persistence"
    described by "Persistent storage for fields and crops."
  }

  projector YieldAnalytics is {
    updates repository CropRepository

    record SeasonYield is {
      seasonId is SeasonId with { briefly "Season" described by "Season ID." }
      cropId is CropId with { briefly "Crop" described by "Crop ID." }
      totalAcres is Decimal(10, 2) with { briefly "Acres" described by "Total acres." }
      aggregateTotalYield is Decimal(15, 2) with { briefly "Yield" described by "Total yield." }
      averageYieldPerAcre is Decimal(8, 2) with { briefly "Avg yield" described by "Average yield per acre." }
      fieldCount is Natural with { briefly "Fields" described by "Number of fields." }
    } with {
      briefly "Season yield"
      described by "Yield summary by season and crop."
    }

    handler AnalyticsHandler is {
      on event Field.CropPlanted {
        prompt "Track acres planted by crop"
      }
      on event Field.HarvestCompleted {
        prompt "Aggregate yields by crop and season"
      }
    } with {
      briefly "Maintains yield analytics"
      described by "Projects events into yield analytics."
    }
  } with {
    briefly "Yield analytics"
    described by "Crop yield analysis and reporting."
  }

} with {
  briefly "Bounded context for crop management"
  described by "Agricultural crop production context."
}
