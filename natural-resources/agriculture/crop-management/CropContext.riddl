// Crop Management - Crop Context
context CropContext is {
  include "types.riddl"
  include "Field.riddl"
  repository CropRepository is {
    schema CropData is relational
      of fields as type Field
        index on field Field.fieldId
        index on field Field.seasonId
        index on field Field.status
        index on field Field.currentCrop

    handler CropPersistence is {
      on command Field.RegisterField is {
        prompt "Store new field record"
      }
      on command Field.PlantCrop is {
        prompt "Update field with planting data"
      }
      on command Field.RecordApplication is {
        prompt "Store application record"
      }
      on command Field.RecordScouting is {
        prompt "Store scouting report"
      }
      on command Field.RecordHarvest is {
        prompt "Store harvest record"
      }
      on command Field.CompleteHarvest is {
        prompt "Update field to harvested status"
      }
    } with {
      briefly "Persists crop commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Crop data persistence"
    described as {
      |Persistent storage for fields and crops.
    }
  }
  projector YieldAnalytics is {
    record SeasonYield is  {
      seasonId: SeasonId with {
        briefly "Season"
        described as {
          |Season ID.
        }
      }
      cropId: CropId with {
        briefly "Crop"
        described as {
          |Crop ID.
        }
      }
      totalAcres: Decimal(10,2) with {
        briefly "Acres"
        described as {
          |Total acres.
        }
      }
      aggregateTotalYield: Decimal(15,2) with {
        briefly "Yield"
        described as {
          |Total yield.
        }
      }
      averageYieldPerAcre: Decimal(8,2) with {
        briefly "Avg yield"
        described as {
          |Average yield per acre.
        }
      }
      fieldCount: Natural with {
        briefly "Fields"
        described as {
          |Number of fields.
        }
      }
    } with {
      briefly "Season yield"
      described as {
        |Yield summary by season and crop.
      }
    }
    handler AnalyticsHandler is {
      on event Field.CropPlanted is {
        prompt "Track acres planted by crop"
      }
      on event Field.HarvestCompleted is {
        prompt "Aggregate yields by crop and season"
      }
    } with {
      briefly "Maintains yield analytics"
      described as {
        |Projects events into yield analytics.
      }
    }
  } with {
    briefly "Yield analytics"
    described as {
      |Crop yield analysis and reporting.
    }
  }
} with {
  briefly "Bounded context for crop management"
  described as {
    |Agricultural crop production context.
  }
}
