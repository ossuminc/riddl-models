// Crop Management - External Contexts

context WeatherService is {

  query GetForecast is {
    location is String(1, 200) with { briefly "Location" described by "Location." }
    days is Natural with { briefly "Days" described by "Forecast days." }
  } with {
    briefly "Get weather forecast"
    described by "Gets weather forecast for location."
  }

  result WeatherForecast is {
    location is String(1, 200) with { briefly "Location" described by "Location." }
    forecasts is many WeatherData with { briefly "Forecasts" described by "Daily forecasts." }
    lastUpdated is TimeStamp with { briefly "Updated" described by "Last update time." }
  } with {
    briefly "Weather forecast"
    described by "Multi-day weather forecast."
  }

  query GetHistoricalWeather is {
    location is String(1, 200) with { briefly "Location" described by "Location." }
    startDate is Date with { briefly "Start" described by "Start date." }
    endDate is Date with { briefly "End" described by "End date." }
  } with {
    briefly "Get historical weather"
    described by "Gets historical weather data."
  }

  result HistoricalWeather is {
    location is String(1, 200) with { briefly "Location" described by "Location." }
    data is many WeatherData with { briefly "Data" described by "Weather records." }
  } with {
    briefly "Historical weather"
    described by "Historical weather data."
  }

} with {
  option is external
  briefly "External weather service"
  described by "Weather data provider."
}

context MarketPrices is {

  query GetCropPrices is {
    cropType is CropType with { briefly "Crop" described by "Crop type." }
    market is String(1, 100) with { briefly "Market" described by "Market location." }
  } with {
    briefly "Get crop prices"
    described by "Gets current crop prices."
  }

  result CropPriceInfo is {
    cropType is CropType with { briefly "Crop" described by "Crop type." }
    spotPrice is Decimal(8, 2) with { briefly "Spot" described by "Spot price." }
    futuresPrice is Decimal(8, 2) with { briefly "Futures" described by "Futures price." }
    priceUnit is String(1, 20) with { briefly "Unit" described by "Price unit." }
    asOf is TimeStamp with { briefly "As of" described by "Price timestamp." }
  } with {
    briefly "Crop price info"
    described by "Current crop pricing."
  }

} with {
  option is external
  briefly "External market prices"
  described by "Commodity market price feed."
}

context SoilTesting is {

  command SubmitSoilSample is {
    fieldId is FieldId with { briefly "Field" described by "Field ID." }
    sampleDate is Date with { briefly "Date" described by "Sample date." }
    sampleLocation is String(1, 200) with { briefly "Location" described by "Sample location." }
  } with {
    briefly "Submit soil sample"
    described by "Submits soil sample for testing."
  }

  event SoilResultsReceived is {
    fieldId is FieldId with { briefly "Field" described by "Field ID." }
    pH is Decimal(4, 2) with { briefly "pH" described by "Soil pH." }
    nitrogen is Decimal(6, 2) with { briefly "N" described by "Nitrogen ppm." }
    phosphorus is Decimal(6, 2) with { briefly "P" described by "Phosphorus ppm." }
    potassium is Decimal(6, 2) with { briefly "K" described by "Potassium ppm." }
    organicMatter is Decimal(5, 2) with { briefly "OM" described by "Organic matter percent." }
    recommendations is String(1, 2000) with { briefly "Recommendations" described by "Fertilizer recommendations." }
  } with {
    briefly "Soil results received"
    described by "Emitted when soil test results arrive."
  }

} with {
  option is external
  briefly "External soil testing"
  described by "Soil testing laboratory."
}

context EquipmentTracking is {

  query GetEquipmentLocation is {
    equipmentId is UUID with { briefly "Equipment" described by "Equipment ID." }
  } with {
    briefly "Get equipment location"
    described by "Gets GPS location of equipment."
  }

  result EquipmentLocation is {
    equipmentId is UUID with { briefly "Equipment" described by "Equipment ID." }
    latitude is Decimal(10, 7) with { briefly "Lat" described by "Latitude." }
    longitude is Decimal(10, 7) with { briefly "Long" described by "Longitude." }
    speed is Decimal(5, 1) with { briefly "Speed" described by "Speed MPH." }
    heading is Natural with { briefly "Heading" described by "Heading degrees." }
    lastUpdate is TimeStamp with { briefly "Updated" described by "Last update." }
  } with {
    briefly "Equipment location"
    described by "Real-time equipment position."
  }

} with {
  option is external
  briefly "External equipment tracking"
  described by "GPS fleet management system."
}
