// Crop Management - External Contexts
context WeatherService is {
  query GetForecast is  {
    location: String(1,200) with {
      briefly "Location"
      described as {
        |Location.
      }
    }
    days: Natural with {
      briefly "Days"
      described as {
        |Forecast days.
      }
    }
  } with {
    briefly "Get weather forecast"
    described as {
      |Gets weather forecast for location.
    }
  }
  result WeatherForecast is  {
    location: String(1,200) with {
      briefly "Location"
      described as {
        |Location.
      }
    }
    forecasts: WeatherData+ with {
      briefly "Forecasts"
      described as {
        |Daily forecasts.
      }
    }
    lastUpdated: TimeStamp with {
      briefly "Updated"
      described as {
        |Last update time.
      }
    }
  } with {
    briefly "Weather forecast"
    described as {
      |Multi-day weather forecast.
    }
  }
  query GetHistoricalWeather is  {
    location: String(1,200) with {
      briefly "Location"
      described as {
        |Location.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Start date.
      }
    }
    endDate: Date with {
      briefly "End"
      described as {
        |End date.
      }
    }
  } with {
    briefly "Get historical weather"
    described as {
      |Gets historical weather data.
    }
  }
  result HistoricalWeather is  {
    location: String(1,200) with {
      briefly "Location"
      described as {
        |Location.
      }
    }
    data: WeatherData+ with {
      briefly "Data"
      described as {
        |Weather records.
      }
    }
  } with {
    briefly "Historical weather"
    described as {
      |Historical weather data.
    }
  }
} with {
  option external()
  briefly "External weather service"
  described as {
    |Weather data provider.
  }
}
context MarketPrices is {
  query GetCropPrices is  {
    cropType: CropType with {
      briefly "Crop"
      described as {
        |Crop type.
      }
    }
    market: String(1,100) with {
      briefly "Market"
      described as {
        |Market location.
      }
    }
  } with {
    briefly "Get crop prices"
    described as {
      |Gets current crop prices.
    }
  }
  result CropPriceInfo is  {
    cropType: CropType with {
      briefly "Crop"
      described as {
        |Crop type.
      }
    }
    spotPrice: Decimal(8,2) with {
      briefly "Spot"
      described as {
        |Spot price.
      }
    }
    futuresPrice: Decimal(8,2) with {
      briefly "Futures"
      described as {
        |Futures price.
      }
    }
    priceUnit: String(1,20) with {
      briefly "Unit"
      described as {
        |Price unit.
      }
    }
    asOf: TimeStamp with {
      briefly "As of"
      described as {
        |Price timestamp.
      }
    }
  } with {
    briefly "Crop price info"
    described as {
      |Current crop pricing.
    }
  }
} with {
  option external()
  briefly "External market prices"
  described as {
    |Commodity market price feed.
  }
}
context SoilTesting is {
  command SubmitSoilSample is  {
    fieldId: FieldId with {
      briefly "Field"
      described as {
        |Field ID.
      }
    }
    sampleDate: Date with {
      briefly "Date"
      described as {
        |Sample date.
      }
    }
    sampleLocation: String(1,200) with {
      briefly "Location"
      described as {
        |Sample location.
      }
    }
  } with {
    briefly "Submit soil sample"
    described as {
      |Submits soil sample for testing.
    }
  }
  event SoilResultsReceived is  {
    fieldId: FieldId with {
      briefly "Field"
      described as {
        |Field ID.
      }
    }
    pH: Decimal(4,2) with {
      briefly "pH"
      described as {
        |Soil pH.
      }
    }
    nitrogen: Decimal(6,2) with {
      briefly "N"
      described as {
        |Nitrogen ppm.
      }
    }
    phosphorus: Decimal(6,2) with {
      briefly "P"
      described as {
        |Phosphorus ppm.
      }
    }
    potassium: Decimal(6,2) with {
      briefly "K"
      described as {
        |Potassium ppm.
      }
    }
    organicMatter: Decimal(5,2) with {
      briefly "OM"
      described as {
        |Organic matter percent.
      }
    }
    recommendations: String(1,2000) with {
      briefly "Recommendations"
      described as {
        |Fertilizer recommendations.
      }
    }
  } with {
    briefly "Soil results received"
    described as {
      |Emitted when soil test results arrive.
    }
  }
} with {
  option external()
  briefly "External soil testing"
  described as {
    |Soil testing laboratory.
  }
}
context EquipmentTracking is {
  query GetEquipmentLocation is  {
    equipmentId: UUID with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
  } with {
    briefly "Get equipment location"
    described as {
      |Gets GPS location of equipment.
    }
  }
  result EquipmentLocation is  {
    equipmentId: UUID with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    latitude: Decimal(10,7) with {
      briefly "Lat"
      described as {
        |Latitude.
      }
    }
    longitude: Decimal(10,7) with {
      briefly "Long"
      described as {
        |Longitude.
      }
    }
    speed: Decimal(5,1) with {
      briefly "Speed"
      described as {
        |Speed MPH.
      }
    }
    heading: Natural with {
      briefly "Heading"
      described as {
        |Heading degrees.
      }
    }
    lastUpdate: TimeStamp with {
      briefly "Updated"
      described as {
        |Last update.
      }
    }
  } with {
    briefly "Equipment location"
    described as {
      |Real-time equipment position.
    }
  }
} with {
  option external()
  briefly "External equipment tracking"
  described as {
    |GPS fleet management system.
  }
}
