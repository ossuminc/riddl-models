// Livestock Management - LivestockAnimal Entity
entity LivestockAnimal is {
  command RegisterAnimal is  {
    animalId: AnimalId with {
      briefly "Animal ID"
      described as {
        |New animal identifier.
      }
    }
    animalInfo: AnimalInfo with {
      briefly "Animal info"
      described as {
        |Animal details.
      }
    }
    initialWeight: WeightRecord? with {
      briefly "Initial weight"
      described as {
        |Weight at registration.
      }
    }
  } with {
    briefly "Register animal"
    described as {
      |Registers a new animal in the herd.
    }
  }
  command RecordWeight is  {
    animalId: AnimalId with {
      briefly "Animal ID"
      described as {
        |Animal identifier.
      }
    }
    weightRecord: WeightRecord with {
      briefly "Weight"
      described as {
        |Weight measurement.
      }
    }
  } with {
    briefly "Record weight"
    described as {
      |Records an animal weight measurement.
    }
  }
  command RecordVetVisit is  {
    animalId: AnimalId with {
      briefly "Animal ID"
      described as {
        |Animal identifier.
      }
    }
    vetRecord: VetRecord with {
      briefly "Vet record"
      described as {
        |Veterinary visit record.
      }
    }
  } with {
    briefly "Record vet visit"
    described as {
      |Records a veterinary visit.
    }
  }
  command UpdateHealthStatus is  {
    animalId: AnimalId with {
      briefly "Animal ID"
      described as {
        |Animal identifier.
      }
    }
    newStatus: HealthStatus with {
      briefly "New status"
      described as {
        |Updated health status.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Reason for status change.
      }
    }
  } with {
    briefly "Update health status"
    described as {
      |Updates the animal health status.
    }
  }
  command RecordBreeding is  {
    animalId: AnimalId with {
      briefly "Animal ID"
      described as {
        |Animal identifier.
      }
    }
    breedingRecord: BreedingRecord with {
      briefly "Breeding record"
      described as {
        |Breeding event details.
      }
    }
  } with {
    briefly "Record breeding"
    described as {
      |Records a breeding event.
    }
  }
  command RecordFeeding is  {
    animalId: AnimalId with {
      briefly "Animal ID"
      described as {
        |Animal identifier.
      }
    }
    feedingRecord: FeedingRecord with {
      briefly "Feeding record"
      described as {
        |Feeding event details.
      }
    }
  } with {
    briefly "Record feeding"
    described as {
      |Records a feeding event.
    }
  }
  command TransferHerd is  {
    animalId: AnimalId with {
      briefly "Animal ID"
      described as {
        |Animal identifier.
      }
    }
    newHerdId: HerdId with {
      briefly "New herd"
      described as {
        |Target herd identifier.
      }
    }
    transferDate: Date with {
      briefly "Transfer date"
      described as {
        |Date of transfer.
      }
    }
  } with {
    briefly "Transfer herd"
    described as {
      |Transfers animal to a different herd.
    }
  }
  command SellAnimal is  {
    animalId: AnimalId with {
      briefly "Animal ID"
      described as {
        |Animal identifier.
      }
    }
    saleInfo: SaleInfo with {
      briefly "Sale info"
      described as {
        |Sale details.
      }
    }
  } with {
    briefly "Sell animal"
    described as {
      |Records the sale of an animal.
    }
  }
  command RecordDeath is  {
    animalId: AnimalId with {
      briefly "Animal ID"
      described as {
        |Animal identifier.
      }
    }
    deathDate: Date with {
      briefly "Death date"
      described as {
        |Date of death.
      }
    }
    cause: String(3,500) with {
      briefly "Cause"
      described as {
        |Cause of death.
      }
    }
  } with {
    briefly "Record death"
    described as {
      |Records the death of an animal.
    }
  }
  // Events
  event AnimalRegistered is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    animalInfo: AnimalInfo with {
      briefly "Info"
      described as {
        |Animal info.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Animal registered"
    described as {
      |Emitted when an animal is registered.
    }
  }
  event WeightRecorded is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    weightRecord: WeightRecord with {
      briefly "Weight"
      described as {
        |Weight record.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Recording time.
      }
    }
  } with {
    briefly "Weight recorded"
    described as {
      |Emitted when a weight measurement is recorded.
    }
  }
  event VetVisitRecorded is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    vetRecord: VetRecord with {
      briefly "Record"
      described as {
        |Vet record.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Recording time.
      }
    }
  } with {
    briefly "Vet visit recorded"
    described as {
      |Emitted when a veterinary visit is recorded.
    }
  }
  event HealthStatusUpdated is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    newStatus: HealthStatus with {
      briefly "Status"
      described as {
        |New health status.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Health status updated"
    described as {
      |Emitted when health status changes.
    }
  }
  event BreedingRecorded is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    breedingRecord: BreedingRecord with {
      briefly "Record"
      described as {
        |Breeding record.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Recording time.
      }
    }
  } with {
    briefly "Breeding recorded"
    described as {
      |Emitted when a breeding event is recorded.
    }
  }
  event FeedingRecorded is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    feedingRecord: FeedingRecord with {
      briefly "Record"
      described as {
        |Feeding record.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Recording time.
      }
    }
  } with {
    briefly "Feeding recorded"
    described as {
      |Emitted when a feeding event is recorded.
    }
  }
  event HerdTransferred is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    newHerdId: HerdId with {
      briefly "New herd"
      described as {
        |Target herd.
      }
    }
    transferredAt: TimeStamp with {
      briefly "Transferred"
      described as {
        |Transfer time.
      }
    }
  } with {
    briefly "Herd transferred"
    described as {
      |Emitted when an animal is transferred.
    }
  }
  event AnimalSold is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    saleInfo: SaleInfo with {
      briefly "Sale"
      described as {
        |Sale details.
      }
    }
    soldAt: TimeStamp with {
      briefly "Sold"
      described as {
        |Sale time.
      }
    }
  } with {
    briefly "Animal sold"
    described as {
      |Emitted when an animal is sold.
    }
  }
  event DeathRecorded is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    deathDate: Date with {
      briefly "Death date"
      described as {
        |Date of death.
      }
    }
    cause: String(3,500) with {
      briefly "Cause"
      described as {
        |Cause of death.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Recording time.
      }
    }
  } with {
    briefly "Death recorded"
    described as {
      |Emitted when an animal death is recorded.
    }
  }
  // States
  record ActiveAnimalData is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    animalInfo: AnimalInfo with {
      briefly "Info"
      described as {
        |Animal details.
      }
    }
    healthStatus: HealthStatus with {
      briefly "Health"
      described as {
        |Health status.
      }
    }
    lifecycle: AnimalLifecycle with {
      briefly "Lifecycle"
      described as {
        |Lifecycle stage.
      }
    }
    weightHistory: WeightRecord* with {
      briefly "Weights"
      described as {
        |Weight history.
      }
    }
    vetRecords: VetRecord* with {
      briefly "Vet records"
      described as {
        |Veterinary records.
      }
    }
    breedingRecords: BreedingRecord* with {
      briefly "Breeding"
      described as {
        |Breeding records.
      }
    }
    feedingRecords: FeedingRecord* with {
      briefly "Feeding"
      described as {
        |Feeding records.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Active animal state"
    described as {
      |State for an active livestock animal.
    }
  }
  record SoldAnimalData is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    saleInfo: SaleInfo with {
      briefly "Sale"
      described as {
        |Sale details.
      }
    }
    soldAt: TimeStamp with {
      briefly "Sold"
      described as {
        |Sale time.
      }
    }
  } with {
    briefly "Sold animal state"
    described as {
      |State for a sold animal.
    }
  }
  record DeceasedAnimalData is  {
    animalId: AnimalId with {
      briefly "Animal"
      described as {
        |Animal ID.
      }
    }
    deathDate: Date with {
      briefly "Death date"
      described as {
        |Date of death.
      }
    }
    cause: String(3,500) with {
      briefly "Cause"
      described as {
        |Cause of death.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Recording time.
      }
    }
  } with {
    briefly "Deceased animal state"
    described as {
      |State for a deceased animal.
    }
  }
  state ActiveAnimalState of type LivestockAnimal.ActiveAnimalData
  state SoldAnimalState of type LivestockAnimal.SoldAnimalData
  state DeceasedAnimalState of type LivestockAnimal.DeceasedAnimalData
  handler LivestockAnimalHandler is {
    on command RegisterAnimal is {
      morph entity LivestockContext.LivestockAnimal to state LivestockContext.LivestockAnimal.ActiveAnimalState with command RegisterAnimal
      tell event AnimalRegistered to entity LivestockContext.LivestockAnimal
    }
    on command RecordWeight is {
      tell event WeightRecorded to entity LivestockContext.LivestockAnimal
    }
    on command RecordVetVisit is {
      tell event VetVisitRecorded to entity LivestockContext.LivestockAnimal
    }
    on command UpdateHealthStatus is {
      tell event HealthStatusUpdated to entity LivestockContext.LivestockAnimal
    }
    on command RecordBreeding is {
      tell event BreedingRecorded to entity LivestockContext.LivestockAnimal
    }
    on command RecordFeeding is {
      tell event FeedingRecorded to entity LivestockContext.LivestockAnimal
    }
    on command TransferHerd is {
      tell event HerdTransferred to entity LivestockContext.LivestockAnimal
    }
    on command SellAnimal is {
      morph entity LivestockContext.LivestockAnimal to state LivestockContext.LivestockAnimal.SoldAnimalState with command SellAnimal
      tell event AnimalSold to entity LivestockContext.LivestockAnimal
    }
    on command RecordDeath is {
      morph entity LivestockContext.LivestockAnimal to state LivestockContext.LivestockAnimal.DeceasedAnimalState with command RecordDeath
      tell event DeathRecorded to entity LivestockContext.LivestockAnimal
    }
  } with {
    briefly "Processes livestock animal commands"
    described as {
      |Handles livestock animal lifecycle.
    }
  }
} with {
  briefly "LivestockAnimal aggregate"
  described as {
    |Manages individual livestock animals.
  }
}
