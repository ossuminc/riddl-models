// Livestock Management - LivestockAnimal Entity

entity LivestockAnimal is {

  command RegisterAnimal is {
    animalId is AnimalId with {
      briefly "Animal ID"
      described by "New animal identifier."
    }
    animalInfo is AnimalInfo with {
      briefly "Animal info"
      described by "Animal details."
    }
    initialWeight is optional WeightRecord with {
      briefly "Initial weight"
      described by "Weight at registration."
    }
  } with {
    briefly "Register animal"
    described by "Registers a new animal in the herd."
  }

  command RecordWeight is {
    animalId is AnimalId with {
      briefly "Animal ID"
      described by "Animal identifier."
    }
    weightRecord is WeightRecord with {
      briefly "Weight"
      described by "Weight measurement."
    }
  } with {
    briefly "Record weight"
    described by "Records an animal weight measurement."
  }

  command RecordVetVisit is {
    animalId is AnimalId with {
      briefly "Animal ID"
      described by "Animal identifier."
    }
    vetRecord is VetRecord with {
      briefly "Vet record"
      described by "Veterinary visit record."
    }
  } with {
    briefly "Record vet visit"
    described by "Records a veterinary visit."
  }

  command UpdateHealthStatus is {
    animalId is AnimalId with {
      briefly "Animal ID"
      described by "Animal identifier."
    }
    newStatus is HealthStatus with {
      briefly "New status"
      described by "Updated health status."
    }
    reason is String(3, 500) with {
      briefly "Reason"
      described by "Reason for status change."
    }
  } with {
    briefly "Update health status"
    described by "Updates the animal health status."
  }

  command RecordBreeding is {
    animalId is AnimalId with {
      briefly "Animal ID"
      described by "Animal identifier."
    }
    breedingRecord is BreedingRecord with {
      briefly "Breeding record"
      described by "Breeding event details."
    }
  } with {
    briefly "Record breeding"
    described by "Records a breeding event."
  }

  command RecordFeeding is {
    animalId is AnimalId with {
      briefly "Animal ID"
      described by "Animal identifier."
    }
    feedingRecord is FeedingRecord with {
      briefly "Feeding record"
      described by "Feeding event details."
    }
  } with {
    briefly "Record feeding"
    described by "Records a feeding event."
  }

  command TransferHerd is {
    animalId is AnimalId with {
      briefly "Animal ID"
      described by "Animal identifier."
    }
    newHerdId is HerdId with {
      briefly "New herd"
      described by "Target herd identifier."
    }
    transferDate is Date with {
      briefly "Transfer date"
      described by "Date of transfer."
    }
  } with {
    briefly "Transfer herd"
    described by "Transfers animal to a different herd."
  }

  command SellAnimal is {
    animalId is AnimalId with {
      briefly "Animal ID"
      described by "Animal identifier."
    }
    saleInfo is SaleInfo with {
      briefly "Sale info"
      described by "Sale details."
    }
  } with {
    briefly "Sell animal"
    described by "Records the sale of an animal."
  }

  command RecordDeath is {
    animalId is AnimalId with {
      briefly "Animal ID"
      described by "Animal identifier."
    }
    deathDate is Date with {
      briefly "Death date"
      described by "Date of death."
    }
    cause is String(3, 500) with {
      briefly "Cause"
      described by "Cause of death."
    }
  } with {
    briefly "Record death"
    described by "Records the death of an animal."
  }

  // Events
  event AnimalRegistered is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    animalInfo is AnimalInfo with { briefly "Info" described by "Animal info." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Animal registered"
    described by "Emitted when an animal is registered."
  }

  event WeightRecorded is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    weightRecord is WeightRecord with { briefly "Weight" described by "Weight record." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Weight recorded"
    described by "Emitted when a weight measurement is recorded."
  }

  event VetVisitRecorded is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    vetRecord is VetRecord with { briefly "Record" described by "Vet record." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Vet visit recorded"
    described by "Emitted when a veterinary visit is recorded."
  }

  event HealthStatusUpdated is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    newStatus is HealthStatus with { briefly "Status" described by "New health status." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Health status updated"
    described by "Emitted when health status changes."
  }

  event BreedingRecorded is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    breedingRecord is BreedingRecord with { briefly "Record" described by "Breeding record." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Breeding recorded"
    described by "Emitted when a breeding event is recorded."
  }

  event FeedingRecorded is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    feedingRecord is FeedingRecord with { briefly "Record" described by "Feeding record." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Feeding recorded"
    described by "Emitted when a feeding event is recorded."
  }

  event HerdTransferred is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    newHerdId is HerdId with { briefly "New herd" described by "Target herd." }
    transferredAt is TimeStamp with { briefly "Transferred" described by "Transfer time." }
  } with {
    briefly "Herd transferred"
    described by "Emitted when an animal is transferred."
  }

  event AnimalSold is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    saleInfo is SaleInfo with { briefly "Sale" described by "Sale details." }
    soldAt is TimeStamp with { briefly "Sold" described by "Sale time." }
  } with {
    briefly "Animal sold"
    described by "Emitted when an animal is sold."
  }

  event DeathRecorded is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    deathDate is Date with { briefly "Death date" described by "Date of death." }
    cause is String(3, 500) with { briefly "Cause" described by "Cause of death." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Death recorded"
    described by "Emitted when an animal death is recorded."
  }

  // States
  record ActiveAnimalData is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    animalInfo is AnimalInfo with { briefly "Info" described by "Animal details." }
    healthStatus is HealthStatus with { briefly "Health" described by "Health status." }
    lifecycle is AnimalLifecycle with { briefly "Lifecycle" described by "Lifecycle stage." }
    weightHistory is many optional WeightRecord with { briefly "Weights" described by "Weight history." }
    vetRecords is many optional VetRecord with { briefly "Vet records" described by "Veterinary records." }
    breedingRecords is many optional BreedingRecord with { briefly "Breeding" described by "Breeding records." }
    feedingRecords is many optional FeedingRecord with { briefly "Feeding" described by "Feeding records." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Active animal state"
    described by "State for an active livestock animal."
  }

  record SoldAnimalData is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    saleInfo is SaleInfo with { briefly "Sale" described by "Sale details." }
    soldAt is TimeStamp with { briefly "Sold" described by "Sale time." }
  } with {
    briefly "Sold animal state"
    described by "State for a sold animal."
  }

  record DeceasedAnimalData is {
    animalId is AnimalId with { briefly "Animal" described by "Animal ID." }
    deathDate is Date with { briefly "Death date" described by "Date of death." }
    cause is String(3, 500) with { briefly "Cause" described by "Cause of death." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Deceased animal state"
    described by "State for a deceased animal."
  }

  state ActiveAnimalState of LivestockAnimal.ActiveAnimalData with {
    briefly "Animal active"
    described by "Animal is alive and being managed."
  }

  state SoldAnimalState of LivestockAnimal.SoldAnimalData with {
    briefly "Animal sold"
    described by "Animal has been sold."
  }

  state DeceasedAnimalState of LivestockAnimal.DeceasedAnimalData with {
    briefly "Animal deceased"
    described by "Animal is deceased."
  }

  handler LivestockAnimalHandler is {
    on command RegisterAnimal {
      morph entity LivestockContext.LivestockAnimal to state LivestockContext.LivestockAnimal.ActiveAnimalState with command RegisterAnimal
      tell event AnimalRegistered to entity LivestockContext.LivestockAnimal
    }
    on command RecordWeight {
      tell event WeightRecorded to entity LivestockContext.LivestockAnimal
    }
    on command RecordVetVisit {
      tell event VetVisitRecorded to entity LivestockContext.LivestockAnimal
    }
    on command UpdateHealthStatus {
      tell event HealthStatusUpdated to entity LivestockContext.LivestockAnimal
    }
    on command RecordBreeding {
      tell event BreedingRecorded to entity LivestockContext.LivestockAnimal
    }
    on command RecordFeeding {
      tell event FeedingRecorded to entity LivestockContext.LivestockAnimal
    }
    on command TransferHerd {
      tell event HerdTransferred to entity LivestockContext.LivestockAnimal
    }
    on command SellAnimal {
      morph entity LivestockContext.LivestockAnimal to state LivestockContext.LivestockAnimal.SoldAnimalState with command SellAnimal
      tell event AnimalSold to entity LivestockContext.LivestockAnimal
    }
    on command RecordDeath {
      morph entity LivestockContext.LivestockAnimal to state LivestockContext.LivestockAnimal.DeceasedAnimalState with command RecordDeath
      tell event DeathRecorded to entity LivestockContext.LivestockAnimal
    }
  } with {
    briefly "Processes livestock animal commands"
    described by "Handles livestock animal lifecycle."
  }

} with {
  briefly "LivestockAnimal aggregate"
  described by "Manages individual livestock animals."
}
