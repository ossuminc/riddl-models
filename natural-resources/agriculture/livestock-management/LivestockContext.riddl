// Livestock Management - Livestock Context

context LivestockContext is {

  include "types.riddl"
  include "LivestockAnimal.riddl"

  repository LivestockRepository is {
    schema LivestockData is relational
      of livestockAnimals as LivestockAnimal
      index on field LivestockAnimal.animalId
      index on field LivestockAnimal.animalInfo.herdId
      index on field LivestockAnimal.healthStatus

    handler LivestockPersistence is {
      on command LivestockAnimal.RegisterAnimal {
        prompt "Store new animal record"
      }
      on command LivestockAnimal.RecordWeight {
        prompt "Append weight measurement"
      }
      on command LivestockAnimal.RecordVetVisit {
        prompt "Append veterinary record"
      }
      on command LivestockAnimal.UpdateHealthStatus {
        prompt "Update health status"
      }
      on command LivestockAnimal.RecordBreeding {
        prompt "Append breeding record"
      }
      on command LivestockAnimal.SellAnimal {
        prompt "Update animal to sold status"
      }
    } with {
      briefly "Persists livestock commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Livestock data persistence"
    described by "Persistent storage for livestock data."
  }

  projector HerdMetrics is {
    updates repository LivestockRepository

    record HerdMetricsData is {
      totalAnimals is Natural with { briefly "Total" described by "Total active animals." }
      totalSold is Natural with { briefly "Sold" described by "Total animals sold." }
      totalDeceased is Natural with { briefly "Deceased" described by "Total deceased animals." }
      averageWeight is Decimal(8, 2) with { briefly "Avg weight" described by "Average weight in kilograms." }
      breedingCount is Natural with { briefly "Breeding" described by "Animals in breeding program." }
    } with {
      briefly "Herd metrics"
      described by "Aggregate herd statistics."
    }

    handler HerdMetricsHandler is {
      on event LivestockAnimal.AnimalRegistered {
        prompt "Increment total animals"
      }
      on event LivestockAnimal.WeightRecorded {
        prompt "Recalculate average weight"
      }
      on event LivestockAnimal.AnimalSold {
        prompt "Increment sold and decrement active"
      }
      on event LivestockAnimal.DeathRecorded {
        prompt "Increment deceased and decrement active"
      }
    } with {
      briefly "Maintains herd metrics"
      described by "Projects events into herd statistics."
    }
  } with {
    briefly "Herd metrics"
    described by "Livestock herd analytics."
  }

} with {
  briefly "Bounded context for livestock management"
  described by "Livestock tracking and management context."
}
