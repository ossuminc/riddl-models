// Livestock Management - Livestock Context
context LivestockContext is {
  include "types.riddl"
  include "LivestockAnimal.riddl"
  repository LivestockRepository is {
    schema LivestockData is relational
      of livestockAnimals as type LivestockAnimal
        index on field LivestockAnimal.animalId
        index on field LivestockAnimal.animalInfo.herdId
        index on field LivestockAnimal.healthStatus

    handler LivestockPersistence is {
      on command LivestockAnimal.RegisterAnimal is {
        prompt "Store new animal record"
      }
      on command LivestockAnimal.RecordWeight is {
        prompt "Append weight measurement"
      }
      on command LivestockAnimal.RecordVetVisit is {
        prompt "Append veterinary record"
      }
      on command LivestockAnimal.UpdateHealthStatus is {
        prompt "Update health status"
      }
      on command LivestockAnimal.RecordBreeding is {
        prompt "Append breeding record"
      }
      on command LivestockAnimal.SellAnimal is {
        prompt "Update animal to sold status"
      }
    } with {
      briefly "Persists livestock commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Livestock data persistence"
    described as {
      |Persistent storage for livestock data.
    }
  }
  projector HerdMetrics is {
    record HerdMetricsData is  {
      totalAnimals: Natural with {
        briefly "Total"
        described as {
          |Total active animals.
        }
      }
      totalSold: Natural with {
        briefly "Sold"
        described as {
          |Total animals sold.
        }
      }
      totalDeceased: Natural with {
        briefly "Deceased"
        described as {
          |Total deceased animals.
        }
      }
      averageWeight: Decimal(8,2) with {
        briefly "Avg weight"
        described as {
          |Average weight in kilograms.
        }
      }
      breedingCount: Natural with {
        briefly "Breeding"
        described as {
          |Animals in breeding program.
        }
      }
    } with {
      briefly "Herd metrics"
      described as {
        |Aggregate herd statistics.
      }
    }
    handler HerdMetricsHandler is {
      on event LivestockAnimal.AnimalRegistered is {
        prompt "Increment total animals"
      }
      on event LivestockAnimal.WeightRecorded is {
        prompt "Recalculate average weight"
      }
      on event LivestockAnimal.AnimalSold is {
        prompt "Increment sold and decrement active"
      }
      on event LivestockAnimal.DeathRecorded is {
        prompt "Increment deceased and decrement active"
      }
    } with {
      briefly "Maintains herd metrics"
      described as {
        |Projects events into herd statistics.
      }
    }
  } with {
    briefly "Herd metrics"
    described as {
      |Livestock herd analytics.
    }
  }
} with {
  briefly "Bounded context for livestock management"
  described as {
    |Livestock tracking and management context.
  }
}
