// Multi-Tenant Management - External Contexts
context InfrastructureProvisioning is {
  command ProvisionTenantResources is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    isolationLevel: IsolationLevel with {
      briefly "Isolation"
      described as {
        |Isolation level.
      }
    }
    region: String(1,50) with {
      briefly "Region"
      described as {
        |Cloud region.
      }
    }
  } with {
    briefly "Provision tenant resources"
    described as {
      |Provisions infrastructure.
    }
  }
  event ResourcesProvisioned is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    databaseEndpoint: String(1,200) with {
      briefly "DB endpoint"
      described as {
        |Database endpoint.
      }
    }
    storageEndpoint: String(1,200) with {
      briefly "Storage"
      described as {
        |Storage endpoint.
      }
    }
    provisionedAt: TimeStamp with {
      briefly "Provisioned"
      described as {
        |Provision time.
      }
    }
  } with {
    briefly "Resources provisioned"
    described as {
      |Emitted when resources ready.
    }
  }
  command DeprovisionTenantResources is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    retentionDays: Natural with {
      briefly "Retention"
      described as {
        |Data retention days.
      }
    }
  } with {
    briefly "Deprovision tenant resources"
    described as {
      |Removes infrastructure.
    }
  }
} with {
  option external()
  briefly "External infrastructure provisioning"
  described as {
    |Cloud infrastructure management.
  }
}
context IdentityProvider is {
  command CreateTenantRealm is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    realmName: String(1,100) with {
      briefly "Realm"
      described as {
        |Realm name.
      }
    }
    ssoConfig: String(1,2000)? with {
      briefly "SSO"
      described as {
        |SSO configuration.
      }
    }
  } with {
    briefly "Create tenant realm"
    described as {
      |Creates identity realm.
    }
  }
  event RealmCreated is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    realmId: String(1,100) with {
      briefly "Realm"
      described as {
        |Realm ID.
      }
    }
    loginUrl: URL with {
      briefly "Login"
      described as {
        |Login URL.
      }
    }
  } with {
    briefly "Realm created"
    described as {
      |Emitted when realm created.
    }
  }
  command CreateTenantUser is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    user: TenantUserInfo with {
      briefly "User"
      described as {
        |User info.
      }
    }
  } with {
    briefly "Create tenant user"
    described as {
      |Creates user in realm.
    }
  }
} with {
  option external()
  briefly "External identity provider"
  described as {
    |Identity and access management.
  }
}
context BillingSystem is {
  command CreateBillingAccount is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    tier: TenantTier with {
      briefly "Tier"
      described as {
        |Service tier.
      }
    }
    billingEmail: EmailAddress with {
      briefly "Email"
      described as {
        |Billing email.
      }
    }
  } with {
    briefly "Create billing account"
    described as {
      |Creates billing account.
    }
  }
  event BillingAccountCreated is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    accountId: String(1,100) with {
      briefly "Account"
      described as {
        |Billing account ID.
      }
    }
  } with {
    briefly "Billing account created"
    described as {
      |Emitted when account created.
    }
  }
  command UpdateSubscription is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    newTier: TenantTier with {
      briefly "Tier"
      described as {
        |New tier.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Effective date.
      }
    }
  } with {
    briefly "Update subscription"
    described as {
      |Updates subscription tier.
    }
  }
  command RecordUsageMetrics is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    usage: TenantUsage with {
      briefly "Usage"
      described as {
        |Usage metrics.
      }
    }
    billingPeriod: String(1,20) with {
      briefly "Period"
      described as {
        |Billing period.
      }
    }
  } with {
    briefly "Record usage metrics"
    described as {
      |Records usage for billing.
    }
  }
} with {
  option external()
  briefly "External billing system"
  described as {
    |Subscription billing system.
  }
}
context DomainManagement is {
  command VerifyDomain is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    domainName: String(1,255) with {
      briefly "Domain"
      described as {
        |Domain name.
      }
    }
    verificationMethod: String(1,20) with {
      briefly "Method"
      described as {
        |Verification method.
      }
    }
  } with {
    briefly "Verify domain"
    described as {
      |Initiates domain verification.
    }
  }
  event DomainVerified is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    domainName: String(1,255) with {
      briefly "Domain"
      described as {
        |Domain name.
      }
    }
    verifiedAt: TimeStamp with {
      briefly "Verified"
      described as {
        |Verification time.
      }
    }
  } with {
    briefly "Domain verified"
    described as {
      |Emitted when domain verified.
    }
  }
  command ProvisionSSL is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    domainName: String(1,255) with {
      briefly "Domain"
      described as {
        |Domain name.
      }
    }
  } with {
    briefly "Provision SSL"
    described as {
      |Provisions SSL certificate.
    }
  }
  event SSLProvisioned is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    domainName: String(1,255) with {
      briefly "Domain"
      described as {
        |Domain name.
      }
    }
    expiryDate: Date with {
      briefly "Expiry"
      described as {
        |Certificate expiry.
      }
    }
  } with {
    briefly "SSL provisioned"
    described as {
      |Emitted when SSL ready.
    }
  }
} with {
  option external()
  briefly "External domain management"
  described as {
    |Custom domain and SSL management.
  }
}
