// Multi-Tenant Management - Tenant Context
context TenantContext is {
  include "types.riddl"
  include "Tenant.riddl"
  repository TenantRepository is {
    schema TenantData is relational
      of tenants as type Tenant
        index on field Tenant.tenantId
        index on field Tenant.tenantInfo.subdomain
        index on field Tenant.status
        index on field Tenant.tenantInfo.tier

    handler TenantPersistence is {
      on command Tenant.ProvisionTenant is {
        prompt "Store new tenant record"
      }
      on command Tenant.ActivateTenant is {
        prompt "Update tenant to active"
      }
      on command Tenant.UpdateSettings is {
        prompt "Store tenant settings"
      }
      on command Tenant.AddUser is {
        prompt "Store tenant user"
      }
      on command Tenant.RecordUsage is {
        prompt "Store usage metrics"
      }
      on command Tenant.DeactivateTenant is {
        prompt "Update tenant to deactivated"
      }
    } with {
      briefly "Persists tenant commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Tenant data persistence"
    described as {
      |Persistent storage for tenants.
    }
  }
  projector PlatformAnalytics is {
    record PlatformMetrics is  {
      totalTenants: Natural with {
        briefly "Total"
        described as {
          |Total tenants.
        }
      }
      activeTenants: Natural with {
        briefly "Active"
        described as {
          |Active tenants.
        }
      }
      totalUsers: Natural with {
        briefly "Users"
        described as {
          |Total users.
        }
      }
      totalStorageGB: Decimal(15,2) with {
        briefly "Storage"
        described as {
          |Total storage.
        }
      }
      mrr: Decimal(15,2) with {
        briefly "MRR"
        described as {
          |Monthly recurring revenue.
        }
      }
    } with {
      briefly "Platform metrics"
      described as {
        |Platform-wide metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Tenant.TenantProvisioned is {
        prompt "Increment tenant count"
      }
      on event Tenant.UserAdded is {
        prompt "Increment user count"
      }
      on event Tenant.UsageRecorded is {
        prompt "Aggregate storage usage"
      }
      on event Tenant.TierChanged is {
        prompt "Recalculate MRR"
      }
    } with {
      briefly "Maintains platform analytics"
      described as {
        |Projects events into analytics.
      }
    }
  } with {
    briefly "Platform analytics"
    described as {
      |Multi-tenant platform metrics.
    }
  }
} with {
  briefly "Bounded context for multi-tenant management"
  described as {
    |SaaS multi-tenancy context.
  }
}
