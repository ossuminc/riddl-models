// Tenant Provisioning - Tenant Entity

entity Tenant is {

  // Commands
  command CreateTenant is {
    tenantId is TenantId with {
      briefly "Tenant ID"
      described by "New tenant identifier."
    }
    organization is OrganizationInfo with {
      briefly "Organization"
      described by "Organization details."
    }
    admin is AdminInfo with {
      briefly "Admin"
      described by "Initial administrator."
    }
    configuration is TenantConfiguration with {
      briefly "Configuration"
      described by "Initial configuration."
    }
  } with {
    briefly "Create tenant"
    described by "Creates a new tenant."
  }

  command ConfigureTenant is {
    tenantId is TenantId with {
      briefly "Tenant ID"
      described by "Tenant identifier."
    }
    configuration is TenantConfiguration with {
      briefly "Configuration"
      described by "Updated configuration."
    }
  } with {
    briefly "Configure tenant"
    described by "Updates tenant configuration."
  }

  command ProvisionResource is {
    tenantId is TenantId with {
      briefly "Tenant ID"
      described by "Tenant identifier."
    }
    resourceType is ResourceType with {
      briefly "Type"
      described by "Resource type to provision."
    }
    name is String(1, 100) with {
      briefly "Name"
      described by "Resource name."
    }
  } with {
    briefly "Provision resource"
    described by "Provisions an infrastructure resource."
  }

  command ScaleResource is {
    tenantId is TenantId with {
      briefly "Tenant ID"
      described by "Tenant identifier."
    }
    resourceId is ResourceId with {
      briefly "Resource"
      described by "Resource to scale."
    }
    scalingPolicy is ScalingPolicy with {
      briefly "Policy"
      described by "Scaling policy."
    }
  } with {
    briefly "Scale resource"
    described by "Adjusts resource scaling."
  }

  command UpgradeTier is {
    tenantId is TenantId with {
      briefly "Tenant ID"
      described by "Tenant identifier."
    }
    newTier is TenantTier with {
      briefly "New tier"
      described by "Target tier level."
    }
    effectiveDate is Date with {
      briefly "Effective"
      described by "Upgrade effective date."
    }
  } with {
    briefly "Upgrade tier"
    described by "Upgrades tenant tier."
  }

  command SuspendTenant is {
    tenantId is TenantId with {
      briefly "Tenant ID"
      described by "Tenant identifier."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Suspension reason."
    }
  } with {
    briefly "Suspend tenant"
    described by "Suspends tenant access."
  }

  command ReactivateTenant is {
    tenantId is TenantId with {
      briefly "Tenant ID"
      described by "Tenant identifier."
    }
  } with {
    briefly "Reactivate tenant"
    described by "Reactivates suspended tenant."
  }

  command DecommissionTenant is {
    tenantId is TenantId with {
      briefly "Tenant ID"
      described by "Tenant identifier."
    }
    decommission is DecommissionReason with {
      briefly "Decommission"
      described by "Decommission details."
    }
  } with {
    briefly "Decommission tenant"
    described by "Decommissions tenant."
  }

  // Events
  event TenantCreated is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    organization is OrganizationInfo with { briefly "Organization" described by "Organization info." }
    admin is AdminInfo with { briefly "Admin" described by "Initial admin." }
    configuration is TenantConfiguration with { briefly "Configuration" described by "Initial config." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Tenant created"
    described by "Emitted when tenant is created."
  }

  event TenantConfigured is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    configuration is TenantConfiguration with { briefly "Configuration" described by "Updated config." }
    configuredAt is TimeStamp with { briefly "Configured" described by "Configuration time." }
  } with {
    briefly "Tenant configured"
    described by "Emitted when configuration changes."
  }

  event ResourceProvisioned is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    resource is ProvisionedResource with { briefly "Resource" described by "Provisioned resource." }
    provisionedAt is TimeStamp with { briefly "Provisioned" described by "Provisioning time." }
  } with {
    briefly "Resource provisioned"
    described by "Emitted when resource is provisioned."
  }

  event ResourceScaled is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    resourceId is ResourceId with { briefly "Resource" described by "Scaled resource." }
    scalingPolicy is ScalingPolicy with { briefly "Policy" described by "Applied policy." }
    scaledAt is TimeStamp with { briefly "Scaled" described by "Scaling time." }
  } with {
    briefly "Resource scaled"
    described by "Emitted when resource is scaled."
  }

  event TierUpgraded is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    previousTier is TenantTier with { briefly "Previous" described by "Previous tier." }
    newTier is TenantTier with { briefly "New" described by "New tier." }
    effectiveDate is Date with { briefly "Effective" described by "Effective date." }
    upgradedAt is TimeStamp with { briefly "Upgraded" described by "Upgrade time." }
  } with {
    briefly "Tier upgraded"
    described by "Emitted when tier is upgraded."
  }

  event TenantSuspended is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Suspension reason." }
    suspendedAt is TimeStamp with { briefly "Suspended" described by "Suspension time." }
  } with {
    briefly "Tenant suspended"
    described by "Emitted when tenant is suspended."
  }

  event TenantReactivated is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    reactivatedAt is TimeStamp with { briefly "Reactivated" described by "Reactivation time." }
  } with {
    briefly "Tenant reactivated"
    described by "Emitted when tenant is reactivated."
  }

  event TenantDecommissioned is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    decommission is DecommissionReason with { briefly "Decommission" described by "Decommission info." }
    decommissionedAt is TimeStamp with { briefly "Decommissioned" described by "Decommission time." }
  } with {
    briefly "Tenant decommissioned"
    described by "Emitted when tenant is decommissioned."
  }

  // State Records
  record ActiveStateData is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    organization is OrganizationInfo with { briefly "Organization" described by "Organization info." }
    admin is AdminInfo with { briefly "Admin" described by "Primary admin." }
    configuration is TenantConfiguration with { briefly "Configuration" described by "Current config." }
    resources is many optional ProvisionedResource with { briefly "Resources" described by "Provisioned resources." }
    status is TenantStatus with { briefly "Status" described by "Tenant status." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Active state"
    described by "State for active tenant."
  }

  record DecommissionedStateData is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    organization is OrganizationInfo with { briefly "Organization" described by "Organization info." }
    decommission is DecommissionReason with { briefly "Decommission" described by "Decommission info." }
    decommissionedAt is TimeStamp with { briefly "Decommissioned" described by "Decommission time." }
  } with {
    briefly "Decommissioned state"
    described by "State for decommissioned tenant."
  }

  // States
  state ActiveState of Tenant.ActiveStateData with {
    briefly "Tenant active"
    described by "Tenant is operational."
  }

  state DecommissionedState of Tenant.DecommissionedStateData with {
    briefly "Tenant decommissioned"
    described by "Tenant has been decommissioned."
  }

  // Handler
  handler TenantHandler is {
    on command CreateTenant {
      morph entity TenantContext.Tenant to state TenantContext.Tenant.ActiveState with command CreateTenant
      tell event TenantCreated to entity TenantContext.Tenant
    }

    on command ConfigureTenant {
      tell event TenantConfigured to entity TenantContext.Tenant
    }

    on command ProvisionResource {
      tell event ResourceProvisioned to entity TenantContext.Tenant
    }

    on command ScaleResource {
      tell event ResourceScaled to entity TenantContext.Tenant
    }

    on command UpgradeTier {
      tell event TierUpgraded to entity TenantContext.Tenant
    }

    on command SuspendTenant {
      tell event TenantSuspended to entity TenantContext.Tenant
    }

    on command ReactivateTenant {
      tell event TenantReactivated to entity TenantContext.Tenant
    }

    on command DecommissionTenant {
      morph entity TenantContext.Tenant to state TenantContext.Tenant.DecommissionedState with command DecommissionTenant
      tell event TenantDecommissioned to entity TenantContext.Tenant
    }
  } with {
    briefly "Processes tenant commands"
    described by {
      | Handles tenant lifecycle from creation
      | through configuration, scaling, and decommission.
    }
  }

} with {
  briefly "Tenant aggregate"
  described by {
    | The Tenant entity manages multi-tenant SaaS
    | provisioning, configuration, and lifecycle.
  }
}
