// Tenant Provisioning - External Contexts

// Infrastructure Orchestration Service
context InfrastructureOrchestrator is {

  command ProvisionInfrastructure is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    resourceType is ResourceType with { briefly "Type" described by "Resource type." }
    configurationJson is String(1, 5000) with { briefly "Config" described by "Resource configuration." }
  } with {
    briefly "Provision infrastructure"
    described by "Provisions infrastructure resources."
  }

  event InfrastructureProvisioned is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    resourceId is ResourceId with { briefly "Resource" described by "Resource ID." }
    resourceEndpoint is String(1, 500) with { briefly "Endpoint" described by "Resource endpoint." }
    provisionedAt is TimeStamp with { briefly "Provisioned" described by "Provisioning time." }
  } with {
    briefly "Infrastructure provisioned"
    described by "Emitted when infrastructure is ready."
  }

  event InfrastructureProvisioningFailed is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    errorCode is String(1, 50) with { briefly "Error" described by "Error code." }
    errorMessage is String(1, 500) with { briefly "Message" described by "Error message." }
  } with {
    briefly "Provisioning failed"
    described by "Emitted when provisioning fails."
  }

} with {
  option is external
  briefly "External infrastructure orchestration"
  described by "External infrastructure provisioning service."
}

// Identity Provider Service
context IdentityProviderService is {

  command CreateTenantRealm is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    domain is String(1, 253) with { briefly "Domain" described by "Tenant domain." }
    adminEmail is String(5, 254) with { briefly "Admin" described by "Admin email." }
  } with {
    briefly "Create tenant realm"
    described by "Creates identity realm for tenant."
  }

  event TenantRealmCreated is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    realmId is UUID with { briefly "Realm" described by "Realm identifier." }
    ssoEndpoint is String(1, 500) with { briefly "SSO endpoint" described by "SSO URL." }
  } with {
    briefly "Realm created"
    described by "Emitted when identity realm is created."
  }

  command ConfigureSSO is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    ssoProvider is String(1, 50) with { briefly "Provider" described by "SSO provider type." }
    ssoConfig is String(1, 5000) with { briefly "Config" described by "SSO configuration." }
  } with {
    briefly "Configure SSO"
    described by "Configures single sign-on."
  }

  event SSOConfigured is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    provider is String(1, 50) with { briefly "Provider" described by "SSO provider." }
    configuredAt is TimeStamp with { briefly "Configured" described by "Configuration time." }
  } with {
    briefly "SSO configured"
    described by "Emitted when SSO is configured."
  }

} with {
  option is external
  briefly "External identity provider"
  described by "External identity and SSO service."
}

// DNS Management Service
context DNSManagementService is {

  command ConfigureCustomDomain is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    domainName is String(1, 253) with { briefly "Domain" described by "Custom domain." }
    targetEndpoint is String(1, 500) with { briefly "Target" described by "Target endpoint." }
  } with {
    briefly "Configure custom domain"
    described by "Sets up custom domain DNS."
  }

  event CustomDomainConfigured is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    domainName is String(1, 253) with { briefly "Domain" described by "Custom domain." }
    sslCertificateId is UUID with { briefly "Certificate" described by "SSL certificate ID." }
    configuredAt is TimeStamp with { briefly "Configured" described by "Configuration time." }
  } with {
    briefly "Domain configured"
    described by "Emitted when custom domain is ready."
  }

  event DomainVerificationFailed is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    domainName is String(1, 253) with { briefly "Domain" described by "Custom domain." }
    reason is String(1, 200) with { briefly "Reason" described by "Failure reason." }
  } with {
    briefly "Verification failed"
    described by "Emitted when domain verification fails."
  }

} with {
  option is external
  briefly "External DNS management"
  described by "External DNS and SSL certificate service."
}

// Billing Integration Service
context BillingIntegrationService is {

  command CreateBillingAccount is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    organizationName is String(1, 200) with { briefly "Organization" described by "Organization name." }
    tier is TenantTier with { briefly "Tier" described by "Service tier." }
    billingEmail is String(5, 254) with { briefly "Email" described by "Billing email." }
  } with {
    briefly "Create billing account"
    described by "Creates billing account for tenant."
  }

  event BillingAccountCreated is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    billingAccountId is UUID with { briefly "Account" described by "Billing account ID." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Billing account created"
    described by "Emitted when billing is set up."
  }

  command UpdateBillingTier is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    newTier is TenantTier with { briefly "Tier" described by "New tier." }
    effectiveDate is Date with { briefly "Effective" described by "Effective date." }
  } with {
    briefly "Update billing tier"
    described by "Updates billing for tier change."
  }

  event BillingTierUpdated is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    previousTier is TenantTier with { briefly "Previous" described by "Previous tier." }
    newTier is TenantTier with { briefly "New" described by "New tier." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Billing tier updated"
    described by "Emitted when billing tier changes."
  }

} with {
  option is external
  briefly "External billing integration"
  described by "External billing and subscription service."
}

// Monitoring Service
context MonitoringService is {

  command SetupTenantMonitoring is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    monitoredResources is many ResourceId with { briefly "Resources" described by "Resources to monitor." }
    alertThresholds is String(1, 2000) with { briefly "Thresholds" described by "Alert configuration." }
  } with {
    briefly "Setup monitoring"
    described by "Configures tenant monitoring."
  }

  event MonitoringConfigured is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    dashboardUrl is URL with { briefly "Dashboard" described by "Monitoring dashboard URL." }
    configuredAt is TimeStamp with { briefly "Configured" described by "Configuration time." }
  } with {
    briefly "Monitoring configured"
    described by "Emitted when monitoring is set up."
  }

  query GetTenantMetrics is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    startTime is TimeStamp with { briefly "Start" described by "Period start." }
    endTime is TimeStamp with { briefly "End" described by "Period end." }
  } with {
    briefly "Get metrics"
    described by "Retrieves tenant metrics."
  }

  result TenantMetrics is {
    tenantId is TenantId with { briefly "Tenant" described by "Tenant ID." }
    cpuUtilization is Decimal(5, 2) with { briefly "CPU" described by "CPU utilization percent." }
    memoryUtilization is Decimal(5, 2) with { briefly "Memory" described by "Memory utilization percent." }
    storageUsed is Natural with { briefly "Storage" described by "Storage used in GB." }
    requestCount is Natural with { briefly "Requests" described by "Request count." }
  } with {
    briefly "Tenant metrics"
    described by "Resource utilization metrics."
  }

} with {
  option is external
  briefly "External monitoring"
  described by "External monitoring and alerting service."
}
