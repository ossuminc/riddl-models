// Tenant Provisioning - External Contexts
// Infrastructure Orchestration Service
context InfrastructureOrchestrator is {
  command ProvisionInfrastructure is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    resourceType: ResourceType with {
      briefly "Type"
      described as {
        |Resource type.
      }
    }
    configurationJson: String(1,5000) with {
      briefly "Config"
      described as {
        |Resource configuration.
      }
    }
  } with {
    briefly "Provision infrastructure"
    described as {
      |Provisions infrastructure resources.
    }
  }
  event InfrastructureProvisioned is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    resourceId: ResourceId with {
      briefly "Resource"
      described as {
        |Resource ID.
      }
    }
    resourceEndpoint: String(1,500) with {
      briefly "Endpoint"
      described as {
        |Resource endpoint.
      }
    }
    provisionedAt: TimeStamp with {
      briefly "Provisioned"
      described as {
        |Provisioning time.
      }
    }
  } with {
    briefly "Infrastructure provisioned"
    described as {
      |Emitted when infrastructure is ready.
    }
  }
  event InfrastructureProvisioningFailed is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    errorCode: String(1,50) with {
      briefly "Error"
      described as {
        |Error code.
      }
    }
    errorMessage: String(1,500) with {
      briefly "Message"
      described as {
        |Error message.
      }
    }
  } with {
    briefly "Provisioning failed"
    described as {
      |Emitted when provisioning fails.
    }
  }
} with {
  option external()
  briefly "External infrastructure orchestration"
  described as {
    |External infrastructure provisioning service.
  }
}
// Identity Provider Service
context IdentityProviderService is {
  command CreateTenantRealm is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    domain: String(1,253) with {
      briefly "Domain"
      described as {
        |Tenant domain.
      }
    }
    adminEmail: String(5,254) with {
      briefly "Admin"
      described as {
        |Admin email.
      }
    }
  } with {
    briefly "Create tenant realm"
    described as {
      |Creates identity realm for tenant.
    }
  }
  event TenantRealmCreated is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    realmId: UUID with {
      briefly "Realm"
      described as {
        |Realm identifier.
      }
    }
    ssoEndpoint: String(1,500) with {
      briefly "SSO endpoint"
      described as {
        |SSO URL.
      }
    }
  } with {
    briefly "Realm created"
    described as {
      |Emitted when identity realm is created.
    }
  }
  command ConfigureSSO is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    ssoProvider: String(1,50) with {
      briefly "Provider"
      described as {
        |SSO provider type.
      }
    }
    ssoConfig: String(1,5000) with {
      briefly "Config"
      described as {
        |SSO configuration.
      }
    }
  } with {
    briefly "Configure SSO"
    described as {
      |Configures single sign-on.
    }
  }
  event SSOConfigured is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    provider: String(1,50) with {
      briefly "Provider"
      described as {
        |SSO provider.
      }
    }
    configuredAt: TimeStamp with {
      briefly "Configured"
      described as {
        |Configuration time.
      }
    }
  } with {
    briefly "SSO configured"
    described as {
      |Emitted when SSO is configured.
    }
  }
} with {
  option external()
  briefly "External identity provider"
  described as {
    |External identity and SSO service.
  }
}
// DNS Management Service
context DNSManagementService is {
  command ConfigureCustomDomain is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    domainName: String(1,253) with {
      briefly "Domain"
      described as {
        |Custom domain.
      }
    }
    targetEndpoint: String(1,500) with {
      briefly "Target"
      described as {
        |Target endpoint.
      }
    }
  } with {
    briefly "Configure custom domain"
    described as {
      |Sets up custom domain DNS.
    }
  }
  event CustomDomainConfigured is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    domainName: String(1,253) with {
      briefly "Domain"
      described as {
        |Custom domain.
      }
    }
    sslCertificateId: UUID with {
      briefly "Certificate"
      described as {
        |SSL certificate ID.
      }
    }
    configuredAt: TimeStamp with {
      briefly "Configured"
      described as {
        |Configuration time.
      }
    }
  } with {
    briefly "Domain configured"
    described as {
      |Emitted when custom domain is ready.
    }
  }
  event DomainVerificationFailed is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    domainName: String(1,253) with {
      briefly "Domain"
      described as {
        |Custom domain.
      }
    }
    reason: String(1,200) with {
      briefly "Reason"
      described as {
        |Failure reason.
      }
    }
  } with {
    briefly "Verification failed"
    described as {
      |Emitted when domain verification fails.
    }
  }
} with {
  option external()
  briefly "External DNS management"
  described as {
    |External DNS and SSL certificate service.
  }
}
// Billing Integration Service
context BillingIntegrationService is {
  command CreateBillingAccount is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    organizationName: String(1,200) with {
      briefly "Organization"
      described as {
        |Organization name.
      }
    }
    tier: TenantTier with {
      briefly "Tier"
      described as {
        |Service tier.
      }
    }
    billingEmail: String(5,254) with {
      briefly "Email"
      described as {
        |Billing email.
      }
    }
  } with {
    briefly "Create billing account"
    described as {
      |Creates billing account for tenant.
    }
  }
  event BillingAccountCreated is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    billingAccountId: UUID with {
      briefly "Account"
      described as {
        |Billing account ID.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Billing account created"
    described as {
      |Emitted when billing is set up.
    }
  }
  command UpdateBillingTier is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    newTier: TenantTier with {
      briefly "Tier"
      described as {
        |New tier.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Effective date.
      }
    }
  } with {
    briefly "Update billing tier"
    described as {
      |Updates billing for tier change.
    }
  }
  event BillingTierUpdated is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    previousTier: TenantTier with {
      briefly "Previous"
      described as {
        |Previous tier.
      }
    }
    newTier: TenantTier with {
      briefly "New"
      described as {
        |New tier.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Billing tier updated"
    described as {
      |Emitted when billing tier changes.
    }
  }
} with {
  option external()
  briefly "External billing integration"
  described as {
    |External billing and subscription service.
  }
}
// Monitoring Service
context MonitoringService is {
  command SetupTenantMonitoring is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    monitoredResources: ResourceId+ with {
      briefly "Resources"
      described as {
        |Resources to monitor.
      }
    }
    alertThresholds: String(1,2000) with {
      briefly "Thresholds"
      described as {
        |Alert configuration.
      }
    }
  } with {
    briefly "Setup monitoring"
    described as {
      |Configures tenant monitoring.
    }
  }
  event MonitoringConfigured is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    dashboardUrl: URL with {
      briefly "Dashboard"
      described as {
        |Monitoring dashboard URL.
      }
    }
    configuredAt: TimeStamp with {
      briefly "Configured"
      described as {
        |Configuration time.
      }
    }
  } with {
    briefly "Monitoring configured"
    described as {
      |Emitted when monitoring is set up.
    }
  }
  query GetTenantMetrics is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    startTime: TimeStamp with {
      briefly "Start"
      described as {
        |Period start.
      }
    }
    endTime: TimeStamp with {
      briefly "End"
      described as {
        |Period end.
      }
    }
  } with {
    briefly "Get metrics"
    described as {
      |Retrieves tenant metrics.
    }
  }
  result TenantMetrics is  {
    tenantId: TenantId with {
      briefly "Tenant"
      described as {
        |Tenant ID.
      }
    }
    cpuUtilization: Decimal(5,2) with {
      briefly "CPU"
      described as {
        |CPU utilization percent.
      }
    }
    memoryUtilization: Decimal(5,2) with {
      briefly "Memory"
      described as {
        |Memory utilization percent.
      }
    }
    storageUsed: Natural with {
      briefly "Storage"
      described as {
        |Storage used in GB.
      }
    }
    requestCount: Natural with {
      briefly "Requests"
      described as {
        |Request count.
      }
    }
  } with {
    briefly "Tenant metrics"
    described as {
      |Resource utilization metrics.
    }
  }
} with {
  option external()
  briefly "External monitoring"
  described as {
    |External monitoring and alerting service.
  }
}
