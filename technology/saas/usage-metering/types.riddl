// Usage Metering - Shared Types

type MeterId is Id(MeterContext.Meter) with {
  briefly "Meter identifier"
  described by "Unique identifier for a usage meter."
}

type CustomerId is UUID with {
  briefly "Customer identifier"
  described by "Reference to a customer."
}

type SubscriptionId is UUID with {
  briefly "Subscription identifier"
  described by "Reference to a subscription."
}

type EventId is UUID with {
  briefly "Event identifier"
  described by "Reference to a usage event."
}

type MeterStatus is any of {
  Active,
  Paused,
  Closed
} with {
  briefly "Meter status"
  described by "Current meter state."
}

type MetricType is any of {
  APICall,
  StorageGB,
  BandwidthGB,
  ComputeHours,
  Users,
  Transactions,
  Messages,
  Records,
  Custom
} with {
  briefly "Metric type"
  described by "Type of usage metric."
}

type AggregationType is any of {
  Sum,
  Maximum,
  LastValue,
  UniqueCount,
  Average
} with {
  briefly "Aggregation type"
  described by "How to aggregate usage."
}

type BillingPeriod is any of {
  Hourly,
  Daily,
  Weekly,
  Monthly,
  Quarterly,
  Yearly
} with {
  briefly "Billing period"
  described by "Usage aggregation period."
}

type MeterDefinition is {
  meterName is String(1, 100) with {
    briefly "Name"
    described by "Meter name."
  }
  metricType is MetricType with {
    briefly "Metric"
    described by "Metric type."
  }
  aggregationType is AggregationType with {
    briefly "Aggregation"
    described by "Aggregation method."
  }
  billingPeriod is BillingPeriod with {
    briefly "Period"
    described by "Billing period."
  }
  unitName is String(1, 50) with {
    briefly "Unit"
    described by "Unit of measure."
  }
  unitPrice is Decimal(10, 6) with {
    briefly "Price"
    described by "Price per unit."
  }
  includedUnits is Natural with {
    briefly "Included"
    described by "Included free units."
  }
} with {
  briefly "Meter definition"
  described by "Usage meter configuration."
}

type UsageEvent is {
  eventId is EventId with {
    briefly "Event"
    described by "Event identifier."
  }
  timestamp is TimeStamp with {
    briefly "Time"
    described by "Event timestamp."
  }
  metricType is MetricType with {
    briefly "Metric"
    described by "Metric type."
  }
  quantity is Decimal(14, 4) with {
    briefly "Quantity"
    described by "Usage quantity."
  }
  properties is many optional UsageProperty with {
    briefly "Properties"
    described by "Additional properties."
  }
  idempotencyKey is optional String(1, 100) with {
    briefly "Key"
    described by "Idempotency key."
  }
} with {
  briefly "Usage event"
  described by "Single usage event."
}

type UsageProperty is {
  name is String(1, 50) with {
    briefly "Name"
    described by "Property name."
  }
  value is String(1, 200) with {
    briefly "Value"
    described by "Property value."
  }
} with {
  briefly "Usage property"
  described by "Event property."
}

type AggregatedUsage is {
  periodStart is TimeStamp with {
    briefly "Start"
    described by "Period start."
  }
  periodEnd is TimeStamp with {
    briefly "End"
    described by "Period end."
  }
  metricType is MetricType with {
    briefly "Metric"
    described by "Metric type."
  }
  totalQuantity is Decimal(14, 4) with {
    briefly "Total"
    described by "Total usage."
  }
  billableQuantity is Decimal(14, 4) with {
    briefly "Billable"
    described by "Billable quantity."
  }
  eventCount is Natural with {
    briefly "Events"
    described by "Number of events."
  }
  aggregatedAt is TimeStamp with {
    briefly "Aggregated"
    described by "Aggregation time."
  }
} with {
  briefly "Aggregated usage"
  described by "Period usage summary."
}

type UsageAlert is {
  alertId is UUID with {
    briefly "Alert"
    described by "Alert identifier."
  }
  alertType is String(1, 50) with {
    briefly "Type"
    described by "Alert type."
  }
  thresholdValue is Decimal(14, 4) with {
    briefly "Threshold"
    described by "Alert threshold."
  }
  currentValue is Decimal(14, 4) with {
    briefly "Current"
    described by "Current value."
  }
  triggeredAt is TimeStamp with {
    briefly "Triggered"
    described by "Trigger time."
  }
} with {
  briefly "Usage alert"
  described by "Threshold alert."
}

type BillingRecord is {
  billingPeriodStart is Date with {
    briefly "Start"
    described by "Billing period start."
  }
  billingPeriodEnd is Date with {
    briefly "End"
    described by "Billing period end."
  }
  lineItems is many BillingLineItem with {
    briefly "Items"
    described by "Line items."
  }
  totalAmount is Decimal(12, 2) with {
    briefly "Total"
    described by "Total amount."
  }
  generatedAt is TimeStamp with {
    briefly "Generated"
    described by "Generation time."
  }
} with {
  briefly "Billing record"
  described by "Period billing summary."
}

type BillingLineItem is {
  meterName is String(1, 100) with {
    briefly "Meter"
    described by "Meter name."
  }
  quantity is Decimal(14, 4) with {
    briefly "Quantity"
    described by "Usage quantity."
  }
  unitPrice is Decimal(10, 6) with {
    briefly "Price"
    described by "Unit price."
  }
  amount is Decimal(12, 2) with {
    briefly "Amount"
    described by "Line amount."
  }
} with {
  briefly "Billing line item"
  described by "Billing line."
}

type AlertThreshold is {
  metricType is MetricType with {
    briefly "Metric"
    described by "Metric type."
  }
  thresholdValue is Decimal(14, 4) with {
    briefly "Value"
    described by "Threshold value."
  }
  thresholdPercent is optional Decimal(5, 2) with {
    briefly "Percent"
    described by "Percent of limit."
  }
  notifyEmails is many String(5, 254) with {
    briefly "Emails"
    described by "Notification emails."
  }
} with {
  briefly "Alert threshold"
  described by "Usage alert threshold."
}
