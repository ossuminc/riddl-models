// Subscription Management - External Contexts

// Payment Gateway Service
context PaymentGatewayService is {

  command ChargePayment is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Charge amount." }
    currency is String(3, 3) with { briefly "Currency" described by "Currency code." }
    paymentMethodToken is String(1, 100) with { briefly "Token" described by "Payment token." }
  } with {
    briefly "Charge payment"
    described by "Charges customer payment method."
  }

  event PaymentCharged is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    transactionId is String(1, 50) with { briefly "Transaction" described by "Transaction ID." }
    chargedAt is TimeStamp with { briefly "Charged" described by "Charge time." }
  } with {
    briefly "Payment charged"
    described by "Emitted when payment succeeds."
  }

  event PaymentChargeFailed is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    errorCode is String(1, 20) with { briefly "Error" described by "Error code." }
    errorMessage is String(1, 200) with { briefly "Message" described by "Error message." }
  } with {
    briefly "Payment failed"
    described by "Emitted when payment fails."
  }

} with {
  option is external
  briefly "External payment gateway"
  described by "External payment processing service."
}

// Invoice Service
context InvoiceService is {

  command GenerateInvoice is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    periodStart is Date with { briefly "Start" described by "Period start." }
    periodEnd is Date with { briefly "End" described by "Period end." }
    lineItems is many String(1, 200) with { briefly "Items" described by "Line items." }
    amounts is many Decimal(10, 2) with { briefly "Amounts" described by "Line amounts." }
  } with {
    briefly "Generate invoice"
    described by "Generates an invoice."
  }

  event InvoiceGenerated is {
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice ID." }
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    totalAmount is Decimal(10, 2) with { briefly "Total" described by "Total amount." }
    generatedAt is TimeStamp with { briefly "Generated" described by "Generation time." }
  } with {
    briefly "Invoice generated"
    described by "Emitted when invoice is created."
  }

} with {
  option is external
  briefly "External invoicing"
  described by "External invoice generation service."
}

// Provisioning Service
context ProvisioningService is {

  command ProvisionAccess is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    planId is PlanId with { briefly "Plan" described by "Plan ID." }
    features is many String(1, 100) with { briefly "Features" described by "Enabled features." }
  } with {
    briefly "Provision access"
    described by "Provisions customer access."
  }

  event AccessProvisioned is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    provisionedAt is TimeStamp with { briefly "Provisioned" described by "Provisioning time." }
  } with {
    briefly "Access provisioned"
    described by "Emitted when access is granted."
  }

  command RevokeAccess is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
  } with {
    briefly "Revoke access"
    described by "Revokes customer access."
  }

  event AccessRevoked is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    revokedAt is TimeStamp with { briefly "Revoked" described by "Revocation time." }
  } with {
    briefly "Access revoked"
    described by "Emitted when access is revoked."
  }

} with {
  option is external
  briefly "External provisioning"
  described by "External account provisioning service."
}

// Usage Metering Service
context UsageMeteringService is {

  query GetUsage is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    periodStart is Date with { briefly "Start" described by "Period start." }
    periodEnd is Date with { briefly "End" described by "Period end." }
  } with {
    briefly "Get usage"
    described by "Retrieves usage data."
  }

  result UsageData is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    usageItems is many UsageInfo with { briefly "Usage" described by "Usage items." }
    totalAmount is Decimal(12, 2) with { briefly "Total" described by "Total usage amount." }
  } with {
    briefly "Usage data"
    described by "Usage-based billing data."
  }

} with {
  option is external
  briefly "External usage metering"
  described by "External usage tracking service."
}

// Notification Service
context NotificationService is {

  command SendSubscriptionNotification is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    message is String(1, 1000) with { briefly "Message" described by "Message content." }
  } with {
    briefly "Send notification"
    described by "Sends subscription notification."
  }

  event NotificationSent is {
    notificationId is UUID with { briefly "Notification" described by "Notification ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification sent"
    described by "Emitted when notification is delivered."
  }

} with {
  option is external
  briefly "External notifications"
  described by "External notification system."
}
