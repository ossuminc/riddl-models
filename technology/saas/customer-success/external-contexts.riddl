// External Contexts - Integrations with external systems

// CRM Integration
context CRMIntegration is {

  type CrmAccountId is String(1, 50) with {
    briefly "CRM account ID"
    described by "Maps to customer account record in Salesforce, HubSpot, or similar CRM."
  }

  type CrmContactId is String(1, 50) with {
    briefly "CRM contact ID"
    described by "Maps to a contact record in the CRM system."
  }

  type CrmOpportunityId is String(1, 50) with {
    briefly "CRM opportunity ID"
    described by "Maps to a sales opportunity or deal record in the CRM."
  }

  event AccountSyncedFromCrm is {
    crmAccountId is CrmAccountId with { briefly "CRM ID" described by "CRM account ID." }
    companyName is String(1, 200) with { briefly "Company" described by "Company name." }
    industry is String(1, 100) with { briefly "Industry" described by "Industry." }
    employeeCount is optional Integer with { briefly "Employees" described by "Employee count." }
    website is optional URL with { briefly "Website" described by "Company website." }
    syncedAt is TimeStamp with { briefly "Synced" described by "Sync time." }
  } with {
    briefly "Account synced from CRM"
    described by "Emitted when customer account data is pulled from the CRM system."
  }

  event ContactSyncedFromCrm is {
    crmContactId is CrmContactId with { briefly "Contact ID" described by "CRM contact ID." }
    crmAccountId is CrmAccountId with { briefly "Account ID" described by "CRM account ID." }
    contactName is String(1, 100) with { briefly "Name" described by "Contact name." }
    contactEmail is String(5, 254) with { briefly "Email" described by "Contact email." }
    contactRole is optional String(1, 100) with { briefly "Role" described by "Contact role." }
    syncedAt is TimeStamp with { briefly "Synced" described by "Sync time." }
  } with {
    briefly "Contact synced from CRM"
    described by "Emitted when contact information is pulled from the CRM system."
  }

  event OpportunityUpdatedInCrm is {
    crmOpportunityId is CrmOpportunityId with { briefly "Opportunity ID" described by "CRM opportunity ID." }
    crmAccountId is CrmAccountId with { briefly "Account ID" described by "CRM account ID." }
    stage is String(1, 50) with { briefly "Stage" described by "Pipeline stage." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Deal amount." }
    closeDate is optional Date with { briefly "Close date" described by "Expected close." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Opportunity updated in CRM"
    described by "Emitted when an upsell or expansion opportunity is updated in CRM."
  }

  event HealthScorePushedToCrm is {
    crmAccountId is CrmAccountId with { briefly "Account ID" described by "CRM account ID." }
    healthScore is Integer with { briefly "Score" described by "Health score." }
    healthStatus is String(1, 20) with { briefly "Status" described by "Health status." }
    pushedAt is TimeStamp with { briefly "Pushed" described by "Push time." }
  } with {
    briefly "Health score pushed to CRM"
    described by "Emitted when health score data is synchronized to the CRM for sales visibility."
  }

} with {
  option is external
  briefly "CRM integration"
  described by {
    | Represents the boundary with external CRM systems such as Salesforce
    | or HubSpot. Enables bidirectional sync of customer data, contacts,
    | and opportunity information.
  }
}

// Usage Analytics
context UsageAnalytics is {

  type ProductUsageMetrics is {
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    dailyActiveUsers is Integer with { briefly "DAU" described by "Daily active users." }
    weeklyActiveUsers is Integer with { briefly "WAU" described by "Weekly active users." }
    monthlyActiveUsers is Integer with { briefly "MAU" described by "Monthly active users." }
    featuresAdopted is Integer with { briefly "Adopted" described by "Features adopted." }
    totalFeatures is Integer with { briefly "Total" described by "Total features." }
    lastActivityAt is TimeStamp with { briefly "Last activity" described by "Last activity time." }
    measurementPeriod is String(1, 20) with { briefly "Period" described by "Measurement period." }
  } with {
    briefly "Usage metrics"
    described by "Aggregated product usage data used to calculate adoption scores."
  }

  type FeatureUsage is {
    featureName is String(1, 100) with { briefly "Feature" described by "Feature name." }
    usageCount is Integer with { briefly "Usage" described by "Usage count." }
    uniqueUsers is Integer with { briefly "Users" described by "Unique users." }
    lastUsedAt is TimeStamp with { briefly "Last used" described by "Last usage time." }
  } with {
    briefly "Feature usage"
    described by "Tracks how often and by whom a specific product feature is used."
  }

  type UserEngagement is {
    userId is String(1, 50) with { briefly "User" described by "User ID." }
    sessionCount is Integer with { briefly "Sessions" described by "Session count." }
    totalTimeMinutes is Integer with { briefly "Time" described by "Total minutes." }
    actionsPerformed is Integer with { briefly "Actions" described by "Actions performed." }
    lastSessionAt is TimeStamp with { briefly "Last session" described by "Last session time." }
  } with {
    briefly "User engagement"
    described by "Individual user engagement data for license utilization analysis."
  }

  event UsageMetricsCalculated is {
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    metrics is ProductUsageMetrics with { briefly "Metrics" described by "Usage metrics." }
    calculatedAt is TimeStamp with { briefly "Calculated" described by "Calculation time." }
  } with {
    briefly "Usage metrics calculated"
    described by "Emitted when periodic usage metrics are computed for a customer."
  }

  event AdoptionScoreUpdated is {
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    adoptionScore is Integer with { briefly "Score" described by "Adoption score." }
    adoptedFeatures is many String(1, 100) with { briefly "Adopted" described by "Features adopted." }
    unusedFeatures is many String(1, 100) with { briefly "Unused" described by "Features unused." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Adoption score updated"
    described by "Emitted when the adoption component of health score is recalculated."
  }

  event UsageAnomalyDetected is {
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    anomalyType is String(1, 50) with { briefly "Type" described by "Anomaly type." }
    currentValue is Decimal(14, 4) with { briefly "Current" described by "Current value." }
    expectedValue is Decimal(14, 4) with { briefly "Expected" described by "Expected value." }
    deviationPercent is Decimal(5, 2) with { briefly "Deviation" described by "Deviation percent." }
    detectedAt is TimeStamp with { briefly "Detected" described by "Detection time." }
  } with {
    briefly "Usage anomaly detected"
    described by "Emitted when usage significantly deviates from historical patterns."
  }

} with {
  option is external
  briefly "Usage analytics"
  described by {
    | Represents the boundary with product analytics systems that track
    | user behavior and feature adoption. This data feeds into health
    | score calculations and enables proactive outreach.
  }
}

// Billing Service
context BillingService is {

  type InvoiceId is String(1, 50) with {
    briefly "Invoice ID"
    described by "Unique identifier for an invoice in the billing system."
  }

  type SubscriptionId is String(1, 50) with {
    briefly "Subscription ID"
    described by "Unique identifier for a subscription record."
  }

  type PaymentHistory is {
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    onTimePayments is Integer with { briefly "On-time" described by "On-time payment count." }
    latePayments is Integer with { briefly "Late" described by "Late payment count." }
    failedPayments is Integer with { briefly "Failed" described by "Failed payment count." }
    averageDaysToPayment is Decimal(5, 2) with { briefly "Avg days" described by "Average days to pay." }
    currentBalance is Decimal(12, 2) with { briefly "Balance" described by "Current balance." }
    lastPaymentDate is optional Date with { briefly "Last payment" described by "Last payment date." }
  } with {
    briefly "Payment history"
    described by "Aggregated payment behavior used for financial health scoring."
  }

  event InvoicePaid is {
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice ID." }
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Payment amount." }
    paidAt is TimeStamp with { briefly "Paid" described by "Payment time." }
    daysAfterDue is Integer with { briefly "Days after due" described by "Days past due." }
  } with {
    briefly "Invoice paid"
    described by "Emitted when a customer pays an invoice."
  }

  event InvoiceOverdue is {
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice ID." }
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    amount is Decimal(12, 2) with { briefly "Amount" described by "Invoice amount." }
    dueDate is Date with { briefly "Due" described by "Due date." }
    daysOverdue is Integer with { briefly "Days overdue" described by "Days overdue." }
    notifiedAt is TimeStamp with { briefly "Notified" described by "Notification time." }
  } with {
    briefly "Invoice overdue"
    described by "Emitted when an invoice passes its due date without payment."
  }

  event SubscriptionChanged is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    changeType is String(1, 50) with { briefly "Type" described by "Change type." }
    previousValue is Decimal(12, 2) with { briefly "Previous" described by "Previous value." }
    newValue is Decimal(12, 2) with { briefly "New" described by "New value." }
    effectiveDate is Date with { briefly "Effective" described by "Effective date." }
    changedAt is TimeStamp with { briefly "Changed" described by "Change time." }
  } with {
    briefly "Subscription changed"
    described by "Emitted when a subscription is upgraded, downgraded, or modified."
  }

  event SubscriptionCancellationRequested is {
    subscriptionId is SubscriptionId with { briefly "Subscription" described by "Subscription ID." }
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    requestedCancellationDate is Date with { briefly "Requested date" described by "Requested cancellation date." }
    cancellationReason is optional String(1, 500) with { briefly "Reason" described by "Cancellation reason." }
    requestedAt is TimeStamp with { briefly "Requested" described by "Request time." }
  } with {
    briefly "Subscription cancellation requested"
    described by "Emitted when a customer initiates a cancellation request."
  }

  event PaymentMethodFailed is {
    accountId is String(1, 50) with { briefly "Account" described by "Account ID." }
    failureReason is String(1, 200) with { briefly "Reason" described by "Failure reason." }
    failedAt is TimeStamp with { briefly "Failed" described by "Failure time." }
    retryScheduled is Boolean with { briefly "Retry" described by "Retry scheduled flag." }
  } with {
    briefly "Payment method failed"
    described by "Emitted when a payment attempt fails due to card decline or similar."
  }

} with {
  option is external
  briefly "Billing service"
  described by {
    | Represents the boundary with billing and subscription management
    | systems like Stripe, Chargebee, or Zuora. Provides payment health
    | signals and subscription change events.
  }
}
