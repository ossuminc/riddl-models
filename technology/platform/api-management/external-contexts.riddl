// API Management - External Contexts
// External systems integrated with the API Management platform

context GatewayService is {
  type GatewayRouteConfig is {
    routeId: String,
    upstreamUrl: URL,
    rateLimitPolicy: RateLimitPolicy,
    authRequired: Boolean,
    corsEnabled: Boolean
  } with {
    briefly "Gateway route configuration"
    described by "Configuration for routing requests through the API gateway."
  }

  event RouteCreated is {
    routeId: String,
    apiId: APIId,
    versionId: VersionId,
    config: GatewayRouteConfig
  } with {
    briefly "Gateway route created"
    described by "Indicates a new route has been configured in the gateway."
  }

  event RouteUpdated is {
    routeId: String,
    config: GatewayRouteConfig
  } with {
    briefly "Gateway route updated"
    described by "Indicates an existing gateway route has been modified."
  }

  event RouteRemoved is {
    routeId: String
  } with {
    briefly "Gateway route removed"
    described by "Indicates a route has been removed from the gateway."
  }

} with {
  option is external
  briefly "API Gateway routing and enforcement"
  described by "External API gateway service that handles request routing,
    rate limiting enforcement, authentication, and traffic management for
    published APIs."
}

context DeveloperPortal is {
  type PortalAPIListing is {
    apiId: APIId,
    name: String,
    description: String,
    currentVersion: VersionId,
    documentation: URL,
    tryItEnabled: Boolean
  } with {
    briefly "API listing for developer portal"
    described by "Information displayed to developers browsing available APIs."
  }

  event APIListingPublished is {
    listing: PortalAPIListing
  } with {
    briefly "API published to portal"
    described by "Indicates an API has been made visible in the developer portal."
  }

  event APIListingUpdated is {
    apiId: APIId,
    listing: PortalAPIListing
  } with {
    briefly "Portal listing updated"
    described by "Indicates an API listing has been updated in the portal."
  }

  event APIListingRemoved is {
    apiId: APIId
  } with {
    briefly "API removed from portal"
    described by "Indicates an API is no longer visible in the developer portal."
  }

  event SubscriptionRequested is {
    apiId: APIId,
    developerId: String,
    requestedPlan: String
  } with {
    briefly "Subscription request received"
    described by "Indicates a developer has requested access to an API."
  }

} with {
  option is external
  briefly "Developer-facing API documentation portal"
  described by "External developer portal that provides API documentation,
    interactive testing, subscription management, and developer onboarding
    for API consumers."
}

context AnalyticsService is {
  type AnalyticsEvent is {
    apiId: APIId,
    versionId: VersionId,
    subscriptionId: SubscriptionId,
    endpoint: String,
    method: String,
    statusCode: Integer,
    latencyMs: Integer,
    timestamp: DateTime
  } with {
    briefly "Individual API call analytics event"
    described by "Detailed record of a single API request for analytics processing."
  }

  type AnalyticsReport is {
    apiId: APIId,
    periodStart: DateTime,
    periodEnd: DateTime,
    totalCalls: Integer,
    uniqueConsumers: Integer,
    errorRate: Real,
    p50LatencyMs: Integer,
    p99LatencyMs: Integer
  } with {
    briefly "Aggregated analytics report"
    described by "Summarized analytics for an API over a reporting period."
  }

  event AnalyticsEventReceived is {
    analyticsEvent: AnalyticsEvent
  } with {
    briefly "Analytics event ingested"
    described by "Indicates an API call event has been recorded for analytics."
  }

  event ReportGenerated is {
    report: AnalyticsReport
  } with {
    briefly "Analytics report generated"
    described by "Indicates an analytics report is available for review."
  }

} with {
  option is external
  briefly "API usage analytics and reporting"
  described by "External analytics service that collects, aggregates, and
    reports on API usage patterns, performance metrics, error rates, and
    consumer behavior across all managed APIs."
}
