// API Management - Shared Types
// Types for API lifecycle, versioning, subscriptions, and rate limiting

type APIId is Id(APIProduct) with {
  briefly "Unique identifier for an API product"
  described by "A system-generated identifier that uniquely identifies an API
    product within the platform."
}

type VersionId is String with {
  briefly "Version identifier for an API"
  described by "A semantic version string (e.g., v1.0.0) that identifies a
    specific version of an API."
}

type SubscriptionId is Id(APIProduct) with {
  briefly "Unique identifier for an API subscription"
  described by "A system-generated identifier that uniquely identifies a
    subscription to an API product."
}

type APIStatus is any of {
  Draft,
  Published,
  Deprecated,
  Retired
} with {
  briefly "Lifecycle status of an API"
  described by "Represents the current lifecycle stage of an API product.
    Draft APIs are in development, Published APIs are available for
    consumption, Deprecated APIs are scheduled for retirement, and
    Retired APIs are no longer available."
}

type RateLimitUnit is any of {
  PerSecond,
  PerMinute,
  PerHour,
  PerDay
} with {
  briefly "Time unit for rate limiting"
  described by "Defines the time window for rate limit calculations."
}

type APIDefinition is {
  name: String,
  description: String,
  basePath: String,
  openApiSpec: String,
  createdAt: DateTime,
  updatedAt: DateTime
} with {
  briefly "Core API definition details"
  described by "Contains the essential metadata for an API including its name,
    description, base path, and OpenAPI specification document."
}

type RateLimitPolicy is {
  requestsPerUnit: Integer,
  unit: RateLimitUnit,
  burstLimit: Integer,
  quotaLimit: Integer,
  quotaPeriodDays: Integer
} with {
  briefly "Rate limiting configuration"
  described by "Defines the rate limiting policy for API access including
    requests per time unit, burst allowance, and quota limits."
}

type SubscriptionInfo is {
  subscriptionId: SubscriptionId,
  subscriberId: String,
  subscriberName: String,
  apiKey: String,
  rateLimit: RateLimitPolicy,
  createdAt: DateTime,
  expiresAt: DateTime?,
  isActive: Boolean
} with {
  briefly "API subscription details"
  described by "Contains information about a subscription to an API product
    including subscriber details, API key, rate limits, and expiration."
}

type VersionInfo is {
  versionId: VersionId,
  status: APIStatus,
  publishedAt: DateTime?,
  deprecatedAt: DateTime?,
  retiredAt: DateTime?,
  changelog: String
} with {
  briefly "API version metadata"
  described by "Tracks the lifecycle of a specific API version including
    status transitions and changelog."
}

type UsageMetrics is {
  totalRequests: Integer,
  successfulRequests: Integer,
  failedRequests: Integer,
  averageLatencyMs: Integer,
  periodStart: DateTime,
  periodEnd: DateTime
} with {
  briefly "API usage statistics"
  described by "Aggregated metrics for API usage over a time period."
}

// State data types for APIProduct entity
type DraftStateData is {
  apiId: APIId,
  definition: APIDefinition,
  defaultRateLimit: RateLimitPolicy
} with {
  briefly "Draft API state data"
  described by "Data structure for an API in draft status."
}

type ActiveStateData is {
  apiId: APIId,
  definition: APIDefinition,
  versions: VersionInfo+,
  subscriptions: SubscriptionInfo*,
  defaultRateLimit: RateLimitPolicy
} with {
  briefly "Active API state data"
  described by "Data structure for an active API with published versions."
}

type DeprecatedStateData is {
  apiId: APIId,
  definition: APIDefinition,
  versions: VersionInfo+,
  subscriptions: SubscriptionInfo*,
  defaultRateLimit: RateLimitPolicy,
  sunsetDate: Date
} with {
  briefly "Deprecated API state data"
  described by "Data structure for a deprecated API with sunset date."
}

type RetiredStateData is {
  apiId: APIId,
  definition: APIDefinition,
  retiredAt: DateTime
} with {
  briefly "Retired API state data"
  described by "Data structure for a retired API."
}
