// External system contexts for Identity Management

context DirectoryService is {

  type DirectoryUser is {
    externalId is String,
    email is EmailAddress,
    displayName is String,
    groups is many String
  } with {
    briefly "User record from external directory"
    described by "Represents a user synchronized from an external directory
      service such as LDAP or Active Directory."
  }

  type DirectoryGroup is {
    groupId is String,
    name is String,
    members is many String
  } with {
    briefly "Group record from external directory"
    described by "Represents a group from an external directory service."
  }

  event UserSynchronized is {
    externalId is String,
    email is EmailAddress,
    displayName is String,
    synchronizedAt is DateTime
  } with {
    briefly "User synchronized from directory"
    described by "Indicates a user record has been synchronized from the
      external directory service."
  }

  event UserRemoved is {
    externalId is String,
    removedAt is DateTime
  } with {
    briefly "User removed from directory"
    described by "Indicates a user has been removed from the external
      directory and should be deactivated."
  }

  event GroupMembershipChanged is {
    externalId is String,
    addedGroups is many String,
    removedGroups is many String,
    changedAt is DateTime
  } with {
    briefly "User group membership changed"
    described by "Indicates a user's group membership has changed in the
      external directory."
  }

} with {
  option is external
  briefly "External directory service integration"
  described by {
    | External bounded context representing integration with enterprise
    | directory services such as LDAP, Active Directory, or cloud identity
    | providers like Azure AD or Okta. Provides user synchronization and
    | group membership information.
  }
}

context MFAProvider is {

  type MFAMethod is any of {
    TOTP,
    SMS,
    Email,
    Push,
    Hardware
  } with {
    briefly "Multi-factor authentication method"
    described by "Enumerates supported MFA methods."
  }

  type MFAChallenge is {
    challengeId is String,
    method is MFAMethod,
    expiresAt is DateTime
  } with {
    briefly "MFA challenge details"
    described by "Represents an active MFA challenge awaiting response."
  }

  type MFAResponse is {
    challengeId is String,
    code is String,
    respondedAt is DateTime
  } with {
    briefly "MFA challenge response"
    described by "Response to an MFA challenge with verification code."
  }

  event MFAChallengeIssued is {
    identityId is String,
    challengeId is String,
    method is MFAMethod,
    issuedAt is DateTime,
    expiresAt is DateTime
  } with {
    briefly "MFA challenge issued"
    described by "Indicates an MFA challenge has been sent to the user."
  }

  event MFAVerificationSucceeded is {
    identityId is String,
    challengeId is String,
    method is MFAMethod,
    verifiedAt is DateTime
  } with {
    briefly "MFA verification succeeded"
    described by "Indicates the user successfully completed MFA verification."
  }

  event MFAVerificationFailed is {
    identityId is String,
    challengeId is String,
    method is MFAMethod,
    failureReason is String,
    attemptedAt is DateTime
  } with {
    briefly "MFA verification failed"
    described by "Indicates the user failed MFA verification."
  }

} with {
  option is external
  briefly "External MFA provider integration"
  described by {
    | External bounded context representing integration with multi-factor
    | authentication providers. Supports various MFA methods including TOTP
    | authenticator apps, SMS, email, push notifications, and hardware tokens.
  }
}

context AuditService is {

  type AuditSeverity is any of {
    Info,
    Warning,
    Critical
  } with {
    briefly "Audit event severity level"
    described by "Indicates the severity of an audit event."
  }

  type AuditEntry is {
    entryId is String,
    timestamp is DateTime,
    actorId is String,
    action is String,
    resource is String,
    outcome is String,
    severity is AuditSeverity,
    ipAddress is String
  } with {
    briefly "Audit log entry"
    described by "Complete audit record for a security-relevant action."
  }

  event AuditEntryRecorded is {
    entryId is String,
    timestamp is DateTime,
    actorId is String,
    action is String,
    resource is String,
    severity is AuditSeverity
  } with {
    briefly "Audit entry was recorded"
    described by "Indicates an audit entry has been successfully recorded."
  }

  event SecurityAlertTriggered is {
    alertId is String,
    timestamp is DateTime,
    actorId is String,
    alertType is String,
    description is String,
    severity is AuditSeverity
  } with {
    briefly "Security alert triggered"
    described by "Indicates a security alert has been triggered based on
      audit patterns or thresholds."
  }

} with {
  option is external
  briefly "External audit service integration"
  described by {
    | External bounded context representing integration with security audit
    | and compliance logging systems. Records all security-relevant events
    | for compliance, forensics, and security monitoring. Supports alerting
    | on suspicious patterns.
  }
}
