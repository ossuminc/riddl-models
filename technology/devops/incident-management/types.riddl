// Types for Incident Management Domain

type IncidentId is Id(Incident) with {
  briefly "Unique identifier for an incident"
  described by {
    | A system-generated unique identifier that tracks an incident
    | throughout its lifecycle from creation to resolution and post-mortem.
  }
}

type AlertId is String(1, 100) with {
  briefly "Identifier from the alerting system"
  described by {
    | The unique identifier assigned by the upstream alerting system
    | (e.g., Prometheus, Datadog, PagerDuty) that triggered this incident.
  }
}

type ServiceId is String(1, 100) with {
  briefly "Identifier for an affected service"
  described by {
    | A unique identifier representing a service or component in the
    | infrastructure that is affected by or related to an incident.
  }
}

type IncidentSeverity is any of {
  Sev1 with {
    briefly "Critical severity"
    described by {
      | Complete service outage or major customer impact. Requires
      | immediate response with all hands on deck.
    }
  },
  Sev2 with {
    briefly "High severity"
    described by {
      | Significant degradation affecting many customers. Requires
      | urgent response within minutes.
    }
  },
  Sev3 with {
    briefly "Medium severity"
    described by {
      | Partial degradation affecting some customers. Requires
      | response within an hour.
    }
  },
  Sev4 with {
    briefly "Low severity"
    described by {
      | Minor issue with minimal customer impact. Can be handled
      | during normal business hours.
    }
  },
  Sev5 with {
    briefly "Informational"
    described by {
      | No immediate impact, tracking only. Used for potential
      | issues or maintenance notifications.
    }
  }
} with {
  briefly "Severity classification for incidents"
  described by {
    | Incident severity levels following industry standards from Sev1
    | (critical) to Sev5 (informational). Determines response urgency,
    | escalation paths, and communication requirements.
  }
}

type IncidentStatus is any of {
  StatusTriggered with {
    briefly "Alert received, incident created"
    described by {
      | Initial state when an alert fires and creates an incident.
      | Waiting for on-call engineer acknowledgment.
    }
  },
  StatusAcknowledged with {
    briefly "On-call engineer has acknowledged"
    described by {
      | An engineer has seen and accepted the incident. Investigation
      | is about to begin or has just started.
    }
  },
  StatusInvestigating with {
    briefly "Active investigation in progress"
    described by {
      | Team is actively investigating the root cause. Gathering data,
      | checking logs, and analyzing metrics.
    }
  },
  StatusIdentified with {
    briefly "Root cause identified"
    described by {
      | The root cause has been determined. Team is preparing or
      | implementing a fix.
    }
  },
  StatusMitigating with {
    briefly "Fix being applied"
    described by {
      | A mitigation or fix is being applied. Service restoration
      | is in progress.
    }
  },
  StatusResolved with {
    briefly "Service restored to normal"
    described by {
      | The incident has been resolved and service is operating
      | normally. Post-mortem analysis pending.
    }
  },
  StatusPostMortemPending with {
    briefly "Awaiting post-mortem analysis"
    described by {
      | Service is restored but the blameless post-mortem has not
      | yet been completed and reviewed.
    }
  },
  StatusClosed with {
    briefly "Post-mortem complete, incident closed"
    described by {
      | The incident lifecycle is complete. Post-mortem has been
      | written, reviewed, and action items assigned.
    }
  }
} with {
  briefly "Current status of an incident"
  described by {
    | Incident lifecycle states from initial trigger through
    | acknowledgment, investigation, mitigation, resolution,
    | and final closure after post-mortem review.
  }
}

type IncidentInfo is {
  incidentId is IncidentId with {
    briefly "Incident identifier"
    described by {
      | Unique identifier for this incident throughout its lifecycle.
    }
  }
  title is String(1, 200) with {
    briefly "Incident title"
    described by {
      | Brief summary of the incident for display in dashboards
      | and notifications. Should be clear and actionable.
    }
  }
  description is String(1, 2000) with {
    briefly "Detailed incident description"
    described by {
      | Full description of what is happening, symptoms observed,
      | and any initial diagnosis. Updated as understanding grows.
    }
  }
  severity is IncidentSeverity with {
    briefly "Current severity level"
    described by {
      | The severity classification determining response urgency
      | and escalation requirements.
    }
  }
  status is IncidentStatus with {
    briefly "Current incident status"
    described by {
      | Current position in the incident lifecycle from triggered
      | through closed.
    }
  }
  affectedServices is many ServiceId with {
    briefly "List of affected services"
    described by {
      | Services or components impacted by this incident. Used for
      | routing, notification, and impact assessment.
    }
  }
  alertIds is many AlertId with {
    briefly "Related alert identifiers"
    described by {
      | Alerts from monitoring systems that are associated with
      | this incident. Multiple alerts may be grouped.
    }
  }
  incidentCommander is String(1, 100) with {
    briefly "Assigned incident commander"
    described by {
      | The person coordinating the incident response. May change
      | during handoffs between shifts.
    }
  }
  createdAt is TimeStamp with {
    briefly "Incident creation time"
    described by {
      | When the incident was first created, usually when the
      | initial alert fired.
    }
  }
  acknowledgedAt is optional TimeStamp with {
    briefly "Acknowledgment timestamp"
    described by {
      | When an engineer first acknowledged the incident. Used to
      | calculate time-to-acknowledge metrics.
    }
  }
  resolvedAt is optional TimeStamp with {
    briefly "Resolution timestamp"
    described by {
      | When the incident was resolved and service restored. Used
      | to calculate time-to-resolve metrics.
    }
  }
  customerImpact is String(1, 1000) with {
    briefly "Customer impact description"
    described by {
      | Description of how customers are affected, including scope,
      | symptoms they experience, and workarounds if available.
    }
  }
  communicationChannel is String(1, 200) with {
    briefly "Coordination channel"
    described by {
      | The Slack channel, video call, or other communication channel
      | where the incident response team is coordinating.
    }
  }
} with {
  briefly "Complete incident information record"
  described by {
    | Comprehensive record containing all relevant information about an
    | incident, including identification, classification, affected systems,
    | responsible parties, and key timestamps for metrics calculation.
  }
}

type TimelineEntry is {
  timestamp is TimeStamp with {
    briefly "When this entry occurred"
    described by {
      | The time when this action or observation was recorded.
    }
  }
  author is String(1, 100) with {
    briefly "Who made this entry"
    described by {
      | The person who performed the action or made the observation.
    }
  }
  action is String(1, 200) with {
    briefly "What action was taken"
    described by {
      | Brief description of the action taken or event observed.
    }
  }
  details is String(1, 2000) with {
    briefly "Additional details"
    described by {
      | Detailed information about the action, including any relevant
      | data, observations, or context.
    }
  }
} with {
  briefly "Entry in the incident timeline"
  described by {
    | A timestamped record of an action or observation made during
    | incident response, forming an audit trail for post-mortem analysis.
  }
}

type PostMortem is {
  incidentId is IncidentId with {
    briefly "Related incident"
    described by {
      | The incident this post-mortem is analyzing.
    }
  }
  summary is String(1, 2000) with {
    briefly "Executive summary"
    described by {
      | High-level overview of the incident, suitable for stakeholders
      | who need a quick understanding of what happened.
    }
  }
  rootCause is String(1, 2000) with {
    briefly "Root cause analysis"
    described by {
      | Detailed analysis of the underlying cause or causes that led
      | to this incident. Should go beyond symptoms to true causes.
    }
  }
  impact is String(1, 2000) with {
    briefly "Impact assessment"
    described by {
      | Quantified impact including duration, customers affected,
      | revenue impact, and SLA implications.
    }
  }
  timeline is many TimelineEntry with {
    briefly "Complete incident timeline"
    described by {
      | Chronological record of all significant events from detection
      | through resolution.
    }
  }
  lessonsLearned is many String with {
    briefly "Key lessons learned"
    described by {
      | Insights gained from this incident that can improve future
      | response or prevent similar incidents.
    }
  }
  actionItems is many String with {
    briefly "Follow-up action items"
    described by {
      | Specific tasks to be completed to address findings, including
      | owners and due dates.
    }
  }
  preventionMeasures is many String with {
    briefly "Prevention measures"
    described by {
      | Changes to be made to prevent this type of incident from
      | recurring, such as monitoring, automation, or architecture.
    }
  }
  createdAt is TimeStamp with {
    briefly "Post-mortem creation time"
    described by {
      | When the post-mortem document was created.
    }
  }
  author is String(1, 100) with {
    briefly "Post-mortem author"
    described by {
      | The person who wrote or led the post-mortem analysis.
    }
  }
} with {
  briefly "Post-incident analysis document"
  described by {
    | A blameless post-mortem document capturing what happened, why it
    | happened, the full impact, lessons learned, and action items to
    | prevent recurrence. Essential for continuous improvement of
    | incident response and system reliability.
  }
}

type IncidentMetrics is {
  incidentId is IncidentId with {
    briefly "Incident reference"
    described by {
      | The incident these metrics were calculated from.
    }
  }
  timeToAcknowledge is Duration with {
    briefly "Time to acknowledge (TTA)"
    described by {
      | Duration from incident creation to first acknowledgment.
      | Key metric for on-call responsiveness.
    }
  }
  timeToMitigate is Duration with {
    briefly "Time to mitigate (TTM)"
    described by {
      | Duration from incident creation to when mitigation began.
      | Indicates investigation efficiency.
    }
  }
  timeToResolve is Duration with {
    briefly "Time to resolve (TTR)"
    described by {
      | Duration from incident creation to resolution. The primary
      | metric for overall incident response effectiveness.
    }
  }
  severity is IncidentSeverity with {
    briefly "Incident severity"
    described by {
      | Severity level for segmenting metrics by impact level.
    }
  }
  affectedServiceCount is Natural with {
    briefly "Number of services affected"
    described by {
      | Count of distinct services impacted by this incident.
    }
  }
} with {
  briefly "Calculated metrics for an incident"
  described by {
    | Key performance indicators calculated from incident timestamps
    | including MTTA (Mean Time To Acknowledge), MTTM (Mean Time To Mitigate),
    | and MTTR (Mean Time To Resolve).
  }
}
