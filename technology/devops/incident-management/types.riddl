// Types for Incident Management Domain
type IncidentId is Id(Incident)  with {
  briefly "Unique identifier for an incident"
  described as {
    | A system-generated unique identifier that tracks an incident
    | throughout its lifecycle from creation to resolution and post-mortem.
  }
}
type AlertId is String(1,100) with {
  briefly "Identifier from the alerting system"
  described as {
    | The unique identifier assigned by the upstream alerting system
    | (e.g., Prometheus, Datadog, PagerDuty) that triggered this incident.
  }
}
type ServiceId is String(1,100) with {
  briefly "Identifier for an affected service"
  described as {
    | A unique identifier representing a service or component in the
    | infrastructure that is affected by or related to an incident.
  }
}
type IncidentSeverity is any of {
  Sev1,
  Sev2,
  Sev3,
  Sev4,
  Sev5
} with {
  briefly "Severity classification for incidents"
  described as {
    | Incident severity levels following industry standards from Sev1
    | (critical) to Sev5 (informational). Determines response urgency,
    | escalation paths, and communication requirements.
  }
}
type IncidentStatus is any of {
  StatusTriggered,
  StatusAcknowledged,
  StatusInvestigating,
  StatusIdentified,
  StatusMitigating,
  StatusResolved,
  StatusPostMortemPending,
  StatusClosed
} with {
  briefly "Current status of an incident"
  described as {
    | Incident lifecycle states from initial trigger through
    | acknowledgment, investigation, mitigation, resolution,
    | and final closure after post-mortem review.
  }
}
type IncidentInfo is {
  incidentId: IncidentId with {
    briefly "Incident identifier"
    described as {
      | Unique identifier for this incident throughout its lifecycle.
    }
  }
  title: String(1,200) with {
    briefly "Incident title"
    described as {
      | Brief summary of the incident for display in dashboards
      | and notifications. Should be clear and actionable.
    }
  }
  description: String(1,2000) with {
    briefly "Detailed incident description"
    described as {
      | Full description of what is happening, symptoms observed,
      | and any initial diagnosis. Updated as understanding grows.
    }
  }
  severity: IncidentSeverity with {
    briefly "Current severity level"
    described as {
      | The severity classification determining response urgency
      | and escalation requirements.
    }
  }
  status: IncidentStatus with {
    briefly "Current incident status"
    described as {
      | Current position in the incident lifecycle from triggered
      | through closed.
    }
  }
  affectedServices: ServiceId+ with {
    briefly "List of affected services"
    described as {
      | Services or components impacted by this incident. Used for
      | routing, notification, and impact assessment.
    }
  }
  alertIds: AlertId+ with {
    briefly "Related alert identifiers"
    described as {
      | Alerts from monitoring systems that are associated with
      | this incident. Multiple alerts may be grouped.
    }
  }
  incidentCommander: String(1,100) with {
    briefly "Assigned incident commander"
    described as {
      | The person coordinating the incident response. May change
      | during handoffs between shifts.
    }
  }
  createdAt: TimeStamp with {
    briefly "Incident creation time"
    described as {
      | When the incident was first created, usually when the
      | initial alert fired.
    }
  }
  updatedAcknowledgedAt: TimeStamp? with {
    briefly "Acknowledgment timestamp"
    described as {
      | When an engineer first acknowledged the incident. Used to
      | calculate time-to-acknowledge metrics.
    }
  }
  updatedResolvedAt: TimeStamp? with {
    briefly "Resolution timestamp"
    described as {
      | When the incident was resolved and service restored. Used
      | to calculate time-to-resolve metrics.
    }
  }
  customerImpact: String(1,1000) with {
    briefly "Customer impact description"
    described as {
      | Description of how customers are affected, including scope,
      | symptoms they experience, and workarounds if available.
    }
  }
  communicationChannel: String(1,200) with {
    briefly "Coordination channel"
    described as {
      | The Slack channel, video call, or other communication channel
      | where the incident response team is coordinating.
    }
  }
} with {
  briefly "Complete incident information record"
  described as {
    | Comprehensive record containing all relevant information about an
    | incident, including identification, classification, affected systems,
    | responsible parties, and key timestamps for metrics calculation.
  }
}
type TimelineEntry is {
  timestamp: TimeStamp with {
    briefly "When this entry occurred"
    described as {
      | The time when this action or observation was recorded.
    }
  }
  author: String(1,100) with {
    briefly "Who made this entry"
    described as {
      | The person who performed the action or made the observation.
    }
  }
  action: String(1,200) with {
    briefly "What action was taken"
    described as {
      | Brief description of the action taken or event observed.
    }
  }
  details: String(1,2000) with {
    briefly "Additional details"
    described as {
      | Detailed information about the action, including any relevant
      | data, observations, or context.
    }
  }
} with {
  briefly "Entry in the incident timeline"
  described as {
    | A timestamped record of an action or observation made during
    | incident response, forming an audit trail for post-mortem analysis.
  }
}
type PostMortem is {
  incidentId: IncidentId with {
    briefly "Related incident"
    described as {
      | The incident this post-mortem is analyzing.
    }
  }
  summary: String(1,2000) with {
    briefly "Executive summary"
    described as {
      | High-level overview of the incident, suitable for stakeholders
      | who need a quick understanding of what happened.
    }
  }
  rootCause: String(1,2000) with {
    briefly "Root cause analysis"
    described as {
      | Detailed analysis of the underlying cause or causes that led
      | to this incident. Should go beyond symptoms to true causes.
    }
  }
  impact: String(1,2000) with {
    briefly "Impact assessment"
    described as {
      | Quantified impact including duration, customers affected,
      | revenue impact, and SLA implications.
    }
  }
  timeline: TimelineEntry+ with {
    briefly "Complete incident timeline"
    described as {
      | Chronological record of all significant events from detection
      | through resolution.
    }
  }
  lessonsLearned: String+ with {
    briefly "Key lessons learned"
    described as {
      | Insights gained from this incident that can improve future
      | response or prevent similar incidents.
    }
  }
  actionItems: String+ with {
    briefly "Follow-up action items"
    described as {
      | Specific tasks to be completed to address findings, including
      | owners and due dates.
    }
  }
  preventionMeasures: String+ with {
    briefly "Prevention measures"
    described as {
      | Changes to be made to prevent this type of incident from
      | recurring, such as monitoring, automation, or architecture.
    }
  }
  createdAt: TimeStamp with {
    briefly "Post-mortem creation time"
    described as {
      | When the post-mortem document was created.
    }
  }
  author: String(1,100) with {
    briefly "Post-mortem author"
    described as {
      | The person who wrote or led the post-mortem analysis.
    }
  }
} with {
  briefly "Post-incident analysis document"
  described as {
    | A blameless post-mortem document capturing what happened, why it
    | happened, the full impact, lessons learned, and action items to
    | prevent recurrence. Essential for continuous improvement of
    | incident response and system reliability.
  }
}
type IncidentMetrics is {
  incidentId: IncidentId with {
    briefly "Incident reference"
    described as {
      | The incident these metrics were calculated from.
    }
  }
  timeToAcknowledge: Duration with {
    briefly "Time to acknowledge (TTA)"
    described as {
      | Duration from incident creation to first acknowledgment.
      | Key metric for on-call responsiveness.
    }
  }
  timeToMitigate: Duration with {
    briefly "Time to mitigate (TTM)"
    described as {
      | Duration from incident creation to when mitigation began.
      | Indicates investigation efficiency.
    }
  }
  timeToResolve: Duration with {
    briefly "Time to resolve (TTR)"
    described as {
      | Duration from incident creation to resolution. The primary
      | metric for overall incident response effectiveness.
    }
  }
  severity: IncidentSeverity with {
    briefly "Incident severity"
    described as {
      | Severity level for segmenting metrics by impact level.
    }
  }
  affectedServiceCount: Natural with {
    briefly "Number of services affected"
    described as {
      | Count of distinct services impacted by this incident.
    }
  }
} with {
  briefly "Calculated metrics for an incident"
  described as {
    | Key performance indicators calculated from incident timestamps
    | including MTTA (Mean Time To Acknowledge), MTTM (Mean Time To Mitigate),
    | and MTTR (Mean Time To Resolve).
  }
}
