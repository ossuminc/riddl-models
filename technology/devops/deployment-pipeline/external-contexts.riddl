// External Contexts - External systems integrated with Deployment Pipeline

context ArtifactRegistry is {

  type ArtifactMetadata is {
    artifactId is ArtifactId with { briefly "Artifact ID" described by "Artifact identifier." }
    name is String(1, 100) with { briefly "Name" described by "Artifact name." }
    version is String(1, 50) with { briefly "Version" described by "Artifact version." }
    buildNumber is String(1, 50) with { briefly "Build number" described by "CI build number." }
    commitHash is String(1, 50) with { briefly "Commit hash" described by "Source commit hash." }
    createdAt is TimeStamp with { briefly "Created at" described by "When artifact was created." }
    sizeBytes is Integer with { briefly "Size" described by "Artifact size in bytes." }
    checksumSha256 is String(1, 100) with { briefly "Checksum" described by "SHA256 checksum." }
  } with {
    briefly "Metadata about a deployable artifact"
    described by {
      | Contains information about a deployable artifact including
      | version, build provenance, and integrity checksum.
    }
  }

  command FetchArtifact is {
    artifactId is ArtifactId with {
      briefly "Artifact identifier"
      described by "The artifact to fetch."
    }
  } with {
    briefly "Requests retrieval of an artifact"
    described by "Initiates download of a specific artifact for deployment."
  }

  command ValidateArtifact is {
    artifactId is ArtifactId with {
      briefly "Artifact identifier"
      described by "The artifact to validate."
    }
    expectedChecksum is String(1, 100) with {
      briefly "Expected checksum"
      described by "The expected SHA256 checksum."
    }
  } with {
    briefly "Validates artifact integrity"
    described by "Verifies an artifact's checksum matches the expected value."
  }

  event ArtifactFetched is {
    artifactId is ArtifactId with {
      briefly "Artifact identifier"
      described by "The fetched artifact."
    }
    metadata is ArtifactMetadata with {
      briefly "Metadata"
      described by "Artifact metadata."
    }
    fetchedAt is TimeStamp with {
      briefly "Fetched at"
      described by "When the artifact was fetched."
    }
  } with {
    briefly "An artifact has been fetched"
    described by "Indicates successful retrieval of an artifact from the registry."
  }

  event ArtifactValidated is {
    artifactId is ArtifactId with {
      briefly "Artifact identifier"
      described by "The validated artifact."
    }
    isValid is Boolean with {
      briefly "Is valid"
      described by "Whether validation passed."
    }
    validatedAt is TimeStamp with {
      briefly "Validated at"
      described by "When validation completed."
    }
  } with {
    briefly "An artifact has been validated"
    described by "Indicates the result of artifact integrity validation."
  }

} with {
  option is external
  briefly "External artifact storage and retrieval system"
  described by {
    | The ArtifactRegistry is an external system that stores deployable
    | artifacts such as container images, packages, or binaries. It provides
    | artifact retrieval and integrity validation capabilities.
  }
}

context InfrastructureService is {

  type DeploymentTarget is {
    clusterId is String(1, 100) with { briefly "Cluster ID" described by "Target cluster." }
    namespace is String(1, 100) with { briefly "Namespace" described by "Kubernetes namespace." }
    replicas is Integer with { briefly "Replicas" described by "Number of replicas." }
    cpuCores is Decimal(5, 2) with { briefly "CPU cores" described by "CPU allocation." }
    memoryMb is Integer with { briefly "Memory MB" described by "Memory allocation." }
  } with {
    briefly "Target infrastructure for deployment"
    described by {
      | Specifies the infrastructure target including cluster, namespace,
      | and resource allocation for the deployment.
    }
  }

  command DeployToInfrastructure is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The deployment being executed."
    }
    artifactId is ArtifactId with {
      briefly "Artifact identifier"
      described by "The artifact to deploy."
    }
    target is DeploymentTarget with {
      briefly "Target"
      described by "Infrastructure target configuration."
    }
    strategy is DeploymentStrategy with {
      briefly "Strategy"
      described by "Deployment execution strategy."
    }
  } with {
    briefly "Deploys an artifact to infrastructure"
    described by {
      | Initiates deployment of an artifact to the specified infrastructure
      | target using the given deployment strategy.
    }
  }

  command ScaleDeployment is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The deployment to scale."
    }
    replicas is Integer with {
      briefly "Replicas"
      described by "Target number of replicas."
    }
  } with {
    briefly "Scales a deployment to specified replicas"
    described by "Adjusts the number of running instances for a deployment."
  }

  command TerminateDeployment is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The deployment to terminate."
    }
  } with {
    briefly "Terminates a running deployment"
    described by "Shuts down all instances of a deployment on the infrastructure."
  }

  event InfrastructureDeploymentStarted is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The deployment that started."
    }
    target is DeploymentTarget with {
      briefly "Target"
      described by "Infrastructure target."
    }
    startedAt is TimeStamp with {
      briefly "Started at"
      described by "When deployment started."
    }
  } with {
    briefly "Infrastructure deployment has started"
    described by "Indicates the infrastructure has begun processing the deployment."
  }

  event InfrastructureDeploymentCompleted is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The completed deployment."
    }
    instanceCount is Integer with {
      briefly "Instance count"
      described by "Number of running instances."
    }
    completedAt is TimeStamp with {
      briefly "Completed at"
      described by "When deployment completed."
    }
  } with {
    briefly "Infrastructure deployment has completed"
    described by "Indicates all instances are running on the infrastructure."
  }

  event InfrastructureDeploymentFailed is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The failed deployment."
    }
    errorCode is String(1, 50) with {
      briefly "Error code"
      described by "Infrastructure error code."
    }
    errorMessage is String(1, 500) with {
      briefly "Error message"
      described by "Description of the failure."
    }
    failedAt is TimeStamp with {
      briefly "Failed at"
      described by "When the failure occurred."
    }
  } with {
    briefly "Infrastructure deployment has failed"
    described by "Indicates the infrastructure was unable to complete the deployment."
  }

} with {
  option is external
  briefly "External infrastructure orchestration service"
  described by {
    | The InfrastructureService is an external system responsible for
    | container orchestration and infrastructure management. It handles
    | the actual deployment of artifacts to compute clusters.
  }
}

context MonitoringService is {

  type HealthStatus is any of {
    Healthy with {
      briefly "Healthy"
      described by "Service is functioning normally."
    },
    Degraded with {
      briefly "Degraded"
      described by "Service is functioning with reduced capacity."
    },
    Unhealthy with {
      briefly "Unhealthy"
      described by "Service is not functioning correctly."
    },
    Unknown with {
      briefly "Unknown"
      described by "Health status could not be determined."
    }
  } with {
    briefly "Health status of a deployed service"
    described by "Indicates the current health state of a deployed application."
  }

  type AlertSeverity is any of {
    Critical with {
      briefly "Critical"
      described by "Immediate action required."
    },
    Warning with {
      briefly "Warning"
      described by "Attention needed soon."
    },
    Info with {
      briefly "Info"
      described by "Informational alert."
    }
  } with {
    briefly "Severity level for monitoring alerts"
    described by "Categorizes alert urgency for operational response."
  }

  type ServiceHealth is {
    deploymentId is DeploymentId with { briefly "Deployment ID" described by "Deployment identifier." }
    healthStatus is HealthStatus with { briefly "Status" described by "Current health status." }
    uptimePercentage is Decimal(5, 2) with { briefly "Uptime" described by "Uptime percentage." }
    errorRate is Decimal(5, 2) with { briefly "Error rate" described by "Error rate percentage." }
    averageLatencyMs is Integer with { briefly "Latency" described by "Average latency in ms." }
    checkedAt is TimeStamp with { briefly "Checked at" described by "When health was checked." }
  } with {
    briefly "Health metrics for a deployed service"
    described by {
      | Contains health metrics including uptime, error rate, and latency
      | for a deployed service.
    }
  }

  type AlertThresholds is {
    errorRateThreshold is Decimal(5, 2) with { briefly "Error rate" described by "Error rate threshold." }
    latencyThresholdMs is Integer with { briefly "Latency" described by "Latency threshold in ms." }
    uptimeThreshold is Decimal(5, 2) with { briefly "Uptime" described by "Minimum uptime percentage." }
  } with {
    briefly "Thresholds for triggering alerts"
    described by "Defines the thresholds at which monitoring alerts are triggered."
  }

  command CheckServiceHealth is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The deployment to check."
    }
    healthCheckUrl is URL with {
      briefly "Health check URL"
      described by "Endpoint to check."
    }
  } with {
    briefly "Requests a health check for a service"
    described by "Initiates a health check against the specified endpoint."
  }

  command ConfigureAlerts is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The deployment to monitor."
    }
    alertThresholds is AlertThresholds with {
      briefly "Alert thresholds"
      described by "Thresholds for triggering alerts."
    }
  } with {
    briefly "Configures alerting thresholds"
    described by "Sets up monitoring alerts for a deployed service."
  }

  event HealthCheckCompleted is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The checked deployment."
    }
    health is ServiceHealth with {
      briefly "Health"
      described by "Health check results."
    }
  } with {
    briefly "Health check has completed"
    described by "Reports the results of a service health check."
  }

  event AlertTriggered is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The affected deployment."
    }
    severity is AlertSeverity with {
      briefly "Severity"
      described by "Alert severity level."
    }
    message is String(1, 500) with {
      briefly "Message"
      described by "Alert description."
    }
    triggeredAt is TimeStamp with {
      briefly "Triggered at"
      described by "When the alert was triggered."
    }
  } with {
    briefly "A monitoring alert has been triggered"
    described by "Indicates a monitoring threshold has been exceeded."
  }

  event ServiceRecovered is {
    deploymentId is DeploymentId with {
      briefly "Deployment identifier"
      described by "The recovered deployment."
    }
    recoveredAt is TimeStamp with {
      briefly "Recovered at"
      described by "When recovery was detected."
    }
  } with {
    briefly "A service has recovered from degraded state"
    described by "Indicates a previously unhealthy service is now healthy."
  }

} with {
  option is external
  briefly "External monitoring and observability service"
  described by {
    | The MonitoringService is an external system that provides health
    | monitoring, metrics collection, and alerting for deployed services.
    | It supports post-deployment verification and ongoing monitoring.
  }
}
