// Infrastructure as Code - Shared Types

type StackId is Id(StackContext.Stack) with {
  briefly "Stack identifier"
  described by "Unique identifier for an infrastructure stack."
}

type ResourceId is UUID with {
  briefly "Resource identifier"
  described by "Reference to a cloud resource."
}

type ModuleId is UUID with {
  briefly "Module identifier"
  described by "Reference to an IaC module."
}

type WorkspaceId is UUID with {
  briefly "Workspace identifier"
  described by "Reference to a workspace."
}

type RunId is UUID with {
  briefly "Run identifier"
  described by "Reference to an execution run."
}

type StackStatus is any of {
  Pending,
  Planning,
  Applying,
  Stable,
  Drifted,
  Failed,
  Destroying
} with {
  briefly "Stack status"
  described by "Current stack status."
}

type ResourceStatus is any of {
  Pending,
  Created,
  Updated,
  Unchanged,
  Destroyed,
  Drifted,
  Failed
} with {
  briefly "Resource status"
  described by "Current resource status."
}

type ChangeAction is any of {
  Create,
  Update,
  Replace,
  Destroy,
  NoOp
} with {
  briefly "Change action"
  described by "Type of change to apply."
}

type ProviderType is any of {
  AWS,
  Azure,
  GCP,
  Kubernetes,
  Custom
} with {
  briefly "Provider type"
  described by "Cloud provider type."
}

type WorkspaceInfo is {
  workspaceId is WorkspaceId with {
    briefly "Workspace"
    described by "Workspace identifier."
  }
  name is String(1, 100) with {
    briefly "Name"
    described by "Workspace name."
  }
  environment is String(1, 50) with {
    briefly "Environment"
    described by "Target environment."
  }
  region is String(1, 50) with {
    briefly "Region"
    described by "Cloud region."
  }
} with {
  briefly "Workspace info"
  described by "Workspace configuration."
}

type StackConfiguration is {
  name is String(1, 100) with {
    briefly "Name"
    described by "Stack name."
  }
  provider is ProviderType with {
    briefly "Provider"
    described by "Cloud provider."
  }
  sourceUrl is URL with {
    briefly "Source"
    described by "IaC source repository."
  }
  version is String(1, 50) with {
    briefly "Version"
    described by "IaC version."
  }
  variables is many optional String(1, 1000) with {
    briefly "Variables"
    described by "Input variables."
  }
  backend is String(1, 500) with {
    briefly "Backend"
    described by "State backend configuration."
  }
} with {
  briefly "Stack configuration"
  described by "Infrastructure stack configuration."
}

type ResourceSpec is {
  resourceId is ResourceId with {
    briefly "Resource"
    described by "Resource identifier."
  }
  resourceType is String(1, 100) with {
    briefly "Type"
    described by "Resource type."
  }
  name is String(1, 200) with {
    briefly "Name"
    described by "Resource name."
  }
  provider is ProviderType with {
    briefly "Provider"
    described by "Cloud provider."
  }
  properties is many String(1, 2000) with {
    briefly "Properties"
    described by "Resource properties."
  }
  dependsOn is many optional ResourceId with {
    briefly "Dependencies"
    described by "Resource dependencies."
  }
} with {
  briefly "Resource spec"
  described by "Resource specification."
}

type ResourceState is {
  resourceId is ResourceId with {
    briefly "Resource"
    described by "Resource identifier."
  }
  resourceType is String(1, 100) with {
    briefly "Type"
    described by "Resource type."
  }
  name is String(1, 200) with {
    briefly "Name"
    described by "Resource name."
  }
  status is ResourceStatus with {
    briefly "Status"
    described by "Resource status."
  }
  physicalId is optional String(1, 500) with {
    briefly "Physical ID"
    described by "Cloud resource ID."
  }
  properties is many String(1, 2000) with {
    briefly "Properties"
    described by "Current properties."
  }
  lastUpdated is TimeStamp with {
    briefly "Updated"
    described by "Last update time."
  }
} with {
  briefly "Resource state"
  described by "Current resource state."
}

type PlannedChange is {
  resourceId is ResourceId with {
    briefly "Resource"
    described by "Resource identifier."
  }
  resourceType is String(1, 100) with {
    briefly "Type"
    described by "Resource type."
  }
  name is String(1, 200) with {
    briefly "Name"
    described by "Resource name."
  }
  action is ChangeAction with {
    briefly "Action"
    described by "Planned action."
  }
  beforeProperties is many optional String(1, 2000) with {
    briefly "Before"
    described by "Properties before change."
  }
  afterProperties is many optional String(1, 2000) with {
    briefly "After"
    described by "Properties after change."
  }
} with {
  briefly "Planned change"
  described by "Planned infrastructure change."
}

type ExecutionPlan is {
  runId is RunId with {
    briefly "Run"
    described by "Run identifier."
  }
  changes is many PlannedChange with {
    briefly "Changes"
    described by "Planned changes."
  }
  createCount is Natural with {
    briefly "Creates"
    described by "Resources to create."
  }
  updateCount is Natural with {
    briefly "Updates"
    described by "Resources to update."
  }
  destroyCount is Natural with {
    briefly "Destroys"
    described by "Resources to destroy."
  }
  plannedAt is TimeStamp with {
    briefly "Planned"
    described by "Plan generation time."
  }
} with {
  briefly "Execution plan"
  described by "Infrastructure change plan."
}

type DriftReport is {
  detectedAt is TimeStamp with {
    briefly "Detected"
    described by "Detection time."
  }
  driftedResources is many ResourceState with {
    briefly "Drifted"
    described by "Resources with drift."
  }
  driftCount is Natural with {
    briefly "Count"
    described by "Number of drifted resources."
  }
} with {
  briefly "Drift report"
  described by "Infrastructure drift detection report."
}

type ApplyResult is {
  runId is RunId with {
    briefly "Run"
    described by "Run identifier."
  }
  status is StackStatus with {
    briefly "Status"
    described by "Final status."
  }
  resourcesCreated is Natural with {
    briefly "Created"
    described by "Resources created."
  }
  resourcesUpdated is Natural with {
    briefly "Updated"
    described by "Resources updated."
  }
  resourcesDestroyed is Natural with {
    briefly "Destroyed"
    described by "Resources destroyed."
  }
  errorMessage is optional String(1, 2000) with {
    briefly "Error"
    described by "Error message if failed."
  }
  completedAt is TimeStamp with {
    briefly "Completed"
    described by "Completion time."
  }
} with {
  briefly "Apply result"
  described by "Infrastructure apply result."
}
