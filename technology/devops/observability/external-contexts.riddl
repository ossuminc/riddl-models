// Observability - External Contexts
// Metrics Collection Service
context MetricsCollectionService is {
  command IngestMetrics is  {
    dataPoints: MetricDataPoint+ with {
      briefly "Data points"
      described as {
        |Metric data points.
      }
    }
  } with {
    briefly "Ingest metrics"
    described as {
      |Ingests metric data points.
    }
  }
  event MetricsIngested is  {
    count: Natural with {
      briefly "Count"
      described as {
        |Points ingested.
      }
    }
    ingestedAt: TimeStamp with {
      briefly "Ingested"
      described as {
        |Ingestion time.
      }
    }
  } with {
    briefly "Metrics ingested"
    described as {
      |Emitted when metrics are stored.
    }
  }
  query QueryMetrics is  {
    expression: String(1,2000) with {
      briefly "Expression"
      described as {
        |PromQL query.
      }
    }
    startTime: TimeStamp with {
      briefly "Start"
      described as {
        |Query start time.
      }
    }
    endTime: TimeStamp with {
      briefly "End"
      described as {
        |Query end time.
      }
    }
    step: Natural with {
      briefly "Step"
      described as {
        |Query step (seconds).
      }
    }
  } with {
    briefly "Query metrics"
    described as {
      |Queries metric data.
    }
  }
  result MetricQueryResult is  {
    dataPoints: MetricDataPoint+ with {
      briefly "Data points"
      described as {
        |Query results.
      }
    }
    executionTime: Natural with {
      briefly "Execution time"
      described as {
        |Query time (ms).
      }
    }
  } with {
    briefly "Metric query result"
    described as {
      |Metric query results.
    }
  }
} with {
  option external()
  briefly "External metrics collection"
  described as {
    |External metrics service (Prometheus, DataDog).
  }
}
// Log Aggregation Service
context LogAggregationService is {
  command IngestLogs is  {
    entries: LogEntry+ with {
      briefly "Entries"
      described as {
        |Log entries.
      }
    }
  } with {
    briefly "Ingest logs"
    described as {
      |Ingests log entries.
    }
  }
  event LogsIngested is  {
    count: Natural with {
      briefly "Count"
      described as {
        |Entries ingested.
      }
    }
    ingestedAt: TimeStamp with {
      briefly "Ingested"
      described as {
        |Ingestion time.
      }
    }
  } with {
    briefly "Logs ingested"
    described as {
      |Emitted when logs are stored.
    }
  }
  query SearchLogs is  {
    query: String(1,2000) with {
      briefly "Query"
      described as {
        |Search query.
      }
    }
    startTime: TimeStamp with {
      briefly "Start"
      described as {
        |Search start time.
      }
    }
    endTime: TimeStamp with {
      briefly "End"
      described as {
        |Search end time.
      }
    }
    limit: Natural with {
      briefly "Limit"
      described as {
        |Result limit.
      }
    }
  } with {
    briefly "Search logs"
    described as {
      |Searches log entries.
    }
  }
  result LogSearchResult is  {
    entries: LogEntry+ with {
      briefly "Entries"
      described as {
        |Matching entries.
      }
    }
    totalHits: Natural with {
      briefly "Total"
      described as {
        |Total matches.
      }
    }
  } with {
    briefly "Log search result"
    described as {
      |Log search results.
    }
  }
} with {
  option external()
  briefly "External log aggregation"
  described as {
    |External logging service (Elasticsearch, Loki).
  }
}
// Distributed Tracing Service
context DistributedTracingService is {
  command IngestSpans is  {
    spans: TraceSpan+ with {
      briefly "Spans"
      described as {
        |Trace spans.
      }
    }
  } with {
    briefly "Ingest spans"
    described as {
      |Ingests trace spans.
    }
  }
  event SpansIngested is  {
    count: Natural with {
      briefly "Count"
      described as {
        |Spans ingested.
      }
    }
    ingestedAt: TimeStamp with {
      briefly "Ingested"
      described as {
        |Ingestion time.
      }
    }
  } with {
    briefly "Spans ingested"
    described as {
      |Emitted when spans are stored.
    }
  }
  query GetTrace is  {
    traceId: TraceId with {
      briefly "Trace"
      described as {
        |Trace identifier.
      }
    }
  } with {
    briefly "Get trace"
    described as {
      |Retrieves complete trace.
    }
  }
  result TraceData is  {
    traceId: TraceId with {
      briefly "Trace"
      described as {
        |Trace identifier.
      }
    }
    spans: TraceSpan+ with {
      briefly "Spans"
      described as {
        |All trace spans.
      }
    }
    duration: Natural with {
      briefly "Duration"
      described as {
        |Total duration (us).
      }
    }
    services: String(1,100)+ with {
      briefly "Services"
      described as {
        |Services involved.
      }
    }
  } with {
    briefly "Trace data"
    described as {
      |Complete distributed trace.
    }
  }
  query SearchTraces is  {
    filterService: String(1,100)? with {
      briefly "Service"
      described as {
        |Filter by service.
      }
    }
    operation: String(1,200)? with {
      briefly "Operation"
      described as {
        |Filter by operation.
      }
    }
    minDuration: Natural? with {
      briefly "Min duration"
      described as {
        |Minimum duration (us).
      }
    }
    startTime: TimeStamp with {
      briefly "Start"
      described as {
        |Search start time.
      }
    }
    endTime: TimeStamp with {
      briefly "End"
      described as {
        |Search end time.
      }
    }
    limit: Natural with {
      briefly "Limit"
      described as {
        |Result limit.
      }
    }
  } with {
    briefly "Search traces"
    described as {
      |Searches for traces.
    }
  }
  result TraceSearchResult is  {
    traces: TraceData+ with {
      briefly "Traces"
      described as {
        |Matching traces.
      }
    }
    totalCount: Natural with {
      briefly "Total"
      described as {
        |Total matches.
      }
    }
  } with {
    briefly "Trace search result"
    described as {
      |Trace search results.
    }
  }
} with {
  option external()
  briefly "External distributed tracing"
  described as {
    |External tracing service (Jaeger, Tempo).
  }
}
// Notification Service
context NotificationService is {
  command SendAlertNotification is  {
    alert: AlertInfo with {
      briefly "Alert"
      described as {
        |Alert information.
      }
    }
    channels: NotificationChannel+ with {
      briefly "Channels"
      described as {
        |Notification channels.
      }
    }
  } with {
    briefly "Send alert notification"
    described as {
      |Sends alert to notification channels.
    }
  }
  event NotificationSent is  {
    alertId: AlertId with {
      briefly "Alert"
      described as {
        |Alert ID.
      }
    }
    channelType: String(1,50) with {
      briefly "Channel"
      described as {
        |Channel type.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification sent"
    described as {
      |Emitted when notification is delivered.
    }
  }
  event NotificationFailed is  {
    alertId: AlertId with {
      briefly "Alert"
      described as {
        |Alert ID.
      }
    }
    channelType: String(1,50) with {
      briefly "Channel"
      described as {
        |Channel type.
      }
    }
    error: String(1,500) with {
      briefly "Error"
      described as {
        |Error message.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |Failure time.
      }
    }
  } with {
    briefly "Notification failed"
    described as {
      |Emitted when notification fails.
    }
  }
} with {
  option external()
  briefly "External notifications"
  described as {
    |External notification service (PagerDuty, Slack, OpsGenie).
  }
}
// Dashboard Service
context DashboardService is {
  command CreateDashboard is  {
    dashboardId: DashboardId with {
      briefly "Dashboard"
      described as {
        |Dashboard ID.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Dashboard name.
      }
    }
    panels: String(1,5000)+ with {
      briefly "Panels"
      described as {
        |Dashboard panels config.
      }
    }
  } with {
    briefly "Create dashboard"
    described as {
      |Creates a new dashboard.
    }
  }
  event DashboardCreated is  {
    dashboardId: DashboardId with {
      briefly "Dashboard"
      described as {
        |Dashboard ID.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Dashboard name.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Dashboard created"
    described as {
      |Emitted when dashboard is created.
    }
  }
  query GetDashboard is  {
    dashboardId: DashboardId with {
      briefly "Dashboard"
      described as {
        |Dashboard ID.
      }
    }
  } with {
    briefly "Get dashboard"
    described as {
      |Retrieves dashboard configuration.
    }
  }
  result DashboardConfig is  {
    dashboardId: DashboardId with {
      briefly "Dashboard"
      described as {
        |Dashboard ID.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Dashboard name.
      }
    }
    panels: String(1,5000)+ with {
      briefly "Panels"
      described as {
        |Panel configurations.
      }
    }
    lastModified: TimeStamp with {
      briefly "Modified"
      described as {
        |Last modification.
      }
    }
  } with {
    briefly "Dashboard config"
    described as {
      |Dashboard configuration.
    }
  }
} with {
  option external()
  briefly "External dashboards"
  described as {
    |External dashboard service (Grafana).
  }
}
