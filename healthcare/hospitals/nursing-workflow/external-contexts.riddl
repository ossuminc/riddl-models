// External Contexts for Nursing Workflow
// Defines integration points with hospital systems
// ============================================================================
// ADT Service - Admission, Discharge, Transfer
// ============================================================================
context ADTService is {
  type CensusRecord is {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    bedId: String with {
      briefly "Bed"
      described as {
        |Bed identifier.
      }
    }
    admissionDate: Date with {
      briefly "Admission"
      described as {
        |Admission date.
      }
    }
    attendingPhysician: String with {
      briefly "Physician"
      described as {
        |Attending physician.
      }
    }
    diagnosis: String with {
      briefly "Diagnosis"
      described as {
        |Primary diagnosis.
      }
    }
    acuityLevel: Number with {
      briefly "Acuity"
      described as {
        |Patient acuity level.
      }
    }
    isolationStatus: String? with {
      briefly "Isolation"
      described as {
        |Isolation precautions.
      }
    }
  } with {
    briefly "Patient census information"
    described as {
      |Current patient location and status from ADT system.
    }
  }
  type AdmissionNotification is {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    bedId: String with {
      briefly "Bed"
      described as {
        |Bed identifier.
      }
    }
    admissionTime: TimeStamp with {
      briefly "Time"
      described as {
        |Admission time.
      }
    }
    admissionType: String with {
      briefly "Type"
      described as {
        |Admission type.
      }
    }
    diagnosis: String with {
      briefly "Diagnosis"
      described as {
        |Primary diagnosis.
      }
    }
  } with {
    briefly "New patient admission notification"
    described as {
      |Event published when a patient is admitted to a unit.
    }
  }
  type DischargeNotification is {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
    dischargeTime: TimeStamp with {
      briefly "Time"
      described as {
        |Discharge time.
      }
    }
    dischargeDisposition: String with {
      briefly "Disposition"
      described as {
        |Discharge disposition.
      }
    }
  } with {
    briefly "Patient discharge notification"
    described as {
      |Event published when a patient is discharged.
    }
  }
  type TransferNotification is {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    fromUnitId: UnitId with {
      briefly "From"
      described as {
        |Source unit.
      }
    }
    toUnitId: UnitId with {
      briefly "To"
      described as {
        |Destination unit.
      }
    }
    transferTime: TimeStamp with {
      briefly "Time"
      described as {
        |Transfer time.
      }
    }
    transferReason: String with {
      briefly "Reason"
      described as {
        |Transfer reason.
      }
    }
  } with {
    briefly "Patient transfer notification"
    described as {
      |Event published when a patient transfers between units.
    }
  }
  event PatientAdmitted is  {
    admissionNotification: AdmissionNotification with {
      briefly "Data"
      described as {
        |Admission data.
      }
    }
  } with {
    briefly "Patient has been admitted"
    described as {
      |Published by ADT when a new admission occurs.
    }
  }
  event PatientDischarged is  {
    dischargeNotification: DischargeNotification with {
      briefly "Data"
      described as {
        |Discharge data.
      }
    }
  } with {
    briefly "Patient has been discharged"
    described as {
      |Published by ADT when a patient is discharged.
    }
  }
  event PatientTransferred is  {
    transferNotification: TransferNotification with {
      briefly "Data"
      described as {
        |Transfer data.
      }
    }
  } with {
    briefly "Patient has been transferred"
    described as {
      |Published by ADT when a patient moves between units.
    }
  }
  query GetUnitCensus is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
  } with {
    briefly "Query current unit census"
    described as {
      |Returns all patients currently on a nursing unit.
    }
  }
  query GetPatientLocation is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
  } with {
    briefly "Query patient location"
    described as {
      |Returns current unit and bed for a patient.
    }
  }
  result CensusList is  {
    patients: CensusRecord* with {
      briefly "Patients"
      described as {
        |Census records.
      }
    }
  } with {
    briefly "List of census records"
    described as {
      |Contains patient census information.
    }
  }
  result PatientLocationResult is  {
    census: CensusRecord? with {
      briefly "Census"
      described as {
        |Patient census.
      }
    }
  } with {
    briefly "Patient location result"
    described as {
      |Contains location for requested patient.
    }
  }
} with {
  option external()
  briefly "Hospital ADT system providing census and admission data"
  described as {
    | External bounded context representing the hospital's ADT system.
    | Publishes events for admissions, discharges, and transfers.
    | Provides queries for current census and patient locations.
    | Nursing workflow subscribes to maintain accurate patient lists.
  }
}
// ============================================================================
// Order Management - Clinical Orders
// ============================================================================
context OrderManagement is {
  type OrderId is UUID with {
    briefly "Order ID"
    described as {
      |Unique order identifier.
    }
  }
  type NursingOrder is {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    orderType: String with {
      briefly "Type"
      described as {
        |Order type.
      }
    }
    orderText: String with {
      briefly "Text"
      described as {
        |Order text.
      }
    }
    orderedBy: String with {
      briefly "Ordered by"
      described as {
        |Ordering provider.
      }
    }
    orderedAt: TimeStamp with {
      briefly "Ordered at"
      described as {
        |Order timestamp.
      }
    }
    orderPriority: String with {
      briefly "Priority"
      described as {
        |Order priority.
      }
    }
    orderFrequency: String? with {
      briefly "Frequency"
      described as {
        |Order frequency.
      }
    }
    startTime: TimeStamp with {
      briefly "Start"
      described as {
        |Start time.
      }
    }
    stopTime: TimeStamp? with {
      briefly "Stop"
      described as {
        |Stop time.
      }
    }
    orderStatus: String with {
      briefly "Status"
      described as {
        |Order status.
      }
    }
  } with {
    briefly "Clinical order requiring nursing action"
    described as {
      |Order from a provider that generates nursing tasks.
    }
  }
  type OrderStatusUpdate is {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    newStatus: String with {
      briefly "Status"
      described as {
        |New status.
      }
    }
    statusUpdatedBy: String with {
      briefly "Updated by"
      described as {
        |Who updated.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated at"
      described as {
        |Update time.
      }
    }
    notes: String? with {
      briefly "Notes"
      described as {
        |Update notes.
      }
    }
  } with {
    briefly "Update to order status"
    described as {
      |Records status changes as orders are processed.
    }
  }
  event NursingOrderCreated is  {
    order: NursingOrder with {
      briefly "Order"
      described as {
        |New order.
      }
    }
  } with {
    briefly "New nursing order has been created"
    described as {
      |Published when a provider enters an order requiring nursing action.
    }
  }
  event NursingOrderModified is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    modifications: String with {
      briefly "Modifications"
      described as {
        |What changed.
      }
    }
    modifiedBy: String with {
      briefly "Modified by"
      described as {
        |Who modified.
      }
    }
    modifiedAt: TimeStamp with {
      briefly "Modified at"
      described as {
        |Modification time.
      }
    }
  } with {
    briefly "Nursing order has been modified"
    described as {
      |Published when an existing order is changed.
    }
  }
  event NursingOrderDiscontinued is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    discontinuedBy: String with {
      briefly "Discontinued by"
      described as {
        |Who discontinued.
      }
    }
    discontinuedAt: TimeStamp with {
      briefly "Discontinued at"
      described as {
        |Discontinuation time.
      }
    }
    reason: String with {
      briefly "Reason"
      described as {
        |Discontinuation reason.
      }
    }
  } with {
    briefly "Nursing order has been discontinued"
    described as {
      |Published when an order is stopped before completion.
    }
  }
  query GetActiveOrders is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
  } with {
    briefly "Query active orders for patient"
    described as {
      |Returns all active nursing orders for a patient.
    }
  }
  query GetOrdersByUnit is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Unit ID.
      }
    }
  } with {
    briefly "Query orders by unit"
    described as {
      |Returns all active orders for patients on a unit.
    }
  }
  result OrderList is  {
    orders: NursingOrder* with {
      briefly "Orders"
      described as {
        |Order list.
      }
    }
  } with {
    briefly "List of nursing orders"
    described as {
      |Contains nursing order records.
    }
  }
  command AcknowledgeOrder is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    acknowledgedBy: NurseId with {
      briefly "Acknowledged by"
      described as {
        |Acknowledging nurse.
      }
    }
    acknowledgedAt: TimeStamp with {
      briefly "Acknowledged at"
      described as {
        |Acknowledgment time.
      }
    }
  } with {
    briefly "Acknowledge receipt of order"
    described as {
      |Nursing acknowledgment that order has been received.
    }
  }
  command UpdateOrderStatus is  {
    orderId: OrderId with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    newStatus: String with {
      briefly "Status"
      described as {
        |New status.
      }
    }
    nurseUpdatedBy: NurseId with {
      briefly "Updated by"
      described as {
        |Updating nurse.
      }
    }
    notes: String? with {
      briefly "Notes"
      described as {
        |Status notes.
      }
    }
  } with {
    briefly "Update order execution status"
    described as {
      |Records progress on order completion.
    }
  }
} with {
  option external()
  briefly "Clinical order management system for provider orders"
  described as {
    | External bounded context for clinical order management.
    | Publishes nursing-relevant orders for task generation.
    | Accepts acknowledgments and status updates from nursing.
    | Orders automatically generate tasks in the nursing workflow.
  }
}
// ============================================================================
// Medication Administration - MAR Integration
// ============================================================================
context MedicationAdministration is {
  type MedicationOrderId is UUID with {
    briefly "Medication order ID"
    described as {
      |Unique medication order identifier.
    }
  }
  type MedicationRecordId is UUID with {
    briefly "MAR record ID"
    described as {
      |Unique administration record identifier.
    }
  }
  type MedicationOrder is {
    medicationOrderId: MedicationOrderId with {
      briefly "Order"
      described as {
        |Medication order ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    medicationName: String with {
      briefly "Medication"
      described as {
        |Medication name.
      }
    }
    dose: String with {
      briefly "Dose"
      described as {
        |Dose amount.
      }
    }
    route: String with {
      briefly "Route"
      described as {
        |Administration route.
      }
    }
    dosingFrequency: String with {
      briefly "Frequency"
      described as {
        |Dosing frequency.
      }
    }
    scheduledTimes: TimeStamp* with {
      briefly "Times"
      described as {
        |Scheduled times.
      }
    }
    prn: Boolean with {
      briefly "PRN"
      described as {
        |As needed flag.
      }
    }
    prnReason: String? with {
      briefly "PRN reason"
      described as {
        |Reason for PRN.
      }
    }
    specialInstructions: String? with {
      briefly "Instructions"
      described as {
        |Special instructions.
      }
    }
    orderedBy: String with {
      briefly "Ordered by"
      described as {
        |Prescribing provider.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Start date.
      }
    }
    stopDate: Date? with {
      briefly "Stop"
      described as {
        |Stop date.
      }
    }
  } with {
    briefly "Medication order from MAR"
    described as {
      |Active medication order with administration schedule.
    }
  }
  type MedicationAdministrationRecord is {
    marRecordId: MedicationRecordId with {
      briefly "Record"
      described as {
        |MAR record ID.
      }
    }
    medicationOrderId: MedicationOrderId with {
      briefly "Order"
      described as {
        |Medication order ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    scheduledTime: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Scheduled time.
      }
    }
    administeredTime: TimeStamp? with {
      briefly "Administered"
      described as {
        |Actual administration time.
      }
    }
    scheduledAdministerer: NurseId? with {
      briefly "By"
      described as {
        |Scheduled administering nurse.
      }
    }
    dose: String with {
      briefly "Dose"
      described as {
        |Dose given.
      }
    }
    route: String with {
      briefly "Route"
      described as {
        |Administration route.
      }
    }
    site: String? with {
      briefly "Site"
      described as {
        |Administration site.
      }
    }
    administrationStatus: String with {
      briefly "Status"
      described as {
        |Administration status.
      }
    }
    holdReason: String? with {
      briefly "Hold reason"
      described as {
        |Reason if held.
      }
    }
    notes: String? with {
      briefly "Notes"
      described as {
        |Administration notes.
      }
    }
  } with {
    briefly "Individual medication administration event"
    described as {
      |Records each medication administration or exception.
    }
  }
  event MedicationDue is  {
    medicationOrderId: MedicationOrderId with {
      briefly "Order"
      described as {
        |Medication order ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    medicationName: String with {
      briefly "Medication"
      described as {
        |Medication name.
      }
    }
    dose: String with {
      briefly "Dose"
      described as {
        |Dose amount.
      }
    }
    route: String with {
      briefly "Route"
      described as {
        |Route.
      }
    }
    scheduledTime: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Scheduled time.
      }
    }
  } with {
    briefly "Medication is due for administration"
    described as {
      |Published when a scheduled medication time approaches.
    }
  }
  event MedicationAdministered is  {
    marRecordId: MedicationRecordId with {
      briefly "Record"
      described as {
        |MAR record ID.
      }
    }
    medicationOrderId: MedicationOrderId with {
      briefly "Order"
      described as {
        |Medication order ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    administeredBy: NurseId with {
      briefly "By"
      described as {
        |Administering nurse.
      }
    }
    administeredAt: TimeStamp with {
      briefly "At"
      described as {
        |Administration time.
      }
    }
  } with {
    briefly "Medication has been administered"
    described as {
      |Published when nurse documents medication given.
    }
  }
  event MedicationHeld is  {
    marRecordId: MedicationRecordId with {
      briefly "Record"
      described as {
        |MAR record ID.
      }
    }
    medicationOrderId: MedicationOrderId with {
      briefly "Order"
      described as {
        |Medication order ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    heldBy: NurseId with {
      briefly "By"
      described as {
        |Holding nurse.
      }
    }
    heldAt: TimeStamp with {
      briefly "At"
      described as {
        |Hold time.
      }
    }
    reason: String with {
      briefly "Reason"
      described as {
        |Hold reason.
      }
    }
  } with {
    briefly "Medication administration has been held"
    described as {
      |Published when nurse documents medication not given.
    }
  }
  query GetDueMedications is  {
    nurseId: NurseId with {
      briefly "Nurse"
      described as {
        |Nurse ID.
      }
    }
    windowStart: TimeStamp with {
      briefly "Start"
      described as {
        |Window start.
      }
    }
    windowEnd: TimeStamp with {
      briefly "End"
      described as {
        |Window end.
      }
    }
  } with {
    briefly "Query medications due in time window"
    described as {
      |Returns medications due for nurse's assigned patients.
    }
  }
  query GetMedicationHistory is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Start date.
      }
    }
    endDate: Date with {
      briefly "End"
      described as {
        |End date.
      }
    }
  } with {
    briefly "Query medication administration history"
    described as {
      |Returns administration records for a patient.
    }
  }
  result DueMedicationList is  {
    medications: MedicationOrder* with {
      briefly "Medications"
      described as {
        |Due medications.
      }
    }
  } with {
    briefly "List of due medications"
    described as {
      |Contains medications due for administration.
    }
  }
  result AdministrationHistory is  {
    records: MedicationAdministrationRecord* with {
      briefly "Records"
      described as {
        |Administration records.
      }
    }
  } with {
    briefly "Medication administration history"
    described as {
      |Contains historical administration records.
    }
  }
  command DocumentAdministration is  {
    medicationOrderId: MedicationOrderId with {
      briefly "Order"
      described as {
        |Medication order ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    administeredBy: NurseId with {
      briefly "By"
      described as {
        |Administering nurse.
      }
    }
    administeredAt: TimeStamp with {
      briefly "At"
      described as {
        |Administration time.
      }
    }
    dose: String with {
      briefly "Dose"
      described as {
        |Dose given.
      }
    }
    route: String with {
      briefly "Route"
      described as {
        |Administration route.
      }
    }
    site: String? with {
      briefly "Site"
      described as {
        |Administration site.
      }
    }
    notes: String? with {
      briefly "Notes"
      described as {
        |Administration notes.
      }
    }
  } with {
    briefly "Document medication administration"
    described as {
      |Records that medication was given to patient.
    }
  }
  command DocumentHold is  {
    medicationOrderId: MedicationOrderId with {
      briefly "Order"
      described as {
        |Medication order ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    heldBy: NurseId with {
      briefly "By"
      described as {
        |Holding nurse.
      }
    }
    heldAt: TimeStamp with {
      briefly "At"
      described as {
        |Hold time.
      }
    }
    reason: String with {
      briefly "Reason"
      described as {
        |Hold reason.
      }
    }
    notes: String? with {
      briefly "Notes"
      described as {
        |Hold notes.
      }
    }
  } with {
    briefly "Document medication hold"
    described as {
      |Records that medication was not given with reason.
    }
  }
} with {
  option external()
  briefly "Medication administration record system for eMAR integration"
  described as {
    | External bounded context for electronic medication administration.
    | Publishes medication due alerts for nursing workflow.
    | Accepts administration and hold documentation from nursing.
    | Integrates with pharmacy for order verification and alerts.
  }
}
