// External Contexts for Nursing Workflow
// Defines integration points with hospital systems

// ============================================================================
// ADT Service - Admission, Discharge, Transfer
// ============================================================================

context ADTService is {

  type CensusRecord is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    unitId is UnitId with { briefly "Unit" described by "Unit ID." }
    bedId is String with { briefly "Bed" described by "Bed identifier." }
    admissionDate is Date with { briefly "Admission" described by "Admission date." }
    attendingPhysician is String with { briefly "Physician" described by "Attending physician." }
    diagnosis is String with { briefly "Diagnosis" described by "Primary diagnosis." }
    acuityLevel is Number with { briefly "Acuity" described by "Patient acuity level." }
    isolationStatus is optional String with { briefly "Isolation" described by "Isolation precautions." }
  } with {
    briefly "Patient census information"
    described by "Current patient location and status from ADT system."
  }

  type AdmissionNotification is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    unitId is UnitId with { briefly "Unit" described by "Unit ID." }
    bedId is String with { briefly "Bed" described by "Bed identifier." }
    admissionTime is TimeStamp with { briefly "Time" described by "Admission time." }
    admissionType is String with { briefly "Type" described by "Admission type." }
    diagnosis is String with { briefly "Diagnosis" described by "Primary diagnosis." }
  } with {
    briefly "New patient admission notification"
    described by "Event published when a patient is admitted to a unit."
  }

  type DischargeNotification is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    unitId is UnitId with { briefly "Unit" described by "Unit ID." }
    dischargeTime is TimeStamp with { briefly "Time" described by "Discharge time." }
    dischargeDisposition is String with { briefly "Disposition" described by "Discharge disposition." }
  } with {
    briefly "Patient discharge notification"
    described by "Event published when a patient is discharged."
  }

  type TransferNotification is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    fromUnitId is UnitId with { briefly "From" described by "Source unit." }
    toUnitId is UnitId with { briefly "To" described by "Destination unit." }
    transferTime is TimeStamp with { briefly "Time" described by "Transfer time." }
    transferReason is String with { briefly "Reason" described by "Transfer reason." }
  } with {
    briefly "Patient transfer notification"
    described by "Event published when a patient transfers between units."
  }

  event PatientAdmitted is {
    admissionNotification is AdmissionNotification with { briefly "Data" described by "Admission data." }
  } with {
    briefly "Patient has been admitted"
    described by "Published by ADT when a new admission occurs."
  }

  event PatientDischarged is {
    dischargeNotification is DischargeNotification with { briefly "Data" described by "Discharge data." }
  } with {
    briefly "Patient has been discharged"
    described by "Published by ADT when a patient is discharged."
  }

  event PatientTransferred is {
    transferNotification is TransferNotification with { briefly "Data" described by "Transfer data." }
  } with {
    briefly "Patient has been transferred"
    described by "Published by ADT when a patient moves between units."
  }

  query GetUnitCensus is { unitId is UnitId with { briefly "Unit" described by "Unit ID." } } with {
    briefly "Query current unit census"
    described by "Returns all patients currently on a nursing unit."
  }

  query GetPatientLocation is { patientId is PatientId with { briefly "Patient" described by "Patient ID." } } with {
    briefly "Query patient location"
    described by "Returns current unit and bed for a patient."
  }

  result CensusList is {
    patients is many optional CensusRecord with { briefly "Patients" described by "Census records." }
  } with {
    briefly "List of census records"
    described by "Contains patient census information."
  }

  result PatientLocationResult is {
    census is optional CensusRecord with { briefly "Census" described by "Patient census." }
  } with {
    briefly "Patient location result"
    described by "Contains location for requested patient."
  }

} with {
  option is external
  briefly "Hospital ADT system providing census and admission data"
  described by {
    | External bounded context representing the hospital's ADT system.
    | Publishes events for admissions, discharges, and transfers.
    | Provides queries for current census and patient locations.
    | Nursing workflow subscribes to maintain accurate patient lists.
  }
}

// ============================================================================
// Order Management - Clinical Orders
// ============================================================================

context OrderManagement is {

  type OrderId is UUID with {
    briefly "Order ID"
    described by "Unique order identifier."
  }

  type NursingOrder is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    orderType is String with { briefly "Type" described by "Order type." }
    orderText is String with { briefly "Text" described by "Order text." }
    orderedBy is String with { briefly "Ordered by" described by "Ordering provider." }
    orderedAt is TimeStamp with { briefly "Ordered at" described by "Order timestamp." }
    orderPriority is String with { briefly "Priority" described by "Order priority." }
    orderFrequency is optional String with { briefly "Frequency" described by "Order frequency." }
    startTime is TimeStamp with { briefly "Start" described by "Start time." }
    stopTime is optional TimeStamp with { briefly "Stop" described by "Stop time." }
    orderStatus is String with { briefly "Status" described by "Order status." }
  } with {
    briefly "Clinical order requiring nursing action"
    described by "Order from a provider that generates nursing tasks."
  }

  type OrderStatusUpdate is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    newStatus is String with { briefly "Status" described by "New status." }
    statusUpdatedBy is String with { briefly "Updated by" described by "Who updated." }
    updatedAt is TimeStamp with { briefly "Updated at" described by "Update time." }
    notes is optional String with { briefly "Notes" described by "Update notes." }
  } with {
    briefly "Update to order status"
    described by "Records status changes as orders are processed."
  }

  event NursingOrderCreated is {
    order is NursingOrder with { briefly "Order" described by "New order." }
  } with {
    briefly "New nursing order has been created"
    described by "Published when a provider enters an order requiring nursing action."
  }

  event NursingOrderModified is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    modifications is String with { briefly "Modifications" described by "What changed." }
    modifiedBy is String with { briefly "Modified by" described by "Who modified." }
    modifiedAt is TimeStamp with { briefly "Modified at" described by "Modification time." }
  } with {
    briefly "Nursing order has been modified"
    described by "Published when an existing order is changed."
  }

  event NursingOrderDiscontinued is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    discontinuedBy is String with { briefly "Discontinued by" described by "Who discontinued." }
    discontinuedAt is TimeStamp with { briefly "Discontinued at" described by "Discontinuation time." }
    reason is String with { briefly "Reason" described by "Discontinuation reason." }
  } with {
    briefly "Nursing order has been discontinued"
    described by "Published when an order is stopped before completion."
  }

  query GetActiveOrders is { patientId is PatientId with { briefly "Patient" described by "Patient ID." } } with {
    briefly "Query active orders for patient"
    described by "Returns all active nursing orders for a patient."
  }

  query GetOrdersByUnit is { unitId is UnitId with { briefly "Unit" described by "Unit ID." } } with {
    briefly "Query orders by unit"
    described by "Returns all active orders for patients on a unit."
  }

  result OrderList is {
    orders is many optional NursingOrder with { briefly "Orders" described by "Order list." }
  } with {
    briefly "List of nursing orders"
    described by "Contains nursing order records."
  }

  command AcknowledgeOrder is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    acknowledgedBy is NurseId with { briefly "Acknowledged by" described by "Acknowledging nurse." }
    acknowledgedAt is TimeStamp with { briefly "Acknowledged at" described by "Acknowledgment time." }
  } with {
    briefly "Acknowledge receipt of order"
    described by "Nursing acknowledgment that order has been received."
  }

  command UpdateOrderStatus is {
    orderId is OrderId with { briefly "Order" described by "Order ID." }
    newStatus is String with { briefly "Status" described by "New status." }
    nurseUpdatedBy is NurseId with { briefly "Updated by" described by "Updating nurse." }
    notes is optional String with { briefly "Notes" described by "Status notes." }
  } with {
    briefly "Update order execution status"
    described by "Records progress on order completion."
  }

} with {
  option is external
  briefly "Clinical order management system for provider orders"
  described by {
    | External bounded context for clinical order management.
    | Publishes nursing-relevant orders for task generation.
    | Accepts acknowledgments and status updates from nursing.
    | Orders automatically generate tasks in the nursing workflow.
  }
}

// ============================================================================
// Medication Administration - MAR Integration
// ============================================================================

context MedicationAdministration is {

  type MedicationOrderId is UUID with {
    briefly "Medication order ID"
    described by "Unique medication order identifier."
  }

  type MedicationRecordId is UUID with {
    briefly "MAR record ID"
    described by "Unique administration record identifier."
  }

  type MedicationOrder is {
    medicationOrderId is MedicationOrderId with { briefly "Order" described by "Medication order ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    medicationName is String with { briefly "Medication" described by "Medication name." }
    dose is String with { briefly "Dose" described by "Dose amount." }
    route is String with { briefly "Route" described by "Administration route." }
    dosingFrequency is String with { briefly "Frequency" described by "Dosing frequency." }
    scheduledTimes is many optional TimeStamp with { briefly "Times" described by "Scheduled times." }
    prn is Boolean with { briefly "PRN" described by "As needed flag." }
    prnReason is optional String with { briefly "PRN reason" described by "Reason for PRN." }
    specialInstructions is optional String with { briefly "Instructions" described by "Special instructions." }
    orderedBy is String with { briefly "Ordered by" described by "Prescribing provider." }
    startDate is Date with { briefly "Start" described by "Start date." }
    stopDate is optional Date with { briefly "Stop" described by "Stop date." }
  } with {
    briefly "Medication order from MAR"
    described by "Active medication order with administration schedule."
  }

  type MedicationAdministrationRecord is {
    marRecordId is MedicationRecordId with { briefly "Record" described by "MAR record ID." }
    medicationOrderId is MedicationOrderId with { briefly "Order" described by "Medication order ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    scheduledTime is TimeStamp with { briefly "Scheduled" described by "Scheduled time." }
    administeredTime is optional TimeStamp with { briefly "Administered" described by "Actual administration time." }
    scheduledAdministerer is optional NurseId with { briefly "By" described by "Scheduled administering nurse." }
    dose is String with { briefly "Dose" described by "Dose given." }
    route is String with { briefly "Route" described by "Administration route." }
    site is optional String with { briefly "Site" described by "Administration site." }
    administrationStatus is String with { briefly "Status" described by "Administration status." }
    holdReason is optional String with { briefly "Hold reason" described by "Reason if held." }
    notes is optional String with { briefly "Notes" described by "Administration notes." }
  } with {
    briefly "Individual medication administration event"
    described by "Records each medication administration or exception."
  }

  event MedicationDue is {
    medicationOrderId is MedicationOrderId with { briefly "Order" described by "Medication order ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    medicationName is String with { briefly "Medication" described by "Medication name." }
    dose is String with { briefly "Dose" described by "Dose amount." }
    route is String with { briefly "Route" described by "Route." }
    scheduledTime is TimeStamp with { briefly "Scheduled" described by "Scheduled time." }
  } with {
    briefly "Medication is due for administration"
    described by "Published when a scheduled medication time approaches."
  }

  event MedicationAdministered is {
    marRecordId is MedicationRecordId with { briefly "Record" described by "MAR record ID." }
    medicationOrderId is MedicationOrderId with { briefly "Order" described by "Medication order ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    administeredBy is NurseId with { briefly "By" described by "Administering nurse." }
    administeredAt is TimeStamp with { briefly "At" described by "Administration time." }
  } with {
    briefly "Medication has been administered"
    described by "Published when nurse documents medication given."
  }

  event MedicationHeld is {
    marRecordId is MedicationRecordId with { briefly "Record" described by "MAR record ID." }
    medicationOrderId is MedicationOrderId with { briefly "Order" described by "Medication order ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    heldBy is NurseId with { briefly "By" described by "Holding nurse." }
    heldAt is TimeStamp with { briefly "At" described by "Hold time." }
    reason is String with { briefly "Reason" described by "Hold reason." }
  } with {
    briefly "Medication administration has been held"
    described by "Published when nurse documents medication not given."
  }

  query GetDueMedications is {
    nurseId is NurseId with { briefly "Nurse" described by "Nurse ID." }
    windowStart is TimeStamp with { briefly "Start" described by "Window start." }
    windowEnd is TimeStamp with { briefly "End" described by "Window end." }
  } with {
    briefly "Query medications due in time window"
    described by "Returns medications due for nurse's assigned patients."
  }

  query GetMedicationHistory is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    startDate is Date with { briefly "Start" described by "Start date." }
    endDate is Date with { briefly "End" described by "End date." }
  } with {
    briefly "Query medication administration history"
    described by "Returns administration records for a patient."
  }

  result DueMedicationList is {
    medications is many optional MedicationOrder with { briefly "Medications" described by "Due medications." }
  } with {
    briefly "List of due medications"
    described by "Contains medications due for administration."
  }

  result AdministrationHistory is {
    records is many optional MedicationAdministrationRecord with { briefly "Records" described by "Administration records." }
  } with {
    briefly "Medication administration history"
    described by "Contains historical administration records."
  }

  command DocumentAdministration is {
    medicationOrderId is MedicationOrderId with { briefly "Order" described by "Medication order ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    administeredBy is NurseId with { briefly "By" described by "Administering nurse." }
    administeredAt is TimeStamp with { briefly "At" described by "Administration time." }
    dose is String with { briefly "Dose" described by "Dose given." }
    route is String with { briefly "Route" described by "Administration route." }
    site is optional String with { briefly "Site" described by "Administration site." }
    notes is optional String with { briefly "Notes" described by "Administration notes." }
  } with {
    briefly "Document medication administration"
    described by "Records that medication was given to patient."
  }

  command DocumentHold is {
    medicationOrderId is MedicationOrderId with { briefly "Order" described by "Medication order ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    heldBy is NurseId with { briefly "By" described by "Holding nurse." }
    heldAt is TimeStamp with { briefly "At" described by "Hold time." }
    reason is String with { briefly "Reason" described by "Hold reason." }
    notes is optional String with { briefly "Notes" described by "Hold notes." }
  } with {
    briefly "Document medication hold"
    described by "Records that medication was not given with reason."
  }

} with {
  option is external
  briefly "Medication administration record system for eMAR integration"
  described by {
    | External bounded context for electronic medication administration.
    | Publishes medication due alerts for nursing workflow.
    | Accepts administration and hold documentation from nursing.
    | Integrates with pharmacy for order verification and alerts.
  }
}
