// External bounded contexts that integrate with the supply chain
context VendorCatalog is {
  type VendorInfo is {
    vendorId: String
    vendorName: String
    contactEmail: String
    contactPhone: String
    address: String
    contractNumber: String
    contractExpirationDate: Date
    paymentTerms: String
    minimumOrderAmount: Decimal(12,2)
  } with {
    briefly "Vendor master information"
    described as {
      | Information about a vendor including contact details, contract
      | terms, and ordering requirements. Used for vendor selection and
      | purchase order creation.
    }
  }
  type CatalogItem is {
    vendorItemNumber: String
    vendorId: String
    hospitalItemId: ItemId
    description: String
    unitOfMeasure: String
    unitPrice: Decimal(12,2)
    packQuantity: Integer
    leadTimeDays: Integer
    minimumOrderQuantity: Integer
    isContracted: Boolean
    lastPriceUpdate: Date
  } with {
    briefly "Vendor catalog item with pricing"
    described as {
      | An item in a vendor's catalog mapped to the hospital's item master.
      | Includes current pricing, lead time, and ordering constraints.
      | Contracted items have negotiated pricing guarantees.
    }
  }
  event PriceChanged is  {
    vendorId: String
    vendorItemNumber: String
    oldPrice: Decimal(12,2)
    newPrice: Decimal(12,2)
    effectiveDate: Date
  } with {
    briefly "Vendor has changed item pricing"
    described as {
      | Notification that a vendor has updated pricing for an item.
      | Used to update internal cost estimates and trigger contract
      | compliance reviews if applicable.
    }
  }
  event CatalogUpdated is  {
    vendorId: String
    itemsAdded: Integer
    itemsRemoved: Integer
    itemsModified: Integer
    updateDate: DateTime
  } with {
    briefly "Vendor catalog has been refreshed"
    described as {
      | Notification that a vendor's catalog has been synchronized.
      | Summarizes changes for review by procurement staff.
    }
  }
  command LookupVendorItem is  {
    vendorId: String
    vendorItemNumber: String
  } with {
    briefly "Look up item in vendor catalog"
    described as {
      |Retrieves current pricing and availability for a vendor item.
    }
  }
  command SubmitPurchaseOrder is  {
    purchaseOrderId: PurchaseOrderId
    vendorId: String
    lines: PurchaseOrderLine+
    deliveryAddress: String
    requestedDeliveryDate: Date
  } with {
    briefly "Submit purchase order to vendor"
    described as {
      |Transmits a purchase order to the vendor system for fulfillment.
    }
  }
} with {
  option external()
  briefly "External vendor catalog and pricing system"
  described as {
    | The VendorCatalog context represents external vendor management
    | systems that maintain product catalogs, pricing, and availability.
    | The hospital supply chain integrates with these systems to look up
    | items, get current pricing, and transmit purchase orders. This is
    | typically a third-party procurement platform or vendor EDI connection.
  }
}
context FinanceAP is {
  type Invoice is {
    invoiceId: String
    vendorId: String
    invoiceDate: Date
    dueDate: Date
    purchaseOrderId: PurchaseOrderId
    invoiceAmount: Decimal(12,2)
    status: String
  } with {
    briefly "Vendor invoice for payment"
    described as {
      | An invoice received from a vendor for goods delivered. Must be
      | matched against purchase order and receipt before payment.
    }
  }
  type ThreeWayMatch is {
    matchId: String
    purchaseOrderId: PurchaseOrderId
    receiptId: ReceiptId
    invoiceId: String
    poAmount: Decimal(12,2)
    receiptAmount: Decimal(12,2)
    invoiceAmount: Decimal(12,2)
    matchStatus: String
    varianceAmount: Decimal(12,2)
  } with {
    briefly "Three-way match for invoice approval"
    described as {
      | The three-way match compares purchase order, receipt, and invoice
      | to ensure they agree before authorizing payment. Variances beyond
      | tolerance require manual review.
    }
  }
  event InvoiceReceived is  {
    invoiceId: String
    vendorId: String
    purchaseOrderId: PurchaseOrderId
    invoiceAmount: Decimal(12,2)
    invoiceDate: Date
  } with {
    briefly "Invoice received from vendor"
    described as {
      | Notification that an invoice has been received and is ready for
      | matching against purchase order and receipt.
    }
  }
  event PaymentScheduled is  {
    invoiceId: String
    vendorId: String
    paymentAmount: Decimal(12,2)
    scheduledPaymentDate: Date
  } with {
    briefly "Payment has been scheduled for an invoice"
    described as {
      | Notification that an invoice has passed three-way match and
      | payment has been scheduled according to payment terms.
    }
  }
  event MatchException is  {
    matchId: String
    purchaseOrderId: PurchaseOrderId
    invoiceId: String
    exceptionType: String
    varianceAmount: Decimal(12,2)
  } with {
    briefly "Three-way match exception requiring review"
    described as {
      | Notification that a three-way match failed due to price or quantity
      | variance. Requires manual review and resolution before payment.
    }
  }
  command NotifyReceipt is  {
    receiptId: ReceiptId
    purchaseOrderId: PurchaseOrderId
    receivedAmount: Decimal(12,2)
    receivedDate: DateTime
  } with {
    briefly "Notify finance of goods receipt"
    described as {
      |Sends receipt notification to trigger three-way match process.
    }
  }
  command ResolveMatchException is  {
    matchId: String
    resolution: String
    resolvedBy: String
  } with {
    briefly "Resolve a three-way match exception"
    described as {
      |Records resolution of a matching variance for payment processing.
    }
  }
} with {
  option external()
  briefly "External accounts payable and finance system"
  described as {
    | The FinanceAP context represents the hospital's accounts payable
    | system which handles vendor invoices, three-way matching, and
    | payment processing. The supply chain sends receipt notifications
    | to trigger invoice matching and receives payment status updates
    | for vendor relationship management.
  }
}
context ClinicalUsage is {
  type UsageRequest is {
    requestId: String
    departmentCode: String
    departmentName: String
    requestingUnit: String
    requestedBy: String
    patientContext: String
    items: IssueRequest*
    priority: String
    neededByDate: DateTime
  } with {
    briefly "Clinical department supply request"
    described as {
      | A request from a clinical department for supplies. May be associated
      | with a specific patient procedure or general unit restocking. Priority
      | levels determine fulfillment urgency.
    }
  }
  type UsagePattern is {
    departmentCode: String
    itemId: ItemId
    averageDaily: Decimal(12,2)
    peakDaily: Decimal(12,2)
    seasonalFactors: String
    trendDirection: String
  } with {
    briefly "Historical usage pattern for forecasting"
    described as {
      | Statistical summary of item usage by a department. Used for demand
      | forecasting and par level optimization. Includes seasonality and
      | trend information.
    }
  }
  event SupplyRequested is  {
    requestId: String
    departmentCode: String
    itemId: ItemId
    quantityRequested: Integer
    priority: String
    requestedDate: DateTime
  } with {
    briefly "Clinical department has requested supplies"
    described as {
      | Notification that a clinical area needs supplies. Triggers the
      | picking and delivery workflow in the warehouse.
    }
  }
  event SupplyConsumed is  {
    consumptionId: String
    departmentCode: String
    itemId: ItemId
    quantityConsumed: Integer
    consumptionDate: DateTime
    patientId: String
    procedureCode: String
  } with {
    briefly "Supplies have been consumed in patient care"
    described as {
      | Notification that supplies have been used in patient care. Used
      | for charge capture, usage analysis, and automated replenishment
      | triggers.
    }
  }
  event ParLevelBreach is  {
    departmentCode: String
    locationCode: String
    itemId: ItemId
    currentQuantity: Integer
    parLevel: Integer
    breachType: String
  } with {
    briefly "Stock level has fallen below par at point of use"
    described as {
      | Alert that inventory at a clinical point-of-use location has
      | fallen below the established par level. Triggers automatic
      | replenishment request.
    }
  }
  command RequestSupplies is  {
    requestId: String
    departmentCode: String
    requestedBy: String
    items: IssueRequest+
    priority: String
  } with {
    briefly "Submit supply request from clinical area"
    described as {
      |Creates a request for supplies from a clinical department.
    }
  }
  command ReportConsumption is  {
    departmentCode: String
    itemId: ItemId
    quantityConsumed: Integer
    patientId: String?
    procedureCode: String?
  } with {
    briefly "Report supply consumption"
    described as {
      |Records supplies used in patient care for tracking and billing.
    }
  }
} with {
  option external()
  briefly "External clinical usage and consumption tracking system"
  described as {
    | The ClinicalUsage context represents systems that track how supplies
    | are requested and consumed in clinical departments. This includes
    | point-of-use inventory systems, procedure supply tracking, and
    | patient charge capture. The supply chain receives demand signals
    | and usage data to optimize inventory levels and automate replenishment.
  }
}
