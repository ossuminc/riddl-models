// Operating Room Management - External Contexts
// Pre-Operative Service
context PreOpService is {
  query GetPatientClearances is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    procedureId: ProcedureId with {
      briefly "Procedure"
      described as {
        |Planned procedure.
      }
    }
  } with {
    briefly "Get patient clearances"
    described as {
      |Retrieves pre-operative clearance status for a patient.
    }
  }
  result PatientClearances is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    medicalClearance: Boolean with {
      briefly "Medical"
      described as {
        |Medical clearance obtained.
      }
    }
    cardiacClearance: Boolean? with {
      briefly "Cardiac"
      described as {
        |Cardiac clearance if required.
      }
    }
    pulmonaryClearance: Boolean? with {
      briefly "Pulmonary"
      described as {
        |Pulmonary clearance if required.
      }
    }
    anesthesiaClearance: Boolean with {
      briefly "Anesthesia"
      described as {
        |Anesthesia assessment complete.
      }
    }
    labsComplete: Boolean with {
      briefly "Labs"
      described as {
        |Required labs completed.
      }
    }
    imagingComplete: Boolean with {
      briefly "Imaging"
      described as {
        |Required imaging completed.
      }
    }
    consentSigned: Boolean with {
      briefly "Consent"
      described as {
        |Surgical consent signed.
      }
    }
    npoCriteriaMet: Boolean with {
      briefly "NPO"
      described as {
        |NPO requirements satisfied.
      }
    }
    clearanceNotes: String(1,2000)? with {
      briefly "Notes"
      described as {
        |Additional clearance notes.
      }
    }
    lastUpdated: TimeStamp with {
      briefly "Updated"
      described as {
        |Last update time.
      }
    }
  } with {
    briefly "Patient clearances"
    described as {
      |Pre-operative clearance status for surgical patient.
    }
  }
  command RequestMedicalClearance is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    procedureId: ProcedureId with {
      briefly "Procedure"
      described as {
        |Planned procedure.
      }
    }
    surgeonId: SurgeonId with {
      briefly "Surgeon"
      described as {
        |Requesting surgeon.
      }
    }
    urgency: CasePriority with {
      briefly "Urgency"
      described as {
        |Case priority.
      }
    }
    specialRequirements: String(1,1000)? with {
      briefly "Requirements"
      described as {
        |Special clearance needs.
      }
    }
  } with {
    briefly "Request medical clearance"
    described as {
      |Initiates pre-operative medical clearance process.
    }
  }
  event MedicalClearanceComplete is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    clearanceStatus: Boolean with {
      briefly "Status"
      described as {
        |Cleared or not.
      }
    }
    clearingPhysicianId: UUID with {
      briefly "Physician"
      described as {
        |Clearing physician.
      }
    }
    restrictions: String(1,1000)? with {
      briefly "Restrictions"
      described as {
        |Any restrictions noted.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Medical clearance complete"
    described as {
      |Emitted when medical clearance process completes.
    }
  }
  command RecordNPOStatus is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    lastSolidFood: TimeStamp with {
      briefly "Last food"
      described as {
        |Last solid food intake.
      }
    }
    lastClearLiquid: TimeStamp with {
      briefly "Last liquid"
      described as {
        |Last clear liquid intake.
      }
    }
    npoCriteriaMet: Boolean with {
      briefly "NPO met"
      described as {
        |Meets NPO requirements.
      }
    }
  } with {
    briefly "Record NPO status"
    described as {
      |Documents patient NPO (nothing by mouth) status.
    }
  }
  event PatientReadyForOR is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    allClearancesMet: Boolean with {
      briefly "Clearances"
      described as {
        |All clearances satisfied.
      }
    }
    readyAt: TimeStamp with {
      briefly "Ready"
      described as {
        |When patient was ready.
      }
    }
  } with {
    briefly "Patient ready for OR"
    described as {
      |Emitted when patient has completed pre-op and is ready.
    }
  }
} with {
  option external()
  briefly "External pre-operative service"
  described as {
    |External system managing pre-operative patient preparation and clearances.
  }
}
// Sterile Supply Service
context SterileSupplyService is {
  query GetInstrumentSetAvailability is  {
    instrumentSetNames: String(1,200)+ with {
      briefly "Sets"
      described as {
        |Required instrument sets.
      }
    }
    neededDate: Date with {
      briefly "Date"
      described as {
        |Date needed.
      }
    }
    neededTime: Time with {
      briefly "Time"
      described as {
        |Time needed.
      }
    }
  } with {
    briefly "Get instrument availability"
    described as {
      |Checks availability of required instrument sets.
    }
  }
  result InstrumentSetAvailability is  {
    available: String(1,200)+ with {
      briefly "Available"
      described as {
        |Available instrument sets.
      }
    }
    unavailable: String(1,200)* with {
      briefly "Unavailable"
      described as {
        |Unavailable sets.
      }
    }
    alternates: String(1,200)* with {
      briefly "Alternates"
      described as {
        |Alternative sets available.
      }
    }
  } with {
    briefly "Instrument set availability"
    described as {
      |Availability status of requested instrument sets.
    }
  }
  command RequestInstrumentSets is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Operating room.
      }
    }
    instrumentSetNames: String(1,200)+ with {
      briefly "Sets"
      described as {
        |Required instrument sets.
      }
    }
    neededDate: Date with {
      briefly "Date"
      described as {
        |Date needed.
      }
    }
    neededTime: Time with {
      briefly "Time"
      described as {
        |Time needed.
      }
    }
    surgeonId: SurgeonId with {
      briefly "Surgeon"
      described as {
        |Requesting surgeon.
      }
    }
  } with {
    briefly "Request instrument sets"
    described as {
      |Requests instrument sets for a surgical case.
    }
  }
  event InstrumentSetsDelivered is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    roomId: RoomId with {
      briefly "Room"
      described as {
        |Operating room.
      }
    }
    instrumentSets: String(1,200)+ with {
      briefly "Sets"
      described as {
        |Delivered instrument sets.
      }
    }
    deliveredAt: TimeStamp with {
      briefly "Delivered"
      described as {
        |Delivery time.
      }
    }
  } with {
    briefly "Instrument sets delivered"
    described as {
      |Emitted when instrument sets are delivered to OR.
    }
  }
  command RequestImplants is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    implantItems: String(1,200)+ with {
      briefly "Implants"
      described as {
        |Required implants.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient for sizing.
      }
    }
    surgeonId: SurgeonId with {
      briefly "Surgeon"
      described as {
        |Requesting surgeon.
      }
    }
  } with {
    briefly "Request implants"
    described as {
      |Requests implants for a surgical case.
    }
  }
  event ImplantsReady is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    implantItems: String(1,200)+ with {
      briefly "Implants"
      described as {
        |Available implants.
      }
    }
    lotNumbers: String(1,100)+ with {
      briefly "Lot numbers"
      described as {
        |Implant lot numbers.
      }
    }
    readyAt: TimeStamp with {
      briefly "Ready"
      described as {
        |When implants were ready.
      }
    }
  } with {
    briefly "Implants ready"
    described as {
      |Emitted when implants are available for the case.
    }
  }
  command ReturnUnusedSupplies is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    unusedItems: String(1,200)+ with {
      briefly "Items"
      described as {
        |Unused supplies to return.
      }
    }
    returnedBy: UUID with {
      briefly "Returned by"
      described as {
        |Staff returning items.
      }
    }
  } with {
    briefly "Return unused supplies"
    described as {
      |Returns unused sterile supplies after case completion.
    }
  }
} with {
  option external()
  briefly "External sterile supply service"
  described as {
    |External system managing surgical instruments, supplies, and implants.
  }
}
// Anesthesia Service
context AnesthesiaService is {
  query GetAnesthesiologistSchedule is  {
    anesthesiologistId: AnesthesiologistId with {
      briefly "Anesthesiologist"
      described as {
        |Anesthesiologist ID.
      }
    }
    scheduleDate: Date with {
      briefly "Date"
      described as {
        |Schedule date.
      }
    }
  } with {
    briefly "Get anesthesiologist schedule"
    described as {
      |Retrieves anesthesiologist's daily schedule.
    }
  }
  result AnesthesiologistSchedule is  {
    anesthesiologistId: AnesthesiologistId with {
      briefly "Anesthesiologist"
      described as {
        |Anesthesiologist ID.
      }
    }
    scheduleDate: Date with {
      briefly "Date"
      described as {
        |Schedule date.
      }
    }
    assignedCases: CaseId+ with {
      briefly "Cases"
      described as {
        |Assigned surgical cases.
      }
    }
    availableSlots: Time+ with {
      briefly "Available"
      described as {
        |Available time slots.
      }
    }
  } with {
    briefly "Anesthesiologist schedule"
    described as {
      |Daily schedule for an anesthesiologist.
    }
  }
  command RequestAnesthesiaCoverage is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    procedureName: String(1,500) with {
      briefly "Procedure"
      described as {
        |Surgical procedure.
      }
    }
    anesthesiaType: AnesthesiaType with {
      briefly "Type"
      described as {
        |Required anesthesia type.
      }
    }
    scheduledDate: Date with {
      briefly "Date"
      described as {
        |Surgery date.
      }
    }
    scheduledStartTime: Time with {
      briefly "Time"
      described as {
        |Start time.
      }
    }
    estimatedDuration: Duration with {
      briefly "Duration"
      described as {
        |Expected duration.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
  } with {
    briefly "Request anesthesia coverage"
    described as {
      |Requests anesthesiologist assignment for a case.
    }
  }
  event AnesthesiaCoverageAssigned is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    anesthesiologistId: AnesthesiologistId with {
      briefly "Anesthesiologist"
      described as {
        |Assigned anesthesiologist.
      }
    }
    anesthesiaType: AnesthesiaType with {
      briefly "Type"
      described as {
        |Planned anesthesia type.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Anesthesia coverage assigned"
    described as {
      |Emitted when anesthesiologist is assigned to case.
    }
  }
  command DocumentAnesthesiaRecord is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    anesthesiologistId: AnesthesiologistId with {
      briefly "Anesthesiologist"
      described as {
        |Anesthesiologist.
      }
    }
    anesthesiaType: AnesthesiaType with {
      briefly "Type"
      described as {
        |Anesthesia administered.
      }
    }
    inductionTime: TimeStamp with {
      briefly "Induction"
      described as {
        |Anesthesia induction time.
      }
    }
    emergenceTime: TimeStamp with {
      briefly "Emergence"
      described as {
        |Anesthesia emergence time.
      }
    }
    medications: String(1,200)+ with {
      briefly "Medications"
      described as {
        |Medications administered.
      }
    }
    vitalSignsSummary: String(1,2000) with {
      briefly "Vitals"
      described as {
        |Vital signs summary.
      }
    }
    complications: String(1,1000)? with {
      briefly "Complications"
      described as {
        |Any anesthesia complications.
      }
    }
  } with {
    briefly "Document anesthesia record"
    described as {
      |Documents the anesthesia record for a surgical case.
    }
  }
  event AnesthesiaRecordComplete is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    anesthesiologistId: AnesthesiologistId with {
      briefly "Anesthesiologist"
      described as {
        |Anesthesiologist.
      }
    }
    recordId: UUID with {
      briefly "Record"
      described as {
        |Anesthesia record ID.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Anesthesia record complete"
    described as {
      |Emitted when anesthesia documentation is finalized.
    }
  }
  command RequestPACUHandoff is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    anesthesiologistId: AnesthesiologistId with {
      briefly "Anesthesiologist"
      described as {
        |Anesthesiologist.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    anesthesiaType: AnesthesiaType with {
      briefly "Type"
      described as {
        |Anesthesia type used.
      }
    }
    airwayStatus: String(1,200) with {
      briefly "Airway"
      described as {
        |Airway status.
      }
    }
    painManagement: String(1,500) with {
      briefly "Pain"
      described as {
        |Pain management plan.
      }
    }
    specialInstructions: String(1,1000)? with {
      briefly "Instructions"
      described as {
        |Special PACU instructions.
      }
    }
  } with {
    briefly "Request PACU handoff"
    described as {
      |Initiates handoff communication to PACU nursing staff.
    }
  }
  event PACUHandoffComplete is  {
    caseId: CaseId with {
      briefly "Case"
      described as {
        |Surgical case.
      }
    }
    receivingNurseId: UUID with {
      briefly "Nurse"
      described as {
        |Receiving PACU nurse.
      }
    }
    handoffTime: TimeStamp with {
      briefly "Handoff"
      described as {
        |Handoff completion time.
      }
    }
  } with {
    briefly "PACU handoff complete"
    described as {
      |Emitted when patient care is transferred to PACU.
    }
  }
} with {
  option external()
  briefly "External anesthesia service"
  described as {
    |External system managing anesthesia staffing, records, and care coordination.
  }
}
