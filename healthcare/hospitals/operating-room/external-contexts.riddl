// Operating Room Management - External Contexts

// Pre-Operative Service
context PreOpService is {

  query GetPatientClearances is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    procedureId is ProcedureId with { briefly "Procedure" described by "Planned procedure." }
  } with {
    briefly "Get patient clearances"
    described by "Retrieves pre-operative clearance status for a patient."
  }

  result PatientClearances is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    medicalClearance is Boolean with { briefly "Medical" described by "Medical clearance obtained." }
    cardiacClearance is optional Boolean with { briefly "Cardiac" described by "Cardiac clearance if required." }
    pulmonaryClearance is optional Boolean with { briefly "Pulmonary" described by "Pulmonary clearance if required." }
    anesthesiaClearance is Boolean with { briefly "Anesthesia" described by "Anesthesia assessment complete." }
    labsComplete is Boolean with { briefly "Labs" described by "Required labs completed." }
    imagingComplete is Boolean with { briefly "Imaging" described by "Required imaging completed." }
    consentSigned is Boolean with { briefly "Consent" described by "Surgical consent signed." }
    npoCriteriaMet is Boolean with { briefly "NPO" described by "NPO requirements satisfied." }
    clearanceNotes is optional String(1, 2000) with { briefly "Notes" described by "Additional clearance notes." }
    lastUpdated is TimeStamp with { briefly "Updated" described by "Last update time." }
  } with {
    briefly "Patient clearances"
    described by "Pre-operative clearance status for surgical patient."
  }

  command RequestMedicalClearance is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    procedureId is ProcedureId with { briefly "Procedure" described by "Planned procedure." }
    surgeonId is SurgeonId with { briefly "Surgeon" described by "Requesting surgeon." }
    urgency is CasePriority with { briefly "Urgency" described by "Case priority." }
    specialRequirements is optional String(1, 1000) with { briefly "Requirements" described by "Special clearance needs." }
  } with {
    briefly "Request medical clearance"
    described by "Initiates pre-operative medical clearance process."
  }

  event MedicalClearanceComplete is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    clearanceStatus is Boolean with { briefly "Status" described by "Cleared or not." }
    clearingPhysicianId is UUID with { briefly "Physician" described by "Clearing physician." }
    restrictions is optional String(1, 1000) with { briefly "Restrictions" described by "Any restrictions noted." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Medical clearance complete"
    described by "Emitted when medical clearance process completes."
  }

  command RecordNPOStatus is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    lastSolidFood is TimeStamp with { briefly "Last food" described by "Last solid food intake." }
    lastClearLiquid is TimeStamp with { briefly "Last liquid" described by "Last clear liquid intake." }
    npoCriteriaMet is Boolean with { briefly "NPO met" described by "Meets NPO requirements." }
  } with {
    briefly "Record NPO status"
    described by "Documents patient NPO (nothing by mouth) status."
  }

  event PatientReadyForOR is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    allClearancesMet is Boolean with { briefly "Clearances" described by "All clearances satisfied." }
    readyAt is TimeStamp with { briefly "Ready" described by "When patient was ready." }
  } with {
    briefly "Patient ready for OR"
    described by "Emitted when patient has completed pre-op and is ready."
  }

} with {
  option is external
  briefly "External pre-operative service"
  described by "External system managing pre-operative patient preparation and clearances."
}

// Sterile Supply Service
context SterileSupplyService is {

  query GetInstrumentSetAvailability is {
    instrumentSetNames is many String(1, 200) with { briefly "Sets" described by "Required instrument sets." }
    neededDate is Date with { briefly "Date" described by "Date needed." }
    neededTime is Time with { briefly "Time" described by "Time needed." }
  } with {
    briefly "Get instrument availability"
    described by "Checks availability of required instrument sets."
  }

  result InstrumentSetAvailability is {
    available is many String(1, 200) with { briefly "Available" described by "Available instrument sets." }
    unavailable is many optional String(1, 200) with { briefly "Unavailable" described by "Unavailable sets." }
    alternates is many optional String(1, 200) with { briefly "Alternates" described by "Alternative sets available." }
  } with {
    briefly "Instrument set availability"
    described by "Availability status of requested instrument sets."
  }

  command RequestInstrumentSets is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    roomId is RoomId with { briefly "Room" described by "Operating room." }
    instrumentSetNames is many String(1, 200) with { briefly "Sets" described by "Required instrument sets." }
    neededDate is Date with { briefly "Date" described by "Date needed." }
    neededTime is Time with { briefly "Time" described by "Time needed." }
    surgeonId is SurgeonId with { briefly "Surgeon" described by "Requesting surgeon." }
  } with {
    briefly "Request instrument sets"
    described by "Requests instrument sets for a surgical case."
  }

  event InstrumentSetsDelivered is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    roomId is RoomId with { briefly "Room" described by "Operating room." }
    instrumentSets is many String(1, 200) with { briefly "Sets" described by "Delivered instrument sets." }
    deliveredAt is TimeStamp with { briefly "Delivered" described by "Delivery time." }
  } with {
    briefly "Instrument sets delivered"
    described by "Emitted when instrument sets are delivered to OR."
  }

  command RequestImplants is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    implantItems is many String(1, 200) with { briefly "Implants" described by "Required implants." }
    patientId is PatientId with { briefly "Patient" described by "Patient for sizing." }
    surgeonId is SurgeonId with { briefly "Surgeon" described by "Requesting surgeon." }
  } with {
    briefly "Request implants"
    described by "Requests implants for a surgical case."
  }

  event ImplantsReady is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    implantItems is many String(1, 200) with { briefly "Implants" described by "Available implants." }
    lotNumbers is many String(1, 100) with { briefly "Lot numbers" described by "Implant lot numbers." }
    readyAt is TimeStamp with { briefly "Ready" described by "When implants were ready." }
  } with {
    briefly "Implants ready"
    described by "Emitted when implants are available for the case."
  }

  command ReturnUnusedSupplies is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    unusedItems is many String(1, 200) with { briefly "Items" described by "Unused supplies to return." }
    returnedBy is UUID with { briefly "Returned by" described by "Staff returning items." }
  } with {
    briefly "Return unused supplies"
    described by "Returns unused sterile supplies after case completion."
  }

} with {
  option is external
  briefly "External sterile supply service"
  described by "External system managing surgical instruments, supplies, and implants."
}

// Anesthesia Service
context AnesthesiaService is {

  query GetAnesthesiologistSchedule is {
    anesthesiologistId is AnesthesiologistId with { briefly "Anesthesiologist" described by "Anesthesiologist ID." }
    scheduleDate is Date with { briefly "Date" described by "Schedule date." }
  } with {
    briefly "Get anesthesiologist schedule"
    described by "Retrieves anesthesiologist's daily schedule."
  }

  result AnesthesiologistSchedule is {
    anesthesiologistId is AnesthesiologistId with { briefly "Anesthesiologist" described by "Anesthesiologist ID." }
    scheduleDate is Date with { briefly "Date" described by "Schedule date." }
    assignedCases is many CaseId with { briefly "Cases" described by "Assigned surgical cases." }
    availableSlots is many Time with { briefly "Available" described by "Available time slots." }
  } with {
    briefly "Anesthesiologist schedule"
    described by "Daily schedule for an anesthesiologist."
  }

  command RequestAnesthesiaCoverage is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    procedureName is String(1, 500) with { briefly "Procedure" described by "Surgical procedure." }
    anesthesiaType is AnesthesiaType with { briefly "Type" described by "Required anesthesia type." }
    scheduledDate is Date with { briefly "Date" described by "Surgery date." }
    scheduledStartTime is Time with { briefly "Time" described by "Start time." }
    estimatedDuration is Duration with { briefly "Duration" described by "Expected duration." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
  } with {
    briefly "Request anesthesia coverage"
    described by "Requests anesthesiologist assignment for a case."
  }

  event AnesthesiaCoverageAssigned is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    anesthesiologistId is AnesthesiologistId with { briefly "Anesthesiologist" described by "Assigned anesthesiologist." }
    anesthesiaType is AnesthesiaType with { briefly "Type" described by "Planned anesthesia type." }
    assignedAt is TimeStamp with { briefly "Assigned" described by "Assignment time." }
  } with {
    briefly "Anesthesia coverage assigned"
    described by "Emitted when anesthesiologist is assigned to case."
  }

  command DocumentAnesthesiaRecord is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    anesthesiologistId is AnesthesiologistId with { briefly "Anesthesiologist" described by "Anesthesiologist." }
    anesthesiaType is AnesthesiaType with { briefly "Type" described by "Anesthesia administered." }
    inductionTime is TimeStamp with { briefly "Induction" described by "Anesthesia induction time." }
    emergenceTime is TimeStamp with { briefly "Emergence" described by "Anesthesia emergence time." }
    medications is many String(1, 200) with { briefly "Medications" described by "Medications administered." }
    vitalSignsSummary is String(1, 2000) with { briefly "Vitals" described by "Vital signs summary." }
    complications is optional String(1, 1000) with { briefly "Complications" described by "Any anesthesia complications." }
  } with {
    briefly "Document anesthesia record"
    described by "Documents the anesthesia record for a surgical case."
  }

  event AnesthesiaRecordComplete is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    anesthesiologistId is AnesthesiologistId with { briefly "Anesthesiologist" described by "Anesthesiologist." }
    recordId is UUID with { briefly "Record" described by "Anesthesia record ID." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Anesthesia record complete"
    described by "Emitted when anesthesia documentation is finalized."
  }

  command RequestPACUHandoff is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    anesthesiologistId is AnesthesiologistId with { briefly "Anesthesiologist" described by "Anesthesiologist." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    anesthesiaType is AnesthesiaType with { briefly "Type" described by "Anesthesia type used." }
    airwayStatus is String(1, 200) with { briefly "Airway" described by "Airway status." }
    painManagement is String(1, 500) with { briefly "Pain" described by "Pain management plan." }
    specialInstructions is optional String(1, 1000) with { briefly "Instructions" described by "Special PACU instructions." }
  } with {
    briefly "Request PACU handoff"
    described by "Initiates handoff communication to PACU nursing staff."
  }

  event PACUHandoffComplete is {
    caseId is CaseId with { briefly "Case" described by "Surgical case." }
    receivingNurseId is UUID with { briefly "Nurse" described by "Receiving PACU nurse." }
    handoffTime is TimeStamp with { briefly "Handoff" described by "Handoff completion time." }
  } with {
    briefly "PACU handoff complete"
    described by "Emitted when patient care is transferred to PACU."
  }

} with {
  option is external
  briefly "External anesthesia service"
  described by "External system managing anesthesia staffing, records, and care coordination."
}
