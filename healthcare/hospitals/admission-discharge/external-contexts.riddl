// Hospital Admission/Discharge - External Contexts
// Bed Management Service
context BedManagementService is {
  query GetAvailableBeds is  {
    filterUnitId: UnitId? with {
      briefly "Unit"
      described as {
        |Filter by unit.
      }
    }
    filterAccommodationType: AccommodationType? with {
      briefly "Type"
      described as {
        |Filter by accommodation.
      }
    }
  } with {
    briefly "Get available beds"
    described as {
      |Retrieves list of available beds.
    }
  }
  result AvailableBedList is  {
    beds: BedAssignment+ with {
      briefly "Beds"
      described as {
        |Available beds.
      }
    }
    totalAvailable: Natural with {
      briefly "Total"
      described as {
        |Total available.
      }
    }
  } with {
    briefly "Available bed list"
    described as {
      |List of beds available for assignment.
    }
  }
  command RequestHousekeeping is  {
    bedId: BedId with {
      briefly "Bed"
      described as {
        |Bed needing cleaning.
      }
    }
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Hospital unit.
      }
    }
    priority: String(1,20) with {
      briefly "Priority"
      described as {
        |Cleaning urgency.
      }
    }
  } with {
    briefly "Request housekeeping"
    described as {
      |Requests bed cleaning after discharge.
    }
  }
  event HousekeepingComplete is  {
    bedId: BedId with {
      briefly "Bed"
      described as {
        |Cleaned bed.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Housekeeping complete"
    described as {
      |Emitted when bed is ready for new patient.
    }
  }
  command ReserveBed is  {
    bedId: BedId with {
      briefly "Bed"
      described as {
        |Bed to reserve.
      }
    }
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |For admission.
      }
    }
    reservedUntil: TimeStamp with {
      briefly "Until"
      described as {
        |Reservation expiry.
      }
    }
  } with {
    briefly "Reserve bed"
    described as {
      |Temporarily reserves a bed for incoming patient.
    }
  }
  event BedReserved is  {
    bedId: BedId with {
      briefly "Bed"
      described as {
        |Reserved bed.
      }
    }
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |For admission.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Bed reserved"
    described as {
      |Emitted when bed is reserved.
    }
  }
} with {
  option external()
  briefly "External bed management"
  described as {
    |External bed management and housekeeping system.
  }
}
// Patient Registration Service
context PatientRegistration is {
  query GetPatientDemographics is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
  } with {
    briefly "Get demographics"
    described as {
      |Retrieves patient demographic information.
    }
  }
  result PatientDemographics is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    mrn: String(1,20) with {
      briefly "MRN"
      described as {
        |Medical record number.
      }
    }
    firstName: String(1,100) with {
      briefly "First"
      described as {
        |First name.
      }
    }
    lastName: String(1,100) with {
      briefly "Last"
      described as {
        |Last name.
      }
    }
    dateOfBirth: Date with {
      briefly "DOB"
      described as {
        |Date of birth.
      }
    }
    gender: String(1,20) with {
      briefly "Gender"
      described as {
        |Patient gender.
      }
    }
    address: String(1,500) with {
      briefly "Address"
      described as {
        |Home address.
      }
    }
    phone: String(1,20) with {
      briefly "Phone"
      described as {
        |Contact phone.
      }
    }
    emergencyContact: String(1,200) with {
      briefly "Emergency"
      described as {
        |Emergency contact.
      }
    }
  } with {
    briefly "Patient demographics"
    described as {
      |Patient demographic information.
    }
  }
  query GetInsuranceInfo is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
  } with {
    briefly "Get insurance"
    described as {
      |Retrieves patient insurance information.
    }
  }
  result InsuranceInfo is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    primaryInsurance: String(1,200) with {
      briefly "Primary"
      described as {
        |Primary insurance.
      }
    }
    policyNumber: String(1,50) with {
      briefly "Policy"
      described as {
        |Policy number.
      }
    }
    groupNumber: String(1,50)? with {
      briefly "Group"
      described as {
        |Group number.
      }
    }
    verified: Boolean with {
      briefly "Verified"
      described as {
        |Insurance verified.
      }
    }
    authorizationNumber: String(1,50)? with {
      briefly "Auth"
      described as {
        |Prior auth number.
      }
    }
  } with {
    briefly "Insurance information"
    described as {
      |Patient insurance and authorization details.
    }
  }
  command VerifyInsurance is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    admissionType: AdmissionType with {
      briefly "Type"
      described as {
        |Admission type.
      }
    }
    expectedLOS: Natural? with {
      briefly "LOS"
      described as {
        |Expected stay.
      }
    }
  } with {
    briefly "Verify insurance"
    described as {
      |Requests insurance verification and pre-authorization.
    }
  }
  event InsuranceVerified is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    verified: Boolean with {
      briefly "Verified"
      described as {
        |Verification status.
      }
    }
    authorizationNumber: String(1,50)? with {
      briefly "Auth"
      described as {
        |Authorization number.
      }
    }
    approvedDays: Natural? with {
      briefly "Days"
      described as {
        |Approved days.
      }
    }
    verifiedAt: TimeStamp with {
      briefly "Verified"
      described as {
        |Verification time.
      }
    }
  } with {
    briefly "Insurance verified"
    described as {
      |Emitted when insurance verification completes.
    }
  }
} with {
  option external()
  briefly "External patient registration"
  described as {
    |External patient registration and insurance system.
  }
}
// Clinical Service
context ClinicalService is {
  command CreateAdmissionOrders is  {
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |Admission ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    physicianId: PhysicianId with {
      briefly "Physician"
      described as {
        |Ordering physician.
      }
    }
    admitDiagnosis: String(1,500) with {
      briefly "Diagnosis"
      described as {
        |Admission diagnosis.
      }
    }
  } with {
    briefly "Create admission orders"
    described as {
      |Creates standing admission orders.
    }
  }
  event AdmissionOrdersCreated is  {
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |Admission ID.
      }
    }
    orderSetId: UUID with {
      briefly "Order set"
      described as {
        |Generated order set.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Admission orders created"
    described as {
      |Emitted when admission orders are generated.
    }
  }
  command DocumentClinicalNote is  {
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |Admission ID.
      }
    }
    noteType: String(1,50) with {
      briefly "Type"
      described as {
        |Note type.
      }
    }
    content: String(1,10000) with {
      briefly "Content"
      described as {
        |Note content.
      }
    }
    authorId: PhysicianId with {
      briefly "Author"
      described as {
        |Note author.
      }
    }
  } with {
    briefly "Document note"
    described as {
      |Documents clinical note for admission.
    }
  }
  event ClinicalNoteDocumented is  {
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |Admission ID.
      }
    }
    noteId: UUID with {
      briefly "Note"
      described as {
        |Note ID.
      }
    }
    noteType: String(1,50) with {
      briefly "Type"
      described as {
        |Note type.
      }
    }
    documentedAt: TimeStamp with {
      briefly "Documented"
      described as {
        |Documentation time.
      }
    }
  } with {
    briefly "Note documented"
    described as {
      |Emitted when clinical note is saved.
    }
  }
  command CreateDischargeOrders is  {
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |Admission ID.
      }
    }
    physicianId: PhysicianId with {
      briefly "Physician"
      described as {
        |Ordering physician.
      }
    }
    disposition: DischargeDisposition with {
      briefly "Disposition"
      described as {
        |Discharge destination.
      }
    }
    dischargeMedications: String(1,200)+ with {
      briefly "Medications"
      described as {
        |Discharge medications.
      }
    }
  } with {
    briefly "Create discharge orders"
    described as {
      |Creates discharge medication and follow-up orders.
    }
  }
  event DischargeOrdersCreated is  {
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |Admission ID.
      }
    }
    orderSetId: UUID with {
      briefly "Order set"
      described as {
        |Discharge order set.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Discharge orders created"
    described as {
      |Emitted when discharge orders are generated.
    }
  }
} with {
  option external()
  briefly "External clinical service"
  described as {
    |External clinical documentation and order system.
  }
}
// Notification Service
context NotificationService is {
  command NotifyNurseStation is  {
    unitId: UnitId with {
      briefly "Unit"
      described as {
        |Hospital unit.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Notification message.
      }
    }
    priority: String(1,20) with {
      briefly "Priority"
      described as {
        |Notification priority.
      }
    }
  } with {
    briefly "Notify nurse station"
    described as {
      |Sends notification to nursing unit.
    }
  }
  command NotifyPhysician is  {
    physicianId: PhysicianId with {
      briefly "Physician"
      described as {
        |Physician to notify.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Notification message.
      }
    }
    relatedAdmissionId: AdmissionId? with {
      briefly "Admission"
      described as {
        |Related admission.
      }
    }
  } with {
    briefly "Notify physician"
    described as {
      |Sends notification to physician.
    }
  }
  command NotifyCaseManagement is  {
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |Admission ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Notification message.
      }
    }
  } with {
    briefly "Notify case management"
    described as {
      |Alerts case management team.
    }
  }
  event NotificationSent is  {
    notificationId: UUID with {
      briefly "Notification"
      described as {
        |Notification ID.
      }
    }
    recipient: String(1,100) with {
      briefly "Recipient"
      described as {
        |Notification recipient.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification sent"
    described as {
      |Emitted when notification is delivered.
    }
  }
} with {
  option external()
  briefly "External notifications"
  described as {
    |External notification and alerting system.
  }
}
// Billing Service
context BillingService is {
  command SubmitAdmissionForBilling is  {
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |Admission ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    admissionType: AdmissionType with {
      briefly "Type"
      described as {
        |Admission type.
      }
    }
    lengthOfStay: LengthOfStay with {
      briefly "LOS"
      described as {
        |Length of stay.
      }
    }
    dischargeDiagnoses: String(1,500)+ with {
      briefly "Diagnoses"
      described as {
        |Discharge diagnoses.
      }
    }
  } with {
    briefly "Submit for billing"
    described as {
      |Submits completed admission for billing.
    }
  }
  event BillingSubmitted is  {
    admissionId: AdmissionId with {
      briefly "Admission"
      described as {
        |Admission ID.
      }
    }
    claimId: UUID with {
      briefly "Claim"
      described as {
        |Generated claim ID.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Billing submitted"
    described as {
      |Emitted when admission is sent to billing.
    }
  }
} with {
  option external()
  briefly "External billing"
  described as {
    |External hospital billing and revenue cycle system.
  }
}
