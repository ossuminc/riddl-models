// Types for Radiology Workflow Domain
// Defines identifiers, enumerations, and records used across the radiology workflow

// ============================================================================
// Identifiers
// ============================================================================

type ExamId is Id(ImagingExam) with {
  briefly "Unique identifier for an imaging examination"
  described by {
    | A system-generated identifier that uniquely identifies an imaging
    | examination throughout its lifecycle from order to final report.
  }
}

type StudyId is Id(ImagingExam) with {
  briefly "Unique identifier for a DICOM study"
  described by {
    | Corresponds to the DICOM Study Instance UID, linking all images
    | acquired during a single imaging session.
  }
}

type ModalityId is String with {
  briefly "Identifier for imaging equipment"
  described by {
    | Identifies specific imaging equipment such as CT scanners, MRI
    | machines, X-ray units, or ultrasound systems.
  }
}

type ReportId is Id(ImagingExam) with {
  briefly "Unique identifier for a radiology report"
  described by {
    | A system-generated identifier that uniquely identifies a radiology
    | interpretation report.
  }
}

type PatientId is String with {
  briefly "Patient medical record number"
  described by {
    | The unique identifier for a patient within the healthcare system,
    | typically the Medical Record Number (MRN).
  }
}

type PhysicianId is String with {
  briefly "Identifier for a physician"
  described by {
    | Unique identifier for physicians including ordering clinicians
    | and interpreting radiologists.
  }
}

type TechnicianId is String with {
  briefly "Identifier for a radiology technician"
  described by {
    | Unique identifier for radiologic technologists who perform
    | imaging examinations.
  }
}

// ============================================================================
// Enumerations
// ============================================================================

type ExamStatus is any of {
  Ordered,
  Scheduled,
  CheckedIn,
  InProgress,
  Completed,
  Interpreted,
  Finalized
} with {
  briefly "Current status of an imaging examination"
  described by {
    | Tracks the lifecycle state of an imaging examination:
    | - Ordered: Exam has been requested by ordering physician
    | - Scheduled: Appointment time and modality assigned
    | - CheckedIn: Patient has arrived and registered
    | - InProgress: Image acquisition is underway
    | - Completed: Images have been acquired and sent to PACS
    | - Interpreted: Radiologist has created draft report
    | - Finalized: Report has been signed and distributed
  }
}

type ModalityType is any of {
  CT,
  MRI,
  XRay,
  Ultrasound,
  Mammography,
  Fluoroscopy,
  NuclearMedicine,
  PET,
  Interventional
} with {
  briefly "Type of imaging modality"
  described by {
    | Classification of imaging equipment by technology type, used for
    | scheduling, protocol selection, and resource planning.
  }
}

type ExamPriority is any of {
  Routine,
  Urgent,
  Stat,
  Emergent
} with {
  briefly "Priority level for imaging examination"
  described by {
    | Determines scheduling and interpretation priority:
    | - Routine: Standard turnaround, scheduled normally
    | - Urgent: Same-day completion required
    | - Stat: Within hours, interrupts normal workflow
    | - Emergent: Immediate, life-threatening situation
  }
}

type ReportStatus is any of {
  Draft,
  Preliminary,
  Final,
  Amended,
  Addended
} with {
  briefly "Status of the radiology report"
  described by {
    | Tracks the report through its approval workflow from initial
    | dictation to final signature and any subsequent amendments.
  }
}

type CriticalFindingSeverity is any of {
  Urgent,
  Critical,
  LifeThreatening
} with {
  briefly "Severity level of a critical finding"
  described by {
    | Classification of critical findings requiring immediate
    | communication to the ordering physician per ACR guidelines.
  }
}

// ============================================================================
// Records
// ============================================================================

type ImagingOrder is {
  orderId is ExamId,
  patientId is PatientId,
  orderingPhysicianId is PhysicianId,
  examCode is String,
  examDescription is String,
  modalityType is ModalityType,
  priority is ExamPriority,
  clinicalIndication is String,
  relevantHistory is String,
  orderedAt is TimeStamp,
  scheduledDateTime is TimeStamp?,
  specialInstructions is String?
} with {
  briefly "Imaging examination order details"
  described by {
    | Contains all information from the ordering physician needed to schedule
    | and perform the imaging examination. Includes clinical context to guide
    | protocol selection and interpretation.
  }
}

type ExamProtocol is {
  protocolId is String,
  protocolName is String,
  modalityType is ModalityType,
  contrastRequired is Boolean,
  estimatedDuration is Duration,
  radiationDose is Number?,
  preparationInstructions is String,
  contraindications is String*
} with {
  briefly "Imaging protocol specifications"
  described by {
    | Defines the technical parameters and patient preparation requirements
    | for performing a specific type of imaging examination. Protocols ensure
    | standardization and optimal image quality.
  }
}

type StudyInfo is {
  studyId is StudyId,
  studyInstanceUid is String,
  studyDateTime is TimeStamp,
  modalityId is ModalityId,
  technicianId is TechnicianId,
  numberOfSeries is Integer,
  numberOfImages is Integer,
  bodyPartExamined is String,
  studyDescription is String,
  accessionNumber is String,
  referringPhysician is PhysicianId
} with {
  briefly "DICOM study metadata"
  described by {
    | Contains metadata about the acquired imaging study following DICOM
    | standards. Links images in PACS to the radiology workflow and enables
    | study identification and retrieval.
  }
}

type RadiologyReport is {
  reportId is ReportId,
  examId is ExamId,
  studyId is StudyId,
  patientId is PatientId,
  radiologistId is PhysicianId,
  reportStatus is ReportStatus,
  findings is String,
  impression is String,
  recommendations is String?,
  comparisonStudies is StudyId*,
  criticalFinding is CriticalFinding?,
  dictatedAt is TimeStamp,
  signedAt is TimeStamp?,
  transcribedBy is String?
} with {
  briefly "Radiology interpretation report"
  described by {
    | The formal interpretation of an imaging study by a radiologist. Contains
    | structured sections for findings, impression, and recommendations following
    | ACR reporting guidelines.
  }
}

type CriticalFinding is {
  findingId is String,
  severity is CriticalFindingSeverity,
  findingDescription is String,
  identifiedAt is TimeStamp,
  communicatedAt is TimeStamp?,
  communicatedTo is PhysicianId?,
  communicationMethod is String?,
  acknowledgementReceived is Boolean
} with {
  briefly "Critical finding requiring immediate communication"
  described by {
    | Documents unexpected findings requiring urgent communication to the
    | ordering or covering physician. Tracks the closed-loop communication
    | process per ACR Practice Parameter guidelines.
  }
}

type ScheduleSlot is {
  slotDateTime is TimeStamp,
  modalityId is ModalityId,
  duration is Duration,
  roomLocation is String
} with {
  briefly "Available time slot for scheduling"
  described by {
    | Represents an available appointment slot on a specific modality,
    | used for exam scheduling.
  }
}

type TurnaroundMetrics is {
  examId is ExamId,
  orderToSchedule is Duration?,
  scheduleToAcquisition is Duration?,
  acquisitionToInterpretation is Duration?,
  interpretationToFinal is Duration?,
  totalTurnaround is Duration?
} with {
  briefly "Time metrics for exam workflow"
  described by {
    | Captures duration between each workflow milestone for quality
    | improvement and operational efficiency analysis.
  }
}

type ModalityUtilization is {
  modalityId is ModalityId,
  date is Date,
  scheduledExams is Integer,
  completedExams is Integer,
  utilizationPercent is Number,
  averageExamDuration is Duration,
  downtimeMinutes is Integer
} with {
  briefly "Daily utilization metrics for a modality"
  described by {
    | Tracks equipment utilization for capacity planning and
    | operational efficiency measurement.
  }
}
