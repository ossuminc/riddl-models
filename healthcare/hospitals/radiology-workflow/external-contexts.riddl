// External Contexts for Radiology Workflow
// Defines bounded contexts representing external systems that integrate with
// the radiology workflow
context PACSIntegration is {
  type ImageReference is {
    studyInstanceUid: String
    seriesInstanceUid: String
    sopInstanceUid: String
    transferSyntax: String
  } with {
    briefly "Reference to a DICOM image in PACS"
    described as {
      | Contains DICOM UIDs needed to retrieve a specific image from
      | the Picture Archiving and Communication System.
    }
  }
  type StorageConfirmation is {
    studyInstanceUid: String
    storedAt: TimeStamp
    numberOfInstances: Integer
    storageLocation: String
  } with {
    briefly "Confirmation of image storage in PACS"
    described as {
      | Acknowledgement that images have been successfully archived
      | in the PACS storage system.
    }
  }
  event ImagesStored is  {
    studyId: StudyId
    confirmation: PACSIntegration.StorageConfirmation
  } with {
    briefly "Images have been stored in PACS"
    described as {
      | Notification that acquired images are now available for
      | viewing and interpretation.
    }
  }
  event ImagesRetrieved is  {
    studyId: StudyId
    imageReferences: PACSIntegration.ImageReference*
    retrievedAt: TimeStamp
  } with {
    briefly "Images have been retrieved from PACS"
    described as {
      |Notification that images have been prefetched for viewing.
    }
  }
  command StoreImages is  {
    studyId: StudyId
    modalityAeTitle: String
    imageCount: Integer
  } with {
    briefly "Store images to PACS"
    described as {
      |Request to archive images from an imaging modality to PACS.
    }
  }
  command RetrieveImages is  {
    studyId: StudyId
    destinationAeTitle: String
    priority: String
  } with {
    briefly "Retrieve images from PACS"
    described as {
      |Request to fetch images for viewing on a workstation.
    }
  }
  command PrefetchPriorStudies is  {
    patientId: PatientId
    modalityType: ModalityType
    destinationAeTitle: String
  } with {
    briefly "Prefetch prior studies for comparison"
    described as {
      | Request to retrieve relevant prior studies before patient
      | arrival to speed interpretation workflow.
    }
  }
} with {
  option external()
  briefly "Picture Archiving and Communication System"
  described as {
    | The PACS provides long-term storage and retrieval of medical images in
    | DICOM format. It receives images from imaging modalities, archives them,
    | and makes them available to viewing workstations throughout the enterprise.
    | Integration uses DICOM protocols (C-STORE, C-FIND, C-MOVE, C-GET).
  }
}
context RISIntegration is {
  type WorklistItem is {
    accessionNumber: String
    patientId: PatientId
    patientName: String
    scheduledProcedureStepId: String
    scheduledDateTime: TimeStamp
    modalityAeTitle: String
    scheduledStationName: String
    requestedProcedureDescription: String
  } with {
    briefly "Modality worklist item"
    described as {
      | Entry in the DICOM Modality Worklist used by imaging equipment
      | to retrieve patient and procedure information.
    }
  }
  type ScheduleRequest is {
    orderId: ExamId
    patientId: PatientId
    procedureCode: String
    requestedDateTime: TimeStamp?
    preferredModality: ModalityId?
    duration: Duration
  } with {
    briefly "Request to schedule an examination"
    described as {
      | Contains scheduling preferences and constraints for finding
      | an available appointment slot.
    }
  }
  event ExamScheduledInRIS is  {
    orderId: ExamId
    accessionNumber: String
    scheduledDateTime: TimeStamp
    assignedModality: ModalityId
  } with {
    briefly "Examination has been scheduled in RIS"
    described as {
      | Confirmation that the RIS has created the appointment and
      | assigned resources.
    }
  }
  event WorklistUpdated is  {
    modalityId: ModalityId
    itemCount: Integer
    updatedAt: TimeStamp
  } with {
    briefly "Modality worklist has been updated"
    described as {
      |Notification that the worklist for a modality has changed.
    }
  }
  command ScheduleExamInRIS is  { request: RISIntegration.ScheduleRequest } with {
    briefly "Request exam scheduling in RIS"
    described as {
      | Send scheduling request to the RIS to find and book an
      | available appointment slot.
    }
  }
  command UpdateExamStatus is  {
    accessionNumber: String
    newStatus: ExamStatus
    updatedAt: TimeStamp
  } with {
    briefly "Update exam status in RIS"
    described as {
      | Synchronize exam status changes back to the RIS for reporting
      | and worklist management.
    }
  }
  command GetModalityWorklist is  {
    modalityAeTitle: String
    worklistStartDate: Date
    worklistEndDate: Date
  } with {
    briefly "Retrieve modality worklist"
    described as {
      | Request the scheduled procedure list for a specific modality
      | and date range.
    }
  }
} with {
  option external()
  briefly "Radiology Information System"
  described as {
    | The RIS manages radiology department operations including scheduling,
    | patient tracking, and reporting workflows. It maintains the modality
    | worklist (MWL) that imaging equipment queries to get patient and procedure
    | information. Integration uses HL7 v2 and DICOM MWL protocols.
  }
}
context SpeechRecognition is {
  type DictationSession is {
    sessionId: String
    examId: ExamId
    radiologistId: PhysicianId
    startedAt: TimeStamp
    templateId: String?
  } with {
    briefly "Active dictation session"
    described as {
      | Represents an active speech recognition session for creating
      | a radiology report.
    }
  }
  type TranscriptionResult is {
    sessionId: String
    rawText: String
    structuredSections: String
    confidence: Number
    durationSeconds: Integer
  } with {
    briefly "Result of speech-to-text transcription"
    described as {
      | Contains the transcribed text with confidence scores and
      | optional structured section parsing.
    }
  }
  event DictationStarted is  {
    sessionId: String
    examId: ExamId
    radiologistId: PhysicianId
    startedAt: TimeStamp
  } with {
    briefly "Dictation session has started"
    described as {
      |Notification that a radiologist has begun dictating a report.
    }
  }
  event DictationCompleted is  {
    sessionId: String
    examId: ExamId
    result: SpeechRecognition.TranscriptionResult
    completedAt: TimeStamp
  } with {
    briefly "Dictation session has completed"
    described as {
      | Notification that dictation is complete with transcription
      | results ready for review.
    }
  }
  event TranscriptionCorrected is  {
    sessionId: String
    originalText: String
    correctedText: String
    correctedAt: TimeStamp
  } with {
    briefly "Transcription has been corrected"
    described as {
      | Records corrections made to improve future recognition
      | accuracy.
    }
  }
  command StartDictation is  {
    examId: ExamId
    radiologistId: PhysicianId
    templateId: String?
  } with {
    briefly "Start a new dictation session"
    described as {
      | Initialize speech recognition for report creation with
      | optional template preloading.
    }
  }
  command EndDictation is  { sessionId: String } with {
    briefly "End dictation session"
    described as {
      | Complete the dictation and trigger final transcription
      | processing.
    }
  }
  command InsertMacro is  {
    sessionId: String
    macroId: String
    insertionPoint: Integer
  } with {
    briefly "Insert predefined text macro"
    described as {
      | Insert standard phrases or structured content at the current
      | dictation position.
    }
  }
} with {
  option external()
  briefly "Speech Recognition System"
  described as {
    | The speech recognition system provides real-time transcription of
    | radiologist dictation into structured reports. It integrates with the
    | reporting workflow to enable efficient report creation with voice commands,
    | macros, and automatic section parsing. Supports radiology-specific
    | vocabulary and abbreviations.
  }
}
