// External Contexts for Radiology Workflow
// Defines bounded contexts representing external systems that integrate with
// the radiology workflow

context PACSIntegration is {

  type ImageReference is {
    studyInstanceUid is String,
    seriesInstanceUid is String,
    sopInstanceUid is String,
    transferSyntax is String
  } with {
    briefly "Reference to a DICOM image in PACS"
    described by {
      | Contains DICOM UIDs needed to retrieve a specific image from
      | the Picture Archiving and Communication System.
    }
  }

  type StorageConfirmation is {
    studyInstanceUid is String,
    storedAt is TimeStamp,
    numberOfInstances is Integer,
    storageLocation is String
  } with {
    briefly "Confirmation of image storage in PACS"
    described by {
      | Acknowledgement that images have been successfully archived
      | in the PACS storage system.
    }
  }

  event ImagesStored is {
    studyId is StudyId,
    confirmation is PACSIntegration.StorageConfirmation
  } with {
    briefly "Images have been stored in PACS"
    described by {
      | Notification that acquired images are now available for
      | viewing and interpretation.
    }
  }

  event ImagesRetrieved is {
    studyId is StudyId,
    imageReferences is PACSIntegration.ImageReference*,
    retrievedAt is TimeStamp
  } with {
    briefly "Images have been retrieved from PACS"
    described by "Notification that images have been prefetched for viewing."
  }

  command StoreImages is {
    studyId is StudyId,
    modalityAeTitle is String,
    imageCount is Integer
  } with {
    briefly "Store images to PACS"
    described by "Request to archive images from an imaging modality to PACS."
  }

  command RetrieveImages is {
    studyId is StudyId,
    destinationAeTitle is String,
    priority is String
  } with {
    briefly "Retrieve images from PACS"
    described by "Request to fetch images for viewing on a workstation."
  }

  command PrefetchPriorStudies is {
    patientId is PatientId,
    modalityType is ModalityType,
    destinationAeTitle is String
  } with {
    briefly "Prefetch prior studies for comparison"
    described by {
      | Request to retrieve relevant prior studies before patient
      | arrival to speed interpretation workflow.
    }
  }

} with {
  option is external
  briefly "Picture Archiving and Communication System"
  described by {
    | The PACS provides long-term storage and retrieval of medical images in
    | DICOM format. It receives images from imaging modalities, archives them,
    | and makes them available to viewing workstations throughout the enterprise.
    | Integration uses DICOM protocols (C-STORE, C-FIND, C-MOVE, C-GET).
  }
}

context RISIntegration is {

  type WorklistItem is {
    accessionNumber is String,
    patientId is PatientId,
    patientName is String,
    scheduledProcedureStepId is String,
    scheduledDateTime is TimeStamp,
    modalityAeTitle is String,
    scheduledStationName is String,
    requestedProcedureDescription is String
  } with {
    briefly "Modality worklist item"
    described by {
      | Entry in the DICOM Modality Worklist used by imaging equipment
      | to retrieve patient and procedure information.
    }
  }

  type ScheduleRequest is {
    orderId is ExamId,
    patientId is PatientId,
    procedureCode is String,
    requestedDateTime is TimeStamp?,
    preferredModality is ModalityId?,
    duration is Duration
  } with {
    briefly "Request to schedule an examination"
    described by {
      | Contains scheduling preferences and constraints for finding
      | an available appointment slot.
    }
  }

  event ExamScheduledInRIS is {
    orderId is ExamId,
    accessionNumber is String,
    scheduledDateTime is TimeStamp,
    assignedModality is ModalityId
  } with {
    briefly "Examination has been scheduled in RIS"
    described by {
      | Confirmation that the RIS has created the appointment and
      | assigned resources.
    }
  }

  event WorklistUpdated is {
    modalityId is ModalityId,
    itemCount is Integer,
    updatedAt is TimeStamp
  } with {
    briefly "Modality worklist has been updated"
    described by "Notification that the worklist for a modality has changed."
  }

  command ScheduleExamInRIS is {
    request is RISIntegration.ScheduleRequest
  } with {
    briefly "Request exam scheduling in RIS"
    described by {
      | Send scheduling request to the RIS to find and book an
      | available appointment slot.
    }
  }

  command UpdateExamStatus is {
    accessionNumber is String,
    newStatus is ExamStatus,
    updatedAt is TimeStamp
  } with {
    briefly "Update exam status in RIS"
    described by {
      | Synchronize exam status changes back to the RIS for reporting
      | and worklist management.
    }
  }

  command GetModalityWorklist is {
    modalityAeTitle is String,
    worklistStartDate is Date,
    worklistEndDate is Date
  } with {
    briefly "Retrieve modality worklist"
    described by {
      | Request the scheduled procedure list for a specific modality
      | and date range.
    }
  }

} with {
  option is external
  briefly "Radiology Information System"
  described by {
    | The RIS manages radiology department operations including scheduling,
    | patient tracking, and reporting workflows. It maintains the modality
    | worklist (MWL) that imaging equipment queries to get patient and procedure
    | information. Integration uses HL7 v2 and DICOM MWL protocols.
  }
}

context SpeechRecognition is {

  type DictationSession is {
    sessionId is String,
    examId is ExamId,
    radiologistId is PhysicianId,
    startedAt is TimeStamp,
    templateId is String?
  } with {
    briefly "Active dictation session"
    described by {
      | Represents an active speech recognition session for creating
      | a radiology report.
    }
  }

  type TranscriptionResult is {
    sessionId is String,
    rawText is String,
    structuredSections is String,
    confidence is Number,
    durationSeconds is Integer
  } with {
    briefly "Result of speech-to-text transcription"
    described by {
      | Contains the transcribed text with confidence scores and
      | optional structured section parsing.
    }
  }

  event DictationStarted is {
    sessionId is String,
    examId is ExamId,
    radiologistId is PhysicianId,
    startedAt is TimeStamp
  } with {
    briefly "Dictation session has started"
    described by "Notification that a radiologist has begun dictating a report."
  }

  event DictationCompleted is {
    sessionId is String,
    examId is ExamId,
    result is SpeechRecognition.TranscriptionResult,
    completedAt is TimeStamp
  } with {
    briefly "Dictation session has completed"
    described by {
      | Notification that dictation is complete with transcription
      | results ready for review.
    }
  }

  event TranscriptionCorrected is {
    sessionId is String,
    originalText is String,
    correctedText is String,
    correctedAt is TimeStamp
  } with {
    briefly "Transcription has been corrected"
    described by {
      | Records corrections made to improve future recognition
      | accuracy.
    }
  }

  command StartDictation is {
    examId is ExamId,
    radiologistId is PhysicianId,
    templateId is String?
  } with {
    briefly "Start a new dictation session"
    described by {
      | Initialize speech recognition for report creation with
      | optional template preloading.
    }
  }

  command EndDictation is {
    sessionId is String
  } with {
    briefly "End dictation session"
    described by {
      | Complete the dictation and trigger final transcription
      | processing.
    }
  }

  command InsertMacro is {
    sessionId is String,
    macroId is String,
    insertionPoint is Integer
  } with {
    briefly "Insert predefined text macro"
    described by {
      | Insert standard phrases or structured content at the current
      | dictation position.
    }
  }

} with {
  option is external
  briefly "Speech Recognition System"
  described by {
    | The speech recognition system provides real-time transcription of
    | radiologist dictation into structured reports. It integrates with the
    | reporting workflow to enable efficient report creation with voice commands,
    | macros, and automatic section parsing. Supports radiology-specific
    | vocabulary and abbreviations.
  }
}
