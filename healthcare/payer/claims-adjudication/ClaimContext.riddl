// Claims Adjudication - Claim Context

context ClaimContext is {

  include "types.riddl"
  include "Claim.riddl"

  // Repository for claim persistence
  repository ClaimRepository is {
    schema ClaimData is relational
      of claims as Claim
      index on field Claim.claimId
      index on field Claim.member.memberId
      index on field Claim.provider.providerId

    handler ClaimPersistence is {
      on command Claim.SubmitClaim {
        prompt "Store new claim"
      }
      on command Claim.AdjudicateClaim {
        prompt "Update adjudication"
      }
      on command Claim.PendClaim {
        prompt "Update claim to pended"
      }
      on command Claim.ResolvePend {
        prompt "Update pend resolution"
      }
      on command Claim.ApproveClaim {
        prompt "Update claim to approved"
      }
      on command Claim.DenyClaim {
        prompt "Update claim to denied"
      }
      on command Claim.PayClaim {
        prompt "Update payment record"
      }
      on command Claim.AppealClaim {
        prompt "Store appeal"
      }
      on command Claim.ResolveAppeal {
        prompt "Update appeal resolution"
      }
      on command Claim.VoidClaim {
        prompt "Update claim to voided"
      }
    } with {
      briefly "Persists claim commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Claim data persistence"
    described by {
      | The ClaimRepository provides persistent storage for
      | claims, adjudication, and payment history.
    }
  }

  // Projector for claims analytics
  projector ClaimsAnalytics is {
    updates repository ClaimRepository

    record ClaimsStats is {
      totalClaims is Natural with { briefly "Total" described by "Total claims." }
      totalPaid is Decimal(18, 2) with { briefly "Paid" described by "Total paid." }
      approvalRate is Decimal(5, 4) with { briefly "Approval" described by "Approval rate." }
      denialRate is Decimal(5, 4) with { briefly "Denial" described by "Denial rate." }
      avgProcessingTime is Duration with { briefly "Avg time" described by "Average processing time." }
      pendRate is Decimal(5, 4) with { briefly "Pend rate" described by "Pend rate." }
    } with {
      briefly "Claims statistics"
      described by "Claims processing metrics."
    }

    handler AnalyticsHandler is {
      on event Claim.ClaimSubmitted {
        prompt "Update claim counts"
      }
      on event Claim.ClaimApproved {
        prompt "Update approval metrics"
      }
      on event Claim.ClaimDenied {
        prompt "Update denial metrics"
      }
      on event Claim.ClaimPaid {
        prompt "Update payment metrics"
      }
    } with {
      briefly "Maintains claims analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Claims analytics projections"
    described by "Maintains claims adjudication analytics data."
  }

} with {
  briefly "Bounded context for claims adjudication"
  described by {
    | The ClaimContext is the bounded context for
    | insurance claims processing and payment.
  }
}
