// Enrollment Context for Member Enrollment Domain
context EnrollmentContext is {
  include "types.riddl"
  include "Enrollment.riddl"
  include "external-contexts.riddl"
  repository EnrollmentRepository is {
    record EnrollmentRecord is  {
      enrollmentId: EnrollmentId with {
        briefly "Enrollment ID"
        described as {
          |Enrollment identifier.
        }
      }
      memberId: MemberId with {
        briefly "Member ID"
        described as {
          |Member identifier.
        }
      }
      memberInfo: MemberInfo with {
        briefly "Member info"
        described as {
          |Member information.
        }
      }
      selectedPlan: PlanSelection? with {
        briefly "Plan"
        described as {
          |Selected plan.
        }
      }
      verifiedEligibility: EligibilityInfo? with {
        briefly "Eligibility"
        described as {
          |Eligibility info.
        }
      }
      activeCoverage: CoverageInfo? with {
        briefly "Coverage"
        described as {
          |Coverage details.
        }
      }
      status: EnrollmentStatus with {
        briefly "Status"
        described as {
          |Current status.
        }
      }
      createdAt: DateTime with {
        briefly "Created"
        described as {
          |Creation timestamp.
        }
      }
      updatedAt: DateTime with {
        briefly "Updated"
        described as {
          |Last update timestamp.
        }
      }
    } with {
      briefly "Persistent enrollment record"
      described as {
        | Complete enrollment record stored in the repository
        | including all lifecycle data and current status.
      }
    }
    record EnrollmentQuery is  {
      memberId: MemberId? with {
        briefly "Member ID"
        described as {
          |Filter by member.
        }
      }
      planId: PlanId? with {
        briefly "Plan ID"
        described as {
          |Filter by plan.
        }
      }
      status: EnrollmentStatus? with {
        briefly "Status"
        described as {
          |Filter by status.
        }
      }
      effectiveDateFrom: Date? with {
        briefly "From date"
        described as {
          |Effective date start.
        }
      }
      effectiveDateTo: Date? with {
        briefly "To date"
        described as {
          |Effective date end.
        }
      }
    } with {
      briefly "Query parameters for enrollment search"
      described as {
        | Flexible query structure supporting search by member,
        | plan, status, and date range combinations.
      }
    }
    record PageInfo is  {
      pageNumber: Natural with {
        briefly "Page"
        described as {
          |Current page number.
        }
      }
      pageSize: Natural with {
        briefly "Size"
        described as {
          |Records per page.
        }
      }
      totalPages: Natural with {
        briefly "Total pages"
        described as {
          |Total page count.
        }
      }
    } with {
      briefly "Pagination metadata"
      described as {
        |Information about result pagination.
      }
    }
    query FindEnrollmentById is  {
      enrollmentId: EnrollmentId with {
        briefly "Enrollment ID"
        described as {
          |The enrollment to find.
        }
      }
    } with {
      briefly "Find enrollment by unique ID"
      described as {
        | Retrieves a single enrollment record by its unique
        | identifier for detailed view or processing.
      }
    }
    result EnrollmentResult is  {
      enrollment: EnrollmentRecord? with {
        briefly "Enrollment"
        described as {
          |The found enrollment, if any.
        }
      }
    } with {
      briefly "Single enrollment query result"
      described as {
        |Result containing optional enrollment record.
      }
    }
    query FindEnrollmentsByMember is  {
      memberId: MemberId with {
        briefly "Member ID"
        described as {
          |The member to find enrollments for.
        }
      }
    } with {
      briefly "Find all enrollments for a member"
      described as {
        | Retrieves enrollment history for a member including
        | current and past enrollments.
      }
    }
    result MemberEnrollmentsResult is  {
      enrollments: EnrollmentRecord+ with {
        briefly "Enrollments"
        described as {
          |List of member enrollments.
        }
      }
    } with {
      briefly "List of member enrollments"
      described as {
        |Result containing all enrollments for a member.
      }
    }
    query FindEnrollmentsByPlan is  {
      planId: PlanId with {
        briefly "Plan ID"
        described as {
          |The plan to find enrollments for.
        }
      }
      status: EnrollmentStatus? with {
        briefly "Status filter"
        described as {
          |Optional status filter.
        }
      }
    } with {
      briefly "Find enrollments for a specific plan"
      described as {
        | Retrieves all enrollments for a plan, optionally
        | filtered by status for plan performance analysis.
      }
    }
    result PlanEnrollmentsResult is  {
      enrollments: EnrollmentRecord+ with {
        briefly "Enrollments"
        described as {
          |List of plan enrollments.
        }
      }
      totalCount: Natural with {
        briefly "Total count"
        described as {
          |Total number of enrollments.
        }
      }
    } with {
      briefly "List of plan enrollments with count"
      described as {
        |Result containing enrollments for a plan.
      }
    }
    query SearchEnrollments is  {
      queryParams: EnrollmentQuery with {
        briefly "Query parameters"
        described as {
          |Search criteria.
        }
      }
    } with {
      briefly "Search enrollments with flexible criteria"
      described as {
        | Flexible search supporting multiple filter combinations
        | for reporting and member services.
      }
    }
    result SearchResult is  {
      enrollments: EnrollmentRecord+ with {
        briefly "Enrollments"
        described as {
          |Matching enrollments.
        }
      }
      totalCount: Natural with {
        briefly "Total count"
        described as {
          |Total matches.
        }
      }
      pageInfo: PageInfo with {
        briefly "Page info"
        described as {
          |Pagination details.
        }
      }
    } with {
      briefly "Paginated search results"
      described as {
        |Paginated enrollment search results.
      }
    }
    handler EnrollmentRepositoryHandler is {
      on query FindEnrollmentById is { ??? }
      on query FindEnrollmentsByMember is { ??? }
      on query FindEnrollmentsByPlan is { ??? }
      on query SearchEnrollments is { ??? }
    } with {
      briefly "Handles enrollment persistence operations"
      described as {
        | Provides query capabilities for enrollment records
        | supporting member services and reporting needs.
      }
    }
  } with {
    briefly "Enrollment data persistence"
    described as {
      | Repository for storing and querying enrollment records.
      | Supports member lookup, plan analysis, and flexible search
      | for operational and reporting purposes.
    }
  }
  projector EnrollmentMetrics is {
    record PlanEnrollmentCount is  {
      planId: PlanId with {
        briefly "Plan ID"
        described as {
          |Plan identifier.
        }
      }
      planName: String(1,100) with {
        briefly "Plan name"
        described as {
          |Plan name.
        }
      }
      activeCount: Natural with {
        briefly "Active"
        described as {
          |Active enrollments.
        }
      }
      pendingCount: Natural with {
        briefly "Pending"
        described as {
          |Pending enrollments.
        }
      }
    } with {
      briefly "Enrollment counts per plan"
      described as {
        |Aggregated enrollment counts for a plan.
      }
    }
    record PeriodEnrollmentCount is  {
      period: EnrollmentPeriod with {
        briefly "Period"
        described as {
          |Enrollment period.
        }
      }
      count: Natural with {
        briefly "Count"
        described as {
          |Number of enrollments.
        }
      }
      month: Natural with {
        briefly "Month"
        described as {
          |Month number.
        }
      }
      year: Natural with {
        briefly "Year"
        described as {
          |Year.
        }
      }
    } with {
      briefly "Enrollment counts per period"
      described as {
        |Aggregated enrollment counts by period.
      }
    }
    record MetricsState is  {
      totalEnrollments: Natural with {
        briefly "Total"
        described as {
          |Total enrollments.
        }
      }
      activeEnrollments: Natural with {
        briefly "Active"
        described as {
          |Active enrollments.
        }
      }
      pendingEnrollments: Natural with {
        briefly "Pending"
        described as {
          |Pending enrollments.
        }
      }
      terminatedEnrollments: Natural with {
        briefly "Terminated"
        described as {
          |Terminated enrollments.
        }
      }
      enrollmentsByPlan: PlanEnrollmentCount+ with {
        briefly "By plan"
        described as {
          |Counts by plan.
        }
      }
      enrollmentsByPeriod: PeriodEnrollmentCount+ with {
        briefly "By period"
        described as {
          |Counts by period.
        }
      }
      averageProcessingDays: Natural with {
        briefly "Avg processing"
        described as {
          |Average processing days.
        }
      }
      lastUpdated: DateTime with {
        briefly "Updated"
        described as {
          |Last update time.
        }
      }
    } with {
      briefly "Current enrollment metrics snapshot"
      described as {
        | Aggregated metrics for enrollment operations including
        | counts by status, plan, and period for dashboards.
      }
    }
    handler MetricsHandler is {
      on event Enrollment.EnrollmentInitiated is { ??? }
      on event Enrollment.EnrollmentConfirmed is { ??? }
      on event Enrollment.CoverageTerminated is { ??? }
      on event Enrollment.EnrollmentTransferred is { ??? }
    } with {
      briefly "Updates metrics on enrollment events"
      described as {
        | Processes enrollment lifecycle events to maintain
        | real-time metrics for operational dashboards.
      }
    }
  } with {
    briefly "Enrollment metrics projector"
    described as {
      | Maintains read-optimized view of enrollment metrics
      | for operational dashboards and executive reporting.
      | Updates in near real-time as enrollment events occur.
    }
  }
} with {
  briefly "Member enrollment bounded context"
  described as {
    | Primary bounded context for health plan member enrollment
    | operations. Manages enrollment lifecycle, eligibility
    | verification, plan selection, and coverage management.
    | Integrates with exchange systems, employer groups, and
    | benefits administration for end-to-end enrollment processing.
  }
}
