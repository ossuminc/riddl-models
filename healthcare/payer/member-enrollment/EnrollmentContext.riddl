// Enrollment Context for Member Enrollment Domain

context EnrollmentContext is {

  include "types.riddl"
  include "Enrollment.riddl"
  include "external-contexts.riddl"

  repository EnrollmentRepository is {

    record EnrollmentRecord is {
      enrollmentId is EnrollmentId with { briefly "Enrollment ID" described by "Enrollment identifier." }
      memberId is MemberId with { briefly "Member ID" described by "Member identifier." }
      memberInfo is MemberInfo with { briefly "Member info" described by "Member information." }
      selectedPlan is optional PlanSelection with { briefly "Plan" described by "Selected plan." }
      verifiedEligibility is optional EligibilityInfo with { briefly "Eligibility" described by "Eligibility info." }
      activeCoverage is optional CoverageInfo with { briefly "Coverage" described by "Coverage details." }
      status is EnrollmentStatus with { briefly "Status" described by "Current status." }
      createdAt is DateTime with { briefly "Created" described by "Creation timestamp." }
      updatedAt is DateTime with { briefly "Updated" described by "Last update timestamp." }
    } with {
      briefly "Persistent enrollment record"
      described by {
        | Complete enrollment record stored in the repository
        | including all lifecycle data and current status.
      }
    }

    record EnrollmentQuery is {
      memberId is optional MemberId with { briefly "Member ID" described by "Filter by member." }
      planId is optional PlanId with { briefly "Plan ID" described by "Filter by plan." }
      status is optional EnrollmentStatus with { briefly "Status" described by "Filter by status." }
      effectiveDateFrom is optional Date with { briefly "From date" described by "Effective date start." }
      effectiveDateTo is optional Date with { briefly "To date" described by "Effective date end." }
    } with {
      briefly "Query parameters for enrollment search"
      described by {
        | Flexible query structure supporting search by member,
        | plan, status, and date range combinations.
      }
    }

    record PageInfo is {
      pageNumber is Natural with { briefly "Page" described by "Current page number." }
      pageSize is Natural with { briefly "Size" described by "Records per page." }
      totalPages is Natural with { briefly "Total pages" described by "Total page count." }
    } with {
      briefly "Pagination metadata"
      described by "Information about result pagination."
    }

    query FindEnrollmentById is {
      enrollmentId is EnrollmentId with {
        briefly "Enrollment ID"
        described by "The enrollment to find."
      }
    } with {
      briefly "Find enrollment by unique ID"
      described by {
        | Retrieves a single enrollment record by its unique
        | identifier for detailed view or processing.
      }
    }

    result EnrollmentResult is {
      enrollment is optional EnrollmentRecord with {
        briefly "Enrollment"
        described by "The found enrollment, if any."
      }
    } with {
      briefly "Single enrollment query result"
      described by "Result containing optional enrollment record."
    }

    query FindEnrollmentsByMember is {
      memberId is MemberId with {
        briefly "Member ID"
        described by "The member to find enrollments for."
      }
    } with {
      briefly "Find all enrollments for a member"
      described by {
        | Retrieves enrollment history for a member including
        | current and past enrollments.
      }
    }

    result MemberEnrollmentsResult is {
      enrollments is many EnrollmentRecord with {
        briefly "Enrollments"
        described by "List of member enrollments."
      }
    } with {
      briefly "List of member enrollments"
      described by "Result containing all enrollments for a member."
    }

    query FindEnrollmentsByPlan is {
      planId is PlanId with {
        briefly "Plan ID"
        described by "The plan to find enrollments for."
      }
      status is optional EnrollmentStatus with {
        briefly "Status filter"
        described by "Optional status filter."
      }
    } with {
      briefly "Find enrollments for a specific plan"
      described by {
        | Retrieves all enrollments for a plan, optionally
        | filtered by status for plan performance analysis.
      }
    }

    result PlanEnrollmentsResult is {
      enrollments is many EnrollmentRecord with {
        briefly "Enrollments"
        described by "List of plan enrollments."
      }
      totalCount is Natural with {
        briefly "Total count"
        described by "Total number of enrollments."
      }
    } with {
      briefly "List of plan enrollments with count"
      described by "Result containing enrollments for a plan."
    }

    query SearchEnrollments is {
      queryParams is EnrollmentQuery with {
        briefly "Query parameters"
        described by "Search criteria."
      }
    } with {
      briefly "Search enrollments with flexible criteria"
      described by {
        | Flexible search supporting multiple filter combinations
        | for reporting and member services.
      }
    }

    result SearchResult is {
      enrollments is many EnrollmentRecord with {
        briefly "Enrollments"
        described by "Matching enrollments."
      }
      totalCount is Natural with {
        briefly "Total count"
        described by "Total matches."
      }
      pageInfo is PageInfo with {
        briefly "Page info"
        described by "Pagination details."
      }
    } with {
      briefly "Paginated search results"
      described by "Paginated enrollment search results."
    }

    handler EnrollmentRepositoryHandler is {
      on query FindEnrollmentById {
        ???
      }
      on query FindEnrollmentsByMember {
        ???
      }
      on query FindEnrollmentsByPlan {
        ???
      }
      on query SearchEnrollments {
        ???
      }
    } with {
      briefly "Handles enrollment persistence operations"
      described by {
        | Provides query capabilities for enrollment records
        | supporting member services and reporting needs.
      }
    }

  } with {
    briefly "Enrollment data persistence"
    described by {
      | Repository for storing and querying enrollment records.
      | Supports member lookup, plan analysis, and flexible search
      | for operational and reporting purposes.
    }
  }

  projector EnrollmentMetrics is {
    updates repository EnrollmentRepository

    record PlanEnrollmentCount is {
      planId is PlanId with { briefly "Plan ID" described by "Plan identifier." }
      planName is String(1, 100) with { briefly "Plan name" described by "Plan name." }
      activeCount is Natural with { briefly "Active" described by "Active enrollments." }
      pendingCount is Natural with { briefly "Pending" described by "Pending enrollments." }
    } with {
      briefly "Enrollment counts per plan"
      described by "Aggregated enrollment counts for a plan."
    }

    record PeriodEnrollmentCount is {
      period is EnrollmentPeriod with { briefly "Period" described by "Enrollment period." }
      count is Natural with { briefly "Count" described by "Number of enrollments." }
      month is Natural with { briefly "Month" described by "Month number." }
      year is Natural with { briefly "Year" described by "Year." }
    } with {
      briefly "Enrollment counts per period"
      described by "Aggregated enrollment counts by period."
    }

    record MetricsState is {
      totalEnrollments is Natural with { briefly "Total" described by "Total enrollments." }
      activeEnrollments is Natural with { briefly "Active" described by "Active enrollments." }
      pendingEnrollments is Natural with { briefly "Pending" described by "Pending enrollments." }
      terminatedEnrollments is Natural with { briefly "Terminated" described by "Terminated enrollments." }
      enrollmentsByPlan is many PlanEnrollmentCount with { briefly "By plan" described by "Counts by plan." }
      enrollmentsByPeriod is many PeriodEnrollmentCount with { briefly "By period" described by "Counts by period." }
      averageProcessingDays is Natural with { briefly "Avg processing" described by "Average processing days." }
      lastUpdated is DateTime with { briefly "Updated" described by "Last update time." }
    } with {
      briefly "Current enrollment metrics snapshot"
      described by {
        | Aggregated metrics for enrollment operations including
        | counts by status, plan, and period for dashboards.
      }
    }

    handler MetricsHandler is {
      on event Enrollment.EnrollmentInitiated {
        ???
      }
      on event Enrollment.EnrollmentConfirmed {
        ???
      }
      on event Enrollment.CoverageTerminated {
        ???
      }
      on event Enrollment.EnrollmentTransferred {
        ???
      }
    } with {
      briefly "Updates metrics on enrollment events"
      described by {
        | Processes enrollment lifecycle events to maintain
        | real-time metrics for operational dashboards.
      }
    }

  } with {
    briefly "Enrollment metrics projector"
    described by {
      | Maintains read-optimized view of enrollment metrics
      | for operational dashboards and executive reporting.
      | Updates in near real-time as enrollment events occur.
    }
  }

} with {
  briefly "Member enrollment bounded context"
  described by {
    | Primary bounded context for health plan member enrollment
    | operations. Manages enrollment lifecycle, eligibility
    | verification, plan selection, and coverage management.
    | Integrates with exchange systems, employer groups, and
    | benefits administration for end-to-end enrollment processing.
  }
}
