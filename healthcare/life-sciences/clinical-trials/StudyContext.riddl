// Study Management Bounded Context
context StudyContext is {
  include "ClinicalStudy.riddl"
  repository StudyRepository is {
    type StudyRecord is {
      studyId: StudyId
      protocol: StudyProtocol
      status: StudyStatus
      siteCount: Integer
      enrolledCount: Integer
      createdAt: DateTime
      lastModifiedAt: DateTime
    } with {
      briefly "Persistent study record"
      described as {
        |Database record for a clinical study with summary statistics.
      }
    }
    command StoreStudy is  { studyRecord: StudyRecord } with {
      briefly "Persist a study record"
      described as {
        |Saves or updates a study record in the repository.
      }
    }
    command DeleteStudy is  { studyId: StudyId } with {
      briefly "Remove a study record"
      described as {
        |Deletes a study record from the repository.
      }
    }
    query FindStudyById is  { studyId: StudyId } with {
      briefly "Retrieve study by ID"
      described as {
        |Fetches a single study record by its unique identifier.
      }
    }
    query FindStudiesByStatus is  { status: StudyStatus } with {
      briefly "Find studies by status"
      described as {
        |Returns all studies matching the specified operational status.
      }
    }
    query FindStudiesBySponsor is  { sponsorName: String } with {
      briefly "Find studies by sponsor"
      described as {
        |Returns all studies for a given sponsor organization.
      }
    }
    result StudyResult is  { foundRecord: StudyRecord? } with {
      briefly "Single study query result"
      described as {
        |Returns the requested study or empty if not found.
      }
    }
    result StudyListResult is  { studyRecords: StudyRecord* } with {
      briefly "Multiple study query result"
      described as {
        |Returns a list of studies matching query criteria.
      }
    }
    handler StudyRepositoryHandler is {
      on command StoreStudy is { ??? }
      on command DeleteStudy is { ??? }
      on query FindStudyById is { ??? }
      on query FindStudiesByStatus is { ??? }
      on query FindStudiesBySponsor is { ??? }
    } with {
      briefly "Repository command and query handler"
      described as {
        |Processes persistence operations for study records.
      }
    }
  } with {
    briefly "Persistence for clinical study data"
    described as {
      | The StudyRepository provides persistence and query capabilities for
      | clinical study records. It supports standard CRUD operations plus
      | queries for finding studies by various criteria.
    }
  }
  projector EnrollmentMetricsProjector is {
    record EnrollmentState is  {
      studyId: StudyId
      totalSites: Integer
      activeSites: Integer
      totalEnrolled: Integer
      enrollmentTarget: Integer
      enrollmentPercentage: Number
      screenFailureRate: Number
      averageEnrollmentPerSite: Number
      projectedCompletionDate: Date?
      lastUpdated: DateTime
    } with {
      briefly "Enrollment metrics state"
      described as {
        |Aggregated statistics about study enrollment progress and site performance.
      }
    }
    handler MetricsProjectorHandler is {
      on event ClinicalStudy.SubjectEnrolled is { ??? }
      on event ClinicalStudy.SiteActivated is { ??? }
      on event ClinicalStudy.StudyCreated is { ??? }
      on event ClinicalStudy.StudyClosed is { ??? }
    } with {
      briefly "Event handler for metrics projection"
      described as {
        |Processes clinical study events to maintain enrollment metrics.
      }
    }
  } with {
    briefly "Read model for enrollment analytics"
    described as {
      | The EnrollmentMetricsProjector maintains real-time enrollment
      | statistics by processing clinical study events. It provides
      | aggregated views of enrollment progress at both study and site
      | levels to support operational decision-making.
    }
  }
} with {
  briefly "Bounded context for clinical study operations"
  described as {
    | StudyContext is the core bounded context for clinical trial management.
    | It contains the ClinicalStudy aggregate, the StudyRepository for
    | persistence, and the EnrollmentMetricsProjector for analytics.
    | This context handles all study lifecycle operations from creation
    | through closeout.
  }
}
