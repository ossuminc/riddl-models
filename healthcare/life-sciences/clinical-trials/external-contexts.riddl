// External System Integrations
context EDCSystem is {
  type CRFData is {
    formId: String
    subjectId: SubjectId
    visitId: String
    formData: String
    enteredBy: String
    enteredAt: DateTime
    queryStatus: String
  } with {
    briefly "Case Report Form data from EDC"
    described as {
      |Structured clinical data captured in electronic case report forms.
    }
  }
  type DataQuery is {
    queryId: String
    formId: String
    subjectId: SubjectId
    fieldName: String
    queryText: String
    status: String
    openedAt: DateTime
    resolvedAt: DateTime?
  } with {
    briefly "Data clarification query"
    described as {
      |Query raised during data review requiring site response.
    }
  }
  event CRFSubmitted is  {
    formId: String
    subjectId: SubjectId
    visitId: String
    submittedAt: DateTime
  } with {
    briefly "CRF data was submitted"
    described as {
      |Indicates new or updated case report form data is available.
    }
  }
  event QueryOpened is  { query: DataQuery } with {
    briefly "A data query was opened"
    described as {
      |Indicates a data discrepancy requiring site clarification.
    }
  }
  event DataQueryResolved is  {
    queryId: String
    resolution: String
    resolvedAt: DateTime
  } with {
    briefly "A data query was resolved"
    described as {
      |Indicates a data query has been answered and closed.
    }
  }
} with {
  option external()
  briefly "Electronic Data Capture system integration"
  described as {
    | The EDCSystem represents the external Electronic Data Capture platform
    | used to collect clinical trial data. This context defines the interface
    | for receiving CRF submissions and data queries from the EDC vendor
    | system (e.g., Medidata Rave, Oracle Clinical, Veeva Vault).
  }
}
context CTMSIntegration is {
  type TrialMilestone is {
    milestoneId: String
    studyId: StudyId
    milestoneName: String
    plannedDate: Date
    actualDate: Date?
    status: String
  } with {
    briefly "Study milestone from CTMS"
    described as {
      |Key study milestone tracked in the Clinical Trial Management System.
    }
  }
  type SiteContract is {
    contractId: String
    siteId: SiteId
    studyId: StudyId
    contractStatus: String
    budgetAmount: Number
    executedDate: Date?
  } with {
    briefly "Site contract information"
    described as {
      |Contract and budget details for a trial site from CTMS.
    }
  }
  type PaymentRecord is {
    paymentId: String
    siteId: SiteId
    amount: Number
    paymentType: String
    processedDate: Date
  } with {
    briefly "Site payment record"
    described as {
      |Payment made to a site for clinical trial services.
    }
  }
  event MilestoneAchieved is  { milestone: TrialMilestone } with {
    briefly "A study milestone was achieved"
    described as {
      |Indicates a planned milestone has been completed.
    }
  }
  event ContractExecuted is  { contract: SiteContract } with {
    briefly "A site contract was executed"
    described as {
      |Indicates a site contract has been signed and is effective.
    }
  }
  event PaymentProcessed is  { payment: PaymentRecord } with {
    briefly "A site payment was processed"
    described as {
      |Indicates a payment has been made to a trial site.
    }
  }
} with {
  option external()
  briefly "Clinical Trial Management System integration"
  described as {
    | CTMSIntegration represents the external CTMS used for operational
    | trial management including milestone tracking, site contracts,
    | budgets, and payments. This context defines events received from
    | CTMS platforms (e.g., Oracle Siebel CTMS, Medidata CTMS, Veeva CTMS).
  }
}
context SafetyDatabase is {
  type AdverseEvent is {
    aeId: String
    subjectId: SubjectId
    studyId: StudyId
    eventTerm: String
    severity: String
    seriousness: String
    causality: String
    onsetDate: Date
    resolutionDate: Date?
    outcome: String
    reportedAt: DateTime
  } with {
    briefly "Adverse event record"
    described as {
      |Safety event experienced by a study subject requiring documentation and potential reporting.
    }
  }
  type SeriousAdverseEvent is {
    saeId: String
    aeId: String
    subjectId: SubjectId
    studyId: StudyId
    seriousnessCriteria: String*
    narrativeSummary: String
    regulatoryReportingRequired: Boolean
    reportingDeadline: DateTime?
    submittedToFda: Boolean
    fdaSubmissionDate: DateTime?
  } with {
    briefly "Serious adverse event requiring expedited reporting"
    described as {
      |Life-threatening or significant adverse event requiring expedited regulatory notification.
    }
  }
  event AdverseEventReported is  { adverseEvent: AdverseEvent } with {
    briefly "An adverse event was reported"
    described as {
      |Indicates a new adverse event has been documented in the safety database.
    }
  }
  event SAEReported is  { sae: SeriousAdverseEvent } with {
    briefly "A serious adverse event was reported"
    described as {
      |Indicates a serious adverse event requiring expedited assessment and potential regulatory reporting.
    }
  }
  event SAESubmittedToRegulator is  {
    saeId: String
    regulatoryBody: String
    submissionDate: DateTime
    reportType: String
  } with {
    briefly "SAE was submitted to regulatory authority"
    described as {
      |Indicates a serious adverse event report was filed with FDA or other regulatory body.
    }
  }
} with {
  option external()
  briefly "Safety database for adverse event tracking"
  described as {
    | SafetyDatabase represents the external pharmacovigilance system used
    | to track adverse events and serious adverse events. This context
    | defines events received from safety databases (e.g., Oracle Argus,
    | Veeva Vault Safety) for integration with clinical study data.
  }
}
