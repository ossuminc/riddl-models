// Clinical Encounter - External Contexts
// Patient Record Service
context PatientRecordService is {
  query GetPatient is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
  } with {
    briefly "Get patient"
    described as {
      |Retrieves patient record.
    }
  }
  result PatientRecord is  {
    patient: PatientInfo with {
      briefly "Patient"
      described as {
        |Patient info.
      }
    }
    allergies: String(1,200)* with {
      briefly "Allergies"
      described as {
        |Known allergies.
      }
    }
    medications: String(1,200)* with {
      briefly "Medications"
      described as {
        |Current medications.
      }
    }
    conditions: String(1,200)* with {
      briefly "Conditions"
      described as {
        |Active conditions.
      }
    }
  } with {
    briefly "Patient record"
    described as {
      |Patient health record.
    }
  }
} with {
  option external()
  briefly "External patient records"
  described as {
    |External EHR patient record service.
  }
}
// Order Entry Service
context OrderEntryService is {
  command SubmitOrder is  {
    encounterId: EncounterId with {
      briefly "Encounter"
      described as {
        |Encounter ID.
      }
    }
    order: EncounterOrder with {
      briefly "Order"
      described as {
        |Clinical order.
      }
    }
  } with {
    briefly "Submit order"
    described as {
      |Submits clinical order.
    }
  }
  event OrderSubmitted is  {
    orderId: UUID with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    encounterId: EncounterId with {
      briefly "Encounter"
      described as {
        |Encounter ID.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submit time.
      }
    }
  } with {
    briefly "Order submitted"
    described as {
      |Emitted when order is submitted.
    }
  }
} with {
  option external()
  briefly "External order entry"
  described as {
    |External CPOE system.
  }
}
// Billing Service
context BillingService is {
  command SubmitEncounterForBilling is  {
    encounterId: EncounterId with {
      briefly "Encounter"
      described as {
        |Encounter ID.
      }
    }
    billingDiagnoses: DiagnosisCode+ with {
      briefly "Diagnoses"
      described as {
        |Diagnosis codes.
      }
    }
    billingProcedures: ProcedureCode+ with {
      briefly "Procedures"
      described as {
        |Procedure codes.
      }
    }
  } with {
    briefly "Submit for billing"
    described as {
      |Submits encounter to billing.
    }
  }
  event BillingSubmitted is  {
    encounterId: EncounterId with {
      briefly "Encounter"
      described as {
        |Encounter ID.
      }
    }
    claimId: UUID with {
      briefly "Claim"
      described as {
        |Generated claim ID.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submit time.
      }
    }
  } with {
    briefly "Billing submitted"
    described as {
      |Emitted when sent to billing.
    }
  }
} with {
  option external()
  briefly "External billing"
  described as {
    |External billing/revenue cycle.
  }
}
// Scheduling Service
context SchedulingService is {
  command CheckInPatient is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    appointmentId: UUID with {
      briefly "Appointment"
      described as {
        |Appointment ID.
      }
    }
  } with {
    briefly "Check in patient"
    described as {
      |Checks in patient for appointment.
    }
  }
  event PatientCheckedIn is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    appointmentId: UUID with {
      briefly "Appointment"
      described as {
        |Appointment ID.
      }
    }
    checkedInAt: TimeStamp with {
      briefly "Checked in"
      described as {
        |Check-in time.
      }
    }
  } with {
    briefly "Patient checked in"
    described as {
      |Emitted when patient checks in.
    }
  }
} with {
  option external()
  briefly "External scheduling"
  described as {
    |External appointment scheduling.
  }
}
// Coding Service
context CodingService is {
  command SuggestCodes is  {
    encounterId: EncounterId with {
      briefly "Encounter"
      described as {
        |Encounter ID.
      }
    }
    clinicalText: String(1,10000) with {
      briefly "Text"
      described as {
        |Clinical documentation.
      }
    }
  } with {
    briefly "Suggest codes"
    described as {
      |Suggests diagnosis/procedure codes.
    }
  }
  event CodesSuggested is  {
    encounterId: EncounterId with {
      briefly "Encounter"
      described as {
        |Encounter ID.
      }
    }
    diagnosisCodes: DiagnosisCode+ with {
      briefly "Diagnoses"
      described as {
        |Suggested diagnoses.
      }
    }
    procedureCodes: ProcedureCode+ with {
      briefly "Procedures"
      described as {
        |Suggested procedures.
      }
    }
  } with {
    briefly "Codes suggested"
    described as {
      |Emitted when codes are suggested.
    }
  }
} with {
  option external()
  briefly "External coding"
  described as {
    |External coding assistance service.
  }
}
// Notification Service
context NotificationService is {
  command SendProviderAlert is  {
    providerId: ProviderId with {
      briefly "Provider"
      described as {
        |Provider ID.
      }
    }
    alertType: String(1,50) with {
      briefly "Type"
      described as {
        |Alert type.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Alert message.
      }
    }
  } with {
    briefly "Send alert"
    described as {
      |Sends provider alert.
    }
  }
  event AlertSent is  {
    alertId: UUID with {
      briefly "Alert"
      described as {
        |Alert ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Alert sent"
    described as {
      |Emitted when alert is delivered.
    }
  }
} with {
  option external()
  briefly "External notifications"
  described as {
    |External notification system.
  }
}
