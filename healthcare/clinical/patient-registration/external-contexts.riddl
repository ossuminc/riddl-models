// Patient Registration - External Contexts

// Identity Verification Service
context IdentityVerificationService is {

  command VerifyPatientIdentity is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    ssn is optional SSN with { briefly "SSN" described by "Social security number." }
    demographics is Demographics with { briefly "Demographics" described by "Patient demographics." }
  } with {
    briefly "Verify identity"
    described by "Verifies patient identity."
  }

  event IdentityVerified is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    verified is Boolean with { briefly "Verified" described by "Is identity verified." }
    confidenceScore is Decimal(5, 4) with { briefly "Score" described by "Verification confidence." }
  } with {
    briefly "Identity verified"
    described by "Emitted when verification completes."
  }

} with {
  option is external
  briefly "External identity verification"
  described by "External patient identity service."
}

// Insurance Eligibility Service
context InsuranceEligibilityService is {

  command CheckEligibility is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    insurance is InsuranceCoverage with { briefly "Insurance" described by "Insurance to verify." }
  } with {
    briefly "Check eligibility"
    described by "Checks insurance eligibility."
  }

  event EligibilityChecked is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    eligible is Boolean with { briefly "Eligible" described by "Is eligible." }
    effectiveDate is Date with { briefly "Effective" described by "Coverage effective date." }
    copay is optional Decimal(8, 2) with { briefly "Copay" described by "Patient copay." }
    deductible is optional Decimal(10, 2) with { briefly "Deductible" described by "Remaining deductible." }
  } with {
    briefly "Eligibility checked"
    described by "Emitted when eligibility is verified."
  }

} with {
  option is external
  briefly "External insurance eligibility"
  described by "External payer eligibility service."
}

// Master Patient Index Service
context MPIService is {

  command SearchMPI is {
    demographics is Demographics with { briefly "Demographics" described by "Search criteria." }
  } with {
    briefly "Search MPI"
    described by "Searches master patient index."
  }

  event MPISearchResults is {
    matchedPatients is many optional PatientId with { briefly "Matches" described by "Matched patients." }
    confidenceScores is many optional Decimal(5, 4) with { briefly "Scores" described by "Match scores." }
  } with {
    briefly "Search results"
    described by "Emitted when MPI search completes."
  }

  command LinkToMPI is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    enterpriseId is String(1, 50) with { briefly "Enterprise ID" described by "Enterprise patient ID." }
  } with {
    briefly "Link to MPI"
    described by "Links patient to enterprise MPI."
  }

  event LinkedToMPI is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    enterpriseId is String(1, 50) with { briefly "Enterprise ID" described by "Enterprise patient ID." }
    linkedAt is TimeStamp with { briefly "Linked" described by "Link time." }
  } with {
    briefly "Linked to MPI"
    described by "Emitted when linked to MPI."
  }

} with {
  option is external
  briefly "External MPI"
  described by "External master patient index."
}

// Document Storage Service
context DocumentStorageService is {

  command StorePatientDocument is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    documentType is String(1, 50) with { briefly "Type" described by "Document type." }
    documentUrl is URL with { briefly "URL" described by "Document location." }
  } with {
    briefly "Store document"
    described by "Stores patient document."
  }

  event DocumentStored is {
    documentId is UUID with { briefly "Document" described by "Document ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    storedAt is TimeStamp with { briefly "Stored" described by "Storage time." }
  } with {
    briefly "Document stored"
    described by "Emitted when document is stored."
  }

} with {
  option is external
  briefly "External document storage"
  described by "External document management system."
}

// Notification Service
context NotificationService is {

  command SendPatientNotification is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    message is String(1, 1000) with { briefly "Message" described by "Message content." }
    channel is String(1, 20) with { briefly "Channel" described by "Delivery channel." }
  } with {
    briefly "Send notification"
    described by "Sends patient notification."
  }

  event NotificationSent is {
    notificationId is UUID with { briefly "Notification" described by "Notification ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification sent"
    described by "Emitted when notification is delivered."
  }

} with {
  option is external
  briefly "External notifications"
  described by "External notification system."
}
