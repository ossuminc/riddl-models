// Appointment Scheduling - External Contexts
// Patient Service
context PatientService is {
  query GetPatientInfo is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
  } with {
    briefly "Get patient"
    described as {
      |Retrieves patient information.
    }
  }
  result PatientInfo is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    firstName: String(1,100) with {
      briefly "First"
      described as {
        |First name.
      }
    }
    lastName: String(1,100) with {
      briefly "Last"
      described as {
        |Last name.
      }
    }
    phone: String(10,15) with {
      briefly "Phone"
      described as {
        |Phone number.
      }
    }
    email: String(5,254)? with {
      briefly "Email"
      described as {
        |Email address.
      }
    }
  } with {
    briefly "Patient info"
    described as {
      |Patient contact information.
    }
  }
} with {
  option external()
  briefly "External patient service"
  described as {
    |External patient record service.
  }
}
// Provider Schedule Service
context ProviderScheduleService is {
  query GetAvailability is  {
    providerId: ProviderId with {
      briefly "Provider"
      described as {
        |Provider ID.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Start date.
      }
    }
    endDate: Date with {
      briefly "End"
      described as {
        |End date.
      }
    }
  } with {
    briefly "Get availability"
    described as {
      |Retrieves provider availability.
    }
  }
  result AvailabilityResult is  {
    providerId: ProviderId with {
      briefly "Provider"
      described as {
        |Provider ID.
      }
    }
    schedules: ProviderSchedule+ with {
      briefly "Schedules"
      described as {
        |Available schedules.
      }
    }
  } with {
    briefly "Availability"
    described as {
      |Provider availability data.
    }
  }
  command BlockTime is  {
    providerId: ProviderId with {
      briefly "Provider"
      described as {
        |Provider ID.
      }
    }
    startTime: TimeStamp with {
      briefly "Start"
      described as {
        |Block start.
      }
    }
    endTime: TimeStamp with {
      briefly "End"
      described as {
        |Block end.
      }
    }
    blockReason: String(1,200) with {
      briefly "Reason"
      described as {
        |Block reason.
      }
    }
  } with {
    briefly "Block time"
    described as {
      |Blocks provider time.
    }
  }
  event TimeBlocked is  {
    providerId: ProviderId with {
      briefly "Provider"
      described as {
        |Provider ID.
      }
    }
    startTime: TimeStamp with {
      briefly "Start"
      described as {
        |Block start.
      }
    }
    endTime: TimeStamp with {
      briefly "End"
      described as {
        |Block end.
      }
    }
  } with {
    briefly "Time blocked"
    described as {
      |Emitted when time is blocked.
    }
  }
} with {
  option external()
  briefly "External schedule service"
  described as {
    |External provider schedule service.
  }
}
// Reminder Service
context ReminderService is {
  command SendReminder is  {
    appointmentId: AppointmentId with {
      briefly "Appointment"
      described as {
        |Appointment ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    appointmentTime: TimeStamp with {
      briefly "Time"
      described as {
        |Appointment time.
      }
    }
    settings: ReminderSettings with {
      briefly "Settings"
      described as {
        |Reminder settings.
      }
    }
  } with {
    briefly "Send reminder"
    described as {
      |Sends appointment reminder.
    }
  }
  event ReminderSent is  {
    appointmentId: AppointmentId with {
      briefly "Appointment"
      described as {
        |Appointment ID.
      }
    }
    channel: String(1,20) with {
      briefly "Channel"
      described as {
        |Delivery channel.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Reminder sent"
    described as {
      |Emitted when reminder is sent.
    }
  }
} with {
  option external()
  briefly "External reminder service"
  described as {
    |External appointment reminder service.
  }
}
// Waitlist Service
context WaitlistService is {
  command AddToWaitlist is  {
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    providerId: ProviderId with {
      briefly "Provider"
      described as {
        |Provider ID.
      }
    }
    appointmentType: AppointmentType with {
      briefly "Type"
      described as {
        |Appointment type.
      }
    }
    preferredTimes: String(1,50)+ with {
      briefly "Times"
      described as {
        |Preferred times.
      }
    }
  } with {
    briefly "Add to waitlist"
    described as {
      |Adds patient to appointment waitlist.
    }
  }
  event AddedToWaitlist is  {
    waitlistId: UUID with {
      briefly "Waitlist"
      described as {
        |Waitlist entry ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Addition time.
      }
    }
  } with {
    briefly "Added to waitlist"
    described as {
      |Emitted when added to waitlist.
    }
  }
  event SlotAvailable is  {
    waitlistId: UUID with {
      briefly "Waitlist"
      described as {
        |Waitlist entry ID.
      }
    }
    availableSlot: TimeSlot with {
      briefly "Slot"
      described as {
        |Available slot.
      }
    }
  } with {
    briefly "Slot available"
    described as {
      |Emitted when slot becomes available.
    }
  }
} with {
  option external()
  briefly "External waitlist"
  described as {
    |External appointment waitlist service.
  }
}
// Notification Service
context NotificationService is {
  command SendAppointmentNotification is  {
    appointmentId: AppointmentId with {
      briefly "Appointment"
      described as {
        |Appointment ID.
      }
    }
    patientId: PatientId with {
      briefly "Patient"
      described as {
        |Patient ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    message: String(1,1000) with {
      briefly "Message"
      described as {
        |Message content.
      }
    }
  } with {
    briefly "Send notification"
    described as {
      |Sends appointment notification.
    }
  }
  event NotificationSent is  {
    notificationId: UUID with {
      briefly "Notification"
      described as {
        |Notification ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Notification sent"
    described as {
      |Emitted when notification is sent.
    }
  }
} with {
  option external()
  briefly "External notifications"
  described as {
    |External notification system.
  }
}
