// Appointment Scheduling - External Contexts

// Patient Service
context PatientService is {

  query GetPatientInfo is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
  } with {
    briefly "Get patient"
    described by "Retrieves patient information."
  }

  result PatientInfo is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    firstName is String(1, 100) with { briefly "First" described by "First name." }
    lastName is String(1, 100) with { briefly "Last" described by "Last name." }
    phone is String(10, 15) with { briefly "Phone" described by "Phone number." }
    email is optional String(5, 254) with { briefly "Email" described by "Email address." }
  } with {
    briefly "Patient info"
    described by "Patient contact information."
  }

} with {
  option is external
  briefly "External patient service"
  described by "External patient record service."
}

// Provider Schedule Service
context ProviderScheduleService is {

  query GetAvailability is {
    providerId is ProviderId with { briefly "Provider" described by "Provider ID." }
    startDate is Date with { briefly "Start" described by "Start date." }
    endDate is Date with { briefly "End" described by "End date." }
  } with {
    briefly "Get availability"
    described by "Retrieves provider availability."
  }

  result AvailabilityResult is {
    providerId is ProviderId with { briefly "Provider" described by "Provider ID." }
    schedules is many ProviderSchedule with { briefly "Schedules" described by "Available schedules." }
  } with {
    briefly "Availability"
    described by "Provider availability data."
  }

  command BlockTime is {
    providerId is ProviderId with { briefly "Provider" described by "Provider ID." }
    startTime is TimeStamp with { briefly "Start" described by "Block start." }
    endTime is TimeStamp with { briefly "End" described by "Block end." }
    blockReason is String(1, 200) with { briefly "Reason" described by "Block reason." }
  } with {
    briefly "Block time"
    described by "Blocks provider time."
  }

  event TimeBlocked is {
    providerId is ProviderId with { briefly "Provider" described by "Provider ID." }
    startTime is TimeStamp with { briefly "Start" described by "Block start." }
    endTime is TimeStamp with { briefly "End" described by "Block end." }
  } with {
    briefly "Time blocked"
    described by "Emitted when time is blocked."
  }

} with {
  option is external
  briefly "External schedule service"
  described by "External provider schedule service."
}

// Reminder Service
context ReminderService is {

  command SendReminder is {
    appointmentId is AppointmentId with { briefly "Appointment" described by "Appointment ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    appointmentTime is TimeStamp with { briefly "Time" described by "Appointment time." }
    settings is ReminderSettings with { briefly "Settings" described by "Reminder settings." }
  } with {
    briefly "Send reminder"
    described by "Sends appointment reminder."
  }

  event ReminderSent is {
    appointmentId is AppointmentId with { briefly "Appointment" described by "Appointment ID." }
    channel is String(1, 20) with { briefly "Channel" described by "Delivery channel." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Reminder sent"
    described by "Emitted when reminder is sent."
  }

} with {
  option is external
  briefly "External reminder service"
  described by "External appointment reminder service."
}

// Waitlist Service
context WaitlistService is {

  command AddToWaitlist is {
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    providerId is ProviderId with { briefly "Provider" described by "Provider ID." }
    appointmentType is AppointmentType with { briefly "Type" described by "Appointment type." }
    preferredTimes is many String(1, 50) with { briefly "Times" described by "Preferred times." }
  } with {
    briefly "Add to waitlist"
    described by "Adds patient to appointment waitlist."
  }

  event AddedToWaitlist is {
    waitlistId is UUID with { briefly "Waitlist" described by "Waitlist entry ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    addedAt is TimeStamp with { briefly "Added" described by "Addition time." }
  } with {
    briefly "Added to waitlist"
    described by "Emitted when added to waitlist."
  }

  event SlotAvailable is {
    waitlistId is UUID with { briefly "Waitlist" described by "Waitlist entry ID." }
    availableSlot is TimeSlot with { briefly "Slot" described by "Available slot." }
  } with {
    briefly "Slot available"
    described by "Emitted when slot becomes available."
  }

} with {
  option is external
  briefly "External waitlist"
  described by "External appointment waitlist service."
}

// Notification Service
context NotificationService is {

  command SendAppointmentNotification is {
    appointmentId is AppointmentId with { briefly "Appointment" described by "Appointment ID." }
    patientId is PatientId with { briefly "Patient" described by "Patient ID." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    message is String(1, 1000) with { briefly "Message" described by "Message content." }
  } with {
    briefly "Send notification"
    described by "Sends appointment notification."
  }

  event NotificationSent is {
    notificationId is UUID with { briefly "Notification" described by "Notification ID." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Notification sent"
    described by "Emitted when notification is sent."
  }

} with {
  option is external
  briefly "External notifications"
  described by "External notification system."
}
