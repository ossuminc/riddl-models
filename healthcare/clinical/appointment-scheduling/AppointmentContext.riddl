// Appointment Scheduling - Appointment Context
context AppointmentContext is {
  include "types.riddl"
  include "Appointment.riddl"
  // Repository for appointment persistence
  repository AppointmentRepository is {
    schema AppointmentData is relational
      of appointments as type Appointment
        index on field Appointment.appointmentId
        index on field Appointment.patientId
        index on field Appointment.providerId

    handler AppointmentPersistence is {
      on command Appointment.ScheduleAppointment is {
        prompt "Store new appointment"
      }
      on command Appointment.ConfirmAppointment is {
        prompt "Update confirmation status"
      }
      on command Appointment.RescheduleAppointment is {
        prompt "Update appointment time"
      }
      on command Appointment.CancelAppointment is {
        prompt "Update appointment to canceled"
      }
      on command Appointment.CheckInPatient is {
        prompt "Update check-in status"
      }
      on command Appointment.StartAppointment is {
        prompt "Update start time"
      }
      on command Appointment.CompleteAppointment is {
        prompt "Update appointment to complete"
      }
      on command Appointment.MarkNoShow is {
        prompt "Update appointment as no-show"
      }
    } with {
      briefly "Persists appointment commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Appointment data persistence"
    described as {
      | The AppointmentRepository provides persistent storage for
      | patient appointments and schedule data.
    }
  }
  // Projector for scheduling analytics
  projector SchedulingAnalytics is {
    record SchedulingStats is  {
      totalAppointments: Natural with {
        briefly "Total"
        described as {
          |Total appointments.
        }
      }
      completedAppointments: Natural with {
        briefly "Completed"
        described as {
          |Completed appointments.
        }
      }
      noShowRate: Decimal(5,4) with {
        briefly "No-show rate"
        described as {
          |No-show rate.
        }
      }
      cancellationRate: Decimal(5,4) with {
        briefly "Cancel rate"
        described as {
          |Cancellation rate.
        }
      }
      avgWaitTime: Duration with {
        briefly "Avg wait"
        described as {
          |Average wait time.
        }
      }
      utilizationRate: Decimal(5,4) with {
        briefly "Utilization"
        described as {
          |Schedule utilization.
        }
      }
    } with {
      briefly "Scheduling statistics"
      described as {
        |Appointment scheduling metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Appointment.AppointmentScheduled is {
        prompt "Update appointment counts"
      }
      on event Appointment.AppointmentCompleted is {
        prompt "Update completion metrics"
      }
      on event Appointment.PatientNoShow is {
        prompt "Update no-show metrics"
      }
      on event Appointment.AppointmentCanceled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains scheduling analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Scheduling analytics projections"
    described as {
      |Maintains appointment scheduling analytics data.
    }
  }
} with {
  briefly "Bounded context for appointment scheduling"
  described as {
    | The AppointmentContext is the bounded context for
    | patient appointment booking and schedule management.
  }
}
