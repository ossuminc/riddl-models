// Fleet Management - External Contexts
// GPS Tracking Service
context GpsTrackingService is {
  command StartTracking is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    deviceId: String(1,50) with {
      briefly "Device"
      described as {
        |GPS device ID.
      }
    }
  } with {
    briefly "Start tracking"
    described as {
      |Starts GPS tracking.
    }
  }
  event TrackingStarted is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    startedAt: TimeStamp with {
      briefly "Started"
      described as {
        |Start time.
      }
    }
  } with {
    briefly "Tracking started"
    described as {
      |Emitted when tracking starts.
    }
  }
  event LocationReceived is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    location: GpsLocation with {
      briefly "Location"
      described as {
        |GPS location.
      }
    }
  } with {
    briefly "Location received"
    described as {
      |Emitted when location is received.
    }
  }
  command StopTracking is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
  } with {
    briefly "Stop tracking"
    described as {
      |Stops GPS tracking.
    }
  }
  event TrackingStopped is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    stoppedAt: TimeStamp with {
      briefly "Stopped"
      described as {
        |Stop time.
      }
    }
  } with {
    briefly "Tracking stopped"
    described as {
      |Emitted when tracking stops.
    }
  }
} with {
  option external()
  briefly "External GPS tracking"
  described as {
    |External telematics service.
  }
}
// Fuel Card Service
context FuelCardService is {
  command AuthorizeFuelPurchase is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    cardNumber: String(1,20) with {
      briefly "Card"
      described as {
        |Fuel card number.
      }
    }
    stationId: String(1,50) with {
      briefly "Station"
      described as {
        |Fuel station ID.
      }
    }
  } with {
    briefly "Authorize purchase"
    described as {
      |Authorizes fuel purchase.
    }
  }
  event FuelPurchaseAuthorized is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    authorizationCode: String(1,50) with {
      briefly "Code"
      described as {
        |Authorization code.
      }
    }
    authorizedAt: TimeStamp with {
      briefly "Authorized"
      described as {
        |Authorization time.
      }
    }
  } with {
    briefly "Fuel purchase authorized"
    described as {
      |Emitted when purchase is authorized.
    }
  }
  event FuelPurchaseCompleted is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    purchaseAmount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Purchase amount.
      }
    }
    gallons: Decimal(8,3) with {
      briefly "Gallons"
      described as {
        |Gallons purchased.
      }
    }
    stationName: String(1,200) with {
      briefly "Station"
      described as {
        |Station name.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Fuel purchase completed"
    described as {
      |Emitted when purchase completes.
    }
  }
} with {
  option external()
  briefly "External fuel card"
  described as {
    |External fuel card service.
  }
}
// Maintenance Service Provider
context MaintenanceServiceProvider is {
  query GetAvailableSlots is  {
    serviceType: MaintenanceType with {
      briefly "Type"
      described as {
        |Service type.
      }
    }
    preferredDate: Date with {
      briefly "Date"
      described as {
        |Preferred date.
      }
    }
    serviceLocation: String(1,200) with {
      briefly "Location"
      described as {
        |Service location.
      }
    }
  } with {
    briefly "Get available slots"
    described as {
      |Retrieves available service slots.
    }
  }
  result AvailableSlots is  {
    slots: TimeStamp+ with {
      briefly "Slots"
      described as {
        |Available slots.
      }
    }
  } with {
    briefly "Available slots"
    described as {
      |List of available times.
    }
  }
  command BookService is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    maintenanceId: MaintenanceId with {
      briefly "Maintenance"
      described as {
        |Maintenance ID.
      }
    }
    appointmentTime: TimeStamp with {
      briefly "Time"
      described as {
        |Appointment time.
      }
    }
  } with {
    briefly "Book service"
    described as {
      |Books service appointment.
    }
  }
  event ServiceBooked is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    confirmationNumber: String(1,50) with {
      briefly "Confirmation"
      described as {
        |Confirmation number.
      }
    }
    appointmentTime: TimeStamp with {
      briefly "Time"
      described as {
        |Appointment time.
      }
    }
    bookedAt: TimeStamp with {
      briefly "Booked"
      described as {
        |Booking time.
      }
    }
  } with {
    briefly "Service booked"
    described as {
      |Emitted when service is booked.
    }
  }
  event ServiceCompleted is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    maintenanceId: MaintenanceId with {
      briefly "Maintenance"
      described as {
        |Maintenance ID.
      }
    }
    workPerformed: String(1,2000) with {
      briefly "Work"
      described as {
        |Work performed.
      }
    }
    cost: Decimal(10,2) with {
      briefly "Cost"
      described as {
        |Service cost.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Service completed"
    described as {
      |Emitted when service completes.
    }
  }
} with {
  option external()
  briefly "External maintenance service"
  described as {
    |External service provider.
  }
}
// Driver Management Service
context DriverManagementService is {
  query GetDriverInfo is  {
    driverId: DriverId with {
      briefly "Driver"
      described as {
        |Driver ID.
      }
    }
  } with {
    briefly "Get driver info"
    described as {
      |Retrieves driver information.
    }
  }
  result DriverDetails is  {
    driver: DriverInfo with {
      briefly "Driver"
      described as {
        |Driver info.
      }
    }
    hoursWorked: Natural with {
      briefly "Hours"
      described as {
        |Hours worked this week.
      }
    }
    safetyScore: Decimal(5,2) with {
      briefly "Safety"
      described as {
        |Safety score.
      }
    }
  } with {
    briefly "Driver details"
    described as {
      |Full driver information.
    }
  }
  query GetAvailableDrivers is  {
    vehicleType: VehicleType with {
      briefly "Type"
      described as {
        |Vehicle type.
      }
    }
    startTime: TimeStamp with {
      briefly "Start"
      described as {
        |Availability start.
      }
    }
  } with {
    briefly "Get available drivers"
    described as {
      |Retrieves available drivers.
    }
  }
  result AvailableDrivers is  {
    drivers: DriverInfo+ with {
      briefly "Drivers"
      described as {
        |Available drivers.
      }
    }
  } with {
    briefly "Available drivers"
    described as {
      |List of available drivers.
    }
  }
  command LogDrivingHours is  {
    driverId: DriverId with {
      briefly "Driver"
      described as {
        |Driver ID.
      }
    }
    tripId: TripId with {
      briefly "Trip"
      described as {
        |Trip ID.
      }
    }
    hours: Decimal(5,2) with {
      briefly "Hours"
      described as {
        |Hours driven.
      }
    }
  } with {
    briefly "Log driving hours"
    described as {
      |Logs hours of service.
    }
  }
  event DrivingHoursLogged is  {
    driverId: DriverId with {
      briefly "Driver"
      described as {
        |Driver ID.
      }
    }
    hours: Decimal(5,2) with {
      briefly "Hours"
      described as {
        |Hours logged.
      }
    }
    loggedAt: TimeStamp with {
      briefly "Logged"
      described as {
        |Log time.
      }
    }
  } with {
    briefly "Driving hours logged"
    described as {
      |Emitted when hours are logged.
    }
  }
} with {
  option external()
  briefly "External driver management"
  described as {
    |External driver service.
  }
}
// Alert Notification Service
context AlertNotificationService is {
  command SendAlert is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    alert: Alert with {
      briefly "Alert"
      described as {
        |Alert details.
      }
    }
    recipients: String(5,254)+ with {
      briefly "Recipients"
      described as {
        |Alert recipients.
      }
    }
  } with {
    briefly "Send alert"
    described as {
      |Sends alert notification.
    }
  }
  event AlertSent is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    alertId: UUID with {
      briefly "Alert"
      described as {
        |Alert ID.
      }
    }
    recipientCount: Natural with {
      briefly "Recipients"
      described as {
        |Number notified.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Alert sent"
    described as {
      |Emitted when alert is sent.
    }
  }
  command SendMaintenanceReminder is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    maintenanceTypeName: String(1,50) with {
      briefly "Type"
      described as {
        |Maintenance type.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due date.
      }
    }
    recipients: String(5,254)+ with {
      briefly "Recipients"
      described as {
        |Reminder recipients.
      }
    }
  } with {
    briefly "Send maintenance reminder"
    described as {
      |Sends maintenance reminder.
    }
  }
  event MaintenanceReminderSent is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Maintenance reminder sent"
    described as {
      |Emitted when reminder is sent.
    }
  }
} with {
  option external()
  briefly "External alert notifications"
  described as {
    |External notification service.
  }
}
// Insurance Service
context InsuranceService is {
  query GetVehicleCoverage is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
  } with {
    briefly "Get vehicle coverage"
    described as {
      |Retrieves insurance coverage.
    }
  }
  result VehicleCoverage is  {
    policyNumber: String(1,50) with {
      briefly "Policy"
      described as {
        |Policy number.
      }
    }
    coverageType: String(1,100) with {
      briefly "Coverage"
      described as {
        |Coverage type.
      }
    }
    expirationDate: Date with {
      briefly "Expiration"
      described as {
        |Policy expiration.
      }
    }
    deductible: Decimal(10,2) with {
      briefly "Deductible"
      described as {
        |Deductible amount.
      }
    }
  } with {
    briefly "Vehicle coverage"
    described as {
      |Insurance coverage details.
    }
  }
  command FileIncidentReport is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    incidentDate: Date with {
      briefly "Date"
      described as {
        |Incident date.
      }
    }
    description: String(1,2000) with {
      briefly "Description"
      described as {
        |Incident description.
      }
    }
    driverInfo: DriverInfo with {
      briefly "Driver"
      described as {
        |Driver involved.
      }
    }
  } with {
    briefly "File incident report"
    described as {
      |Files insurance incident.
    }
  }
  event IncidentReportFiled is  {
    vehicleId: VehicleId with {
      briefly "Vehicle"
      described as {
        |Vehicle ID.
      }
    }
    claimNumber: String(1,50) with {
      briefly "Claim"
      described as {
        |Claim number.
      }
    }
    filedAt: TimeStamp with {
      briefly "Filed"
      described as {
        |Filing time.
      }
    }
  } with {
    briefly "Incident report filed"
    described as {
      |Emitted when incident is filed.
    }
  }
} with {
  option external()
  briefly "External insurance service"
  described as {
    |External insurance provider.
  }
}
