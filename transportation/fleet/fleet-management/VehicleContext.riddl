// Fleet Management - Vehicle Context

context VehicleContext is {

  include "types.riddl"
  include "Vehicle.riddl"

  // Repository for vehicle persistence
  repository VehicleRepository is {
    schema VehicleData is relational
      of vehicles as Vehicle
      index on field Vehicle.vehicleId
      index on field Vehicle.vehicleInfo.licensePlate
      index on field Vehicle.assignedDriver.driverId
      index on field Vehicle.status

    handler VehiclePersistence is {
      on command Vehicle.RegisterVehicle {
        prompt "Store new vehicle"
      }
      on command Vehicle.UpdateLocation {
        prompt "Update vehicle location"
      }
      on command Vehicle.UpdateOdometer {
        prompt "Update odometer reading"
      }
      on command Vehicle.UpdateFuelLevel {
        prompt "Update fuel level"
      }
      on command Vehicle.AssignDriver {
        prompt "Store driver assignment"
      }
      on command Vehicle.UnassignDriver {
        prompt "Remove driver assignment"
      }
      on command Vehicle.StartTrip {
        prompt "Store trip start"
      }
      on command Vehicle.EndTrip {
        prompt "Store trip end"
      }
      on command Vehicle.ScheduleMaintenance {
        prompt "Store maintenance schedule"
      }
      on command Vehicle.StartMaintenance {
        prompt "Update maintenance to started"
      }
      on command Vehicle.CompleteMaintenance {
        prompt "Update maintenance to completed"
      }
      on command Vehicle.RaiseAlert {
        prompt "Store alert"
      }
      on command Vehicle.AcknowledgeAlert {
        prompt "Update alert acknowledgment"
      }
      on command Vehicle.DecommissionVehicle {
        prompt "Update to decommissioned"
      }
    } with {
      briefly "Persists vehicle commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Vehicle data persistence"
    described by {
      | The VehicleRepository provides persistent storage for
      | vehicles and related data.
    }
  }

  // Projector for fleet analytics
  projector FleetAnalytics is {
    updates repository VehicleRepository

    record FleetStats is {
      totalVehicles is Natural with { briefly "Total" described by "Total vehicles." }
      availableVehicles is Natural with { briefly "Available" described by "Available vehicles." }
      inUseVehicles is Natural with { briefly "In use" described by "Vehicles in use." }
      inMaintenanceVehicles is Natural with { briefly "In maintenance" described by "In maintenance." }
      totalMileage is Natural with { briefly "Mileage" described by "Total fleet mileage." }
      maintenanceCosts is Decimal(12, 2) with { briefly "Maintenance costs" described by "Total maintenance costs." }
      activeAlertCount is Natural with { briefly "Alerts" described by "Active alert count." }
    } with {
      briefly "Fleet statistics"
      described by "Fleet operational metrics."
    }

    handler AnalyticsHandler is {
      on event Vehicle.VehicleRegistered {
        prompt "Update vehicle counts"
      }
      on event Vehicle.TripStarted {
        prompt "Update in-use counts"
      }
      on event Vehicle.TripEnded {
        prompt "Update mileage and availability"
      }
      on event Vehicle.MaintenanceCompleted {
        prompt "Update maintenance costs"
      }
      on event Vehicle.AlertRaised {
        prompt "Update alert counts"
      }
      on event Vehicle.AlertAcknowledged {
        prompt "Update acknowledged alerts"
      }
    } with {
      briefly "Maintains fleet analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Fleet analytics projections"
    described by "Maintains fleet operational analytics data."
  }

} with {
  briefly "Bounded context for fleet management"
  described by {
    | The VehicleContext is the bounded context for
    | vehicle tracking and fleet operations.
  }
}
