// Port Operations - Berth Context
context BerthContext is {
  include "types.riddl"
  include "Berth.riddl"
  // Repository for berth persistence
  repository BerthRepository is {
    schema BerthData is relational
      of berths as type Berth
        index on field Berth.berthId
        index on field Berth.details.terminalId
        index on field Berth.details.berthNumber
        index on field Berth.status

    handler BerthPersistence is {
      on command Berth.CreateBerth is {
        prompt "Store new berth"
      }
      on command Berth.UpdateBerthDetails is {
        prompt "Update berth details"
      }
      on command Berth.RequestBerth is {
        prompt "Store berth request"
      }
      on command Berth.ConfirmBerthAssignment is {
        prompt "Store berth assignment"
      }
      on command Berth.AssignPilot is {
        prompt "Store pilot assignment"
      }
      on command BerthContext.Berth.OrderTugs is {
        prompt "Store tug order"
      }
      on command Berth.RecordVesselArrival is {
        prompt "Update to occupied"
      }
      on command Berth.RecordMooring is {
        prompt "Store mooring record"
      }
      on command Berth.StartCargoOperations is {
        prompt "Store cargo operation start"
      }
      on command Berth.CompleteCargoOperations is {
        prompt "Store cargo operation completion"
      }
      on command Berth.RecordVesselDeparture is {
        prompt "Update to available"
      }
      on command Berth.GeneratePortCharges is {
        prompt "Store port charges"
      }
      on command Berth.CancelPortCall is {
        prompt "Update port call status"
      }
      on command Berth.SetBerthMaintenance is {
        prompt "Store maintenance schedule"
      }
    } with {
      briefly "Persists berth commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Berth data persistence"
    described as {
      | The BerthRepository provides persistent storage
      | for berths and port call data.
    }
  }
  // Projector for port analytics
  projector PortAnalytics is {
    record PortStats is  {
      date: Date with {
        briefly "Date"
        described as {
          |Statistics date.
        }
      }
      vesselCalls: Natural with {
        briefly "Calls"
        described as {
          |Vessel port calls.
        }
      }
      totalCargoVolume: Decimal(14,2) with {
        briefly "Cargo"
        described as {
          |Total cargo volume.
        }
      }
      averageTurnaroundTime: Duration with {
        briefly "Turnaround"
        described as {
          |Avg turnaround time.
        }
      }
      berthUtilization: Decimal(5,2) with {
        briefly "Utilization"
        described as {
          |Berth utilization percent.
        }
      }
      totalRevenue: Decimal(14,2) with {
        briefly "Revenue"
        described as {
          |Total port charges.
        }
      }
      craneMoves: Natural with {
        briefly "Moves"
        described as {
          |Total crane moves.
        }
      }
    } with {
      briefly "Port statistics"
      described as {
        |Daily port metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Berth.VesselArrived is {
        prompt "Update arrival metrics"
      }
      on event Berth.CargoOperationsCompleted is {
        prompt "Update cargo metrics"
      }
      on event Berth.VesselDeparted is {
        prompt "Update turnaround metrics"
      }
      on event Berth.PortChargesGenerated is {
        prompt "Update revenue metrics"
      }
    } with {
      briefly "Maintains port analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Port analytics projections"
    described as {
      |Maintains port operational analytics.
    }
  }
} with {
  briefly "Bounded context for berth management"
  described as {
    | The BerthContext is the bounded context for
    | berth allocation and port call management.
  }
}
