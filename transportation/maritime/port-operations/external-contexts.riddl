// Port Operations - External Contexts

// Vessel Traffic Service
context VesselTrafficService is {

  query GetVesselPosition is {
    vesselId is VesselId with { briefly "Vessel" described by "Vessel ID." }
  } with {
    briefly "Get vessel position"
    described by "Queries current vessel position."
  }

  result VesselPositionResult is {
    vesselId is VesselId with { briefly "Vessel" described by "Vessel ID." }
    position is GpsLocation with { briefly "Position" described by "Current position." }
    heading is Decimal(5, 2) with { briefly "Heading" described by "Course heading." }
    speed is Decimal(5, 2) with { briefly "Speed" described by "Speed in knots." }
    timestamp is TimeStamp with { briefly "Time" described by "Position time." }
  } with {
    briefly "Vessel position result"
    described by "Current vessel position data."
  }

  event VesselApproaching is {
    vesselId is VesselId with { briefly "Vessel" described by "Vessel ID." }
    vesselName is String(1, 200) with { briefly "Name" described by "Vessel name." }
    eta is TimeStamp with { briefly "ETA" described by "Updated ETA." }
    distanceNm is Decimal(6, 2) with { briefly "Distance" described by "Distance in NM." }
  } with {
    briefly "Vessel approaching"
    described by "Emitted when vessel approaches port."
  }

  event VesselInPortLimits is {
    vesselId is VesselId with { briefly "Vessel" described by "Vessel ID." }
    enteredAt is TimeStamp with { briefly "Entered" described by "Entry time." }
  } with {
    briefly "Vessel in port limits"
    described by "Emitted when vessel enters port."
  }

} with {
  option is external
  briefly "External vessel traffic"
  described by "External VTS integration."
}

// Pilot Coordination Service
context PilotCoordinationService is {

  query GetAvailablePilots is {
    date is Date with { briefly "Date" described by "Service date." }
    shift is String(1, 20) with { briefly "Shift" described by "Shift period." }
  } with {
    briefly "Get available pilots"
    described by "Queries available harbor pilots."
  }

  result AvailablePilotsResult is {
    pilots is many PilotageInfo with { briefly "Pilots" described by "Available pilots." }
  } with {
    briefly "Available pilots result"
    described by "List of available pilots."
  }

  command RequestPilot is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    vesselInfo is VesselInfo with { briefly "Vessel" described by "Vessel details." }
    eta is TimeStamp with { briefly "ETA" described by "Expected arrival." }
    movementType is String(1, 20) with { briefly "Movement" described by "Inbound/outbound/shift." }
  } with {
    briefly "Request pilot"
    described by "Requests pilot assignment."
  }

  event PilotAssignmentConfirmed is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    pilotage is PilotageInfo with { briefly "Pilotage" described by "Pilot details." }
    confirmedAt is TimeStamp with { briefly "Confirmed" described by "Confirmation time." }
  } with {
    briefly "Pilot confirmed"
    described by "Emitted when pilot is confirmed."
  }

  event PilotOnBoard is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    pilotId is PilotId with { briefly "Pilot" described by "Pilot ID." }
    boardedAt is TimeStamp with { briefly "Boarded" described by "Boarding time." }
  } with {
    briefly "Pilot on board"
    described by "Emitted when pilot boards vessel."
  }

  event PilotDisembarked is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    pilotId is PilotId with { briefly "Pilot" described by "Pilot ID." }
    disembarkedAt is TimeStamp with { briefly "Disembarked" described by "Disembark time." }
  } with {
    briefly "Pilot disembarked"
    described by "Emitted when pilot leaves vessel."
  }

} with {
  option is external
  briefly "External pilot coordination"
  described by "External pilot dispatch service."
}

// Towage Service
context TowageService is {

  query GetAvailableTugs is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    requiredPull is Natural with { briefly "Pull" described by "Required bollard pull." }
    requestedTime is TimeStamp with { briefly "Time" described by "Requested time." }
  } with {
    briefly "Get available tugs"
    described by "Queries available tugs."
  }

  result AvailableTugsResult is {
    availableTugs is many TugInfo with { briefly "Tugs" described by "Available tugs." }
  } with {
    briefly "Available tugs result"
    described by "List of available tugs."
  }

  type TugInfo is {
    tugId is UUID with { briefly "Tug" described by "Tug identifier." }
    name is String(1, 100) with { briefly "Name" described by "Tug name." }
    bollardPull is Natural with { briefly "Pull" described by "Bollard pull (tons)." }
    available is Boolean with { briefly "Available" described by "Availability status." }
  } with {
    briefly "Tug information"
    described by "Tug details."
  }

  command OrderTugs is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    tugs is TugService with { briefly "Tugs" described by "Tug requirements." }
    requestedTime is TimeStamp with { briefly "Time" described by "Requested time." }
  } with {
    briefly "Order tugs"
    described by "Orders tug assistance."
  }

  event TugsConfirmed is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    tugs is TugService with { briefly "Tugs" described by "Confirmed tugs." }
    confirmedAt is TimeStamp with { briefly "Confirmed" described by "Confirmation time." }
  } with {
    briefly "Tugs confirmed"
    described by "Emitted when tugs are confirmed."
  }

  event TugOperationStarted is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    startedAt is TimeStamp with { briefly "Started" described by "Start time." }
  } with {
    briefly "Tug operation started"
    described by "Emitted when tug assistance begins."
  }

  event TugOperationCompleted is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Tug operation completed"
    described by "Emitted when tug assistance ends."
  }

} with {
  option is external
  briefly "External towage"
  described by "External tug dispatch service."
}

// Terminal Operating System
context TerminalOperatingSystem is {

  command ScheduleCargoOperation is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    berthId is BerthId with { briefly "Berth" described by "Berth ID." }
    operation is CargoOperation with { briefly "Operation" described by "Cargo operation." }
  } with {
    briefly "Schedule cargo operation"
    described by "Schedules cargo handling."
  }

  event CargoOperationScheduled is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    scheduledStart is TimeStamp with { briefly "Start" described by "Scheduled start." }
    estimatedDuration is Duration with { briefly "Duration" described by "Estimated duration." }
  } with {
    briefly "Cargo scheduled"
    described by "Emitted when operation is scheduled."
  }

  event CraneMoveCompleted is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    craneId is String(1, 50) with { briefly "Crane" described by "Crane ID." }
    moveCount is Natural with { briefly "Moves" described by "Moves completed." }
    timestamp is TimeStamp with { briefly "Time" described by "Completion time." }
  } with {
    briefly "Crane move completed"
    described by "Emitted after crane operations."
  }

  query GetYardCapacity is {
    terminalId is TerminalId with { briefly "Terminal" described by "Terminal ID." }
    cargoType is CargoType with { briefly "Cargo" described by "Cargo type." }
  } with {
    briefly "Get yard capacity"
    described by "Queries yard storage capacity."
  }

  result YardCapacityResult is {
    totalCapacity is Natural with { briefly "Total" described by "Total capacity." }
    usedCapacity is Natural with { briefly "Used" described by "Used capacity." }
    availableCapacity is Natural with { briefly "Available" described by "Available capacity." }
  } with {
    briefly "Yard capacity result"
    described by "Yard storage availability."
  }

} with {
  option is external
  briefly "External TOS"
  described by "External terminal operating system."
}

// Customs Service
context CustomsService is {

  command SubmitArrivalNotification is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    vessel is VesselInfo with { briefly "Vessel" described by "Vessel details." }
    eta is TimeStamp with { briefly "ETA" described by "Expected arrival." }
    lastPort is String(1, 200) with { briefly "Last port" described by "Previous port." }
    cargoManifest is String(1, 5000) with { briefly "Manifest" described by "Cargo manifest summary." }
  } with {
    briefly "Submit arrival notification"
    described by "Submits customs arrival notice."
  }

  event ArrivalNotificationAcknowledged is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    referenceNumber is String(1, 50) with { briefly "Reference" described by "Customs reference." }
    acknowledgedAt is TimeStamp with { briefly "Acknowledged" described by "Acknowledgment time." }
  } with {
    briefly "Notification acknowledged"
    described by "Emitted when customs acknowledges."
  }

  event ClearanceGranted is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    clearanceType is String(1, 50) with { briefly "Type" described by "Clearance type." }
    grantedAt is TimeStamp with { briefly "Granted" described by "Grant time." }
  } with {
    briefly "Clearance granted"
    described by "Emitted when clearance is given."
  }

  event ClearanceHeld is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Hold reason." }
    heldAt is TimeStamp with { briefly "Held" described by "Hold time." }
  } with {
    briefly "Clearance held"
    described by "Emitted when clearance is delayed."
  }

} with {
  option is external
  briefly "External customs"
  described by "External customs authority integration."
}

// Billing Service
context PortBillingService is {

  command GenerateInvoice is {
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    charges is PortCharges with { briefly "Charges" described by "Port charges." }
    agentCompany is String(1, 200) with { briefly "Agent" described by "Billing agent." }
  } with {
    briefly "Generate invoice"
    described by "Generates port call invoice."
  }

  event InvoiceGenerated is {
    invoiceId is UUID with { briefly "Invoice" described by "Invoice ID." }
    portCallId is PortCallId with { briefly "Port call" described by "Port call ID." }
    totalAmount is Decimal(14, 2) with { briefly "Total" described by "Invoice total." }
    generatedAt is TimeStamp with { briefly "Generated" described by "Generation time." }
  } with {
    briefly "Invoice generated"
    described by "Emitted when invoice is created."
  }

  event PaymentReceived is {
    invoiceId is UUID with { briefly "Invoice" described by "Invoice ID." }
    amount is Decimal(14, 2) with { briefly "Amount" described by "Payment amount." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Payment received"
    described by "Emitted when payment is received."
  }

} with {
  option is external
  briefly "External billing"
  described by "External port billing system."
}
