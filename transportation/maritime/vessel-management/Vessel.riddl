// Vessel Management - Vessel Entity
entity Vessel is {
  // Commands
  command RegisterVessel is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |New vessel identifier.
      }
    }
    specifications: VesselSpecifications with {
      briefly "Specs"
      described as {
        |Vessel specifications.
      }
    }
  } with {
    briefly "Register vessel"
    described as {
      |Registers a new vessel in the fleet.
    }
  }
  command UpdateSpecifications is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    specifications: VesselSpecifications with {
      briefly "Specs"
      described as {
        |Updated specifications.
      }
    }
  } with {
    briefly "Update specifications"
    described as {
      |Updates vessel specifications.
    }
  }
  command UpdatePosition is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    position: VesselPosition with {
      briefly "Position"
      described as {
        |Current position.
      }
    }
  } with {
    briefly "Update position"
    described as {
      |Updates vessel position.
    }
  }
  command CreateVoyage is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    voyage: VoyageDetails with {
      briefly "Voyage"
      described as {
        |Voyage details.
      }
    }
    portCalls: PortCallInfo+ with {
      briefly "Port calls"
      described as {
        |Scheduled port calls.
      }
    }
  } with {
    briefly "Create voyage"
    described as {
      |Creates a new voyage.
    }
  }
  command UpdateVoyage is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    voyageId: VoyageId with {
      briefly "Voyage"
      described as {
        |Voyage identifier.
      }
    }
    updates: VoyageDetails with {
      briefly "Updates"
      described as {
        |Voyage updates.
      }
    }
  } with {
    briefly "Update voyage"
    described as {
      |Updates voyage details.
    }
  }
  command RecordPortArrival is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    portCallId: PortCallId with {
      briefly "Port call"
      described as {
        |Port call ID.
      }
    }
    arrivedAt: TimeStamp with {
      briefly "Arrived"
      described as {
        |Arrival time.
      }
    }
    arrivalPosition: GpsLocation with {
      briefly "Position"
      described as {
        |Arrival position.
      }
    }
  } with {
    briefly "Record port arrival"
    described as {
      |Records arrival at port.
    }
  }
  command RecordPortDeparture is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    portCallId: PortCallId with {
      briefly "Port call"
      described as {
        |Port call ID.
      }
    }
    departedAt: TimeStamp with {
      briefly "Departed"
      described as {
        |Departure time.
      }
    }
    nextPort: String(1,200) with {
      briefly "Next"
      described as {
        |Next destination.
      }
    }
  } with {
    briefly "Record port departure"
    described as {
      |Records departure from port.
    }
  }
  command CompleteVoyage is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    voyageId: VoyageId with {
      briefly "Voyage"
      described as {
        |Voyage identifier.
      }
    }
    completedAt: Date with {
      briefly "Completed"
      described as {
        |Completion date.
      }
    }
  } with {
    briefly "Complete voyage"
    described as {
      |Completes a voyage.
    }
  }
  command AddCrewMember is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    crew: CrewMember with {
      briefly "Crew"
      described as {
        |Crew member details.
      }
    }
  } with {
    briefly "Add crew member"
    described as {
      |Adds crew member to vessel.
    }
  }
  command RemoveCrewMember is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    crewMemberId: CrewMemberId with {
      briefly "Crew"
      described as {
        |Crew member ID.
      }
    }
    signOffDate: Date with {
      briefly "Sign off"
      described as {
        |Departure date.
      }
    }
  } with {
    briefly "Remove crew member"
    described as {
      |Removes crew member from vessel.
    }
  }
  command AddCertificate is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    certificate: VesselCertificate with {
      briefly "Certificate"
      described as {
        |Certificate details.
      }
    }
  } with {
    briefly "Add certificate"
    described as {
      |Adds vessel certificate.
    }
  }
  command RenewCertificate is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    certificateId: CertificateId with {
      briefly "Certificate"
      described as {
        |Certificate ID.
      }
    }
    newExpiryDate: Date with {
      briefly "Expiry"
      described as {
        |New expiry date.
      }
    }
    newSurveyDate: Date? with {
      briefly "Survey"
      described as {
        |Next survey date.
      }
    }
  } with {
    briefly "Renew certificate"
    described as {
      |Renews vessel certificate.
    }
  }
  command SubmitBunkerReport is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    report: BunkerReport with {
      briefly "Report"
      described as {
        |Bunker report.
      }
    }
  } with {
    briefly "Submit bunker report"
    described as {
      |Submits fuel consumption report.
    }
  }
  command RecordMaintenance is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    maintenance: MaintenanceRecord with {
      briefly "Maintenance"
      described as {
        |Maintenance record.
      }
    }
  } with {
    briefly "Record maintenance"
    described as {
      |Records maintenance activity.
    }
  }
  command SetVesselStatus is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel identifier.
      }
    }
    status: VesselStatus with {
      briefly "Status"
      described as {
        |New status.
      }
    }
    updatedReason: String(1,500)? with {
      briefly "Reason"
      described as {
        |Status change reason.
      }
    }
  } with {
    briefly "Set vessel status"
    described as {
      |Changes vessel operational status.
    }
  }
  // Events
  event VesselRegistered is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    specifications: VesselSpecifications with {
      briefly "Specs"
      described as {
        |Vessel specs.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Vessel registered"
    described as {
      |Emitted when vessel is registered.
    }
  }
  event SpecificationsUpdated is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    specifications: VesselSpecifications with {
      briefly "Specs"
      described as {
        |New specs.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Specifications updated"
    described as {
      |Emitted when specs are updated.
    }
  }
  event PositionUpdated is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    position: VesselPosition with {
      briefly "Position"
      described as {
        |New position.
      }
    }
  } with {
    briefly "Position updated"
    described as {
      |Emitted when position is updated.
    }
  }
  event VoyageCreated is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    voyage: VoyageDetails with {
      briefly "Voyage"
      described as {
        |Voyage details.
      }
    }
    portCalls: PortCallInfo+ with {
      briefly "Port calls"
      described as {
        |Port calls.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Voyage created"
    described as {
      |Emitted when voyage is created.
    }
  }
  event VoyageUpdated is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    voyageId: VoyageId with {
      briefly "Voyage"
      described as {
        |Voyage ID.
      }
    }
    updates: VoyageDetails with {
      briefly "Updates"
      described as {
        |Voyage updates.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Voyage updated"
    described as {
      |Emitted when voyage is updated.
    }
  }
  event PortArrivalRecorded is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    portCallId: PortCallId with {
      briefly "Port call"
      described as {
        |Port call ID.
      }
    }
    arrivedAt: TimeStamp with {
      briefly "Arrived"
      described as {
        |Arrival time.
      }
    }
  } with {
    briefly "Port arrival recorded"
    described as {
      |Emitted when arriving at port.
    }
  }
  event PortDepartureRecorded is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    portCallId: PortCallId with {
      briefly "Port call"
      described as {
        |Port call ID.
      }
    }
    departedAt: TimeStamp with {
      briefly "Departed"
      described as {
        |Departure time.
      }
    }
  } with {
    briefly "Port departure recorded"
    described as {
      |Emitted when departing port.
    }
  }
  event VoyageCompleted is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    voyageId: VoyageId with {
      briefly "Voyage"
      described as {
        |Voyage ID.
      }
    }
    completedAt: Date with {
      briefly "Completed"
      described as {
        |Completion date.
      }
    }
  } with {
    briefly "Voyage completed"
    described as {
      |Emitted when voyage is completed.
    }
  }
  event CrewMemberAdded is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    crew: CrewMember with {
      briefly "Crew"
      described as {
        |Crew member.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Crew member added"
    described as {
      |Emitted when crew joins.
    }
  }
  event CrewMemberRemoved is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    crewMemberId: CrewMemberId with {
      briefly "Crew"
      described as {
        |Crew member ID.
      }
    }
    removedAt: TimeStamp with {
      briefly "Removed"
      described as {
        |Removal time.
      }
    }
  } with {
    briefly "Crew member removed"
    described as {
      |Emitted when crew departs.
    }
  }
  event CertificateAdded is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    certificate: VesselCertificate with {
      briefly "Certificate"
      described as {
        |Certificate.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Certificate added"
    described as {
      |Emitted when certificate is added.
    }
  }
  event CertificateRenewed is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    certificateId: CertificateId with {
      briefly "Certificate"
      described as {
        |Certificate ID.
      }
    }
    newExpiryDate: Date with {
      briefly "Expiry"
      described as {
        |New expiry.
      }
    }
    renewedAt: TimeStamp with {
      briefly "Renewed"
      described as {
        |Renewal time.
      }
    }
  } with {
    briefly "Certificate renewed"
    described as {
      |Emitted when certificate is renewed.
    }
  }
  event BunkerReportSubmitted is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    report: BunkerReport with {
      briefly "Report"
      described as {
        |Bunker report.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Bunker report submitted"
    described as {
      |Emitted when bunker report is filed.
    }
  }
  event MaintenanceRecorded is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    maintenance: MaintenanceRecord with {
      briefly "Maintenance"
      described as {
        |Maintenance record.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Maintenance recorded"
    described as {
      |Emitted when maintenance is logged.
    }
  }
  event VesselStatusChanged is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    previousStatus: VesselStatus with {
      briefly "Previous"
      described as {
        |Previous status.
      }
    }
    newStatus: VesselStatus with {
      briefly "New"
      described as {
        |New status.
      }
    }
    changedAt: TimeStamp with {
      briefly "Changed"
      described as {
        |Change time.
      }
    }
  } with {
    briefly "Vessel status changed"
    described as {
      |Emitted when status changes.
    }
  }
  // State Records
  record ActiveStateData is  {
    vesselId: VesselId with {
      briefly "Vessel"
      described as {
        |Vessel ID.
      }
    }
    specifications: VesselSpecifications with {
      briefly "Specs"
      described as {
        |Vessel specs.
      }
    }
    status: VesselStatus with {
      briefly "Status"
      described as {
        |Vessel status.
      }
    }
    currentPosition: VesselPosition? with {
      briefly "Position"
      described as {
        |Current position.
      }
    }
    currentVoyage: VoyageDetails? with {
      briefly "Voyage"
      described as {
        |Current voyage.
      }
    }
    scheduledPortCalls: PortCallInfo* with {
      briefly "Port calls"
      described as {
        |Scheduled calls.
      }
    }
    currentCrew: CrewMember* with {
      briefly "Crew"
      described as {
        |Current crew.
      }
    }
    vesselCertificates: VesselCertificate* with {
      briefly "Certificates"
      described as {
        |Valid certificates.
      }
    }
    lastBunkerReport: BunkerReport? with {
      briefly "Bunker"
      described as {
        |Last bunker report.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Active state"
    described as {
      |State for active vessel.
    }
  }
  // States
  state ActiveState of type Vessel.ActiveStateData
  // Handler
  handler VesselHandler is {
    on command RegisterVessel is {
      morph entity VesselContext.Vessel to state VesselContext.Vessel.ActiveState with command RegisterVessel
      tell event VesselRegistered to entity VesselContext.Vessel
    }
    on command UpdateSpecifications is {
      tell event SpecificationsUpdated to entity VesselContext.Vessel
    }
    on command UpdatePosition is {
      tell event PositionUpdated to entity VesselContext.Vessel
    }
    on command CreateVoyage is {
      tell event VoyageCreated to entity VesselContext.Vessel
    }
    on command UpdateVoyage is {
      tell event VoyageUpdated to entity VesselContext.Vessel
    }
    on command RecordPortArrival is {
      tell event PortArrivalRecorded to entity VesselContext.Vessel
    }
    on command RecordPortDeparture is {
      tell event PortDepartureRecorded to entity VesselContext.Vessel
    }
    on command CompleteVoyage is {
      tell event VoyageCompleted to entity VesselContext.Vessel
    }
    on command AddCrewMember is {
      tell event CrewMemberAdded to entity VesselContext.Vessel
    }
    on command RemoveCrewMember is {
      tell event CrewMemberRemoved to entity VesselContext.Vessel
    }
    on command AddCertificate is {
      tell event CertificateAdded to entity VesselContext.Vessel
    }
    on command RenewCertificate is {
      tell event CertificateRenewed to entity VesselContext.Vessel
    }
    on command SubmitBunkerReport is {
      tell event BunkerReportSubmitted to entity VesselContext.Vessel
    }
    on command RecordMaintenance is {
      tell event MaintenanceRecorded to entity VesselContext.Vessel
    }
    on command SetVesselStatus is {
      tell event VesselStatusChanged to entity VesselContext.Vessel
    }
  } with {
    briefly "Processes vessel commands"
    described as {
      | Handles vessel lifecycle from registration
      | through voyages and maintenance.
    }
  }
} with {
  briefly "Vessel aggregate"
  described as {
    | The Vessel entity manages ship fleet
    | and voyage operations.
  }
}
