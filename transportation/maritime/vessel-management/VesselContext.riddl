// Vessel Management - Vessel Context
context VesselContext is {
  include "types.riddl"
  include "Vessel.riddl"
  // Repository for vessel persistence
  repository VesselRepository is {
    schema VesselData is relational
      of vessels as type Vessel
        index on field Vessel.vesselId
        index on field Vessel.specifications.imoNumber
        index on field Vessel.specifications.name
        index on field Vessel.status

    handler VesselPersistence is {
      on command Vessel.RegisterVessel is {
        prompt "Store new vessel"
      }
      on command Vessel.UpdateSpecifications is {
        prompt "Update vessel specs"
      }
      on command Vessel.UpdatePosition is {
        prompt "Store position update"
      }
      on command Vessel.CreateVoyage is {
        prompt "Store new voyage"
      }
      on command Vessel.UpdateVoyage is {
        prompt "Update voyage details"
      }
      on command Vessel.RecordPortArrival is {
        prompt "Update port call arrival"
      }
      on command Vessel.RecordPortDeparture is {
        prompt "Update port call departure"
      }
      on command Vessel.CompleteVoyage is {
        prompt "Update voyage to completed"
      }
      on command Vessel.AddCrewMember is {
        prompt "Store crew assignment"
      }
      on command Vessel.RemoveCrewMember is {
        prompt "Update crew departure"
      }
      on command Vessel.AddCertificate is {
        prompt "Store certificate"
      }
      on command Vessel.RenewCertificate is {
        prompt "Update certificate expiry"
      }
      on command Vessel.SubmitBunkerReport is {
        prompt "Store bunker report"
      }
      on command Vessel.RecordMaintenance is {
        prompt "Store maintenance record"
      }
      on command Vessel.SetVesselStatus is {
        prompt "Update vessel status"
      }
    } with {
      briefly "Persists vessel commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Vessel data persistence"
    described as {
      | The VesselRepository provides persistent storage
      | for vessel fleet data.
    }
  }
  // Projector for fleet analytics
  projector FleetAnalytics is {
    record FleetStats is  {
      date: Date with {
        briefly "Date"
        described as {
          |Statistics date.
        }
      }
      totalVessels: Natural with {
        briefly "Total"
        described as {
          |Total vessels in fleet.
        }
      }
      vesselsAtSea: Natural with {
        briefly "At sea"
        described as {
          |Vessels at sea.
        }
      }
      vesselsInPort: Natural with {
        briefly "In port"
        described as {
          |Vessels in port.
        }
      }
      vesselsUnderRepair: Natural with {
        briefly "Repair"
        described as {
          |Vessels under repair.
        }
      }
      activeVoyages: Natural with {
        briefly "Voyages"
        described as {
          |Active voyages.
        }
      }
      totalCrew: Natural with {
        briefly "Crew"
        described as {
          |Total crew count.
        }
      }
      certificatesExpiringSoon: Natural with {
        briefly "Expiring"
        described as {
          |Certificates expiring soon.
        }
      }
    } with {
      briefly "Fleet statistics"
      described as {
        |Daily fleet metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Vessel.VesselRegistered is {
        prompt "Update fleet count"
      }
      on event Vessel.VesselStatusChanged is {
        prompt "Update status metrics"
      }
      on event Vessel.VoyageCreated is {
        prompt "Update voyage metrics"
      }
      on event Vessel.VoyageCompleted is {
        prompt "Update completion metrics"
      }
      on event Vessel.CrewMemberAdded is {
        prompt "Update crew metrics"
      }
      on event Vessel.CertificateRenewed is {
        prompt "Update certificate metrics"
      }
    } with {
      briefly "Maintains fleet analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Fleet analytics projections"
    described as {
      |Maintains fleet operational analytics.
    }
  }
} with {
  briefly "Bounded context for vessel management"
  described as {
    | The VesselContext is the bounded context for
    | vessel fleet and voyage management.
  }
}
