// Vessel Management - Vessel Context

context VesselContext is {

  include "types.riddl"
  include "Vessel.riddl"

  // Repository for vessel persistence
  repository VesselRepository is {
    schema VesselData is relational
      of vessels as Vessel
      index on field Vessel.vesselId
      index on field Vessel.specifications.imoNumber
      index on field Vessel.specifications.name
      index on field Vessel.status

    handler VesselPersistence is {
      on command Vessel.RegisterVessel {
        prompt "Store new vessel"
      }
      on command Vessel.UpdateSpecifications {
        prompt "Update vessel specs"
      }
      on command Vessel.UpdatePosition {
        prompt "Store position update"
      }
      on command Vessel.CreateVoyage {
        prompt "Store new voyage"
      }
      on command Vessel.UpdateVoyage {
        prompt "Update voyage details"
      }
      on command Vessel.RecordPortArrival {
        prompt "Update port call arrival"
      }
      on command Vessel.RecordPortDeparture {
        prompt "Update port call departure"
      }
      on command Vessel.CompleteVoyage {
        prompt "Update voyage to completed"
      }
      on command Vessel.AddCrewMember {
        prompt "Store crew assignment"
      }
      on command Vessel.RemoveCrewMember {
        prompt "Update crew departure"
      }
      on command Vessel.AddCertificate {
        prompt "Store certificate"
      }
      on command Vessel.RenewCertificate {
        prompt "Update certificate expiry"
      }
      on command Vessel.SubmitBunkerReport {
        prompt "Store bunker report"
      }
      on command Vessel.RecordMaintenance {
        prompt "Store maintenance record"
      }
      on command Vessel.SetVesselStatus {
        prompt "Update vessel status"
      }
    } with {
      briefly "Persists vessel commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Vessel data persistence"
    described by {
      | The VesselRepository provides persistent storage
      | for vessel fleet data.
    }
  }

  // Projector for fleet analytics
  projector FleetAnalytics is {
    updates repository VesselRepository

    record FleetStats is {
      date is Date with { briefly "Date" described by "Statistics date." }
      totalVessels is Natural with { briefly "Total" described by "Total vessels in fleet." }
      vesselsAtSea is Natural with { briefly "At sea" described by "Vessels at sea." }
      vesselsInPort is Natural with { briefly "In port" described by "Vessels in port." }
      vesselsUnderRepair is Natural with { briefly "Repair" described by "Vessels under repair." }
      activeVoyages is Natural with { briefly "Voyages" described by "Active voyages." }
      totalCrew is Natural with { briefly "Crew" described by "Total crew count." }
      certificatesExpiringSoon is Natural with { briefly "Expiring" described by "Certificates expiring soon." }
    } with {
      briefly "Fleet statistics"
      described by "Daily fleet metrics."
    }

    handler AnalyticsHandler is {
      on event Vessel.VesselRegistered {
        prompt "Update fleet count"
      }
      on event Vessel.VesselStatusChanged {
        prompt "Update status metrics"
      }
      on event Vessel.VoyageCreated {
        prompt "Update voyage metrics"
      }
      on event Vessel.VoyageCompleted {
        prompt "Update completion metrics"
      }
      on event Vessel.CrewMemberAdded {
        prompt "Update crew metrics"
      }
      on event Vessel.CertificateRenewed {
        prompt "Update certificate metrics"
      }
    } with {
      briefly "Maintains fleet analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Fleet analytics projections"
    described by "Maintains fleet operational analytics."
  }

} with {
  briefly "Bounded context for vessel management"
  described by {
    | The VesselContext is the bounded context for
    | vessel fleet and voyage management.
  }
}
