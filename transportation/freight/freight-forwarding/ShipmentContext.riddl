// Freight Forwarding - Shipment Context
context ShipmentContext is {
  include "types.riddl"
  include "Shipment.riddl"
  // Repository for shipment persistence
  repository ShipmentRepository is {
    schema ShipmentData is relational
      of shipments as type Shipment
        index on field Shipment.shipmentId
        index on field Shipment.booking.bookingNumber
        index on field Shipment.route.originPort
        index on field Shipment.route.destinationPort
        index on field Shipment.status

    handler ShipmentPersistence is {
      on command Shipment.CreateShipment is {
        prompt "Store new shipment"
      }
      on command Shipment.AttachQuote is {
        prompt "Store quote"
      }
      on command Shipment.BookCarrier is {
        prompt "Store carrier booking"
      }
      on command Shipment.AssignContainers is {
        prompt "Store containers"
      }
      on command Shipment.UpdateContainerSeal is {
        prompt "Update container seal"
      }
      on command Shipment.SchedulePickup is {
        prompt "Store pickup schedule"
      }
      on command Shipment.RecordMilestone is {
        prompt "Store milestone"
      }
      on command Shipment.IssueDocument is {
        prompt "Store document"
      }
      on command Shipment.UpdateStatus is {
        prompt "Update status"
      }
      on command Shipment.RecordDelivery is {
        prompt "Update to delivered"
      }
      on command Shipment.CancelShipment is {
        prompt "Update to cancelled"
      }
    } with {
      briefly "Persists shipment commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Shipment data persistence"
    described as {
      | The ShipmentRepository provides persistent storage
      | for freight shipments.
    }
  }
  // Projector for forwarding analytics
  projector ForwardingAnalytics is {
    record ForwardingStats is  {
      date: Date with {
        briefly "Date"
        described as {
          |Statistics date.
        }
      }
      shipmentsBooked: Natural with {
        briefly "Booked"
        described as {
          |Shipments booked.
        }
      }
      shipmentsDelivered: Natural with {
        briefly "Delivered"
        described as {
          |Shipments delivered.
        }
      }
      teuVolume: Decimal(12,2) with {
        briefly "TEU"
        described as {
          |TEU volume.
        }
      }
      totalRevenue: Decimal(14,2) with {
        briefly "Revenue"
        described as {
          |Total revenue.
        }
      }
      averageTransitDays: Decimal(5,2) with {
        briefly "Transit"
        described as {
          |Avg transit days.
        }
      }
      onTimeDeliveryRate: Decimal(5,2) with {
        briefly "OTD"
        described as {
          |On-time delivery rate.
        }
      }
    } with {
      briefly "Forwarding statistics"
      described as {
        |Daily forwarding metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Shipment.ShipmentCreated is {
        prompt "Update booking metrics"
      }
      on event Shipment.CarrierBooked is {
        prompt "Update volume metrics"
      }
      on event Shipment.ShipmentDelivered is {
        prompt "Update delivery metrics"
      }
    } with {
      briefly "Maintains forwarding analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Forwarding analytics projections"
    described as {
      |Maintains freight forwarding analytics.
    }
  }
} with {
  briefly "Bounded context for shipments"
  described as {
    | The ShipmentContext is the bounded context for
    | freight forwarding operations.
  }
}
