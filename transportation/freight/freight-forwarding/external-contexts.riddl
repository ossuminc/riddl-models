// Freight Forwarding - External Contexts
// Ocean Carrier Service
context OceanCarrierService is {
  query GetSchedules is  {
    originPort: String(5,5) with {
      briefly "Origin"
      described as {
        |Origin port.
      }
    }
    destinationPort: String(5,5) with {
      briefly "Destination"
      described as {
        |Destination port.
      }
    }
    departureDateFrom: Date with {
      briefly "From"
      described as {
        |Search from date.
      }
    }
    departureDateTo: Date with {
      briefly "To"
      described as {
        |Search to date.
      }
    }
  } with {
    briefly "Get schedules"
    described as {
      |Queries sailing schedules.
    }
  }
  result ScheduleResult is  {
    sailings: SailingInfo+ with {
      briefly "Sailings"
      described as {
        |Available sailings.
      }
    }
  } with {
    briefly "Schedule result"
    described as {
      |Sailing schedule results.
    }
  }
  type SailingInfo is {
    carrierName: String(1,200) with {
      briefly "Carrier"
      described as {
        |Carrier name.
      }
    }
    vesselName: String(1,200) with {
      briefly "Vessel"
      described as {
        |Vessel name.
      }
    }
    voyageNumber: String(1,50) with {
      briefly "Voyage"
      described as {
        |Voyage number.
      }
    }
    etd: TimeStamp with {
      briefly "ETD"
      described as {
        |Departure time.
      }
    }
    eta: TimeStamp with {
      briefly "ETA"
      described as {
        |Arrival time.
      }
    }
    transitDays: Natural with {
      briefly "Transit"
      described as {
        |Transit days.
      }
    }
    spaceAvailable: Boolean with {
      briefly "Space"
      described as {
        |Space available.
      }
    }
  } with {
    briefly "Sailing info"
    described as {
      |Sailing schedule details.
    }
  }
  command RequestBooking is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    sailing: SailingInfo with {
      briefly "Sailing"
      described as {
        |Selected sailing.
      }
    }
    containerCount: Natural with {
      briefly "Containers"
      described as {
        |Container count.
      }
    }
    containerType: ContainerType with {
      briefly "Type"
      described as {
        |Container type.
      }
    }
  } with {
    briefly "Request booking"
    described as {
      |Requests carrier booking.
    }
  }
  event BookingConfirmed is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    bookingNumber: String(1,50) with {
      briefly "Number"
      described as {
        |Booking number.
      }
    }
    confirmedAt: TimeStamp with {
      briefly "Confirmed"
      described as {
        |Confirmation time.
      }
    }
  } with {
    briefly "Booking confirmed"
    described as {
      |Emitted when booking is confirmed.
    }
  }
  event BookingRejected is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Rejection reason.
      }
    }
    rejectedAt: TimeStamp with {
      briefly "Rejected"
      described as {
        |Rejection time.
      }
    }
  } with {
    briefly "Booking rejected"
    described as {
      |Emitted when booking is rejected.
    }
  }
} with {
  option external()
  briefly "External ocean carrier"
  described as {
    |Ocean carrier booking service.
  }
}
// Air Carrier Service
context AirCarrierService is {
  query GetFlights is  {
    originAirport: String(3,3) with {
      briefly "Origin"
      described as {
        |Origin airport.
      }
    }
    destinationAirport: String(3,3) with {
      briefly "Destination"
      described as {
        |Destination airport.
      }
    }
    departureDateFrom: Date with {
      briefly "From"
      described as {
        |Search from date.
      }
    }
    weight: Decimal(10,2) with {
      briefly "Weight"
      described as {
        |Cargo weight.
      }
    }
    volume: Decimal(10,3) with {
      briefly "Volume"
      described as {
        |Cargo volume.
      }
    }
  } with {
    briefly "Get flights"
    described as {
      |Queries air freight capacity.
    }
  }
  result FlightResult is  {
    flights: FlightInfo+ with {
      briefly "Flights"
      described as {
        |Available flights.
      }
    }
  } with {
    briefly "Flight result"
    described as {
      |Flight schedule results.
    }
  }
  type FlightInfo is {
    carrier: String(1,100) with {
      briefly "Carrier"
      described as {
        |Airline.
      }
    }
    flightNumber: String(1,20) with {
      briefly "Flight"
      described as {
        |Flight number.
      }
    }
    departureTime: TimeStamp with {
      briefly "Departure"
      described as {
        |Departure time.
      }
    }
    arrivalTime: TimeStamp with {
      briefly "Arrival"
      described as {
        |Arrival time.
      }
    }
    ratePerKg: Decimal(8,2) with {
      briefly "Rate"
      described as {
        |Rate per kg.
      }
    }
  } with {
    briefly "Flight info"
    described as {
      |Flight details.
    }
  }
  command BookAirFreight is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    flight: FlightInfo with {
      briefly "Flight"
      described as {
        |Selected flight.
      }
    }
    pieces: Natural with {
      briefly "Pieces"
      described as {
        |Number of pieces.
      }
    }
    weight: Decimal(10,2) with {
      briefly "Weight"
      described as {
        |Total weight.
      }
    }
  } with {
    briefly "Book air freight"
    described as {
      |Books air freight space.
    }
  }
  event AirBookingConfirmed is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    awbNumber: String(1,50) with {
      briefly "AWB"
      described as {
        |Air waybill number.
      }
    }
    confirmedAt: TimeStamp with {
      briefly "Confirmed"
      described as {
        |Confirmation time.
      }
    }
  } with {
    briefly "Air booking confirmed"
    described as {
      |Emitted when air booking is confirmed.
    }
  }
} with {
  option external()
  briefly "External air carrier"
  described as {
    |Air freight booking service.
  }
}
// Container Tracking Service
context ContainerTrackingService is {
  query TrackContainer is  {
    containerNumber: String(11,11) with {
      briefly "Container"
      described as {
        |Container number.
      }
    }
  } with {
    briefly "Track container"
    described as {
      |Tracks container location.
    }
  }
  result ContainerTrackingResult is  {
    containerNumber: String(11,11) with {
      briefly "Container"
      described as {
        |Container.
      }
    }
    currentLocation: String(1,200) with {
      briefly "Location"
      described as {
        |Current location.
      }
    }
    containerStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Container status.
      }
    }
    lastEvent: MilestoneEvent with {
      briefly "Event"
      described as {
        |Last event.
      }
    }
    estimatedArrival: TimeStamp? with {
      briefly "ETA"
      described as {
        |Estimated arrival.
      }
    }
  } with {
    briefly "Container tracking result"
    described as {
      |Container tracking data.
    }
  }
  event ContainerMilestone is  {
    containerNumber: String(11,11) with {
      briefly "Container"
      described as {
        |Container.
      }
    }
    milestone: MilestoneEvent with {
      briefly "Milestone"
      described as {
        |Tracking milestone.
      }
    }
  } with {
    briefly "Container milestone"
    described as {
      |Emitted for container events.
    }
  }
} with {
  option external()
  briefly "External container tracking"
  described as {
    |Container tracking service.
  }
}
// Trucking Service
context TruckingService is {
  command RequestPickup is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    pickupAddress: Address with {
      briefly "Address"
      described as {
        |Pickup address.
      }
    }
    pickupDate: Date with {
      briefly "Date"
      described as {
        |Pickup date.
      }
    }
    containerCount: Natural with {
      briefly "Containers"
      described as {
        |Container count.
      }
    }
    containerType: ContainerType with {
      briefly "Type"
      described as {
        |Container type.
      }
    }
  } with {
    briefly "Request pickup"
    described as {
      |Requests trucking pickup.
    }
  }
  event PickupConfirmed is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    truckerName: String(1,200) with {
      briefly "Trucker"
      described as {
        |Trucking company.
      }
    }
    pickupTime: TimeStamp with {
      briefly "Time"
      described as {
        |Confirmed pickup time.
      }
    }
  } with {
    briefly "Pickup confirmed"
    described as {
      |Emitted when pickup is confirmed.
    }
  }
  event PickupCompleted is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
    driverName: String(1,200) with {
      briefly "Driver"
      described as {
        |Driver name.
      }
    }
  } with {
    briefly "Pickup completed"
    described as {
      |Emitted when pickup is done.
    }
  }
  command RequestDelivery is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    deliveryAddress: Address with {
      briefly "Address"
      described as {
        |Delivery address.
      }
    }
    deliveryDate: Date with {
      briefly "Date"
      described as {
        |Delivery date.
      }
    }
  } with {
    briefly "Request delivery"
    described as {
      |Requests final delivery.
    }
  }
  event DeliveryConfirmed is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    truckerName: String(1,200) with {
      briefly "Trucker"
      described as {
        |Trucking company.
      }
    }
    deliveryTime: TimeStamp with {
      briefly "Time"
      described as {
        |Delivery time.
      }
    }
  } with {
    briefly "Delivery confirmed"
    described as {
      |Emitted when delivery is confirmed.
    }
  }
} with {
  option external()
  briefly "External trucking"
  described as {
    |Drayage and trucking service.
  }
}
// Rating Service
context RatingService is {
  query GetRates is  {
    originPort: String(5,5) with {
      briefly "Origin"
      described as {
        |Origin port.
      }
    }
    destinationPort: String(5,5) with {
      briefly "Destination"
      described as {
        |Destination port.
      }
    }
    serviceType: ServiceType with {
      briefly "Service"
      described as {
        |Service type.
      }
    }
    preferredContainerType: ContainerType? with {
      briefly "Container"
      described as {
        |Container type.
      }
    }
    estimatedWeight: Decimal(10,2)? with {
      briefly "Weight"
      described as {
        |Cargo weight.
      }
    }
  } with {
    briefly "Get rates"
    described as {
      |Queries freight rates.
    }
  }
  result RatesResult is  {
    quotes: RateQuote+ with {
      briefly "Quotes"
      described as {
        |Rate quotes.
      }
    }
  } with {
    briefly "Rates result"
    described as {
      |Available rates.
    }
  }
  command RequestCustomQuote is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    cargo: CargoDetails+ with {
      briefly "Cargo"
      described as {
        |Cargo details.
      }
    }
    route: RouteInfo with {
      briefly "Route"
      described as {
        |Route info.
      }
    }
    serviceType: ServiceType with {
      briefly "Service"
      described as {
        |Service type.
      }
    }
  } with {
    briefly "Request custom quote"
    described as {
      |Requests custom pricing.
    }
  }
  event CustomQuoteProvided is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    quote: RateQuote with {
      briefly "Quote"
      described as {
        |Custom quote.
      }
    }
    providedAt: TimeStamp with {
      briefly "Provided"
      described as {
        |Quote time.
      }
    }
  } with {
    briefly "Custom quote provided"
    described as {
      |Emitted when quote is ready.
    }
  }
} with {
  option external()
  briefly "External rating"
  described as {
    |Freight rate quoting service.
  }
}
// Document Generation Service
context DocumentGenerationService is {
  command GenerateBillOfLading is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    blType: String(1,20) with {
      briefly "Type"
      described as {
        |B/L type (original, express, seaway).
      }
    }
    parties: ShipmentParty+ with {
      briefly "Parties"
      described as {
        |Shipment parties.
      }
    }
    cargo: CargoDetails+ with {
      briefly "Cargo"
      described as {
        |Cargo details.
      }
    }
  } with {
    briefly "Generate B/L"
    described as {
      |Generates bill of lading.
    }
  }
  event BillOfLadingGenerated is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    blNumber: String(1,50) with {
      briefly "Number"
      described as {
        |B/L number.
      }
    }
    fileReference: String(1,500) with {
      briefly "File"
      described as {
        |Document file.
      }
    }
    generatedAt: TimeStamp with {
      briefly "Generated"
      described as {
        |Generation time.
      }
    }
  } with {
    briefly "B/L generated"
    described as {
      |Emitted when B/L is generated.
    }
  }
  command GenerateCommercialInvoice is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    invoiceDetails: String(1,5000) with {
      briefly "Details"
      described as {
        |Invoice details.
      }
    }
  } with {
    briefly "Generate commercial invoice"
    described as {
      |Generates commercial invoice.
    }
  }
  event CommercialInvoiceGenerated is  {
    shipmentId: ShipmentId with {
      briefly "Shipment"
      described as {
        |Shipment ID.
      }
    }
    invoiceNumber: String(1,50) with {
      briefly "Number"
      described as {
        |Invoice number.
      }
    }
    fileReference: String(1,500) with {
      briefly "File"
      described as {
        |Document file.
      }
    }
    generatedAt: TimeStamp with {
      briefly "Generated"
      described as {
        |Generation time.
      }
    }
  } with {
    briefly "Invoice generated"
    described as {
      |Emitted when invoice is generated.
    }
  }
} with {
  option external()
  briefly "External document generation"
  described as {
    |Shipping document generation service.
  }
}
