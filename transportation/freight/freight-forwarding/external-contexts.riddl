// Freight Forwarding - External Contexts

// Ocean Carrier Service
context OceanCarrierService is {

  query GetSchedules is {
    originPort is String(5, 5) with { briefly "Origin" described by "Origin port." }
    destinationPort is String(5, 5) with { briefly "Destination" described by "Destination port." }
    departureDateFrom is Date with { briefly "From" described by "Search from date." }
    departureDateTo is Date with { briefly "To" described by "Search to date." }
  } with {
    briefly "Get schedules"
    described by "Queries sailing schedules."
  }

  result ScheduleResult is {
    sailings is many SailingInfo with { briefly "Sailings" described by "Available sailings." }
  } with {
    briefly "Schedule result"
    described by "Sailing schedule results."
  }

  type SailingInfo is {
    carrierName is String(1, 200) with { briefly "Carrier" described by "Carrier name." }
    vesselName is String(1, 200) with { briefly "Vessel" described by "Vessel name." }
    voyageNumber is String(1, 50) with { briefly "Voyage" described by "Voyage number." }
    etd is TimeStamp with { briefly "ETD" described by "Departure time." }
    eta is TimeStamp with { briefly "ETA" described by "Arrival time." }
    transitDays is Natural with { briefly "Transit" described by "Transit days." }
    spaceAvailable is Boolean with { briefly "Space" described by "Space available." }
  } with {
    briefly "Sailing info"
    described by "Sailing schedule details."
  }

  command RequestBooking is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    sailing is SailingInfo with { briefly "Sailing" described by "Selected sailing." }
    containerCount is Natural with { briefly "Containers" described by "Container count." }
    containerType is ContainerType with { briefly "Type" described by "Container type." }
  } with {
    briefly "Request booking"
    described by "Requests carrier booking."
  }

  event BookingConfirmed is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    bookingNumber is String(1, 50) with { briefly "Number" described by "Booking number." }
    confirmedAt is TimeStamp with { briefly "Confirmed" described by "Confirmation time." }
  } with {
    briefly "Booking confirmed"
    described by "Emitted when booking is confirmed."
  }

  event BookingRejected is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Rejection reason." }
    rejectedAt is TimeStamp with { briefly "Rejected" described by "Rejection time." }
  } with {
    briefly "Booking rejected"
    described by "Emitted when booking is rejected."
  }

} with {
  option is external
  briefly "External ocean carrier"
  described by "Ocean carrier booking service."
}

// Air Carrier Service
context AirCarrierService is {

  query GetFlights is {
    originAirport is String(3, 3) with { briefly "Origin" described by "Origin airport." }
    destinationAirport is String(3, 3) with { briefly "Destination" described by "Destination airport." }
    departureDateFrom is Date with { briefly "From" described by "Search from date." }
    weight is Decimal(10, 2) with { briefly "Weight" described by "Cargo weight." }
    volume is Decimal(10, 3) with { briefly "Volume" described by "Cargo volume." }
  } with {
    briefly "Get flights"
    described by "Queries air freight capacity."
  }

  result FlightResult is {
    flights is many FlightInfo with { briefly "Flights" described by "Available flights." }
  } with {
    briefly "Flight result"
    described by "Flight schedule results."
  }

  type FlightInfo is {
    carrier is String(1, 100) with { briefly "Carrier" described by "Airline." }
    flightNumber is String(1, 20) with { briefly "Flight" described by "Flight number." }
    departureTime is TimeStamp with { briefly "Departure" described by "Departure time." }
    arrivalTime is TimeStamp with { briefly "Arrival" described by "Arrival time." }
    ratePerKg is Decimal(8, 2) with { briefly "Rate" described by "Rate per kg." }
  } with {
    briefly "Flight info"
    described by "Flight details."
  }

  command BookAirFreight is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    flight is FlightInfo with { briefly "Flight" described by "Selected flight." }
    pieces is Natural with { briefly "Pieces" described by "Number of pieces." }
    weight is Decimal(10, 2) with { briefly "Weight" described by "Total weight." }
  } with {
    briefly "Book air freight"
    described by "Books air freight space."
  }

  event AirBookingConfirmed is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    awbNumber is String(1, 50) with { briefly "AWB" described by "Air waybill number." }
    confirmedAt is TimeStamp with { briefly "Confirmed" described by "Confirmation time." }
  } with {
    briefly "Air booking confirmed"
    described by "Emitted when air booking is confirmed."
  }

} with {
  option is external
  briefly "External air carrier"
  described by "Air freight booking service."
}

// Container Tracking Service
context ContainerTrackingService is {

  query TrackContainer is {
    containerNumber is String(11, 11) with { briefly "Container" described by "Container number." }
  } with {
    briefly "Track container"
    described by "Tracks container location."
  }

  result ContainerTrackingResult is {
    containerNumber is String(11, 11) with { briefly "Container" described by "Container." }
    currentLocation is String(1, 200) with { briefly "Location" described by "Current location." }
    containerStatus is String(1, 50) with { briefly "Status" described by "Container status." }
    lastEvent is MilestoneEvent with { briefly "Event" described by "Last event." }
    estimatedArrival is optional TimeStamp with { briefly "ETA" described by "Estimated arrival." }
  } with {
    briefly "Container tracking result"
    described by "Container tracking data."
  }

  event ContainerMilestone is {
    containerNumber is String(11, 11) with { briefly "Container" described by "Container." }
    milestone is MilestoneEvent with { briefly "Milestone" described by "Tracking milestone." }
  } with {
    briefly "Container milestone"
    described by "Emitted for container events."
  }

} with {
  option is external
  briefly "External container tracking"
  described by "Container tracking service."
}

// Trucking Service
context TruckingService is {

  command RequestPickup is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    pickupAddress is Address with { briefly "Address" described by "Pickup address." }
    pickupDate is Date with { briefly "Date" described by "Pickup date." }
    containerCount is Natural with { briefly "Containers" described by "Container count." }
    containerType is ContainerType with { briefly "Type" described by "Container type." }
  } with {
    briefly "Request pickup"
    described by "Requests trucking pickup."
  }

  event PickupConfirmed is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    truckerName is String(1, 200) with { briefly "Trucker" described by "Trucking company." }
    pickupTime is TimeStamp with { briefly "Time" described by "Confirmed pickup time." }
  } with {
    briefly "Pickup confirmed"
    described by "Emitted when pickup is confirmed."
  }

  event PickupCompleted is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
    driverName is String(1, 200) with { briefly "Driver" described by "Driver name." }
  } with {
    briefly "Pickup completed"
    described by "Emitted when pickup is done."
  }

  command RequestDelivery is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    deliveryAddress is Address with { briefly "Address" described by "Delivery address." }
    deliveryDate is Date with { briefly "Date" described by "Delivery date." }
  } with {
    briefly "Request delivery"
    described by "Requests final delivery."
  }

  event DeliveryConfirmed is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    truckerName is String(1, 200) with { briefly "Trucker" described by "Trucking company." }
    deliveryTime is TimeStamp with { briefly "Time" described by "Delivery time." }
  } with {
    briefly "Delivery confirmed"
    described by "Emitted when delivery is confirmed."
  }

} with {
  option is external
  briefly "External trucking"
  described by "Drayage and trucking service."
}

// Rating Service
context RatingService is {

  query GetRates is {
    originPort is String(5, 5) with { briefly "Origin" described by "Origin port." }
    destinationPort is String(5, 5) with { briefly "Destination" described by "Destination port." }
    serviceType is ServiceType with { briefly "Service" described by "Service type." }
    preferredContainerType is optional ContainerType with { briefly "Container" described by "Container type." }
    estimatedWeight is optional Decimal(10, 2) with { briefly "Weight" described by "Cargo weight." }
  } with {
    briefly "Get rates"
    described by "Queries freight rates."
  }

  result RatesResult is {
    quotes is many RateQuote with { briefly "Quotes" described by "Rate quotes." }
  } with {
    briefly "Rates result"
    described by "Available rates."
  }

  command RequestCustomQuote is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    cargo is many CargoDetails with { briefly "Cargo" described by "Cargo details." }
    route is RouteInfo with { briefly "Route" described by "Route info." }
    serviceType is ServiceType with { briefly "Service" described by "Service type." }
  } with {
    briefly "Request custom quote"
    described by "Requests custom pricing."
  }

  event CustomQuoteProvided is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    quote is RateQuote with { briefly "Quote" described by "Custom quote." }
    providedAt is TimeStamp with { briefly "Provided" described by "Quote time." }
  } with {
    briefly "Custom quote provided"
    described by "Emitted when quote is ready."
  }

} with {
  option is external
  briefly "External rating"
  described by "Freight rate quoting service."
}

// Document Generation Service
context DocumentGenerationService is {

  command GenerateBillOfLading is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    blType is String(1, 20) with { briefly "Type" described by "B/L type (original, express, seaway)." }
    parties is many ShipmentParty with { briefly "Parties" described by "Shipment parties." }
    cargo is many CargoDetails with { briefly "Cargo" described by "Cargo details." }
  } with {
    briefly "Generate B/L"
    described by "Generates bill of lading."
  }

  event BillOfLadingGenerated is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    blNumber is String(1, 50) with { briefly "Number" described by "B/L number." }
    fileReference is String(1, 500) with { briefly "File" described by "Document file." }
    generatedAt is TimeStamp with { briefly "Generated" described by "Generation time." }
  } with {
    briefly "B/L generated"
    described by "Emitted when B/L is generated."
  }

  command GenerateCommercialInvoice is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    invoiceDetails is String(1, 5000) with { briefly "Details" described by "Invoice details." }
  } with {
    briefly "Generate commercial invoice"
    described by "Generates commercial invoice."
  }

  event CommercialInvoiceGenerated is {
    shipmentId is ShipmentId with { briefly "Shipment" described by "Shipment ID." }
    invoiceNumber is String(1, 50) with { briefly "Number" described by "Invoice number." }
    fileReference is String(1, 500) with { briefly "File" described by "Document file." }
    generatedAt is TimeStamp with { briefly "Generated" described by "Generation time." }
  } with {
    briefly "Invoice generated"
    described by "Emitted when invoice is generated."
  }

} with {
  option is external
  briefly "External document generation"
  described by "Shipping document generation service."
}
