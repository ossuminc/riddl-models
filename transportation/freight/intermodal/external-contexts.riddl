// Intermodal - External Contexts
// Rail Carrier Service
context RailCarrierService is {
  query GetAvailability is  {
    originTerminalId: TerminalId with {
      briefly "Origin"
      described as {
        |Origin terminal.
      }
    }
    destinationTerminalId: TerminalId with {
      briefly "Destination"
      described as {
        |Destination terminal.
      }
    }
    shipDate: Date with {
      briefly "Date"
      described as {
        |Shipping date.
      }
    }
    containerType: ContainerType with {
      briefly "Type"
      described as {
        |Container type.
      }
    }
  } with {
    briefly "Get availability"
    described as {
      |Queries rail capacity.
    }
  }
  result AvailabilityResult is  {
    spaceAvailable: Boolean with {
      briefly "Available"
      described as {
        |Space available.
      }
    }
    transitDays: Natural with {
      briefly "Transit"
      described as {
        |Transit days.
      }
    }
    rate: Decimal(10,2) with {
      briefly "Rate"
      described as {
        |Rail rate.
      }
    }
    trainSchedule: TrainScheduleInfo+ with {
      briefly "Schedule"
      described as {
        |Available trains.
      }
    }
  } with {
    briefly "Availability result"
    described as {
      |Rail availability details.
    }
  }
  type TrainScheduleInfo is {
    trainSymbol: String(1,20) with {
      briefly "Symbol"
      described as {
        |Train symbol.
      }
    }
    departure: TimeStamp with {
      briefly "Departure"
      described as {
        |Departure time.
      }
    }
    arrival: TimeStamp with {
      briefly "Arrival"
      described as {
        |Arrival time.
      }
    }
    cutoffTime: TimeStamp with {
      briefly "Cutoff"
      described as {
        |Terminal cutoff.
      }
    }
  } with {
    briefly "Train schedule info"
    described as {
      |Train schedule details.
    }
  }
  command BookRail is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    originTerminalId: TerminalId with {
      briefly "Origin"
      described as {
        |Origin terminal.
      }
    }
    destinationTerminalId: TerminalId with {
      briefly "Destination"
      described as {
        |Destination terminal.
      }
    }
    container: ContainerInfo with {
      briefly "Container"
      described as {
        |Container details.
      }
    }
    trainSymbol: String(1,20) with {
      briefly "Train"
      described as {
        |Preferred train.
      }
    }
  } with {
    briefly "Book rail"
    described as {
      |Books rail segment.
    }
  }
  event RailBookingConfirmed is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    railBookingNumber: String(1,50) with {
      briefly "Number"
      described as {
        |Rail booking number.
      }
    }
    confirmedAt: TimeStamp with {
      briefly "Confirmed"
      described as {
        |Confirmation time.
      }
    }
  } with {
    briefly "Rail booking confirmed"
    described as {
      |Emitted when rail is booked.
    }
  }
  event TrainDeparted is  {
    trainId: TrainId with {
      briefly "Train"
      described as {
        |Train ID.
      }
    }
    trainSymbol: String(1,20) with {
      briefly "Symbol"
      described as {
        |Train symbol.
      }
    }
    terminal: TerminalInfo with {
      briefly "Terminal"
      described as {
        |Departure terminal.
      }
    }
    departedAt: TimeStamp with {
      briefly "Departed"
      described as {
        |Departure time.
      }
    }
  } with {
    briefly "Train departed"
    described as {
      |Emitted when train departs.
    }
  }
  event TrainArrived is  {
    trainId: TrainId with {
      briefly "Train"
      described as {
        |Train ID.
      }
    }
    trainSymbol: String(1,20) with {
      briefly "Symbol"
      described as {
        |Train symbol.
      }
    }
    terminal: TerminalInfo with {
      briefly "Terminal"
      described as {
        |Arrival terminal.
      }
    }
    arrivedAt: TimeStamp with {
      briefly "Arrived"
      described as {
        |Arrival time.
      }
    }
  } with {
    briefly "Train arrived"
    described as {
      |Emitted when train arrives.
    }
  }
} with {
  option external()
  briefly "External rail carrier"
  described as {
    |Railroad intermodal service.
  }
}
// Dray Carrier Service
context DrayCarrierService is {
  command RequestDray is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    drayType: String(1,20) with {
      briefly "Type"
      described as {
        |Origin or destination.
      }
    }
    pickupAddress: Address with {
      briefly "Pickup"
      described as {
        |Pickup address.
      }
    }
    deliveryAddress: Address with {
      briefly "Delivery"
      described as {
        |Delivery address.
      }
    }
    pickupDate: Date with {
      briefly "Date"
      described as {
        |Pickup date.
      }
    }
    container: ContainerInfo with {
      briefly "Container"
      described as {
        |Container details.
      }
    }
  } with {
    briefly "Request dray"
    described as {
      |Requests dray service.
    }
  }
  event DrayConfirmed is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    carrier: String(1,200) with {
      briefly "Carrier"
      described as {
        |Dray carrier.
      }
    }
    pickupDate: Date with {
      briefly "Date"
      described as {
        |Pickup date.
      }
    }
    confirmedAt: TimeStamp with {
      briefly "Confirmed"
      described as {
        |Confirmation time.
      }
    }
  } with {
    briefly "Dray confirmed"
    described as {
      |Emitted when dray is confirmed.
    }
  }
  event DrayDispatched is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    driverName: String(1,200) with {
      briefly "Driver"
      described as {
        |Driver name.
      }
    }
    tractorNumber: String(1,20) with {
      briefly "Tractor"
      described as {
        |Tractor number.
      }
    }
    dispatchedAt: TimeStamp with {
      briefly "Dispatched"
      described as {
        |Dispatch time.
      }
    }
  } with {
    briefly "Dray dispatched"
    described as {
      |Emitted when driver dispatched.
    }
  }
  event DrayCompleted is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
    proofOfDelivery: String(1,500)? with {
      briefly "POD"
      described as {
        |Proof of delivery.
      }
    }
  } with {
    briefly "Dray completed"
    described as {
      |Emitted when dray is complete.
    }
  }
} with {
  option external()
  briefly "External dray carrier"
  described as {
    |Trucking dray service.
  }
}
// Terminal Operating System
context TerminalOperatingSystem is {
  command RequestIngate is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    container: ContainerInfo with {
      briefly "Container"
      described as {
        |Container details.
      }
    }
    expectedArrival: TimeStamp with {
      briefly "Expected"
      described as {
        |Expected arrival.
      }
    }
  } with {
    briefly "Request ingate"
    described as {
      |Requests terminal ingate.
    }
  }
  event ContainerIngated is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    containerNumber: String(1,20) with {
      briefly "Container"
      described as {
        |Container number.
      }
    }
    terminal: TerminalInfo with {
      briefly "Terminal"
      described as {
        |Terminal.
      }
    }
    ingatedAt: TimeStamp with {
      briefly "Ingated"
      described as {
        |Ingate time.
      }
    }
    yardLocation: String(1,50) with {
      briefly "Location"
      described as {
        |Yard location.
      }
    }
  } with {
    briefly "Container ingated"
    described as {
      |Emitted when container enters terminal.
    }
  }
  event ContainerLoaded is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    containerNumber: String(1,20) with {
      briefly "Container"
      described as {
        |Container.
      }
    }
    trainId: TrainId with {
      briefly "Train"
      described as {
        |Train ID.
      }
    }
    carNumber: String(1,20) with {
      briefly "Car"
      described as {
        |Rail car.
      }
    }
    loadedAt: TimeStamp with {
      briefly "Loaded"
      described as {
        |Load time.
      }
    }
  } with {
    briefly "Container loaded"
    described as {
      |Emitted when loaded to train.
    }
  }
  event ContainerUnloaded is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    containerNumber: String(1,20) with {
      briefly "Container"
      described as {
        |Container.
      }
    }
    terminal: TerminalInfo with {
      briefly "Terminal"
      described as {
        |Terminal.
      }
    }
    unloadedAt: TimeStamp with {
      briefly "Unloaded"
      described as {
        |Unload time.
      }
    }
    yardLocation: String(1,50) with {
      briefly "Location"
      described as {
        |Yard location.
      }
    }
  } with {
    briefly "Container unloaded"
    described as {
      |Emitted when unloaded from train.
    }
  }
  event ContainerOutgated is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    containerNumber: String(1,20) with {
      briefly "Container"
      described as {
        |Container.
      }
    }
    outgatedAt: TimeStamp with {
      briefly "Outgated"
      described as {
        |Outgate time.
      }
    }
    driver: String(1,200) with {
      briefly "Driver"
      described as {
        |Driver name.
      }
    }
    outgateChassisNumber: String(1,20)? with {
      briefly "Chassis"
      described as {
        |Chassis number.
      }
    }
  } with {
    briefly "Container outgated"
    described as {
      |Emitted when container leaves terminal.
    }
  }
} with {
  option external()
  briefly "External TOS"
  described as {
    |Intermodal terminal operating system.
  }
}
// Chassis Pool Service
context ChassisPoolService is {
  query GetChassisAvailability is  {
    terminalId: TerminalId with {
      briefly "Terminal"
      described as {
        |Terminal ID.
      }
    }
    chassisSize: Natural with {
      briefly "Size"
      described as {
        |Chassis size (feet).
      }
    }
  } with {
    briefly "Get chassis availability"
    described as {
      |Queries chassis pool availability.
    }
  }
  result ChassisAvailabilityResult is  {
    available: Natural with {
      briefly "Available"
      described as {
        |Available count.
      }
    }
    poolName: String(1,100) with {
      briefly "Pool"
      described as {
        |Chassis pool name.
      }
    }
  } with {
    briefly "Chassis availability"
    described as {
      |Chassis pool availability.
    }
  }
  command ReserveChassis is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    terminalId: TerminalId with {
      briefly "Terminal"
      described as {
        |Terminal ID.
      }
    }
    chassisSize: Natural with {
      briefly "Size"
      described as {
        |Chassis size.
      }
    }
    neededFrom: TimeStamp with {
      briefly "From"
      described as {
        |Need from.
      }
    }
    neededTo: TimeStamp with {
      briefly "To"
      described as {
        |Need until.
      }
    }
  } with {
    briefly "Reserve chassis"
    described as {
      |Reserves chassis from pool.
    }
  }
  event ChassisReserved is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    chassisNumber: String(1,20) with {
      briefly "Chassis"
      described as {
        |Chassis number.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Chassis reserved"
    described as {
      |Emitted when chassis is reserved.
    }
  }
  event ChassisReturned is  {
    moveId: MoveId with {
      briefly "Move"
      described as {
        |Move ID.
      }
    }
    chassisNumber: String(1,20) with {
      briefly "Chassis"
      described as {
        |Chassis number.
      }
    }
    returnedAt: TimeStamp with {
      briefly "Returned"
      described as {
        |Return time.
      }
    }
    location: String(1,200) with {
      briefly "Location"
      described as {
        |Return location.
      }
    }
  } with {
    briefly "Chassis returned"
    described as {
      |Emitted when chassis is returned.
    }
  }
} with {
  option external()
  briefly "External chassis pool"
  described as {
    |Chassis pool management service.
  }
}
// Rating Service
context IntermodalRatingService is {
  query GetRates is  {
    originZip: String(5,5) with {
      briefly "Origin"
      described as {
        |Origin ZIP.
      }
    }
    destinationZip: String(5,5) with {
      briefly "Destination"
      described as {
        |Destination ZIP.
      }
    }
    containerType: ContainerType with {
      briefly "Type"
      described as {
        |Container type.
      }
    }
    weight: Decimal(10,2) with {
      briefly "Weight"
      described as {
        |Cargo weight.
      }
    }
  } with {
    briefly "Get rates"
    described as {
      |Queries intermodal rates.
    }
  }
  result RatesResult is  {
    charges: MoveCharges with {
      briefly "Charges"
      described as {
        |Rate breakdown.
      }
    }
    transitDays: Natural with {
      briefly "Transit"
      described as {
        |Transit days.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Rate effective date.
      }
    }
    expirationDate: Date with {
      briefly "Expiration"
      described as {
        |Rate expiration.
      }
    }
  } with {
    briefly "Rates result"
    described as {
      |Intermodal rate quote.
    }
  }
} with {
  option external()
  briefly "External rating"
  described as {
    |Intermodal rate quoting service.
  }
}
