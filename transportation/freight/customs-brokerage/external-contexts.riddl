// Customs Brokerage - External Contexts
// CBP ACE Portal Service
context CBPAceService is {
  command SubmitEntry is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    entryData: String(1,50000) with {
      briefly "Data"
      described as {
        |Entry XML/JSON.
      }
    }
    brokerId: BrokerId with {
      briefly "Broker"
      described as {
        |Broker ID.
      }
    }
  } with {
    briefly "Submit entry"
    described as {
      |Submits entry to ACE.
    }
  }
  event EntryAcknowledged is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    entryNumber: String(1,50) with {
      briefly "Number"
      described as {
        |CBP entry number.
      }
    }
    acknowledgedAt: TimeStamp with {
      briefly "Acknowledged"
      described as {
        |Acknowledgment time.
      }
    }
  } with {
    briefly "Entry acknowledged"
    described as {
      |Emitted when ACE acknowledges entry.
    }
  }
  event EntryAccepted is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    acceptedAt: TimeStamp with {
      briefly "Accepted"
      described as {
        |Acceptance time.
      }
    }
  } with {
    briefly "Entry accepted"
    described as {
      |Emitted when entry is accepted.
    }
  }
  event EntryRejected is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    rejectCodes: String(1,20)+ with {
      briefly "Codes"
      described as {
        |Reject codes.
      }
    }
    rejectMessages: String(1,500)+ with {
      briefly "Messages"
      described as {
        |Reject messages.
      }
    }
    rejectedAt: TimeStamp with {
      briefly "Rejected"
      described as {
        |Rejection time.
      }
    }
  } with {
    briefly "Entry rejected"
    described as {
      |Emitted when entry is rejected.
    }
  }
  event HoldNotification is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    holdType: String(1,50) with {
      briefly "Type"
      described as {
        |Hold type.
      }
    }
    holdReason: String(1,500) with {
      briefly "Reason"
      described as {
        |Hold reason.
      }
    }
    notifiedAt: TimeStamp with {
      briefly "Notified"
      described as {
        |Notification time.
      }
    }
  } with {
    briefly "Hold notification"
    described as {
      |Emitted when hold is placed.
    }
  }
  event ReleaseNotification is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    releaseDate: Date with {
      briefly "Released"
      described as {
        |Release date.
      }
    }
    releaseType: String(1,50) with {
      briefly "Type"
      described as {
        |Release type.
      }
    }
  } with {
    briefly "Release notification"
    described as {
      |Emitted when cargo is released.
    }
  }
  command QueryEntryStatus is  {
    entryNumber: String(1,50) with {
      briefly "Number"
      described as {
        |Entry number.
      }
    }
  } with {
    briefly "Query entry status"
    described as {
      |Queries entry status in ACE.
    }
  }
  result EntryStatusResult is  {
    status: EntryStatus with {
      briefly "Status"
      described as {
        |Entry status.
      }
    }
    lastUpdated: TimeStamp with {
      briefly "Updated"
      described as {
        |Last update time.
      }
    }
    messages: String(1,500)* with {
      briefly "Messages"
      described as {
        |Status messages.
      }
    }
  } with {
    briefly "Entry status result"
    described as {
      |Entry status from ACE.
    }
  }
} with {
  option external()
  briefly "External CBP ACE"
  described as {
    |US Customs ACE system integration.
  }
}
// PGA Partner Service
context PGAPartnerService is {
  command SubmitPGAData is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    agencyCode: String(1,10) with {
      briefly "Agency"
      described as {
        |PGA agency code.
      }
    }
    pgaData: String(1,20000) with {
      briefly "Data"
      described as {
        |PGA submission data.
      }
    }
  } with {
    briefly "Submit PGA data"
    described as {
      |Submits data to partner government agency.
    }
  }
  event PGAResponseReceived is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    agencyCode: String(1,10) with {
      briefly "Agency"
      described as {
        |Agency code.
      }
    }
    responseCode: String(1,10) with {
      briefly "Code"
      described as {
        |Response code.
      }
    }
    responseMessage: String(1,500) with {
      briefly "Message"
      described as {
        |Response message.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Response time.
      }
    }
  } with {
    briefly "PGA response"
    described as {
      |Emitted when PGA responds.
    }
  }
  event PGAMayProceed is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    agencyCode: String(1,10) with {
      briefly "Agency"
      described as {
        |Agency code.
      }
    }
    clearedAt: TimeStamp with {
      briefly "Cleared"
      described as {
        |Clearance time.
      }
    }
  } with {
    briefly "PGA may proceed"
    described as {
      |Emitted when PGA clears goods.
    }
  }
  event PGAHold is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    agencyCode: String(1,10) with {
      briefly "Agency"
      described as {
        |Agency code.
      }
    }
    holdReason: String(1,500) with {
      briefly "Reason"
      described as {
        |Hold reason.
      }
    }
    heldAt: TimeStamp with {
      briefly "Held"
      described as {
        |Hold time.
      }
    }
  } with {
    briefly "PGA hold"
    described as {
      |Emitted when PGA places hold.
    }
  }
} with {
  option external()
  briefly "External PGA"
  described as {
    |Partner government agency integration (FDA, USDA, etc.).
  }
}
// Duty Payment Service
context DutyPaymentService is {
  command SubmitPayment is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    payment: DutyPayment with {
      briefly "Payment"
      described as {
        |Payment details.
      }
    }
    payerAccount: String(1,50) with {
      briefly "Account"
      described as {
        |Payer account.
      }
    }
  } with {
    briefly "Submit payment"
    described as {
      |Submits duty payment.
    }
  }
  event PaymentConfirmed is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    confirmationNumber: String(1,50) with {
      briefly "Confirmation"
      described as {
        |Payment confirmation.
      }
    }
    confirmedAt: TimeStamp with {
      briefly "Confirmed"
      described as {
        |Confirmation time.
      }
    }
  } with {
    briefly "Payment confirmed"
    described as {
      |Emitted when payment is confirmed.
    }
  }
  event PaymentFailed is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    failureReason: String(1,500) with {
      briefly "Reason"
      described as {
        |Failure reason.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |Failure time.
      }
    }
  } with {
    briefly "Payment failed"
    described as {
      |Emitted when payment fails.
    }
  }
  command RequestRefund is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    refundAmount: Decimal(12,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Refund reason.
      }
    }
  } with {
    briefly "Request refund"
    described as {
      |Requests duty refund.
    }
  }
  event RefundProcessed is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    refundAmount: Decimal(12,2) with {
      briefly "Amount"
      described as {
        |Refund amount.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Process time.
      }
    }
  } with {
    briefly "Refund processed"
    described as {
      |Emitted when refund is processed.
    }
  }
} with {
  option external()
  briefly "External duty payment"
  described as {
    |CBP duty payment service (ACH/PayGov).
  }
}
// HTS Classification Service
context HTSClassificationService is {
  query ClassifyProduct is  {
    description: String(1,1000) with {
      briefly "Description"
      described as {
        |Product description.
      }
    }
    countryOfOrigin: String(2,3) with {
      briefly "Origin"
      described as {
        |Country of origin.
      }
    }
    materialComposition: String(1,500)? with {
      briefly "Materials"
      described as {
        |Material composition.
      }
    }
  } with {
    briefly "Classify product"
    described as {
      |Gets HTS classification.
    }
  }
  result ClassificationResult is  {
    htsCode: String(8,10) with {
      briefly "HTS"
      described as {
        |HTS code.
      }
    }
    description: String(1,500) with {
      briefly "Description"
      described as {
        |Tariff description.
      }
    }
    dutyRate: Decimal(8,4) with {
      briefly "Rate"
      described as {
        |General duty rate.
      }
    }
    specialRates: String(1,100)* with {
      briefly "Special"
      described as {
        |Special program rates.
      }
    }
    confidence: Decimal(3,2) with {
      briefly "Confidence"
      described as {
        |Classification confidence.
      }
    }
  } with {
    briefly "Classification result"
    described as {
      |HTS classification details.
    }
  }
  query GetRuling is  {
    htsCode: String(8,10) with {
      briefly "HTS"
      described as {
        |HTS code.
      }
    }
    productDescription: String(1,500) with {
      briefly "Description"
      described as {
        |Product description.
      }
    }
  } with {
    briefly "Get ruling"
    described as {
      |Queries binding rulings.
    }
  }
  result RulingResult is  {
    rulingNumber: String(1,50)? with {
      briefly "Number"
      described as {
        |Ruling number.
      }
    }
    rulingText: String(1,5000)? with {
      briefly "Text"
      described as {
        |Ruling text.
      }
    }
    htsCode: String(8,10) with {
      briefly "HTS"
      described as {
        |Ruled HTS code.
      }
    }
  } with {
    briefly "Ruling result"
    described as {
      |Binding ruling details.
    }
  }
} with {
  option external()
  briefly "External HTS classification"
  described as {
    |Tariff classification service.
  }
}
// Trade Agreement Service
context TradeAgreementService is {
  query CheckEligibility is  {
    htsCode: String(8,10) with {
      briefly "HTS"
      described as {
        |HTS code.
      }
    }
    countryOfOrigin: String(2,3) with {
      briefly "Origin"
      described as {
        |Country of origin.
      }
    }
    agreement: String(1,50) with {
      briefly "Agreement"
      described as {
        |Trade agreement code.
      }
    }
  } with {
    briefly "Check eligibility"
    described as {
      |Checks trade agreement eligibility.
    }
  }
  result EligibilityResult is  {
    eligible: Boolean with {
      briefly "Eligible"
      described as {
        |Is eligible.
      }
    }
    preferentialRate: Decimal(8,4)? with {
      briefly "Rate"
      described as {
        |Preferential rate.
      }
    }
    requirements: String(1,500)* with {
      briefly "Requirements"
      described as {
        |Documentation requirements.
      }
    }
    ruleOfOrigin: String(1,500)? with {
      briefly "Rule"
      described as {
        |Rule of origin.
      }
    }
  } with {
    briefly "Eligibility result"
    described as {
      |Trade agreement eligibility.
    }
  }
  query GetCertificateRequirements is  {
    agreement: String(1,50) with {
      briefly "Agreement"
      described as {
        |Trade agreement.
      }
    }
  } with {
    briefly "Get certificate requirements"
    described as {
      |Queries certificate of origin requirements.
    }
  }
  result CertificateRequirementsResult is  {
    certificateFormat: String(1,100) with {
      briefly "Format"
      described as {
        |Required format.
      }
    }
    requiredFields: String(1,200)+ with {
      briefly "Fields"
      described as {
        |Required fields.
      }
    }
    validityPeriod: Duration with {
      briefly "Validity"
      described as {
        |Certificate validity.
      }
    }
  } with {
    briefly "Certificate requirements"
    described as {
      |Certificate requirements details.
    }
  }
} with {
  option external()
  briefly "External trade agreement"
  described as {
    |Trade agreement verification service.
  }
}
// Document Management Service
context DocumentManagementService is {
  command UploadDocument is  {
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    documentType: DocumentType with {
      briefly "Type"
      described as {
        |Document type.
      }
    }
    fileContent: String(1,100000) with {
      briefly "Content"
      described as {
        |Base64 file content.
      }
    }
    fileName: String(1,200) with {
      briefly "Name"
      described as {
        |File name.
      }
    }
  } with {
    briefly "Upload document"
    described as {
      |Uploads supporting document.
    }
  }
  event DocumentUploaded is  {
    documentId: UUID with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
    entryId: EntryId with {
      briefly "Entry"
      described as {
        |Entry ID.
      }
    }
    fileReference: String(1,500) with {
      briefly "Reference"
      described as {
        |File reference.
      }
    }
    uploadedAt: TimeStamp with {
      briefly "Uploaded"
      described as {
        |Upload time.
      }
    }
  } with {
    briefly "Document uploaded"
    described as {
      |Emitted when document is uploaded.
    }
  }
  query GetDocument is  {
    documentId: UUID with {
      briefly "Document"
      described as {
        |Document ID.
      }
    }
  } with {
    briefly "Get document"
    described as {
      |Retrieves document.
    }
  }
  result DocumentResult is  {
    documentType: DocumentType with {
      briefly "Type"
      described as {
        |Document type.
      }
    }
    fileName: String(1,200) with {
      briefly "Name"
      described as {
        |File name.
      }
    }
    fileContent: String(1,100000) with {
      briefly "Content"
      described as {
        |Base64 content.
      }
    }
    uploadedAt: TimeStamp with {
      briefly "Uploaded"
      described as {
        |Upload time.
      }
    }
  } with {
    briefly "Document result"
    described as {
      |Document details.
    }
  }
} with {
  option external()
  briefly "External document management"
  described as {
    |Document storage and retrieval service.
  }
}
