// Customs Brokerage - External Contexts

// CBP ACE Portal Service
context CBPAceService is {

  command SubmitEntry is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    entryData is String(1, 50000) with { briefly "Data" described by "Entry XML/JSON." }
    brokerId is BrokerId with { briefly "Broker" described by "Broker ID." }
  } with {
    briefly "Submit entry"
    described by "Submits entry to ACE."
  }

  event EntryAcknowledged is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    entryNumber is String(1, 50) with { briefly "Number" described by "CBP entry number." }
    acknowledgedAt is TimeStamp with { briefly "Acknowledged" described by "Acknowledgment time." }
  } with {
    briefly "Entry acknowledged"
    described by "Emitted when ACE acknowledges entry."
  }

  event EntryAccepted is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    acceptedAt is TimeStamp with { briefly "Accepted" described by "Acceptance time." }
  } with {
    briefly "Entry accepted"
    described by "Emitted when entry is accepted."
  }

  event EntryRejected is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    rejectCodes is many String(1, 20) with { briefly "Codes" described by "Reject codes." }
    rejectMessages is many String(1, 500) with { briefly "Messages" described by "Reject messages." }
    rejectedAt is TimeStamp with { briefly "Rejected" described by "Rejection time." }
  } with {
    briefly "Entry rejected"
    described by "Emitted when entry is rejected."
  }

  event HoldNotification is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    holdType is String(1, 50) with { briefly "Type" described by "Hold type." }
    holdReason is String(1, 500) with { briefly "Reason" described by "Hold reason." }
    notifiedAt is TimeStamp with { briefly "Notified" described by "Notification time." }
  } with {
    briefly "Hold notification"
    described by "Emitted when hold is placed."
  }

  event ReleaseNotification is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    releaseDate is Date with { briefly "Released" described by "Release date." }
    releaseType is String(1, 50) with { briefly "Type" described by "Release type." }
  } with {
    briefly "Release notification"
    described by "Emitted when cargo is released."
  }

  command QueryEntryStatus is {
    entryNumber is String(1, 50) with { briefly "Number" described by "Entry number." }
  } with {
    briefly "Query entry status"
    described by "Queries entry status in ACE."
  }

  result EntryStatusResult is {
    status is EntryStatus with { briefly "Status" described by "Entry status." }
    lastUpdated is TimeStamp with { briefly "Updated" described by "Last update time." }
    messages is many optional String(1, 500) with { briefly "Messages" described by "Status messages." }
  } with {
    briefly "Entry status result"
    described by "Entry status from ACE."
  }

} with {
  option is external
  briefly "External CBP ACE"
  described by "US Customs ACE system integration."
}

// PGA Partner Service
context PGAPartnerService is {

  command SubmitPGAData is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    agencyCode is String(1, 10) with { briefly "Agency" described by "PGA agency code." }
    pgaData is String(1, 20000) with { briefly "Data" described by "PGA submission data." }
  } with {
    briefly "Submit PGA data"
    described by "Submits data to partner government agency."
  }

  event PGAResponseReceived is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    agencyCode is String(1, 10) with { briefly "Agency" described by "Agency code." }
    responseCode is String(1, 10) with { briefly "Code" described by "Response code." }
    responseMessage is String(1, 500) with { briefly "Message" described by "Response message." }
    receivedAt is TimeStamp with { briefly "Received" described by "Response time." }
  } with {
    briefly "PGA response"
    described by "Emitted when PGA responds."
  }

  event PGAMayProceed is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    agencyCode is String(1, 10) with { briefly "Agency" described by "Agency code." }
    clearedAt is TimeStamp with { briefly "Cleared" described by "Clearance time." }
  } with {
    briefly "PGA may proceed"
    described by "Emitted when PGA clears goods."
  }

  event PGAHold is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    agencyCode is String(1, 10) with { briefly "Agency" described by "Agency code." }
    holdReason is String(1, 500) with { briefly "Reason" described by "Hold reason." }
    heldAt is TimeStamp with { briefly "Held" described by "Hold time." }
  } with {
    briefly "PGA hold"
    described by "Emitted when PGA places hold."
  }

} with {
  option is external
  briefly "External PGA"
  described by "Partner government agency integration (FDA, USDA, etc.)."
}

// Duty Payment Service
context DutyPaymentService is {

  command SubmitPayment is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    payment is DutyPayment with { briefly "Payment" described by "Payment details." }
    payerAccount is String(1, 50) with { briefly "Account" described by "Payer account." }
  } with {
    briefly "Submit payment"
    described by "Submits duty payment."
  }

  event PaymentConfirmed is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    confirmationNumber is String(1, 50) with { briefly "Confirmation" described by "Payment confirmation." }
    confirmedAt is TimeStamp with { briefly "Confirmed" described by "Confirmation time." }
  } with {
    briefly "Payment confirmed"
    described by "Emitted when payment is confirmed."
  }

  event PaymentFailed is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    failureReason is String(1, 500) with { briefly "Reason" described by "Failure reason." }
    failedAt is TimeStamp with { briefly "Failed" described by "Failure time." }
  } with {
    briefly "Payment failed"
    described by "Emitted when payment fails."
  }

  command RequestRefund is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    refundAmount is Decimal(12, 2) with { briefly "Amount" described by "Refund amount." }
    reason is String(1, 500) with { briefly "Reason" described by "Refund reason." }
  } with {
    briefly "Request refund"
    described by "Requests duty refund."
  }

  event RefundProcessed is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    refundAmount is Decimal(12, 2) with { briefly "Amount" described by "Refund amount." }
    processedAt is TimeStamp with { briefly "Processed" described by "Process time." }
  } with {
    briefly "Refund processed"
    described by "Emitted when refund is processed."
  }

} with {
  option is external
  briefly "External duty payment"
  described by "CBP duty payment service (ACH/PayGov)."
}

// HTS Classification Service
context HTSClassificationService is {

  query ClassifyProduct is {
    description is String(1, 1000) with { briefly "Description" described by "Product description." }
    countryOfOrigin is String(2, 3) with { briefly "Origin" described by "Country of origin." }
    materialComposition is optional String(1, 500) with { briefly "Materials" described by "Material composition." }
  } with {
    briefly "Classify product"
    described by "Gets HTS classification."
  }

  result ClassificationResult is {
    htsCode is String(8, 10) with { briefly "HTS" described by "HTS code." }
    description is String(1, 500) with { briefly "Description" described by "Tariff description." }
    dutyRate is Decimal(8, 4) with { briefly "Rate" described by "General duty rate." }
    specialRates is many optional String(1, 100) with { briefly "Special" described by "Special program rates." }
    confidence is Decimal(3, 2) with { briefly "Confidence" described by "Classification confidence." }
  } with {
    briefly "Classification result"
    described by "HTS classification details."
  }

  query GetRuling is {
    htsCode is String(8, 10) with { briefly "HTS" described by "HTS code." }
    productDescription is String(1, 500) with { briefly "Description" described by "Product description." }
  } with {
    briefly "Get ruling"
    described by "Queries binding rulings."
  }

  result RulingResult is {
    rulingNumber is optional String(1, 50) with { briefly "Number" described by "Ruling number." }
    rulingText is optional String(1, 5000) with { briefly "Text" described by "Ruling text." }
    htsCode is String(8, 10) with { briefly "HTS" described by "Ruled HTS code." }
  } with {
    briefly "Ruling result"
    described by "Binding ruling details."
  }

} with {
  option is external
  briefly "External HTS classification"
  described by "Tariff classification service."
}

// Trade Agreement Service
context TradeAgreementService is {

  query CheckEligibility is {
    htsCode is String(8, 10) with { briefly "HTS" described by "HTS code." }
    countryOfOrigin is String(2, 3) with { briefly "Origin" described by "Country of origin." }
    agreement is String(1, 50) with { briefly "Agreement" described by "Trade agreement code." }
  } with {
    briefly "Check eligibility"
    described by "Checks trade agreement eligibility."
  }

  result EligibilityResult is {
    eligible is Boolean with { briefly "Eligible" described by "Is eligible." }
    preferentialRate is optional Decimal(8, 4) with { briefly "Rate" described by "Preferential rate." }
    requirements is many optional String(1, 500) with { briefly "Requirements" described by "Documentation requirements." }
    ruleOfOrigin is optional String(1, 500) with { briefly "Rule" described by "Rule of origin." }
  } with {
    briefly "Eligibility result"
    described by "Trade agreement eligibility."
  }

  query GetCertificateRequirements is {
    agreement is String(1, 50) with { briefly "Agreement" described by "Trade agreement." }
  } with {
    briefly "Get certificate requirements"
    described by "Queries certificate of origin requirements."
  }

  result CertificateRequirementsResult is {
    certificateFormat is String(1, 100) with { briefly "Format" described by "Required format." }
    requiredFields is many String(1, 200) with { briefly "Fields" described by "Required fields." }
    validityPeriod is Duration with { briefly "Validity" described by "Certificate validity." }
  } with {
    briefly "Certificate requirements"
    described by "Certificate requirements details."
  }

} with {
  option is external
  briefly "External trade agreement"
  described by "Trade agreement verification service."
}

// Document Management Service
context DocumentManagementService is {

  command UploadDocument is {
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    documentType is DocumentType with { briefly "Type" described by "Document type." }
    fileContent is String(1, 100000) with { briefly "Content" described by "Base64 file content." }
    fileName is String(1, 200) with { briefly "Name" described by "File name." }
  } with {
    briefly "Upload document"
    described by "Uploads supporting document."
  }

  event DocumentUploaded is {
    documentId is UUID with { briefly "Document" described by "Document ID." }
    entryId is EntryId with { briefly "Entry" described by "Entry ID." }
    fileReference is String(1, 500) with { briefly "Reference" described by "File reference." }
    uploadedAt is TimeStamp with { briefly "Uploaded" described by "Upload time." }
  } with {
    briefly "Document uploaded"
    described by "Emitted when document is uploaded."
  }

  query GetDocument is {
    documentId is UUID with { briefly "Document" described by "Document ID." }
  } with {
    briefly "Get document"
    described by "Retrieves document."
  }

  result DocumentResult is {
    documentType is DocumentType with { briefly "Type" described by "Document type." }
    fileName is String(1, 200) with { briefly "Name" described by "File name." }
    fileContent is String(1, 100000) with { briefly "Content" described by "Base64 content." }
    uploadedAt is TimeStamp with { briefly "Uploaded" described by "Upload time." }
  } with {
    briefly "Document result"
    described by "Document details."
  }

} with {
  option is external
  briefly "External document management"
  described by "Document storage and retrieval service."
}
