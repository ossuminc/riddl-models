// Ride Sharing - Ride Context
context RideContext is {
  include "types.riddl"
  include "Ride.riddl"
  // Repository for ride persistence
  repository RideRepository is {
    schema RideData is relational
      of rides as type Ride
        index on field Ride.rideId
        index on field Ride.rider.riderId
        index on field Ride.status

    handler RidePersistence is {
      on command Ride.RequestRide is {
        prompt "Store new ride request"
      }
      on command Ride.AssignDriver is {
        prompt "Update driver assignment"
      }
      on command Ride.DriverEnRoute is {
        prompt "Update driver location"
      }
      on command Ride.DriverArrived is {
        prompt "Update arrival status"
      }
      on command Ride.StartTrip is {
        prompt "Update to in progress"
      }
      on command Ride.UpdateLocation is {
        prompt "Store location update"
      }
      on command Ride.CompleteTrip is {
        prompt "Store trip completion"
      }
      on command Ride.ProcessPayment is {
        prompt "Store payment"
      }
      on command Ride.RateRide is {
        prompt "Store ratings"
      }
      on command Ride.CancelRide is {
        prompt "Update to cancelled"
      }
    } with {
      briefly "Persists ride commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Ride data persistence"
    described as {
      | The RideRepository provides persistent storage for
      | rides, trips, and ratings.
    }
  }
  // Projector for ride analytics
  projector RideAnalytics is {
    record RideStats is  {
      activeRides: Natural with {
        briefly "Active"
        described as {
          |Active rides.
        }
      }
      ridesCompletedToday: Natural with {
        briefly "Completed"
        described as {
          |Rides completed today.
        }
      }
      averageFare: Decimal(10,2) with {
        briefly "Avg fare"
        described as {
          |Average fare.
        }
      }
      averageRating: Decimal(2,1) with {
        briefly "Avg rating"
        described as {
          |Average driver rating.
        }
      }
      cancellationRate: Decimal(5,4) with {
        briefly "Cancellation"
        described as {
          |Cancellation rate.
        }
      }
      averageWaitTime: Natural with {
        briefly "Wait time"
        described as {
          |Average wait time (min).
        }
      }
    } with {
      briefly "Ride statistics"
      described as {
        |Ride-sharing metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Ride.RideRequested is {
        prompt "Update request counts"
      }
      on event Ride.TripCompleted is {
        prompt "Update completion metrics"
      }
      on event Ride.RideRated is {
        prompt "Update rating metrics"
      }
      on event Ride.RideCancelled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains ride analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Ride analytics projections"
    described as {
      |Maintains ride-sharing analytics data.
    }
  }
} with {
  briefly "Bounded context for ride sharing"
  described as {
    | The RideContext is the bounded context for
    | on-demand ride management.
  }
}
