// Apparel Manufacturing - CutOrder Entity
entity CutOrder is {
  // Commands
  command CreateCutOrder is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |New cut order identifier.
      }
    }
    styleSpec: GarmentSpec with {
      briefly "Style spec"
      described as {
        |Garment style specification.
      }
    }
    marker: CutMarker with {
      briefly "Marker"
      described as {
        |Cutting marker layout.
      }
    }
    orderQuantity: Natural with {
      briefly "Order quantity"
      described as {
        |Total garments to produce.
      }
    }
    priority: OrderPriority with {
      briefly "Priority"
      described as {
        |Order priority level.
      }
    }
    dueDate: Date with {
      briefly "Due date"
      described as {
        |Production due date.
      }
    }
    salesOrderRef: String(1,50) with {
      briefly "Sales order"
      described as {
        |Reference to sales order.
      }
    }
  } with {
    briefly "Create cut order"
    described as {
      |Creates a new cut order for garment production.
    }
  }
  command GenerateMarker is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |Cut order identifier.
      }
    }
    marker: CutMarker with {
      briefly "Marker"
      described as {
        |Generated marker layout.
      }
    }
    generatedBy: OperatorId with {
      briefly "Generated by"
      described as {
        |Person generating marker.
      }
    }
  } with {
    briefly "Generate marker"
    described as {
      |Generates or updates the cutting marker.
    }
  }
  command CutFabric is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |Cut order identifier.
      }
    }
    cutBy: OperatorId with {
      briefly "Cut by"
      described as {
        |Cutting operator.
      }
    }
    layersSpread: Natural with {
      briefly "Layers"
      described as {
        |Number of layers spread.
      }
    }
    fabricRollIds: String(1,50)+ with {
      briefly "Fabric rolls"
      described as {
        |Fabric rolls consumed.
      }
    }
    wastePercent: Decimal(5,2) with {
      briefly "Waste"
      described as {
        |Fabric waste percentage.
      }
    }
  } with {
    briefly "Cut fabric"
    described as {
      |Records fabric cutting completion.
    }
  }
  command CreateBundles is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |Cut order identifier.
      }
    }
    bundles: Bundle+ with {
      briefly "Bundles"
      described as {
        |Bundles created from cut pieces.
      }
    }
    bundledBy: OperatorId with {
      briefly "Bundled by"
      described as {
        |Person creating bundles.
      }
    }
  } with {
    briefly "Create bundles"
    described as {
      |Creates production bundles from cut pieces.
    }
  }
  command AssignBundle is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |Cut order identifier.
      }
    }
    bundleId: BundleId with {
      briefly "Bundle ID"
      described as {
        |Bundle to assign.
      }
    }
    operatorId: OperatorId with {
      briefly "Operator"
      described as {
        |Sewing operator to assign.
      }
    }
    assignedBy: OperatorId with {
      briefly "Assigned by"
      described as {
        |Supervisor assigning bundle.
      }
    }
  } with {
    briefly "Assign bundle"
    described as {
      |Assigns a bundle to a sewing operator.
    }
  }
  command CompleteSewing is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |Cut order identifier.
      }
    }
    bundleId: BundleId with {
      briefly "Bundle ID"
      described as {
        |Bundle completed.
      }
    }
    operatorId: OperatorId with {
      briefly "Operator"
      described as {
        |Sewing operator.
      }
    }
    completedCount: Natural with {
      briefly "Completed"
      described as {
        |Pieces completed.
      }
    }
    defectCount: Natural with {
      briefly "Defects"
      described as {
        |Pieces with defects.
      }
    }
    actualMinutes: Decimal(8,2) with {
      briefly "Actual minutes"
      described as {
        |Actual time spent.
      }
    }
  } with {
    briefly "Complete sewing"
    described as {
      |Records sewing completion for a bundle.
    }
  }
  command CompleteTrimming is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |Cut order identifier.
      }
    }
    bundleId: BundleId with {
      briefly "Bundle ID"
      described as {
        |Bundle completed.
      }
    }
    operatorId: OperatorId with {
      briefly "Operator"
      described as {
        |Trim operator.
      }
    }
    trimsApplied: TrimOperation+ with {
      briefly "Trims applied"
      described as {
        |Trim operations completed.
      }
    }
    actualMinutes: Decimal(8,2) with {
      briefly "Actual minutes"
      described as {
        |Actual time spent.
      }
    }
  } with {
    briefly "Complete trimming"
    described as {
      |Records trimming completion for a bundle.
    }
  }
  command RecordQualityCheck is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |Cut order identifier.
      }
    }
    inspection: QualityInspection with {
      briefly "Inspection"
      described as {
        |Quality inspection result.
      }
    }
  } with {
    briefly "Record quality check"
    described as {
      |Records quality inspection for a bundle.
    }
  }
  command PackGarments is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |Cut order identifier.
      }
    }
    packingInfo: PackingInfo with {
      briefly "Packing info"
      described as {
        |Carton packing details.
      }
    }
    bundleIds: BundleId+ with {
      briefly "Bundle IDs"
      described as {
        |Bundles included in packing.
      }
    }
  } with {
    briefly "Pack garments"
    described as {
      |Packs finished garments into cartons.
    }
  }
  command CancelCutOrder is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order ID"
      described as {
        |Cut order to cancel.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
    cancelledBy: OperatorId with {
      briefly "Cancelled by"
      described as {
        |Person cancelling order.
      }
    }
  } with {
    briefly "Cancel cut order"
    described as {
      |Cancels a cut order.
    }
  }
  // Events
  event CutOrderCreated is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    styleSpec: GarmentSpec with {
      briefly "Style"
      described as {
        |Style specification.
      }
    }
    marker: CutMarker with {
      briefly "Marker"
      described as {
        |Cutting marker.
      }
    }
    orderQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Order quantity.
      }
    }
    priority: OrderPriority with {
      briefly "Priority"
      described as {
        |Order priority.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due date.
      }
    }
    salesOrderRef: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order reference.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation timestamp.
      }
    }
  } with {
    briefly "Cut order created"
    described as {
      |Emitted when a cut order is created.
    }
  }
  event MarkerGenerated is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    marker: CutMarker with {
      briefly "Marker"
      described as {
        |Generated marker.
      }
    }
    generatedBy: OperatorId with {
      briefly "Generated by"
      described as {
        |Generator.
      }
    }
    generatedAt: TimeStamp with {
      briefly "Generated"
      described as {
        |Generation time.
      }
    }
  } with {
    briefly "Marker generated"
    described as {
      |Emitted when cutting marker is generated.
    }
  }
  event FabricCut is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    cutBy: OperatorId with {
      briefly "Cut by"
      described as {
        |Cutting operator.
      }
    }
    layersSpread: Natural with {
      briefly "Layers"
      described as {
        |Layers spread.
      }
    }
    fabricRollIds: String(1,50)+ with {
      briefly "Rolls"
      described as {
        |Fabric rolls used.
      }
    }
    wastePercent: Decimal(5,2) with {
      briefly "Waste"
      described as {
        |Waste percentage.
      }
    }
    cutAt: TimeStamp with {
      briefly "Cut at"
      described as {
        |Cutting timestamp.
      }
    }
  } with {
    briefly "Fabric cut"
    described as {
      |Emitted when fabric cutting is completed.
    }
  }
  event BundlesCreated is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    bundles: Bundle+ with {
      briefly "Bundles"
      described as {
        |Created bundles.
      }
    }
    bundledBy: OperatorId with {
      briefly "Bundled by"
      described as {
        |Bundler.
      }
    }
    bundledAt: TimeStamp with {
      briefly "Bundled"
      described as {
        |Bundle creation time.
      }
    }
  } with {
    briefly "Bundles created"
    described as {
      |Emitted when bundles are created.
    }
  }
  event BundleAssigned is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    bundleId: BundleId with {
      briefly "Bundle"
      described as {
        |Assigned bundle.
      }
    }
    operatorId: OperatorId with {
      briefly "Operator"
      described as {
        |Assigned operator.
      }
    }
    assignedBy: OperatorId with {
      briefly "Assigned by"
      described as {
        |Supervisor.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Bundle assigned"
    described as {
      |Emitted when a bundle is assigned to an operator.
    }
  }
  event SewingCompleted is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    bundleId: BundleId with {
      briefly "Bundle"
      described as {
        |Completed bundle.
      }
    }
    operatorId: OperatorId with {
      briefly "Operator"
      described as {
        |Sewing operator.
      }
    }
    completedCount: Natural with {
      briefly "Completed"
      described as {
        |Pieces completed.
      }
    }
    defectCount: Natural with {
      briefly "Defects"
      described as {
        |Defect count.
      }
    }
    actualMinutes: Decimal(8,2) with {
      briefly "Minutes"
      described as {
        |Time spent.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Sewing completed"
    described as {
      |Emitted when sewing is completed for a bundle.
    }
  }
  event TrimmingCompleted is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    bundleId: BundleId with {
      briefly "Bundle"
      described as {
        |Completed bundle.
      }
    }
    operatorId: OperatorId with {
      briefly "Operator"
      described as {
        |Trim operator.
      }
    }
    trimsApplied: TrimOperation+ with {
      briefly "Trims"
      described as {
        |Trims applied.
      }
    }
    actualMinutes: Decimal(8,2) with {
      briefly "Minutes"
      described as {
        |Time spent.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Trimming completed"
    described as {
      |Emitted when trimming is completed for a bundle.
    }
  }
  event QualityCheckRecorded is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    inspection: QualityInspection with {
      briefly "Inspection"
      described as {
        |Inspection result.
      }
    }
  } with {
    briefly "Quality check recorded"
    described as {
      |Emitted when quality inspection is recorded.
    }
  }
  event GarmentsPacked is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    packingInfo: PackingInfo with {
      briefly "Packing"
      described as {
        |Packing details.
      }
    }
    bundleIds: BundleId+ with {
      briefly "Bundles"
      described as {
        |Packed bundles.
      }
    }
  } with {
    briefly "Garments packed"
    described as {
      |Emitted when garments are packed.
    }
  }
  event CutOrderCancelled is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
    cancelledBy: OperatorId with {
      briefly "Cancelled by"
      described as {
        |Canceller.
      }
    }
    cancelledAt: TimeStamp with {
      briefly "Cancelled"
      described as {
        |Cancellation time.
      }
    }
  } with {
    briefly "Cut order cancelled"
    described as {
      |Emitted when cut order is cancelled.
    }
  }
  // State Records
  record CuttingStateData is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    styleSpec: GarmentSpec with {
      briefly "Style"
      described as {
        |Style specification.
      }
    }
    marker: CutMarker with {
      briefly "Marker"
      described as {
        |Cutting marker.
      }
    }
    orderQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Order quantity.
      }
    }
    priority: OrderPriority with {
      briefly "Priority"
      described as {
        |Order priority.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due date.
      }
    }
    salesOrderRef: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ref.
      }
    }
    productionStatus: ProductionStatus with {
      briefly "Status"
      described as {
        |Production status.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Cutting state"
    described as {
      |State during cutting phase.
    }
  }
  record SewingStateData is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    styleSpec: GarmentSpec with {
      briefly "Style"
      described as {
        |Style specification.
      }
    }
    marker: CutMarker with {
      briefly "Marker"
      described as {
        |Cutting marker.
      }
    }
    orderQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Order quantity.
      }
    }
    priority: OrderPriority with {
      briefly "Priority"
      described as {
        |Order priority.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due date.
      }
    }
    salesOrderRef: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ref.
      }
    }
    bundles: Bundle+ with {
      briefly "Bundles"
      described as {
        |Production bundles.
      }
    }
    productionStatus: ProductionStatus with {
      briefly "Status"
      described as {
        |Production status.
      }
    }
    fabricRollsUsed: String(1,50)+ with {
      briefly "Rolls"
      described as {
        |Fabric rolls used.
      }
    }
    cutAt: TimeStamp with {
      briefly "Cut"
      described as {
        |Cutting completion time.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Sewing state"
    described as {
      |State during sewing phase.
    }
  }
  record FinishingStateData is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    styleSpec: GarmentSpec with {
      briefly "Style"
      described as {
        |Style specification.
      }
    }
    orderQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Order quantity.
      }
    }
    priority: OrderPriority with {
      briefly "Priority"
      described as {
        |Order priority.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due date.
      }
    }
    salesOrderRef: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ref.
      }
    }
    bundles: Bundle+ with {
      briefly "Bundles"
      described as {
        |Production bundles.
      }
    }
    completedCount: Natural with {
      briefly "Completed"
      described as {
        |Completed count.
      }
    }
    defectCount: Natural with {
      briefly "Defects"
      described as {
        |Defect count.
      }
    }
    inspections: QualityInspection* with {
      briefly "Inspections"
      described as {
        |Quality inspections.
      }
    }
    productionStatus: ProductionStatus with {
      briefly "Status"
      described as {
        |Production status.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Finishing state"
    described as {
      |State during finishing and packing phase.
    }
  }
  record CompletedStateData is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    styleSpec: GarmentSpec with {
      briefly "Style"
      described as {
        |Style specification.
      }
    }
    orderQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Order quantity.
      }
    }
    totalProduced: Natural with {
      briefly "Produced"
      described as {
        |Total produced.
      }
    }
    totalPacked: Natural with {
      briefly "Packed"
      described as {
        |Total packed.
      }
    }
    totalDefects: Natural with {
      briefly "Defects"
      described as {
        |Total defects.
      }
    }
    packingRecords: PackingInfo+ with {
      briefly "Packing"
      described as {
        |Packing records.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Completed state"
    described as {
      |State for completed cut order.
    }
  }
  // States
  state CuttingState of type CutOrder.CuttingStateData
  state SewingState of type CutOrder.SewingStateData
  state FinishingState of type CutOrder.FinishingStateData
  state CompletedState of type CutOrder.CompletedStateData
  // Handler
  handler CutOrderHandler is {
    on command CreateCutOrder is {
      morph entity ApparelContext.CutOrder to state ApparelContext.CutOrder.CuttingState with command CreateCutOrder
      tell event CutOrderCreated to entity ApparelContext.CutOrder
    }
    on command GenerateMarker is {
      tell event MarkerGenerated to entity ApparelContext.CutOrder
    }
    on command CutFabric is {
      tell event FabricCut to entity ApparelContext.CutOrder
    }
    on command CreateBundles is {
      morph entity ApparelContext.CutOrder to state ApparelContext.CutOrder.SewingState with command CreateBundles
      tell event BundlesCreated to entity ApparelContext.CutOrder
    }
    on command AssignBundle is {
      tell event BundleAssigned to entity ApparelContext.CutOrder
    }
    on command CompleteSewing is {
      tell event SewingCompleted to entity ApparelContext.CutOrder
    }
    on command CompleteTrimming is {
      morph entity ApparelContext.CutOrder to state ApparelContext.CutOrder.FinishingState with command CompleteTrimming
      tell event TrimmingCompleted to entity ApparelContext.CutOrder
    }
    on command RecordQualityCheck is {
      tell event QualityCheckRecorded to entity ApparelContext.CutOrder
    }
    on command PackGarments is {
      morph entity ApparelContext.CutOrder to state ApparelContext.CutOrder.CompletedState with command PackGarments
      tell event GarmentsPacked to entity ApparelContext.CutOrder
    }
    on command CancelCutOrder is {
      tell event CutOrderCancelled to entity ApparelContext.CutOrder
    }
  } with {
    briefly "Processes cut order commands"
    described as {
      | Handles cut order lifecycle from creation through
      | cutting, bundling, sewing, trimming, and packing.
    }
  }
} with {
  briefly "CutOrder aggregate"
  described as {
    | The CutOrder entity manages apparel production through
    | the cut-sew-trim process from fabric cutting to packing.
  }
}
