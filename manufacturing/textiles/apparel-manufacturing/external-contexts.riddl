// Apparel Manufacturing - External Contexts
// Fabric Inventory Service
context FabricInventory is {
  query GetFabricRoll is  {
    rollId: String(1,50) with {
      briefly "Roll ID"
      described as {
        |Fabric roll identifier.
      }
    }
  } with {
    briefly "Get fabric roll"
    described as {
      |Retrieves fabric roll details.
    }
  }
  result FabricRollInfo is  {
    rollId: String(1,50) with {
      briefly "Roll ID"
      described as {
        |Roll identifier.
      }
    }
    fabricCode: String(1,50) with {
      briefly "Fabric code"
      described as {
        |Fabric type code.
      }
    }
    colorCode: String(1,50) with {
      briefly "Color"
      described as {
        |Color code.
      }
    }
    width: Decimal(6,2) with {
      briefly "Width"
      described as {
        |Width in inches.
      }
    }
    length: Decimal(10,2) with {
      briefly "Length"
      described as {
        |Remaining length in yards.
      }
    }
    quality: String(1,20) with {
      briefly "Quality"
      described as {
        |Quality grade.
      }
    }
    location: String(1,100) with {
      briefly "Location"
      described as {
        |Warehouse location.
      }
    }
    receivedAt: Date with {
      briefly "Received"
      described as {
        |Receipt date.
      }
    }
  } with {
    briefly "Fabric roll info"
    described as {
      |Fabric roll inventory information.
    }
  }
  query GetAvailableFabric is  {
    fabricCode: String(1,50) with {
      briefly "Fabric code"
      described as {
        |Fabric type code.
      }
    }
    colorCode: String(1,50) with {
      briefly "Color"
      described as {
        |Color code.
      }
    }
    requiredLength: Decimal(10,2) with {
      briefly "Length"
      described as {
        |Required length in yards.
      }
    }
  } with {
    briefly "Get available fabric"
    described as {
      |Finds fabric rolls matching requirements.
    }
  }
  result AvailableFabricRolls is  {
    rolls: FabricRollInfo+ with {
      briefly "Rolls"
      described as {
        |Available rolls.
      }
    }
    totalLength: Decimal(10,2) with {
      briefly "Total"
      described as {
        |Total available length.
      }
    }
  } with {
    briefly "Available fabric rolls"
    described as {
      |List of available fabric rolls.
    }
  }
  command ReserveFabric is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order reserving fabric.
      }
    }
    rollIds: String(1,50)+ with {
      briefly "Rolls"
      described as {
        |Rolls to reserve.
      }
    }
    reservedBy: OperatorId with {
      briefly "Reserved by"
      described as {
        |Person reserving.
      }
    }
  } with {
    briefly "Reserve fabric"
    described as {
      |Reserves fabric rolls for cut order.
    }
  }
  event FabricReserved is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    rollIds: String(1,50)+ with {
      briefly "Rolls"
      described as {
        |Reserved rolls.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Fabric reserved"
    described as {
      |Emitted when fabric is reserved.
    }
  }
  command ConsumeFabric is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order consuming fabric.
      }
    }
    rollId: String(1,50) with {
      briefly "Roll"
      described as {
        |Roll being consumed.
      }
    }
    lengthUsed: Decimal(10,2) with {
      briefly "Length"
      described as {
        |Length consumed in yards.
      }
    }
    wasteLength: Decimal(10,2) with {
      briefly "Waste"
      described as {
        |Waste length in yards.
      }
    }
  } with {
    briefly "Consume fabric"
    described as {
      |Records fabric consumption from cutting.
    }
  }
  event FabricConsumed is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    rollId: String(1,50) with {
      briefly "Roll"
      described as {
        |Consumed roll.
      }
    }
    lengthUsed: Decimal(10,2) with {
      briefly "Length"
      described as {
        |Length consumed.
      }
    }
    wasteLength: Decimal(10,2) with {
      briefly "Waste"
      described as {
        |Waste length.
      }
    }
    consumedAt: TimeStamp with {
      briefly "Consumed"
      described as {
        |Consumption time.
      }
    }
  } with {
    briefly "Fabric consumed"
    described as {
      |Emitted when fabric is consumed.
    }
  }
} with {
  option external()
  briefly "External fabric inventory"
  described as {
    |External fabric roll inventory service.
  }
}
// Trim Inventory Service
context TrimInventory is {
  query GetTrimItem is  {
    trimCode: String(1,50) with {
      briefly "Trim code"
      described as {
        |Trim item code.
      }
    }
  } with {
    briefly "Get trim item"
    described as {
      |Retrieves trim item details.
    }
  }
  result TrimItemInfo is  {
    trimCode: String(1,50) with {
      briefly "Trim code"
      described as {
        |Trim code.
      }
    }
    trimType: String(1,50) with {
      briefly "Type"
      described as {
        |Trim type.
      }
    }
    description: String(1,200) with {
      briefly "Description"
      described as {
        |Item description.
      }
    }
    quantityOnHand: Natural with {
      briefly "On hand"
      described as {
        |Available quantity.
      }
    }
    quantityReserved: Natural with {
      briefly "Reserved"
      described as {
        |Reserved quantity.
      }
    }
    unitOfMeasure: String(1,20) with {
      briefly "UOM"
      described as {
        |Unit of measure.
      }
    }
    location: String(1,100) with {
      briefly "Location"
      described as {
        |Warehouse location.
      }
    }
  } with {
    briefly "Trim item info"
    described as {
      |Trim inventory item information.
    }
  }
  query GetTrimAvailability is  {
    trimCodes: String(1,50)+ with {
      briefly "Trim codes"
      described as {
        |Trim codes to check.
      }
    }
    quantities: Natural+ with {
      briefly "Quantities"
      described as {
        |Required quantities.
      }
    }
  } with {
    briefly "Get trim availability"
    described as {
      |Checks availability of multiple trims.
    }
  }
  result TrimAvailabilityResult is  {
    allAvailable: Boolean with {
      briefly "Available"
      described as {
        |All trims available.
      }
    }
    shortages: TrimShortage* with {
      briefly "Shortages"
      described as {
        |Shortage details.
      }
    }
  } with {
    briefly "Trim availability"
    described as {
      |Trim availability check result.
    }
  }
  record TrimShortage is  {
    trimCode: String(1,50) with {
      briefly "Trim"
      described as {
        |Trim code.
      }
    }
    required: Natural with {
      briefly "Required"
      described as {
        |Required quantity.
      }
    }
    availableQuantity: Natural with {
      briefly "Available"
      described as {
        |Available quantity.
      }
    }
    shortage: Natural with {
      briefly "Shortage"
      described as {
        |Shortage quantity.
      }
    }
  } with {
    briefly "Trim shortage"
    described as {
      |Details of a trim shortage.
    }
  }
  command ReserveTrim is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order reserving trims.
      }
    }
    trimCode: String(1,50) with {
      briefly "Trim"
      described as {
        |Trim to reserve.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Quantity to reserve.
      }
    }
  } with {
    briefly "Reserve trim"
    described as {
      |Reserves trim items for cut order.
    }
  }
  event TrimReserved is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    trimCode: String(1,50) with {
      briefly "Trim"
      described as {
        |Reserved trim.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Reserved quantity.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Trim reserved"
    described as {
      |Emitted when trim is reserved.
    }
  }
  command ConsumeTrim is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order consuming trims.
      }
    }
    trimCode: String(1,50) with {
      briefly "Trim"
      described as {
        |Trim being consumed.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Quantity consumed.
      }
    }
  } with {
    briefly "Consume trim"
    described as {
      |Records trim consumption from production.
    }
  }
  event TrimConsumed is  {
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Cut order ID.
      }
    }
    trimCode: String(1,50) with {
      briefly "Trim"
      described as {
        |Consumed trim.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Consumed quantity.
      }
    }
    consumedAt: TimeStamp with {
      briefly "Consumed"
      described as {
        |Consumption time.
      }
    }
  } with {
    briefly "Trim consumed"
    described as {
      |Emitted when trim is consumed.
    }
  }
} with {
  option external()
  briefly "External trim inventory"
  described as {
    |External trim and accessory inventory service.
  }
}
// Order Management Service
context OrderManagement is {
  query GetSalesOrder is  {
    salesOrderId: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order identifier.
      }
    }
  } with {
    briefly "Get sales order"
    described as {
      |Retrieves sales order details.
    }
  }
  result SalesOrderInfo is  {
    salesOrderId: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ID.
      }
    }
    customerName: String(1,200) with {
      briefly "Customer"
      described as {
        |Customer name.
      }
    }
    styleId: StyleId with {
      briefly "Style"
      described as {
        |Ordered style.
      }
    }
    styleNumber: String(1,50) with {
      briefly "Style number"
      described as {
        |Style number.
      }
    }
    orderQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Order quantity.
      }
    }
    sizeBreakdown: SizeQuantity+ with {
      briefly "Sizes"
      described as {
        |Quantity by size.
      }
    }
    orderDate: Date with {
      briefly "Order date"
      described as {
        |Date ordered.
      }
    }
    requestedShipDate: Date with {
      briefly "Ship date"
      described as {
        |Requested ship date.
      }
    }
    shipToAddress: String(1,500) with {
      briefly "Address"
      described as {
        |Shipping address.
      }
    }
    priority: OrderPriority with {
      briefly "Priority"
      described as {
        |Order priority.
      }
    }
  } with {
    briefly "Sales order info"
    described as {
      |Sales order information.
    }
  }
  command UpdateProductionStatus is  {
    salesOrderId: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ID.
      }
    }
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Production cut order.
      }
    }
    status: ProductionStatus with {
      briefly "Status"
      described as {
        |Production status.
      }
    }
    completedQuantity: Natural with {
      briefly "Completed"
      described as {
        |Quantity completed.
      }
    }
    estimatedCompletionDate: Date with {
      briefly "Est completion"
      described as {
        |Estimated completion.
      }
    }
  } with {
    briefly "Update production status"
    described as {
      |Updates sales order with production status.
    }
  }
  event ProductionStatusUpdated is  {
    salesOrderId: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ID.
      }
    }
    status: ProductionStatus with {
      briefly "Status"
      described as {
        |Production status.
      }
    }
    completedQuantity: Natural with {
      briefly "Completed"
      described as {
        |Completed quantity.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Production status updated"
    described as {
      |Emitted when production status is updated.
    }
  }
  command NotifyReadyToShip is  {
    salesOrderId: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ID.
      }
    }
    cutOrderId: CutOrderId with {
      briefly "Cut order"
      described as {
        |Completed cut order.
      }
    }
    shippedQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Quantity ready to ship.
      }
    }
    cartonNumbers: String(1,50)+ with {
      briefly "Cartons"
      described as {
        |Carton numbers.
      }
    }
  } with {
    briefly "Notify ready to ship"
    described as {
      |Notifies that order is ready for shipping.
    }
  }
  event ReadyToShipNotified is  {
    salesOrderId: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ID.
      }
    }
    shippedQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Ready quantity.
      }
    }
    cartonNumbers: String(1,50)+ with {
      briefly "Cartons"
      described as {
        |Carton numbers.
      }
    }
    notifiedAt: TimeStamp with {
      briefly "Notified"
      described as {
        |Notification time.
      }
    }
  } with {
    briefly "Ready to ship notified"
    described as {
      |Emitted when ready to ship notification sent.
    }
  }
  command ReportDeliveryShortage is  {
    salesOrderId: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ID.
      }
    }
    expectedQuantity: Natural with {
      briefly "Expected"
      described as {
        |Expected quantity.
      }
    }
    actualQuantity: Natural with {
      briefly "Actual"
      described as {
        |Actual quantity.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Shortage reason.
      }
    }
    estimatedMakeupDate: Date? with {
      briefly "Makeup date"
      described as {
        |Estimated makeup delivery.
      }
    }
  } with {
    briefly "Report delivery shortage"
    described as {
      |Reports shortage against order.
    }
  }
  event DeliveryShortageReported is  {
    salesOrderId: String(1,50) with {
      briefly "Sales order"
      described as {
        |Sales order ID.
      }
    }
    shortageQuantity: Natural with {
      briefly "Shortage"
      described as {
        |Shortage quantity.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Shortage reason.
      }
    }
    reportedAt: TimeStamp with {
      briefly "Reported"
      described as {
        |Report time.
      }
    }
  } with {
    briefly "Delivery shortage reported"
    described as {
      |Emitted when delivery shortage is reported.
    }
  }
} with {
  option external()
  briefly "External order management"
  described as {
    |External sales order and delivery management service.
  }
}
// Style Master Service
context StyleMaster is {
  query GetStyleSpec is  {
    styleId: StyleId with {
      briefly "Style"
      described as {
        |Style identifier.
      }
    }
  } with {
    briefly "Get style spec"
    described as {
      |Retrieves complete style specification.
    }
  }
  result StyleSpecResult is  {
    spec: GarmentSpec with {
      briefly "Spec"
      described as {
        |Style specification.
      }
    }
    active: Boolean with {
      briefly "Active"
      described as {
        |Whether style is active.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Effective date.
      }
    }
  } with {
    briefly "Style spec result"
    described as {
      |Style specification query result.
    }
  }
  query GetOperationSequence is  {
    styleId: StyleId with {
      briefly "Style"
      described as {
        |Style identifier.
      }
    }
  } with {
    briefly "Get operation sequence"
    described as {
      |Retrieves sewing operation sequence.
    }
  }
  result OperationSequenceResult is  {
    styleId: StyleId with {
      briefly "Style"
      described as {
        |Style identifier.
      }
    }
    operations: SewingOperation+ with {
      briefly "Operations"
      described as {
        |Sewing operations.
      }
    }
    totalSAM: Decimal(8,2) with {
      briefly "Total SAM"
      described as {
        |Total standard minutes.
      }
    }
  } with {
    briefly "Operation sequence"
    described as {
      |Sewing operation sequence for style.
    }
  }
  query GetTrimRequirements is  {
    styleId: StyleId with {
      briefly "Style"
      described as {
        |Style identifier.
      }
    }
  } with {
    briefly "Get trim requirements"
    described as {
      |Retrieves trim requirements for style.
    }
  }
  result TrimRequirementsResult is  {
    styleId: StyleId with {
      briefly "Style"
      described as {
        |Style identifier.
      }
    }
    trims: TrimOperation+ with {
      briefly "Trims"
      described as {
        |Trim requirements.
      }
    }
    totalTrimSAM: Decimal(8,2) with {
      briefly "Trim SAM"
      described as {
        |Total trim SAM.
      }
    }
  } with {
    briefly "Trim requirements"
    described as {
      |Trim requirements for style.
    }
  }
} with {
  option external()
  briefly "External style master"
  described as {
    |External style specification master service.
  }
}
// Machine Maintenance Service
context MachineMaintenance is {
  query GetMachineStatus is  {
    machineId: String(1,50) with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
  } with {
    briefly "Get machine status"
    described as {
      |Retrieves machine availability status.
    }
  }
  result MachineStatusResult is  {
    machineId: String(1,50) with {
      briefly "Machine"
      described as {
        |Machine ID.
      }
    }
    machineType: String(1,50) with {
      briefly "Type"
      described as {
        |Machine type.
      }
    }
    machineStatus: String(1,20) with {
      briefly "Status"
      described as {
        |Machine status.
      }
    }
    assignedOperator: OperatorId? with {
      briefly "Operator"
      described as {
        |Assigned operator.
      }
    }
    lastMaintenance: Date with {
      briefly "Last maintenance"
      described as {
        |Last maintenance date.
      }
    }
    nextMaintenance: Date with {
      briefly "Next maintenance"
      described as {
        |Next scheduled maintenance.
      }
    }
  } with {
    briefly "Machine status"
    described as {
      |Machine availability and maintenance status.
    }
  }
  command ReportMachineBreakdown is  {
    machineId: String(1,50) with {
      briefly "Machine"
      described as {
        |Machine ID.
      }
    }
    reportedBy: OperatorId with {
      briefly "Reported by"
      described as {
        |Reporting operator.
      }
    }
    description: String(1,500) with {
      briefly "Description"
      described as {
        |Breakdown description.
      }
    }
    severity: String(1,20) with {
      briefly "Severity"
      described as {
        |Breakdown severity.
      }
    }
  } with {
    briefly "Report breakdown"
    described as {
      |Reports machine breakdown.
    }
  }
  event MachineBreakdownReported is  {
    machineId: String(1,50) with {
      briefly "Machine"
      described as {
        |Machine ID.
      }
    }
    breakdownId: UUID with {
      briefly "Breakdown"
      described as {
        |Breakdown ID.
      }
    }
    reportedAt: TimeStamp with {
      briefly "Reported"
      described as {
        |Report time.
      }
    }
  } with {
    briefly "Breakdown reported"
    described as {
      |Emitted when breakdown is reported.
    }
  }
} with {
  option external()
  briefly "External machine maintenance"
  described as {
    |External sewing machine maintenance service.
  }
}
