// Fabric Production - External Contexts

// Yarn Inventory Service
context YarnInventory is {

  query GetYarnLotInfo is {
    yarnLotId is YarnLotId with { briefly "Yarn lot" described by "Yarn lot ID." }
  } with {
    briefly "Get yarn lot info"
    described by "Retrieves yarn lot details."
  }

  result YarnLotInfo is {
    yarnLotId is YarnLotId with { briefly "Yarn lot" described by "Yarn lot ID." }
    yarnType is String(1, 100) with { briefly "Type" described by "Yarn type/composition." }
    color is String(1, 50) with { briefly "Color" described by "Yarn color." }
    yarnWeight is String(1, 50) with { briefly "Weight" described by "Yarn weight/count." }
    availablePounds is Decimal(12, 2) with { briefly "Available" described by "Available pounds." }
    supplier is String(1, 200) with { briefly "Supplier" described by "Yarn supplier." }
    receivedDate is Date with { briefly "Received" described by "Date received." }
  } with {
    briefly "Yarn lot information"
    described by "Detailed yarn lot information."
  }

  command ReserveYarn is {
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    yarnLotId is YarnLotId with { briefly "Yarn lot" described by "Yarn lot ID." }
    poundsNeeded is Decimal(10, 2) with { briefly "Pounds" described by "Pounds to reserve." }
  } with {
    briefly "Reserve yarn"
    described by "Reserves yarn for fabric production."
  }

  event YarnReserved is {
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    yarnLotId is YarnLotId with { briefly "Yarn lot" described by "Yarn lot ID." }
    poundsReserved is Decimal(10, 2) with { briefly "Reserved" described by "Pounds reserved." }
    reservedAt is TimeStamp with { briefly "Reserved at" described by "Reservation time." }
  } with {
    briefly "Yarn reserved"
    described by "Emitted when yarn is reserved."
  }

  event YarnShortage is {
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    yarnLotId is YarnLotId with { briefly "Yarn lot" described by "Yarn lot ID." }
    poundsShort is Decimal(10, 2) with { briefly "Short" described by "Pounds shortage." }
    detectedAt is TimeStamp with { briefly "Detected" described by "Detection time." }
  } with {
    briefly "Yarn shortage"
    described by "Emitted when yarn shortage is detected."
  }

  command IssueYarn is {
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    yarnLotIds is many YarnLotId with { briefly "Yarn lots" described by "Yarn lots to issue." }
    issuedBy is String(1, 200) with { briefly "Issued by" described by "Person issuing." }
  } with {
    briefly "Issue yarn"
    described by "Issues yarn to warping."
  }

  event YarnIssued is {
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    yarnLotIds is many YarnLotId with { briefly "Yarn lots" described by "Yarn lots issued." }
    issuedAt is TimeStamp with { briefly "Issued at" described by "Issue time." }
  } with {
    briefly "Yarn issued"
    described by "Emitted when yarn is issued."
  }

} with {
  option is external
  briefly "External yarn inventory"
  described by "External yarn inventory and supply management service."
}

// Dye Chemical Inventory Service
context DyeChemicalInventory is {

  query GetDyeInfo is {
    colorCode is String(1, 50) with { briefly "Color" described by "Color code." }
  } with {
    briefly "Get dye info"
    described by "Retrieves dye information."
  }

  result DyeInfo is {
    dyeId is UUID with { briefly "Dye" described by "Dye identifier." }
    colorCode is String(1, 50) with { briefly "Color" described by "Color code." }
    colorName is String(1, 100) with { briefly "Name" described by "Color name." }
    dyeType is String(1, 100) with { briefly "Type" described by "Dye type (reactive, disperse, etc.)." }
    availableKg is Decimal(10, 2) with { briefly "Available" described by "Available kilograms." }
    standardFormula is String(1, 2000) with { briefly "Formula" described by "Standard dye formula." }
    shelfLife is Date with { briefly "Shelf life" described by "Expiration date." }
  } with {
    briefly "Dye information"
    described by "Dye chemical information."
  }

  query GetChemicalInfo is {
    chemicalName is String(1, 100) with { briefly "Chemical" described by "Chemical name." }
  } with {
    briefly "Get chemical info"
    described by "Retrieves auxiliary chemical information."
  }

  result ChemicalInfo is {
    chemicalId is UUID with { briefly "Chemical" described by "Chemical identifier." }
    chemicalName is String(1, 100) with { briefly "Name" described by "Chemical name." }
    chemicalType is String(1, 100) with { briefly "Type" described by "Chemical type." }
    availableKg is Decimal(10, 2) with { briefly "Available" described by "Available kilograms." }
    safetyClass is String(1, 50) with { briefly "Safety" described by "Safety classification." }
  } with {
    briefly "Chemical information"
    described by "Auxiliary chemical information."
  }

  command ReserveDyeChemicals is {
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    dyeLotId is DyeLotId with { briefly "Dye lot" described by "Dye lot ID." }
    formulaText is String(1, 2000) with { briefly "Formula" described by "Dye formula to reserve." }
  } with {
    briefly "Reserve dye chemicals"
    described by "Reserves dye and chemicals for dyeing."
  }

  event DyeChemicalsReserved is {
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    dyeLotId is DyeLotId with { briefly "Dye lot" described by "Dye lot ID." }
    reservedAt is TimeStamp with { briefly "Reserved at" described by "Reservation time." }
  } with {
    briefly "Dye chemicals reserved"
    described by "Emitted when dye chemicals are reserved."
  }

  command IssueDyeChemicals is {
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    dyeLotId is DyeLotId with { briefly "Dye lot" described by "Dye lot ID." }
    issuedBy is String(1, 200) with { briefly "Issued by" described by "Person issuing." }
  } with {
    briefly "Issue dye chemicals"
    described by "Issues dye chemicals to dye house."
  }

  event DyeChemicalsIssued is {
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    dyeLotId is DyeLotId with { briefly "Dye lot" described by "Dye lot ID." }
    issuedAt is TimeStamp with { briefly "Issued at" described by "Issue time." }
  } with {
    briefly "Dye chemicals issued"
    described by "Emitted when dye chemicals are issued."
  }

} with {
  option is external
  briefly "External dye chemical inventory"
  described by "External dye and auxiliary chemical inventory service."
}

// Customer Order Service
context CustomerOrderService is {

  query GetFabricOrder is {
    orderId is String(1, 100) with { briefly "Order" described by "Customer order ID." }
  } with {
    briefly "Get fabric order"
    described by "Retrieves customer fabric order."
  }

  result FabricOrder is {
    orderId is String(1, 100) with { briefly "Order" described by "Order ID." }
    customerId is String(1, 100) with { briefly "Customer" described by "Customer ID." }
    customerName is String(1, 200) with { briefly "Name" described by "Customer name." }
    styleNumber is String(1, 50) with { briefly "Style" described by "Fabric style." }
    colorCode is String(1, 50) with { briefly "Color" described by "Color code." }
    yardsOrdered is Decimal(12, 2) with { briefly "Yards" described by "Yards ordered." }
    dueDate is Date with { briefly "Due" described by "Due date." }
    finishingRequirements is many String(1, 200) with { briefly "Finishing" described by "Required finishes." }
    qualityGrade is String(1, 50) with { briefly "Grade" described by "Required quality grade." }
    shippingAddress is String(1, 500) with { briefly "Address" described by "Shipping address." }
  } with {
    briefly "Fabric order"
    described by "Customer fabric order details."
  }

  command UpdateOrderStatus is {
    orderId is String(1, 100) with { briefly "Order" described by "Order ID." }
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    orderStatus is String(1, 50) with { briefly "Status" described by "Production status." }
    estimatedCompletion is optional Date with { briefly "ETA" described by "Estimated completion." }
  } with {
    briefly "Update order status"
    described by "Updates customer order with production status."
  }

  event OrderStatusUpdated is {
    orderId is String(1, 100) with { briefly "Order" described by "Order ID." }
    orderStatus is String(1, 50) with { briefly "Status" described by "New status." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Order status updated"
    described by "Emitted when order status is updated."
  }

  command NotifyOrderShipped is {
    orderId is String(1, 100) with { briefly "Order" described by "Order ID." }
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    yardsShipped is Decimal(12, 2) with { briefly "Yards" described by "Yards shipped." }
    gradeShipped is String(1, 50) with { briefly "Grade" described by "Quality grade shipped." }
    trackingNumber is optional String(1, 100) with { briefly "Tracking" described by "Shipment tracking." }
  } with {
    briefly "Notify order shipped"
    described by "Notifies customer that order has shipped."
  }

  event CustomerNotified is {
    orderId is String(1, 100) with { briefly "Order" described by "Order ID." }
    notificationType is String(1, 50) with { briefly "Type" described by "Notification type." }
    notifiedAt is TimeStamp with { briefly "Notified" described by "Notification time." }
  } with {
    briefly "Customer notified"
    described by "Emitted when customer is notified."
  }

  command NotifyQualityIssue is {
    orderId is String(1, 100) with { briefly "Order" described by "Order ID." }
    fabricLotId is FabricLotId with { briefly "Fabric lot" described by "Fabric lot ID." }
    issueDescription is String(1, 1000) with { briefly "Issue" described by "Quality issue description." }
    proposedResolution is String(1, 500) with { briefly "Resolution" described by "Proposed resolution." }
  } with {
    briefly "Notify quality issue"
    described by "Notifies customer of quality issues."
  }

} with {
  option is external
  briefly "External customer order service"
  described by "External customer order and specification service."
}
