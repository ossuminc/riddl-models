// Fabric Production - External Contexts
// Yarn Inventory Service
context YarnInventory is {
  query GetYarnLotInfo is  {
    yarnLotId: YarnLotId with {
      briefly "Yarn lot"
      described as {
        |Yarn lot ID.
      }
    }
  } with {
    briefly "Get yarn lot info"
    described as {
      |Retrieves yarn lot details.
    }
  }
  result YarnLotInfo is  {
    yarnLotId: YarnLotId with {
      briefly "Yarn lot"
      described as {
        |Yarn lot ID.
      }
    }
    yarnType: String(1,100) with {
      briefly "Type"
      described as {
        |Yarn type/composition.
      }
    }
    color: String(1,50) with {
      briefly "Color"
      described as {
        |Yarn color.
      }
    }
    yarnWeight: String(1,50) with {
      briefly "Weight"
      described as {
        |Yarn weight/count.
      }
    }
    availablePounds: Decimal(12,2) with {
      briefly "Available"
      described as {
        |Available pounds.
      }
    }
    supplier: String(1,200) with {
      briefly "Supplier"
      described as {
        |Yarn supplier.
      }
    }
    receivedDate: Date with {
      briefly "Received"
      described as {
        |Date received.
      }
    }
  } with {
    briefly "Yarn lot information"
    described as {
      |Detailed yarn lot information.
    }
  }
  command ReserveYarn is  {
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    yarnLotId: YarnLotId with {
      briefly "Yarn lot"
      described as {
        |Yarn lot ID.
      }
    }
    poundsNeeded: Decimal(10,2) with {
      briefly "Pounds"
      described as {
        |Pounds to reserve.
      }
    }
  } with {
    briefly "Reserve yarn"
    described as {
      |Reserves yarn for fabric production.
    }
  }
  event YarnReserved is  {
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    yarnLotId: YarnLotId with {
      briefly "Yarn lot"
      described as {
        |Yarn lot ID.
      }
    }
    poundsReserved: Decimal(10,2) with {
      briefly "Reserved"
      described as {
        |Pounds reserved.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved at"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Yarn reserved"
    described as {
      |Emitted when yarn is reserved.
    }
  }
  event YarnShortage is  {
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    yarnLotId: YarnLotId with {
      briefly "Yarn lot"
      described as {
        |Yarn lot ID.
      }
    }
    poundsShort: Decimal(10,2) with {
      briefly "Short"
      described as {
        |Pounds shortage.
      }
    }
    detectedAt: TimeStamp with {
      briefly "Detected"
      described as {
        |Detection time.
      }
    }
  } with {
    briefly "Yarn shortage"
    described as {
      |Emitted when yarn shortage is detected.
    }
  }
  command IssueYarn is  {
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    yarnLotIds: YarnLotId+ with {
      briefly "Yarn lots"
      described as {
        |Yarn lots to issue.
      }
    }
    issuedBy: String(1,200) with {
      briefly "Issued by"
      described as {
        |Person issuing.
      }
    }
  } with {
    briefly "Issue yarn"
    described as {
      |Issues yarn to warping.
    }
  }
  event YarnIssued is  {
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    yarnLotIds: YarnLotId+ with {
      briefly "Yarn lots"
      described as {
        |Yarn lots issued.
      }
    }
    issuedAt: TimeStamp with {
      briefly "Issued at"
      described as {
        |Issue time.
      }
    }
  } with {
    briefly "Yarn issued"
    described as {
      |Emitted when yarn is issued.
    }
  }
} with {
  option external()
  briefly "External yarn inventory"
  described as {
    |External yarn inventory and supply management service.
  }
}
// Dye Chemical Inventory Service
context DyeChemicalInventory is {
  query GetDyeInfo is  {
    colorCode: String(1,50) with {
      briefly "Color"
      described as {
        |Color code.
      }
    }
  } with {
    briefly "Get dye info"
    described as {
      |Retrieves dye information.
    }
  }
  result DyeInfo is  {
    dyeId: UUID with {
      briefly "Dye"
      described as {
        |Dye identifier.
      }
    }
    colorCode: String(1,50) with {
      briefly "Color"
      described as {
        |Color code.
      }
    }
    colorName: String(1,100) with {
      briefly "Name"
      described as {
        |Color name.
      }
    }
    dyeType: String(1,100) with {
      briefly "Type"
      described as {
        |Dye type (reactive, disperse, etc.).
      }
    }
    availableKg: Decimal(10,2) with {
      briefly "Available"
      described as {
        |Available kilograms.
      }
    }
    standardFormula: String(1,2000) with {
      briefly "Formula"
      described as {
        |Standard dye formula.
      }
    }
    shelfLife: Date with {
      briefly "Shelf life"
      described as {
        |Expiration date.
      }
    }
  } with {
    briefly "Dye information"
    described as {
      |Dye chemical information.
    }
  }
  query GetChemicalInfo is  {
    chemicalName: String(1,100) with {
      briefly "Chemical"
      described as {
        |Chemical name.
      }
    }
  } with {
    briefly "Get chemical info"
    described as {
      |Retrieves auxiliary chemical information.
    }
  }
  result ChemicalInfo is  {
    chemicalId: UUID with {
      briefly "Chemical"
      described as {
        |Chemical identifier.
      }
    }
    chemicalName: String(1,100) with {
      briefly "Name"
      described as {
        |Chemical name.
      }
    }
    chemicalType: String(1,100) with {
      briefly "Type"
      described as {
        |Chemical type.
      }
    }
    availableKg: Decimal(10,2) with {
      briefly "Available"
      described as {
        |Available kilograms.
      }
    }
    safetyClass: String(1,50) with {
      briefly "Safety"
      described as {
        |Safety classification.
      }
    }
  } with {
    briefly "Chemical information"
    described as {
      |Auxiliary chemical information.
    }
  }
  command ReserveDyeChemicals is  {
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    dyeLotId: DyeLotId with {
      briefly "Dye lot"
      described as {
        |Dye lot ID.
      }
    }
    formulaText: String(1,2000) with {
      briefly "Formula"
      described as {
        |Dye formula to reserve.
      }
    }
  } with {
    briefly "Reserve dye chemicals"
    described as {
      |Reserves dye and chemicals for dyeing.
    }
  }
  event DyeChemicalsReserved is  {
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    dyeLotId: DyeLotId with {
      briefly "Dye lot"
      described as {
        |Dye lot ID.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved at"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Dye chemicals reserved"
    described as {
      |Emitted when dye chemicals are reserved.
    }
  }
  command IssueDyeChemicals is  {
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    dyeLotId: DyeLotId with {
      briefly "Dye lot"
      described as {
        |Dye lot ID.
      }
    }
    issuedBy: String(1,200) with {
      briefly "Issued by"
      described as {
        |Person issuing.
      }
    }
  } with {
    briefly "Issue dye chemicals"
    described as {
      |Issues dye chemicals to dye house.
    }
  }
  event DyeChemicalsIssued is  {
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    dyeLotId: DyeLotId with {
      briefly "Dye lot"
      described as {
        |Dye lot ID.
      }
    }
    issuedAt: TimeStamp with {
      briefly "Issued at"
      described as {
        |Issue time.
      }
    }
  } with {
    briefly "Dye chemicals issued"
    described as {
      |Emitted when dye chemicals are issued.
    }
  }
} with {
  option external()
  briefly "External dye chemical inventory"
  described as {
    |External dye and auxiliary chemical inventory service.
  }
}
// Customer Order Service
context CustomerOrderService is {
  query GetFabricOrder is  {
    orderId: String(1,100) with {
      briefly "Order"
      described as {
        |Customer order ID.
      }
    }
  } with {
    briefly "Get fabric order"
    described as {
      |Retrieves customer fabric order.
    }
  }
  result FabricOrder is  {
    orderId: String(1,100) with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    customerId: String(1,100) with {
      briefly "Customer"
      described as {
        |Customer ID.
      }
    }
    customerName: String(1,200) with {
      briefly "Name"
      described as {
        |Customer name.
      }
    }
    styleNumber: String(1,50) with {
      briefly "Style"
      described as {
        |Fabric style.
      }
    }
    colorCode: String(1,50) with {
      briefly "Color"
      described as {
        |Color code.
      }
    }
    yardsOrdered: Decimal(12,2) with {
      briefly "Yards"
      described as {
        |Yards ordered.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due date.
      }
    }
    finishingRequirements: String(1,200)+ with {
      briefly "Finishing"
      described as {
        |Required finishes.
      }
    }
    qualityGrade: String(1,50) with {
      briefly "Grade"
      described as {
        |Required quality grade.
      }
    }
    shippingAddress: String(1,500) with {
      briefly "Address"
      described as {
        |Shipping address.
      }
    }
  } with {
    briefly "Fabric order"
    described as {
      |Customer fabric order details.
    }
  }
  command UpdateOrderStatus is  {
    orderId: String(1,100) with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    orderStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Production status.
      }
    }
    estimatedCompletion: Date? with {
      briefly "ETA"
      described as {
        |Estimated completion.
      }
    }
  } with {
    briefly "Update order status"
    described as {
      |Updates customer order with production status.
    }
  }
  event OrderStatusUpdated is  {
    orderId: String(1,100) with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    orderStatus: String(1,50) with {
      briefly "Status"
      described as {
        |New status.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Order status updated"
    described as {
      |Emitted when order status is updated.
    }
  }
  command NotifyOrderShipped is  {
    orderId: String(1,100) with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    yardsShipped: Decimal(12,2) with {
      briefly "Yards"
      described as {
        |Yards shipped.
      }
    }
    gradeShipped: String(1,50) with {
      briefly "Grade"
      described as {
        |Quality grade shipped.
      }
    }
    trackingNumber: String(1,100)? with {
      briefly "Tracking"
      described as {
        |Shipment tracking.
      }
    }
  } with {
    briefly "Notify order shipped"
    described as {
      |Notifies customer that order has shipped.
    }
  }
  event CustomerNotified is  {
    orderId: String(1,100) with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    notificationType: String(1,50) with {
      briefly "Type"
      described as {
        |Notification type.
      }
    }
    notifiedAt: TimeStamp with {
      briefly "Notified"
      described as {
        |Notification time.
      }
    }
  } with {
    briefly "Customer notified"
    described as {
      |Emitted when customer is notified.
    }
  }
  command NotifyQualityIssue is  {
    orderId: String(1,100) with {
      briefly "Order"
      described as {
        |Order ID.
      }
    }
    fabricLotId: FabricLotId with {
      briefly "Fabric lot"
      described as {
        |Fabric lot ID.
      }
    }
    issueDescription: String(1,1000) with {
      briefly "Issue"
      described as {
        |Quality issue description.
      }
    }
    proposedResolution: String(1,500) with {
      briefly "Resolution"
      described as {
        |Proposed resolution.
      }
    }
  } with {
    briefly "Notify quality issue"
    described as {
      |Notifies customer of quality issues.
    }
  }
} with {
  option external()
  briefly "External customer order service"
  described as {
    |External customer order and specification service.
  }
}
