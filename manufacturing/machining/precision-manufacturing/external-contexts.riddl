// Precision Manufacturing - External Contexts

// CMM Integration Service
context CMMIntegration is {

  command ExecuteCMMProgram is {
    partId is PartId with { briefly "Part" described by "Part identifier." }
    programId is String(1, 100) with { briefly "Program" described by "CMM program identifier." }
    programVersion is String(1, 20) with { briefly "Version" described by "Program version." }
  } with {
    briefly "Execute CMM program"
    described by "Executes a CMM inspection program."
  }

  event CMMProgramStarted is {
    partId is PartId with { briefly "Part" described by "Part ID." }
    programId is String(1, 100) with { briefly "Program" described by "CMM program ID." }
    machineId is String(1, 100) with { briefly "Machine" described by "CMM machine ID." }
    startedAt is TimeStamp with { briefly "Started" described by "Start time." }
  } with {
    briefly "CMM program started"
    described by "Emitted when CMM program starts execution."
  }

  event CMMProgramCompleted is {
    partId is PartId with { briefly "Part" described by "Part ID." }
    cmmResult is CMMResult with { briefly "Result" described by "CMM inspection result." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "CMM program completed"
    described by "Emitted when CMM program completes with results."
  }

  event CMMProgramFailed is {
    partId is PartId with { briefly "Part" described by "Part ID." }
    programId is String(1, 100) with { briefly "Program" described by "CMM program ID." }
    errorCode is String(1, 50) with { briefly "Error" described by "Error code." }
    errorMessage is String(1, 500) with { briefly "Message" described by "Error message." }
    failedAt is TimeStamp with { briefly "Failed" described by "Failure time." }
  } with {
    briefly "CMM program failed"
    described by "Emitted when CMM program execution fails."
  }

  query GetCMMPrograms is {
    partNumber is String(1, 50) with { briefly "Part number" described by "Part number." }
  } with {
    briefly "Get CMM programs"
    described by "Retrieves available CMM programs for a part."
  }

  result CMMProgramList is {
    programs is many String(1, 100) with { briefly "Programs" described by "Available program IDs." }
    partNumber is String(1, 50) with { briefly "Part number" described by "Part number." }
  } with {
    briefly "CMM program list"
    described by "List of available CMM programs."
  }

  query GetCMMStatus is {
    machineId is String(1, 100) with { briefly "Machine" described by "CMM machine ID." }
  } with {
    briefly "Get CMM status"
    described by "Retrieves CMM machine status."
  }

  result CMMStatus is {
    machineId is String(1, 100) with { briefly "Machine" described by "CMM machine ID." }
    status is String(1, 50) with { briefly "Status" described by "Machine status (idle, running, error)." }
    currentProgram is optional String(1, 100) with { briefly "Program" described by "Currently running program." }
    lastCalibration is Date with { briefly "Last cal" described by "Last calibration date." }
  } with {
    briefly "CMM status"
    described by "CMM machine status information."
  }

} with {
  option is external
  briefly "External CMM integration"
  described by "External coordinate measuring machine integration service."
}

// Gage Calibration Service
context GageCalibrationService is {

  query GetGageCalibration is {
    gageId is GageId with { briefly "Gage" described by "Gage identifier." }
  } with {
    briefly "Get gage calibration"
    described by "Retrieves gage calibration status."
  }

  result GageCalibrationStatus is {
    gageInfo is GageInfo with { briefly "Gage" described by "Gage information." }
    calibrationHistory is many String(1, 200) with { briefly "History" described by "Calibration history." }
    nextCalibrationDue is Date with { briefly "Next due" described by "Next calibration due date." }
  } with {
    briefly "Gage calibration status"
    described by "Gage calibration status and history."
  }

  command ScheduleCalibration is {
    gageId is GageId with { briefly "Gage" described by "Gage identifier." }
    scheduledDate is Date with { briefly "Date" described by "Scheduled calibration date." }
    calibrationLab is String(1, 200) with { briefly "Lab" described by "Calibration laboratory." }
  } with {
    briefly "Schedule calibration"
    described by "Schedules gage calibration."
  }

  event CalibrationScheduled is {
    gageId is GageId with { briefly "Gage" described by "Gage ID." }
    scheduledDate is Date with { briefly "Date" described by "Scheduled date." }
    scheduledAt is TimeStamp with { briefly "Scheduled" described by "Scheduling time." }
  } with {
    briefly "Calibration scheduled"
    described by "Emitted when calibration is scheduled."
  }

  command RecordCalibration is {
    gageId is GageId with { briefly "Gage" described by "Gage identifier." }
    calibrationDate is Date with { briefly "Date" described by "Calibration date." }
    certificateNumber is String(1, 100) with { briefly "Certificate" described by "Calibration certificate." }
    measuredAccuracy is Decimal(10, 6) with { briefly "Accuracy" described by "Measured accuracy." }
    passedCalibration is Boolean with { briefly "Passed" described by "Whether calibration passed." }
    calibratedBy is String(1, 200) with { briefly "Calibrated by" described by "Calibration technician." }
  } with {
    briefly "Record calibration"
    described by "Records completed calibration."
  }

  event CalibrationRecorded is {
    gageId is GageId with { briefly "Gage" described by "Gage ID." }
    certificateNumber is String(1, 100) with { briefly "Certificate" described by "Certificate number." }
    passedCalibration is Boolean with { briefly "Passed" described by "Calibration result." }
    nextDueDate is Date with { briefly "Next due" described by "Next calibration due." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Calibration recorded"
    described by "Emitted when calibration is recorded."
  }

  event GageOutOfCalibration is {
    gageId is GageId with { briefly "Gage" described by "Gage ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Out of calibration reason." }
    affectedMeasurements is many MeasurementId with { briefly "Affected" described by "Potentially affected measurements." }
    detectedAt is TimeStamp with { briefly "Detected" described by "Detection time." }
  } with {
    briefly "Gage out of calibration"
    described by "Emitted when gage is found out of calibration."
  }

  query GetCalibrationsDue is {
    daysAhead is Natural with { briefly "Days" described by "Days to look ahead." }
  } with {
    briefly "Get calibrations due"
    described by "Retrieves gages with calibration due soon."
  }

  result CalibrationsDueList is {
    gages is many GageInfo with { briefly "Gages" described by "Gages needing calibration." }
    dueDate is Date with { briefly "Due" described by "Due by date." }
  } with {
    briefly "Calibrations due list"
    described by "List of gages with calibration due."
  }

} with {
  option is external
  briefly "External gage calibration"
  described by "External gage calibration tracking service."
}

// Certification Service
context CertificationService is {

  command CreateCertificate is {
    partId is PartId with { briefly "Part" described by "Part identifier." }
    standard is String(1, 100) with { briefly "Standard" described by "Compliance standard." }
    measurements is many Measurement with { briefly "Measurements" described by "Supporting measurements." }
    inspectorId is String(1, 100) with { briefly "Inspector" described by "Inspector identifier." }
  } with {
    briefly "Create certificate"
    described by "Creates a certification certificate."
  }

  event CertificateCreated is {
    partId is PartId with { briefly "Part" described by "Part ID." }
    certificateNumber is String(1, 100) with { briefly "Certificate" described by "Certificate number." }
    standard is String(1, 100) with { briefly "Standard" described by "Compliance standard." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Certificate created"
    described by "Emitted when certificate is created."
  }

  query GetCertificateRequirements is {
    standard is String(1, 100) with { briefly "Standard" described by "Compliance standard." }
    partType is String(1, 100) with { briefly "Part type" described by "Type of part." }
  } with {
    briefly "Get certificate requirements"
    described by "Retrieves certification requirements for a standard."
  }

  result CertificateRequirements is {
    standard is String(1, 100) with { briefly "Standard" described by "Compliance standard." }
    requiredDocuments is many String(1, 200) with { briefly "Documents" described by "Required documents." }
    requiredMeasurements is many String(1, 200) with { briefly "Measurements" described by "Required measurements." }
    traceabilityRequirements is String(1, 1000) with { briefly "Traceability" described by "Traceability requirements." }
  } with {
    briefly "Certificate requirements"
    described by "Certification requirements for a standard."
  }

  command ValidateCertification is {
    partId is PartId with { briefly "Part" described by "Part identifier." }
    certificateNumber is String(1, 100) with { briefly "Certificate" described by "Certificate number." }
    validatedBy is String(1, 200) with { briefly "Validated by" described by "Person validating." }
  } with {
    briefly "Validate certification"
    described by "Validates a certification against requirements."
  }

  event CertificationValidated is {
    partId is PartId with { briefly "Part" described by "Part ID." }
    certificateNumber is String(1, 100) with { briefly "Certificate" described by "Certificate number." }
    isValid is Boolean with { briefly "Valid" described by "Validation result." }
    findings is many optional String(1, 500) with { briefly "Findings" described by "Validation findings." }
    validatedAt is TimeStamp with { briefly "Validated" described by "Validation time." }
  } with {
    briefly "Certification validated"
    described by "Emitted when certification is validated."
  }

  command RevokeCertification is {
    partId is PartId with { briefly "Part" described by "Part identifier." }
    certificateNumber is String(1, 100) with { briefly "Certificate" described by "Certificate number." }
    reason is String(1, 500) with { briefly "Reason" described by "Revocation reason." }
    revokedBy is String(1, 200) with { briefly "Revoked by" described by "Person revoking." }
  } with {
    briefly "Revoke certification"
    described by "Revokes a certification."
  }

  event CertificationRevoked is {
    partId is PartId with { briefly "Part" described by "Part ID." }
    certificateNumber is String(1, 100) with { briefly "Certificate" described by "Certificate number." }
    reason is String(1, 500) with { briefly "Reason" described by "Revocation reason." }
    revokedAt is TimeStamp with { briefly "Revoked" described by "Revocation time." }
  } with {
    briefly "Certification revoked"
    described by "Emitted when certification is revoked."
  }

  query GetComplianceStandards is {
    industry is String(1, 100) with { briefly "Industry" described by "Industry sector." }
  } with {
    briefly "Get compliance standards"
    described by "Retrieves applicable compliance standards."
  }

  result ComplianceStandards is {
    standards is many String(1, 100) with { briefly "Standards" described by "Applicable standards." }
    descriptions is many String(1, 500) with { briefly "Descriptions" described by "Standard descriptions." }
  } with {
    briefly "Compliance standards"
    described by "List of applicable compliance standards."
  }

} with {
  option is external
  briefly "External certification service"
  described by "External AS9100, ISO 9001, and NADCAP certification service."
}
