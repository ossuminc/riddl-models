// Precision Manufacturing - External Contexts
// CMM Integration Service
context CMMIntegration is {
  command ExecuteCMMProgram is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    programId: String(1,100) with {
      briefly "Program"
      described as {
        |CMM program identifier.
      }
    }
    programVersion: String(1,20) with {
      briefly "Version"
      described as {
        |Program version.
      }
    }
  } with {
    briefly "Execute CMM program"
    described as {
      |Executes a CMM inspection program.
    }
  }
  event CMMProgramStarted is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part ID.
      }
    }
    programId: String(1,100) with {
      briefly "Program"
      described as {
        |CMM program ID.
      }
    }
    machineId: String(1,100) with {
      briefly "Machine"
      described as {
        |CMM machine ID.
      }
    }
    startedAt: TimeStamp with {
      briefly "Started"
      described as {
        |Start time.
      }
    }
  } with {
    briefly "CMM program started"
    described as {
      |Emitted when CMM program starts execution.
    }
  }
  event CMMProgramCompleted is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part ID.
      }
    }
    cmmResult: CMMResult with {
      briefly "Result"
      described as {
        |CMM inspection result.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "CMM program completed"
    described as {
      |Emitted when CMM program completes with results.
    }
  }
  event CMMProgramFailed is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part ID.
      }
    }
    programId: String(1,100) with {
      briefly "Program"
      described as {
        |CMM program ID.
      }
    }
    errorCode: String(1,50) with {
      briefly "Error"
      described as {
        |Error code.
      }
    }
    errorMessage: String(1,500) with {
      briefly "Message"
      described as {
        |Error message.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |Failure time.
      }
    }
  } with {
    briefly "CMM program failed"
    described as {
      |Emitted when CMM program execution fails.
    }
  }
  query GetCMMPrograms is  {
    partNumber: String(1,50) with {
      briefly "Part number"
      described as {
        |Part number.
      }
    }
  } with {
    briefly "Get CMM programs"
    described as {
      |Retrieves available CMM programs for a part.
    }
  }
  result CMMProgramList is  {
    programs: String(1,100)+ with {
      briefly "Programs"
      described as {
        |Available program IDs.
      }
    }
    partNumber: String(1,50) with {
      briefly "Part number"
      described as {
        |Part number.
      }
    }
  } with {
    briefly "CMM program list"
    described as {
      |List of available CMM programs.
    }
  }
  query GetCMMStatus is  {
    machineId: String(1,100) with {
      briefly "Machine"
      described as {
        |CMM machine ID.
      }
    }
  } with {
    briefly "Get CMM status"
    described as {
      |Retrieves CMM machine status.
    }
  }
  result CMMStatus is  {
    machineId: String(1,100) with {
      briefly "Machine"
      described as {
        |CMM machine ID.
      }
    }
    cmmStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Machine status (idle, running, error).
      }
    }
    currentProgram: String(1,100)? with {
      briefly "Program"
      described as {
        |Currently running program.
      }
    }
    lastCalibration: Date with {
      briefly "Last cal"
      described as {
        |Last calibration date.
      }
    }
  } with {
    briefly "CMM status"
    described as {
      |CMM machine status information.
    }
  }
} with {
  option external()
  briefly "External CMM integration"
  described as {
    |External coordinate measuring machine integration service.
  }
}
// Gage Calibration Service
context GageCalibrationService is {
  query GetGageCalibration is  {
    gageId: GageId with {
      briefly "Gage"
      described as {
        |Gage identifier.
      }
    }
  } with {
    briefly "Get gage calibration"
    described as {
      |Retrieves gage calibration status.
    }
  }
  result GageCalibrationStatus is  {
    gageInfo: GageInfo with {
      briefly "Gage"
      described as {
        |Gage information.
      }
    }
    calibrationHistory: String(1,200)+ with {
      briefly "History"
      described as {
        |Calibration history.
      }
    }
    nextCalibrationDue: Date with {
      briefly "Next due"
      described as {
        |Next calibration due date.
      }
    }
  } with {
    briefly "Gage calibration status"
    described as {
      |Gage calibration status and history.
    }
  }
  command ScheduleCalibration is  {
    gageId: GageId with {
      briefly "Gage"
      described as {
        |Gage identifier.
      }
    }
    scheduledDate: Date with {
      briefly "Date"
      described as {
        |Scheduled calibration date.
      }
    }
    calibrationLab: String(1,200) with {
      briefly "Lab"
      described as {
        |Calibration laboratory.
      }
    }
  } with {
    briefly "Schedule calibration"
    described as {
      |Schedules gage calibration.
    }
  }
  event CalibrationScheduled is  {
    gageId: GageId with {
      briefly "Gage"
      described as {
        |Gage ID.
      }
    }
    scheduledDate: Date with {
      briefly "Date"
      described as {
        |Scheduled date.
      }
    }
    scheduledAt: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Scheduling time.
      }
    }
  } with {
    briefly "Calibration scheduled"
    described as {
      |Emitted when calibration is scheduled.
    }
  }
  command RecordCalibration is  {
    gageId: GageId with {
      briefly "Gage"
      described as {
        |Gage identifier.
      }
    }
    calibrationDate: Date with {
      briefly "Date"
      described as {
        |Calibration date.
      }
    }
    certificateNumber: String(1,100) with {
      briefly "Certificate"
      described as {
        |Calibration certificate.
      }
    }
    measuredAccuracy: Decimal(10,6) with {
      briefly "Accuracy"
      described as {
        |Measured accuracy.
      }
    }
    passedCalibration: Boolean with {
      briefly "Passed"
      described as {
        |Whether calibration passed.
      }
    }
    calibratedBy: String(1,200) with {
      briefly "Calibrated by"
      described as {
        |Calibration technician.
      }
    }
  } with {
    briefly "Record calibration"
    described as {
      |Records completed calibration.
    }
  }
  event CalibrationRecorded is  {
    gageId: GageId with {
      briefly "Gage"
      described as {
        |Gage ID.
      }
    }
    certificateNumber: String(1,100) with {
      briefly "Certificate"
      described as {
        |Certificate number.
      }
    }
    passedCalibration: Boolean with {
      briefly "Passed"
      described as {
        |Calibration result.
      }
    }
    nextDueDate: Date with {
      briefly "Next due"
      described as {
        |Next calibration due.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Record time.
      }
    }
  } with {
    briefly "Calibration recorded"
    described as {
      |Emitted when calibration is recorded.
    }
  }
  event GageOutOfCalibration is  {
    gageId: GageId with {
      briefly "Gage"
      described as {
        |Gage ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Out of calibration reason.
      }
    }
    affectedMeasurements: MeasurementId+ with {
      briefly "Affected"
      described as {
        |Potentially affected measurements.
      }
    }
    detectedAt: TimeStamp with {
      briefly "Detected"
      described as {
        |Detection time.
      }
    }
  } with {
    briefly "Gage out of calibration"
    described as {
      |Emitted when gage is found out of calibration.
    }
  }
  query GetCalibrationsDue is  {
    daysAhead: Natural with {
      briefly "Days"
      described as {
        |Days to look ahead.
      }
    }
  } with {
    briefly "Get calibrations due"
    described as {
      |Retrieves gages with calibration due soon.
    }
  }
  result CalibrationsDueList is  {
    gages: GageInfo+ with {
      briefly "Gages"
      described as {
        |Gages needing calibration.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due by date.
      }
    }
  } with {
    briefly "Calibrations due list"
    described as {
      |List of gages with calibration due.
    }
  }
} with {
  option external()
  briefly "External gage calibration"
  described as {
    |External gage calibration tracking service.
  }
}
// Certification Service
context CertificationService is {
  command CreateCertificate is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    standard: String(1,100) with {
      briefly "Standard"
      described as {
        |Compliance standard.
      }
    }
    measurements: Measurement+ with {
      briefly "Measurements"
      described as {
        |Supporting measurements.
      }
    }
    inspectorId: String(1,100) with {
      briefly "Inspector"
      described as {
        |Inspector identifier.
      }
    }
  } with {
    briefly "Create certificate"
    described as {
      |Creates a certification certificate.
    }
  }
  event CertificateCreated is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part ID.
      }
    }
    certificateNumber: String(1,100) with {
      briefly "Certificate"
      described as {
        |Certificate number.
      }
    }
    standard: String(1,100) with {
      briefly "Standard"
      described as {
        |Compliance standard.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Certificate created"
    described as {
      |Emitted when certificate is created.
    }
  }
  query GetCertificateRequirements is  {
    standard: String(1,100) with {
      briefly "Standard"
      described as {
        |Compliance standard.
      }
    }
    partType: String(1,100) with {
      briefly "Part type"
      described as {
        |Type of part.
      }
    }
  } with {
    briefly "Get certificate requirements"
    described as {
      |Retrieves certification requirements for a standard.
    }
  }
  result CertificateRequirements is  {
    standard: String(1,100) with {
      briefly "Standard"
      described as {
        |Compliance standard.
      }
    }
    requiredDocuments: String(1,200)+ with {
      briefly "Documents"
      described as {
        |Required documents.
      }
    }
    requiredMeasurements: String(1,200)+ with {
      briefly "Measurements"
      described as {
        |Required measurements.
      }
    }
    traceabilityRequirements: String(1,1000) with {
      briefly "Traceability"
      described as {
        |Traceability requirements.
      }
    }
  } with {
    briefly "Certificate requirements"
    described as {
      |Certification requirements for a standard.
    }
  }
  command ValidateCertification is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    certificateNumber: String(1,100) with {
      briefly "Certificate"
      described as {
        |Certificate number.
      }
    }
    validatedBy: String(1,200) with {
      briefly "Validated by"
      described as {
        |Person validating.
      }
    }
  } with {
    briefly "Validate certification"
    described as {
      |Validates a certification against requirements.
    }
  }
  event CertificationValidated is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part ID.
      }
    }
    certificateNumber: String(1,100) with {
      briefly "Certificate"
      described as {
        |Certificate number.
      }
    }
    isValid: Boolean with {
      briefly "Valid"
      described as {
        |Validation result.
      }
    }
    findings: String(1,500)* with {
      briefly "Findings"
      described as {
        |Validation findings.
      }
    }
    validatedAt: TimeStamp with {
      briefly "Validated"
      described as {
        |Validation time.
      }
    }
  } with {
    briefly "Certification validated"
    described as {
      |Emitted when certification is validated.
    }
  }
  command RevokeCertification is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    certificateNumber: String(1,100) with {
      briefly "Certificate"
      described as {
        |Certificate number.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Revocation reason.
      }
    }
    revokedBy: String(1,200) with {
      briefly "Revoked by"
      described as {
        |Person revoking.
      }
    }
  } with {
    briefly "Revoke certification"
    described as {
      |Revokes a certification.
    }
  }
  event CertificationRevoked is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part ID.
      }
    }
    certificateNumber: String(1,100) with {
      briefly "Certificate"
      described as {
        |Certificate number.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Revocation reason.
      }
    }
    revokedAt: TimeStamp with {
      briefly "Revoked"
      described as {
        |Revocation time.
      }
    }
  } with {
    briefly "Certification revoked"
    described as {
      |Emitted when certification is revoked.
    }
  }
  query GetComplianceStandards is  {
    industry: String(1,100) with {
      briefly "Industry"
      described as {
        |Industry sector.
      }
    }
  } with {
    briefly "Get compliance standards"
    described as {
      |Retrieves applicable compliance standards.
    }
  }
  result ComplianceStandards is  {
    standards: String(1,100)+ with {
      briefly "Standards"
      described as {
        |Applicable standards.
      }
    }
    descriptions: String(1,500)+ with {
      briefly "Descriptions"
      described as {
        |Standard descriptions.
      }
    }
  } with {
    briefly "Compliance standards"
    described as {
      |List of applicable compliance standards.
    }
  }
} with {
  option external()
  briefly "External certification service"
  described as {
    |External AS9100, ISO 9001, and NADCAP certification service.
  }
}
