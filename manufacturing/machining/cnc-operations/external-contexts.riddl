// CNC Operations - External Contexts
// Tool Management Service
context ToolManagementService is {
  query GetToolLife is  {
    toolId: ToolId with {
      briefly "Tool"
      described as {
        |Tool identifier.
      }
    }
  } with {
    briefly "Get tool life"
    described as {
      |Retrieves current tool life status.
    }
  }
  result ToolLifeStatus is  {
    toolId: ToolId with {
      briefly "Tool"
      described as {
        |Tool identifier.
      }
    }
    currentLife: Natural with {
      briefly "Current"
      described as {
        |Current life (parts or min).
      }
    }
    maxLife: Natural with {
      briefly "Max"
      described as {
        |Maximum life before replacement.
      }
    }
    lifeRemaining: Decimal(5,2) with {
      briefly "Remaining"
      described as {
        |Life remaining percentage.
      }
    }
    lastReplaced: TimeStamp with {
      briefly "Last replaced"
      described as {
        |Last replacement time.
      }
    }
    predictedExhaustion: TimeStamp? with {
      briefly "Predicted"
      described as {
        |Predicted exhaustion time.
      }
    }
  } with {
    briefly "Tool life status"
    described as {
      |Current tool life information.
    }
  }
  query GetToolOffsets is  {
    toolId: ToolId with {
      briefly "Tool"
      described as {
        |Tool identifier.
      }
    }
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Target machine.
      }
    }
  } with {
    briefly "Get tool offsets"
    described as {
      |Retrieves tool offset values for machine.
    }
  }
  result ToolOffsets is  {
    toolId: ToolId with {
      briefly "Tool"
      described as {
        |Tool identifier.
      }
    }
    lengthOffset: Decimal(10,4) with {
      briefly "Length"
      described as {
        |Length offset value.
      }
    }
    diameterOffset: Decimal(10,4) with {
      briefly "Diameter"
      described as {
        |Diameter offset value.
      }
    }
    wearOffset: Decimal(10,4) with {
      briefly "Wear"
      described as {
        |Wear compensation value.
      }
    }
    lastMeasured: TimeStamp with {
      briefly "Measured"
      described as {
        |Last measurement time.
      }
    }
  } with {
    briefly "Tool offsets"
    described as {
      |Tool offset values.
    }
  }
  command UpdateToolLife is  {
    toolId: ToolId with {
      briefly "Tool"
      described as {
        |Tool identifier.
      }
    }
    partsProduced: Natural with {
      briefly "Parts"
      described as {
        |Parts produced since last update.
      }
    }
    cuttingTime: Natural with {
      briefly "Cutting time"
      described as {
        |Cutting time in minutes.
      }
    }
  } with {
    briefly "Update tool life"
    described as {
      |Updates tool life tracking.
    }
  }
  event ToolLifeUpdated is  {
    toolId: ToolId with {
      briefly "Tool"
      described as {
        |Tool identifier.
      }
    }
    newLifeValue: Natural with {
      briefly "Life"
      described as {
        |Updated life value.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Tool life updated"
    described as {
      |Emitted when tool life is updated.
    }
  }
  event ToolLifeWarning is  {
    toolId: ToolId with {
      briefly "Tool"
      described as {
        |Tool identifier.
      }
    }
    lifeRemaining: Decimal(5,2) with {
      briefly "Remaining"
      described as {
        |Life remaining percentage.
      }
    }
    warningAt: TimeStamp with {
      briefly "Warning"
      described as {
        |Warning time.
      }
    }
  } with {
    briefly "Tool life warning"
    described as {
      |Emitted when tool approaches end of life.
    }
  }
  event ToolExhausted is  {
    toolId: ToolId with {
      briefly "Tool"
      described as {
        |Tool identifier.
      }
    }
    exhaustedAt: TimeStamp with {
      briefly "Exhausted"
      described as {
        |Exhaustion time.
      }
    }
    replacementRequired: Boolean with {
      briefly "Replace"
      described as {
        |Whether replacement is required.
      }
    }
  } with {
    briefly "Tool exhausted"
    described as {
      |Emitted when tool reaches end of life.
    }
  }
} with {
  option external()
  briefly "External tool management"
  described as {
    |External tool life tracking and offset management service.
  }
}
// Maintenance Service
context MaintenanceService is {
  query GetPMSchedule is  {
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
  } with {
    briefly "Get PM schedule"
    described as {
      |Retrieves preventive maintenance schedule.
    }
  }
  result PMSchedule is  {
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    nextPMDate: Date with {
      briefly "Next PM"
      described as {
        |Next scheduled PM date.
      }
    }
    pmType: String(1,100) with {
      briefly "Type"
      described as {
        |Type of PM due.
      }
    }
    estimatedDuration: Natural with {
      briefly "Duration"
      described as {
        |Estimated duration (min).
      }
    }
    checklistItems: String(1,200)+ with {
      briefly "Checklist"
      described as {
        |PM checklist items.
      }
    }
    overdue: Boolean with {
      briefly "Overdue"
      described as {
        |Whether PM is overdue.
      }
    }
  } with {
    briefly "PM schedule"
    described as {
      |Preventive maintenance schedule.
    }
  }
  command SchedulePM is  {
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    pmType: String(1,100) with {
      briefly "Type"
      described as {
        |PM type.
      }
    }
    scheduledDate: Date with {
      briefly "Date"
      described as {
        |Scheduled date.
      }
    }
    assignedTo: String(1,200) with {
      briefly "Assigned"
      described as {
        |Assigned technician.
      }
    }
  } with {
    briefly "Schedule PM"
    described as {
      |Schedules preventive maintenance.
    }
  }
  event PMScheduled is  {
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    pmId: UUID with {
      briefly "PM ID"
      described as {
        |PM work order ID.
      }
    }
    scheduledDate: Date with {
      briefly "Date"
      described as {
        |Scheduled date.
      }
    }
    scheduledAt: TimeStamp with {
      briefly "Scheduled"
      described as {
        |Scheduling time.
      }
    }
  } with {
    briefly "PM scheduled"
    described as {
      |Emitted when PM is scheduled.
    }
  }
  command ReportMachineIssue is  {
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    issueDescription: String(1,1000) with {
      briefly "Issue"
      described as {
        |Issue description.
      }
    }
    severity: AlarmSeverity with {
      briefly "Severity"
      described as {
        |Issue severity.
      }
    }
    reportedBy: String(1,200) with {
      briefly "Reported by"
      described as {
        |Person reporting.
      }
    }
  } with {
    briefly "Report machine issue"
    described as {
      |Reports a machine maintenance issue.
    }
  }
  event MaintenanceRequested is  {
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    maintenanceWorkOrderId: UUID with {
      briefly "Work order"
      described as {
        |Maintenance work order ID.
      }
    }
    priority: AlarmSeverity with {
      briefly "Priority"
      described as {
        |Request priority.
      }
    }
    requestedAt: TimeStamp with {
      briefly "Requested"
      described as {
        |Request time.
      }
    }
  } with {
    briefly "Maintenance requested"
    described as {
      |Emitted when maintenance is requested.
    }
  }
  event PMDueReminder is  {
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    pmType: String(1,100) with {
      briefly "Type"
      described as {
        |PM type due.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |PM due date.
      }
    }
    reminderAt: TimeStamp with {
      briefly "Reminder"
      described as {
        |Reminder time.
      }
    }
  } with {
    briefly "PM due reminder"
    described as {
      |Emitted when PM is approaching due date.
    }
  }
} with {
  option external()
  briefly "External maintenance service"
  described as {
    |External preventive maintenance scheduling service.
  }
}
// Quality Service
context QualityService is {
  query GetSPCLimits is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    characteristic: String(1,100) with {
      briefly "Characteristic"
      described as {
        |Quality characteristic.
      }
    }
  } with {
    briefly "Get SPC limits"
    described as {
      |Retrieves statistical process control limits.
    }
  }
  result SPCLimits is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    characteristic: String(1,100) with {
      briefly "Characteristic"
      described as {
        |Quality characteristic.
      }
    }
    nominal: Decimal(12,4) with {
      briefly "Nominal"
      described as {
        |Nominal value.
      }
    }
    upperSpecLimit: Decimal(12,4) with {
      briefly "USL"
      described as {
        |Upper spec limit.
      }
    }
    lowerSpecLimit: Decimal(12,4) with {
      briefly "LSL"
      described as {
        |Lower spec limit.
      }
    }
    upperControlLimit: Decimal(12,4) with {
      briefly "UCL"
      described as {
        |Upper control limit.
      }
    }
    lowerControlLimit: Decimal(12,4) with {
      briefly "LCL"
      described as {
        |Lower control limit.
      }
    }
    cpk: Decimal(5,2) with {
      briefly "Cpk"
      described as {
        |Process capability index.
      }
    }
  } with {
    briefly "SPC limits"
    described as {
      |Statistical process control limits.
    }
  }
  command RecordMeasurement is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    characteristic: String(1,100) with {
      briefly "Characteristic"
      described as {
        |Measured characteristic.
      }
    }
    measuredValue: Decimal(12,4) with {
      briefly "Value"
      described as {
        |Measured value.
      }
    }
    measuredBy: String(1,200) with {
      briefly "Measured by"
      described as {
        |Person measuring.
      }
    }
  } with {
    briefly "Record measurement"
    described as {
      |Records a quality measurement.
    }
  }
  event MeasurementRecorded is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    characteristic: String(1,100) with {
      briefly "Characteristic"
      described as {
        |Characteristic measured.
      }
    }
    measuredValue: Decimal(12,4) with {
      briefly "Value"
      described as {
        |Measured value.
      }
    }
    inSpec: Boolean with {
      briefly "In spec"
      described as {
        |Whether value is in specification.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Measurement time.
      }
    }
  } with {
    briefly "Measurement recorded"
    described as {
      |Emitted when measurement is recorded.
    }
  }
  event SPCViolation is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    characteristic: String(1,100) with {
      briefly "Characteristic"
      described as {
        |Violated characteristic.
      }
    }
    measuredValue: Decimal(12,4) with {
      briefly "Value"
      described as {
        |Out-of-control value.
      }
    }
    violationType: String(1,50) with {
      briefly "Type"
      described as {
        |Violation type.
      }
    }
    violatedAt: TimeStamp with {
      briefly "Violated"
      described as {
        |Violation time.
      }
    }
  } with {
    briefly "SPC violation"
    described as {
      |Emitted when SPC control limit is violated.
    }
  }
  command RequestFirstArticle is  {
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    programId: ProgramId with {
      briefly "Program"
      described as {
        |NC program identifier.
      }
    }
    requestedBy: String(1,200) with {
      briefly "Requested by"
      described as {
        |Person requesting.
      }
    }
  } with {
    briefly "Request first article"
    described as {
      |Requests first article inspection.
    }
  }
  event FirstArticleRequested is  {
    inspectionId: UUID with {
      briefly "Inspection"
      described as {
        |Inspection ID.
      }
    }
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    machineId: MachineId with {
      briefly "Machine"
      described as {
        |Machine identifier.
      }
    }
    requestedAt: TimeStamp with {
      briefly "Requested"
      described as {
        |Request time.
      }
    }
  } with {
    briefly "First article requested"
    described as {
      |Emitted when first article inspection is requested.
    }
  }
  event FirstArticleApproved is  {
    inspectionId: UUID with {
      briefly "Inspection"
      described as {
        |Inspection ID.
      }
    }
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    approvedBy: String(1,200) with {
      briefly "Approved by"
      described as {
        |Person approving.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "First article approved"
    described as {
      |Emitted when first article is approved.
    }
  }
  event FirstArticleRejected is  {
    inspectionId: UUID with {
      briefly "Inspection"
      described as {
        |Inspection ID.
      }
    }
    partId: PartId with {
      briefly "Part"
      described as {
        |Part identifier.
      }
    }
    rejectionReason: String(1,1000) with {
      briefly "Reason"
      described as {
        |Rejection reason.
      }
    }
    rejectedBy: String(1,200) with {
      briefly "Rejected by"
      described as {
        |Person rejecting.
      }
    }
    rejectedAt: TimeStamp with {
      briefly "Rejected"
      described as {
        |Rejection time.
      }
    }
  } with {
    briefly "First article rejected"
    described as {
      |Emitted when first article is rejected.
    }
  }
} with {
  option external()
  briefly "External quality service"
  described as {
    |External SPC and first-article inspection service.
  }
}
