// Equipment Maintenance - External Contexts
// These represent external systems that Equipment Maintenance integrates with
context EquipmentRegistry is {
  type AssetStatus is any of {
    Operational,
    Degraded,
    OutOfService,
    UnderMaintenance,
    Decommissioned
  } with {
    briefly "Equipment operational status"
  }
  command GetEquipmentDetails is  { equipmentId: EquipmentId } with {
    briefly "Retrieve equipment master data"
  }
  command UpdateEquipmentStatus is  {
    equipmentId: EquipmentId
    status: AssetStatus
    reason: String(1,500)
  } with {
    briefly "Update equipment operational status"
  }
  command GetMaintenanceSchedule is  { equipmentId: EquipmentId } with {
    briefly "Retrieve PM schedule for equipment"
  }
  event EquipmentDetailsRetrieved is  {
    equipmentId: EquipmentId
    equipmentName: String(1,200)
    assetNumber: String(1,50)
    location: String(1,200)
    manufacturer: String(1,100)
    model: String(1,100)
    status: AssetStatus
    installDate: Date
    warrantyExpiration: Date?
  } with {
    briefly "Equipment details returned"
  }
  event EquipmentStatusChanged is  {
    equipmentId: EquipmentId
    previousStatus: AssetStatus
    newStatus: AssetStatus
    changedAt: TimeStamp
    reason: String(1,500)
  } with {
    briefly "Equipment status was updated"
  }
  event MaintenanceScheduleUpdated is  {
    equipmentId: EquipmentId
    pmIntervalDays: Natural
    nextPmDate: Date
    pmTaskList: {
      taskName: String(1,200)
      estimatedMinutes: Natural
    }
+
  } with {
    briefly "PM schedule was updated"
  }
  handler EquipmentHandler is {
    on command GetEquipmentDetails is {
      tell event EquipmentDetailsRetrieved to context EquipmentRegistry
    }
    on command UpdateEquipmentStatus is {
      tell event EquipmentStatusChanged to context EquipmentRegistry
    }
    on command GetMaintenanceSchedule is {
      tell event MaintenanceScheduleUpdated to context EquipmentRegistry
    }
  } with {
    briefly "Handles equipment registry commands"
  }
} with {
  briefly "External equipment asset management system"
  option external()
  described as {
    | The EquipmentRegistry context represents the external equipment
    | asset management system (CMMS/EAM) that maintains master data
    | for all manufacturing equipment including specifications,
    | location, and preventive maintenance schedules.
  }
}
context SparePartsInventory is {
  type PartAvailability is any of {
    InStock,
    LowStock,
    OutOfStock,
    OnOrder
  } with {
    briefly "Spare part availability status"
  }
  command ReserveParts is  {
    orderId: MaintenanceOrderId
    reserveItems: {
      sparePartId: SparePartId
      partNumber: String(1,50)
      quantity: Natural
    }
+
  } with {
    briefly "Reserve parts for maintenance order"
  }
  command ReleaseParts is  {
    orderId: MaintenanceOrderId
    releaseItems: {
      sparePartId: SparePartId
      quantity: Natural
    }
+
  } with {
    briefly "Release reserved parts back to inventory"
  }
  command ConsumeParts is  {
    orderId: MaintenanceOrderId
    consumeItems: {
      sparePartId: SparePartId
      partNumber: String(1,50)
      quantity: Natural
    }
+
  } with {
    briefly "Record parts consumed during maintenance"
  }
  command CheckPartAvailability is  { partNumber: String(1,50) } with {
    briefly "Check current availability of a part"
  }
  event PartsReserved is  {
    orderId: MaintenanceOrderId
    reservedParts: {
      sparePartId: SparePartId
      partNumber: String(1,50)
      quantity: Natural
      unitCost: Decimal(10,2)
    }
+
    reservedAt: TimeStamp
  } with {
    briefly "Parts were successfully reserved"
  }
  event PartsReservationFailed is  {
    orderId: MaintenanceOrderId
    unavailableParts: {
      partNumber: String(1,50)
      requestedQuantity: Natural
      availableQuantity: Natural
      expectedAvailability: Date?
    }
+
    failedAt: TimeStamp
  } with {
    briefly "Parts reservation failed due to shortage"
  }
  event PartsConsumed is  {
    orderId: MaintenanceOrderId
    consumedParts: {
      sparePartId: SparePartId
      partNumber: String(1,50)
      partName: String(1,200)
      quantity: Natural
      unitCost: Decimal(10,2)
    }
+
    consumedAt: TimeStamp
  } with {
    briefly "Parts were consumed from inventory"
  }
  event PartsReleased is  {
    orderId: MaintenanceOrderId
    releasedAt: TimeStamp
  } with {
    briefly "Reserved parts were released back to inventory"
  }
  event PartAvailabilityChecked is  {
    partNumber: String(1,50)
    partName: String(1,200)
    availability: PartAvailability
    quantityOnHand: Natural
    reorderPoint: Natural
    checkedAt: TimeStamp
  } with {
    briefly "Part availability was checked"
  }
  handler InventoryHandler is {
    on command ReserveParts is {
      tell event PartsReserved to context SparePartsInventory
    }
    on command ReleaseParts is {
      tell event PartsReleased to context SparePartsInventory
    }
    on command ConsumeParts is {
      tell event PartsConsumed to context SparePartsInventory
    }
    on command CheckPartAvailability is {
      tell event PartAvailabilityChecked to context SparePartsInventory
    }
  } with {
    briefly "Handles spare parts inventory commands"
  }
} with {
  briefly "External spare parts inventory system"
  option external()
  described as {
    | The SparePartsInventory context represents the external inventory
    | management system that tracks spare parts for maintenance activities.
    | It handles parts reservation, consumption tracking, and availability
    | checking to ensure parts are available when needed.
  }
}
context ProductionSchedule is {
  type MaintenanceWindowStatus is any of {
    Requested,
    Approved,
    Rejected,
    InProgress,
    Completed
  } with {
    briefly "Status of maintenance window request"
  }
  command RequestMaintenanceWindow is  {
    orderId: MaintenanceOrderId
    equipmentId: EquipmentId
    requestedDate: Date
    requestedDuration: Duration
    priority: MaintenancePriority
    canDefer: Boolean
  } with {
    briefly "Request a maintenance window from production"
  }
  command CancelMaintenanceWindow is  {
    orderId: MaintenanceOrderId
    reason: String(1,500)
  } with {
    briefly "Cancel a previously approved window"
  }
  command NotifyMaintenanceComplete is  {
    orderId: MaintenanceOrderId
    equipmentId: EquipmentId
    completedAt: TimeStamp
    equipmentStatus: String(1,50)
  } with {
    briefly "Notify production that maintenance is complete"
  }
  event MaintenanceWindowApproved is  {
    orderId: MaintenanceOrderId
    equipmentId: EquipmentId
    approvedDate: Date
    approvedStart: TimeStamp
    approvedEnd: TimeStamp
    approvedAt: TimeStamp
  } with {
    briefly "Maintenance window was approved"
  }
  event MaintenanceWindowRejected is  {
    orderId: MaintenanceOrderId
    equipmentId: EquipmentId
    reason: String(1,500)
    alternativeDates: Date+
    rejectedAt: TimeStamp
  } with {
    briefly "Maintenance window was rejected"
  }
  event EquipmentNeededUrgently is  {
    equipmentId: EquipmentId
    reason: String(1,500)
    productionImpact: String(1,500)
    urgentAt: TimeStamp
  } with {
    briefly "Production urgently needs equipment back"
  }
  event MaintenanceCompletionAcknowledged is  {
    orderId: MaintenanceOrderId
    equipmentId: EquipmentId
    acknowledgedAt: TimeStamp
  } with {
    briefly "Production acknowledged maintenance completion"
  }
  handler ProductionHandler is {
    on command RequestMaintenanceWindow is {
      tell event MaintenanceWindowApproved to context ProductionSchedule
    }
    on command CancelMaintenanceWindow is {
      prompt "Remove maintenance window from production schedule"
    }
    on command NotifyMaintenanceComplete is {
      tell event MaintenanceCompletionAcknowledged to context ProductionSchedule
    }
  } with {
    briefly "Handles production schedule commands"
  }
} with {
  briefly "External production scheduling system"
  option external()
  described as {
    | The ProductionSchedule context represents the external production
    | scheduling system that coordinates equipment availability between
    | manufacturing and maintenance. It manages maintenance windows to
    | minimize impact on production while ensuring equipment is serviced.
  }
}
