// Asset Lifecycle Management - Asset Context

context AssetContext is {

  include "types.riddl"
  include "Asset.riddl"

  // Repository for asset persistence
  repository AssetRepository is {
    schema AssetData is relational
      of assets as Asset
      index on field Asset.assetId
      index on field Asset.assetInfo.assetTag
      index on field Asset.status
      index on field Asset.location.locationId

    handler AssetPersistence is {
      on event Asset.AssetRegistered {
        prompt "Store new asset record"
      }
      on event Asset.AssetInstalled {
        prompt "Update asset with installation details"
      }
      on event Asset.AssetTransferred {
        prompt "Update asset location and transfer history"
      }
      on event Asset.ValuationUpdated {
        prompt "Update asset financial values"
      }
      on event Asset.DepreciationScheduled {
        prompt "Store depreciation schedule"
      }
      on event Asset.MaintenanceRecorded {
        prompt "Add maintenance entry to history"
      }
      on event Asset.AssetDecommissioned {
        prompt "Update asset to decommissioned status"
      }
      on event Asset.AssetDisposed {
        prompt "Update asset to disposed and archive"
      }
    } with {
      briefly "Persists asset events"
      described by "Handles event-driven persistence for assets."
    }
  } with {
    briefly "Asset data persistence"
    described by {
      | The AssetRepository provides persistent storage for
      | assets, their financial data, and lifecycle history.
    }
  }

  // Projector for asset valuation reporting
  projector AssetValuationProjector is {
    updates repository AssetRepository

    record ValuationSummary is {
      totalAssets is Natural with { briefly "Total" described by "Total number of assets." }
      totalCapitalizedCost is Decimal(15, 2) with { briefly "Capitalized" described by "Total capitalized cost." }
      totalCurrentValue is Decimal(15, 2) with { briefly "Current value" described by "Total current book value." }
      totalAccumulatedDepreciation is Decimal(15, 2) with { briefly "Depreciation" described by "Total accumulated depreciation." }
      averageAssetAge is Decimal(5, 2) with { briefly "Average age" described by "Average asset age in years." }
    } with {
      briefly "Valuation summary"
      described by "Summary of asset valuations."
    }

    handler ValuationHandler is {
      on event Asset.AssetRegistered {
        prompt "Add new asset to valuation totals"
      }
      on event Asset.ValuationUpdated {
        prompt "Update valuation totals with new values"
      }
      on event Asset.DepreciationScheduled {
        prompt "Update depreciation calculations"
      }
      on event Asset.AssetDisposed {
        prompt "Remove asset from active valuation totals"
      }
    } with {
      briefly "Maintains valuation projections"
      described by "Projects events into valuation views."
    }
  } with {
    briefly "Asset valuation projections"
    described by "Maintains asset valuation and financial reporting data."
  }

  // Projector for depreciation reports
  projector DepreciationReportProjector is {
    updates repository AssetRepository

    record DepreciationReport is {
      periodStart is Date with { briefly "Period start" described by "Report period start date." }
      periodEnd is Date with { briefly "Period end" described by "Report period end date." }
      totalDepreciation is Decimal(15, 2) with { briefly "Total" described by "Total depreciation for period." }
      assetCount is Natural with { briefly "Asset count" described by "Number of assets depreciated." }
      byCategory is many String(1, 500) with { briefly "By category" described by "Depreciation by category." }
    } with {
      briefly "Depreciation report"
      described by "Period depreciation report."
    }

    handler DepreciationHandler is {
      on event Asset.DepreciationScheduled {
        prompt "Add asset to depreciation tracking"
      }
      on event Asset.ValuationUpdated {
        prompt "Update depreciation calculations"
      }
      on event Asset.AssetDecommissioned {
        prompt "Stop depreciation for asset"
      }
    } with {
      briefly "Maintains depreciation reports"
      described by "Projects events into depreciation reports."
    }
  } with {
    briefly "Depreciation report projections"
    described by "Maintains depreciation reporting data."
  }

  // Projector for utilization tracking
  projector UtilizationProjector is {
    updates repository AssetRepository

    record UtilizationMetrics is {
      activeAssets is Natural with { briefly "Active" described by "Number of active assets." }
      utilizationRate is Decimal(5, 4) with { briefly "Utilization" described by "Overall utilization rate." }
      underMaintenanceCount is Natural with { briefly "Under maintenance" described by "Assets under maintenance." }
      decommissionedCount is Natural with { briefly "Decommissioned" described by "Decommissioned assets." }
      averageLifespan is Decimal(6, 2) with { briefly "Avg lifespan" described by "Average asset lifespan in months." }
    } with {
      briefly "Utilization metrics"
      described by "Asset utilization statistics."
    }

    handler UtilizationHandler is {
      on event Asset.AssetInstalled {
        prompt "Increment active asset count"
      }
      on event Asset.AssetTransferred {
        prompt "Update utilization by location"
      }
      on event Asset.MaintenanceRecorded {
        prompt "Update maintenance metrics"
      }
      on event Asset.AssetDecommissioned {
        prompt "Update decommissioned count"
      }
      on event Asset.AssetDisposed {
        prompt "Calculate final lifespan metrics"
      }
    } with {
      briefly "Maintains utilization metrics"
      described by "Projects events into utilization views."
    }
  } with {
    briefly "Utilization tracking projections"
    described by "Maintains asset utilization and performance data."
  }

} with {
  briefly "Bounded context for asset lifecycle management"
  described by {
    | The AssetContext is the bounded context for managing
    | physical assets throughout their complete lifecycle.
  }
}
