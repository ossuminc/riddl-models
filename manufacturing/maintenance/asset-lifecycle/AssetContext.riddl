// Asset Lifecycle Management - Asset Context
context AssetContext is {
  include "types.riddl"
  include "Asset.riddl"
  // Repository for asset persistence
  repository AssetRepository is {
    schema AssetData is relational
      of assets as type Asset
        index on field Asset.assetId
        index on field Asset.assetInfo.assetTag
        index on field Asset.status
        index on field Asset.location.locationId

    handler AssetPersistence is {
      on command Asset.RegisterAsset is {
        prompt "Store new asset record"
      }
      on command Asset.InstallAsset is {
        prompt "Update asset with installation details"
      }
      on command Asset.TransferAsset is {
        prompt "Update asset location and transfer history"
      }
      on command Asset.UpdateValuation is {
        prompt "Update asset financial values"
      }
      on command Asset.ScheduleDepreciation is {
        prompt "Store depreciation schedule"
      }
      on command Asset.RecordMaintenance is {
        prompt "Add maintenance entry to history"
      }
      on command Asset.DecommissionAsset is {
        prompt "Update asset to decommissioned status"
      }
      on command Asset.DisposeAsset is {
        prompt "Update asset to disposed and archive"
      }
    } with {
      briefly "Persists asset commands"
      described as {
        |Handles command-driven persistence for assets.
      }
    }
  } with {
    briefly "Asset data persistence"
    described as {
      | The AssetRepository provides persistent storage for
      | assets, their financial data, and lifecycle history.
    }
  }
  // Projector for asset valuation reporting
  projector AssetValuationProjector is {
    record ValuationSummary is  {
      totalAssets: Natural with {
        briefly "Total"
        described as {
          |Total number of assets.
        }
      }
      totalCapitalizedCost: Decimal(15,2) with {
        briefly "Capitalized"
        described as {
          |Total capitalized cost.
        }
      }
      totalCurrentValue: Decimal(15,2) with {
        briefly "Current value"
        described as {
          |Total current book value.
        }
      }
      totalAccumulatedDepreciation: Decimal(15,2) with {
        briefly "Depreciation"
        described as {
          |Total accumulated depreciation.
        }
      }
      averageAssetAge: Decimal(5,2) with {
        briefly "Average age"
        described as {
          |Average asset age in years.
        }
      }
    } with {
      briefly "Valuation summary"
      described as {
        |Summary of asset valuations.
      }
    }
    handler ValuationHandler is {
      on event Asset.AssetRegistered is {
        prompt "Add new asset to valuation totals"
      }
      on event Asset.ValuationUpdated is {
        prompt "Update valuation totals with new values"
      }
      on event Asset.DepreciationScheduled is {
        prompt "Update depreciation calculations"
      }
      on event Asset.AssetDisposed is {
        prompt "Remove asset from active valuation totals"
      }
    } with {
      briefly "Maintains valuation projections"
      described as {
        |Projects events into valuation views.
      }
    }
  } with {
    briefly "Asset valuation projections"
    described as {
      |Maintains asset valuation and financial reporting data.
    }
  }
  // Projector for depreciation reports
  projector DepreciationReportProjector is {
    record DepreciationReport is  {
      periodStart: Date with {
        briefly "Period start"
        described as {
          |Report period start date.
        }
      }
      periodEnd: Date with {
        briefly "Period end"
        described as {
          |Report period end date.
        }
      }
      totalDepreciation: Decimal(15,2) with {
        briefly "Total"
        described as {
          |Total depreciation for period.
        }
      }
      assetCount: Natural with {
        briefly "Asset count"
        described as {
          |Number of assets depreciated.
        }
      }
      byCategory: String(1,500)+ with {
        briefly "By category"
        described as {
          |Depreciation by category.
        }
      }
    } with {
      briefly "Depreciation report"
      described as {
        |Period depreciation report.
      }
    }
    handler DepreciationHandler is {
      on event Asset.DepreciationScheduled is {
        prompt "Add asset to depreciation tracking"
      }
      on event Asset.ValuationUpdated is {
        prompt "Update depreciation calculations"
      }
      on event Asset.AssetDecommissioned is {
        prompt "Stop depreciation for asset"
      }
    } with {
      briefly "Maintains depreciation reports"
      described as {
        |Projects events into depreciation reports.
      }
    }
  } with {
    briefly "Depreciation report projections"
    described as {
      |Maintains depreciation reporting data.
    }
  }
  // Projector for utilization tracking
  projector UtilizationProjector is {
    record UtilizationMetrics is  {
      activeAssets: Natural with {
        briefly "Active"
        described as {
          |Number of active assets.
        }
      }
      utilizationRate: Decimal(5,4) with {
        briefly "Utilization"
        described as {
          |Overall utilization rate.
        }
      }
      underMaintenanceCount: Natural with {
        briefly "Under maintenance"
        described as {
          |Assets under maintenance.
        }
      }
      decommissionedCount: Natural with {
        briefly "Decommissioned"
        described as {
          |Decommissioned assets.
        }
      }
      averageLifespan: Decimal(6,2) with {
        briefly "Avg lifespan"
        described as {
          |Average asset lifespan in months.
        }
      }
    } with {
      briefly "Utilization metrics"
      described as {
        |Asset utilization statistics.
      }
    }
    handler UtilizationHandler is {
      on event Asset.AssetInstalled is {
        prompt "Increment active asset count"
      }
      on event Asset.AssetTransferred is {
        prompt "Update utilization by location"
      }
      on event Asset.MaintenanceRecorded is {
        prompt "Update maintenance metrics"
      }
      on event Asset.AssetDecommissioned is {
        prompt "Update decommissioned count"
      }
      on event Asset.AssetDisposed is {
        prompt "Calculate final lifespan metrics"
      }
    } with {
      briefly "Maintains utilization metrics"
      described as {
        |Projects events into utilization views.
      }
    }
  } with {
    briefly "Utilization tracking projections"
    described as {
      |Maintains asset utilization and performance data.
    }
  }
} with {
  briefly "Bounded context for asset lifecycle management"
  described as {
    | The AssetContext is the bounded context for managing
    | physical assets throughout their complete lifecycle.
  }
}
