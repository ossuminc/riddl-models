// Asset Lifecycle Management - Asset Entity

entity Asset is {

  // Commands
  command RegisterAsset is {
    assetId is AssetId with {
      briefly "Asset ID"
      described by "New asset identifier."
    }
    assetInfo is AssetInfo with {
      briefly "Asset info"
      described by "Core asset information."
    }
    financialInfo is FinancialInfo with {
      briefly "Financial info"
      described by "Financial details."
    }
    vendorId is VendorId with {
      briefly "Vendor"
      described by "Supplier vendor identifier."
    }
    registeredBy is String(1, 200) with {
      briefly "Registered by"
      described by "Person registering the asset."
    }
  } with {
    briefly "Register asset"
    described by "Registers a new asset in the system."
  }

  command InstallAsset is {
    assetId is AssetId with {
      briefly "Asset ID"
      described by "Asset identifier."
    }
    installation is InstallationInfo with {
      briefly "Installation"
      described by "Installation details."
    }
  } with {
    briefly "Install asset"
    described by "Records asset installation at a location."
  }

  command TransferAsset is {
    assetId is AssetId with {
      briefly "Asset ID"
      described by "Asset identifier."
    }
    transfer is LocationTransfer with {
      briefly "Transfer"
      described by "Transfer details."
    }
  } with {
    briefly "Transfer asset"
    described by "Transfers asset to a new location."
  }

  command UpdateValuation is {
    assetId is AssetId with {
      briefly "Asset ID"
      described by "Asset identifier."
    }
    valuation is ValuationInfo with {
      briefly "Valuation"
      described by "New valuation information."
    }
  } with {
    briefly "Update valuation"
    described by "Updates asset book value."
  }

  command ScheduleDepreciation is {
    assetId is AssetId with {
      briefly "Asset ID"
      described by "Asset identifier."
    }
    schedule is DepreciationSchedule with {
      briefly "Schedule"
      described by "Depreciation schedule parameters."
    }
  } with {
    briefly "Schedule depreciation"
    described by "Sets up depreciation schedule for asset."
  }

  command RecordMaintenance is {
    assetId is AssetId with {
      briefly "Asset ID"
      described by "Asset identifier."
    }
    maintenance is MaintenanceEntry with {
      briefly "Maintenance"
      described by "Maintenance entry details."
    }
  } with {
    briefly "Record maintenance"
    described by "Records maintenance performed on asset."
  }

  command DecommissionAsset is {
    assetId is AssetId with {
      briefly "Asset ID"
      described by "Asset identifier."
    }
    decommission is DecommissionInfo with {
      briefly "Decommission"
      described by "Decommission details."
    }
  } with {
    briefly "Decommission asset"
    described by "Removes asset from active service."
  }

  command DisposeAsset is {
    assetId is AssetId with {
      briefly "Asset ID"
      described by "Asset identifier."
    }
    disposal is DisposalInfo with {
      briefly "Disposal"
      described by "Disposal details."
    }
  } with {
    briefly "Dispose asset"
    described by "Permanently disposes of the asset."
  }

  // Events
  event AssetRegistered is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    assetInfo is AssetInfo with { briefly "Info" described by "Asset information." }
    financialInfo is FinancialInfo with { briefly "Financial" described by "Financial info." }
    vendorId is VendorId with { briefly "Vendor" described by "Vendor ID." }
    registeredBy is String(1, 200) with { briefly "Registered by" described by "Person registering." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Asset registered"
    described by "Emitted when a new asset is registered."
  }

  event AssetInstalled is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    installation is InstallationInfo with { briefly "Installation" described by "Installation details." }
    installedAt is TimeStamp with { briefly "Installed" described by "Installation time." }
  } with {
    briefly "Asset installed"
    described by "Emitted when asset is installed at a location."
  }

  event AssetTransferred is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    transfer is LocationTransfer with { briefly "Transfer" described by "Transfer details." }
    transferredAt is TimeStamp with { briefly "Transferred" described by "Transfer time." }
  } with {
    briefly "Asset transferred"
    described by "Emitted when asset is transferred to new location."
  }

  event ValuationUpdated is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    valuation is ValuationInfo with { briefly "Valuation" described by "Valuation details." }
    updatedAt is TimeStamp with { briefly "Updated" described by "Update time." }
  } with {
    briefly "Valuation updated"
    described by "Emitted when asset valuation is updated."
  }

  event DepreciationScheduled is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    schedule is DepreciationSchedule with { briefly "Schedule" described by "Depreciation schedule." }
    scheduledAt is TimeStamp with { briefly "Scheduled" described by "Schedule time." }
  } with {
    briefly "Depreciation scheduled"
    described by "Emitted when depreciation schedule is set."
  }

  event MaintenanceRecorded is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    maintenance is MaintenanceEntry with { briefly "Maintenance" described by "Maintenance entry." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Maintenance recorded"
    described by "Emitted when maintenance is recorded."
  }

  event AssetDecommissioned is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    decommission is DecommissionInfo with { briefly "Decommission" described by "Decommission details." }
    decommissionedAt is TimeStamp with { briefly "Decommissioned" described by "Decommission time." }
  } with {
    briefly "Asset decommissioned"
    described by "Emitted when asset is decommissioned."
  }

  event AssetDisposed is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    disposal is DisposalInfo with { briefly "Disposal" described by "Disposal details." }
    disposedAt is TimeStamp with { briefly "Disposed" described by "Disposal time." }
  } with {
    briefly "Asset disposed"
    described by "Emitted when asset is disposed."
  }

  // State Records
  record OrderedStateData is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    assetInfo is AssetInfo with { briefly "Info" described by "Asset information." }
    financialInfo is FinancialInfo with { briefly "Financial" described by "Financial info." }
    vendorId is VendorId with { briefly "Vendor" described by "Vendor ID." }
    status is AssetStatus with { briefly "Status" described by "Asset status." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Ordered state data"
    described by "State for newly registered asset awaiting installation."
  }

  record InstalledStateData is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    assetInfo is AssetInfo with { briefly "Info" described by "Asset information." }
    financialInfo is FinancialInfo with { briefly "Financial" described by "Financial info." }
    installation is InstallationInfo with { briefly "Installation" described by "Installation details." }
    depreciation is optional DepreciationSchedule with { briefly "Depreciation" described by "Depreciation schedule." }
    status is AssetStatus with { briefly "Status" described by "Asset status." }
    condition is AssetCondition with { briefly "Condition" described by "Asset condition." }
  } with {
    briefly "Installed state data"
    described by "State for installed asset."
  }

  record OperatingStateData is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    assetInfo is AssetInfo with { briefly "Info" described by "Asset information." }
    financialInfo is FinancialInfo with { briefly "Financial" described by "Financial info." }
    location is LocationInfo with { briefly "Location" described by "Current location." }
    depreciation is DepreciationSchedule with { briefly "Depreciation" described by "Depreciation schedule." }
    maintenanceHistory is MaintenanceHistory with { briefly "Maintenance" described by "Maintenance history." }
    transferHistory is many optional LocationTransfer with { briefly "Transfers" described by "Transfer history." }
    status is AssetStatus with { briefly "Status" described by "Asset status." }
    condition is AssetCondition with { briefly "Condition" described by "Asset condition." }
  } with {
    briefly "Operating state data"
    described by "State for actively operating asset."
  }

  record DecommissionedStateData is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    assetInfo is AssetInfo with { briefly "Info" described by "Asset information." }
    financialInfo is FinancialInfo with { briefly "Financial" described by "Final financial info." }
    decommission is DecommissionInfo with { briefly "Decommission" described by "Decommission details." }
    maintenanceHistory is MaintenanceHistory with { briefly "Maintenance" described by "Maintenance history." }
    status is AssetStatus with { briefly "Status" described by "Asset status." }
  } with {
    briefly "Decommissioned state data"
    described by "State for decommissioned asset awaiting disposal."
  }

  record DisposedStateData is {
    assetId is AssetId with { briefly "Asset" described by "Asset ID." }
    assetInfo is AssetInfo with { briefly "Info" described by "Asset information." }
    disposal is DisposalInfo with { briefly "Disposal" described by "Disposal details." }
    status is AssetStatus with { briefly "Status" described by "Asset status." }
    archivedAt is TimeStamp with { briefly "Archived" described by "Archive time." }
  } with {
    briefly "Disposed state data"
    described by "Final state for disposed asset."
  }

  // States
  state OrderedState of Asset.OrderedStateData with {
    briefly "Asset ordered"
    described by "Asset is registered but not yet installed."
  }

  state InstalledState of Asset.InstalledStateData with {
    briefly "Asset installed"
    described by "Asset has been installed at a location."
  }

  state OperatingState of Asset.OperatingStateData with {
    briefly "Asset operating"
    described by "Asset is in active operation."
  }

  state DecommissionedState of Asset.DecommissionedStateData with {
    briefly "Asset decommissioned"
    described by "Asset has been removed from service."
  }

  state DisposedState of Asset.DisposedStateData with {
    briefly "Asset disposed"
    described by "Asset has been disposed of."
  }

  // Handler
  handler AssetHandler is {
    on command RegisterAsset {
      morph entity AssetContext.Asset to state AssetContext.Asset.OrderedState with command RegisterAsset
      tell event AssetRegistered to entity AssetContext.Asset
    }

    on command InstallAsset {
      morph entity AssetContext.Asset to state AssetContext.Asset.InstalledState with command InstallAsset
      tell event AssetInstalled to entity AssetContext.Asset
    }

    on command TransferAsset {
      morph entity AssetContext.Asset to state AssetContext.Asset.OperatingState with command TransferAsset
      tell event AssetTransferred to entity AssetContext.Asset
    }

    on command UpdateValuation {
      tell event ValuationUpdated to entity AssetContext.Asset
    }

    on command ScheduleDepreciation {
      morph entity AssetContext.Asset to state AssetContext.Asset.OperatingState with command ScheduleDepreciation
      tell event DepreciationScheduled to entity AssetContext.Asset
    }

    on command RecordMaintenance {
      tell event MaintenanceRecorded to entity AssetContext.Asset
    }

    on command DecommissionAsset {
      morph entity AssetContext.Asset to state AssetContext.Asset.DecommissionedState with command DecommissionAsset
      tell event AssetDecommissioned to entity AssetContext.Asset
    }

    on command DisposeAsset {
      morph entity AssetContext.Asset to state AssetContext.Asset.DisposedState with command DisposeAsset
      tell event AssetDisposed to entity AssetContext.Asset
    }
  } with {
    briefly "Processes asset lifecycle commands"
    described by {
      | Handles asset lifecycle from registration through
      | installation, operation, maintenance, and disposal.
    }
  }

} with {
  briefly "Asset aggregate"
  described by {
    | The Asset entity manages the complete lifecycle of
    | physical assets from acquisition to disposal.
  }
}
