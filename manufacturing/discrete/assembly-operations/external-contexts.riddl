// Assembly Operations - External Contexts

// Inventory Service - Component availability
context InventoryService is {

  query CheckComponentAvailability is {
    componentIds is many ComponentId with { briefly "Components" described by "Components to check." }
    workStationId is WorkStationId with { briefly "Station" described by "Target work station." }
  } with {
    briefly "Check availability"
    described by "Checks component availability for assembly."
  }

  result ComponentAvailability is {
    componentId is ComponentId with { briefly "Component" described by "Component ID." }
    available is Boolean with { briefly "Available" described by "Whether available." }
    quantityOnHand is Natural with { briefly "On hand" described by "Quantity available." }
    quantityReserved is Natural with { briefly "Reserved" described by "Quantity reserved." }
    location is String(1, 100) with { briefly "Location" described by "Storage location." }
  } with {
    briefly "Component availability"
    described by "Availability status of a component."
  }

  command ReserveComponents is {
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    components is many ComponentInfo with { briefly "Components" described by "Components to reserve." }
    workStationId is WorkStationId with { briefly "Station" described by "Target station." }
  } with {
    briefly "Reserve components"
    described by "Reserves components for an assembly order."
  }

  event ComponentsReserved is {
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    reservedAt is TimeStamp with { briefly "Reserved" described by "Reservation time." }
  } with {
    briefly "Components reserved"
    described by "Emitted when components are reserved."
  }

  event ComponentShortage is {
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    shortComponents is many ComponentId with { briefly "Short" described by "Short components." }
    detectedAt is TimeStamp with { briefly "Detected" described by "Detection time." }
  } with {
    briefly "Component shortage"
    described by "Emitted when component shortage detected."
  }

  command IssueComponents is {
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    components is many ComponentInfo with { briefly "Components" described by "Components to issue." }
    issuedTo is String(1, 200) with { briefly "Issued to" described by "Operator receiving." }
  } with {
    briefly "Issue components"
    described by "Issues components to assembly order."
  }

  event ComponentsIssued is {
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    issuedAt is TimeStamp with { briefly "Issued" described by "Issue time." }
  } with {
    briefly "Components issued"
    described by "Emitted when components are issued."
  }

} with {
  option is external
  briefly "External inventory service"
  described by "External inventory system for component management."
}

// Work Order Service - Parent work order
context WorkOrderService is {

  query GetWorkOrderDetails is {
    workOrderId is WorkOrderId with { briefly "Work Order" described by "Work order ID." }
  } with {
    briefly "Get work order"
    described by "Retrieves parent work order details."
  }

  result WorkOrderDetails is {
    workOrderId is WorkOrderId with { briefly "Work Order" described by "Work order ID." }
    product is ProductInfo with { briefly "Product" described by "Product info." }
    quantity is Natural with { briefly "Quantity" described by "Order quantity." }
    priority is String(1, 50) with { briefly "Priority" described by "Order priority." }
    dueDate is Date with { briefly "Due" described by "Due date." }
    workOrderStatus is String(1, 50) with { briefly "Status" described by "Work order status." }
  } with {
    briefly "Work order details"
    described by "Parent work order information."
  }

  command ReportAssemblyComplete is {
    workOrderId is WorkOrderId with { briefly "Work Order" described by "Work order ID." }
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    completedQuantity is Natural with { briefly "Quantity" described by "Completed quantity." }
    passedQuality is Boolean with { briefly "Passed" described by "Quality result." }
  } with {
    briefly "Report assembly complete"
    described by "Reports assembly completion to work order."
  }

  event AssemblyReported is {
    workOrderId is WorkOrderId with { briefly "Work Order" described by "Work order ID." }
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    reportedAt is TimeStamp with { briefly "Reported" described by "Report time." }
  } with {
    briefly "Assembly reported"
    described by "Emitted when assembly completion is reported."
  }

  command ReportAssemblyFailure is {
    workOrderId is WorkOrderId with { briefly "Work Order" described by "Work order ID." }
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    reason is String(1, 1000) with { briefly "Reason" described by "Failure reason." }
  } with {
    briefly "Report assembly failure"
    described by "Reports assembly failure to work order."
  }

} with {
  option is external
  briefly "External work order service"
  described by "External work order management system."
}

// Quality Service - Defect tracking
context QualityService is {

  query GetInspectionPlan is {
    productId is ProductId with { briefly "Product" described by "Product ID." }
    revision is String(1, 20) with { briefly "Revision" described by "Product revision." }
  } with {
    briefly "Get inspection plan"
    described by "Retrieves quality inspection plan."
  }

  result InspectionPlan is {
    productId is ProductId with { briefly "Product" described by "Product ID." }
    checkpoints is many QualityCheck with { briefly "Checkpoints" described by "Inspection checkpoints." }
    passCriteria is String(1, 500) with { briefly "Criteria" described by "Pass criteria." }
  } with {
    briefly "Inspection plan"
    described by "Quality inspection plan for product."
  }

  command RecordDefect is {
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    defect is DefectInfo with { briefly "Defect" described by "Defect details." }
  } with {
    briefly "Record defect"
    described by "Records defect in quality system."
  }

  event DefectLogged is {
    defectId is DefectId with { briefly "Defect" described by "Defect ID." }
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    loggedAt is TimeStamp with { briefly "Logged" described by "Log time." }
  } with {
    briefly "Defect logged"
    described by "Emitted when defect is logged."
  }

  command RecordFailure is {
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    reason is String(1, 1000) with { briefly "Reason" described by "Failure reason." }
    defects is many optional DefectInfo with { briefly "Defects" described by "Associated defects." }
  } with {
    briefly "Record failure"
    described by "Records assembly failure in quality system."
  }

  event FailureLogged is {
    assemblyOrderId is AssemblyOrderId with { briefly "Assembly Order" described by "Assembly order ID." }
    failureId is UUID with { briefly "Failure" described by "Failure record ID." }
    loggedAt is TimeStamp with { briefly "Logged" described by "Log time." }
  } with {
    briefly "Failure logged"
    described by "Emitted when failure is logged."
  }

  query GetDefectCodes is {
    category is optional String(1, 100) with { briefly "Category" described by "Defect category filter." }
  } with {
    briefly "Get defect codes"
    described by "Retrieves available defect codes."
  }

  result DefectCodeList is {
    codes is many String(1, 50) with { briefly "Codes" described by "Defect codes." }
    descriptions is many String(1, 200) with { briefly "Descriptions" described by "Code descriptions." }
  } with {
    briefly "Defect code list"
    described by "List of available defect codes."
  }

} with {
  option is external
  briefly "External quality service"
  described by "External quality management and defect tracking system."
}
