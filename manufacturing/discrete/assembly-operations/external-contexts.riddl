// Assembly Operations - External Contexts
// Inventory Service - Component availability
context InventoryService is {
  query CheckComponentAvailability is  {
    componentIds: ComponentId+ with {
      briefly "Components"
      described as {
        |Components to check.
      }
    }
    workStationId: WorkStationId with {
      briefly "Station"
      described as {
        |Target work station.
      }
    }
  } with {
    briefly "Check availability"
    described as {
      |Checks component availability for assembly.
    }
  }
  result ComponentAvailability is  {
    componentId: ComponentId with {
      briefly "Component"
      described as {
        |Component ID.
      }
    }
    available: Boolean with {
      briefly "Available"
      described as {
        |Whether available.
      }
    }
    quantityOnHand: Natural with {
      briefly "On hand"
      described as {
        |Quantity available.
      }
    }
    quantityReserved: Natural with {
      briefly "Reserved"
      described as {
        |Quantity reserved.
      }
    }
    location: String(1,100) with {
      briefly "Location"
      described as {
        |Storage location.
      }
    }
  } with {
    briefly "Component availability"
    described as {
      |Availability status of a component.
    }
  }
  command ReserveComponents is  {
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    components: ComponentInfo+ with {
      briefly "Components"
      described as {
        |Components to reserve.
      }
    }
    workStationId: WorkStationId with {
      briefly "Station"
      described as {
        |Target station.
      }
    }
  } with {
    briefly "Reserve components"
    described as {
      |Reserves components for an assembly order.
    }
  }
  event ComponentsReserved is  {
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    reservedAt: TimeStamp with {
      briefly "Reserved"
      described as {
        |Reservation time.
      }
    }
  } with {
    briefly "Components reserved"
    described as {
      |Emitted when components are reserved.
    }
  }
  event ComponentShortage is  {
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    shortComponents: ComponentId+ with {
      briefly "Short"
      described as {
        |Short components.
      }
    }
    detectedAt: TimeStamp with {
      briefly "Detected"
      described as {
        |Detection time.
      }
    }
  } with {
    briefly "Component shortage"
    described as {
      |Emitted when component shortage detected.
    }
  }
  command IssueComponents is  {
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    components: ComponentInfo+ with {
      briefly "Components"
      described as {
        |Components to issue.
      }
    }
    issuedTo: String(1,200) with {
      briefly "Issued to"
      described as {
        |Operator receiving.
      }
    }
  } with {
    briefly "Issue components"
    described as {
      |Issues components to assembly order.
    }
  }
  event ComponentsIssued is  {
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    issuedAt: TimeStamp with {
      briefly "Issued"
      described as {
        |Issue time.
      }
    }
  } with {
    briefly "Components issued"
    described as {
      |Emitted when components are issued.
    }
  }
} with {
  option external()
  briefly "External inventory service"
  described as {
    |External inventory system for component management.
  }
}
// Work Order Service - Parent work order
context WorkOrderService is {
  query GetWorkOrderDetails is  {
    workOrderId: WorkOrderId with {
      briefly "Work Order"
      described as {
        |Work order ID.
      }
    }
  } with {
    briefly "Get work order"
    described as {
      |Retrieves parent work order details.
    }
  }
  result WorkOrderDetails is  {
    workOrderId: WorkOrderId with {
      briefly "Work Order"
      described as {
        |Work order ID.
      }
    }
    product: ProductInfo with {
      briefly "Product"
      described as {
        |Product info.
      }
    }
    quantity: Natural with {
      briefly "Quantity"
      described as {
        |Order quantity.
      }
    }
    priority: String(1,50) with {
      briefly "Priority"
      described as {
        |Order priority.
      }
    }
    dueDate: Date with {
      briefly "Due"
      described as {
        |Due date.
      }
    }
    workOrderStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Work order status.
      }
    }
  } with {
    briefly "Work order details"
    described as {
      |Parent work order information.
    }
  }
  command ReportAssemblyComplete is  {
    workOrderId: WorkOrderId with {
      briefly "Work Order"
      described as {
        |Work order ID.
      }
    }
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    completedQuantity: Natural with {
      briefly "Quantity"
      described as {
        |Completed quantity.
      }
    }
    passedQuality: Boolean with {
      briefly "Passed"
      described as {
        |Quality result.
      }
    }
  } with {
    briefly "Report assembly complete"
    described as {
      |Reports assembly completion to work order.
    }
  }
  event AssemblyReported is  {
    workOrderId: WorkOrderId with {
      briefly "Work Order"
      described as {
        |Work order ID.
      }
    }
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    reportedAt: TimeStamp with {
      briefly "Reported"
      described as {
        |Report time.
      }
    }
  } with {
    briefly "Assembly reported"
    described as {
      |Emitted when assembly completion is reported.
    }
  }
  command ReportAssemblyFailure is  {
    workOrderId: WorkOrderId with {
      briefly "Work Order"
      described as {
        |Work order ID.
      }
    }
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    reason: String(1,1000) with {
      briefly "Reason"
      described as {
        |Failure reason.
      }
    }
  } with {
    briefly "Report assembly failure"
    described as {
      |Reports assembly failure to work order.
    }
  }
} with {
  option external()
  briefly "External work order service"
  described as {
    |External work order management system.
  }
}
// Quality Service - Defect tracking
context QualityService is {
  query GetInspectionPlan is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    revision: String(1,20) with {
      briefly "Revision"
      described as {
        |Product revision.
      }
    }
  } with {
    briefly "Get inspection plan"
    described as {
      |Retrieves quality inspection plan.
    }
  }
  result InspectionPlan is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    checkpoints: QualityCheck+ with {
      briefly "Checkpoints"
      described as {
        |Inspection checkpoints.
      }
    }
    passCriteria: String(1,500) with {
      briefly "Criteria"
      described as {
        |Pass criteria.
      }
    }
  } with {
    briefly "Inspection plan"
    described as {
      |Quality inspection plan for product.
    }
  }
  command RecordDefect is  {
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    defect: DefectInfo with {
      briefly "Defect"
      described as {
        |Defect details.
      }
    }
  } with {
    briefly "Record defect"
    described as {
      |Records defect in quality system.
    }
  }
  event DefectLogged is  {
    defectId: DefectId with {
      briefly "Defect"
      described as {
        |Defect ID.
      }
    }
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    loggedAt: TimeStamp with {
      briefly "Logged"
      described as {
        |Log time.
      }
    }
  } with {
    briefly "Defect logged"
    described as {
      |Emitted when defect is logged.
    }
  }
  command RecordFailure is  {
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    reason: String(1,1000) with {
      briefly "Reason"
      described as {
        |Failure reason.
      }
    }
    defects: DefectInfo* with {
      briefly "Defects"
      described as {
        |Associated defects.
      }
    }
  } with {
    briefly "Record failure"
    described as {
      |Records assembly failure in quality system.
    }
  }
  event FailureLogged is  {
    assemblyOrderId: AssemblyOrderId with {
      briefly "Assembly Order"
      described as {
        |Assembly order ID.
      }
    }
    failureId: UUID with {
      briefly "Failure"
      described as {
        |Failure record ID.
      }
    }
    loggedAt: TimeStamp with {
      briefly "Logged"
      described as {
        |Log time.
      }
    }
  } with {
    briefly "Failure logged"
    described as {
      |Emitted when failure is logged.
    }
  }
  query GetDefectCodes is  {
    category: String(1,100)? with {
      briefly "Category"
      described as {
        |Defect category filter.
      }
    }
  } with {
    briefly "Get defect codes"
    described as {
      |Retrieves available defect codes.
    }
  }
  result DefectCodeList is  {
    codes: String(1,50)+ with {
      briefly "Codes"
      described as {
        |Defect codes.
      }
    }
    descriptions: String(1,200)+ with {
      briefly "Descriptions"
      described as {
        |Code descriptions.
      }
    }
  } with {
    briefly "Defect code list"
    described as {
      |List of available defect codes.
    }
  }
} with {
  option external()
  briefly "External quality service"
  described as {
    |External quality management and defect tracking system.
  }
}
