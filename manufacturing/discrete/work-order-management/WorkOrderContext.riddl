// Work Order Management - WorkOrder Context
context WorkOrderContext is {
  include "types.riddl"
  include "WorkOrder.riddl"
  // Repository for work order persistence
  repository WorkOrderRepository is {
    schema WorkOrderData is relational
      of workOrders as type WorkOrder
        index on field WorkOrder.workOrderId
        index on field WorkOrder.product.productId
        index on field WorkOrder.status

    handler WorkOrderPersistence is {
      on command WorkOrder.CreateWorkOrder is {
        prompt "Store new work order"
      }
      on command WorkOrder.ReleaseWorkOrder is {
        prompt "Update to released"
      }
      on command WorkOrder.IssueMaterials is {
        prompt "Store material issues"
      }
      on command WorkOrder.StartWorkOrder is {
        prompt "Update to in progress"
      }
      on command WorkOrder.StartOperation is {
        prompt "Update operation status"
      }
      on command WorkOrder.CompleteOperation is {
        prompt "Update operation completion"
      }
      on command WorkOrder.RecordLabor is {
        prompt "Store labor entry"
      }
      on command WorkOrder.RecordQuality is {
        prompt "Store quality result"
      }
      on command WorkOrder.PlaceOnHold is {
        prompt "Update to on hold"
      }
      on command WorkOrder.ReleaseHold is {
        prompt "Update hold release"
      }
      on command WorkOrder.CompleteWorkOrder is {
        prompt "Update to completed"
      }
      on command WorkOrder.CancelWorkOrder is {
        prompt "Update to cancelled"
      }
    } with {
      briefly "Persists work order events"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Work order data persistence"
    described as {
      | The WorkOrderRepository provides persistent storage for
      | work orders, operations, and production data.
    }
  }
  // Projector for production analytics
  projector ProductionAnalytics is {
    record ProductionStats is  {
      activeWorkOrders: Natural with {
        briefly "Active"
        described as {
          |Active work orders.
        }
      }
      completedToday: Natural with {
        briefly "Completed"
        described as {
          |Completed today.
        }
      }
      onTimeDelivery: Decimal(5,4) with {
        briefly "OTD"
        described as {
          |On-time delivery rate.
        }
      }
      firstPassYield: Decimal(5,4) with {
        briefly "FPY"
        described as {
          |First pass yield.
        }
      }
      oee: Decimal(5,4) with {
        briefly "OEE"
        described as {
          |Overall equipment effectiveness.
        }
      }
      averageCycleTime: Natural with {
        briefly "Cycle time"
        described as {
          |Average cycle time (min).
        }
      }
    } with {
      briefly "Production statistics"
      described as {
        |Manufacturing metrics.
      }
    }
    handler AnalyticsHandler is {
      on event WorkOrder.WorkOrderStarted is {
        prompt "Update active counts"
      }
      on event WorkOrder.WorkOrderCompleted is {
        prompt "Update completion metrics"
      }
      on event WorkOrder.QualityRecorded is {
        prompt "Update quality metrics"
      }
      on event WorkOrder.OperationCompleted is {
        prompt "Update cycle time metrics"
      }
    } with {
      briefly "Maintains production analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Production analytics projections"
    described as {
      |Maintains manufacturing analytics data.
    }
  }
} with {
  briefly "Bounded context for work order management"
  described as {
    | The WorkOrderContext is the bounded context for
    | manufacturing work orders and production control.
  }
}
