// Bill of Materials Management - External Contexts

// Inventory Service - Component availability
context InventoryService is {

  query GetComponentAvailability is {
    componentId is ComponentId with { briefly "Component" described by "Component ID." }
    quantity is Decimal(15, 6) with { briefly "Quantity" described by "Required quantity." }
    effectiveDate is Date with { briefly "Date" described by "Required by date." }
  } with {
    briefly "Get availability"
    described by "Checks component availability for BOM."
  }

  result ComponentAvailability is {
    componentId is ComponentId with { briefly "Component" described by "Component ID." }
    onHandQuantity is Decimal(15, 6) with { briefly "On hand" described by "Current on-hand quantity." }
    availableQuantity is Decimal(15, 6) with { briefly "Available" described by "Available quantity." }
    allocatedQuantity is Decimal(15, 6) with { briefly "Allocated" described by "Already allocated quantity." }
    onOrderQuantity is Decimal(15, 6) with { briefly "On order" described by "Quantity on order." }
    nextReceiptDate is optional Date with { briefly "Next receipt" described by "Next expected receipt." }
    isAvailable is Boolean with { briefly "Is available" described by "Whether quantity is available." }
  } with {
    briefly "Component availability"
    described by "Inventory availability for a component."
  }

  query GetMultipleComponentAvailability is {
    components is many ComponentId with { briefly "Components" described by "Component IDs." }
    effectiveDate is Date with { briefly "Date" described by "Required by date." }
  } with {
    briefly "Get multiple availability"
    described by "Checks availability for multiple components."
  }

  result BOMAvailabilityCheck is {
    bomId is BOMId with { briefly "BOM" described by "BOM identifier." }
    availableComponents is many ComponentId with { briefly "Available" described by "Available components." }
    shortComponents is many ComponentId with { briefly "Short" described by "Components with shortages." }
    canBuild is Boolean with { briefly "Can build" described by "Whether all components available." }
    earliestBuildDate is optional Date with { briefly "Earliest date" described by "When all components available." }
  } with {
    briefly "BOM availability check"
    described by "Availability summary for entire BOM."
  }

} with {
  option is external
  briefly "External inventory service"
  described by "External service for component availability and stock levels."
}

// Costing Service - Standard costs
context CostingService is {

  query GetStandardCost is {
    componentId is ComponentId with { briefly "Component" described by "Component ID." }
    costDate is Date with { briefly "Date" described by "Cost effective date." }
  } with {
    briefly "Get standard cost"
    described by "Retrieves standard cost for component."
  }

  result StandardCost is {
    componentId is ComponentId with { briefly "Component" described by "Component ID." }
    materialCost is Decimal(15, 4) with { briefly "Material" described by "Material cost." }
    laborCost is Decimal(15, 4) with { briefly "Labor" described by "Labor cost." }
    overheadCost is Decimal(15, 4) with { briefly "Overhead" described by "Overhead cost." }
    totalCost is Decimal(15, 4) with { briefly "Total" described by "Total standard cost." }
    currency is String(3, 3) with { briefly "Currency" described by "ISO currency code." }
    effectiveDate is Date with { briefly "Effective" described by "Cost effective date." }
    expirationDate is optional Date with { briefly "Expiration" described by "Cost expiration date." }
  } with {
    briefly "Standard cost"
    described by "Standard cost breakdown for component."
  }

  query GetBOMRollupCost is {
    bomId is BOMId with { briefly "BOM" described by "BOM identifier." }
    costDate is Date with { briefly "Date" described by "Cost effective date." }
    explodeSubs is Boolean with { briefly "Explode" described by "Whether to explode subassemblies." }
  } with {
    briefly "Get BOM rollup cost"
    described by "Calculates rolled up cost for BOM."
  }

  result BOMCostRollup is {
    bomId is BOMId with { briefly "BOM" described by "BOM identifier." }
    costRollup is CostRollup with { briefly "Cost rollup" described by "Rolled up costs." }
    itemCosts is many StandardCost with { briefly "Item costs" described by "Individual item costs." }
    subassemblyCosts is many optional BOMCostRollup with { briefly "Subassembly costs" described by "Nested subassembly costs." }
  } with {
    briefly "BOM cost rollup"
    described by "Complete cost rollup with breakdown."
  }

  command UpdateStandardCost is {
    componentId is ComponentId with { briefly "Component" described by "Component ID." }
    newCosts is StandardCost with { briefly "New costs" described by "Updated cost values." }
    updatedBy is String(1, 200) with { briefly "Updated by" described by "Person updating costs." }
  } with {
    briefly "Update standard cost"
    described by "Updates standard cost for a component."
  }

  event StandardCostUpdated is {
    componentId is ComponentId with { briefly "Component" described by "Component ID." }
    previousTotal is Decimal(15, 4) with { briefly "Previous" described by "Previous total cost." }
    newTotal is Decimal(15, 4) with { briefly "New" described by "New total cost." }
    updatedAt is TimeStamp with { briefly "Updated at" described by "Update time." }
  } with {
    briefly "Standard cost updated"
    described by "Emitted when standard cost changes."
  }

} with {
  option is external
  briefly "External costing service"
  described by "External service for standard costs and cost rollups."
}

// Engineering Change Service - ECN/ECO integration
context EngineeringChangeService is {

  query GetEngineeringChange is {
    changeNumber is String(1, 50) with { briefly "Change number" described by "ECN/ECO number." }
  } with {
    briefly "Get engineering change"
    described by "Retrieves engineering change details."
  }

  result EngineeringChange is {
    changeNumber is String(1, 50) with { briefly "Change number" described by "ECN/ECO number." }
    changeType is String(1, 50) with { briefly "Type" described by "ECN or ECO." }
    title is String(1, 200) with { briefly "Title" described by "Change title." }
    description is String(1, 2000) with { briefly "Description" described by "Change description." }
    affectedBOMs is many BOMId with { briefly "Affected BOMs" described by "BOMs affected by change." }
    affectedComponents is many ComponentId with { briefly "Affected components" described by "Components affected." }
    status is String(1, 50) with { briefly "Status" described by "Change status." }
    effectiveDate is optional Date with { briefly "Effective" described by "Implementation date." }
    requestedBy is String(1, 200) with { briefly "Requested by" described by "Change requestor." }
    approvedBy is optional String(1, 200) with { briefly "Approved by" described by "Approver." }
  } with {
    briefly "Engineering change"
    described by "Engineering change order details."
  }

  command RequestBOMChange is {
    bomId is BOMId with { briefly "BOM" described by "BOM to change." }
    changeType is String(1, 50) with { briefly "Type" described by "ECN or ECO." }
    title is String(1, 200) with { briefly "Title" described by "Change title." }
    description is String(1, 2000) with { briefly "Description" described by "Change description." }
    requestedBy is String(1, 200) with { briefly "Requested by" described by "Change requestor." }
    priority is String(1, 20) with { briefly "Priority" described by "Change priority." }
  } with {
    briefly "Request BOM change"
    described by "Requests engineering change for BOM."
  }

  event ChangeRequestCreated is {
    changeNumber is String(1, 50) with { briefly "Change number" described by "Assigned change number." }
    bomId is BOMId with { briefly "BOM" described by "Affected BOM." }
    createdAt is TimeStamp with { briefly "Created at" described by "Request creation time." }
  } with {
    briefly "Change request created"
    described by "Emitted when change request is created."
  }

  event ChangeApproved is {
    changeNumber is String(1, 50) with { briefly "Change number" described by "Change number." }
    approvedBy is String(1, 200) with { briefly "Approved by" described by "Approver." }
    effectiveDate is Date with { briefly "Effective" described by "Implementation date." }
    approvedAt is TimeStamp with { briefly "Approved at" described by "Approval time." }
  } with {
    briefly "Change approved"
    described by "Emitted when change is approved."
  }

  event ChangeImplemented is {
    changeNumber is String(1, 50) with { briefly "Change number" described by "Change number." }
    bomId is BOMId with { briefly "BOM" described by "Affected BOM." }
    newRevision is String(1, 20) with { briefly "New revision" described by "New BOM revision." }
    implementedAt is TimeStamp with { briefly "Implemented at" described by "Implementation time." }
  } with {
    briefly "Change implemented"
    described by "Emitted when change is implemented on BOM."
  }

} with {
  option is external
  briefly "External engineering change service"
  described by "External service for ECN/ECO integration and change management."
}

// Product Data Management Service
context ProductDataService is {

  query GetProductInfo is {
    productId is ProductId with { briefly "Product" described by "Product ID." }
  } with {
    briefly "Get product info"
    described by "Retrieves product master data."
  }

  result ProductInfo is {
    productId is ProductId with { briefly "Product" described by "Product ID." }
    partNumber is String(1, 50) with { briefly "Part number" described by "Product part number." }
    description is String(1, 200) with { briefly "Description" described by "Product description." }
    productType is String(1, 50) with { briefly "Type" described by "Product type." }
    unitOfMeasure is UnitOfMeasure with { briefly "UOM" described by "Unit of measure." }
    status is String(1, 50) with { briefly "Status" described by "Product status." }
    drawings is many optional String(1, 200) with { briefly "Drawings" described by "Associated drawings." }
  } with {
    briefly "Product info"
    described by "Product master data."
  }

  query GetComponentInfo is {
    componentId is ComponentId with { briefly "Component" described by "Component ID." }
  } with {
    briefly "Get component info"
    described by "Retrieves component master data."
  }

  result ComponentInfo is {
    componentId is ComponentId with { briefly "Component" described by "Component ID." }
    partNumber is String(1, 50) with { briefly "Part number" described by "Component part number." }
    description is String(1, 200) with { briefly "Description" described by "Component description." }
    componentType is String(1, 50) with { briefly "Type" described by "Component type." }
    unitOfMeasure is UnitOfMeasure with { briefly "UOM" described by "Unit of measure." }
    makeOrBuy is String(1, 10) with { briefly "Make/Buy" described by "Make or buy indicator." }
    leadTime is Natural with { briefly "Lead time" described by "Lead time in days." }
    status is String(1, 50) with { briefly "Status" described by "Component status." }
  } with {
    briefly "Component info"
    described by "Component master data."
  }

} with {
  option is external
  briefly "External product data service"
  described by "External service for product and component master data."
}
