// Bill of Materials Management - External Contexts
// Inventory Service - Component availability
context InventoryService is {
  query GetComponentAvailability is  {
    componentId: ComponentId with {
      briefly "Component"
      described as {
        |Component ID.
      }
    }
    quantity: Decimal(15,6) with {
      briefly "Quantity"
      described as {
        |Required quantity.
      }
    }
    effectiveDate: Date with {
      briefly "Date"
      described as {
        |Required by date.
      }
    }
  } with {
    briefly "Get availability"
    described as {
      |Checks component availability for BOM.
    }
  }
  result ComponentAvailability is  {
    componentId: ComponentId with {
      briefly "Component"
      described as {
        |Component ID.
      }
    }
    onHandQuantity: Decimal(15,6) with {
      briefly "On hand"
      described as {
        |Current on-hand quantity.
      }
    }
    availableQuantity: Decimal(15,6) with {
      briefly "Available"
      described as {
        |Available quantity.
      }
    }
    allocatedQuantity: Decimal(15,6) with {
      briefly "Allocated"
      described as {
        |Already allocated quantity.
      }
    }
    onOrderQuantity: Decimal(15,6) with {
      briefly "On order"
      described as {
        |Quantity on order.
      }
    }
    nextReceiptDate: Date? with {
      briefly "Next receipt"
      described as {
        |Next expected receipt.
      }
    }
    isAvailable: Boolean with {
      briefly "Is available"
      described as {
        |Whether quantity is available.
      }
    }
  } with {
    briefly "Component availability"
    described as {
      |Inventory availability for a component.
    }
  }
  query GetMultipleComponentAvailability is  {
    componentIds: ComponentId+ with {
      briefly "Components"
      described as {
        |Component IDs.
      }
    }
    effectiveDate: Date with {
      briefly "Date"
      described as {
        |Required by date.
      }
    }
  } with {
    briefly "Get multiple availability"
    described as {
      |Checks availability for multiple components.
    }
  }
  result BOMAvailabilityCheck is  {
    bomId: BOMId with {
      briefly "BOM"
      described as {
        |BOM identifier.
      }
    }
    availableComponents: ComponentId+ with {
      briefly "Available"
      described as {
        |Available components.
      }
    }
    shortComponents: ComponentId+ with {
      briefly "Short"
      described as {
        |Components with shortages.
      }
    }
    canBuild: Boolean with {
      briefly "Can build"
      described as {
        |Whether all components available.
      }
    }
    earliestBuildDate: Date? with {
      briefly "Earliest date"
      described as {
        |When all components available.
      }
    }
  } with {
    briefly "BOM availability check"
    described as {
      |Availability summary for entire BOM.
    }
  }
} with {
  option external()
  briefly "External inventory service"
  described as {
    |External service for component availability and stock levels.
  }
}
// Costing Service - Standard costs
context CostingService is {
  query GetStandardCost is  {
    componentId: ComponentId with {
      briefly "Component"
      described as {
        |Component ID.
      }
    }
    costDate: Date with {
      briefly "Date"
      described as {
        |Cost effective date.
      }
    }
  } with {
    briefly "Get standard cost"
    described as {
      |Retrieves standard cost for component.
    }
  }
  result StandardCost is  {
    componentId: ComponentId with {
      briefly "Component"
      described as {
        |Component ID.
      }
    }
    materialCost: Decimal(15,4) with {
      briefly "Material"
      described as {
        |Material cost.
      }
    }
    laborCost: Decimal(15,4) with {
      briefly "Labor"
      described as {
        |Labor cost.
      }
    }
    overheadCost: Decimal(15,4) with {
      briefly "Overhead"
      described as {
        |Overhead cost.
      }
    }
    totalCost: Decimal(15,4) with {
      briefly "Total"
      described as {
        |Total standard cost.
      }
    }
    currency: String(3,3) with {
      briefly "Currency"
      described as {
        |ISO currency code.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Cost effective date.
      }
    }
    expirationDate: Date? with {
      briefly "Expiration"
      described as {
        |Cost expiration date.
      }
    }
  } with {
    briefly "Standard cost"
    described as {
      |Standard cost breakdown for component.
    }
  }
  query GetBOMRollupCost is  {
    bomId: BOMId with {
      briefly "BOM"
      described as {
        |BOM identifier.
      }
    }
    costDate: Date with {
      briefly "Date"
      described as {
        |Cost effective date.
      }
    }
    explodeSubs: Boolean with {
      briefly "Explode"
      described as {
        |Whether to explode subassemblies.
      }
    }
  } with {
    briefly "Get BOM rollup cost"
    described as {
      |Calculates rolled up cost for BOM.
    }
  }
  result BOMCostRollup is  {
    bomId: BOMId with {
      briefly "BOM"
      described as {
        |BOM identifier.
      }
    }
    costRollup: CostRollup with {
      briefly "Cost rollup"
      described as {
        |Rolled up costs.
      }
    }
    itemCosts: StandardCost+ with {
      briefly "Item costs"
      described as {
        |Individual item costs.
      }
    }
    subassemblyCosts: BOMCostRollup* with {
      briefly "Subassembly costs"
      described as {
        |Nested subassembly costs.
      }
    }
  } with {
    briefly "BOM cost rollup"
    described as {
      |Complete cost rollup with breakdown.
    }
  }
  command UpdateStandardCost is  {
    componentId: ComponentId with {
      briefly "Component"
      described as {
        |Component ID.
      }
    }
    newCosts: StandardCost with {
      briefly "New costs"
      described as {
        |Updated cost values.
      }
    }
    updatedBy: String(1,200) with {
      briefly "Updated by"
      described as {
        |Person updating costs.
      }
    }
  } with {
    briefly "Update standard cost"
    described as {
      |Updates standard cost for a component.
    }
  }
  event StandardCostUpdated is  {
    componentId: ComponentId with {
      briefly "Component"
      described as {
        |Component ID.
      }
    }
    previousTotal: Decimal(15,4) with {
      briefly "Previous"
      described as {
        |Previous total cost.
      }
    }
    newTotal: Decimal(15,4) with {
      briefly "New"
      described as {
        |New total cost.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated at"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Standard cost updated"
    described as {
      |Emitted when standard cost changes.
    }
  }
} with {
  option external()
  briefly "External costing service"
  described as {
    |External service for standard costs and cost rollups.
  }
}
// Engineering Change Service - ECN/ECO integration
context EngineeringChangeService is {
  query GetEngineeringChange is  {
    ecoNumber: String(1,50) with {
      briefly "Change number"
      described as {
        |ECN/ECO number.
      }
    }
  } with {
    briefly "Get engineering change"
    described as {
      |Retrieves engineering change details.
    }
  }
  result EngineeringChange is  {
    ecoNumber: String(1,50) with {
      briefly "Change number"
      described as {
        |ECN/ECO number.
      }
    }
    changeType: String(1,50) with {
      briefly "Type"
      described as {
        |ECN or ECO.
      }
    }
    title: String(1,200) with {
      briefly "Title"
      described as {
        |Change title.
      }
    }
    description: String(1,2000) with {
      briefly "Description"
      described as {
        |Change description.
      }
    }
    affectedBOMs: BOMId+ with {
      briefly "Affected BOMs"
      described as {
        |BOMs affected by change.
      }
    }
    affectedComponents: ComponentId+ with {
      briefly "Affected components"
      described as {
        |Components affected.
      }
    }
    changeStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Change status.
      }
    }
    changeEffectiveDate: Date? with {
      briefly "Effective"
      described as {
        |Implementation date.
      }
    }
    requestedBy: String(1,200) with {
      briefly "Requested by"
      described as {
        |Change requestor.
      }
    }
    changeApprovedBy: String(1,200)? with {
      briefly "Approved by"
      described as {
        |Approver.
      }
    }
  } with {
    briefly "Engineering change"
    described as {
      |Engineering change order details.
    }
  }
  command RequestBOMChange is  {
    bomId: BOMId with {
      briefly "BOM"
      described as {
        |BOM to change.
      }
    }
    changeType: String(1,50) with {
      briefly "Type"
      described as {
        |ECN or ECO.
      }
    }
    title: String(1,200) with {
      briefly "Title"
      described as {
        |Change title.
      }
    }
    description: String(1,2000) with {
      briefly "Description"
      described as {
        |Change description.
      }
    }
    requestedBy: String(1,200) with {
      briefly "Requested by"
      described as {
        |Change requestor.
      }
    }
    priority: String(1,20) with {
      briefly "Priority"
      described as {
        |Change priority.
      }
    }
  } with {
    briefly "Request BOM change"
    described as {
      |Requests engineering change for BOM.
    }
  }
  event ChangeRequestCreated is  {
    ecoNumber: String(1,50) with {
      briefly "Change number"
      described as {
        |Assigned change number.
      }
    }
    bomId: BOMId with {
      briefly "BOM"
      described as {
        |Affected BOM.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created at"
      described as {
        |Request creation time.
      }
    }
  } with {
    briefly "Change request created"
    described as {
      |Emitted when change request is created.
    }
  }
  event ChangeApproved is  {
    ecoNumber: String(1,50) with {
      briefly "Change number"
      described as {
        |Change number.
      }
    }
    changeApprover: String(1,200) with {
      briefly "Approved by"
      described as {
        |Approver.
      }
    }
    implementationDate: Date with {
      briefly "Effective"
      described as {
        |Implementation date.
      }
    }
    changeApprovedAt: TimeStamp with {
      briefly "Approved at"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Change approved"
    described as {
      |Emitted when change is approved.
    }
  }
  event ChangeImplemented is  {
    ecoNumber: String(1,50) with {
      briefly "Change number"
      described as {
        |Change number.
      }
    }
    bomId: BOMId with {
      briefly "BOM"
      described as {
        |Affected BOM.
      }
    }
    newRevision: String(1,20) with {
      briefly "New revision"
      described as {
        |New BOM revision.
      }
    }
    implementedAt: TimeStamp with {
      briefly "Implemented at"
      described as {
        |Implementation time.
      }
    }
  } with {
    briefly "Change implemented"
    described as {
      |Emitted when change is implemented on BOM.
    }
  }
} with {
  option external()
  briefly "External engineering change service"
  described as {
    |External service for ECN/ECO integration and change management.
  }
}
// Product Data Management Service
context ProductDataService is {
  query GetProductInfo is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
  } with {
    briefly "Get product info"
    described as {
      |Retrieves product master data.
    }
  }
  result ProductInfo is  {
    productId: ProductId with {
      briefly "Product"
      described as {
        |Product ID.
      }
    }
    partNumber: String(1,50) with {
      briefly "Part number"
      described as {
        |Product part number.
      }
    }
    description: String(1,200) with {
      briefly "Description"
      described as {
        |Product description.
      }
    }
    productType: String(1,50) with {
      briefly "Type"
      described as {
        |Product type.
      }
    }
    unitOfMeasure: UnitOfMeasure with {
      briefly "UOM"
      described as {
        |Unit of measure.
      }
    }
    productStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Product status.
      }
    }
    drawings: String(1,200)* with {
      briefly "Drawings"
      described as {
        |Associated drawings.
      }
    }
  } with {
    briefly "Product info"
    described as {
      |Product master data.
    }
  }
  query GetComponentInfo is  {
    componentId: ComponentId with {
      briefly "Component"
      described as {
        |Component ID.
      }
    }
  } with {
    briefly "Get component info"
    described as {
      |Retrieves component master data.
    }
  }
  result ComponentInfo is  {
    componentId: ComponentId with {
      briefly "Component"
      described as {
        |Component ID.
      }
    }
    partNumber: String(1,50) with {
      briefly "Part number"
      described as {
        |Component part number.
      }
    }
    description: String(1,200) with {
      briefly "Description"
      described as {
        |Component description.
      }
    }
    componentType: String(1,50) with {
      briefly "Type"
      described as {
        |Component type.
      }
    }
    unitOfMeasure: UnitOfMeasure with {
      briefly "UOM"
      described as {
        |Unit of measure.
      }
    }
    makeOrBuy: String(1,10) with {
      briefly "Make/Buy"
      described as {
        |Make or buy indicator.
      }
    }
    leadTime: Natural with {
      briefly "Lead time"
      described as {
        |Lead time in days.
      }
    }
    componentStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Component status.
      }
    }
  } with {
    briefly "Component info"
    described as {
      |Component master data.
    }
  }
} with {
  option external()
  briefly "External product data service"
  described as {
    |External service for product and component master data.
  }
}
