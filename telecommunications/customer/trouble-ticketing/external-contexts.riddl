// Trouble Ticketing - External Contexts

context NetworkDiagnostics is {

  command RunDiagnostics is {
    accountNumber is AccountNumber with { briefly "Account" described by "Customer account." }
    testTypes is many String(1, 50) with { briefly "Tests" described by "Diagnostic tests." }
  } with {
    briefly "Run diagnostics"
    described by "Runs network diagnostics."
  }

  event DiagnosticsComplete is {
    accountNumber is AccountNumber with { briefly "Account" described by "Customer account." }
    results is many DiagnosticResult with { briefly "Results" described by "Test results." }
    overallHealth is String(1, 20) with { briefly "Health" described by "Overall health." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Diagnostics complete"
    described by "Emitted when tests finish."
  }

} with {
  option is external
  briefly "External network diagnostics"
  described by "Automated diagnostic testing."
}

context DispatchSystem is {

  command ScheduleDispatch is {
    ticketId is TicketId with { briefly "Ticket" described by "Ticket ID." }
    serviceAddress is String(1, 500) with { briefly "Address" described by "Service address." }
    issueCategory is IssueCategory with { briefly "Category" described by "Issue type." }
    preferredWindow is TimeStamp with { briefly "Window" described by "Preferred time." }
  } with {
    briefly "Schedule dispatch"
    described by "Schedules field technician."
  }

  event DispatchScheduled is {
    ticketId is TicketId with { briefly "Ticket" described by "Ticket ID." }
    dispatch is DispatchInfo with { briefly "Dispatch" described by "Dispatch details." }
    scheduledAt is TimeStamp with { briefly "Scheduled" described by "Schedule time." }
  } with {
    briefly "Dispatch scheduled"
    described by "Emitted when dispatch created."
  }

  event TechnicianArrived is {
    dispatchId is UUID with { briefly "Dispatch" described by "Dispatch ID." }
    arrivedAt is TimeStamp with { briefly "Arrived" described by "Arrival time." }
  } with {
    briefly "Technician arrived"
    described by "Emitted when tech on site."
  }

  event DispatchCompleted is {
    dispatchId is UUID with { briefly "Dispatch" described by "Dispatch ID." }
    workPerformed is String(1, 2000) with { briefly "Work" described by "Work performed." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Dispatch completed"
    described by "Emitted when field work done."
  }

} with {
  option is external
  briefly "External dispatch system"
  described by "Field workforce management."
}

context CustomerNotification is {

  command SendTicketUpdate is {
    ticketId is TicketId with { briefly "Ticket" described by "Ticket ID." }
    customer is CustomerInfo with { briefly "Customer" described by "Customer info." }
    updateType is String(1, 50) with { briefly "Type" described by "Update type." }
    message is String(1, 2000) with { briefly "Message" described by "Update message." }
  } with {
    briefly "Send ticket update"
    described by "Notifies customer of update."
  }

  event UpdateSent is {
    ticketId is TicketId with { briefly "Ticket" described by "Ticket ID." }
    channel is String(1, 20) with { briefly "Channel" described by "SMS, email, etc." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Update sent"
    described by "Emitted when notification sent."
  }

} with {
  option is external
  briefly "External customer notification"
  described by "Customer messaging service."
}

context KnowledgeBase is {

  command SearchSolutions is {
    issueDescription is String(1, 1000) with { briefly "Issue" described by "Issue description." }
    category is IssueCategory with { briefly "Category" described by "Issue category." }
  } with {
    briefly "Search solutions"
    described by "Searches knowledge base."
  }

  event SolutionsFound is {
    solutions is many String(1, 2000) with { briefly "Solutions" described by "Matching solutions." }
    articleIds is many String(1, 50) with { briefly "Articles" described by "Article IDs." }
    foundAt is TimeStamp with { briefly "Found" described by "Search time." }
  } with {
    briefly "Solutions found"
    described by "Emitted when solutions located."
  }

} with {
  option is external
  briefly "External knowledge base"
  described by "Solution knowledge repository."
}

context CRM is {

  command GetCustomerHistory is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
  } with {
    briefly "Get customer history"
    described by "Retrieves customer history."
  }

  event CustomerHistoryRetrieved is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    previousTickets is Natural with { briefly "Tickets" described by "Previous ticket count." }
    accountStatus is String(1, 50) with { briefly "Status" described by "Account status." }
    customerSince is Date with { briefly "Since" described by "Customer since." }
    ltv is optional Decimal(12, 2) with { briefly "LTV" described by "Lifetime value." }
  } with {
    briefly "Customer history retrieved"
    described by "Emitted when history available."
  }

} with {
  option is external
  briefly "External CRM"
  described by "Customer relationship management."
}
