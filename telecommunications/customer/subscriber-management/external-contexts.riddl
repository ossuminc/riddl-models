// Subscriber Management - External Contexts

context BillingSystem is {

  command CreateBillingAccount is {
    accountId is AccountId with { briefly "Account" described by "Account ID." }
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    paymentMethod is PaymentMethod with { briefly "Payment" described by "Payment method." }
  } with {
    briefly "Create billing account"
    described by "Creates billing account."
  }

  event BillingAccountCreated is {
    accountId is AccountId with { briefly "Account" described by "Account ID." }
    createdAt is TimeStamp with { briefly "Created" described by "Creation time." }
  } with {
    briefly "Billing account created"
    described by "Emitted when account created."
  }

  command AddCharges is {
    accountId is AccountId with { briefly "Account" described by "Account ID." }
    amount is Decimal(10, 2) with { briefly "Amount" described by "Charge amount." }
    description is String(1, 200) with { briefly "Description" described by "Charge description." }
  } with {
    briefly "Add charges"
    described by "Adds charges to account."
  }

  query GetAccountBalance is {
    accountId is AccountId with { briefly "Account" described by "Account ID." }
  } with {
    briefly "Get account balance"
    described by "Gets current balance."
  }

  result AccountBalance is {
    accountId is AccountId with { briefly "Account" described by "Account ID." }
    currentBalance is Decimal(10, 2) with { briefly "Balance" described by "Current balance." }
    pastDueAmount is Decimal(10, 2) with { briefly "Past due" described by "Past due amount." }
    lastPaymentDate is optional Date with { briefly "Last payment" described by "Last payment." }
  } with {
    briefly "Account balance"
    described by "Billing account balance."
  }

} with {
  option is external
  briefly "External billing system"
  described by "Billing and payment system."
}

context NetworkProvisioning is {

  command ProvisionService is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    lineId is ServiceLineId with { briefly "Line" described by "Line ID." }
    serviceType is ServiceType with { briefly "Type" described by "Service type." }
    phoneNumber is String(1, 20) with { briefly "Phone" described by "Phone number." }
  } with {
    briefly "Provision service"
    described by "Provisions network service."
  }

  event ServiceProvisioned is {
    lineId is ServiceLineId with { briefly "Line" described by "Line ID." }
    provisionedAt is TimeStamp with { briefly "Provisioned" described by "Provision time." }
  } with {
    briefly "Service provisioned"
    described by "Emitted when service provisioned."
  }

  command DeprovisionService is {
    lineId is ServiceLineId with { briefly "Line" described by "Line ID." }
    reason is String(1, 200) with { briefly "Reason" described by "Deprovision reason." }
  } with {
    briefly "Deprovision service"
    described by "Removes network service."
  }

} with {
  option is external
  briefly "External network provisioning"
  described by "Network service provisioning system."
}

context DeviceManagement is {

  command RegisterDevice is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    device is DeviceInfo with { briefly "Device" described by "Device info." }
  } with {
    briefly "Register device"
    described by "Registers subscriber device."
  }

  event DeviceRegistered is {
    deviceId is String(1, 50) with { briefly "Device" described by "Device ID." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Device registered"
    described by "Emitted when device registered."
  }

  command ActivateSIM is {
    simNumber is String(1, 30) with { briefly "SIM" described by "SIM number." }
    lineId is ServiceLineId with { briefly "Line" described by "Line ID." }
  } with {
    briefly "Activate SIM"
    described by "Activates SIM card."
  }

} with {
  option is external
  briefly "External device management"
  described by "Device and SIM management."
}

context CRMSystem is {

  command CreateCustomerRecord is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    contactInfo is ContactInfo with { briefly "Contact" described by "Contact info." }
  } with {
    briefly "Create customer record"
    described by "Creates CRM record."
  }

  command LogInteraction is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    interactionType is String(1, 50) with { briefly "Type" described by "Interaction type." }
    notes is String(1, 2000) with { briefly "Notes" described by "Interaction notes." }
    agentId is String(1, 50) with { briefly "Agent" described by "Agent ID." }
  } with {
    briefly "Log interaction"
    described by "Logs customer interaction."
  }

  query GetCustomerHistory is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
  } with {
    briefly "Get customer history"
    described by "Gets interaction history."
  }

  result CustomerHistory is {
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
    totalInteractions is Natural with { briefly "Total" described by "Total interactions." }
    lastInteraction is optional TimeStamp with { briefly "Last" described by "Last interaction." }
    satisfactionScore is optional Decimal(3, 2) with { briefly "Score" described by "CSAT score." }
  } with {
    briefly "Customer history"
    described by "Customer interaction history."
  }

} with {
  option is external
  briefly "External CRM system"
  described by "Customer relationship management."
}
