// Subscriber Management - External Contexts
context BillingSystem is {
  command CreateBillingAccount is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    paymentMethod: PaymentMethod with {
      briefly "Payment"
      described as {
        |Payment method.
      }
    }
  } with {
    briefly "Create billing account"
    described as {
      |Creates billing account.
    }
  }
  event BillingAccountCreated is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    createdAt: TimeStamp with {
      briefly "Created"
      described as {
        |Creation time.
      }
    }
  } with {
    briefly "Billing account created"
    described as {
      |Emitted when account created.
    }
  }
  command AddCharges is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    amount: Decimal(10,2) with {
      briefly "Amount"
      described as {
        |Charge amount.
      }
    }
    description: String(1,200) with {
      briefly "Description"
      described as {
        |Charge description.
      }
    }
  } with {
    briefly "Add charges"
    described as {
      |Adds charges to account.
    }
  }
  query GetAccountBalance is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
  } with {
    briefly "Get account balance"
    described as {
      |Gets current balance.
    }
  }
  result AccountBalance is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    currentBalance: Decimal(10,2) with {
      briefly "Balance"
      described as {
        |Current balance.
      }
    }
    pastDueAmount: Decimal(10,2) with {
      briefly "Past due"
      described as {
        |Past due amount.
      }
    }
    lastPaymentDate: Date? with {
      briefly "Last payment"
      described as {
        |Last payment.
      }
    }
  } with {
    briefly "Account balance"
    described as {
      |Billing account balance.
    }
  }
} with {
  option external()
  briefly "External billing system"
  described as {
    |Billing and payment system.
  }
}
context NetworkProvisioning is {
  command ProvisionService is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    lineId: ServiceLineId with {
      briefly "Line"
      described as {
        |Line ID.
      }
    }
    serviceType: ServiceType with {
      briefly "Type"
      described as {
        |Service type.
      }
    }
    phoneNumber: String(1,20) with {
      briefly "Phone"
      described as {
        |Phone number.
      }
    }
  } with {
    briefly "Provision service"
    described as {
      |Provisions network service.
    }
  }
  event ServiceProvisioned is  {
    lineId: ServiceLineId with {
      briefly "Line"
      described as {
        |Line ID.
      }
    }
    provisionedAt: TimeStamp with {
      briefly "Provisioned"
      described as {
        |Provision time.
      }
    }
  } with {
    briefly "Service provisioned"
    described as {
      |Emitted when service provisioned.
    }
  }
  command DeprovisionService is  {
    lineId: ServiceLineId with {
      briefly "Line"
      described as {
        |Line ID.
      }
    }
    reason: String(1,200) with {
      briefly "Reason"
      described as {
        |Deprovision reason.
      }
    }
  } with {
    briefly "Deprovision service"
    described as {
      |Removes network service.
    }
  }
} with {
  option external()
  briefly "External network provisioning"
  described as {
    |Network service provisioning system.
  }
}
context DeviceManagement is {
  command RegisterDevice is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    device: DeviceInfo with {
      briefly "Device"
      described as {
        |Device info.
      }
    }
  } with {
    briefly "Register device"
    described as {
      |Registers subscriber device.
    }
  }
  event DeviceRegistered is  {
    deviceId: String(1,50) with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Device registered"
    described as {
      |Emitted when device registered.
    }
  }
  command ActivateSIM is  {
    simNumber: String(1,30) with {
      briefly "SIM"
      described as {
        |SIM number.
      }
    }
    lineId: ServiceLineId with {
      briefly "Line"
      described as {
        |Line ID.
      }
    }
  } with {
    briefly "Activate SIM"
    described as {
      |Activates SIM card.
    }
  }
} with {
  option external()
  briefly "External device management"
  described as {
    |Device and SIM management.
  }
}
context CRMSystem is {
  command CreateCustomerRecord is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    contactInfo: ContactInfo with {
      briefly "Contact"
      described as {
        |Contact info.
      }
    }
  } with {
    briefly "Create customer record"
    described as {
      |Creates CRM record.
    }
  }
  command LogInteraction is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    interactionType: String(1,50) with {
      briefly "Type"
      described as {
        |Interaction type.
      }
    }
    notes: String(1,2000) with {
      briefly "Notes"
      described as {
        |Interaction notes.
      }
    }
    agentId: String(1,50) with {
      briefly "Agent"
      described as {
        |Agent ID.
      }
    }
  } with {
    briefly "Log interaction"
    described as {
      |Logs customer interaction.
    }
  }
  query GetCustomerHistory is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
  } with {
    briefly "Get customer history"
    described as {
      |Gets interaction history.
    }
  }
  result CustomerHistory is  {
    subscriberId: SubscriberId with {
      briefly "Subscriber"
      described as {
        |Subscriber ID.
      }
    }
    totalInteractions: Natural with {
      briefly "Total"
      described as {
        |Total interactions.
      }
    }
    lastInteraction: TimeStamp? with {
      briefly "Last"
      described as {
        |Last interaction.
      }
    }
    satisfactionScore: Decimal(3,2)? with {
      briefly "Score"
      described as {
        |CSAT score.
      }
    }
  } with {
    briefly "Customer history"
    described as {
      |Customer interaction history.
    }
  }
} with {
  option external()
  briefly "External CRM system"
  described as {
    |Customer relationship management.
  }
}
