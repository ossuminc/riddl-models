// Revenue Assurance - External Contexts

context BillingSystem is {

  query GetBillingRecords is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    serviceId is ServiceId with { briefly "Service" described by "Service ID." }
    periodStart is Date with { briefly "Start" described by "Period start date." }
    periodEnd is Date with { briefly "End" described by "Period end date." }
  } with {
    briefly "Get billing records"
    described by "Retrieves billing records for a customer and period."
  }

  result BillingRecordsResult is {
    records is many BillingRecord with { briefly "Records" described by "Billing records." }
    totalBilled is Decimal(12, 2) with { briefly "Total" described by "Total billed amount." }
  } with {
    briefly "Billing records result"
    described by "Billing records for the requested period."
  }

  command AdjustBilling is {
    caseId is AuditCaseId with { briefly "Case" described by "Audit case ID." }
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    adjustmentAmount is Decimal(12, 2) with { briefly "Amount" described by "Adjustment amount." }
    reason is String(1, 500) with { briefly "Reason" described by "Adjustment reason." }
  } with {
    briefly "Adjust billing"
    described by "Adjusts customer billing based on audit findings."
  }

  event BillingAdjusted is {
    caseId is AuditCaseId with { briefly "Case" described by "Audit case ID." }
    adjustedAmount is Decimal(12, 2) with { briefly "Adjusted" described by "Adjusted amount." }
    adjustedAt is TimeStamp with { briefly "Adjusted at" described by "Adjustment time." }
  } with {
    briefly "Billing adjusted"
    described by "Emitted when billing is adjusted."
  }

} with {
  option is external
  briefly "External billing system"
  described by "Customer billing and invoicing system."
}

context NetworkUsageSystem is {

  query GetUsageRecords is {
    customerId is CustomerId with { briefly "Customer" described by "Customer ID." }
    serviceId is ServiceId with { briefly "Service" described by "Service ID." }
    usageStart is TimeStamp with { briefly "Start" described by "Usage period start." }
    usageEnd is TimeStamp with { briefly "End" described by "Usage period end." }
  } with {
    briefly "Get usage records"
    described by "Retrieves network usage records for a customer."
  }

  result UsageRecordsResult is {
    records is many UsageRecord with { briefly "Records" described by "Usage records." }
    totalUsage is Decimal(12, 2) with { briefly "Total" described by "Total usage." }
    usageUnit is String(1, 50) with { briefly "Unit" described by "Usage unit." }
  } with {
    briefly "Usage records result"
    described by "Network usage records for the requested period."
  }

  query GetUnbilledServices is {
    asOfDate is Date with { briefly "As of" described by "Check date." }
  } with {
    briefly "Get unbilled services"
    described by "Finds active services with no billing records."
  }

  result UnbilledServicesResult is {
    services is many ServiceId with { briefly "Services" described by "Unbilled service IDs." }
    totalCount is Natural with { briefly "Count" described by "Total unbilled services." }
  } with {
    briefly "Unbilled services result"
    described by "List of services without billing records."
  }

} with {
  option is external
  briefly "External network usage system"
  described by "Network mediation and usage data collection system."
}
