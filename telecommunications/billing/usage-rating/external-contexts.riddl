// Usage Rating - External Contexts

context NetworkMediationSystem is {

  command SendCallDetailRecord is {
    recordId is UUID with { briefly "Record" described by "CDR record ID." }
    cdr is CallDetailRecord with { briefly "CDR" described by "Call detail record." }
  } with {
    briefly "Send call detail record"
    described by "Sends a raw CDR from network mediation."
  }

  event CallDetailRecordReceived is {
    recordId is UUID with { briefly "Record" described by "CDR record ID." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "CDR received"
    described by "Emitted when a CDR is received from the network."
  }

  query GetMediationStatus is {
    recordId is UUID with { briefly "Record" described by "CDR record ID." }
  } with {
    briefly "Get mediation status"
    described by "Gets the mediation status of a CDR."
  }

  result MediationStatus is {
    recordId is UUID with { briefly "Record" described by "CDR record ID." }
    mediationStatus is String(3, 50) with { briefly "Status" described by "Mediation status." }
    processedAt is TimeStamp with { briefly "Processed" described by "Processing time." }
  } with {
    briefly "Mediation status"
    described by "Mediation processing status for a CDR."
  }

} with {
  option is external
  briefly "External network mediation"
  described by "Network mediation system providing raw CDRs."
}

context BillingSystem is {

  command SubmitRatedUsage is {
    usageRecordId is UsageRecordId with { briefly "Record" described by "Usage record ID." }
    accountId is AccountId with { briefly "Account" described by "Customer account." }
    charges is many UsageCharge with { briefly "Charges" described by "Rated charges." }
    totalAmount is Decimal(10, 2) with { briefly "Total" described by "Total amount." }
  } with {
    briefly "Submit rated usage"
    described by "Submits rated usage to billing."
  }

  event RatedUsageAccepted is {
    usageRecordId is UsageRecordId with { briefly "Record" described by "Usage record ID." }
    acceptedAt is TimeStamp with { briefly "Accepted" described by "Acceptance time." }
  } with {
    briefly "Rated usage accepted"
    described by "Emitted when billing accepts rated usage."
  }

  query GetAccountRatePlan is {
    accountId is AccountId with { briefly "Account" described by "Customer account." }
    subscriberId is SubscriberId with { briefly "Subscriber" described by "Subscriber ID." }
  } with {
    briefly "Get account rate plan"
    described by "Retrieves the rate plan for a subscriber."
  }

  result AccountRatePlan is {
    accountId is AccountId with { briefly "Account" described by "Customer account." }
    ratePlan is RatePlanInfo with { briefly "Rate plan" described by "Active rate plan." }
    effectiveDate is Date with { briefly "Effective" described by "Plan effective date." }
  } with {
    briefly "Account rate plan"
    described by "Rate plan details for a billing account."
  }

} with {
  option is external
  briefly "External billing system"
  described by "Billing system receiving rated usage records."
}
