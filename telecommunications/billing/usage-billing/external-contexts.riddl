// External Contexts for Usage Billing Domain
// These represent external systems that the billing domain integrates with
context NetworkMediation is {
  type CDR is {
    cdrRecordId: String with {
      briefly "ID"
      described as {
        |Record identifier.
      }
    }
    msisdn: String with {
      briefly "MSISDN"
      described as {
        |Mobile number.
      }
    }
    imsi: String with {
      briefly "IMSI"
      described as {
        |Subscriber identity.
      }
    }
    callType: String with {
      briefly "Type"
      described as {
        |Call type.
      }
    }
    startTime: TimeStamp with {
      briefly "Start"
      described as {
        |Start time.
      }
    }
    endTime: TimeStamp with {
      briefly "End"
      described as {
        |End time.
      }
    }
    durationSeconds: Integer with {
      briefly "Duration"
      described as {
        |Duration in seconds.
      }
    }
    dataVolumeBytes: Integer with {
      briefly "Volume"
      described as {
        |Data volume.
      }
    }
    originatingCell: String with {
      briefly "Origin"
      described as {
        |Originating cell.
      }
    }
    terminatingCell: String with {
      briefly "Dest"
      described as {
        |Terminating cell.
      }
    }
    networkId: String with {
      briefly "Network"
      described as {
        |Network identifier.
      }
    }
  } with {
    briefly "Call Detail Record from network"
    described as {
      |Raw usage record from network elements before rating.
    }
  }
  event CDRReceived is  {
    cdr: CDR with {
      briefly "CDR"
      described as {
        |Call detail record.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Receipt time.
      }
    }
  } with {
    briefly "CDR received from network"
    described as {
      |Indicates a new call detail record is available for processing.
    }
  }
  event CDRBatchReady is  {
    batchId: String with {
      briefly "Batch"
      described as {
        |Batch identifier.
      }
    }
    recordCount: Integer with {
      briefly "Count"
      described as {
        |Number of records.
      }
    }
    periodStart: TimeStamp with {
      briefly "Start"
      described as {
        |Period start.
      }
    }
    periodEnd: TimeStamp with {
      briefly "End"
      described as {
        |Period end.
      }
    }
  } with {
    briefly "Batch of CDRs ready for processing"
    described as {
      |Indicates a batch of CDRs is ready for rating and billing.
    }
  }
} with {
  option external()
  briefly "External network mediation system"
  described as {
    | The Network Mediation context represents the external system that
    | collects raw Call Detail Records (CDRs) from network elements,
    | performs normalization and deduplication, and delivers them to
    | the billing system for rating and invoicing.
  }
}
context PaymentGateway is {
  type PaymentRequest is {
    transactionId: String with {
      briefly "ID"
      described as {
        |Transaction identifier.
      }
    }
    amount: MonetaryAmount with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    currency: String with {
      briefly "Currency"
      described as {
        |Currency code.
      }
    }
    customerId: String with {
      briefly "Customer"
      described as {
        |Customer identifier.
      }
    }
    paymentMethod: PaymentMethod with {
      briefly "Method"
      described as {
        |Payment method.
      }
    }
    cardToken: String? with {
      briefly "Card"
      described as {
        |Card token.
      }
    }
    bankAccountToken: String? with {
      briefly "Bank"
      described as {
        |Bank account token.
      }
    }
  } with {
    briefly "Request to process a payment"
    described as {
      |Contains all information needed to process a customer payment.
    }
  }
  type PaymentResponse is {
    transactionId: String with {
      briefly "ID"
      described as {
        |Transaction identifier.
      }
    }
    processingStatus: String with {
      briefly "Status"
      described as {
        |Processing status.
      }
    }
    authorizationCode: String? with {
      briefly "Auth"
      described as {
        |Authorization code.
      }
    }
    declineReason: String? with {
      briefly "Reason"
      described as {
        |Decline reason.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Processing time.
      }
    }
  } with {
    briefly "Response from payment processing"
    described as {
      |Result of a payment processing attempt.
    }
  }
  event PaymentProcessed is  {
    transactionId: String with {
      briefly "ID"
      described as {
        |Transaction identifier.
      }
    }
    externalAccountId: String with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    amount: MonetaryAmount with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    processingStatus: String with {
      briefly "Status"
      described as {
        |Processing status.
      }
    }
    processedAt: TimeStamp with {
      briefly "Processed"
      described as {
        |Processing time.
      }
    }
  } with {
    briefly "Payment was processed"
    described as {
      |Indicates a payment has been processed by the gateway.
    }
  }
  event PaymentFailed is  {
    transactionId: String with {
      briefly "ID"
      described as {
        |Transaction identifier.
      }
    }
    externalAccountId: String with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    amount: MonetaryAmount with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    reason: String with {
      briefly "Reason"
      described as {
        |Failure reason.
      }
    }
    failedAt: TimeStamp with {
      briefly "Failed"
      described as {
        |Failure time.
      }
    }
  } with {
    briefly "Payment processing failed"
    described as {
      |Indicates a payment attempt was unsuccessful.
    }
  }
} with {
  option external()
  briefly "External payment processing gateway"
  described as {
    | The Payment Gateway context represents the external payment
    | processing system that handles credit card, debit card, ACH,
    | and other payment methods. It provides secure tokenization
    | and PCI-compliant transaction processing.
  }
}
context CustomerPortal is {
  type BillViewRequest is {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    updatedInvoiceId: InvoiceId? with {
      briefly "Invoice"
      described as {
        |Invoice identifier.
      }
    }
  } with {
    briefly "Request to view billing information"
    described as {
      |Customer request to view their bill or invoice.
    }
  }
  type UsageViewRequest is {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Start date.
      }
    }
    endDate: Date with {
      briefly "End"
      described as {
        |End date.
      }
    }
    filterUsageType: UsageType? with {
      briefly "Type"
      described as {
        |Usage type filter.
      }
    }
  } with {
    briefly "Request to view usage details"
    described as {
      |Customer request to view their usage history.
    }
  }
  event CustomerViewedBill is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    invoiceId: InvoiceId with {
      briefly "Invoice"
      described as {
        |Invoice identifier.
      }
    }
    viewedAt: TimeStamp with {
      briefly "Viewed"
      described as {
        |View time.
      }
    }
  } with {
    briefly "Customer viewed their bill"
    described as {
      |Indicates a customer accessed their invoice in the portal.
    }
  }
  event CustomerInitiatedPayment is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    invoiceId: InvoiceId with {
      briefly "Invoice"
      described as {
        |Invoice identifier.
      }
    }
    amount: MonetaryAmount with {
      briefly "Amount"
      described as {
        |Payment amount.
      }
    }
    paymentMethod: PaymentMethod with {
      briefly "Method"
      described as {
        |Payment method.
      }
    }
  } with {
    briefly "Customer initiated a payment"
    described as {
      |Indicates a customer started the payment process in the portal.
    }
  }
  event CustomerDisputedCharge is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    invoiceId: InvoiceId with {
      briefly "Invoice"
      described as {
        |Invoice identifier.
      }
    }
    lineItemDescription: String with {
      briefly "Item"
      described as {
        |Disputed item.
      }
    }
    disputeReason: String with {
      briefly "Reason"
      described as {
        |Dispute reason.
      }
    }
    disputedAt: TimeStamp with {
      briefly "Disputed"
      described as {
        |Dispute time.
      }
    }
  } with {
    briefly "Customer disputed a charge"
    described as {
      |Indicates a customer raised a dispute about a bill item.
    }
  }
} with {
  option external()
  briefly "External customer self-service portal"
  described as {
    | The Customer Portal context represents the external self-service
    | web and mobile application where customers view bills, check
    | usage, make payments, and manage their account preferences.
  }
}
context RatingEngine is {
  type RatingRequest is {
    usageRecords: UsageRecordId+ with {
      briefly "Records"
      described as {
        |Usage records to rate.
      }
    }
    ratePlanId: RatePlanId with {
      briefly "Plan"
      described as {
        |Rate plan.
      }
    }
    effectiveDate: Date with {
      briefly "Date"
      described as {
        |Effective date.
      }
    }
  } with {
    briefly "Request to rate usage records"
    described as {
      |Batch of usage records to be rated against a plan.
    }
  }
  type RatedUsage is {
    usageRecordId: UsageRecordId with {
      briefly "Record"
      described as {
        |Usage record.
      }
    }
    baseRate: MonetaryAmount with {
      briefly "Base"
      described as {
        |Base rate.
      }
    }
    discounts: MonetaryAmount with {
      briefly "Discounts"
      described as {
        |Discount amount.
      }
    }
    surcharges: MonetaryAmount with {
      briefly "Surcharges"
      described as {
        |Surcharge amount.
      }
    }
    finalAmount: MonetaryAmount with {
      briefly "Final"
      described as {
        |Final amount.
      }
    }
    ratingDetails: String with {
      briefly "Details"
      described as {
        |Rating details.
      }
    }
  } with {
    briefly "Usage record with calculated charges"
    described as {
      |The result of applying rating rules to a usage record.
    }
  }
  event UsageRated is  {
    usageRecordId: UsageRecordId with {
      briefly "Record"
      described as {
        |Usage record.
      }
    }
    ratedUsage: RatedUsage with {
      briefly "Rated"
      described as {
        |Rated usage.
      }
    }
    ratedAt: TimeStamp with {
      briefly "Rated"
      described as {
        |Rating time.
      }
    }
  } with {
    briefly "Usage record was rated"
    described as {
      |Indicates a usage record has been priced.
    }
  }
  event RatingError is  {
    usageRecordId: UsageRecordId with {
      briefly "Record"
      described as {
        |Usage record.
      }
    }
    errorCode: String with {
      briefly "Code"
      described as {
        |Error code.
      }
    }
    errorMessage: String with {
      briefly "Message"
      described as {
        |Error message.
      }
    }
    occurredAt: TimeStamp with {
      briefly "Occurred"
      described as {
        |Error time.
      }
    }
  } with {
    briefly "Rating error occurred"
    described as {
      |Indicates a usage record could not be rated.
    }
  }
} with {
  option external()
  briefly "External rating and pricing engine"
  described as {
    | The Rating Engine context represents the external system that
    | applies complex pricing rules, discount calculations, and
    | promotional offers to raw usage records. It supports tiered
    | pricing, bundle discounts, and time-of-day rate variations.
  }
}
context TaxCalculation is {
  type TaxRequest is {
    invoiceId: InvoiceId with {
      briefly "Invoice"
      described as {
        |Invoice identifier.
      }
    }
    lineItems: InvoiceLineItem+ with {
      briefly "Items"
      described as {
        |Invoice line items.
      }
    }
    serviceAddress: Address with {
      briefly "Service"
      described as {
        |Service address.
      }
    }
    billingAddress: Address with {
      briefly "Billing"
      described as {
        |Billing address.
      }
    }
  } with {
    briefly "Request to calculate taxes"
    described as {
      |Invoice details needed for tax calculation.
    }
  }
  type TaxResult is {
    invoiceId: InvoiceId with {
      briefly "Invoice"
      described as {
        |Invoice identifier.
      }
    }
    federalTax: MonetaryAmount with {
      briefly "Federal"
      described as {
        |Federal tax.
      }
    }
    stateTax: MonetaryAmount with {
      briefly "State"
      described as {
        |State tax.
      }
    }
    localTax: MonetaryAmount with {
      briefly "Local"
      described as {
        |Local tax.
      }
    }
    regulatoryFees: MonetaryAmount with {
      briefly "Fees"
      described as {
        |Regulatory fees.
      }
    }
    totalTax: MonetaryAmount with {
      briefly "Total"
      described as {
        |Total tax.
      }
    }
    taxBreakdown: TaxLineItem+ with {
      briefly "Breakdown"
      described as {
        |Tax breakdown.
      }
    }
  } with {
    briefly "Calculated tax amounts"
    described as {
      |Result of tax calculation for an invoice.
    }
  }
  type TaxLineItem is {
    description: String with {
      briefly "Description"
      described as {
        |Tax description.
      }
    }
    jurisdiction: String with {
      briefly "Jurisdiction"
      described as {
        |Tax jurisdiction.
      }
    }
    rate: Decimal(10,6) with {
      briefly "Rate"
      described as {
        |Tax rate.
      }
    }
    amount: MonetaryAmount with {
      briefly "Amount"
      described as {
        |Tax amount.
      }
    }
  } with {
    briefly "Individual tax or fee line item"
    described as {
      |A single tax or regulatory fee applied to the invoice.
    }
  }
  event TaxesCalculated is  {
    invoiceId: InvoiceId with {
      briefly "Invoice"
      described as {
        |Invoice identifier.
      }
    }
    taxResult: TaxResult with {
      briefly "Result"
      described as {
        |Tax calculation result.
      }
    }
    calculatedAt: TimeStamp with {
      briefly "Calculated"
      described as {
        |Calculation time.
      }
    }
  } with {
    briefly "Taxes were calculated"
    described as {
      |Indicates taxes have been determined for an invoice.
    }
  }
} with {
  option external()
  briefly "External tax calculation service"
  described as {
    | The Tax Calculation context represents the external service that
    | calculates federal, state, and local taxes as well as regulatory
    | fees (USF, E911, etc.) based on service and billing addresses.
    | Telecommunications taxation is complex with jurisdiction-specific
    | rules that change frequently.
  }
}
context NotificationService is {
  type NotificationRequest is {
    recipientEmail: EmailAddress with {
      briefly "Email"
      described as {
        |Recipient email.
      }
    }
    recipientPhone: PhoneNumber? with {
      briefly "Phone"
      described as {
        |Recipient phone.
      }
    }
    templateId: String with {
      briefly "Template"
      described as {
        |Template identifier.
      }
    }
    templateData: String with {
      briefly "Data"
      described as {
        |Template data.
      }
    }
    priority: String with {
      briefly "Priority"
      described as {
        |Notification priority.
      }
    }
  } with {
    briefly "Request to send a notification"
    described as {
      |Details for sending an email or SMS notification.
    }
  }
  event InvoiceEmailSent is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    invoiceId: InvoiceId with {
      briefly "Invoice"
      described as {
        |Invoice identifier.
      }
    }
    recipientEmail: EmailAddress with {
      briefly "Email"
      described as {
        |Recipient email.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Invoice email was sent"
    described as {
      |Indicates an invoice notification was delivered.
    }
  }
  event PaymentReminderSent is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    invoiceId: InvoiceId with {
      briefly "Invoice"
      described as {
        |Invoice identifier.
      }
    }
    reminderType: String with {
      briefly "Type"
      described as {
        |Reminder type.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Payment reminder was sent"
    described as {
      |Indicates a payment reminder notification was delivered.
    }
  }
  event SuspensionNoticeSent is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account identifier.
      }
    }
    suspensionDate: Date with {
      briefly "Date"
      described as {
        |Suspension date.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Suspension notice was sent"
    described as {
      |Indicates a suspension warning was delivered to customer.
    }
  }
} with {
  option external()
  briefly "External notification and messaging service"
  described as {
    | The Notification Service context represents the external system
    | that handles delivery of billing-related communications including
    | invoice notifications, payment reminders, suspension warnings,
    | and payment confirmations via email and SMS.
  }
}
