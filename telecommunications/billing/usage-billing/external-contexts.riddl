// External Contexts for Usage Billing Domain
// These represent external systems that the billing domain integrates with

context NetworkMediation is {

  type CDR is {
    cdrRecordId is String with { briefly "ID" described by "Record identifier." }
    msisdn is String with { briefly "MSISDN" described by "Mobile number." }
    imsi is String with { briefly "IMSI" described by "Subscriber identity." }
    callType is String with { briefly "Type" described by "Call type." }
    startTime is TimeStamp with { briefly "Start" described by "Start time." }
    endTime is TimeStamp with { briefly "End" described by "End time." }
    durationSeconds is Integer with { briefly "Duration" described by "Duration in seconds." }
    dataVolumeBytes is Integer with { briefly "Volume" described by "Data volume." }
    originatingCell is String with { briefly "Origin" described by "Originating cell." }
    terminatingCell is String with { briefly "Dest" described by "Terminating cell." }
    networkId is String with { briefly "Network" described by "Network identifier." }
  } with {
    briefly "Call Detail Record from network"
    described by "Raw usage record from network elements before rating."
  }

  event CDRReceived is {
    cdr is CDR with { briefly "CDR" described by "Call detail record." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "CDR received from network"
    described by "Indicates a new call detail record is available for processing."
  }

  event CDRBatchReady is {
    batchId is String with { briefly "Batch" described by "Batch identifier." }
    recordCount is Integer with { briefly "Count" described by "Number of records." }
    periodStart is TimeStamp with { briefly "Start" described by "Period start." }
    periodEnd is TimeStamp with { briefly "End" described by "Period end." }
  } with {
    briefly "Batch of CDRs ready for processing"
    described by "Indicates a batch of CDRs is ready for rating and billing."
  }

} with {
  option is external
  briefly "External network mediation system"
  described by {
    | The Network Mediation context represents the external system that
    | collects raw Call Detail Records (CDRs) from network elements,
    | performs normalization and deduplication, and delivers them to
    | the billing system for rating and invoicing.
  }
}

context PaymentGateway is {

  type PaymentRequest is {
    transactionId is String with { briefly "ID" described by "Transaction identifier." }
    amount is MonetaryAmount with { briefly "Amount" described by "Payment amount." }
    currency is String with { briefly "Currency" described by "Currency code." }
    customerId is String with { briefly "Customer" described by "Customer identifier." }
    paymentMethod is PaymentMethod with { briefly "Method" described by "Payment method." }
    cardToken is optional String with { briefly "Card" described by "Card token." }
    bankAccountToken is optional String with { briefly "Bank" described by "Bank account token." }
  } with {
    briefly "Request to process a payment"
    described by "Contains all information needed to process a customer payment."
  }

  type PaymentResponse is {
    transactionId is String with { briefly "ID" described by "Transaction identifier." }
    processingStatus is String with { briefly "Status" described by "Processing status." }
    authorizationCode is optional String with { briefly "Auth" described by "Authorization code." }
    declineReason is optional String with { briefly "Reason" described by "Decline reason." }
    processedAt is TimeStamp with { briefly "Processed" described by "Processing time." }
  } with {
    briefly "Response from payment processing"
    described by "Result of a payment processing attempt."
  }

  event PaymentProcessed is {
    transactionId is String with { briefly "ID" described by "Transaction identifier." }
    externalAccountId is String with { briefly "Account" described by "Account identifier." }
    amount is MonetaryAmount with { briefly "Amount" described by "Payment amount." }
    processingStatus is String with { briefly "Status" described by "Processing status." }
    processedAt is TimeStamp with { briefly "Processed" described by "Processing time." }
  } with {
    briefly "Payment was processed"
    described by "Indicates a payment has been processed by the gateway."
  }

  event PaymentFailed is {
    transactionId is String with { briefly "ID" described by "Transaction identifier." }
    externalAccountId is String with { briefly "Account" described by "Account identifier." }
    amount is MonetaryAmount with { briefly "Amount" described by "Payment amount." }
    reason is String with { briefly "Reason" described by "Failure reason." }
    failedAt is TimeStamp with { briefly "Failed" described by "Failure time." }
  } with {
    briefly "Payment processing failed"
    described by "Indicates a payment attempt was unsuccessful."
  }

} with {
  option is external
  briefly "External payment processing gateway"
  described by {
    | The Payment Gateway context represents the external payment
    | processing system that handles credit card, debit card, ACH,
    | and other payment methods. It provides secure tokenization
    | and PCI-compliant transaction processing.
  }
}

context CustomerPortal is {

  type BillViewRequest is {
    accountId is AccountId with { briefly "Account" described by "Account identifier." }
    updatedInvoiceId is optional InvoiceId with { briefly "Invoice" described by "Invoice identifier." }
  } with {
    briefly "Request to view billing information"
    described by "Customer request to view their bill or invoice."
  }

  type UsageViewRequest is {
    accountId is AccountId with { briefly "Account" described by "Account identifier." }
    startDate is Date with { briefly "Start" described by "Start date." }
    endDate is Date with { briefly "End" described by "End date." }
    filterUsageType is optional UsageType with { briefly "Type" described by "Usage type filter." }
  } with {
    briefly "Request to view usage details"
    described by "Customer request to view their usage history."
  }

  event CustomerViewedBill is {
    accountId is AccountId with { briefly "Account" described by "Account identifier." }
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice identifier." }
    viewedAt is TimeStamp with { briefly "Viewed" described by "View time." }
  } with {
    briefly "Customer viewed their bill"
    described by "Indicates a customer accessed their invoice in the portal."
  }

  event CustomerInitiatedPayment is {
    accountId is AccountId with { briefly "Account" described by "Account identifier." }
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice identifier." }
    amount is MonetaryAmount with { briefly "Amount" described by "Payment amount." }
    paymentMethod is PaymentMethod with { briefly "Method" described by "Payment method." }
  } with {
    briefly "Customer initiated a payment"
    described by "Indicates a customer started the payment process in the portal."
  }

  event CustomerDisputedCharge is {
    accountId is AccountId with { briefly "Account" described by "Account identifier." }
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice identifier." }
    lineItemDescription is String with { briefly "Item" described by "Disputed item." }
    disputeReason is String with { briefly "Reason" described by "Dispute reason." }
    disputedAt is TimeStamp with { briefly "Disputed" described by "Dispute time." }
  } with {
    briefly "Customer disputed a charge"
    described by "Indicates a customer raised a dispute about a bill item."
  }

} with {
  option is external
  briefly "External customer self-service portal"
  described by {
    | The Customer Portal context represents the external self-service
    | web and mobile application where customers view bills, check
    | usage, make payments, and manage their account preferences.
  }
}

context RatingEngine is {

  type RatingRequest is {
    usageRecords is many UsageRecordId with { briefly "Records" described by "Usage records to rate." }
    ratePlanId is RatePlanId with { briefly "Plan" described by "Rate plan." }
    effectiveDate is Date with { briefly "Date" described by "Effective date." }
  } with {
    briefly "Request to rate usage records"
    described by "Batch of usage records to be rated against a plan."
  }

  type RatedUsage is {
    usageRecordId is UsageRecordId with { briefly "Record" described by "Usage record." }
    baseRate is MonetaryAmount with { briefly "Base" described by "Base rate." }
    discounts is MonetaryAmount with { briefly "Discounts" described by "Discount amount." }
    surcharges is MonetaryAmount with { briefly "Surcharges" described by "Surcharge amount." }
    finalAmount is MonetaryAmount with { briefly "Final" described by "Final amount." }
    ratingDetails is String with { briefly "Details" described by "Rating details." }
  } with {
    briefly "Usage record with calculated charges"
    described by "The result of applying rating rules to a usage record."
  }

  event UsageRated is {
    usageRecordId is UsageRecordId with { briefly "Record" described by "Usage record." }
    ratedUsage is RatedUsage with { briefly "Rated" described by "Rated usage." }
    ratedAt is TimeStamp with { briefly "Rated" described by "Rating time." }
  } with {
    briefly "Usage record was rated"
    described by "Indicates a usage record has been priced."
  }

  event RatingError is {
    usageRecordId is UsageRecordId with { briefly "Record" described by "Usage record." }
    errorCode is String with { briefly "Code" described by "Error code." }
    errorMessage is String with { briefly "Message" described by "Error message." }
    occurredAt is TimeStamp with { briefly "Occurred" described by "Error time." }
  } with {
    briefly "Rating error occurred"
    described by "Indicates a usage record could not be rated."
  }

} with {
  option is external
  briefly "External rating and pricing engine"
  described by {
    | The Rating Engine context represents the external system that
    | applies complex pricing rules, discount calculations, and
    | promotional offers to raw usage records. It supports tiered
    | pricing, bundle discounts, and time-of-day rate variations.
  }
}

context TaxCalculation is {

  type TaxRequest is {
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice identifier." }
    lineItems is many InvoiceLineItem with { briefly "Items" described by "Invoice line items." }
    serviceAddress is Address with { briefly "Service" described by "Service address." }
    billingAddress is Address with { briefly "Billing" described by "Billing address." }
  } with {
    briefly "Request to calculate taxes"
    described by "Invoice details needed for tax calculation."
  }

  type TaxResult is {
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice identifier." }
    federalTax is MonetaryAmount with { briefly "Federal" described by "Federal tax." }
    stateTax is MonetaryAmount with { briefly "State" described by "State tax." }
    localTax is MonetaryAmount with { briefly "Local" described by "Local tax." }
    regulatoryFees is MonetaryAmount with { briefly "Fees" described by "Regulatory fees." }
    totalTax is MonetaryAmount with { briefly "Total" described by "Total tax." }
    taxBreakdown is many TaxLineItem with { briefly "Breakdown" described by "Tax breakdown." }
  } with {
    briefly "Calculated tax amounts"
    described by "Result of tax calculation for an invoice."
  }

  type TaxLineItem is {
    description is String with { briefly "Description" described by "Tax description." }
    jurisdiction is String with { briefly "Jurisdiction" described by "Tax jurisdiction." }
    rate is Decimal(10, 6) with { briefly "Rate" described by "Tax rate." }
    amount is MonetaryAmount with { briefly "Amount" described by "Tax amount." }
  } with {
    briefly "Individual tax or fee line item"
    described by "A single tax or regulatory fee applied to the invoice."
  }

  event TaxesCalculated is {
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice identifier." }
    taxResult is TaxResult with { briefly "Result" described by "Tax calculation result." }
    calculatedAt is TimeStamp with { briefly "Calculated" described by "Calculation time." }
  } with {
    briefly "Taxes were calculated"
    described by "Indicates taxes have been determined for an invoice."
  }

} with {
  option is external
  briefly "External tax calculation service"
  described by {
    | The Tax Calculation context represents the external service that
    | calculates federal, state, and local taxes as well as regulatory
    | fees (USF, E911, etc.) based on service and billing addresses.
    | Telecommunications taxation is complex with jurisdiction-specific
    | rules that change frequently.
  }
}

context NotificationService is {

  type NotificationRequest is {
    recipientEmail is EmailAddress with { briefly "Email" described by "Recipient email." }
    recipientPhone is optional PhoneNumber with { briefly "Phone" described by "Recipient phone." }
    templateId is String with { briefly "Template" described by "Template identifier." }
    templateData is String with { briefly "Data" described by "Template data." }
    priority is String with { briefly "Priority" described by "Notification priority." }
  } with {
    briefly "Request to send a notification"
    described by "Details for sending an email or SMS notification."
  }

  event InvoiceEmailSent is {
    accountId is AccountId with { briefly "Account" described by "Account identifier." }
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice identifier." }
    recipientEmail is EmailAddress with { briefly "Email" described by "Recipient email." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Invoice email was sent"
    described by "Indicates an invoice notification was delivered."
  }

  event PaymentReminderSent is {
    accountId is AccountId with { briefly "Account" described by "Account identifier." }
    invoiceId is InvoiceId with { briefly "Invoice" described by "Invoice identifier." }
    reminderType is String with { briefly "Type" described by "Reminder type." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Payment reminder was sent"
    described by "Indicates a payment reminder notification was delivered."
  }

  event SuspensionNoticeSent is {
    accountId is AccountId with { briefly "Account" described by "Account identifier." }
    suspensionDate is Date with { briefly "Date" described by "Suspension date." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Suspension notice was sent"
    described by "Indicates a suspension warning was delivered to customer."
  }

} with {
  option is external
  briefly "External notification and messaging service"
  described by {
    | The Notification Service context represents the external system
    | that handles delivery of billing-related communications including
    | invoice notifications, payment reminders, suspension warnings,
    | and payment confirmations via email and SMS.
  }
}
