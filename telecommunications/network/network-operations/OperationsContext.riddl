// Network Operations - Operations Context
context OperationsContext is {
  include "types.riddl"
  include "NetworkIncident.riddl"
  repository OperationsRepository is {
    schema OperationsData is relational
      of incidents as type NetworkIncident
        index on field NetworkIncident.incidentId
        index on field NetworkIncident.status
        index on field NetworkIncident.incidentInfo.severity

    handler OperationsPersistence is {
      on command NetworkIncident.CreateIncident is {
        prompt "Store new network incident"
      }
      on command NetworkIncident.AcknowledgeIncident is {
        prompt "Update incident to acknowledged"
      }
      on command NetworkIncident.StartInvestigation is {
        prompt "Update incident with investigator"
      }
      on command NetworkIncident.EscalateIncident is {
        prompt "Record escalation details"
      }
      on command NetworkIncident.ResolveIncident is {
        prompt "Update incident with resolution"
      }
      on command NetworkIncident.CloseIncident is {
        prompt "Update incident to closed"
      }
    } with {
      briefly "Persists operations commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Operations data persistence"
    described as {
      |Persistent storage for network operations.
    }
  }
  projector OperationsMetrics is {
    record IncidentMetrics is  {
      totalIncidents: Natural with {
        briefly "Total"
        described as {
          |Total incidents.
        }
      }
      activeIncidents: Natural with {
        briefly "Active"
        described as {
          |Active incidents.
        }
      }
      criticalIncidents: Natural with {
        briefly "Critical"
        described as {
          |Critical incidents.
        }
      }
      meanTimeToAcknowledge: Decimal(8,2) with {
        briefly "MTTA"
        described as {
          |Mean time to acknowledge in minutes.
        }
      }
      meanTimeToResolve: Decimal(8,2) with {
        briefly "MTTR"
        described as {
          |Mean time to resolve in minutes.
        }
      }
      escalationRate: Decimal(5,2) with {
        briefly "Escalation rate"
        described as {
          |Percentage of incidents escalated.
        }
      }
    } with {
      briefly "Incident metrics"
      described as {
        |NOC incident analytics.
      }
    }
    handler MetricsHandler is {
      on event NetworkIncident.IncidentCreated is {
        prompt "Increment total and active incidents"
      }
      on event NetworkIncident.IncidentAcknowledged is {
        prompt "Calculate acknowledge time and update MTTA"
      }
      on event NetworkIncident.IncidentEscalated is {
        prompt "Increment escalation count and update rate"
      }
      on event NetworkIncident.IncidentResolved is {
        prompt "Calculate resolve time and update MTTR"
      }
      on event NetworkIncident.IncidentClosed is {
        prompt "Decrement active incidents"
      }
    } with {
      briefly "Maintains operations metrics"
      described as {
        |Projects events into NOC metrics.
      }
    }
  } with {
    briefly "Operations metrics"
    described as {
      |Network operations analytics.
    }
  }
} with {
  briefly "Bounded context for network operations"
  described as {
    |Network operations center management context.
  }
}
