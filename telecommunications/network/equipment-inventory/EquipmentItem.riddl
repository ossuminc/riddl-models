// Equipment Inventory - EquipmentItem Entity
entity EquipmentItem is {
  command RegisterEquipment is  {
    itemId: EquipmentItemId with {
      briefly "Item ID"
      described as {
        |New equipment item identifier.
      }
    }
    details: EquipmentDetails with {
      briefly "Details"
      described as {
        |Equipment specification details.
      }
    }
    vendorId: VendorId with {
      briefly "Vendor"
      described as {
        |Supplying vendor.
      }
    }
    purchaseOrderId: PurchaseOrderId with {
      briefly "PO"
      described as {
        |Purchase order reference.
      }
    }
  } with {
    briefly "Register equipment"
    described as {
      |Registers new equipment in inventory.
    }
  }
  command ReceiveEquipment is  {
    itemId: EquipmentItemId with {
      briefly "Item ID"
      described as {
        |Equipment item identifier.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Receipt timestamp.
      }
    }
    condition: EquipmentCondition with {
      briefly "Condition"
      described as {
        |Condition on receipt.
      }
    }
    warehouseLocation: String(1,100) with {
      briefly "Location"
      described as {
        |Warehouse storage location.
      }
    }
  } with {
    briefly "Receive equipment"
    described as {
      |Records equipment receipt at warehouse.
    }
  }
  command AllocateEquipment is  {
    itemId: EquipmentItemId with {
      briefly "Item ID"
      described as {
        |Equipment item identifier.
      }
    }
    site: SiteLocation with {
      briefly "Site"
      described as {
        |Target installation site.
      }
    }
    allocatedBy: String(1,200) with {
      briefly "Allocated by"
      described as {
        |Person allocating equipment.
      }
    }
  } with {
    briefly "Allocate equipment"
    described as {
      |Allocates equipment to a site.
    }
  }
  command InstallEquipment is  {
    itemId: EquipmentItemId with {
      briefly "Item ID"
      described as {
        |Equipment item identifier.
      }
    }
    installedBy: String(1,200) with {
      briefly "Installed by"
      described as {
        |Technician who installed.
      }
    }
    installedAt: TimeStamp with {
      briefly "Installed"
      described as {
        |Installation timestamp.
      }
    }
    updatedIpAddress: String(1,50)? with {
      briefly "IP address"
      described as {
        |Assigned IP address.
      }
    }
    hostname: String(1,200)? with {
      briefly "Hostname"
      described as {
        |Assigned hostname.
      }
    }
  } with {
    briefly "Install equipment"
    described as {
      |Records equipment installation at site.
    }
  }
  command RecordMaintenance is  {
    itemId: EquipmentItemId with {
      briefly "Item ID"
      described as {
        |Equipment item identifier.
      }
    }
    maintenance: MaintenanceRecord with {
      briefly "Maintenance"
      described as {
        |Maintenance details.
      }
    }
  } with {
    briefly "Record maintenance"
    described as {
      |Records maintenance activity.
    }
  }
  command UpdateFirmware is  {
    itemId: EquipmentItemId with {
      briefly "Item ID"
      described as {
        |Equipment item identifier.
      }
    }
    update: FirmwareUpdate with {
      briefly "Update"
      described as {
        |Firmware update details.
      }
    }
  } with {
    briefly "Update firmware"
    described as {
      |Records firmware update.
    }
  }
  command DecommissionEquipment is  {
    itemId: EquipmentItemId with {
      briefly "Item ID"
      described as {
        |Equipment item identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Decommission reason.
      }
    }
    decommissionedBy: String(1,200) with {
      briefly "Decommissioned by"
      described as {
        |Person decommissioning.
      }
    }
  } with {
    briefly "Decommission equipment"
    described as {
      |Takes equipment out of service.
    }
  }
  command DisposeEquipment is  {
    itemId: EquipmentItemId with {
      briefly "Item ID"
      described as {
        |Equipment item identifier.
      }
    }
    disposalMethod: String(1,200) with {
      briefly "Method"
      described as {
        |Disposal method.
      }
    }
    disposedAt: TimeStamp with {
      briefly "Disposed"
      described as {
        |Disposal timestamp.
      }
    }
  } with {
    briefly "Dispose equipment"
    described as {
      |Records equipment disposal.
    }
  }
  // Events
  event EquipmentRegistered is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    details: EquipmentDetails with {
      briefly "Details"
      described as {
        |Equipment details.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Equipment registered"
    described as {
      |Emitted when equipment is registered.
    }
  }
  event EquipmentReceived is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    condition: EquipmentCondition with {
      briefly "Condition"
      described as {
        |Receipt condition.
      }
    }
    receivedAt: TimeStamp with {
      briefly "Received"
      described as {
        |Receipt time.
      }
    }
  } with {
    briefly "Equipment received"
    described as {
      |Emitted when equipment is received.
    }
  }
  event EquipmentAllocated is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    site: SiteLocation with {
      briefly "Site"
      described as {
        |Target site.
      }
    }
    allocatedAt: TimeStamp with {
      briefly "Allocated"
      described as {
        |Allocation time.
      }
    }
  } with {
    briefly "Equipment allocated"
    described as {
      |Emitted when equipment is allocated to a site.
    }
  }
  event EquipmentInstalled is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    installedAt: TimeStamp with {
      briefly "Installed"
      described as {
        |Installation time.
      }
    }
  } with {
    briefly "Equipment installed"
    described as {
      |Emitted when equipment is installed.
    }
  }
  event MaintenanceRecorded is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    maintenance: MaintenanceRecord with {
      briefly "Maintenance"
      described as {
        |Maintenance details.
      }
    }
  } with {
    briefly "Maintenance recorded"
    described as {
      |Emitted when maintenance is recorded.
    }
  }
  event FirmwareUpdated is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    update: FirmwareUpdate with {
      briefly "Update"
      described as {
        |Update details.
      }
    }
  } with {
    briefly "Firmware updated"
    described as {
      |Emitted when firmware is updated.
    }
  }
  event EquipmentDecommissioned is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Decommission reason.
      }
    }
    decommissionedAt: TimeStamp with {
      briefly "Decommissioned"
      described as {
        |Decommission time.
      }
    }
  } with {
    briefly "Equipment decommissioned"
    described as {
      |Emitted when equipment is decommissioned.
    }
  }
  event EquipmentDisposed is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    disposalMethod: String(1,200) with {
      briefly "Method"
      described as {
        |Disposal method.
      }
    }
    disposedAt: TimeStamp with {
      briefly "Disposed"
      described as {
        |Disposal time.
      }
    }
  } with {
    briefly "Equipment disposed"
    described as {
      |Emitted when equipment is disposed.
    }
  }
  // States
  record ActiveItemData is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    details: EquipmentDetails with {
      briefly "Details"
      described as {
        |Equipment details.
      }
    }
    status: EquipmentStatus with {
      briefly "Status"
      described as {
        |Current status.
      }
    }
    condition: EquipmentCondition with {
      briefly "Condition"
      described as {
        |Physical condition.
      }
    }
    location: SiteLocation? with {
      briefly "Location"
      described as {
        |Current location.
      }
    }
    maintenanceHistory: MaintenanceRecord* with {
      briefly "Maintenance"
      described as {
        |Maintenance history.
      }
    }
    firmwareHistory: FirmwareUpdate* with {
      briefly "Firmware"
      described as {
        |Firmware update history.
      }
    }
    vendorId: VendorId with {
      briefly "Vendor"
      described as {
        |Vendor.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Active equipment state"
    described as {
      |State for active equipment item.
    }
  }
  record DisposedItemData is  {
    itemId: EquipmentItemId with {
      briefly "Item"
      described as {
        |Item ID.
      }
    }
    details: EquipmentDetails with {
      briefly "Details"
      described as {
        |Equipment details.
      }
    }
    disposalMethod: String(1,200) with {
      briefly "Method"
      described as {
        |Disposal method.
      }
    }
    disposedAt: TimeStamp with {
      briefly "Disposed"
      described as {
        |Disposal time.
      }
    }
  } with {
    briefly "Disposed equipment state"
    described as {
      |State for disposed equipment.
    }
  }
  state ActiveItemState of type EquipmentItem.ActiveItemData
  state DisposedItemState of type EquipmentItem.DisposedItemData
  handler EquipmentItemHandler is {
    on command RegisterEquipment is {
      morph entity InventoryContext.EquipmentItem to state InventoryContext.EquipmentItem.ActiveItemState with command RegisterEquipment
      tell event EquipmentRegistered to entity InventoryContext.EquipmentItem
    }
    on command ReceiveEquipment is {
      tell event EquipmentReceived to entity InventoryContext.EquipmentItem
    }
    on command AllocateEquipment is {
      tell event EquipmentAllocated to entity InventoryContext.EquipmentItem
    }
    on command InstallEquipment is {
      tell event EquipmentInstalled to entity InventoryContext.EquipmentItem
    }
    on command RecordMaintenance is {
      tell event MaintenanceRecorded to entity InventoryContext.EquipmentItem
    }
    on command UpdateFirmware is {
      tell event FirmwareUpdated to entity InventoryContext.EquipmentItem
    }
    on command DecommissionEquipment is {
      tell event EquipmentDecommissioned to entity InventoryContext.EquipmentItem
    }
    on command DisposeEquipment is {
      morph entity InventoryContext.EquipmentItem to state InventoryContext.EquipmentItem.DisposedItemState with command DisposeEquipment
      tell event EquipmentDisposed to entity InventoryContext.EquipmentItem
    }
  } with {
    briefly "Processes equipment commands"
    described as {
      |Handles equipment lifecycle commands.
    }
  }
} with {
  briefly "EquipmentItem aggregate"
  described as {
    |Manages network equipment items.
  }
}
