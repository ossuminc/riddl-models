// Equipment Inventory - EquipmentItem Entity

entity EquipmentItem is {

  command RegisterEquipment is {
    itemId is EquipmentItemId with {
      briefly "Item ID"
      described by "New equipment item identifier."
    }
    details is EquipmentDetails with {
      briefly "Details"
      described by "Equipment specification details."
    }
    vendorId is VendorId with {
      briefly "Vendor"
      described by "Supplying vendor."
    }
    purchaseOrderId is PurchaseOrderId with {
      briefly "PO"
      described by "Purchase order reference."
    }
  } with {
    briefly "Register equipment"
    described by "Registers new equipment in inventory."
  }

  command ReceiveEquipment is {
    itemId is EquipmentItemId with {
      briefly "Item ID"
      described by "Equipment item identifier."
    }
    receivedAt is TimeStamp with {
      briefly "Received"
      described by "Receipt timestamp."
    }
    condition is EquipmentCondition with {
      briefly "Condition"
      described by "Condition on receipt."
    }
    warehouseLocation is String(1, 100) with {
      briefly "Location"
      described by "Warehouse storage location."
    }
  } with {
    briefly "Receive equipment"
    described by "Records equipment receipt at warehouse."
  }

  command AllocateEquipment is {
    itemId is EquipmentItemId with {
      briefly "Item ID"
      described by "Equipment item identifier."
    }
    site is SiteLocation with {
      briefly "Site"
      described by "Target installation site."
    }
    allocatedBy is String(1, 200) with {
      briefly "Allocated by"
      described by "Person allocating equipment."
    }
  } with {
    briefly "Allocate equipment"
    described by "Allocates equipment to a site."
  }

  command InstallEquipment is {
    itemId is EquipmentItemId with {
      briefly "Item ID"
      described by "Equipment item identifier."
    }
    installedBy is String(1, 200) with {
      briefly "Installed by"
      described by "Technician who installed."
    }
    installedAt is TimeStamp with {
      briefly "Installed"
      described by "Installation timestamp."
    }
    ipAddress is optional String(1, 50) with {
      briefly "IP address"
      described by "Assigned IP address."
    }
    hostname is optional String(1, 200) with {
      briefly "Hostname"
      described by "Assigned hostname."
    }
  } with {
    briefly "Install equipment"
    described by "Records equipment installation at site."
  }

  command RecordMaintenance is {
    itemId is EquipmentItemId with {
      briefly "Item ID"
      described by "Equipment item identifier."
    }
    maintenance is MaintenanceRecord with {
      briefly "Maintenance"
      described by "Maintenance details."
    }
  } with {
    briefly "Record maintenance"
    described by "Records maintenance activity."
  }

  command UpdateFirmware is {
    itemId is EquipmentItemId with {
      briefly "Item ID"
      described by "Equipment item identifier."
    }
    update is FirmwareUpdate with {
      briefly "Update"
      described by "Firmware update details."
    }
  } with {
    briefly "Update firmware"
    described by "Records firmware update."
  }

  command DecommissionEquipment is {
    itemId is EquipmentItemId with {
      briefly "Item ID"
      described by "Equipment item identifier."
    }
    reason is String(1, 500) with {
      briefly "Reason"
      described by "Decommission reason."
    }
    decommissionedBy is String(1, 200) with {
      briefly "Decommissioned by"
      described by "Person decommissioning."
    }
  } with {
    briefly "Decommission equipment"
    described by "Takes equipment out of service."
  }

  command DisposeEquipment is {
    itemId is EquipmentItemId with {
      briefly "Item ID"
      described by "Equipment item identifier."
    }
    disposalMethod is String(1, 200) with {
      briefly "Method"
      described by "Disposal method."
    }
    disposedAt is TimeStamp with {
      briefly "Disposed"
      described by "Disposal timestamp."
    }
  } with {
    briefly "Dispose equipment"
    described by "Records equipment disposal."
  }

  // Events
  event EquipmentRegistered is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    details is EquipmentDetails with { briefly "Details" described by "Equipment details." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Equipment registered"
    described by "Emitted when equipment is registered."
  }

  event EquipmentReceived is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    condition is EquipmentCondition with { briefly "Condition" described by "Receipt condition." }
    receivedAt is TimeStamp with { briefly "Received" described by "Receipt time." }
  } with {
    briefly "Equipment received"
    described by "Emitted when equipment is received."
  }

  event EquipmentAllocated is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    site is SiteLocation with { briefly "Site" described by "Target site." }
    allocatedAt is TimeStamp with { briefly "Allocated" described by "Allocation time." }
  } with {
    briefly "Equipment allocated"
    described by "Emitted when equipment is allocated to a site."
  }

  event EquipmentInstalled is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    installedAt is TimeStamp with { briefly "Installed" described by "Installation time." }
  } with {
    briefly "Equipment installed"
    described by "Emitted when equipment is installed."
  }

  event MaintenanceRecorded is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    maintenance is MaintenanceRecord with { briefly "Maintenance" described by "Maintenance details." }
  } with {
    briefly "Maintenance recorded"
    described by "Emitted when maintenance is recorded."
  }

  event FirmwareUpdated is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    update is FirmwareUpdate with { briefly "Update" described by "Update details." }
  } with {
    briefly "Firmware updated"
    described by "Emitted when firmware is updated."
  }

  event EquipmentDecommissioned is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    reason is String(1, 500) with { briefly "Reason" described by "Decommission reason." }
    decommissionedAt is TimeStamp with { briefly "Decommissioned" described by "Decommission time." }
  } with {
    briefly "Equipment decommissioned"
    described by "Emitted when equipment is decommissioned."
  }

  event EquipmentDisposed is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    disposalMethod is String(1, 200) with { briefly "Method" described by "Disposal method." }
    disposedAt is TimeStamp with { briefly "Disposed" described by "Disposal time." }
  } with {
    briefly "Equipment disposed"
    described by "Emitted when equipment is disposed."
  }

  // States
  record ActiveItemData is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    details is EquipmentDetails with { briefly "Details" described by "Equipment details." }
    status is EquipmentStatus with { briefly "Status" described by "Current status." }
    condition is EquipmentCondition with { briefly "Condition" described by "Physical condition." }
    location is optional SiteLocation with { briefly "Location" described by "Current location." }
    maintenanceHistory is many optional MaintenanceRecord with {
      briefly "Maintenance" described by "Maintenance history."
    }
    firmwareHistory is many optional FirmwareUpdate with {
      briefly "Firmware" described by "Firmware update history."
    }
    vendorId is VendorId with { briefly "Vendor" described by "Vendor." }
    registeredAt is TimeStamp with { briefly "Registered" described by "Registration time." }
  } with {
    briefly "Active equipment state"
    described by "State for active equipment item."
  }

  record DisposedItemData is {
    itemId is EquipmentItemId with { briefly "Item" described by "Item ID." }
    details is EquipmentDetails with { briefly "Details" described by "Equipment details." }
    disposalMethod is String(1, 200) with { briefly "Method" described by "Disposal method." }
    disposedAt is TimeStamp with { briefly "Disposed" described by "Disposal time." }
  } with {
    briefly "Disposed equipment state"
    described by "State for disposed equipment."
  }

  state ActiveItemState of EquipmentItem.ActiveItemData with {
    briefly "Equipment active"
    described by "Equipment is tracked in inventory."
  }

  state DisposedItemState of EquipmentItem.DisposedItemData with {
    briefly "Equipment disposed"
    described by "Equipment has been disposed."
  }

  handler EquipmentItemHandler is {
    on command RegisterEquipment {
      morph entity InventoryContext.EquipmentItem to state
        InventoryContext.EquipmentItem.ActiveItemState
        with command RegisterEquipment
      tell event EquipmentRegistered to
        entity InventoryContext.EquipmentItem
    }
    on command ReceiveEquipment {
      tell event EquipmentReceived to
        entity InventoryContext.EquipmentItem
    }
    on command AllocateEquipment {
      tell event EquipmentAllocated to
        entity InventoryContext.EquipmentItem
    }
    on command InstallEquipment {
      tell event EquipmentInstalled to
        entity InventoryContext.EquipmentItem
    }
    on command RecordMaintenance {
      tell event MaintenanceRecorded to
        entity InventoryContext.EquipmentItem
    }
    on command UpdateFirmware {
      tell event FirmwareUpdated to
        entity InventoryContext.EquipmentItem
    }
    on command DecommissionEquipment {
      tell event EquipmentDecommissioned to
        entity InventoryContext.EquipmentItem
    }
    on command DisposeEquipment {
      morph entity InventoryContext.EquipmentItem to state
        InventoryContext.EquipmentItem.DisposedItemState
        with command DisposeEquipment
      tell event EquipmentDisposed to
        entity InventoryContext.EquipmentItem
    }
  } with {
    briefly "Processes equipment commands"
    described by "Handles equipment lifecycle commands."
  }

} with {
  briefly "EquipmentItem aggregate"
  described by "Manages network equipment items."
}
