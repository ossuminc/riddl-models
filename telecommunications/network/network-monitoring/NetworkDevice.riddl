// Network Monitoring - Network Device Entity
entity NetworkDevice is {
  command RegisterDevice is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |New device identifier.
      }
    }
    deviceInfo: DeviceInfo with {
      briefly "Info"
      described as {
        |Device information.
      }
    }
    deviceType: DeviceType with {
      briefly "Type"
      described as {
        |Device type.
      }
    }
  } with {
    briefly "Register device"
    described as {
      |Registers network device.
    }
  }
  command UpdateDeviceInfo is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    deviceInfo: DeviceInfo with {
      briefly "Info"
      described as {
        |Updated info.
      }
    }
  } with {
    briefly "Update device info"
    described as {
      |Updates device details.
    }
  }
  command ConfigureThresholds is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    thresholds: Threshold+ with {
      briefly "Thresholds"
      described as {
        |Alert thresholds.
      }
    }
  } with {
    briefly "Configure thresholds"
    described as {
      |Sets alert thresholds.
    }
  }
  command RecordMetrics is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    metrics: PerformanceMetrics with {
      briefly "Metrics"
      described as {
        |Performance metrics.
      }
    }
    interfaces: InterfaceMetrics* with {
      briefly "Interfaces"
      described as {
        |Interface metrics.
      }
    }
  } with {
    briefly "Record metrics"
    described as {
      |Records performance data.
    }
  }
  command RaiseAlert is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    alert: AlertInfo with {
      briefly "Alert"
      described as {
        |Alert details.
      }
    }
  } with {
    briefly "Raise alert"
    described as {
      |Creates new alert.
    }
  }
  command AcknowledgeAlert is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    alertId: AlertId with {
      briefly "Alert"
      described as {
        |Alert to acknowledge.
      }
    }
    acknowledgedBy: String(1,100) with {
      briefly "By"
      described as {
        |Acknowledger name.
      }
    }
    notes: String(1,1000)? with {
      briefly "Notes"
      described as {
        |Acknowledgment notes.
      }
    }
  } with {
    briefly "Acknowledge alert"
    described as {
      |Acknowledges alert.
    }
  }
  command ResolveAlert is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    alertId: AlertId with {
      briefly "Alert"
      described as {
        |Alert to resolve.
      }
    }
    resolution: String(1,1000) with {
      briefly "Resolution"
      described as {
        |Resolution notes.
      }
    }
  } with {
    briefly "Resolve alert"
    described as {
      |Resolves alert.
    }
  }
  command ScheduleMaintenance is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    window: MaintenanceWindow with {
      briefly "Window"
      described as {
        |Maintenance window.
      }
    }
  } with {
    briefly "Schedule maintenance"
    described as {
      |Schedules maintenance window.
    }
  }
  command EndMaintenance is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    windowId: UUID with {
      briefly "Window"
      described as {
        |Maintenance window ID.
      }
    }
  } with {
    briefly "End maintenance"
    described as {
      |Ends maintenance window.
    }
  }
  command MarkOffline is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Offline reason.
      }
    }
  } with {
    briefly "Mark offline"
    described as {
      |Marks device as offline.
    }
  }
  command DecommissionDevice is  {
    deviceId: DeviceId with {
      briefly "Device ID"
      described as {
        |Device identifier.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Decommission reason.
      }
    }
  } with {
    briefly "Decommission device"
    described as {
      |Removes device from monitoring.
    }
  }
  // Events
  event DeviceRegistered is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    deviceInfo: DeviceInfo with {
      briefly "Info"
      described as {
        |Device info.
      }
    }
    deviceType: DeviceType with {
      briefly "Type"
      described as {
        |Device type.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Device registered"
    described as {
      |Emitted when device registered.
    }
  }
  event DeviceInfoUpdated is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    deviceInfo: DeviceInfo with {
      briefly "Info"
      described as {
        |Updated info.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Device info updated"
    described as {
      |Emitted when info updated.
    }
  }
  event ThresholdsConfigured is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    thresholdCount: Natural with {
      briefly "Count"
      described as {
        |Threshold count.
      }
    }
    configuredAt: TimeStamp with {
      briefly "Configured"
      described as {
        |Config time.
      }
    }
  } with {
    briefly "Thresholds configured"
    described as {
      |Emitted when thresholds set.
    }
  }
  event MetricsRecorded is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    metrics: PerformanceMetrics with {
      briefly "Metrics"
      described as {
        |Metrics.
      }
    }
    status: DeviceStatus with {
      briefly "Status"
      described as {
        |Derived status.
      }
    }
  } with {
    briefly "Metrics recorded"
    described as {
      |Emitted when metrics collected.
    }
  }
  event AlertRaised is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    alert: AlertInfo with {
      briefly "Alert"
      described as {
        |Alert details.
      }
    }
  } with {
    briefly "Alert raised"
    described as {
      |Emitted when alert created.
    }
  }
  event AlertAcknowledged is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    alertId: AlertId with {
      briefly "Alert"
      described as {
        |Alert ID.
      }
    }
    acknowledgedBy: String(1,100) with {
      briefly "By"
      described as {
        |Acknowledger.
      }
    }
    acknowledgedAt: TimeStamp with {
      briefly "Acknowledged"
      described as {
        |Ack time.
      }
    }
  } with {
    briefly "Alert acknowledged"
    described as {
      |Emitted when acknowledged.
    }
  }
  event AlertResolved is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    alertId: AlertId with {
      briefly "Alert"
      described as {
        |Alert ID.
      }
    }
    resolution: String(1,1000) with {
      briefly "Resolution"
      described as {
        |Resolution.
      }
    }
    resolvedAt: TimeStamp with {
      briefly "Resolved"
      described as {
        |Resolve time.
      }
    }
  } with {
    briefly "Alert resolved"
    described as {
      |Emitted when resolved.
    }
  }
  event MaintenanceScheduled is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    window: MaintenanceWindow with {
      briefly "Window"
      described as {
        |Maintenance window.
      }
    }
  } with {
    briefly "Maintenance scheduled"
    described as {
      |Emitted when maintenance planned.
    }
  }
  event MaintenanceEnded is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    windowId: UUID with {
      briefly "Window"
      described as {
        |Window ID.
      }
    }
    endedAt: TimeStamp with {
      briefly "Ended"
      described as {
        |End time.
      }
    }
  } with {
    briefly "Maintenance ended"
    described as {
      |Emitted when maintenance ends.
    }
  }
  event DeviceMarkedOffline is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason.
      }
    }
    markedAt: TimeStamp with {
      briefly "Marked"
      described as {
        |Mark time.
      }
    }
  } with {
    briefly "Device marked offline"
    described as {
      |Emitted when offline.
    }
  }
  event DeviceDecommissioned is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason.
      }
    }
    decommissionedAt: TimeStamp with {
      briefly "Decommissioned"
      described as {
        |Time.
      }
    }
  } with {
    briefly "Device decommissioned"
    described as {
      |Emitted when decommissioned.
    }
  }
  // States
  record ActiveStateData is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    deviceInfo: DeviceInfo with {
      briefly "Info"
      described as {
        |Device info.
      }
    }
    deviceType: DeviceType with {
      briefly "Type"
      described as {
        |Device type.
      }
    }
    status: DeviceStatus with {
      briefly "Status"
      described as {
        |Current status.
      }
    }
    configuredThresholds: Threshold* with {
      briefly "Thresholds"
      described as {
        |Thresholds.
      }
    }
    currentMetrics: PerformanceMetrics? with {
      briefly "Metrics"
      described as {
        |Latest metrics.
      }
    }
    interfaceMetrics: InterfaceMetrics* with {
      briefly "Interfaces"
      described as {
        |Interface metrics.
      }
    }
    activeAlerts: AlertInfo* with {
      briefly "Alerts"
      described as {
        |Active alerts.
      }
    }
    maintenanceWindow: MaintenanceWindow? with {
      briefly "Maintenance"
      described as {
        |Current window.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Active device state"
    described as {
      |Monitored device data.
    }
  }
  record DecommissionedStateData is  {
    deviceId: DeviceId with {
      briefly "Device"
      described as {
        |Device ID.
      }
    }
    hostname: String(1,200) with {
      briefly "Hostname"
      described as {
        |Hostname.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason.
      }
    }
    decommissionedAt: TimeStamp with {
      briefly "Decommissioned"
      described as {
        |Time.
      }
    }
  } with {
    briefly "Decommissioned state"
    described as {
      |Decommissioned device data.
    }
  }
  state ActiveState of type NetworkDevice.ActiveStateData
  state DecommissionedState of type NetworkDevice.DecommissionedStateData
  handler NetworkDeviceHandler is {
    on command RegisterDevice is {
      morph entity MonitoringContext.NetworkDevice to state MonitoringContext.NetworkDevice.ActiveState with command RegisterDevice
      tell event DeviceRegistered to entity MonitoringContext.NetworkDevice
    }
    on command UpdateDeviceInfo is {
      tell event DeviceInfoUpdated to entity MonitoringContext.NetworkDevice
    }
    on command ConfigureThresholds is {
      tell event ThresholdsConfigured to entity MonitoringContext.NetworkDevice
    }
    on command RecordMetrics is {
      tell event MetricsRecorded to entity MonitoringContext.NetworkDevice
    }
    on command RaiseAlert is {
      tell event AlertRaised to entity MonitoringContext.NetworkDevice
    }
    on command AcknowledgeAlert is {
      tell event AlertAcknowledged to entity MonitoringContext.NetworkDevice
    }
    on command ResolveAlert is {
      tell event AlertResolved to entity MonitoringContext.NetworkDevice
    }
    on command ScheduleMaintenance is {
      tell event MaintenanceScheduled to entity MonitoringContext.NetworkDevice
    }
    on command EndMaintenance is {
      tell event MaintenanceEnded to entity MonitoringContext.NetworkDevice
    }
    on command MarkOffline is {
      tell event DeviceMarkedOffline to entity MonitoringContext.NetworkDevice
    }
    on command DecommissionDevice is {
      morph entity MonitoringContext.NetworkDevice to state MonitoringContext.NetworkDevice.DecommissionedState with command DecommissionDevice
      tell event DeviceDecommissioned to entity MonitoringContext.NetworkDevice
    }
  } with {
    briefly "Processes device commands"
    described as {
      |Handles device lifecycle.
    }
  }
} with {
  briefly "Network device aggregate"
  described as {
    |Manages monitored devices.
  }
}
