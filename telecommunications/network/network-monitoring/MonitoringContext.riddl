// Network Monitoring - Monitoring Context
context MonitoringContext is {
  include "types.riddl"
  include "NetworkDevice.riddl"
  repository DeviceRepository is {
    schema DeviceData is relational
      of devices as type NetworkDevice
        index on field NetworkDevice.deviceInfo.hostname
        index on field NetworkDevice.deviceInfo.ipAddress
        index on field NetworkDevice.status
        index on field NetworkDevice.deviceType

    handler DevicePersistence is {
      on command NetworkDevice.RegisterDevice is {
        prompt "Store new device record"
      }
      on command NetworkDevice.UpdateDeviceInfo is {
        prompt "Update device information"
      }
      on command NetworkDevice.ConfigureThresholds is {
        prompt "Store threshold configuration"
      }
      on command NetworkDevice.RecordMetrics is {
        prompt "Store metrics snapshot"
      }
      on command NetworkDevice.RaiseAlert is {
        prompt "Store alert record"
      }
      on command NetworkDevice.AcknowledgeAlert is {
        prompt "Update alert status"
      }
      on command NetworkDevice.ResolveAlert is {
        prompt "Close alert record"
      }
      on command NetworkDevice.DecommissionDevice is {
        prompt "Archive device record"
      }
    } with {
      briefly "Persists device commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Device data persistence"
    described as {
      |Persistent storage for devices.
    }
  }
  projector NetworkAnalytics is {
    record NetworkMetrics is  {
      totalDevices: Natural with {
        briefly "Total"
        described as {
          |Total devices.
        }
      }
      onlineDevices: Natural with {
        briefly "Online"
        described as {
          |Online devices.
        }
      }
      activeAlertCount: Natural with {
        briefly "Alerts"
        described as {
          |Active alerts.
        }
      }
      criticalAlerts: Natural with {
        briefly "Critical"
        described as {
          |Critical alerts.
        }
      }
      averageLatency: Decimal(8,2) with {
        briefly "Latency"
        described as {
          |Avg latency.
        }
      }
      networkAvailability: Decimal(5,2) with {
        briefly "Availability"
        described as {
          |Availability %.
        }
      }
    } with {
      briefly "Network metrics"
      described as {
        |Network-wide metrics.
      }
    }
    handler AnalyticsHandler is {
      on event NetworkDevice.DeviceRegistered is {
        prompt "Increment device count"
      }
      on event NetworkDevice.MetricsRecorded is {
        prompt "Update network statistics"
      }
      on event NetworkDevice.AlertRaised is {
        prompt "Increment alert count"
      }
      on event NetworkDevice.AlertResolved is {
        prompt "Decrement alert count"
      }
      on event NetworkDevice.DeviceMarkedOffline is {
        prompt "Update availability"
      }
    } with {
      briefly "Maintains network analytics"
      described as {
        |Projects events into metrics.
      }
    }
  } with {
    briefly "Network analytics"
    described as {
      |Network performance tracking.
    }
  }
} with {
  briefly "Bounded context for network monitoring"
  described as {
    |Network operations context.
  }
}
