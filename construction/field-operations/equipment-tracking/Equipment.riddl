// Equipment Tracking - Equipment Entity
entity Equipment is {
  // Commands
  command RegisterEquipment is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |New equipment identifier.
      }
    }
    equipmentType: EquipmentType with {
      briefly "Type"
      described as {
        |Equipment category.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Equipment name.
      }
    }
    make: String(1,100) with {
      briefly "Make"
      described as {
        |Manufacturer.
      }
    }
    model: String(1,100) with {
      briefly "Model"
      described as {
        |Model name.
      }
    }
    serialNumber: String(1,50) with {
      briefly "Serial"
      described as {
        |Serial number.
      }
    }
    purchaseDate: Date with {
      briefly "Purchased"
      described as {
        |Purchase date.
      }
    }
    purchaseCost: Money with {
      briefly "Cost"
      described as {
        |Purchase cost.
      }
    }
  } with {
    briefly "Register equipment"
    described as {
      |Adds new equipment to the fleet.
    }
  }
  command AssignToSite is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |Equipment to assign.
      }
    }
    assignment: Assignment with {
      briefly "Assignment"
      described as {
        |Assignment details.
      }
    }
  } with {
    briefly "Assign to site"
    described as {
      |Assigns equipment to a job site.
    }
  }
  command ReturnFromSite is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |Equipment returning.
      }
    }
    returnedAt: TimeStamp with {
      briefly "Returned"
      described as {
        |Return timestamp.
      }
    }
    condition: String(1,500) with {
      briefly "Condition"
      described as {
        |Condition on return.
      }
    }
  } with {
    briefly "Return from site"
    described as {
      |Returns equipment from job site.
    }
  }
  command UpdateLocation is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |Equipment to update.
      }
    }
    location: Location with {
      briefly "Location"
      described as {
        |New location.
      }
    }
  } with {
    briefly "Update location"
    described as {
      |Updates equipment GPS location.
    }
  }
  command RecordMeterReading is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |Equipment ID.
      }
    }
    reading: MeterReading with {
      briefly "Reading"
      described as {
        |Meter reading.
      }
    }
  } with {
    briefly "Record meter reading"
    described as {
      |Records operating hours/mileage.
    }
  }
  command ScheduleMaintenance is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |Equipment ID.
      }
    }
    maintenanceType: MaintenanceType with {
      briefly "Type"
      described as {
        |Maintenance type.
      }
    }
    scheduledDate: Date with {
      briefly "Scheduled"
      described as {
        |Scheduled date.
      }
    }
    description: String(1,1000) with {
      briefly "Description"
      described as {
        |Work to perform.
      }
    }
  } with {
    briefly "Schedule maintenance"
    described as {
      |Schedules maintenance work.
    }
  }
  command CompleteMaintenance is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |Equipment ID.
      }
    }
    record: MaintenanceRecord with {
      briefly "Record"
      described as {
        |Maintenance record.
      }
    }
  } with {
    briefly "Complete maintenance"
    described as {
      |Records completed maintenance.
    }
  }
  command MarkOutOfService is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |Equipment ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Out of service reason.
      }
    }
  } with {
    briefly "Mark out of service"
    described as {
      |Marks equipment as non-operational.
    }
  }
  command ReturnToService is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |Equipment ID.
      }
    }
  } with {
    briefly "Return to service"
    described as {
      |Returns equipment to operational status.
    }
  }
  command DisposeEquipment is  {
    equipmentId: EquipmentId with {
      briefly "Equipment ID"
      described as {
        |Equipment ID.
      }
    }
    disposalType: String(1,50) with {
      briefly "Type"
      described as {
        |Sold, scrapped, etc.
      }
    }
    disposalValue: Money? with {
      briefly "Value"
      described as {
        |Sale proceeds.
      }
    }
    disposedBy: String(1,100) with {
      briefly "Disposed by"
      described as {
        |Who disposed.
      }
    }
  } with {
    briefly "Dispose equipment"
    described as {
      |Removes equipment from fleet.
    }
  }
  // Events
  event EquipmentRegistered is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    equipmentType: EquipmentType with {
      briefly "Type"
      described as {
        |Equipment type.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Equipment name.
      }
    }
    registeredAt: TimeStamp with {
      briefly "Registered"
      described as {
        |Registration time.
      }
    }
  } with {
    briefly "Equipment was registered"
    described as {
      |Emitted when equipment is added to fleet.
    }
  }
  event EquipmentAssigned is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    assignment: Assignment with {
      briefly "Assignment"
      described as {
        |Assignment details.
      }
    }
    assignedAt: TimeStamp with {
      briefly "Assigned"
      described as {
        |Assignment time.
      }
    }
  } with {
    briefly "Equipment was assigned"
    described as {
      |Emitted when equipment is assigned to site.
    }
  }
  event EquipmentReturned is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    fromSiteId: JobSiteId with {
      briefly "From site"
      described as {
        |Site returned from.
      }
    }
    returnedAt: TimeStamp with {
      briefly "Returned"
      described as {
        |Return time.
      }
    }
  } with {
    briefly "Equipment was returned"
    described as {
      |Emitted when equipment returns from site.
    }
  }
  event LocationUpdated is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    location: Location with {
      briefly "Location"
      described as {
        |New location.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Location was updated"
    described as {
      |Emitted when GPS location changes.
    }
  }
  event MeterReadingRecorded is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    reading: MeterReading with {
      briefly "Reading"
      described as {
        |Meter reading.
      }
    }
  } with {
    briefly "Meter reading was recorded"
    described as {
      |Emitted when usage metrics recorded.
    }
  }
  event MaintenanceScheduled is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    maintenanceType: MaintenanceType with {
      briefly "Type"
      described as {
        |Maintenance type.
      }
    }
    scheduledDate: Date with {
      briefly "Scheduled"
      described as {
        |Scheduled date.
      }
    }
  } with {
    briefly "Maintenance was scheduled"
    described as {
      |Emitted when maintenance is scheduled.
    }
  }
  event MaintenanceCompleted is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    record: MaintenanceRecord with {
      briefly "Record"
      described as {
        |Maintenance record.
      }
    }
  } with {
    briefly "Maintenance was completed"
    described as {
      |Emitted when maintenance is done.
    }
  }
  event MarkedOutOfService is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Reason.
      }
    }
    markedAt: TimeStamp with {
      briefly "Marked"
      described as {
        |When marked.
      }
    }
  } with {
    briefly "Equipment marked out of service"
    described as {
      |Emitted when equipment becomes non-operational.
    }
  }
  event ReturnedToService is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    returnedAt: TimeStamp with {
      briefly "Returned"
      described as {
        |When returned.
      }
    }
  } with {
    briefly "Equipment returned to service"
    described as {
      |Emitted when equipment becomes operational.
    }
  }
  event EquipmentDisposed is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    disposalType: String(1,50) with {
      briefly "Type"
      described as {
        |Disposal type.
      }
    }
    disposedAt: TimeStamp with {
      briefly "Disposed"
      described as {
        |Disposal time.
      }
    }
  } with {
    briefly "Equipment was disposed"
    described as {
      |Emitted when equipment is removed from fleet.
    }
  }
  // State Records
  record AvailableEquipmentData is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    equipmentType: EquipmentType with {
      briefly "Type"
      described as {
        |Equipment type.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Equipment name.
      }
    }
    make: String(1,100) with {
      briefly "Make"
      described as {
        |Manufacturer.
      }
    }
    model: String(1,100) with {
      briefly "Model"
      described as {
        |Model.
      }
    }
    serialNumber: String(1,50) with {
      briefly "Serial"
      described as {
        |Serial number.
      }
    }
    location: Location with {
      briefly "Location"
      described as {
        |Current location.
      }
    }
    lastReading: MeterReading? with {
      briefly "Reading"
      described as {
        |Last meter reading.
      }
    }
    maintenanceHistory: MaintenanceRecord+ with {
      briefly "History"
      described as {
        |Maintenance records.
      }
    }
  } with {
    briefly "Available equipment data"
    described as {
      |State data for available equipment.
    }
  }
  record AssignedEquipmentData is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    equipmentType: EquipmentType with {
      briefly "Type"
      described as {
        |Equipment type.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Equipment name.
      }
    }
    make: String(1,100) with {
      briefly "Make"
      described as {
        |Manufacturer.
      }
    }
    model: String(1,100) with {
      briefly "Model"
      described as {
        |Model.
      }
    }
    serialNumber: String(1,50) with {
      briefly "Serial"
      described as {
        |Serial number.
      }
    }
    currentAssignment: Assignment with {
      briefly "Assignment"
      described as {
        |Current assignment.
      }
    }
    location: Location with {
      briefly "Location"
      described as {
        |Current location.
      }
    }
    lastReading: MeterReading? with {
      briefly "Reading"
      described as {
        |Last meter reading.
      }
    }
    maintenanceHistory: MaintenanceRecord+ with {
      briefly "History"
      described as {
        |Maintenance records.
      }
    }
  } with {
    briefly "Assigned equipment data"
    described as {
      |State data for assigned equipment.
    }
  }
  record MaintenanceEquipmentData is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    equipmentType: EquipmentType with {
      briefly "Type"
      described as {
        |Equipment type.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Equipment name.
      }
    }
    scheduledWork: String(1,1000) with {
      briefly "Work"
      described as {
        |Scheduled work.
      }
    }
    scheduledDate: Date with {
      briefly "Scheduled"
      described as {
        |Scheduled date.
      }
    }
    maintenanceHistory: MaintenanceRecord+ with {
      briefly "History"
      described as {
        |Maintenance records.
      }
    }
  } with {
    briefly "Maintenance equipment data"
    described as {
      |State data for equipment in maintenance.
    }
  }
  record OutOfServiceEquipmentData is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    equipmentType: EquipmentType with {
      briefly "Type"
      described as {
        |Equipment type.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Equipment name.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Out of service reason.
      }
    }
    outOfServiceSince: TimeStamp with {
      briefly "Since"
      described as {
        |When went out of service.
      }
    }
  } with {
    briefly "Out of service equipment data"
    described as {
      |State data for non-operational equipment.
    }
  }
  record DisposedEquipmentData is  {
    equipmentId: EquipmentId with {
      briefly "Equipment"
      described as {
        |Equipment ID.
      }
    }
    name: String(1,200) with {
      briefly "Name"
      described as {
        |Equipment name.
      }
    }
    disposalType: String(1,50) with {
      briefly "Type"
      described as {
        |Disposal type.
      }
    }
    disposedAt: TimeStamp with {
      briefly "Disposed"
      described as {
        |Disposal time.
      }
    }
  } with {
    briefly "Disposed equipment data"
    described as {
      |State data for disposed equipment.
    }
  }
  // States
  state AvailableState of type Equipment.AvailableEquipmentData
  state AssignedState of type Equipment.AssignedEquipmentData
  state MaintenanceState of type Equipment.MaintenanceEquipmentData
  state OutOfServiceState of type Equipment.OutOfServiceEquipmentData
  state DisposedState of type Equipment.DisposedEquipmentData
  // Handler
  handler EquipmentHandler is {
    on command RegisterEquipment is {
      morph entity EquipmentContext.Equipment to state EquipmentContext.Equipment.AvailableState with command RegisterEquipment
      tell event EquipmentRegistered to entity EquipmentContext.Equipment
    }
    on command AssignToSite is {
      morph entity EquipmentContext.Equipment to state EquipmentContext.Equipment.AssignedState with command AssignToSite
      tell event EquipmentAssigned to entity EquipmentContext.Equipment
    }
    on command ReturnFromSite is {
      morph entity EquipmentContext.Equipment to state EquipmentContext.Equipment.AvailableState with command ReturnFromSite
      tell event EquipmentReturned to entity EquipmentContext.Equipment
    }
    on command UpdateLocation is {
      tell event LocationUpdated to entity EquipmentContext.Equipment
    }
    on command RecordMeterReading is {
      tell event MeterReadingRecorded to entity EquipmentContext.Equipment
    }
    on command ScheduleMaintenance is {
      morph entity EquipmentContext.Equipment to state EquipmentContext.Equipment.MaintenanceState with command ScheduleMaintenance
      tell event MaintenanceScheduled to entity EquipmentContext.Equipment
    }
    on command CompleteMaintenance is {
      morph entity EquipmentContext.Equipment to state EquipmentContext.Equipment.AvailableState with command CompleteMaintenance
      tell event MaintenanceCompleted to entity EquipmentContext.Equipment
    }
    on command MarkOutOfService is {
      morph entity EquipmentContext.Equipment to state EquipmentContext.Equipment.OutOfServiceState with command MarkOutOfService
      tell event MarkedOutOfService to entity EquipmentContext.Equipment
    }
    on command ReturnToService is {
      morph entity EquipmentContext.Equipment to state EquipmentContext.Equipment.AvailableState with command ReturnToService
      tell event ReturnedToService to entity EquipmentContext.Equipment
    }
    on command DisposeEquipment is {
      morph entity EquipmentContext.Equipment to state EquipmentContext.Equipment.DisposedState with command DisposeEquipment
      tell event EquipmentDisposed to entity EquipmentContext.Equipment
    }
  } with {
    briefly "Processes equipment commands"
    described as {
      | Handles equipment lifecycle including registration,
      | assignment, maintenance, and disposal.
    }
  }
} with {
  briefly "Equipment aggregate"
  described as {
    | The Equipment entity manages construction equipment
    | lifecycle, location tracking, and maintenance history.
  }
}
