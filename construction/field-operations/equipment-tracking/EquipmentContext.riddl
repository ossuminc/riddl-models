// Equipment Tracking - Equipment Context

context EquipmentContext is {

  include "types.riddl"
  include "Equipment.riddl"

  // Adaptor for GPS tracking integration
  adaptor GPSAdapter from context GPSTrackingService is {
    handler GPSEvents is {
      on event GPSTrackingService.LocationPing {
        prompt "Update equipment location from GPS"
      }
    } with {
      briefly "Handles GPS events"
      described by "Processes GPS location updates."
    }
  } with {
    briefly "GPS tracking integration"
    described by "Receives GPS location data."
  }

  // Adaptor for maintenance system integration
  adaptor MaintenanceAdapter to context MaintenanceService is {
    handler MaintenanceIntegration is {
      on event Equipment.MaintenanceScheduled {
        prompt "Create work order in maintenance system"
      }
    } with {
      briefly "Handles maintenance events"
      described by "Creates external work orders."
    }
  } with {
    briefly "Maintenance system integration"
    described by "Integrates with maintenance management."
  }

  // Repository for equipment persistence
  repository EquipmentRepository is {
    schema EquipmentData is relational
      of equipment as Equipment
      index on field Equipment.equipmentId
      index on field Equipment.equipmentType

    handler EquipmentPersistence is {
      on command Equipment.RegisterEquipment {
        prompt "Store new equipment record"
      }
      on command Equipment.AssignToSite {
        prompt "Update equipment assignment"
      }
      on command Equipment.ReturnFromSite {
        prompt "Update equipment as available"
      }
      on command Equipment.UpdateLocation {
        prompt "Update equipment location"
      }
      on command Equipment.CompleteMaintenance {
        prompt "Update maintenance history"
      }
      on command Equipment.DisposeEquipment {
        prompt "Archive equipment record"
      }
    } with {
      briefly "Persists equipment commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Equipment data persistence"
    described by {
      | The EquipmentRepository provides persistent storage for
      | equipment records and location history.
    }
  }

  // Projector for fleet analytics
  projector FleetAnalytics is {
    updates repository EquipmentRepository

    record FleetUtilization is {
      equipmentType is EquipmentType with { briefly "Type" described by "Equipment type." }
      totalCount is Natural with { briefly "Total" described by "Total equipment." }
      assignedCount is Natural with { briefly "Assigned" described by "Currently assigned." }
      maintenanceCount is Natural with { briefly "Maintenance" described by "In maintenance." }
      utilizationRate is Decimal(5, 2) with { briefly "Rate" described by "Utilization percentage." }
    } with {
      briefly "Fleet utilization"
      described by "Equipment utilization metrics."
    }

    handler AnalyticsHandler is {
      on event Equipment.EquipmentAssigned {
        prompt "Update utilization metrics"
      }
      on event Equipment.EquipmentReturned {
        prompt "Update utilization metrics"
      }
      on event Equipment.MaintenanceScheduled {
        prompt "Update maintenance metrics"
      }
    } with {
      briefly "Maintains fleet analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Fleet analytics projections"
    described by "Maintains fleet utilization data."
  }

} with {
  briefly "Bounded context for equipment tracking"
  described by {
    | The EquipmentContext is the bounded context for construction
    | equipment management including tracking, allocation, and maintenance.
  }
}
