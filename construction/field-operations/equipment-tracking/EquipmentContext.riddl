// Equipment Tracking - Equipment Context
context EquipmentContext is {
  include "types.riddl"
  include "Equipment.riddl"
  // Adaptor for GPS tracking integration
  adaptor GPSAdapter from context GPSTrackingService is { 
    handler GPSEvents is {
      on event GPSTrackingService.LocationPing is {
        prompt "Update equipment location from GPS"
      }
    } with {
      briefly "Handles GPS events"
      described as {
        |Processes GPS location updates.
      }
    }
  } with {
    briefly "GPS tracking integration"
    described as {
      |Receives GPS location data.
    }
  }
  // Adaptor for maintenance system integration
  adaptor MaintenanceAdapter to context MaintenanceService is { 
    handler MaintenanceIntegration is {
      on command MaintenanceService.CreateWorkOrder is {
        prompt "Create work order in maintenance system"
      }
    } with {
      briefly "Handles maintenance commands"
      described as {
        |Creates external work orders.
      }
    }
  } with {
    briefly "Maintenance system integration"
    described as {
      |Integrates with maintenance management.
    }
  }
  // Repository for equipment persistence
  repository EquipmentRepository is {
    schema EquipmentData is relational
      of equipment as type Equipment
        index on field Equipment.equipmentId
        index on field Equipment.equipmentType

    handler EquipmentPersistence is {
      on command Equipment.RegisterEquipment is {
        prompt "Store new equipment record"
      }
      on command Equipment.AssignToSite is {
        prompt "Update equipment assignment"
      }
      on command Equipment.ReturnFromSite is {
        prompt "Update equipment as available"
      }
      on command Equipment.UpdateLocation is {
        prompt "Update equipment location"
      }
      on command Equipment.CompleteMaintenance is {
        prompt "Update maintenance history"
      }
      on command Equipment.DisposeEquipment is {
        prompt "Archive equipment record"
      }
    } with {
      briefly "Persists equipment commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Equipment data persistence"
    described as {
      | The EquipmentRepository provides persistent storage for
      | equipment records and location history.
    }
  }
  // Projector for fleet analytics
  projector FleetAnalytics is {
    record FleetUtilization is  {
      equipmentType: EquipmentType with {
        briefly "Type"
        described as {
          |Equipment type.
        }
      }
      totalCount: Natural with {
        briefly "Total"
        described as {
          |Total equipment.
        }
      }
      assignedCount: Natural with {
        briefly "Assigned"
        described as {
          |Currently assigned.
        }
      }
      maintenanceCount: Natural with {
        briefly "Maintenance"
        described as {
          |In maintenance.
        }
      }
      utilizationRate: Decimal(5,2) with {
        briefly "Rate"
        described as {
          |Utilization percentage.
        }
      }
    } with {
      briefly "Fleet utilization"
      described as {
        |Equipment utilization metrics.
      }
    }
    handler AnalyticsHandler is {
      on event Equipment.EquipmentAssigned is {
        prompt "Update utilization metrics"
      }
      on event Equipment.EquipmentReturned is {
        prompt "Update utilization metrics"
      }
      on event Equipment.MaintenanceScheduled is {
        prompt "Update maintenance metrics"
      }
    } with {
      briefly "Maintains fleet analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Fleet analytics projections"
    described as {
      |Maintains fleet utilization data.
    }
  }
} with {
  briefly "Bounded context for equipment tracking"
  described as {
    | The EquipmentContext is the bounded context for construction
    | equipment management including tracking, allocation, and maintenance.
  }
}
