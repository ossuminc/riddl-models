// Job Site Management - JobSite Context

context JobSiteContext is {

  include "types.riddl"
  include "JobSite.riddl"

  // Adaptor for weather service integration
  adaptor WeatherAdapter from context WeatherService is {
    handler WeatherEvents is {
      on event WeatherService.WeatherAlert {
        prompt "Notify site of weather conditions"
      }
    } with {
      briefly "Handles weather events"
      described by "Processes weather alerts for sites."
    }
  } with {
    briefly "Weather service integration"
    described by "Receives weather data and alerts."
  }

  // Adaptor for project service integration
  adaptor ProjectAdapter from context ProjectService is {
    handler ProjectEvents is {
      on event ProjectService.ProjectUpdated {
        prompt "Update site with project changes"
      }
    } with {
      briefly "Handles project events"
      described by "Syncs site with project updates."
    }
  } with {
    briefly "Project service integration"
    described by "Receives project updates."
  }

  // Repository for job site persistence
  repository JobSiteRepository is {
    schema JobSiteData is relational
      of sites as JobSite
      index on field JobSite.jobSiteId
      index on field JobSite.projectId

    handler JobSitePersistence is {
      on command JobSite.EstablishSite {
        prompt "Store new job site record"
      }
      on command JobSite.ActivateSite {
        prompt "Update site status to active"
      }
      on command JobSite.SubmitDailyReport {
        prompt "Store daily report"
      }
      on command JobSite.RecordSafetyInspection {
        prompt "Store inspection record"
      }
      on command JobSite.ReportIssue {
        prompt "Store issue record"
      }
      on command JobSite.CloseSite {
        prompt "Archive site record"
      }
    } with {
      briefly "Persists job site events"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Job site data persistence"
    described by {
      | The JobSiteRepository provides persistent storage for
      | job sites, daily reports, and inspections.
    }
  }

  // Projector for site analytics
  projector SiteAnalytics is {
    updates repository JobSiteRepository

    record SiteSummary is {
      jobSiteId is JobSiteId with { briefly "Site" described by "Site ID." }
      totalLaborHours is Decimal(10, 2) with { briefly "Hours" described by "Total labor hours." }
      openIssueCount is Natural with { briefly "Issues" described by "Open issue count." }
      lastInspectionDate is optional Date with { briefly "Inspection" described by "Last inspection." }
      inspectionStatus is optional InspectionStatus with { briefly "Status" described by "Last inspection status." }
    } with {
      briefly "Site summary"
      described by "Job site summary metrics."
    }

    handler AnalyticsHandler is {
      on event JobSite.DailyReportSubmitted {
        prompt "Update labor hour totals"
      }
      on event JobSite.IssueReported {
        prompt "Increment open issue count"
      }
      on event JobSite.IssueResolved {
        prompt "Decrement open issue count"
      }
      on event JobSite.SafetyInspectionRecorded {
        prompt "Update inspection metrics"
      }
    } with {
      briefly "Maintains site analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Site analytics projections"
    described by "Maintains job site analytics data."
  }

} with {
  briefly "Bounded context for job site management"
  described by {
    | The JobSiteContext is the bounded context for construction
    | job site operations including reporting and safety.
  }
}
