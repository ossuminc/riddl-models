// Job Site Management - JobSite Context
context JobSiteContext is {
  include "types.riddl"
  include "JobSite.riddl"
  // Adaptor for weather service integration
  adaptor WeatherAdapter from context WeatherService is { 
    handler WeatherEvents is {
      on event WeatherService.WeatherAlert is {
        prompt "Notify site of weather conditions"
      }
    } with {
      briefly "Handles weather events"
      described as {
        |Processes weather alerts for sites.
      }
    }
  } with {
    briefly "Weather service integration"
    described as {
      |Receives weather data and alerts.
    }
  }
  // Adaptor for project service integration
  adaptor ProjectAdapter from context ProjectService is { 
    handler ProjectEvents is {
      on event ProjectService.ProjectUpdated is {
        prompt "Update site with project changes"
      }
    } with {
      briefly "Handles project events"
      described as {
        |Syncs site with project updates.
      }
    }
  } with {
    briefly "Project service integration"
    described as {
      |Receives project updates.
    }
  }
  // Repository for job site persistence
  repository JobSiteRepository is {
    schema JobSiteData is relational
      of sites as type JobSite
        index on field JobSite.jobSiteId
        index on field JobSite.projectId

    handler JobSitePersistence is {
      on command JobSite.EstablishSite is {
        prompt "Store new job site record"
      }
      on command JobSite.ActivateSite is {
        prompt "Update site status to active"
      }
      on command JobSite.SubmitDailyReport is {
        prompt "Store daily report"
      }
      on command JobSite.RecordSafetyInspection is {
        prompt "Store inspection record"
      }
      on command JobSite.ReportIssue is {
        prompt "Store issue record"
      }
      on command JobSite.CloseSite is {
        prompt "Archive site record"
      }
    } with {
      briefly "Persists job site events"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Job site data persistence"
    described as {
      | The JobSiteRepository provides persistent storage for
      | job sites, daily reports, and inspections.
    }
  }
  // Projector for site analytics
  projector SiteAnalytics is {
    record SiteSummary is  {
      jobSiteId: JobSiteId with {
        briefly "Site"
        described as {
          |Site ID.
        }
      }
      totalLaborHours: Decimal(10,2) with {
        briefly "Hours"
        described as {
          |Total labor hours.
        }
      }
      openIssueCount: Natural with {
        briefly "Issues"
        described as {
          |Open issue count.
        }
      }
      lastInspectionDate: Date? with {
        briefly "Inspection"
        described as {
          |Last inspection.
        }
      }
      inspectionStatus: InspectionStatus? with {
        briefly "Status"
        described as {
          |Last inspection status.
        }
      }
    } with {
      briefly "Site summary"
      described as {
        |Job site summary metrics.
      }
    }
    handler AnalyticsHandler is {
      on event JobSite.DailyReportSubmitted is {
        prompt "Update labor hour totals"
      }
      on event JobSite.IssueReported is {
        prompt "Increment open issue count"
      }
      on event JobSite.IssueResolved is {
        prompt "Decrement open issue count"
      }
      on event JobSite.SafetyInspectionRecorded is {
        prompt "Update inspection metrics"
      }
    } with {
      briefly "Maintains site analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Site analytics projections"
    described as {
      |Maintains job site analytics data.
    }
  }
} with {
  briefly "Bounded context for job site management"
  described as {
    | The JobSiteContext is the bounded context for construction
    | job site operations including reporting and safety.
  }
}
