// Job Site Management - External Contexts
// Weather Service - Weather data and alerts
context WeatherService is {
  event WeatherAlert is  {
    alertId: UUID with {
      briefly "Alert"
      described as {
        |Alert ID.
      }
    }
    location: Location with {
      briefly "Location"
      described as {
        |Affected location.
      }
    }
    condition: WeatherCondition with {
      briefly "Condition"
      described as {
        |Weather condition.
      }
    }
    alertSeverity: String(1,20) with {
      briefly "Severity"
      described as {
        |Alert severity.
      }
    }
    message: String(1,500) with {
      briefly "Message"
      described as {
        |Alert message.
      }
    }
    effectiveFrom: TimeStamp with {
      briefly "From"
      described as {
        |Alert start.
      }
    }
    effectiveUntil: TimeStamp with {
      briefly "Until"
      described as {
        |Alert end.
      }
    }
  } with {
    briefly "Weather alert"
    described as {
      |Emitted when weather conditions affect site.
    }
  }
  event ForecastUpdated is  {
    location: Location with {
      briefly "Location"
      described as {
        |Forecast location.
      }
    }
    forecastDate: Date with {
      briefly "Date"
      described as {
        |Forecast date.
      }
    }
    highTemp: Integer with {
      briefly "High"
      described as {
        |High temperature.
      }
    }
    lowTemp: Integer with {
      briefly "Low"
      described as {
        |Low temperature.
      }
    }
    precipitation: Natural with {
      briefly "Precip"
      described as {
        |Precipitation chance.
      }
    }
    condition: WeatherCondition with {
      briefly "Condition"
      described as {
        |Expected condition.
      }
    }
  } with {
    briefly "Forecast was updated"
    described as {
      |Emitted when forecast changes.
    }
  }
} with {
  option external()
  briefly "External weather service"
  described as {
    |External weather data provider.
  }
}
// Project Service - Project management
context ProjectService is {
  event ProjectUpdated is  {
    projectId: ProjectId with {
      briefly "Project"
      described as {
        |Project ID.
      }
    }
    updateType: String(1,50) with {
      briefly "Type"
      described as {
        |Update type.
      }
    }
    description: String(1,500) with {
      briefly "Description"
      described as {
        |Update description.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Project was updated"
    described as {
      |Emitted when project details change.
    }
  }
  event ScheduleChanged is  {
    projectId: ProjectId with {
      briefly "Project"
      described as {
        |Project ID.
      }
    }
    newEndDate: Date with {
      briefly "End date"
      described as {
        |New project end date.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Change reason.
      }
    }
  } with {
    briefly "Schedule was changed"
    described as {
      |Emitted when project schedule changes.
    }
  }
} with {
  option external()
  briefly "External project service"
  described as {
    |External project management system.
  }
}
// Notification Service - Site communications
context NotificationService is {
  command SendSiteAlert is  {
    jobSiteId: JobSiteId with {
      briefly "Site"
      described as {
        |Site ID.
      }
    }
    alertType: String(1,50) with {
      briefly "Type"
      described as {
        |Alert type.
      }
    }
    message: String(1,1000) with {
      briefly "Message"
      described as {
        |Alert message.
      }
    }
    priority: String(1,20) with {
      briefly "Priority"
      described as {
        |Priority level.
      }
    }
    recipients: String(1,100)+ with {
      briefly "Recipients"
      described as {
        |Alert recipients.
      }
    }
  } with {
    briefly "Send site alert"
    described as {
      |Sends alert notification to site personnel.
    }
  }
  command SendDailyReportNotification is  {
    jobSiteId: JobSiteId with {
      briefly "Site"
      described as {
        |Site ID.
      }
    }
    reportDate: Date with {
      briefly "Date"
      described as {
        |Report date.
      }
    }
    summary: String(1,500) with {
      briefly "Summary"
      described as {
        |Report summary.
      }
    }
    recipients: String(1,100)+ with {
      briefly "Recipients"
      described as {
        |Notification recipients.
      }
    }
  } with {
    briefly "Send daily report notification"
    described as {
      |Notifies stakeholders of daily report.
    }
  }
  event AlertSent is  {
    alertId: UUID with {
      briefly "Alert"
      described as {
        |Alert ID.
      }
    }
    jobSiteId: JobSiteId with {
      briefly "Site"
      described as {
        |Site ID.
      }
    }
    sentAt: TimeStamp with {
      briefly "Sent"
      described as {
        |Send time.
      }
    }
  } with {
    briefly "Alert was sent"
    described as {
      |Emitted when notification is delivered.
    }
  }
} with {
  option external()
  briefly "External notification service"
  described as {
    |External communications service.
  }
}
// Safety Compliance Service - Regulatory compliance
context SafetyComplianceService is {
  command SubmitInspectionReport is  {
    jobSiteId: JobSiteId with {
      briefly "Site"
      described as {
        |Site ID.
      }
    }
    inspection: SafetyInspection with {
      briefly "Inspection"
      described as {
        |Inspection data.
      }
    }
  } with {
    briefly "Submit inspection report"
    described as {
      |Submits inspection to compliance system.
    }
  }
  event ComplianceStatusUpdated is  {
    jobSiteId: JobSiteId with {
      briefly "Site"
      described as {
        |Site ID.
      }
    }
    complianceStatus: String(1,50) with {
      briefly "Status"
      described as {
        |Compliance status.
      }
    }
    violations: Natural with {
      briefly "Violations"
      described as {
        |Violation count.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Compliance status was updated"
    described as {
      |Emitted when compliance status changes.
    }
  }
} with {
  option external()
  briefly "External safety compliance"
  described as {
    |External safety compliance system.
  }
}
