// Construction Project - Project Context
context ProjectContext is {
  include "types.riddl"
  include "Project.riddl"
  // Repository for project persistence
  repository ProjectRepository is {
    schema ProjectData is relational
      of projects as type Project
        index on field Project.projectId

    handler ProjectPersistence is {
      on command Project.CreateProject is {
        prompt "Store new project record"
      }
      on command Project.StartProject is {
        prompt "Update project as in progress"
      }
      on command Project.UpdateTaskProgress is {
        prompt "Update task progress"
      }
      on command Project.UpdateBudget is {
        prompt "Update budget record"
      }
      on command Project.CompleteProject is {
        prompt "Update project as completed"
      }
    } with {
      briefly "Persists project commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Project data persistence"
    described as {
      | The ProjectRepository provides persistent storage for
      | construction projects and their tasks.
    }
  }
  // Projector for project analytics
  projector ProjectAnalytics is {
    record ProjectSummary is  {
      projectId: ProjectId with {
        briefly "Project"
        described as {
          |Project ID.
        }
      }
      percentComplete: Natural with {
        briefly "Complete"
        described as {
          |Overall completion %.
        }
      }
      budgetVariance: Money with {
        briefly "Budget variance"
        described as {
          |Budget over/under.
        }
      }
      scheduleVariance: Integer with {
        briefly "Schedule variance"
        described as {
          |Days ahead/behind.
        }
      }
      openChangeOrders: Natural with {
        briefly "Open COs"
        described as {
          |Pending change orders.
        }
      }
    } with {
      briefly "Project summary"
      described as {
        |Project metrics summary.
      }
    }
    handler AnalyticsHandler is {
      on event Project.TaskProgressUpdated is {
        prompt "Recalculate project completion percentage"
      }
      on event Project.BudgetUpdated is {
        prompt "Update budget variance"
      }
      on event Project.ChangeOrderApproved is {
        prompt "Update change order metrics"
      }
    } with {
      briefly "Maintains project analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Project analytics projections"
    described as {
      |Maintains project analytics data.
    }
  }
} with {
  briefly "Bounded context for construction projects"
  described as {
    | The ProjectContext is the bounded context for construction
    | project management including planning and tracking.
  }
}
