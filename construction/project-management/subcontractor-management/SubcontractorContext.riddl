// Subcontractor Management - Subcontractor Context
context SubcontractorContext is {
  include "types.riddl"
  include "Subcontractor.riddl"
  // Repository for subcontractor persistence
  repository SubcontractorRepository is {
    schema SubcontractorData is relational
      of subcontractors as type Subcontractor
        index on field Subcontractor.subcontractorId

    handler SubcontractorPersistence is {
      on command Subcontractor.RegisterSubcontractor is {
        prompt "Store new subcontractor record"
      }
      on command Subcontractor.ApproveSubcontractor is {
        prompt "Update status to approved"
      }
      on command Subcontractor.AwardSubcontract is {
        prompt "Store subcontract record"
      }
      on command Subcontractor.ApprovePayApplication is {
        prompt "Update pay application status"
      }
      on command Subcontractor.RatePerformance is {
        prompt "Store performance rating"
      }
    } with {
      briefly "Persists subcontractor commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Subcontractor data persistence"
    described as {
      | The SubcontractorRepository provides persistent storage for
      | subcontractors, contracts, and performance history.
    }
  }
  // Projector for subcontractor analytics
  projector SubcontractorAnalytics is {
    record SubcontractorSummary is  {
      subcontractorId: SubcontractorId with {
        briefly "Subcontractor"
        described as {
          |Subcontractor ID.
        }
      }
      activeContracts: Natural with {
        briefly "Contracts"
        described as {
          |Active contract count.
        }
      }
      totalContractValue: Money with {
        briefly "Value"
        described as {
          |Total contract value.
        }
      }
      averageRating: Decimal(3,2) with {
        briefly "Rating"
        described as {
          |Average rating.
        }
      }
      pendingPayments: Money with {
        briefly "Pending"
        described as {
          |Pending payment amount.
        }
      }
    } with {
      briefly "Subcontractor summary"
      described as {
        |Subcontractor metrics summary.
      }
    }
    handler AnalyticsHandler is {
      on event Subcontractor.SubcontractAwarded is {
        prompt "Update contract metrics"
      }
      on event Subcontractor.PayApplicationApproved is {
        prompt "Update payment metrics"
      }
      on event Subcontractor.PerformanceRated is {
        prompt "Update rating average"
      }
    } with {
      briefly "Maintains subcontractor analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Subcontractor analytics projections"
    described as {
      |Maintains subcontractor analytics data.
    }
  }
} with {
  briefly "Bounded context for subcontractor management"
  described as {
    | The SubcontractorContext is the bounded context for
    | subcontractor relationships and performance tracking.
  }
}
