// Subcontractor Management - Subcontractor Context

context SubcontractorContext is {

  include "types.riddl"
  include "Subcontractor.riddl"

  // Repository for subcontractor persistence
  repository SubcontractorRepository is {
    schema SubcontractorData is relational
      of subcontractors as Subcontractor
      index on field Subcontractor.subcontractorId

    handler SubcontractorPersistence is {
      on command Subcontractor.RegisterSubcontractor {
        prompt "Store new subcontractor record"
      }
      on command Subcontractor.ApproveSubcontractor {
        prompt "Update status to approved"
      }
      on command Subcontractor.AwardSubcontract {
        prompt "Store subcontract record"
      }
      on command Subcontractor.ApprovePayApplication {
        prompt "Update pay application status"
      }
      on command Subcontractor.RatePerformance {
        prompt "Store performance rating"
      }
    } with {
      briefly "Persists subcontractor commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Subcontractor data persistence"
    described by {
      | The SubcontractorRepository provides persistent storage for
      | subcontractors, contracts, and performance history.
    }
  }

  // Projector for subcontractor analytics
  projector SubcontractorAnalytics is {
    updates repository SubcontractorRepository

    record SubcontractorSummary is {
      subcontractorId is SubcontractorId with { briefly "Subcontractor" described by "Subcontractor ID." }
      activeContracts is Natural with { briefly "Contracts" described by "Active contract count." }
      totalContractValue is Money with { briefly "Value" described by "Total contract value." }
      averageRating is Decimal(3, 2) with { briefly "Rating" described by "Average rating." }
      pendingPayments is Money with { briefly "Pending" described by "Pending payment amount." }
    } with {
      briefly "Subcontractor summary"
      described by "Subcontractor metrics summary."
    }

    handler AnalyticsHandler is {
      on event Subcontractor.SubcontractAwarded {
        prompt "Update contract metrics"
      }
      on event Subcontractor.PayApplicationApproved {
        prompt "Update payment metrics"
      }
      on event Subcontractor.PerformanceRated {
        prompt "Update rating average"
      }
    } with {
      briefly "Maintains subcontractor analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Subcontractor analytics projections"
    described by "Maintains subcontractor analytics data."
  }

} with {
  briefly "Bounded context for subcontractor management"
  described by {
    | The SubcontractorContext is the bounded context for
    | subcontractor relationships and performance tracking.
  }
}
