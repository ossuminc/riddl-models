// Property Management - Property Context

context PropertyContext is {

  include "types.riddl"
  include "Property.riddl"

  // Repository for property persistence
  repository PropertyRepository is {
    schema PropertyData is relational
      of properties as Property
      index on field Property.propertyId

    handler PropertyPersistence is {
      on command Property.AddProperty {
        prompt "Store new property record"
      }
      on command Property.ApproveLease {
        prompt "Store lease and update unit status"
      }
      on command Property.RecordPayment {
        prompt "Store rent payment"
      }
      on command Property.SubmitMaintenanceRequest {
        prompt "Store maintenance request"
      }
      on command Property.CompleteMaintenanceRequest {
        prompt "Update request as completed"
      }
    } with {
      briefly "Persists property commands"
      described by "Handles command-driven persistence."
    }
  } with {
    briefly "Property data persistence"
    described by {
      | The PropertyRepository provides persistent storage for
      | properties, leases, and maintenance records.
    }
  }

  // Projector for property analytics
  projector PropertyAnalytics is {
    updates repository PropertyRepository

    record PropertySummary is {
      propertyId is PropertyId with { briefly "Property" described by "Property ID." }
      occupancyRate is Decimal(5, 2) with { briefly "Occupancy" described by "Occupancy percentage." }
      monthlyRevenue is Money with { briefly "Revenue" described by "Monthly revenue." }
      openMaintenanceCount is Natural with { briefly "Maintenance" described by "Open requests." }
      delinquentCount is Natural with { briefly "Delinquent" described by "Delinquent accounts." }
    } with {
      briefly "Property summary"
      described by "Property metrics summary."
    }

    handler AnalyticsHandler is {
      on event Property.LeaseApproved {
        prompt "Update occupancy rate"
      }
      on event Property.LeaseTerminated {
        prompt "Update occupancy rate"
      }
      on event Property.PaymentRecorded {
        prompt "Update revenue metrics"
      }
      on event Property.MaintenanceRequestSubmitted {
        prompt "Increment open request count"
      }
    } with {
      briefly "Maintains property analytics"
      described by "Projects events into analytics views."
    }
  } with {
    briefly "Property analytics projections"
    described by "Maintains property analytics data."
  }

} with {
  briefly "Bounded context for property management"
  described by {
    | The PropertyContext is the bounded context for property
    | management including leasing and maintenance.
  }
}
