// Property Management - Property Context
context PropertyContext is {
  include "types.riddl"
  include "Property.riddl"
  // Repository for property persistence
  repository PropertyRepository is {
    schema PropertyData is relational
      of properties as type Property
        index on field Property.propertyId

    handler PropertyPersistence is {
      on command Property.AddProperty is {
        prompt "Store new property record"
      }
      on command Property.ApproveLease is {
        prompt "Store lease and update unit status"
      }
      on command Property.RecordPayment is {
        prompt "Store rent payment"
      }
      on command Property.SubmitMaintenanceRequest is {
        prompt "Store maintenance request"
      }
      on command Property.CompleteMaintenanceRequest is {
        prompt "Update request as completed"
      }
    } with {
      briefly "Persists property commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Property data persistence"
    described as {
      | The PropertyRepository provides persistent storage for
      | properties, leases, and maintenance records.
    }
  }
  // Projector for property analytics
  projector PropertyAnalytics is {
    record PropertySummary is  {
      propertyId: PropertyId with {
        briefly "Property"
        described as {
          |Property ID.
        }
      }
      occupancyRate: Decimal(5,2) with {
        briefly "Occupancy"
        described as {
          |Occupancy percentage.
        }
      }
      monthlyRevenue: Money with {
        briefly "Revenue"
        described as {
          |Monthly revenue.
        }
      }
      openMaintenanceCount: Natural with {
        briefly "Maintenance"
        described as {
          |Open requests.
        }
      }
      delinquentCount: Natural with {
        briefly "Delinquent"
        described as {
          |Delinquent accounts.
        }
      }
    } with {
      briefly "Property summary"
      described as {
        |Property metrics summary.
      }
    }
    handler AnalyticsHandler is {
      on event Property.LeaseApproved is {
        prompt "Update occupancy rate"
      }
      on event Property.LeaseTerminated is {
        prompt "Update occupancy rate"
      }
      on event Property.PaymentRecorded is {
        prompt "Update revenue metrics"
      }
      on event Property.MaintenanceRequestSubmitted is {
        prompt "Increment open request count"
      }
    } with {
      briefly "Maintains property analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Property analytics projections"
    described as {
      |Maintains property analytics data.
    }
  }
} with {
  briefly "Bounded context for property management"
  described as {
    | The PropertyContext is the bounded context for property
    | management including leasing and maintenance.
  }
}
