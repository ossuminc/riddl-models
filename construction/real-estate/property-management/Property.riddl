// Property Management - Property Entity
entity Property is {
  // Commands
  command AddProperty is  {
    propertyId: PropertyId with {
      briefly "Property ID"
      described as {
        |New property identifier.
      }
    }
    info: PropertyInfo with {
      briefly "Info"
      described as {
        |Property information.
      }
    }
    units: Unit+ with {
      briefly "Units"
      described as {
        |Property units.
      }
    }
  } with {
    briefly "Add property"
    described as {
      |Adds a new property to portfolio.
    }
  }
  command AddUnit is  {
    propertyId: PropertyId with {
      briefly "Property ID"
      described as {
        |Property ID.
      }
    }
    unit: Unit with {
      briefly "Unit"
      described as {
        |Unit to add.
      }
    }
  } with {
    briefly "Add unit"
    described as {
      |Adds a unit to property.
    }
  }
  command UpdateUnit is  {
    propertyId: PropertyId with {
      briefly "Property ID"
      described as {
        |Property ID.
      }
    }
    unit: Unit with {
      briefly "Unit"
      described as {
        |Updated unit.
      }
    }
  } with {
    briefly "Update unit"
    described as {
      |Updates unit details.
    }
  }
  command ApproveLease is  {
    propertyId: PropertyId with {
      briefly "Property ID"
      described as {
        |Property ID.
      }
    }
    lease: Lease with {
      briefly "Lease"
      described as {
        |Lease to approve.
      }
    }
    tenant: TenantInfo with {
      briefly "Tenant"
      described as {
        |Tenant information.
      }
    }
  } with {
    briefly "Approve lease"
    described as {
      |Approves a lease application.
    }
  }
  command RenewLease is  {
    propertyId: PropertyId with {
      briefly "Property ID"
      described as {
        |Property ID.
      }
    }
    leaseId: LeaseId with {
      briefly "Lease ID"
      described as {
        |Lease to renew.
      }
    }
    newEndDate: Date with {
      briefly "End date"
      described as {
        |New lease end date.
      }
    }
    newRent: Money with {
      briefly "New rent"
      described as {
        |New monthly rent.
      }
    }
  } with {
    briefly "Renew lease"
    described as {
      |Renews an existing lease.
    }
  }
  command TerminateLease is  {
    propertyId: PropertyId with {
      briefly "Property ID"
      described as {
        |Property ID.
      }
    }
    leaseId: LeaseId with {
      briefly "Lease ID"
      described as {
        |Lease to terminate.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Termination reason.
      }
    }
    effectiveDate: Date with {
      briefly "Effective"
      described as {
        |Termination date.
      }
    }
  } with {
    briefly "Terminate lease"
    described as {
      |Terminates a lease early.
    }
  }
  command RecordPayment is  {
    propertyId: PropertyId with {
      briefly "Property ID"
      described as {
        |Property ID.
      }
    }
    payment: RentPayment with {
      briefly "Payment"
      described as {
        |Payment details.
      }
    }
  } with {
    briefly "Record payment"
    described as {
      |Records a rent payment.
    }
  }
  command SubmitMaintenanceRequest is  {
    propertyId: PropertyId with {
      briefly "Property ID"
      described as {
        |Property ID.
      }
    }
    request: MaintenanceRequest with {
      briefly "Request"
      described as {
        |Maintenance request.
      }
    }
  } with {
    briefly "Submit maintenance request"
    described as {
      |Submits a maintenance request.
    }
  }
  command CompleteMaintenanceRequest is  {
    propertyId: PropertyId with {
      briefly "Property ID"
      described as {
        |Property ID.
      }
    }
    requestId: UUID with {
      briefly "Request ID"
      described as {
        |Request to complete.
      }
    }
    completionNotes: String(1,1000) with {
      briefly "Notes"
      described as {
        |Completion notes.
      }
    }
    cost: Money with {
      briefly "Cost"
      described as {
        |Maintenance cost.
      }
    }
  } with {
    briefly "Complete maintenance"
    described as {
      |Marks maintenance as complete.
    }
  }
  // Events
  event PropertyAdded is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    info: PropertyInfo with {
      briefly "Info"
      described as {
        |Property info.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Property was added"
    described as {
      |Emitted when property is added.
    }
  }
  event UnitAdded is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    unit: Unit with {
      briefly "Unit"
      described as {
        |Added unit.
      }
    }
    addedAt: TimeStamp with {
      briefly "Added"
      described as {
        |Add time.
      }
    }
  } with {
    briefly "Unit was added"
    described as {
      |Emitted when unit is added.
    }
  }
  event UnitUpdated is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    unit: Unit with {
      briefly "Unit"
      described as {
        |Updated unit.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Unit was updated"
    described as {
      |Emitted when unit is updated.
    }
  }
  event LeaseApproved is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    lease: Lease with {
      briefly "Lease"
      described as {
        |Approved lease.
      }
    }
    tenant: TenantInfo with {
      briefly "Tenant"
      described as {
        |Tenant info.
      }
    }
    approvedAt: TimeStamp with {
      briefly "Approved"
      described as {
        |Approval time.
      }
    }
  } with {
    briefly "Lease was approved"
    described as {
      |Emitted when lease is approved.
    }
  }
  event LeaseRenewed is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    leaseId: LeaseId with {
      briefly "Lease"
      described as {
        |Lease ID.
      }
    }
    newEndDate: Date with {
      briefly "End"
      described as {
        |New end date.
      }
    }
    renewedAt: TimeStamp with {
      briefly "Renewed"
      described as {
        |Renewal time.
      }
    }
  } with {
    briefly "Lease was renewed"
    described as {
      |Emitted when lease is renewed.
    }
  }
  event LeaseTerminated is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    leaseId: LeaseId with {
      briefly "Lease"
      described as {
        |Lease ID.
      }
    }
    reason: String(1,500) with {
      briefly "Reason"
      described as {
        |Termination reason.
      }
    }
    terminatedAt: TimeStamp with {
      briefly "Terminated"
      described as {
        |Termination time.
      }
    }
  } with {
    briefly "Lease was terminated"
    described as {
      |Emitted when lease ends early.
    }
  }
  event PaymentRecorded is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    payment: RentPayment with {
      briefly "Payment"
      described as {
        |Payment details.
      }
    }
  } with {
    briefly "Payment was recorded"
    described as {
      |Emitted when payment is recorded.
    }
  }
  event MaintenanceRequestSubmitted is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    request: MaintenanceRequest with {
      briefly "Request"
      described as {
        |Maintenance request.
      }
    }
  } with {
    briefly "Maintenance request was submitted"
    described as {
      |Emitted when request is submitted.
    }
  }
  event MaintenanceRequestCompleted is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    requestId: UUID with {
      briefly "Request"
      described as {
        |Request ID.
      }
    }
    completedAt: TimeStamp with {
      briefly "Completed"
      described as {
        |Completion time.
      }
    }
  } with {
    briefly "Maintenance was completed"
    described as {
      |Emitted when request is done.
    }
  }
  // State Records
  record ActivePropertyData is  {
    propertyId: PropertyId with {
      briefly "Property"
      described as {
        |Property ID.
      }
    }
    info: PropertyInfo with {
      briefly "Info"
      described as {
        |Property info.
      }
    }
    units: Unit+ with {
      briefly "Units"
      described as {
        |Property units.
      }
    }
    leases: Lease+ with {
      briefly "Leases"
      described as {
        |Active leases.
      }
    }
    tenants: TenantInfo+ with {
      briefly "Tenants"
      described as {
        |Current tenants.
      }
    }
    maintenanceRequests: MaintenanceRequest+ with {
      briefly "Requests"
      described as {
        |Maintenance requests.
      }
    }
    payments: RentPayment+ with {
      briefly "Payments"
      described as {
        |Rent payments.
      }
    }
  } with {
    briefly "Active property data"
    described as {
      |State data for active property.
    }
  }
  // States
  state ActiveState of type Property.ActivePropertyData
  // Handler
  handler PropertyHandler is {
    on command AddProperty is {
      morph entity PropertyContext.Property to state PropertyContext.Property.ActiveState with command AddProperty
      tell event PropertyAdded to entity PropertyContext.Property
    }
    on command AddUnit is {
      tell event UnitAdded to entity PropertyContext.Property
    }
    on command UpdateUnit is {
      tell event UnitUpdated to entity PropertyContext.Property
    }
    on command ApproveLease is {
      tell event LeaseApproved to entity PropertyContext.Property
    }
    on command RenewLease is {
      tell event LeaseRenewed to entity PropertyContext.Property
    }
    on command TerminateLease is {
      tell event LeaseTerminated to entity PropertyContext.Property
    }
    on command RecordPayment is {
      tell event PaymentRecorded to entity PropertyContext.Property
    }
    on command SubmitMaintenanceRequest is {
      tell event MaintenanceRequestSubmitted to entity PropertyContext.Property
    }
    on command CompleteMaintenanceRequest is {
      tell event MaintenanceRequestCompleted to entity PropertyContext.Property
    }
  } with {
    briefly "Processes property commands"
    described as {
      | Handles property operations including units,
      | leases, payments, and maintenance.
    }
  }
} with {
  briefly "Property aggregate"
  described as {
    | The Property entity manages real estate properties
    | including units, leases, and maintenance.
  }
}
