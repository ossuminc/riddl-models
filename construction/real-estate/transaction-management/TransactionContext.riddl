// Transaction Management - Transaction Context
context TransactionContext is {
  include "types.riddl"
  include "Transaction.riddl"
  // Repository for transaction persistence
  repository TransactionRepository is {
    schema TransactionData is relational
      of transactions as type Transaction
        index on field Transaction.transactionId
        index on field Transaction.property.propertyId

    handler TransactionPersistence is {
      on command Transaction.InitiateTransaction is {
        prompt "Store new transaction record"
      }
      on command Transaction.SubmitOffer is {
        prompt "Store offer record"
      }
      on command Transaction.ExecuteContract is {
        prompt "Store contract record"
      }
      on command Transaction.CompleteClosing is {
        prompt "Update transaction as closed"
      }
      on command Transaction.CancelTransaction is {
        prompt "Update transaction as cancelled"
      }
    } with {
      briefly "Persists transaction commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Transaction data persistence"
    described as {
      | The TransactionRepository provides persistent storage for
      | real estate transactions and related documents.
    }
  }
  // Projector for transaction analytics
  projector TransactionAnalytics is {
    record TransactionSummary is  {
      periodStart: Date with {
        briefly "Start"
        described as {
          |Period start.
        }
      }
      periodEnd: Date with {
        briefly "End"
        described as {
          |Period end.
        }
      }
      totalTransactions: Natural with {
        briefly "Total"
        described as {
          |Total transactions.
        }
      }
      totalVolume: Money with {
        briefly "Volume"
        described as {
          |Total dollar volume.
        }
      }
      averagePrice: Money with {
        briefly "Average"
        described as {
          |Average sale price.
        }
      }
      averageDaysToClose: Natural with {
        briefly "Days"
        described as {
          |Average days to close.
        }
      }
    } with {
      briefly "Transaction summary"
      described as {
        |Transaction metrics summary.
      }
    }
    handler AnalyticsHandler is {
      on event Transaction.ClosingCompleted is {
        prompt "Update transaction volume and averages"
      }
      on event Transaction.TransactionCancelled is {
        prompt "Update cancellation metrics"
      }
    } with {
      briefly "Maintains transaction analytics"
      described as {
        |Projects events into analytics views.
      }
    }
  } with {
    briefly "Transaction analytics projections"
    described as {
      |Maintains transaction analytics data.
    }
  }
} with {
  briefly "Bounded context for transaction management"
  described as {
    | The TransactionContext is the bounded context for real estate
    | transactions including offers, contracts, and closings.
  }
}
