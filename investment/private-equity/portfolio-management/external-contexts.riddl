// Portfolio Management - External Contexts

// Fund Administration Service
context FundAdministrationService is {

  query GetFundDetails is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
  } with {
    briefly "Get fund details"
    described by "Retrieves fund information."
  }

  result FundDetails is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    fundName is String(1, 200) with { briefly "Name" described by "Fund name." }
    vintageYear is Year with { briefly "Vintage" described by "Fund vintage year." }
    committedCapital is MonetaryAmount with { briefly "Committed" described by "Committed capital." }
    calledCapital is MonetaryAmount with { briefly "Called" described by "Capital called." }
    distributedCapital is MonetaryAmount with { briefly "Distributed" described by "Capital distributed." }
  } with {
    briefly "Fund details"
    described by "Fund administration details."
  }

  command RecordCapitalCall is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    companyId is PortfolioCompanyId with { briefly "Company" described by "Portfolio company." }
    callAmount is MonetaryAmount with { briefly "Amount" described by "Call amount." }
    callDate is Date with { briefly "Date" described by "Call date." }
  } with {
    briefly "Record capital call"
    described by "Records capital call for investment."
  }

  event CapitalCallRecorded is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    calledAmount is MonetaryAmount with { briefly "Amount" described by "Amount called." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Capital call recorded"
    described by "Emitted when capital call is recorded."
  }

  command RecordDistribution is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    companyId is PortfolioCompanyId with { briefly "Company" described by "Portfolio company." }
    distributionAmount is MonetaryAmount with { briefly "Amount" described by "Distribution amount." }
    distributionDate is Date with { briefly "Date" described by "Distribution date." }
    distributionType is String(1, 50) with { briefly "Type" described by "Distribution type." }
  } with {
    briefly "Record distribution"
    described by "Records distribution to LPs."
  }

  event DistributionRecorded is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    distributedAmount is MonetaryAmount with { briefly "Amount" described by "Amount distributed." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Record time." }
  } with {
    briefly "Distribution recorded"
    described by "Emitted when distribution is recorded."
  }

} with {
  option is external
  briefly "External fund administration"
  described by "External fund administration service."
}

// Market Data Service
context MarketDataService is {

  query GetComparableValuations is {
    industry is String(1, 100) with { briefly "Industry" described by "Target industry." }
    metric is String(1, 50) with { briefly "Metric" described by "Valuation metric (EV/Revenue, EV/EBITDA)." }
    minRevenue is MonetaryAmount with { briefly "Min revenue" described by "Minimum revenue threshold." }
    maxRevenue is MonetaryAmount with { briefly "Max revenue" described by "Maximum revenue threshold." }
  } with {
    briefly "Get comparable valuations"
    described by "Retrieves comparable company valuations."
  }

  result ComparableSet is {
    industry is String(1, 100) with { briefly "Industry" described by "Industry sector." }
    metric is String(1, 50) with { briefly "Metric" described by "Valuation metric." }
    medianMultiple is Decimal(6, 2) with { briefly "Median" described by "Median multiple." }
    averageMultiple is Decimal(6, 2) with { briefly "Average" described by "Average multiple." }
    lowMultiple is Decimal(6, 2) with { briefly "Low" described by "25th percentile." }
    highMultiple is Decimal(6, 2) with { briefly "High" described by "75th percentile." }
    comparableCount is Natural with { briefly "Count" described by "Number of comparables." }
  } with {
    briefly "Comparable set"
    described by "Comparable valuation multiples."
  }

  query GetPrecedentTransactions is {
    industry is String(1, 100) with { briefly "Industry" described by "Target industry." }
    startDate is Date with { briefly "Start" described by "Period start date." }
    endDate is Date with { briefly "End" described by "Period end date." }
  } with {
    briefly "Get precedent transactions"
    described by "Retrieves precedent M&A transactions."
  }

  result PrecedentTransaction is {
    targetName is String(1, 200) with { briefly "Target" described by "Target company." }
    acquirerName is String(1, 200) with { briefly "Acquirer" described by "Acquirer name." }
    transactionDate is Date with { briefly "Date" described by "Transaction date." }
    enterpriseValue is MonetaryAmount with { briefly "EV" described by "Enterprise value." }
    evRevenueMultiple is Decimal(6, 2) with { briefly "EV/Revenue" described by "EV/Revenue multiple." }
    evEbitdaMultiple is optional Decimal(6, 2) with { briefly "EV/EBITDA" described by "EV/EBITDA multiple." }
  } with {
    briefly "Precedent transaction"
    described by "M&A transaction details."
  }

} with {
  option is external
  briefly "External market data"
  described by "External market data and valuation service."
}

// Legal Document Service
context LegalDocumentService is {

  command GenerateInvestmentAgreement is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Portfolio company." }
    investmentType is InvestmentType with { briefly "Type" described by "Investment type." }
    terms is String(1, 5000) with { briefly "Terms" described by "Key terms." }
  } with {
    briefly "Generate investment agreement"
    described by "Generates investment documentation."
  }

  event DocumentGenerated is {
    documentId is UUID with { briefly "Document" described by "Document ID." }
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
    documentType is String(1, 100) with { briefly "Type" described by "Document type." }
    generatedAt is TimeStamp with { briefly "Generated" described by "Generation time." }
  } with {
    briefly "Document generated"
    described by "Emitted when document is generated."
  }

  query GetDocuments is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Portfolio company." }
    filterDocumentType is optional String(1, 100) with { briefly "Type" described by "Filter by type." }
  } with {
    briefly "Get documents"
    described by "Retrieves company documents."
  }

  result DocumentList is {
    documents is many String(1, 500) with { briefly "Documents" described by "Document list." }
    totalCount is Natural with { briefly "Count" described by "Total documents." }
  } with {
    briefly "Document list"
    described by "List of company documents."
  }

} with {
  option is external
  briefly "External legal documents"
  described by "External legal document management service."
}

// Investor Relations Service
context InvestorRelationsService is {

  command SendPortfolioUpdate is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    reportingPeriod is Date with { briefly "Period" described by "Reporting period." }
    summary is String(1, 5000) with { briefly "Summary" described by "Update summary." }
  } with {
    briefly "Send portfolio update"
    described by "Sends LP portfolio update."
  }

  event UpdateSent is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    reportingPeriod is Date with { briefly "Period" described by "Reporting period." }
    sentAt is TimeStamp with { briefly "Sent" described by "Send time." }
  } with {
    briefly "Update sent"
    described by "Emitted when update is sent to LPs."
  }

  command GenerateQuarterlyReport is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    quarter is String(1, 10) with { briefly "Quarter" described by "Reporting quarter (e.g., Q1 2026)." }
  } with {
    briefly "Generate quarterly report"
    described by "Generates LP quarterly report."
  }

  event ReportGenerated is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    reportId is UUID with { briefly "Report" described by "Report ID." }
    quarter is String(1, 10) with { briefly "Quarter" described by "Reporting quarter." }
    generatedAt is TimeStamp with { briefly "Generated" described by "Generation time." }
  } with {
    briefly "Report generated"
    described by "Emitted when quarterly report is generated."
  }

} with {
  option is external
  briefly "External investor relations"
  described by "External LP investor relations service."
}
