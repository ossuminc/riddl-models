// Portfolio Operations - External Contexts
context FundManagementSystem is {
  query GetFundDetails is  {
    fundId: FundId with {
      briefly "Fund"
      described as {
        |Fund ID.
      }
    }
  } with {
    briefly "Get fund details"
    described as {
      |Retrieves fund information.
    }
  }
  result FundDetails is  {
    fundId: FundId with {
      briefly "Fund"
      described as {
        |Fund ID.
      }
    }
    fundName: String(3,200) with {
      briefly "Name"
      described as {
        |Fund name.
      }
    }
    vintage: Natural with {
      briefly "Vintage"
      described as {
        |Fund vintage year.
      }
    }
    totalCommitted: Decimal(14,2) with {
      briefly "Committed"
      described as {
        |Total committed capital.
      }
    }
    totalDeployed: Decimal(14,2) with {
      briefly "Deployed"
      described as {
        |Total deployed capital.
      }
    }
  } with {
    briefly "Fund details"
    described as {
      |Fund information.
    }
  }
  command RecordDistribution is  {
    fundId: FundId with {
      briefly "Fund"
      described as {
        |Fund ID.
      }
    }
    companyId: PortfolioCompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    amount: Decimal(14,2) with {
      briefly "Amount"
      described as {
        |Distribution amount.
      }
    }
    distributionDate: Date with {
      briefly "Date"
      described as {
        |Distribution date.
      }
    }
  } with {
    briefly "Record distribution"
    described as {
      |Records capital distribution from exit.
    }
  }
  event DistributionRecorded is  {
    fundId: FundId with {
      briefly "Fund"
      described as {
        |Fund ID.
      }
    }
    amount: Decimal(14,2) with {
      briefly "Amount"
      described as {
        |Distribution amount.
      }
    }
    recordedAt: TimeStamp with {
      briefly "Recorded"
      described as {
        |Recording time.
      }
    }
  } with {
    briefly "Distribution recorded"
    described as {
      |Emitted when distribution is recorded.
    }
  }
} with {
  option external()
  briefly "External fund management"
  described as {
    |Fund-level management and accounting system.
  }
}
context FinancialReportingSystem is {
  command SubmitFinancialReport is  {
    companyId: PortfolioCompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    reportType: String(3,50) with {
      briefly "Type"
      described as {
        |Report type.
      }
    }
    reportingPeriod: Date with {
      briefly "Period"
      described as {
        |Reporting period.
      }
    }
    metrics: FinancialMetrics with {
      briefly "Metrics"
      described as {
        |Financial metrics.
      }
    }
  } with {
    briefly "Submit financial report"
    described as {
      |Submits financial report for portfolio company.
    }
  }
  event FinancialReportSubmitted is  {
    companyId: PortfolioCompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    reportType: String(3,50) with {
      briefly "Type"
      described as {
        |Report type.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Financial report submitted"
    described as {
      |Emitted when financial report is submitted.
    }
  }
  query GetHistoricalFinancials is  {
    companyId: PortfolioCompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    fromDate: Date with {
      briefly "From"
      described as {
        |Start date.
      }
    }
    toDate: Date with {
      briefly "To"
      described as {
        |End date.
      }
    }
  } with {
    briefly "Get historical financials"
    described as {
      |Retrieves historical financial data.
    }
  }
  result HistoricalFinancials is  {
    companyId: PortfolioCompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    periods: FinancialMetrics+ with {
      briefly "Periods"
      described as {
        |Financial metrics by period.
      }
    }
  } with {
    briefly "Historical financials"
    described as {
      |Historical financial data.
    }
  }
} with {
  option external()
  briefly "External financial reporting"
  described as {
    |Financial reporting and consolidation system.
  }
}
context LegalComplianceSystem is {
  command FileBoardResolution is  {
    companyId: PortfolioCompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    resolution: String(3,1000) with {
      briefly "Resolution"
      described as {
        |Board resolution text.
      }
    }
    filingDate: Date with {
      briefly "Date"
      described as {
        |Filing date.
      }
    }
  } with {
    briefly "File board resolution"
    described as {
      |Files a board resolution for compliance.
    }
  }
  event BoardResolutionFiled is  {
    companyId: PortfolioCompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    filedAt: TimeStamp with {
      briefly "Filed"
      described as {
        |Filing time.
      }
    }
  } with {
    briefly "Board resolution filed"
    described as {
      |Emitted when board resolution is filed.
    }
  }
  query GetComplianceStatus is  {
    companyId: PortfolioCompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
  } with {
    briefly "Get compliance status"
    described as {
      |Gets regulatory compliance status.
    }
  }
  result ComplianceStatus is  {
    companyId: PortfolioCompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    isCompliant: Boolean with {
      briefly "Compliant"
      described as {
        |Overall compliance.
      }
    }
    pendingFilings: Natural with {
      briefly "Pending"
      described as {
        |Pending filings count.
      }
    }
    lastReviewDate: Date with {
      briefly "Last review"
      described as {
        |Last compliance review.
      }
    }
  } with {
    briefly "Compliance status"
    described as {
      |Regulatory compliance status.
    }
  }
} with {
  option external()
  briefly "External legal compliance"
  described as {
    |Legal and regulatory compliance system.
  }
}
