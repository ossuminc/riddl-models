// Portfolio Operations - External Contexts

context FundManagementSystem is {

  query GetFundDetails is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
  } with {
    briefly "Get fund details"
    described by "Retrieves fund information."
  }

  result FundDetails is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    fundName is String(3, 200) with { briefly "Name" described by "Fund name." }
    vintage is Natural with { briefly "Vintage" described by "Fund vintage year." }
    totalCommitted is Decimal(14, 2) with { briefly "Committed" described by "Total committed capital." }
    totalDeployed is Decimal(14, 2) with { briefly "Deployed" described by "Total deployed capital." }
  } with {
    briefly "Fund details"
    described by "Fund information."
  }

  command RecordDistribution is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
    amount is Decimal(14, 2) with { briefly "Amount" described by "Distribution amount." }
    distributionDate is Date with { briefly "Date" described by "Distribution date." }
  } with {
    briefly "Record distribution"
    described by "Records capital distribution from exit."
  }

  event DistributionRecorded is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    amount is Decimal(14, 2) with { briefly "Amount" described by "Distribution amount." }
    recordedAt is TimeStamp with { briefly "Recorded" described by "Recording time." }
  } with {
    briefly "Distribution recorded"
    described by "Emitted when distribution is recorded."
  }

} with {
  option is external
  briefly "External fund management"
  described by "Fund-level management and accounting system."
}

context FinancialReportingSystem is {

  command SubmitFinancialReport is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
    reportType is String(3, 50) with { briefly "Type" described by "Report type." }
    reportingPeriod is Date with { briefly "Period" described by "Reporting period." }
    metrics is FinancialMetrics with { briefly "Metrics" described by "Financial metrics." }
  } with {
    briefly "Submit financial report"
    described by "Submits financial report for portfolio company."
  }

  event FinancialReportSubmitted is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
    reportType is String(3, 50) with { briefly "Type" described by "Report type." }
    submittedAt is TimeStamp with { briefly "Submitted" described by "Submission time." }
  } with {
    briefly "Financial report submitted"
    described by "Emitted when financial report is submitted."
  }

  query GetHistoricalFinancials is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
    fromDate is Date with { briefly "From" described by "Start date." }
    toDate is Date with { briefly "To" described by "End date." }
  } with {
    briefly "Get historical financials"
    described by "Retrieves historical financial data."
  }

  result HistoricalFinancials is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
    periods is many FinancialMetrics with { briefly "Periods" described by "Financial metrics by period." }
  } with {
    briefly "Historical financials"
    described by "Historical financial data."
  }

} with {
  option is external
  briefly "External financial reporting"
  described by "Financial reporting and consolidation system."
}

context LegalComplianceSystem is {

  command FileBoardResolution is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
    resolution is String(3, 1000) with { briefly "Resolution" described by "Board resolution text." }
    filingDate is Date with { briefly "Date" described by "Filing date." }
  } with {
    briefly "File board resolution"
    described by "Files a board resolution for compliance."
  }

  event BoardResolutionFiled is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
    filedAt is TimeStamp with { briefly "Filed" described by "Filing time." }
  } with {
    briefly "Board resolution filed"
    described by "Emitted when board resolution is filed."
  }

  query GetComplianceStatus is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
  } with {
    briefly "Get compliance status"
    described by "Gets regulatory compliance status."
  }

  result ComplianceStatus is {
    companyId is PortfolioCompanyId with { briefly "Company" described by "Company ID." }
    isCompliant is Boolean with { briefly "Compliant" described by "Overall compliance." }
    pendingFilings is Natural with { briefly "Pending" described by "Pending filings count." }
    lastReviewDate is Date with { briefly "Last review" described by "Last compliance review." }
  } with {
    briefly "Compliance status"
    described by "Regulatory compliance status."
  }

} with {
  option is external
  briefly "External legal compliance"
  described by "Legal and regulatory compliance system."
}
