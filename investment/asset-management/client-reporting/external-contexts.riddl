// Client Reporting - External Contexts
context PortfolioSystem is {
  query GetPortfolioHoldings is  {
    portfolioId: PortfolioId with {
      briefly "Portfolio"
      described as {
        |Portfolio ID.
      }
    }
    asOfDate: Date with {
      briefly "As of date"
      described as {
        |Holdings as of date.
      }
    }
  } with {
    briefly "Get portfolio holdings"
    described as {
      |Retrieves current portfolio holdings.
    }
  }
  result PortfolioHoldings is  {
    holdings: HoldingRecord+ with {
      briefly "Holdings"
      described as {
        |Portfolio holdings.
      }
    }
    totalValue: Decimal(14,2) with {
      briefly "Total value"
      described as {
        |Total portfolio value.
      }
    }
  } with {
    briefly "Portfolio holdings"
    described as {
      |Portfolio holdings and total value.
    }
  }
  query GetTransactionHistory is  {
    portfolioId: PortfolioId with {
      briefly "Portfolio"
      described as {
        |Portfolio ID.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Period start date.
      }
    }
    endDate: Date with {
      briefly "End"
      described as {
        |Period end date.
      }
    }
  } with {
    briefly "Get transaction history"
    described as {
      |Retrieves transactions for a period.
    }
  }
  result TransactionHistory is  {
    summary: TransactionSummary with {
      briefly "Summary"
      described as {
        |Transaction summary.
      }
    }
    transactionCount: Natural with {
      briefly "Count"
      described as {
        |Number of transactions.
      }
    }
  } with {
    briefly "Transaction history"
    described as {
      |Transaction history for the period.
    }
  }
  query GetAccountInfo is  {
    clientId: ClientId with {
      briefly "Client"
      described as {
        |Client ID.
      }
    }
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
  } with {
    briefly "Get account info"
    described as {
      |Retrieves client account information.
    }
  }
  result AccountInfo is  {
    accountId: AccountId with {
      briefly "Account"
      described as {
        |Account ID.
      }
    }
    accountName: String(3,200) with {
      briefly "Name"
      described as {
        |Account name.
      }
    }
    accountType: String(3,50) with {
      briefly "Type"
      described as {
        |Account type.
      }
    }
    inceptionDate: Date with {
      briefly "Inception"
      described as {
        |Account inception date.
      }
    }
  } with {
    briefly "Account info"
    described as {
      |Client account information.
    }
  }
} with {
  option external()
  briefly "External portfolio system"
  described as {
    |Portfolio management and holdings system.
  }
}
context MarketDataProvider is {
  query GetBenchmarkReturns is  {
    benchmarkName: String(3,100) with {
      briefly "Benchmark"
      described as {
        |Benchmark name.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Period start date.
      }
    }
    endDate: Date with {
      briefly "End"
      described as {
        |Period end date.
      }
    }
  } with {
    briefly "Get benchmark returns"
    described as {
      |Retrieves benchmark index returns.
    }
  }
  result BenchmarkReturns is  {
    benchmarkName: String(3,100) with {
      briefly "Benchmark"
      described as {
        |Benchmark name.
      }
    }
    totalReturn: Decimal(8,4) with {
      briefly "Return"
      described as {
        |Total return.
      }
    }
    annualizedReturn: Decimal(8,4) with {
      briefly "Annualized"
      described as {
        |Annualized return.
      }
    }
  } with {
    briefly "Benchmark returns"
    described as {
      |Benchmark performance data.
    }
  }
  query GetSecurityPrices is  {
    tickers: String(1,20)+ with {
      briefly "Tickers"
      described as {
        |Security tickers.
      }
    }
    asOfDate: Date with {
      briefly "As of date"
      described as {
        |Pricing date.
      }
    }
  } with {
    briefly "Get security prices"
    described as {
      |Retrieves security prices for valuation.
    }
  }
  result SecurityPrices is  {
    priceCount: Natural with {
      briefly "Count"
      described as {
        |Number of prices returned.
      }
    }
    pricedAt: TimeStamp with {
      briefly "Priced"
      described as {
        |Pricing timestamp.
      }
    }
  } with {
    briefly "Security prices"
    described as {
      |Security pricing data.
    }
  }
} with {
  option external()
  briefly "External market data provider"
  described as {
    |Market data and benchmark information system.
  }
}
context ComplianceRegistry is {
  query GetRequiredDisclosures is  {
    reportType: ReportType with {
      briefly "Type"
      described as {
        |Report type.
      }
    }
    jurisdiction: String(3,100) with {
      briefly "Jurisdiction"
      described as {
        |Regulatory jurisdiction.
      }
    }
  } with {
    briefly "Get required disclosures"
    described as {
      |Retrieves mandatory regulatory disclosures.
    }
  }
  result RequiredDisclosures is  {
    disclosures: RegulatoryDisclosure+ with {
      briefly "Disclosures"
      described as {
        |Required disclosures.
      }
    }
    lastUpdated: Date with {
      briefly "Updated"
      described as {
        |Last update date.
      }
    }
  } with {
    briefly "Required disclosures"
    described as {
      |Mandatory disclosure requirements.
    }
  }
  command LogReportDistribution is  {
    reportId: ClientReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    clientId: ClientId with {
      briefly "Client"
      described as {
        |Client ID.
      }
    }
    reportType: ReportType with {
      briefly "Type"
      described as {
        |Report type.
      }
    }
    distributedAt: TimeStamp with {
      briefly "Distributed"
      described as {
        |Distribution time.
      }
    }
  } with {
    briefly "Log report distribution"
    described as {
      |Logs report distribution for compliance audit.
    }
  }
  event DistributionLogged is  {
    reportId: ClientReportId with {
      briefly "Report"
      described as {
        |Report ID.
      }
    }
    loggedAt: TimeStamp with {
      briefly "Logged"
      described as {
        |Logging time.
      }
    }
  } with {
    briefly "Distribution logged"
    described as {
      |Emitted when distribution is logged for compliance.
    }
  }
} with {
  option external()
  briefly "External compliance registry"
  described as {
    |Regulatory compliance and disclosure system.
  }
}
