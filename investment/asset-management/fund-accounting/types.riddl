// Fund Accounting Types
// Shared type definitions for the fund accounting domain

// === Identifier Types ===

type FundId is Id(FundContext.Fund) with {
  briefly "Unique identifier for a fund"
  described by {
    | A type-safe identifier used to uniquely identify a fund entity
    | within the system. This ID is used in all fund-related operations
    | and references.
  }
}

type NAVId is UUID with {
  briefly "Unique identifier for a NAV calculation"
  described by {
    | Identifies a specific NAV calculation record. Each daily NAV
    | calculation produces a new NAVId for audit and historical
    | tracking purposes.
  }
}

type TransactionId is UUID with {
  briefly "Unique identifier for a fund transaction"
  described by {
    | Uniquely identifies a transaction within the fund accounting
    | system. Used for transaction tracking, reconciliation, and
    | audit purposes.
  }
}

type HoldingId is UUID with {
  briefly "Unique identifier for a portfolio holding"
  described by {
    | Identifies a specific security or asset holding within a fund's
    | portfolio. Links to the security master and supports position
    | tracking.
  }
}

type InvestorAccountId is UUID with {
  briefly "Unique identifier for an investor account"
  described by {
    | Identifies an investor's account relationship with a fund.
    | An investor may have multiple accounts across different funds
    | or share classes.
  }
}

type SecurityId is UUID with {
  briefly "Unique identifier for a security"
  described by {
    | Identifies a tradeable security such as a stock, bond, or
    | derivative instrument. Links to external security master data.
  }
}

// === Enumeration Types ===

type FundStatus is any of {
  Active,
  Suspended,
  Liquidating,
  Closed
} with {
  briefly "Operational status of a fund"
  described by {
    | Indicates the current operational state of a fund:
    | - Active: Normal operations, accepting subscriptions/redemptions
    | - Suspended: Temporarily halted operations
    | - Liquidating: In the process of closing and distributing assets
    | - Closed: No longer operational
  }
}

type TransactionType is any of {
  Buy,
  Sell,
  Dividend,
  Interest,
  Fee,
  Transfer,
  CorporateAction,
  Adjustment
} with {
  briefly "Classification of fund transactions"
  described by {
    | Categorizes transactions for accounting and reporting:
    | - Buy/Sell: Security purchases and sales
    | - Dividend/Interest: Income received
    | - Fee: Management, performance, and other fees
    | - Transfer: Internal transfers between accounts
    | - CorporateAction: Stock splits, mergers, etc.
    | - Adjustment: Accounting corrections
  }
}

type TransactionStatus is any of {
  Pending,
  Settled,
  Failed,
  Cancelled,
  Reversed
} with {
  briefly "Processing status of a transaction"
  described by {
    | Tracks the lifecycle of a transaction from creation to settlement:
    | - Pending: Awaiting settlement
    | - Settled: Successfully completed
    | - Failed: Could not be processed
    | - Cancelled: Cancelled before settlement
    | - Reversed: Settled but subsequently reversed
  }
}

type AssetClass is any of {
  Equity,
  FixedIncome,
  Cash,
  Derivative,
  Alternative,
  RealEstate,
  Commodity
} with {
  briefly "Classification of asset types"
  described by {
    | High-level categorization of investment assets for allocation
    | tracking and risk management purposes.
  }
}

type FundType is any of {
  OpenEnd,
  ClosedEnd,
  ETF,
  HedgeFund,
  PrivateEquity,
  MutualFund
} with {
  briefly "Legal and structural classification of funds"
  described by {
    | Identifies the fund structure which determines regulatory
    | requirements, redemption rules, and reporting obligations.
  }
}

// === Money and Quantity Types ===

type Money is {
  amount is Decimal(18, 4),
  currency is Currency(USD)
} with {
  briefly "Monetary value with currency"
  described by {
    | Represents a monetary amount with high precision for financial
    | calculations. Uses 4 decimal places to handle fractional cents
    | and currency conversions accurately.
  }
}

type Quantity is Decimal(18, 8) with {
  briefly "Security quantity or share count"
  described by {
    | Represents the number of shares or units held. Uses 8 decimal
    | places to accommodate fractional shares common in mutual funds
    | and some securities.
  }
}

type Price is Decimal(18, 6) with {
  briefly "Security or asset price"
  described by {
    | Represents the price of a security or asset. Uses 6 decimal
    | places to handle precision requirements of various markets.
  }
}

type Percentage is Decimal(8, 4) with {
  briefly "Percentage value"
  described by {
    | Represents a percentage with 4 decimal places of precision.
    | Values are stored as decimals (e.g., 5.25% stored as 5.2500).
  }
}

// === Record Types ===

record FundInfo is {
  fundId is FundId,
  name is String(1, 200),
  fundType is FundType,
  status is FundStatus,
  inceptionDate is Date,
  baseCurrency is Currency(USD),
  managementFeeRate is Percentage,
  performanceFeeRate is optional Percentage,
  minimumInvestment is Money
} with {
  briefly "Core fund information record"
  described by {
    | Contains the essential identifying and configuration information
    | for a fund including its type, status, fee structure, and
    | investment requirements.
  }
}

record NAVRecord is {
  navId is NAVId,
  fundId is FundId,
  valuationDate is Date,
  totalAssets is Money,
  totalLiabilities is Money,
  netAssetValue is Money,
  sharesOutstanding is Quantity,
  navPerShare is Price,
  calculatedAt is TimeStamp,
  isOfficial is Boolean
} with {
  briefly "Net Asset Value calculation result"
  described by {
    | Records the results of a NAV calculation including total assets,
    | liabilities, and the resulting per-share NAV. Tracks whether
    | this is an official (published) or preliminary calculation.
  }
}

record TransactionRecord is {
  transactionId is TransactionId,
  fundId is FundId,
  transactionType is TransactionType,
  transactionStatus is TransactionStatus,
  tradeSecurityId is optional SecurityId,
  tradeQuantity is optional Quantity,
  tradePrice is optional Price,
  grossAmount is Money,
  fees is Money,
  netAmount is Money,
  tradeDate is Date,
  settlementDate is Date,
  description is String(0, 500),
  createdAt is TimeStamp
} with {
  briefly "Fund transaction record"
  described by {
    | Captures all details of a fund transaction including the type,
    | amounts, dates, and current status. Supports both security
    | transactions (buy/sell) and non-security transactions (fees,
    | income).
  }
}

record HoldingRecord is {
  holdingId is HoldingId,
  fundId is FundId,
  securityId is SecurityId,
  securityName is String(1, 200),
  assetClass is AssetClass,
  quantity is Quantity,
  costBasis is Money,
  marketValue is Money,
  unrealizedGainLoss is Money,
  percentOfPortfolio is Percentage,
  lastUpdated is TimeStamp
} with {
  briefly "Portfolio holding position"
  described by {
    | Represents a fund's position in a specific security including
    | quantity, cost basis, current market value, and the resulting
    | unrealized gain or loss.
  }
}

record InvestorAccount is {
  accountId is InvestorAccountId,
  fundId is FundId,
  investorName is String(1, 200),
  shares is Quantity,
  accountValue is Money,
  costBasis is Money,
  openDate is Date,
  lastActivityDate is Date
} with {
  briefly "Investor account in a fund"
  described by {
    | Tracks an investor's position in a fund including their share
    | balance, account value, and cost basis for tax reporting
    | purposes.
  }
}

record FundPerformance is {
  fundId is FundId,
  asOfDate is Date,
  dailyReturn is Percentage,
  mtdReturn is Percentage,
  qtdReturn is Percentage,
  ytdReturn is Percentage,
  oneYearReturn is optional Percentage,
  threeYearReturn is optional Percentage,
  fiveYearReturn is optional Percentage,
  sinceInceptionReturn is Percentage
} with {
  briefly "Fund performance metrics"
  described by {
    | Contains calculated performance returns for various time periods.
    | Returns are calculated net of fees and represent the total
    | return including reinvested dividends.
  }
}

record AssetAllocation is {
  fundId is FundId,
  asOfDate is Date,
  equityAllocation is Percentage,
  fixedIncomeAllocation is Percentage,
  cashAllocation is Percentage,
  alternativeAllocation is Percentage,
  otherAllocation is Percentage
} with {
  briefly "Fund asset allocation breakdown"
  described by {
    | Shows the distribution of fund assets across major asset classes.
    | Used for investment mandate compliance and investor reporting.
  }
}
