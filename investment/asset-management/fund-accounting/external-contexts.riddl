// External Contexts
// External bounded contexts that integrate with the fund accounting domain
context MarketDataContext is {
  type MarketDataQuote is {
    securityId: SecurityId
    price: Price
    bidPrice: Price
    askPrice: Price
    volume: Natural
    quoteTime: TimeStamp
    source: String(1,50)
  } with {
    briefly "Market data price quote"
    described as {
      | Contains current market pricing information for a security
      | including bid/ask spread and trading volume.
    }
  }
  type HistoricalPrice is {
    securityId: SecurityId
    date: Date
    openPrice: Price
    highPrice: Price
    lowPrice: Price
    closePrice: Price
    adjustedClose: Price
    volume: Natural
  } with {
    briefly "Historical price data"
    described as {
      | Contains end-of-day historical pricing including OHLC
      | prices and adjusted close for corporate actions.
    }
  }
  event PriceUpdated is  {
    securityId: SecurityId
    price: Price
    priceTime: TimeStamp
  } with {
    briefly "Security price has been updated"
    described as {
      | Emitted when a security's market price changes, triggering
      | potential NAV recalculation for affected funds.
    }
  }
  event EndOfDayPricesPublished is  {
    valuationDate: Date
    priceCount: Natural
    publishedAt: TimeStamp
  } with {
    briefly "End of day prices are available"
    described as {
      | Emitted when official end-of-day prices are published and
      | available for NAV calculations.
    }
  }
} with {
  option external()
  briefly "External market data provider context"
  described as {
    | The MarketDataContext represents the external market data
    | provider that supplies real-time and historical pricing
    | for securities held in fund portfolios.
  }
}
context CustodianContext is {
  type CustodianPosition is {
    custodianAccountId: String(1,50)
    securityId: SecurityId
    quantity: Quantity
    settledQuantity: Quantity
    pendingQuantity: Quantity
    asOfDate: Date
  } with {
    briefly "Custodian position record"
    described as {
      | Position information from the custodian including settled
      | and pending quantities for reconciliation.
    }
  }
  type CustodianTransaction is {
    transactionRef: String(1,50)
    custodianAccountId: String(1,50)
    securityId: SecurityId
    custodianTransactionType: String(1,20)
    quantity: Quantity
    transactionAmount: Money
    tradeDate: Date
    settlementDate: Date
    custodianStatus: String(1,20)
  } with {
    briefly "Custodian transaction record"
    described as {
      | Transaction details from the custodian for reconciliation
      | with fund accounting records.
    }
  }
  event PositionsReceived is  {
    custodianAccountId: String(1,50)
    asOfDate: Date
    positionCount: Natural
    receivedAt: TimeStamp
  } with {
    briefly "Custodian positions have been received"
    described as {
      | Emitted when custodian position data is received for
      | reconciliation with fund holdings.
    }
  }
  event TransactionSettled is  {
    transactionRef: String(1,50)
    settlementDate: Date
    settledAt: TimeStamp
  } with {
    briefly "Custodian transaction has settled"
    described as {
      | Emitted when a transaction settles at the custodian,
      | triggering status update in fund accounting.
    }
  }
} with {
  option external()
  briefly "External custodian services context"
  described as {
    | The CustodianContext represents the external custodian bank
    | that holds fund assets and provides position and transaction
    | data for reconciliation.
  }
}
context TransferAgentContext is {
  type ShareholderRecord is {
    accountNumber: String(1,20)
    shareholderName: String(1,200)
    fundId: FundId
    shareBalance: Quantity
    taxId: String(1,20)
    address: String(1,500)
  } with {
    briefly "Shareholder registration record"
    described as {
      | Official shareholder registration information maintained
      | by the transfer agent for investor communications and
      | regulatory reporting.
    }
  }
  type DividendDistribution is {
    fundId: FundId
    recordDate: Date
    payableDate: Date
    dividendPerShare: Money
    dividendType: String(1,20)
  } with {
    briefly "Dividend distribution record"
    described as {
      | Details of dividend distributions for shareholder payments
      | and tax reporting.
    }
  }
  event ShareholderRegistered is  {
    accountNumber: String(1,20)
    fundId: FundId
    registeredAt: TimeStamp
  } with {
    briefly "New shareholder has been registered"
    described as {
      | Emitted when a new shareholder is registered with the
      | transfer agent.
    }
  }
  event DividendDeclared is  {
    fundId: FundId
    recordDate: Date
    dividendPerShare: Money
    declaredAt: TimeStamp
  } with {
    briefly "Dividend has been declared"
    described as {
      | Emitted when a dividend is declared, triggering
      | distribution processing.
    }
  }
} with {
  option external()
  briefly "External transfer agent context"
  described as {
    | The TransferAgentContext represents the external transfer
    | agent that maintains official shareholder records, processes
    | subscriptions and redemptions, and handles dividend
    | distributions.
  }
}
context ComplianceContext is {
  type ComplianceRule is {
    ruleId: UUID
    ruleName: String(1,100)
    ruleType: String(1,50)
    threshold: Percentage
    description: String(1,500)
  } with {
    briefly "Compliance rule definition"
    described as {
      | Defines a compliance rule with thresholds and conditions
      | that must be monitored for regulatory adherence.
    }
  }
  type ComplianceViolation is {
    violationId: UUID
    fundId: FundId
    ruleId: UUID
    violationType: String(1,50)
    currentValue: Percentage
    threshold: Percentage
    detectedAt: TimeStamp
  } with {
    briefly "Compliance violation record"
    described as {
      | Records a detected compliance violation for investigation
      | and resolution tracking.
    }
  }
  event ComplianceCheckCompleted is  {
    fundId: FundId
    checkDate: Date
    rulesChecked: Natural
    violationsFound: Natural
    completedAt: TimeStamp
  } with {
    briefly "Compliance check has completed"
    described as {
      | Emitted when a scheduled compliance check completes,
      | indicating whether any violations were detected.
    }
  }
  event ViolationDetected is  {
    violationId: UUID
    fundId: FundId
    ruleId: UUID
    severity: String(1,20)
    detectedAt: TimeStamp
  } with {
    briefly "Compliance violation has been detected"
    described as {
      | Emitted when a compliance rule violation is detected,
      | requiring immediate attention and resolution.
    }
  }
} with {
  option external()
  briefly "External compliance monitoring context"
  described as {
    | The ComplianceContext represents the external compliance
    | monitoring system that tracks regulatory requirements,
    | investment guidelines, and internal policies.
  }
}
