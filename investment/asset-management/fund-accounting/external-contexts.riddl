// External Contexts
// External bounded contexts that integrate with the fund accounting domain

context MarketDataContext is {

  type MarketDataQuote is {
    securityId is SecurityId,
    price is Price,
    bidPrice is Price,
    askPrice is Price,
    volume is Natural,
    quoteTime is TimeStamp,
    source is String(1, 50)
  } with {
    briefly "Market data price quote"
    described by {
      | Contains current market pricing information for a security
      | including bid/ask spread and trading volume.
    }
  }

  type HistoricalPrice is {
    securityId is SecurityId,
    date is Date,
    openPrice is Price,
    highPrice is Price,
    lowPrice is Price,
    closePrice is Price,
    adjustedClose is Price,
    volume is Natural
  } with {
    briefly "Historical price data"
    described by {
      | Contains end-of-day historical pricing including OHLC
      | prices and adjusted close for corporate actions.
    }
  }

  event PriceUpdated is {
    securityId is SecurityId,
    price is Price,
    priceTime is TimeStamp
  } with {
    briefly "Security price has been updated"
    described by {
      | Emitted when a security's market price changes, triggering
      | potential NAV recalculation for affected funds.
    }
  }

  event EndOfDayPricesPublished is {
    valuationDate is Date,
    priceCount is Natural,
    publishedAt is TimeStamp
  } with {
    briefly "End of day prices are available"
    described by {
      | Emitted when official end-of-day prices are published and
      | available for NAV calculations.
    }
  }

} with {
  option is external
  briefly "External market data provider context"
  described by {
    | The MarketDataContext represents the external market data
    | provider that supplies real-time and historical pricing
    | for securities held in fund portfolios.
  }
}

context CustodianContext is {

  type CustodianPosition is {
    custodianAccountId is String(1, 50),
    securityId is SecurityId,
    quantity is Quantity,
    settledQuantity is Quantity,
    pendingQuantity is Quantity,
    asOfDate is Date
  } with {
    briefly "Custodian position record"
    described by {
      | Position information from the custodian including settled
      | and pending quantities for reconciliation.
    }
  }

  type CustodianTransaction is {
    transactionRef is String(1, 50),
    custodianAccountId is String(1, 50),
    securityId is SecurityId,
    custodianTransactionType is String(1, 20),
    quantity is Quantity,
    transactionAmount is Money,
    tradeDate is Date,
    settlementDate is Date,
    custodianStatus is String(1, 20)
  } with {
    briefly "Custodian transaction record"
    described by {
      | Transaction details from the custodian for reconciliation
      | with fund accounting records.
    }
  }

  event PositionsReceived is {
    custodianAccountId is String(1, 50),
    asOfDate is Date,
    positionCount is Natural,
    receivedAt is TimeStamp
  } with {
    briefly "Custodian positions have been received"
    described by {
      | Emitted when custodian position data is received for
      | reconciliation with fund holdings.
    }
  }

  event TransactionSettled is {
    transactionRef is String(1, 50),
    settlementDate is Date,
    settledAt is TimeStamp
  } with {
    briefly "Custodian transaction has settled"
    described by {
      | Emitted when a transaction settles at the custodian,
      | triggering status update in fund accounting.
    }
  }

} with {
  option is external
  briefly "External custodian services context"
  described by {
    | The CustodianContext represents the external custodian bank
    | that holds fund assets and provides position and transaction
    | data for reconciliation.
  }
}

context TransferAgentContext is {

  type ShareholderRecord is {
    accountNumber is String(1, 20),
    shareholderName is String(1, 200),
    fundId is FundId,
    shareBalance is Quantity,
    taxId is String(1, 20),
    address is String(1, 500)
  } with {
    briefly "Shareholder registration record"
    described by {
      | Official shareholder registration information maintained
      | by the transfer agent for investor communications and
      | regulatory reporting.
    }
  }

  type DividendDistribution is {
    fundId is FundId,
    recordDate is Date,
    payableDate is Date,
    dividendPerShare is Money,
    dividendType is String(1, 20)
  } with {
    briefly "Dividend distribution record"
    described by {
      | Details of dividend distributions for shareholder payments
      | and tax reporting.
    }
  }

  event ShareholderRegistered is {
    accountNumber is String(1, 20),
    fundId is FundId,
    registeredAt is TimeStamp
  } with {
    briefly "New shareholder has been registered"
    described by {
      | Emitted when a new shareholder is registered with the
      | transfer agent.
    }
  }

  event DividendDeclared is {
    fundId is FundId,
    recordDate is Date,
    dividendPerShare is Money,
    declaredAt is TimeStamp
  } with {
    briefly "Dividend has been declared"
    described by {
      | Emitted when a dividend is declared, triggering
      | distribution processing.
    }
  }

} with {
  option is external
  briefly "External transfer agent context"
  described by {
    | The TransferAgentContext represents the external transfer
    | agent that maintains official shareholder records, processes
    | subscriptions and redemptions, and handles dividend
    | distributions.
  }
}

context ComplianceContext is {

  type ComplianceRule is {
    ruleId is UUID,
    ruleName is String(1, 100),
    ruleType is String(1, 50),
    threshold is Percentage,
    description is String(1, 500)
  } with {
    briefly "Compliance rule definition"
    described by {
      | Defines a compliance rule with thresholds and conditions
      | that must be monitored for regulatory adherence.
    }
  }

  type ComplianceViolation is {
    violationId is UUID,
    fundId is FundId,
    ruleId is UUID,
    violationType is String(1, 50),
    currentValue is Percentage,
    threshold is Percentage,
    detectedAt is TimeStamp
  } with {
    briefly "Compliance violation record"
    described by {
      | Records a detected compliance violation for investigation
      | and resolution tracking.
    }
  }

  event ComplianceCheckCompleted is {
    fundId is FundId,
    checkDate is Date,
    rulesChecked is Natural,
    violationsFound is Natural,
    completedAt is TimeStamp
  } with {
    briefly "Compliance check has completed"
    described by {
      | Emitted when a scheduled compliance check completes,
      | indicating whether any violations were detected.
    }
  }

  event ViolationDetected is {
    violationId is UUID,
    fundId is FundId,
    ruleId is UUID,
    severity is String(1, 20),
    detectedAt is TimeStamp
  } with {
    briefly "Compliance violation has been detected"
    described by {
      | Emitted when a compliance rule violation is detected,
      | requiring immediate attention and resolution.
    }
  }

} with {
  option is external
  briefly "External compliance monitoring context"
  described by {
    | The ComplianceContext represents the external compliance
    | monitoring system that tracks regulatory requirements,
    | investment guidelines, and internal policies.
  }
}
