// Investment Portfolio - External Contexts
context MarketDataFeed is {
  query GetSecurityPrice is  {
    securityId: SecurityId with {
      briefly "Security"
      described as {
        |Security ID.
      }
    }
  } with {
    briefly "Get security price"
    described as {
      |Retrieves current market price.
    }
  }
  result SecurityPrice is  {
    securityId: SecurityId with {
      briefly "Security"
      described as {
        |Security ID.
      }
    }
    bidPrice: Decimal(15,4) with {
      briefly "Bid"
      described as {
        |Bid price.
      }
    }
    askPrice: Decimal(15,4) with {
      briefly "Ask"
      described as {
        |Ask price.
      }
    }
    lastPrice: Decimal(15,4) with {
      briefly "Last"
      described as {
        |Last traded price.
      }
    }
    asOfTime: TimeStamp with {
      briefly "As-of"
      described as {
        |Price timestamp.
      }
    }
  } with {
    briefly "Security price"
    described as {
      |Current market price data.
    }
  }
  query GetBenchmarkReturn is  {
    benchmarkId: BenchmarkId with {
      briefly "Benchmark"
      described as {
        |Benchmark ID.
      }
    }
    startDate: Date with {
      briefly "Start"
      described as {
        |Period start date.
      }
    }
    endDate: Date with {
      briefly "End"
      described as {
        |Period end date.
      }
    }
  } with {
    briefly "Get benchmark return"
    described as {
      |Retrieves benchmark return for a period.
    }
  }
  result BenchmarkReturn is  {
    benchmarkId: BenchmarkId with {
      briefly "Benchmark"
      described as {
        |Benchmark ID.
      }
    }
    totalReturn: Decimal(8,4) with {
      briefly "Return"
      described as {
        |Total return percentage.
      }
    }
    periodStart: Date with {
      briefly "Start"
      described as {
        |Period start.
      }
    }
    periodEnd: Date with {
      briefly "End"
      described as {
        |Period end.
      }
    }
  } with {
    briefly "Benchmark return"
    described as {
      |Benchmark return for a period.
    }
  }
  event PriceUpdated is  {
    securityId: SecurityId with {
      briefly "Security"
      described as {
        |Security ID.
      }
    }
    newPrice: Decimal(15,4) with {
      briefly "Price"
      described as {
        |Updated price.
      }
    }
    updatedAt: TimeStamp with {
      briefly "Updated"
      described as {
        |Update time.
      }
    }
  } with {
    briefly "Price updated"
    described as {
      |Emitted when a security price changes.
    }
  }
} with {
  option external()
  briefly "External market data feed"
  described as {
    |Real-time and historical market data provider.
  }
}
context TradingSystem is {
  command SubmitOrder is  {
    tradeId: TradeId with {
      briefly "Trade"
      described as {
        |Trade ID.
      }
    }
    securityId: SecurityId with {
      briefly "Security"
      described as {
        |Security ID.
      }
    }
    action: TradeAction with {
      briefly "Action"
      described as {
        |Trade action.
      }
    }
    quantity: Decimal(15,4) with {
      briefly "Quantity"
      described as {
        |Order quantity.
      }
    }
    limitPrice: Decimal(15,4)? with {
      briefly "Limit"
      described as {
        |Limit price.
      }
    }
  } with {
    briefly "Submit order"
    described as {
      |Submits trade order for execution.
    }
  }
  command CancelTradeOrder is  {
    tradeId: TradeId with {
      briefly "Trade"
      described as {
        |Trade ID.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Cancellation reason.
      }
    }
  } with {
    briefly "Cancel trade order"
    described as {
      |Cancels a pending trade order.
    }
  }
  event OrderSubmitted is  {
    tradeId: TradeId with {
      briefly "Trade"
      described as {
        |Trade ID.
      }
    }
    submittedAt: TimeStamp with {
      briefly "Submitted"
      described as {
        |Submission time.
      }
    }
  } with {
    briefly "Order submitted"
    described as {
      |Emitted when order is submitted to market.
    }
  }
  event OrderFilled is  {
    tradeId: TradeId with {
      briefly "Trade"
      described as {
        |Trade ID.
      }
    }
    filledQuantity: Decimal(15,4) with {
      briefly "Quantity"
      described as {
        |Filled quantity.
      }
    }
    filledPrice: Decimal(15,4) with {
      briefly "Price"
      described as {
        |Fill price.
      }
    }
    filledAt: TimeStamp with {
      briefly "Filled"
      described as {
        |Fill time.
      }
    }
  } with {
    briefly "Order filled"
    described as {
      |Emitted when trade order is filled.
    }
  }
  event OrderRejected is  {
    tradeId: TradeId with {
      briefly "Trade"
      described as {
        |Trade ID.
      }
    }
    reason: String(3,500) with {
      briefly "Reason"
      described as {
        |Rejection reason.
      }
    }
    rejectedAt: TimeStamp with {
      briefly "Rejected"
      described as {
        |Rejection time.
      }
    }
  } with {
    briefly "Order rejected"
    described as {
      |Emitted when trade order is rejected.
    }
  }
} with {
  option external()
  briefly "External trading system"
  described as {
    |Order management and execution system.
  }
}
