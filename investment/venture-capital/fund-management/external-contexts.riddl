// Fund Management - External Contexts

context LPPortal is {

  command SendCapitalCallNotice is {
    lpId is LPId with { briefly "LP" described by "LP ID." }
    call is CapitalCall with { briefly "Call" described by "Capital call." }
  } with {
    briefly "Send capital call notice"
    described by "Notifies LP of capital call."
  }

  command SendDistributionNotice is {
    lpId is LPId with { briefly "LP" described by "LP ID." }
    distribution is Distribution with { briefly "Distribution" described by "Distribution." }
    lpAmount is Decimal(15, 2) with { briefly "Amount" described by "LP share." }
  } with {
    briefly "Send distribution notice"
    described by "Notifies LP of distribution."
  }

  command SendQuarterlyReport is {
    lpId is LPId with { briefly "LP" described by "LP ID." }
    reportDate is Date with { briefly "Date" described by "Report date." }
    reportUrl is URL with { briefly "URL" described by "Report URL." }
  } with {
    briefly "Send quarterly report"
    described by "Sends investor report."
  }

  event NoticeDelivered is {
    lpId is LPId with { briefly "LP" described by "LP ID." }
    noticeType is String(1, 50) with { briefly "Type" described by "Notice type." }
    deliveredAt is TimeStamp with { briefly "Delivered" described by "Delivery time." }
  } with {
    briefly "Notice delivered"
    described by "Emitted when notice delivered."
  }

} with {
  option is external
  briefly "External LP portal"
  described by "Limited partner communication portal."
}

context FundAccounting is {

  command RecordInvestment is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    companyId is UUID with { briefly "Company" described by "Portfolio company." }
    amount is Decimal(15, 2) with { briefly "Amount" described by "Investment amount." }
    investmentDate is Date with { briefly "Date" described by "Investment date." }
  } with {
    briefly "Record investment"
    described by "Records portfolio investment."
  }

  command RecordValuation is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    valuationDate is Date with { briefly "Date" described by "Valuation date." }
    holdings is many HoldingValuation with { briefly "Holdings" described by "Portfolio valuations." }
  } with {
    briefly "Record valuation"
    described by "Records portfolio valuations."
  }

  query GetFundNAV is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    asOfDate is Date with { briefly "As of" described by "As of date." }
  } with {
    briefly "Get fund NAV"
    described by "Gets fund net asset value."
  }

  result FundNAV is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    nav is Decimal(15, 2) with { briefly "NAV" described by "Net asset value." }
    asOfDate is Date with { briefly "As of" described by "Valuation date." }
  } with {
    briefly "Fund NAV"
    described by "Fund net asset value."
  }

  type HoldingValuation is {
    companyId is UUID with { briefly "Company" described by "Company ID." }
    cost is Decimal(15, 2) with { briefly "Cost" described by "Cost basis." }
    fairValue is Decimal(15, 2) with { briefly "Fair value" described by "Fair value." }
  } with {
    briefly "Holding valuation"
    described by "Portfolio company valuation."
  }

} with {
  option is external
  briefly "External fund accounting"
  described by "Fund accounting system."
}

context BankingService is {

  command InitiateWireTransfer is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    recipientId is LPId with { briefly "Recipient" described by "LP ID." }
    amount is Decimal(15, 2) with { briefly "Amount" described by "Transfer amount." }
    wireDate is Date with { briefly "Date" described by "Wire date." }
  } with {
    briefly "Initiate wire transfer"
    described by "Initiates distribution wire."
  }

  event WireTransferCompleted is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    recipientId is LPId with { briefly "Recipient" described by "LP ID." }
    amount is Decimal(15, 2) with { briefly "Amount" described by "Transfer amount." }
    completedAt is TimeStamp with { briefly "Completed" described by "Completion time." }
  } with {
    briefly "Wire transfer completed"
    described by "Emitted when wire completes."
  }

  query GetAccountBalance is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
  } with {
    briefly "Get account balance"
    described by "Gets fund cash balance."
  }

  result AccountBalance is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    balance is Decimal(15, 2) with { briefly "Balance" described by "Cash balance." }
    asOf is TimeStamp with { briefly "As of" described by "Balance time." }
  } with {
    briefly "Account balance"
    described by "Fund cash balance."
  }

} with {
  option is external
  briefly "External banking service"
  described by "Fund banking services."
}

context ComplianceReporting is {

  command FileForm10K is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    reportYear is Natural with { briefly "Year" described by "Report year." }
    reportData is String(1, 10000) with { briefly "Data" described by "Report data." }
  } with {
    briefly "File Form 10K"
    described by "Files annual compliance report."
  }

  command FileScheduleD is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    filingDate is Date with { briefly "Date" described by "Filing date." }
  } with {
    briefly "File Schedule D"
    described by "Files tax schedule."
  }

  event ComplianceFilingAccepted is {
    fundId is FundId with { briefly "Fund" described by "Fund ID." }
    filingType is String(1, 50) with { briefly "Type" described by "Filing type." }
    acceptedAt is TimeStamp with { briefly "Accepted" described by "Acceptance time." }
  } with {
    briefly "Compliance filing accepted"
    described by "Emitted when filing accepted."
  }

} with {
  option is external
  briefly "External compliance reporting"
  described by "Regulatory compliance system."
}
