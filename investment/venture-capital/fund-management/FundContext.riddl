// Fund Management - Fund Context
context FundContext is {
  include "types.riddl"
  include "Fund.riddl"
  repository FundRepository is {
    schema FundData is relational
      of funds as type Fund
        index on field Fund.fundId
        index on field Fund.status
        index on field Fund.fundInfo.vintage

    handler FundPersistence is {
      on command Fund.CreateFund is {
        prompt "Store new fund record"
      }
      on command Fund.AddLPCommitment is {
        prompt "Store LP commitment"
      }
      on command Fund.IssueCapitalCall is {
        prompt "Store capital call"
      }
      on command Fund.RecordCallPayment is {
        prompt "Update LP called amount"
      }
      on command Fund.IssueDistribution is {
        prompt "Store distribution"
      }
      on command Fund.UpdateNAV is {
        prompt "Update fund NAV"
      }
      on command Fund.CloseFund is {
        prompt "Update fund to closed"
      }
    } with {
      briefly "Persists fund commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Fund data persistence"
    described as {
      |Persistent storage for funds.
    }
  }
  projector FundPerformance is {
    record PerformanceMetrics is  {
      fundId: FundId with {
        briefly "Fund"
        described as {
          |Fund ID.
        }
      }
      vintage: Natural with {
        briefly "Vintage"
        described as {
          |Vintage year.
        }
      }
      tvpi: Decimal(6,2) with {
        briefly "TVPI"
        described as {
          |TVPI.
        }
      }
      dpi: Decimal(6,2) with {
        briefly "DPI"
        described as {
          |DPI.
        }
      }
      irr: Decimal(6,2)? with {
        briefly "IRR"
        described as {
          |IRR.
        }
      }
      lastUpdated: Date with {
        briefly "Updated"
        described as {
          |Last update.
        }
      }
    } with {
      briefly "Performance metrics"
      described as {
        |Fund performance tracking.
      }
    }
    handler PerformanceHandler is {
      on event Fund.DistributionIssued is {
        prompt "Calculate updated DPI and TVPI"
      }
      on event Fund.NAVUpdated is {
        prompt "Calculate updated TVPI and IRR"
      }
    } with {
      briefly "Maintains fund performance"
      described as {
        |Projects events into performance.
      }
    }
  } with {
    briefly "Fund performance"
    described as {
      |Fund performance analytics.
    }
  }
} with {
  briefly "Bounded context for fund management"
  described as {
    |VC fund operations context.
  }
}
