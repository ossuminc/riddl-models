// Portfolio Management - External Contexts
context MarketIntelligence is {
  query GetCompanyValuation is  {
    companyId: CompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    asOfDate: Date with {
      briefly "Date"
      described as {
        |Valuation date.
      }
    }
  } with {
    briefly "Get company valuation"
    described as {
      |Retrieves current company valuation data.
    }
  }
  result CompanyValuation is  {
    companyId: CompanyId with {
      briefly "Company"
      described as {
        |Company ID.
      }
    }
    estimatedValuation: Decimal(14,2) with {
      briefly "Valuation"
      described as {
        |Estimated valuation.
      }
    }
    confidenceLevel: String(3,50) with {
      briefly "Confidence"
      described as {
        |Valuation confidence.
      }
    }
    comparables: String(3,200)+ with {
      briefly "Comparables"
      described as {
        |Comparable companies.
      }
    }
  } with {
    briefly "Company valuation"
    described as {
      |Market valuation estimate for a company.
    }
  }
  query GetMarketTrends is  {
    sector: String(3,100) with {
      briefly "Sector"
      described as {
        |Industry sector.
      }
    }
    stage: InvestmentStage with {
      briefly "Stage"
      described as {
        |Investment stage.
      }
    }
  } with {
    briefly "Get market trends"
    described as {
      |Retrieves market trends for sector and stage.
    }
  }
  result MarketTrends is  {
    sector: String(3,100) with {
      briefly "Sector"
      described as {
        |Industry sector.
      }
    }
    medianValuation: Decimal(14,2) with {
      briefly "Median"
      described as {
        |Median valuation.
      }
    }
    dealCount: Natural with {
      briefly "Deals"
      described as {
        |Number of recent deals.
      }
    }
    trendDirection: String(3,50) with {
      briefly "Trend"
      described as {
        |Trend direction.
      }
    }
  } with {
    briefly "Market trends"
    described as {
      |Market trends for a sector and stage.
    }
  }
} with {
  option external()
  briefly "External market intelligence"
  described as {
    |Market data and intelligence platform.
  }
}
context LegalSystem is {
  command FileRegulatoryReport is  {
    investmentId: InvestmentId with {
      briefly "Investment"
      described as {
        |Investment ID.
      }
    }
    reportType: String(3,100) with {
      briefly "Type"
      described as {
        |Report type.
      }
    }
    filingDate: Date with {
      briefly "Date"
      described as {
        |Filing date.
      }
    }
  } with {
    briefly "File regulatory report"
    described as {
      |Files required regulatory reports.
    }
  }
  event RegulatoryReportFiled is  {
    investmentId: InvestmentId with {
      briefly "Investment"
      described as {
        |Investment ID.
      }
    }
    reportType: String(3,100) with {
      briefly "Type"
      described as {
        |Report type.
      }
    }
    filedAt: TimeStamp with {
      briefly "Filed"
      described as {
        |Filing time.
      }
    }
  } with {
    briefly "Regulatory report filed"
    described as {
      |Emitted when a regulatory report is filed.
    }
  }
  command ReviewTermSheet is  {
    investmentId: InvestmentId with {
      briefly "Investment"
      described as {
        |Investment ID.
      }
    }
    termSheetDocument: String(3,5000) with {
      briefly "Document"
      described as {
        |Term sheet content.
      }
    }
  } with {
    briefly "Review term sheet"
    described as {
      |Reviews term sheet for legal compliance.
    }
  }
  event TermSheetReviewed is  {
    investmentId: InvestmentId with {
      briefly "Investment"
      described as {
        |Investment ID.
      }
    }
    approved: Boolean with {
      briefly "Approved"
      described as {
        |Review approval.
      }
    }
    reviewNotes: String(3,2000) with {
      briefly "Notes"
      described as {
        |Review notes.
      }
    }
    reviewedAt: TimeStamp with {
      briefly "Reviewed"
      described as {
        |Review time.
      }
    }
  } with {
    briefly "Term sheet reviewed"
    described as {
      |Emitted when a term sheet review completes.
    }
  }
  query GetComplianceStatus is  {
    investmentId: InvestmentId with {
      briefly "Investment"
      described as {
        |Investment ID.
      }
    }
  } with {
    briefly "Get compliance status"
    described as {
      |Checks compliance status for an investment.
    }
  }
  result ComplianceStatus is  {
    investmentId: InvestmentId with {
      briefly "Investment"
      described as {
        |Investment ID.
      }
    }
    isCompliant: Boolean with {
      briefly "Compliant"
      described as {
        |Compliance status.
      }
    }
    pendingFilings: String(3,200)+ with {
      briefly "Pending"
      described as {
        |Pending filings.
      }
    }
    lastReviewDate: Date with {
      briefly "Last review"
      described as {
        |Last review date.
      }
    }
  } with {
    briefly "Compliance status"
    described as {
      |Investment compliance status.
    }
  }
} with {
  option external()
  briefly "External legal system"
  described as {
    |Legal and regulatory compliance system.
  }
}
