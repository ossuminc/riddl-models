// Portfolio Management - VC Portfolio Context
context VCPortfolioContext is {
  include "types.riddl"
  include "PortfolioInvestment.riddl"
  repository PortfolioRepository is {
    schema PortfolioData is relational
      of portfolioInvestments as type PortfolioInvestment
        index on field PortfolioInvestment.investmentId
        index on field PortfolioInvestment.companyInfo.companyId
        index on field PortfolioInvestment.status

    handler PortfolioPersistence is {
      on command PortfolioInvestment.RecordInvestment is {
        prompt "Store new portfolio investment"
      }
      on command PortfolioInvestment.AddMilestone is {
        prompt "Store new milestone"
      }
      on command PortfolioInvestment.UpdateMilestone is {
        prompt "Update milestone status"
      }
      on command PortfolioInvestment.AssignBoardSeat is {
        prompt "Store board seat assignment"
      }
      on command PortfolioInvestment.RecordFollowOn is {
        prompt "Store follow-on round"
      }
      on command PortfolioInvestment.RecordExit is {
        prompt "Update investment to exited"
      }
      on command PortfolioInvestment.WriteOff is {
        prompt "Update investment to written off"
      }
    } with {
      briefly "Persists portfolio commands"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Portfolio data persistence"
    described as {
      |Persistent storage for portfolio investments.
    }
  }
  projector PortfolioAnalytics is {
    record FundMetrics is  {
      totalInvested: Decimal(14,2) with {
        briefly "Invested"
        described as {
          |Total capital invested.
        }
      }
      totalRealized: Decimal(14,2) with {
        briefly "Realized"
        described as {
          |Total realized returns.
        }
      }
      activeInvestments: Natural with {
        briefly "Active"
        described as {
          |Active investment count.
        }
      }
      exitedInvestments: Natural with {
        briefly "Exited"
        described as {
          |Exited investment count.
        }
      }
      writtenOffCount: Natural with {
        briefly "Written off"
        described as {
          |Written-off investment count.
        }
      }
      averageMOIC: Decimal(6,2) with {
        briefly "Avg MOIC"
        described as {
          |Average multiple on invested capital.
        }
      }
    } with {
      briefly "Fund metrics"
      described as {
        |Fund-level performance metrics.
      }
    }
    handler AnalyticsHandler is {
      on event PortfolioInvestment.InvestmentRecorded is {
        prompt "Update total invested and active count"
      }
      on event PortfolioInvestment.FollowOnRecorded is {
        prompt "Update total invested amount"
      }
      on event PortfolioInvestment.ExitRecorded is {
        prompt "Update realized returns and exit count"
      }
      on event PortfolioInvestment.InvestmentWrittenOff is {
        prompt "Increment written-off count"
      }
      on event PortfolioInvestment.InvestmentMarkedDown is {
        prompt "Update unrealized valuation"
      }
    } with {
      briefly "Maintains portfolio analytics"
      described as {
        |Projects events into fund metrics.
      }
    }
  } with {
    briefly "Portfolio analytics"
    described as {
      |Fund-level portfolio performance analytics.
    }
  }
} with {
  briefly "Bounded context for VC portfolio management"
  described as {
    |Venture capital portfolio management context.
  }
}
