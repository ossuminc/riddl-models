// Fund Administration - Fund Admin Context
context FundAdminContext is {
  include "types.riddl"
  include "FundAccount.riddl"
  repository FundAdminRepository is {
    schema FundAdminData is relational
      of fundAccounts as type FundAccount
        index on field FundAccount.accountId
        index on field FundAccount.fundInfo.fundId
        index on field FundAccount.status

    handler FundAdminPersistence is {
      on command FundAccount.CreateFundAccount is {
        prompt "Store new fund account"
      }
      on command FundAccount.IssueCapitalCall is {
        prompt "Store capital call record"
      }
      on command FundAccount.RecordCallPayment is {
        prompt "Update partner contribution records"
      }
      on command FundAccount.ProcessDistribution is {
        prompt "Store distribution record"
      }
      on command FundAccount.CalculateNav is {
        prompt "Store NAV calculation"
      }
      on command FundAccount.RecordTransaction is {
        prompt "Store fund transaction"
      }
    } with {
      briefly "Persists fund administration events"
      described as {
        |Handles command-driven persistence.
      }
    }
  } with {
    briefly "Fund administration data persistence"
    described as {
      |Persistent storage for fund administration.
    }
  }
  projector FundMetrics is {
    record FundPerformanceMetrics is  {
      totalFundsManaged: Natural with {
        briefly "Funds"
        described as {
          |Total funds managed.
        }
      }
      totalCapitalCommitted: Decimal(18,2) with {
        briefly "Committed"
        described as {
          |Total capital committed.
        }
      }
      totalCapitalCalled: Decimal(18,2) with {
        briefly "Called"
        described as {
          |Total capital called.
        }
      }
      totalDistributions: Decimal(18,2) with {
        briefly "Distributed"
        described as {
          |Total distributions.
        }
      }
      averageNavPerFund: Decimal(18,2) with {
        briefly "Avg NAV"
        described as {
          |Average NAV per fund.
        }
      }
    } with {
      briefly "Fund performance metrics"
      described as {
        |Aggregate fund performance statistics.
      }
    }
    handler MetricsHandler is {
      on event FundAccount.FundAccountCreated is {
        prompt "Increment total funds managed"
      }
      on event FundAccount.CapitalCallIssued is {
        prompt "Update total capital called"
      }
      on event FundAccount.DistributionProcessed is {
        prompt "Update total distributions"
      }
      on event FundAccount.NavCalculated is {
        prompt "Recalculate average NAV per fund"
      }
    } with {
      briefly "Maintains fund performance metrics"
      described as {
        |Projects events into performance metrics.
      }
    }
  } with {
    briefly "Fund performance metrics"
    described as {
      |Fund administration analytics.
    }
  }
} with {
  briefly "Bounded context for fund administration"
  described as {
    |Venture capital fund administration context.
  }
}
